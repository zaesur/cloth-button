(function(){const er=document.createElement("link").relList;if(er&&er.supports&&er.supports("modulepreload"))return;for(const nr of document.querySelectorAll('link[rel="modulepreload"]'))rr(nr);new MutationObserver(nr=>{for(const sr of nr)if(sr.type==="childList")for(const ar of sr.addedNodes)ar.tagName==="LINK"&&ar.rel==="modulepreload"&&rr(ar)}).observe(document,{childList:!0,subtree:!0});function tr(nr){const sr={};return nr.integrity&&(sr.integrity=nr.integrity),nr.referrerPolicy&&(sr.referrerPolicy=nr.referrerPolicy),nr.crossOrigin==="use-credentials"?sr.credentials="include":nr.crossOrigin==="anonymous"?sr.credentials="omit":sr.credentials="same-origin",sr}function rr(nr){if(nr.ep)return;nr.ep=!0;const sr=tr(nr);fetch(nr.href,sr)}})();/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="173",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,RGBDepthPacking=3202,RGDepthPacking=3203,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001,TimestampQuery={COMPUTE:"compute",RENDER:"render"};class EventDispatcher{addEventListener(er,tr){this._listeners===void 0&&(this._listeners={});const rr=this._listeners;rr[er]===void 0&&(rr[er]=[]),rr[er].indexOf(tr)===-1&&rr[er].push(tr)}hasEventListener(er,tr){const rr=this._listeners;return rr===void 0?!1:rr[er]!==void 0&&rr[er].indexOf(tr)!==-1}removeEventListener(er,tr){const rr=this._listeners;if(rr===void 0)return;const nr=rr[er];if(nr!==void 0){const sr=nr.indexOf(tr);sr!==-1&&nr.splice(sr,1)}}dispatchEvent(er){const tr=this._listeners;if(tr===void 0)return;const rr=tr[er.type];if(rr!==void 0){er.target=this;const nr=rr.slice(0);for(let sr=0,ar=nr.length;sr<ar;sr++)nr[sr].call(this,er);er.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const ir=Math.random()*4294967295|0,er=Math.random()*4294967295|0,tr=Math.random()*4294967295|0,rr=Math.random()*4294967295|0;return(_lut[ir&255]+_lut[ir>>8&255]+_lut[ir>>16&255]+_lut[ir>>24&255]+"-"+_lut[er&255]+_lut[er>>8&255]+"-"+_lut[er>>16&15|64]+_lut[er>>24&255]+"-"+_lut[tr&63|128]+_lut[tr>>8&255]+"-"+_lut[tr>>16&255]+_lut[tr>>24&255]+_lut[rr&255]+_lut[rr>>8&255]+_lut[rr>>16&255]+_lut[rr>>24&255]).toLowerCase()}function clamp(ir,er,tr){return Math.max(er,Math.min(tr,ir))}function euclideanModulo(ir,er){return(ir%er+er)%er}function mapLinear(ir,er,tr,rr,nr){return rr+(ir-er)*(nr-rr)/(tr-er)}function inverseLerp(ir,er,tr){return ir!==er?(tr-ir)/(er-ir):0}function lerp$1(ir,er,tr){return(1-tr)*ir+tr*er}function damp(ir,er,tr,rr){return lerp$1(ir,er,1-Math.exp(-tr*rr))}function pingpong(ir,er=1){return er-Math.abs(euclideanModulo(ir,er*2)-er)}function smoothstep(ir,er,tr){return ir<=er?0:ir>=tr?1:(ir=(ir-er)/(tr-er),ir*ir*(3-2*ir))}function smootherstep(ir,er,tr){return ir<=er?0:ir>=tr?1:(ir=(ir-er)/(tr-er),ir*ir*ir*(ir*(ir*6-15)+10))}function randInt(ir,er){return ir+Math.floor(Math.random()*(er-ir+1))}function randFloat(ir,er){return ir+Math.random()*(er-ir)}function randFloatSpread(ir){return ir*(.5-Math.random())}function seededRandom(ir){ir!==void 0&&(_seed=ir);let er=_seed+=1831565813;return er=Math.imul(er^er>>>15,er|1),er^=er+Math.imul(er^er>>>7,er|61),((er^er>>>14)>>>0)/4294967296}function degToRad(ir){return ir*DEG2RAD}function radToDeg(ir){return ir*RAD2DEG}function isPowerOfTwo(ir){return(ir&ir-1)===0&&ir!==0}function ceilPowerOfTwo(ir){return Math.pow(2,Math.ceil(Math.log(ir)/Math.LN2))}function floorPowerOfTwo(ir){return Math.pow(2,Math.floor(Math.log(ir)/Math.LN2))}function setQuaternionFromProperEuler(ir,er,tr,rr,nr){const sr=Math.cos,ar=Math.sin,or=sr(tr/2),lr=ar(tr/2),cr=sr((er+rr)/2),hr=ar((er+rr)/2),fr=sr((er-rr)/2),ur=ar((er-rr)/2),pr=sr((rr-er)/2),gr=ar((rr-er)/2);switch(nr){case"XYX":ir.set(or*hr,lr*fr,lr*ur,or*cr);break;case"YZY":ir.set(lr*ur,or*hr,lr*fr,or*cr);break;case"ZXZ":ir.set(lr*fr,lr*ur,or*hr,or*cr);break;case"XZX":ir.set(or*hr,lr*gr,lr*pr,or*cr);break;case"YXY":ir.set(lr*pr,or*hr,lr*gr,or*cr);break;case"ZYZ":ir.set(lr*gr,lr*pr,or*hr,or*cr);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+nr)}}function denormalize(ir,er){switch(er.constructor){case Float32Array:return ir;case Uint32Array:return ir/4294967295;case Uint16Array:return ir/65535;case Uint8Array:return ir/255;case Int32Array:return Math.max(ir/2147483647,-1);case Int16Array:return Math.max(ir/32767,-1);case Int8Array:return Math.max(ir/127,-1);default:throw new Error("Invalid component type.")}}function normalize(ir,er){switch(er.constructor){case Float32Array:return ir;case Uint32Array:return Math.round(ir*4294967295);case Uint16Array:return Math.round(ir*65535);case Uint8Array:return Math.round(ir*255);case Int32Array:return Math.round(ir*2147483647);case Int16Array:return Math.round(ir*32767);case Int8Array:return Math.round(ir*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp:lerp$1,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(er=0,tr=0){Vector2.prototype.isVector2=!0,this.x=er,this.y=tr}get width(){return this.x}set width(er){this.x=er}get height(){return this.y}set height(er){this.y=er}set(er,tr){return this.x=er,this.y=tr,this}setScalar(er){return this.x=er,this.y=er,this}setX(er){return this.x=er,this}setY(er){return this.y=er,this}setComponent(er,tr){switch(er){case 0:this.x=tr;break;case 1:this.y=tr;break;default:throw new Error("index is out of range: "+er)}return this}getComponent(er){switch(er){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+er)}}clone(){return new this.constructor(this.x,this.y)}copy(er){return this.x=er.x,this.y=er.y,this}add(er){return this.x+=er.x,this.y+=er.y,this}addScalar(er){return this.x+=er,this.y+=er,this}addVectors(er,tr){return this.x=er.x+tr.x,this.y=er.y+tr.y,this}addScaledVector(er,tr){return this.x+=er.x*tr,this.y+=er.y*tr,this}sub(er){return this.x-=er.x,this.y-=er.y,this}subScalar(er){return this.x-=er,this.y-=er,this}subVectors(er,tr){return this.x=er.x-tr.x,this.y=er.y-tr.y,this}multiply(er){return this.x*=er.x,this.y*=er.y,this}multiplyScalar(er){return this.x*=er,this.y*=er,this}divide(er){return this.x/=er.x,this.y/=er.y,this}divideScalar(er){return this.multiplyScalar(1/er)}applyMatrix3(er){const tr=this.x,rr=this.y,nr=er.elements;return this.x=nr[0]*tr+nr[3]*rr+nr[6],this.y=nr[1]*tr+nr[4]*rr+nr[7],this}min(er){return this.x=Math.min(this.x,er.x),this.y=Math.min(this.y,er.y),this}max(er){return this.x=Math.max(this.x,er.x),this.y=Math.max(this.y,er.y),this}clamp(er,tr){return this.x=clamp(this.x,er.x,tr.x),this.y=clamp(this.y,er.y,tr.y),this}clampScalar(er,tr){return this.x=clamp(this.x,er,tr),this.y=clamp(this.y,er,tr),this}clampLength(er,tr){const rr=this.length();return this.divideScalar(rr||1).multiplyScalar(clamp(rr,er,tr))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(er){return this.x*er.x+this.y*er.y}cross(er){return this.x*er.y-this.y*er.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(er){const tr=Math.sqrt(this.lengthSq()*er.lengthSq());if(tr===0)return Math.PI/2;const rr=this.dot(er)/tr;return Math.acos(clamp(rr,-1,1))}distanceTo(er){return Math.sqrt(this.distanceToSquared(er))}distanceToSquared(er){const tr=this.x-er.x,rr=this.y-er.y;return tr*tr+rr*rr}manhattanDistanceTo(er){return Math.abs(this.x-er.x)+Math.abs(this.y-er.y)}setLength(er){return this.normalize().multiplyScalar(er)}lerp(er,tr){return this.x+=(er.x-this.x)*tr,this.y+=(er.y-this.y)*tr,this}lerpVectors(er,tr,rr){return this.x=er.x+(tr.x-er.x)*rr,this.y=er.y+(tr.y-er.y)*rr,this}equals(er){return er.x===this.x&&er.y===this.y}fromArray(er,tr=0){return this.x=er[tr],this.y=er[tr+1],this}toArray(er=[],tr=0){return er[tr]=this.x,er[tr+1]=this.y,er}fromBufferAttribute(er,tr){return this.x=er.getX(tr),this.y=er.getY(tr),this}rotateAround(er,tr){const rr=Math.cos(tr),nr=Math.sin(tr),sr=this.x-er.x,ar=this.y-er.y;return this.x=sr*rr-ar*nr+er.x,this.y=sr*nr+ar*rr+er.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(er,tr,rr,nr,sr,ar,or,lr,cr){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],er!==void 0&&this.set(er,tr,rr,nr,sr,ar,or,lr,cr)}set(er,tr,rr,nr,sr,ar,or,lr,cr){const hr=this.elements;return hr[0]=er,hr[1]=nr,hr[2]=or,hr[3]=tr,hr[4]=sr,hr[5]=lr,hr[6]=rr,hr[7]=ar,hr[8]=cr,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(er){const tr=this.elements,rr=er.elements;return tr[0]=rr[0],tr[1]=rr[1],tr[2]=rr[2],tr[3]=rr[3],tr[4]=rr[4],tr[5]=rr[5],tr[6]=rr[6],tr[7]=rr[7],tr[8]=rr[8],this}extractBasis(er,tr,rr){return er.setFromMatrix3Column(this,0),tr.setFromMatrix3Column(this,1),rr.setFromMatrix3Column(this,2),this}setFromMatrix4(er){const tr=er.elements;return this.set(tr[0],tr[4],tr[8],tr[1],tr[5],tr[9],tr[2],tr[6],tr[10]),this}multiply(er){return this.multiplyMatrices(this,er)}premultiply(er){return this.multiplyMatrices(er,this)}multiplyMatrices(er,tr){const rr=er.elements,nr=tr.elements,sr=this.elements,ar=rr[0],or=rr[3],lr=rr[6],cr=rr[1],hr=rr[4],fr=rr[7],ur=rr[2],pr=rr[5],gr=rr[8],_r=nr[0],mr=nr[3],dr=nr[6],vr=nr[1],Ar=nr[4],yr=nr[7],wr=nr[2],br=nr[5],Sr=nr[8];return sr[0]=ar*_r+or*vr+lr*wr,sr[3]=ar*mr+or*Ar+lr*br,sr[6]=ar*dr+or*yr+lr*Sr,sr[1]=cr*_r+hr*vr+fr*wr,sr[4]=cr*mr+hr*Ar+fr*br,sr[7]=cr*dr+hr*yr+fr*Sr,sr[2]=ur*_r+pr*vr+gr*wr,sr[5]=ur*mr+pr*Ar+gr*br,sr[8]=ur*dr+pr*yr+gr*Sr,this}multiplyScalar(er){const tr=this.elements;return tr[0]*=er,tr[3]*=er,tr[6]*=er,tr[1]*=er,tr[4]*=er,tr[7]*=er,tr[2]*=er,tr[5]*=er,tr[8]*=er,this}determinant(){const er=this.elements,tr=er[0],rr=er[1],nr=er[2],sr=er[3],ar=er[4],or=er[5],lr=er[6],cr=er[7],hr=er[8];return tr*ar*hr-tr*or*cr-rr*sr*hr+rr*or*lr+nr*sr*cr-nr*ar*lr}invert(){const er=this.elements,tr=er[0],rr=er[1],nr=er[2],sr=er[3],ar=er[4],or=er[5],lr=er[6],cr=er[7],hr=er[8],fr=hr*ar-or*cr,ur=or*lr-hr*sr,pr=cr*sr-ar*lr,gr=tr*fr+rr*ur+nr*pr;if(gr===0)return this.set(0,0,0,0,0,0,0,0,0);const _r=1/gr;return er[0]=fr*_r,er[1]=(nr*cr-hr*rr)*_r,er[2]=(or*rr-nr*ar)*_r,er[3]=ur*_r,er[4]=(hr*tr-nr*lr)*_r,er[5]=(nr*sr-or*tr)*_r,er[6]=pr*_r,er[7]=(rr*lr-cr*tr)*_r,er[8]=(ar*tr-rr*sr)*_r,this}transpose(){let er;const tr=this.elements;return er=tr[1],tr[1]=tr[3],tr[3]=er,er=tr[2],tr[2]=tr[6],tr[6]=er,er=tr[5],tr[5]=tr[7],tr[7]=er,this}getNormalMatrix(er){return this.setFromMatrix4(er).invert().transpose()}transposeIntoArray(er){const tr=this.elements;return er[0]=tr[0],er[1]=tr[3],er[2]=tr[6],er[3]=tr[1],er[4]=tr[4],er[5]=tr[7],er[6]=tr[2],er[7]=tr[5],er[8]=tr[8],this}setUvTransform(er,tr,rr,nr,sr,ar,or){const lr=Math.cos(sr),cr=Math.sin(sr);return this.set(rr*lr,rr*cr,-rr*(lr*ar+cr*or)+ar+er,-nr*cr,nr*lr,-nr*(-cr*ar+lr*or)+or+tr,0,0,1),this}scale(er,tr){return this.premultiply(_m3.makeScale(er,tr)),this}rotate(er){return this.premultiply(_m3.makeRotation(-er)),this}translate(er,tr){return this.premultiply(_m3.makeTranslation(er,tr)),this}makeTranslation(er,tr){return er.isVector2?this.set(1,0,er.x,0,1,er.y,0,0,1):this.set(1,0,er,0,1,tr,0,0,1),this}makeRotation(er){const tr=Math.cos(er),rr=Math.sin(er);return this.set(tr,-rr,0,rr,tr,0,0,0,1),this}makeScale(er,tr){return this.set(er,0,0,0,tr,0,0,0,1),this}equals(er){const tr=this.elements,rr=er.elements;for(let nr=0;nr<9;nr++)if(tr[nr]!==rr[nr])return!1;return!0}fromArray(er,tr=0){for(let rr=0;rr<9;rr++)this.elements[rr]=er[rr+tr];return this}toArray(er=[],tr=0){const rr=this.elements;return er[tr]=rr[0],er[tr+1]=rr[1],er[tr+2]=rr[2],er[tr+3]=rr[3],er[tr+4]=rr[4],er[tr+5]=rr[5],er[tr+6]=rr[6],er[tr+7]=rr[7],er[tr+8]=rr[8],er}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(ir){for(let er=ir.length-1;er>=0;--er)if(ir[er]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(ir,er){return new TYPED_ARRAYS[ir](er)}function createElementNS(ir){return document.createElementNS("http://www.w3.org/1999/xhtml",ir)}function createCanvasElement(){const ir=createElementNS("canvas");return ir.style.display="block",ir}const _cache={};function warnOnce(ir){ir in _cache||(_cache[ir]=!0,console.warn(ir))}function probeAsync(ir,er,tr){return new Promise(function(rr,nr){function sr(){switch(ir.clientWaitSync(er,ir.SYNC_FLUSH_COMMANDS_BIT,0)){case ir.WAIT_FAILED:nr();break;case ir.TIMEOUT_EXPIRED:setTimeout(sr,tr);break;default:rr()}}setTimeout(sr,tr)})}function toNormalizedProjectionMatrix(ir){const er=ir.elements;er[2]=.5*er[2]+.5*er[3],er[6]=.5*er[6]+.5*er[7],er[10]=.5*er[10]+.5*er[11],er[14]=.5*er[14]+.5*er[15]}function toReversedProjectionMatrix(ir){const er=ir.elements;er[11]===-1?(er[10]=-er[10]-1,er[14]=-er[14]):(er[10]=-er[10],er[14]=-er[14]+1)}const LINEAR_REC709_TO_XYZ=new Matrix3().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=new Matrix3().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function createColorManagement(){const ir={enabled:!0,workingColorSpace:LinearSRGBColorSpace,spaces:{},convert:function(nr,sr,ar){return this.enabled===!1||sr===ar||!sr||!ar||(this.spaces[sr].transfer===SRGBTransfer&&(nr.r=SRGBToLinear(nr.r),nr.g=SRGBToLinear(nr.g),nr.b=SRGBToLinear(nr.b)),this.spaces[sr].primaries!==this.spaces[ar].primaries&&(nr.applyMatrix3(this.spaces[sr].toXYZ),nr.applyMatrix3(this.spaces[ar].fromXYZ)),this.spaces[ar].transfer===SRGBTransfer&&(nr.r=LinearToSRGB(nr.r),nr.g=LinearToSRGB(nr.g),nr.b=LinearToSRGB(nr.b))),nr},fromWorkingColorSpace:function(nr,sr){return this.convert(nr,this.workingColorSpace,sr)},toWorkingColorSpace:function(nr,sr){return this.convert(nr,sr,this.workingColorSpace)},getPrimaries:function(nr){return this.spaces[nr].primaries},getTransfer:function(nr){return nr===NoColorSpace?LinearTransfer:this.spaces[nr].transfer},getLuminanceCoefficients:function(nr,sr=this.workingColorSpace){return nr.fromArray(this.spaces[sr].luminanceCoefficients)},define:function(nr){Object.assign(this.spaces,nr)},_getMatrix:function(nr,sr,ar){return nr.copy(this.spaces[sr].toXYZ).multiply(this.spaces[ar].fromXYZ)},_getDrawingBufferColorSpace:function(nr){return this.spaces[nr].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(nr=this.workingColorSpace){return this.spaces[nr].workingColorSpaceConfig.unpackColorSpace}},er=[.64,.33,.3,.6,.15,.06],tr=[.2126,.7152,.0722],rr=[.3127,.329];return ir.define({[LinearSRGBColorSpace]:{primaries:er,whitePoint:rr,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:tr,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}},[SRGBColorSpace]:{primaries:er,whitePoint:rr,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:tr,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}}}),ir}const ColorManagement=createColorManagement();function SRGBToLinear(ir){return ir<.04045?ir*.0773993808:Math.pow(ir*.9478672986+.0521327014,2.4)}function LinearToSRGB(ir){return ir<.0031308?ir*12.92:1.055*Math.pow(ir,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(er){if(/^data:/i.test(er.src)||typeof HTMLCanvasElement>"u")return er.src;let tr;if(er instanceof HTMLCanvasElement)tr=er;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=er.width,_canvas.height=er.height;const rr=_canvas.getContext("2d");er instanceof ImageData?rr.putImageData(er,0,0):rr.drawImage(er,0,0,er.width,er.height),tr=_canvas}return tr.toDataURL("image/png")}static sRGBToLinear(er){if(typeof HTMLImageElement<"u"&&er instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&er instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&er instanceof ImageBitmap){const tr=createElementNS("canvas");tr.width=er.width,tr.height=er.height;const rr=tr.getContext("2d");rr.drawImage(er,0,0,er.width,er.height);const nr=rr.getImageData(0,0,er.width,er.height),sr=nr.data;for(let ar=0;ar<sr.length;ar++)sr[ar]=SRGBToLinear(sr[ar]/255)*255;return rr.putImageData(nr,0,0),tr}else if(er.data){const tr=er.data.slice(0);for(let rr=0;rr<tr.length;rr++)tr instanceof Uint8Array||tr instanceof Uint8ClampedArray?tr[rr]=Math.floor(SRGBToLinear(tr[rr]/255)*255):tr[rr]=SRGBToLinear(tr[rr]);return{data:tr,width:er.width,height:er.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),er}}let _sourceId=0;class Source{constructor(er=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=er,this.dataReady=!0,this.version=0}set needsUpdate(er){er===!0&&this.version++}toJSON(er){const tr=er===void 0||typeof er=="string";if(!tr&&er.images[this.uuid]!==void 0)return er.images[this.uuid];const rr={uuid:this.uuid,url:""},nr=this.data;if(nr!==null){let sr;if(Array.isArray(nr)){sr=[];for(let ar=0,or=nr.length;ar<or;ar++)nr[ar].isDataTexture?sr.push(serializeImage(nr[ar].image)):sr.push(serializeImage(nr[ar]))}else sr=serializeImage(nr);rr.url=sr}return tr||(er.images[this.uuid]=rr),rr}}function serializeImage(ir){return typeof HTMLImageElement<"u"&&ir instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ir instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ir instanceof ImageBitmap?ImageUtils.getDataURL(ir):ir.data?{data:Array.from(ir.data),width:ir.width,height:ir.height,type:ir.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(er=Texture.DEFAULT_IMAGE,tr=Texture.DEFAULT_MAPPING,rr=ClampToEdgeWrapping,nr=ClampToEdgeWrapping,sr=LinearFilter,ar=LinearMipmapLinearFilter,or=RGBAFormat,lr=UnsignedByteType,cr=Texture.DEFAULT_ANISOTROPY,hr=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(er),this.mipmaps=[],this.mapping=tr,this.channel=0,this.wrapS=rr,this.wrapT=nr,this.magFilter=sr,this.minFilter=ar,this.anisotropy=cr,this.format=or,this.internalFormat=null,this.type=lr,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=hr,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(er=null){this.source.data=er}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(er){return this.name=er.name,this.source=er.source,this.mipmaps=er.mipmaps.slice(0),this.mapping=er.mapping,this.channel=er.channel,this.wrapS=er.wrapS,this.wrapT=er.wrapT,this.magFilter=er.magFilter,this.minFilter=er.minFilter,this.anisotropy=er.anisotropy,this.format=er.format,this.internalFormat=er.internalFormat,this.type=er.type,this.offset.copy(er.offset),this.repeat.copy(er.repeat),this.center.copy(er.center),this.rotation=er.rotation,this.matrixAutoUpdate=er.matrixAutoUpdate,this.matrix.copy(er.matrix),this.generateMipmaps=er.generateMipmaps,this.premultiplyAlpha=er.premultiplyAlpha,this.flipY=er.flipY,this.unpackAlignment=er.unpackAlignment,this.colorSpace=er.colorSpace,this.renderTarget=er.renderTarget,this.isRenderTargetTexture=er.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(er.userData)),this.needsUpdate=!0,this}toJSON(er){const tr=er===void 0||typeof er=="string";if(!tr&&er.textures[this.uuid]!==void 0)return er.textures[this.uuid];const rr={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(er).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(rr.userData=this.userData),tr||(er.textures[this.uuid]=rr),rr}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(er){if(this.mapping!==UVMapping)return er;if(er.applyMatrix3(this.matrix),er.x<0||er.x>1)switch(this.wrapS){case RepeatWrapping:er.x=er.x-Math.floor(er.x);break;case ClampToEdgeWrapping:er.x=er.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(er.x)%2)===1?er.x=Math.ceil(er.x)-er.x:er.x=er.x-Math.floor(er.x);break}if(er.y<0||er.y>1)switch(this.wrapT){case RepeatWrapping:er.y=er.y-Math.floor(er.y);break;case ClampToEdgeWrapping:er.y=er.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(er.y)%2)===1?er.y=Math.ceil(er.y)-er.y:er.y=er.y-Math.floor(er.y);break}return this.flipY&&(er.y=1-er.y),er}set needsUpdate(er){er===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(er){er===!0&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(er=0,tr=0,rr=0,nr=1){Vector4.prototype.isVector4=!0,this.x=er,this.y=tr,this.z=rr,this.w=nr}get width(){return this.z}set width(er){this.z=er}get height(){return this.w}set height(er){this.w=er}set(er,tr,rr,nr){return this.x=er,this.y=tr,this.z=rr,this.w=nr,this}setScalar(er){return this.x=er,this.y=er,this.z=er,this.w=er,this}setX(er){return this.x=er,this}setY(er){return this.y=er,this}setZ(er){return this.z=er,this}setW(er){return this.w=er,this}setComponent(er,tr){switch(er){case 0:this.x=tr;break;case 1:this.y=tr;break;case 2:this.z=tr;break;case 3:this.w=tr;break;default:throw new Error("index is out of range: "+er)}return this}getComponent(er){switch(er){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+er)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(er){return this.x=er.x,this.y=er.y,this.z=er.z,this.w=er.w!==void 0?er.w:1,this}add(er){return this.x+=er.x,this.y+=er.y,this.z+=er.z,this.w+=er.w,this}addScalar(er){return this.x+=er,this.y+=er,this.z+=er,this.w+=er,this}addVectors(er,tr){return this.x=er.x+tr.x,this.y=er.y+tr.y,this.z=er.z+tr.z,this.w=er.w+tr.w,this}addScaledVector(er,tr){return this.x+=er.x*tr,this.y+=er.y*tr,this.z+=er.z*tr,this.w+=er.w*tr,this}sub(er){return this.x-=er.x,this.y-=er.y,this.z-=er.z,this.w-=er.w,this}subScalar(er){return this.x-=er,this.y-=er,this.z-=er,this.w-=er,this}subVectors(er,tr){return this.x=er.x-tr.x,this.y=er.y-tr.y,this.z=er.z-tr.z,this.w=er.w-tr.w,this}multiply(er){return this.x*=er.x,this.y*=er.y,this.z*=er.z,this.w*=er.w,this}multiplyScalar(er){return this.x*=er,this.y*=er,this.z*=er,this.w*=er,this}applyMatrix4(er){const tr=this.x,rr=this.y,nr=this.z,sr=this.w,ar=er.elements;return this.x=ar[0]*tr+ar[4]*rr+ar[8]*nr+ar[12]*sr,this.y=ar[1]*tr+ar[5]*rr+ar[9]*nr+ar[13]*sr,this.z=ar[2]*tr+ar[6]*rr+ar[10]*nr+ar[14]*sr,this.w=ar[3]*tr+ar[7]*rr+ar[11]*nr+ar[15]*sr,this}divide(er){return this.x/=er.x,this.y/=er.y,this.z/=er.z,this.w/=er.w,this}divideScalar(er){return this.multiplyScalar(1/er)}setAxisAngleFromQuaternion(er){this.w=2*Math.acos(er.w);const tr=Math.sqrt(1-er.w*er.w);return tr<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=er.x/tr,this.y=er.y/tr,this.z=er.z/tr),this}setAxisAngleFromRotationMatrix(er){let tr,rr,nr,sr;const lr=er.elements,cr=lr[0],hr=lr[4],fr=lr[8],ur=lr[1],pr=lr[5],gr=lr[9],_r=lr[2],mr=lr[6],dr=lr[10];if(Math.abs(hr-ur)<.01&&Math.abs(fr-_r)<.01&&Math.abs(gr-mr)<.01){if(Math.abs(hr+ur)<.1&&Math.abs(fr+_r)<.1&&Math.abs(gr+mr)<.1&&Math.abs(cr+pr+dr-3)<.1)return this.set(1,0,0,0),this;tr=Math.PI;const Ar=(cr+1)/2,yr=(pr+1)/2,wr=(dr+1)/2,br=(hr+ur)/4,Sr=(fr+_r)/4,xr=(gr+mr)/4;return Ar>yr&&Ar>wr?Ar<.01?(rr=0,nr=.707106781,sr=.707106781):(rr=Math.sqrt(Ar),nr=br/rr,sr=Sr/rr):yr>wr?yr<.01?(rr=.707106781,nr=0,sr=.707106781):(nr=Math.sqrt(yr),rr=br/nr,sr=xr/nr):wr<.01?(rr=.707106781,nr=.707106781,sr=0):(sr=Math.sqrt(wr),rr=Sr/sr,nr=xr/sr),this.set(rr,nr,sr,tr),this}let vr=Math.sqrt((mr-gr)*(mr-gr)+(fr-_r)*(fr-_r)+(ur-hr)*(ur-hr));return Math.abs(vr)<.001&&(vr=1),this.x=(mr-gr)/vr,this.y=(fr-_r)/vr,this.z=(ur-hr)/vr,this.w=Math.acos((cr+pr+dr-1)/2),this}setFromMatrixPosition(er){const tr=er.elements;return this.x=tr[12],this.y=tr[13],this.z=tr[14],this.w=tr[15],this}min(er){return this.x=Math.min(this.x,er.x),this.y=Math.min(this.y,er.y),this.z=Math.min(this.z,er.z),this.w=Math.min(this.w,er.w),this}max(er){return this.x=Math.max(this.x,er.x),this.y=Math.max(this.y,er.y),this.z=Math.max(this.z,er.z),this.w=Math.max(this.w,er.w),this}clamp(er,tr){return this.x=clamp(this.x,er.x,tr.x),this.y=clamp(this.y,er.y,tr.y),this.z=clamp(this.z,er.z,tr.z),this.w=clamp(this.w,er.w,tr.w),this}clampScalar(er,tr){return this.x=clamp(this.x,er,tr),this.y=clamp(this.y,er,tr),this.z=clamp(this.z,er,tr),this.w=clamp(this.w,er,tr),this}clampLength(er,tr){const rr=this.length();return this.divideScalar(rr||1).multiplyScalar(clamp(rr,er,tr))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(er){return this.x*er.x+this.y*er.y+this.z*er.z+this.w*er.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(er){return this.normalize().multiplyScalar(er)}lerp(er,tr){return this.x+=(er.x-this.x)*tr,this.y+=(er.y-this.y)*tr,this.z+=(er.z-this.z)*tr,this.w+=(er.w-this.w)*tr,this}lerpVectors(er,tr,rr){return this.x=er.x+(tr.x-er.x)*rr,this.y=er.y+(tr.y-er.y)*rr,this.z=er.z+(tr.z-er.z)*rr,this.w=er.w+(tr.w-er.w)*rr,this}equals(er){return er.x===this.x&&er.y===this.y&&er.z===this.z&&er.w===this.w}fromArray(er,tr=0){return this.x=er[tr],this.y=er[tr+1],this.z=er[tr+2],this.w=er[tr+3],this}toArray(er=[],tr=0){return er[tr]=this.x,er[tr+1]=this.y,er[tr+2]=this.z,er[tr+3]=this.w,er}fromBufferAttribute(er,tr){return this.x=er.getX(tr),this.y=er.getY(tr),this.z=er.getZ(tr),this.w=er.getW(tr),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(er=1,tr=1,rr={}){super(),this.isRenderTarget=!0,this.width=er,this.height=tr,this.depth=1,this.scissor=new Vector4(0,0,er,tr),this.scissorTest=!1,this.viewport=new Vector4(0,0,er,tr);const nr={width:er,height:tr,depth:1};rr=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},rr);const sr=new Texture(nr,rr.mapping,rr.wrapS,rr.wrapT,rr.magFilter,rr.minFilter,rr.format,rr.type,rr.anisotropy,rr.colorSpace);sr.flipY=!1,sr.generateMipmaps=rr.generateMipmaps,sr.internalFormat=rr.internalFormat,this.textures=[];const ar=rr.count;for(let or=0;or<ar;or++)this.textures[or]=sr.clone(),this.textures[or].isRenderTargetTexture=!0,this.textures[or].renderTarget=this;this.depthBuffer=rr.depthBuffer,this.stencilBuffer=rr.stencilBuffer,this.resolveDepthBuffer=rr.resolveDepthBuffer,this.resolveStencilBuffer=rr.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=rr.depthTexture,this.samples=rr.samples}get texture(){return this.textures[0]}set texture(er){this.textures[0]=er}set depthTexture(er){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),er!==null&&(er.renderTarget=this),this._depthTexture=er}get depthTexture(){return this._depthTexture}setSize(er,tr,rr=1){if(this.width!==er||this.height!==tr||this.depth!==rr){this.width=er,this.height=tr,this.depth=rr;for(let nr=0,sr=this.textures.length;nr<sr;nr++)this.textures[nr].image.width=er,this.textures[nr].image.height=tr,this.textures[nr].image.depth=rr;this.dispose()}this.viewport.set(0,0,er,tr),this.scissor.set(0,0,er,tr)}clone(){return new this.constructor().copy(this)}copy(er){this.width=er.width,this.height=er.height,this.depth=er.depth,this.scissor.copy(er.scissor),this.scissorTest=er.scissorTest,this.viewport.copy(er.viewport),this.textures.length=0;for(let rr=0,nr=er.textures.length;rr<nr;rr++)this.textures[rr]=er.textures[rr].clone(),this.textures[rr].isRenderTargetTexture=!0,this.textures[rr].renderTarget=this;const tr=Object.assign({},er.texture.image);return this.texture.source=new Source(tr),this.depthBuffer=er.depthBuffer,this.stencilBuffer=er.stencilBuffer,this.resolveDepthBuffer=er.resolveDepthBuffer,this.resolveStencilBuffer=er.resolveStencilBuffer,er.depthTexture!==null&&(this.depthTexture=er.depthTexture.clone()),this.samples=er.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(er=1,tr=1,rr={}){super(er,tr,rr),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(er=null,tr=1,rr=1,nr=1){super(null),this.isDataArrayTexture=!0,this.image={data:er,width:tr,height:rr,depth:nr},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(er){this.layerUpdates.add(er)}clearLayerUpdates(){this.layerUpdates.clear()}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(er=1,tr=1,rr=1,nr={}){super(er,tr,nr),this.isWebGLArrayRenderTarget=!0,this.depth=rr,this.texture=new DataArrayTexture(null,er,tr,rr),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(er=null,tr=1,rr=1,nr=1){super(null),this.isData3DTexture=!0,this.image={data:er,width:tr,height:rr,depth:nr},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(er=1,tr=1,rr=1,nr={}){super(er,tr,nr),this.isWebGL3DRenderTarget=!0,this.depth=rr,this.texture=new Data3DTexture(null,er,tr,rr),this.texture.isRenderTargetTexture=!0}}let Quaternion$1=class{constructor(er=0,tr=0,rr=0,nr=1){this.isQuaternion=!0,this._x=er,this._y=tr,this._z=rr,this._w=nr}static slerpFlat(er,tr,rr,nr,sr,ar,or){let lr=rr[nr+0],cr=rr[nr+1],hr=rr[nr+2],fr=rr[nr+3];const ur=sr[ar+0],pr=sr[ar+1],gr=sr[ar+2],_r=sr[ar+3];if(or===0){er[tr+0]=lr,er[tr+1]=cr,er[tr+2]=hr,er[tr+3]=fr;return}if(or===1){er[tr+0]=ur,er[tr+1]=pr,er[tr+2]=gr,er[tr+3]=_r;return}if(fr!==_r||lr!==ur||cr!==pr||hr!==gr){let mr=1-or;const dr=lr*ur+cr*pr+hr*gr+fr*_r,vr=dr>=0?1:-1,Ar=1-dr*dr;if(Ar>Number.EPSILON){const wr=Math.sqrt(Ar),br=Math.atan2(wr,dr*vr);mr=Math.sin(mr*br)/wr,or=Math.sin(or*br)/wr}const yr=or*vr;if(lr=lr*mr+ur*yr,cr=cr*mr+pr*yr,hr=hr*mr+gr*yr,fr=fr*mr+_r*yr,mr===1-or){const wr=1/Math.sqrt(lr*lr+cr*cr+hr*hr+fr*fr);lr*=wr,cr*=wr,hr*=wr,fr*=wr}}er[tr]=lr,er[tr+1]=cr,er[tr+2]=hr,er[tr+3]=fr}static multiplyQuaternionsFlat(er,tr,rr,nr,sr,ar){const or=rr[nr],lr=rr[nr+1],cr=rr[nr+2],hr=rr[nr+3],fr=sr[ar],ur=sr[ar+1],pr=sr[ar+2],gr=sr[ar+3];return er[tr]=or*gr+hr*fr+lr*pr-cr*ur,er[tr+1]=lr*gr+hr*ur+cr*fr-or*pr,er[tr+2]=cr*gr+hr*pr+or*ur-lr*fr,er[tr+3]=hr*gr-or*fr-lr*ur-cr*pr,er}get x(){return this._x}set x(er){this._x=er,this._onChangeCallback()}get y(){return this._y}set y(er){this._y=er,this._onChangeCallback()}get z(){return this._z}set z(er){this._z=er,this._onChangeCallback()}get w(){return this._w}set w(er){this._w=er,this._onChangeCallback()}set(er,tr,rr,nr){return this._x=er,this._y=tr,this._z=rr,this._w=nr,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(er){return this._x=er.x,this._y=er.y,this._z=er.z,this._w=er.w,this._onChangeCallback(),this}setFromEuler(er,tr=!0){const rr=er._x,nr=er._y,sr=er._z,ar=er._order,or=Math.cos,lr=Math.sin,cr=or(rr/2),hr=or(nr/2),fr=or(sr/2),ur=lr(rr/2),pr=lr(nr/2),gr=lr(sr/2);switch(ar){case"XYZ":this._x=ur*hr*fr+cr*pr*gr,this._y=cr*pr*fr-ur*hr*gr,this._z=cr*hr*gr+ur*pr*fr,this._w=cr*hr*fr-ur*pr*gr;break;case"YXZ":this._x=ur*hr*fr+cr*pr*gr,this._y=cr*pr*fr-ur*hr*gr,this._z=cr*hr*gr-ur*pr*fr,this._w=cr*hr*fr+ur*pr*gr;break;case"ZXY":this._x=ur*hr*fr-cr*pr*gr,this._y=cr*pr*fr+ur*hr*gr,this._z=cr*hr*gr+ur*pr*fr,this._w=cr*hr*fr-ur*pr*gr;break;case"ZYX":this._x=ur*hr*fr-cr*pr*gr,this._y=cr*pr*fr+ur*hr*gr,this._z=cr*hr*gr-ur*pr*fr,this._w=cr*hr*fr+ur*pr*gr;break;case"YZX":this._x=ur*hr*fr+cr*pr*gr,this._y=cr*pr*fr+ur*hr*gr,this._z=cr*hr*gr-ur*pr*fr,this._w=cr*hr*fr-ur*pr*gr;break;case"XZY":this._x=ur*hr*fr-cr*pr*gr,this._y=cr*pr*fr-ur*hr*gr,this._z=cr*hr*gr+ur*pr*fr,this._w=cr*hr*fr+ur*pr*gr;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+ar)}return tr===!0&&this._onChangeCallback(),this}setFromAxisAngle(er,tr){const rr=tr/2,nr=Math.sin(rr);return this._x=er.x*nr,this._y=er.y*nr,this._z=er.z*nr,this._w=Math.cos(rr),this._onChangeCallback(),this}setFromRotationMatrix(er){const tr=er.elements,rr=tr[0],nr=tr[4],sr=tr[8],ar=tr[1],or=tr[5],lr=tr[9],cr=tr[2],hr=tr[6],fr=tr[10],ur=rr+or+fr;if(ur>0){const pr=.5/Math.sqrt(ur+1);this._w=.25/pr,this._x=(hr-lr)*pr,this._y=(sr-cr)*pr,this._z=(ar-nr)*pr}else if(rr>or&&rr>fr){const pr=2*Math.sqrt(1+rr-or-fr);this._w=(hr-lr)/pr,this._x=.25*pr,this._y=(nr+ar)/pr,this._z=(sr+cr)/pr}else if(or>fr){const pr=2*Math.sqrt(1+or-rr-fr);this._w=(sr-cr)/pr,this._x=(nr+ar)/pr,this._y=.25*pr,this._z=(lr+hr)/pr}else{const pr=2*Math.sqrt(1+fr-rr-or);this._w=(ar-nr)/pr,this._x=(sr+cr)/pr,this._y=(lr+hr)/pr,this._z=.25*pr}return this._onChangeCallback(),this}setFromUnitVectors(er,tr){let rr=er.dot(tr)+1;return rr<Number.EPSILON?(rr=0,Math.abs(er.x)>Math.abs(er.z)?(this._x=-er.y,this._y=er.x,this._z=0,this._w=rr):(this._x=0,this._y=-er.z,this._z=er.y,this._w=rr)):(this._x=er.y*tr.z-er.z*tr.y,this._y=er.z*tr.x-er.x*tr.z,this._z=er.x*tr.y-er.y*tr.x,this._w=rr),this.normalize()}angleTo(er){return 2*Math.acos(Math.abs(clamp(this.dot(er),-1,1)))}rotateTowards(er,tr){const rr=this.angleTo(er);if(rr===0)return this;const nr=Math.min(1,tr/rr);return this.slerp(er,nr),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(er){return this._x*er._x+this._y*er._y+this._z*er._z+this._w*er._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let er=this.length();return er===0?(this._x=0,this._y=0,this._z=0,this._w=1):(er=1/er,this._x=this._x*er,this._y=this._y*er,this._z=this._z*er,this._w=this._w*er),this._onChangeCallback(),this}multiply(er){return this.multiplyQuaternions(this,er)}premultiply(er){return this.multiplyQuaternions(er,this)}multiplyQuaternions(er,tr){const rr=er._x,nr=er._y,sr=er._z,ar=er._w,or=tr._x,lr=tr._y,cr=tr._z,hr=tr._w;return this._x=rr*hr+ar*or+nr*cr-sr*lr,this._y=nr*hr+ar*lr+sr*or-rr*cr,this._z=sr*hr+ar*cr+rr*lr-nr*or,this._w=ar*hr-rr*or-nr*lr-sr*cr,this._onChangeCallback(),this}slerp(er,tr){if(tr===0)return this;if(tr===1)return this.copy(er);const rr=this._x,nr=this._y,sr=this._z,ar=this._w;let or=ar*er._w+rr*er._x+nr*er._y+sr*er._z;if(or<0?(this._w=-er._w,this._x=-er._x,this._y=-er._y,this._z=-er._z,or=-or):this.copy(er),or>=1)return this._w=ar,this._x=rr,this._y=nr,this._z=sr,this;const lr=1-or*or;if(lr<=Number.EPSILON){const pr=1-tr;return this._w=pr*ar+tr*this._w,this._x=pr*rr+tr*this._x,this._y=pr*nr+tr*this._y,this._z=pr*sr+tr*this._z,this.normalize(),this}const cr=Math.sqrt(lr),hr=Math.atan2(cr,or),fr=Math.sin((1-tr)*hr)/cr,ur=Math.sin(tr*hr)/cr;return this._w=ar*fr+this._w*ur,this._x=rr*fr+this._x*ur,this._y=nr*fr+this._y*ur,this._z=sr*fr+this._z*ur,this._onChangeCallback(),this}slerpQuaternions(er,tr,rr){return this.copy(er).slerp(tr,rr)}random(){const er=2*Math.PI*Math.random(),tr=2*Math.PI*Math.random(),rr=Math.random(),nr=Math.sqrt(1-rr),sr=Math.sqrt(rr);return this.set(nr*Math.sin(er),nr*Math.cos(er),sr*Math.sin(tr),sr*Math.cos(tr))}equals(er){return er._x===this._x&&er._y===this._y&&er._z===this._z&&er._w===this._w}fromArray(er,tr=0){return this._x=er[tr],this._y=er[tr+1],this._z=er[tr+2],this._w=er[tr+3],this._onChangeCallback(),this}toArray(er=[],tr=0){return er[tr]=this._x,er[tr+1]=this._y,er[tr+2]=this._z,er[tr+3]=this._w,er}fromBufferAttribute(er,tr){return this._x=er.getX(tr),this._y=er.getY(tr),this._z=er.getZ(tr),this._w=er.getW(tr),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(er){return this._onChangeCallback=er,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Vector3$1=class co{constructor(er=0,tr=0,rr=0){co.prototype.isVector3=!0,this.x=er,this.y=tr,this.z=rr}set(er,tr,rr){return rr===void 0&&(rr=this.z),this.x=er,this.y=tr,this.z=rr,this}setScalar(er){return this.x=er,this.y=er,this.z=er,this}setX(er){return this.x=er,this}setY(er){return this.y=er,this}setZ(er){return this.z=er,this}setComponent(er,tr){switch(er){case 0:this.x=tr;break;case 1:this.y=tr;break;case 2:this.z=tr;break;default:throw new Error("index is out of range: "+er)}return this}getComponent(er){switch(er){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+er)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(er){return this.x=er.x,this.y=er.y,this.z=er.z,this}add(er){return this.x+=er.x,this.y+=er.y,this.z+=er.z,this}addScalar(er){return this.x+=er,this.y+=er,this.z+=er,this}addVectors(er,tr){return this.x=er.x+tr.x,this.y=er.y+tr.y,this.z=er.z+tr.z,this}addScaledVector(er,tr){return this.x+=er.x*tr,this.y+=er.y*tr,this.z+=er.z*tr,this}sub(er){return this.x-=er.x,this.y-=er.y,this.z-=er.z,this}subScalar(er){return this.x-=er,this.y-=er,this.z-=er,this}subVectors(er,tr){return this.x=er.x-tr.x,this.y=er.y-tr.y,this.z=er.z-tr.z,this}multiply(er){return this.x*=er.x,this.y*=er.y,this.z*=er.z,this}multiplyScalar(er){return this.x*=er,this.y*=er,this.z*=er,this}multiplyVectors(er,tr){return this.x=er.x*tr.x,this.y=er.y*tr.y,this.z=er.z*tr.z,this}applyEuler(er){return this.applyQuaternion(_quaternion$4.setFromEuler(er))}applyAxisAngle(er,tr){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(er,tr))}applyMatrix3(er){const tr=this.x,rr=this.y,nr=this.z,sr=er.elements;return this.x=sr[0]*tr+sr[3]*rr+sr[6]*nr,this.y=sr[1]*tr+sr[4]*rr+sr[7]*nr,this.z=sr[2]*tr+sr[5]*rr+sr[8]*nr,this}applyNormalMatrix(er){return this.applyMatrix3(er).normalize()}applyMatrix4(er){const tr=this.x,rr=this.y,nr=this.z,sr=er.elements,ar=1/(sr[3]*tr+sr[7]*rr+sr[11]*nr+sr[15]);return this.x=(sr[0]*tr+sr[4]*rr+sr[8]*nr+sr[12])*ar,this.y=(sr[1]*tr+sr[5]*rr+sr[9]*nr+sr[13])*ar,this.z=(sr[2]*tr+sr[6]*rr+sr[10]*nr+sr[14])*ar,this}applyQuaternion(er){const tr=this.x,rr=this.y,nr=this.z,sr=er.x,ar=er.y,or=er.z,lr=er.w,cr=2*(ar*nr-or*rr),hr=2*(or*tr-sr*nr),fr=2*(sr*rr-ar*tr);return this.x=tr+lr*cr+ar*fr-or*hr,this.y=rr+lr*hr+or*cr-sr*fr,this.z=nr+lr*fr+sr*hr-ar*cr,this}project(er){return this.applyMatrix4(er.matrixWorldInverse).applyMatrix4(er.projectionMatrix)}unproject(er){return this.applyMatrix4(er.projectionMatrixInverse).applyMatrix4(er.matrixWorld)}transformDirection(er){const tr=this.x,rr=this.y,nr=this.z,sr=er.elements;return this.x=sr[0]*tr+sr[4]*rr+sr[8]*nr,this.y=sr[1]*tr+sr[5]*rr+sr[9]*nr,this.z=sr[2]*tr+sr[6]*rr+sr[10]*nr,this.normalize()}divide(er){return this.x/=er.x,this.y/=er.y,this.z/=er.z,this}divideScalar(er){return this.multiplyScalar(1/er)}min(er){return this.x=Math.min(this.x,er.x),this.y=Math.min(this.y,er.y),this.z=Math.min(this.z,er.z),this}max(er){return this.x=Math.max(this.x,er.x),this.y=Math.max(this.y,er.y),this.z=Math.max(this.z,er.z),this}clamp(er,tr){return this.x=clamp(this.x,er.x,tr.x),this.y=clamp(this.y,er.y,tr.y),this.z=clamp(this.z,er.z,tr.z),this}clampScalar(er,tr){return this.x=clamp(this.x,er,tr),this.y=clamp(this.y,er,tr),this.z=clamp(this.z,er,tr),this}clampLength(er,tr){const rr=this.length();return this.divideScalar(rr||1).multiplyScalar(clamp(rr,er,tr))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(er){return this.x*er.x+this.y*er.y+this.z*er.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(er){return this.normalize().multiplyScalar(er)}lerp(er,tr){return this.x+=(er.x-this.x)*tr,this.y+=(er.y-this.y)*tr,this.z+=(er.z-this.z)*tr,this}lerpVectors(er,tr,rr){return this.x=er.x+(tr.x-er.x)*rr,this.y=er.y+(tr.y-er.y)*rr,this.z=er.z+(tr.z-er.z)*rr,this}cross(er){return this.crossVectors(this,er)}crossVectors(er,tr){const rr=er.x,nr=er.y,sr=er.z,ar=tr.x,or=tr.y,lr=tr.z;return this.x=nr*lr-sr*or,this.y=sr*ar-rr*lr,this.z=rr*or-nr*ar,this}projectOnVector(er){const tr=er.lengthSq();if(tr===0)return this.set(0,0,0);const rr=er.dot(this)/tr;return this.copy(er).multiplyScalar(rr)}projectOnPlane(er){return _vector$c.copy(this).projectOnVector(er),this.sub(_vector$c)}reflect(er){return this.sub(_vector$c.copy(er).multiplyScalar(2*this.dot(er)))}angleTo(er){const tr=Math.sqrt(this.lengthSq()*er.lengthSq());if(tr===0)return Math.PI/2;const rr=this.dot(er)/tr;return Math.acos(clamp(rr,-1,1))}distanceTo(er){return Math.sqrt(this.distanceToSquared(er))}distanceToSquared(er){const tr=this.x-er.x,rr=this.y-er.y,nr=this.z-er.z;return tr*tr+rr*rr+nr*nr}manhattanDistanceTo(er){return Math.abs(this.x-er.x)+Math.abs(this.y-er.y)+Math.abs(this.z-er.z)}setFromSpherical(er){return this.setFromSphericalCoords(er.radius,er.phi,er.theta)}setFromSphericalCoords(er,tr,rr){const nr=Math.sin(tr)*er;return this.x=nr*Math.sin(rr),this.y=Math.cos(tr)*er,this.z=nr*Math.cos(rr),this}setFromCylindrical(er){return this.setFromCylindricalCoords(er.radius,er.theta,er.y)}setFromCylindricalCoords(er,tr,rr){return this.x=er*Math.sin(tr),this.y=rr,this.z=er*Math.cos(tr),this}setFromMatrixPosition(er){const tr=er.elements;return this.x=tr[12],this.y=tr[13],this.z=tr[14],this}setFromMatrixScale(er){const tr=this.setFromMatrixColumn(er,0).length(),rr=this.setFromMatrixColumn(er,1).length(),nr=this.setFromMatrixColumn(er,2).length();return this.x=tr,this.y=rr,this.z=nr,this}setFromMatrixColumn(er,tr){return this.fromArray(er.elements,tr*4)}setFromMatrix3Column(er,tr){return this.fromArray(er.elements,tr*3)}setFromEuler(er){return this.x=er._x,this.y=er._y,this.z=er._z,this}setFromColor(er){return this.x=er.r,this.y=er.g,this.z=er.b,this}equals(er){return er.x===this.x&&er.y===this.y&&er.z===this.z}fromArray(er,tr=0){return this.x=er[tr],this.y=er[tr+1],this.z=er[tr+2],this}toArray(er=[],tr=0){return er[tr]=this.x,er[tr+1]=this.y,er[tr+2]=this.z,er}fromBufferAttribute(er,tr){return this.x=er.getX(tr),this.y=er.getY(tr),this.z=er.getZ(tr),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const er=Math.random()*Math.PI*2,tr=Math.random()*2-1,rr=Math.sqrt(1-tr*tr);return this.x=rr*Math.cos(er),this.y=tr,this.z=rr*Math.sin(er),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const _vector$c=new Vector3$1,_quaternion$4=new Quaternion$1;class Box3{constructor(er=new Vector3$1(1/0,1/0,1/0),tr=new Vector3$1(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=er,this.max=tr}set(er,tr){return this.min.copy(er),this.max.copy(tr),this}setFromArray(er){this.makeEmpty();for(let tr=0,rr=er.length;tr<rr;tr+=3)this.expandByPoint(_vector$b.fromArray(er,tr));return this}setFromBufferAttribute(er){this.makeEmpty();for(let tr=0,rr=er.count;tr<rr;tr++)this.expandByPoint(_vector$b.fromBufferAttribute(er,tr));return this}setFromPoints(er){this.makeEmpty();for(let tr=0,rr=er.length;tr<rr;tr++)this.expandByPoint(er[tr]);return this}setFromCenterAndSize(er,tr){const rr=_vector$b.copy(tr).multiplyScalar(.5);return this.min.copy(er).sub(rr),this.max.copy(er).add(rr),this}setFromObject(er,tr=!1){return this.makeEmpty(),this.expandByObject(er,tr)}clone(){return new this.constructor().copy(this)}copy(er){return this.min.copy(er.min),this.max.copy(er.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(er){return this.isEmpty()?er.set(0,0,0):er.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(er){return this.isEmpty()?er.set(0,0,0):er.subVectors(this.max,this.min)}expandByPoint(er){return this.min.min(er),this.max.max(er),this}expandByVector(er){return this.min.sub(er),this.max.add(er),this}expandByScalar(er){return this.min.addScalar(-er),this.max.addScalar(er),this}expandByObject(er,tr=!1){er.updateWorldMatrix(!1,!1);const rr=er.geometry;if(rr!==void 0){const sr=rr.getAttribute("position");if(tr===!0&&sr!==void 0&&er.isInstancedMesh!==!0)for(let ar=0,or=sr.count;ar<or;ar++)er.isMesh===!0?er.getVertexPosition(ar,_vector$b):_vector$b.fromBufferAttribute(sr,ar),_vector$b.applyMatrix4(er.matrixWorld),this.expandByPoint(_vector$b);else er.boundingBox!==void 0?(er.boundingBox===null&&er.computeBoundingBox(),_box$4.copy(er.boundingBox)):(rr.boundingBox===null&&rr.computeBoundingBox(),_box$4.copy(rr.boundingBox)),_box$4.applyMatrix4(er.matrixWorld),this.union(_box$4)}const nr=er.children;for(let sr=0,ar=nr.length;sr<ar;sr++)this.expandByObject(nr[sr],tr);return this}containsPoint(er){return er.x>=this.min.x&&er.x<=this.max.x&&er.y>=this.min.y&&er.y<=this.max.y&&er.z>=this.min.z&&er.z<=this.max.z}containsBox(er){return this.min.x<=er.min.x&&er.max.x<=this.max.x&&this.min.y<=er.min.y&&er.max.y<=this.max.y&&this.min.z<=er.min.z&&er.max.z<=this.max.z}getParameter(er,tr){return tr.set((er.x-this.min.x)/(this.max.x-this.min.x),(er.y-this.min.y)/(this.max.y-this.min.y),(er.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(er){return er.max.x>=this.min.x&&er.min.x<=this.max.x&&er.max.y>=this.min.y&&er.min.y<=this.max.y&&er.max.z>=this.min.z&&er.min.z<=this.max.z}intersectsSphere(er){return this.clampPoint(er.center,_vector$b),_vector$b.distanceToSquared(er.center)<=er.radius*er.radius}intersectsPlane(er){let tr,rr;return er.normal.x>0?(tr=er.normal.x*this.min.x,rr=er.normal.x*this.max.x):(tr=er.normal.x*this.max.x,rr=er.normal.x*this.min.x),er.normal.y>0?(tr+=er.normal.y*this.min.y,rr+=er.normal.y*this.max.y):(tr+=er.normal.y*this.max.y,rr+=er.normal.y*this.min.y),er.normal.z>0?(tr+=er.normal.z*this.min.z,rr+=er.normal.z*this.max.z):(tr+=er.normal.z*this.max.z,rr+=er.normal.z*this.min.z),tr<=-er.constant&&rr>=-er.constant}intersectsTriangle(er){if(this.isEmpty())return!1;this.getCenter(_center$3),_extents.subVectors(this.max,_center$3),_v0$2.subVectors(er.a,_center$3),_v1$7.subVectors(er.b,_center$3),_v2$4$1.subVectors(er.c,_center$3),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4$1,_v1$7),_f2.subVectors(_v0$2,_v2$4$1);let tr=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(tr,_v0$2,_v1$7,_v2$4$1,_extents)||(tr=[1,0,0,0,1,0,0,0,1],!satForAxes(tr,_v0$2,_v1$7,_v2$4$1,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),tr=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(tr,_v0$2,_v1$7,_v2$4$1,_extents))}clampPoint(er,tr){return tr.copy(er).clamp(this.min,this.max)}distanceToPoint(er){return this.clampPoint(er,_vector$b).distanceTo(er)}getBoundingSphere(er){return this.isEmpty()?er.makeEmpty():(this.getCenter(er.center),er.radius=this.getSize(_vector$b).length()*.5),er}intersect(er){return this.min.max(er.min),this.max.min(er.max),this.isEmpty()&&this.makeEmpty(),this}union(er){return this.min.min(er.min),this.max.max(er.max),this}applyMatrix4(er){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(er),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(er),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(er),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(er),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(er),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(er),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(er),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(er),this.setFromPoints(_points),this)}translate(er){return this.min.add(er),this.max.add(er),this}equals(er){return er.min.equals(this.min)&&er.max.equals(this.max)}}const _points=[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1],_vector$b=new Vector3$1,_box$4=new Box3,_v0$2=new Vector3$1,_v1$7=new Vector3$1,_v2$4$1=new Vector3$1,_f0=new Vector3$1,_f1=new Vector3$1,_f2=new Vector3$1,_center$3=new Vector3$1,_extents=new Vector3$1,_triangleNormal=new Vector3$1,_testAxis=new Vector3$1;function satForAxes(ir,er,tr,rr,nr){for(let sr=0,ar=ir.length-3;sr<=ar;sr+=3){_testAxis.fromArray(ir,sr);const or=nr.x*Math.abs(_testAxis.x)+nr.y*Math.abs(_testAxis.y)+nr.z*Math.abs(_testAxis.z),lr=er.dot(_testAxis),cr=tr.dot(_testAxis),hr=rr.dot(_testAxis);if(Math.max(-Math.max(lr,cr,hr),Math.min(lr,cr,hr))>or)return!1}return!0}const _box$3=new Box3,_v1$6=new Vector3$1,_v2$3$1=new Vector3$1;class Sphere{constructor(er=new Vector3$1,tr=-1){this.isSphere=!0,this.center=er,this.radius=tr}set(er,tr){return this.center.copy(er),this.radius=tr,this}setFromPoints(er,tr){const rr=this.center;tr!==void 0?rr.copy(tr):_box$3.setFromPoints(er).getCenter(rr);let nr=0;for(let sr=0,ar=er.length;sr<ar;sr++)nr=Math.max(nr,rr.distanceToSquared(er[sr]));return this.radius=Math.sqrt(nr),this}copy(er){return this.center.copy(er.center),this.radius=er.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(er){return er.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(er){return er.distanceTo(this.center)-this.radius}intersectsSphere(er){const tr=this.radius+er.radius;return er.center.distanceToSquared(this.center)<=tr*tr}intersectsBox(er){return er.intersectsSphere(this)}intersectsPlane(er){return Math.abs(er.distanceToPoint(this.center))<=this.radius}clampPoint(er,tr){const rr=this.center.distanceToSquared(er);return tr.copy(er),rr>this.radius*this.radius&&(tr.sub(this.center).normalize(),tr.multiplyScalar(this.radius).add(this.center)),tr}getBoundingBox(er){return this.isEmpty()?(er.makeEmpty(),er):(er.set(this.center,this.center),er.expandByScalar(this.radius),er)}applyMatrix4(er){return this.center.applyMatrix4(er),this.radius=this.radius*er.getMaxScaleOnAxis(),this}translate(er){return this.center.add(er),this}expandByPoint(er){if(this.isEmpty())return this.center.copy(er),this.radius=0,this;_v1$6.subVectors(er,this.center);const tr=_v1$6.lengthSq();if(tr>this.radius*this.radius){const rr=Math.sqrt(tr),nr=(rr-this.radius)*.5;this.center.addScaledVector(_v1$6,nr/rr),this.radius+=nr}return this}union(er){return er.isEmpty()?this:this.isEmpty()?(this.copy(er),this):(this.center.equals(er.center)===!0?this.radius=Math.max(this.radius,er.radius):(_v2$3$1.subVectors(er.center,this.center).setLength(er.radius),this.expandByPoint(_v1$6.copy(er.center).add(_v2$3$1)),this.expandByPoint(_v1$6.copy(er.center).sub(_v2$3$1))),this)}equals(er){return er.center.equals(this.center)&&er.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$a=new Vector3$1,_segCenter=new Vector3$1,_segDir=new Vector3$1,_diff$1=new Vector3$1,_edge1=new Vector3$1,_edge2=new Vector3$1,_normal$1=new Vector3$1;let Ray$1=class{constructor(er=new Vector3$1,tr=new Vector3$1(0,0,-1)){this.origin=er,this.direction=tr}set(er,tr){return this.origin.copy(er),this.direction.copy(tr),this}copy(er){return this.origin.copy(er.origin),this.direction.copy(er.direction),this}at(er,tr){return tr.copy(this.origin).addScaledVector(this.direction,er)}lookAt(er){return this.direction.copy(er).sub(this.origin).normalize(),this}recast(er){return this.origin.copy(this.at(er,_vector$a)),this}closestPointToPoint(er,tr){tr.subVectors(er,this.origin);const rr=tr.dot(this.direction);return rr<0?tr.copy(this.origin):tr.copy(this.origin).addScaledVector(this.direction,rr)}distanceToPoint(er){return Math.sqrt(this.distanceSqToPoint(er))}distanceSqToPoint(er){const tr=_vector$a.subVectors(er,this.origin).dot(this.direction);return tr<0?this.origin.distanceToSquared(er):(_vector$a.copy(this.origin).addScaledVector(this.direction,tr),_vector$a.distanceToSquared(er))}distanceSqToSegment(er,tr,rr,nr){_segCenter.copy(er).add(tr).multiplyScalar(.5),_segDir.copy(tr).sub(er).normalize(),_diff$1.copy(this.origin).sub(_segCenter);const sr=er.distanceTo(tr)*.5,ar=-this.direction.dot(_segDir),or=_diff$1.dot(this.direction),lr=-_diff$1.dot(_segDir),cr=_diff$1.lengthSq(),hr=Math.abs(1-ar*ar);let fr,ur,pr,gr;if(hr>0)if(fr=ar*lr-or,ur=ar*or-lr,gr=sr*hr,fr>=0)if(ur>=-gr)if(ur<=gr){const _r=1/hr;fr*=_r,ur*=_r,pr=fr*(fr+ar*ur+2*or)+ur*(ar*fr+ur+2*lr)+cr}else ur=sr,fr=Math.max(0,-(ar*ur+or)),pr=-fr*fr+ur*(ur+2*lr)+cr;else ur=-sr,fr=Math.max(0,-(ar*ur+or)),pr=-fr*fr+ur*(ur+2*lr)+cr;else ur<=-gr?(fr=Math.max(0,-(-ar*sr+or)),ur=fr>0?-sr:Math.min(Math.max(-sr,-lr),sr),pr=-fr*fr+ur*(ur+2*lr)+cr):ur<=gr?(fr=0,ur=Math.min(Math.max(-sr,-lr),sr),pr=ur*(ur+2*lr)+cr):(fr=Math.max(0,-(ar*sr+or)),ur=fr>0?sr:Math.min(Math.max(-sr,-lr),sr),pr=-fr*fr+ur*(ur+2*lr)+cr);else ur=ar>0?-sr:sr,fr=Math.max(0,-(ar*ur+or)),pr=-fr*fr+ur*(ur+2*lr)+cr;return rr&&rr.copy(this.origin).addScaledVector(this.direction,fr),nr&&nr.copy(_segCenter).addScaledVector(_segDir,ur),pr}intersectSphere(er,tr){_vector$a.subVectors(er.center,this.origin);const rr=_vector$a.dot(this.direction),nr=_vector$a.dot(_vector$a)-rr*rr,sr=er.radius*er.radius;if(nr>sr)return null;const ar=Math.sqrt(sr-nr),or=rr-ar,lr=rr+ar;return lr<0?null:or<0?this.at(lr,tr):this.at(or,tr)}intersectsSphere(er){return this.distanceSqToPoint(er.center)<=er.radius*er.radius}distanceToPlane(er){const tr=er.normal.dot(this.direction);if(tr===0)return er.distanceToPoint(this.origin)===0?0:null;const rr=-(this.origin.dot(er.normal)+er.constant)/tr;return rr>=0?rr:null}intersectPlane(er,tr){const rr=this.distanceToPlane(er);return rr===null?null:this.at(rr,tr)}intersectsPlane(er){const tr=er.distanceToPoint(this.origin);return tr===0||er.normal.dot(this.direction)*tr<0}intersectBox(er,tr){let rr,nr,sr,ar,or,lr;const cr=1/this.direction.x,hr=1/this.direction.y,fr=1/this.direction.z,ur=this.origin;return cr>=0?(rr=(er.min.x-ur.x)*cr,nr=(er.max.x-ur.x)*cr):(rr=(er.max.x-ur.x)*cr,nr=(er.min.x-ur.x)*cr),hr>=0?(sr=(er.min.y-ur.y)*hr,ar=(er.max.y-ur.y)*hr):(sr=(er.max.y-ur.y)*hr,ar=(er.min.y-ur.y)*hr),rr>ar||sr>nr||((sr>rr||isNaN(rr))&&(rr=sr),(ar<nr||isNaN(nr))&&(nr=ar),fr>=0?(or=(er.min.z-ur.z)*fr,lr=(er.max.z-ur.z)*fr):(or=(er.max.z-ur.z)*fr,lr=(er.min.z-ur.z)*fr),rr>lr||or>nr)||((or>rr||rr!==rr)&&(rr=or),(lr<nr||nr!==nr)&&(nr=lr),nr<0)?null:this.at(rr>=0?rr:nr,tr)}intersectsBox(er){return this.intersectBox(er,_vector$a)!==null}intersectTriangle(er,tr,rr,nr,sr){_edge1.subVectors(tr,er),_edge2.subVectors(rr,er),_normal$1.crossVectors(_edge1,_edge2);let ar=this.direction.dot(_normal$1),or;if(ar>0){if(nr)return null;or=1}else if(ar<0)or=-1,ar=-ar;else return null;_diff$1.subVectors(this.origin,er);const lr=or*this.direction.dot(_edge2.crossVectors(_diff$1,_edge2));if(lr<0)return null;const cr=or*this.direction.dot(_edge1.cross(_diff$1));if(cr<0||lr+cr>ar)return null;const hr=-or*_diff$1.dot(_normal$1);return hr<0?null:this.at(hr/ar,sr)}applyMatrix4(er){return this.origin.applyMatrix4(er),this.direction.transformDirection(er),this}equals(er){return er.origin.equals(this.origin)&&er.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Matrix4{constructor(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr,_r,mr){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],er!==void 0&&this.set(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr,_r,mr)}set(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr,_r,mr){const dr=this.elements;return dr[0]=er,dr[4]=tr,dr[8]=rr,dr[12]=nr,dr[1]=sr,dr[5]=ar,dr[9]=or,dr[13]=lr,dr[2]=cr,dr[6]=hr,dr[10]=fr,dr[14]=ur,dr[3]=pr,dr[7]=gr,dr[11]=_r,dr[15]=mr,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(er){const tr=this.elements,rr=er.elements;return tr[0]=rr[0],tr[1]=rr[1],tr[2]=rr[2],tr[3]=rr[3],tr[4]=rr[4],tr[5]=rr[5],tr[6]=rr[6],tr[7]=rr[7],tr[8]=rr[8],tr[9]=rr[9],tr[10]=rr[10],tr[11]=rr[11],tr[12]=rr[12],tr[13]=rr[13],tr[14]=rr[14],tr[15]=rr[15],this}copyPosition(er){const tr=this.elements,rr=er.elements;return tr[12]=rr[12],tr[13]=rr[13],tr[14]=rr[14],this}setFromMatrix3(er){const tr=er.elements;return this.set(tr[0],tr[3],tr[6],0,tr[1],tr[4],tr[7],0,tr[2],tr[5],tr[8],0,0,0,0,1),this}extractBasis(er,tr,rr){return er.setFromMatrixColumn(this,0),tr.setFromMatrixColumn(this,1),rr.setFromMatrixColumn(this,2),this}makeBasis(er,tr,rr){return this.set(er.x,tr.x,rr.x,0,er.y,tr.y,rr.y,0,er.z,tr.z,rr.z,0,0,0,0,1),this}extractRotation(er){const tr=this.elements,rr=er.elements,nr=1/_v1$5$1.setFromMatrixColumn(er,0).length(),sr=1/_v1$5$1.setFromMatrixColumn(er,1).length(),ar=1/_v1$5$1.setFromMatrixColumn(er,2).length();return tr[0]=rr[0]*nr,tr[1]=rr[1]*nr,tr[2]=rr[2]*nr,tr[3]=0,tr[4]=rr[4]*sr,tr[5]=rr[5]*sr,tr[6]=rr[6]*sr,tr[7]=0,tr[8]=rr[8]*ar,tr[9]=rr[9]*ar,tr[10]=rr[10]*ar,tr[11]=0,tr[12]=0,tr[13]=0,tr[14]=0,tr[15]=1,this}makeRotationFromEuler(er){const tr=this.elements,rr=er.x,nr=er.y,sr=er.z,ar=Math.cos(rr),or=Math.sin(rr),lr=Math.cos(nr),cr=Math.sin(nr),hr=Math.cos(sr),fr=Math.sin(sr);if(er.order==="XYZ"){const ur=ar*hr,pr=ar*fr,gr=or*hr,_r=or*fr;tr[0]=lr*hr,tr[4]=-lr*fr,tr[8]=cr,tr[1]=pr+gr*cr,tr[5]=ur-_r*cr,tr[9]=-or*lr,tr[2]=_r-ur*cr,tr[6]=gr+pr*cr,tr[10]=ar*lr}else if(er.order==="YXZ"){const ur=lr*hr,pr=lr*fr,gr=cr*hr,_r=cr*fr;tr[0]=ur+_r*or,tr[4]=gr*or-pr,tr[8]=ar*cr,tr[1]=ar*fr,tr[5]=ar*hr,tr[9]=-or,tr[2]=pr*or-gr,tr[6]=_r+ur*or,tr[10]=ar*lr}else if(er.order==="ZXY"){const ur=lr*hr,pr=lr*fr,gr=cr*hr,_r=cr*fr;tr[0]=ur-_r*or,tr[4]=-ar*fr,tr[8]=gr+pr*or,tr[1]=pr+gr*or,tr[5]=ar*hr,tr[9]=_r-ur*or,tr[2]=-ar*cr,tr[6]=or,tr[10]=ar*lr}else if(er.order==="ZYX"){const ur=ar*hr,pr=ar*fr,gr=or*hr,_r=or*fr;tr[0]=lr*hr,tr[4]=gr*cr-pr,tr[8]=ur*cr+_r,tr[1]=lr*fr,tr[5]=_r*cr+ur,tr[9]=pr*cr-gr,tr[2]=-cr,tr[6]=or*lr,tr[10]=ar*lr}else if(er.order==="YZX"){const ur=ar*lr,pr=ar*cr,gr=or*lr,_r=or*cr;tr[0]=lr*hr,tr[4]=_r-ur*fr,tr[8]=gr*fr+pr,tr[1]=fr,tr[5]=ar*hr,tr[9]=-or*hr,tr[2]=-cr*hr,tr[6]=pr*fr+gr,tr[10]=ur-_r*fr}else if(er.order==="XZY"){const ur=ar*lr,pr=ar*cr,gr=or*lr,_r=or*cr;tr[0]=lr*hr,tr[4]=-fr,tr[8]=cr*hr,tr[1]=ur*fr+_r,tr[5]=ar*hr,tr[9]=pr*fr-gr,tr[2]=gr*fr-pr,tr[6]=or*hr,tr[10]=_r*fr+ur}return tr[3]=0,tr[7]=0,tr[11]=0,tr[12]=0,tr[13]=0,tr[14]=0,tr[15]=1,this}makeRotationFromQuaternion(er){return this.compose(_zero,er,_one)}lookAt(er,tr,rr){const nr=this.elements;return _z.subVectors(er,tr),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(rr,_z),_x.lengthSq()===0&&(Math.abs(rr.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(rr,_z)),_x.normalize(),_y.crossVectors(_z,_x),nr[0]=_x.x,nr[4]=_y.x,nr[8]=_z.x,nr[1]=_x.y,nr[5]=_y.y,nr[9]=_z.y,nr[2]=_x.z,nr[6]=_y.z,nr[10]=_z.z,this}multiply(er){return this.multiplyMatrices(this,er)}premultiply(er){return this.multiplyMatrices(er,this)}multiplyMatrices(er,tr){const rr=er.elements,nr=tr.elements,sr=this.elements,ar=rr[0],or=rr[4],lr=rr[8],cr=rr[12],hr=rr[1],fr=rr[5],ur=rr[9],pr=rr[13],gr=rr[2],_r=rr[6],mr=rr[10],dr=rr[14],vr=rr[3],Ar=rr[7],yr=rr[11],wr=rr[15],br=nr[0],Sr=nr[4],xr=nr[8],Cr=nr[12],Ir=nr[1],Rr=nr[5],Pr=nr[9],Fr=nr[13],Nr=nr[2],Ur=nr[6],Br=nr[10],Or=nr[14],Dr=nr[3],Wr=nr[7],$r=nr[11],Yr=nr[15];return sr[0]=ar*br+or*Ir+lr*Nr+cr*Dr,sr[4]=ar*Sr+or*Rr+lr*Ur+cr*Wr,sr[8]=ar*xr+or*Pr+lr*Br+cr*$r,sr[12]=ar*Cr+or*Fr+lr*Or+cr*Yr,sr[1]=hr*br+fr*Ir+ur*Nr+pr*Dr,sr[5]=hr*Sr+fr*Rr+ur*Ur+pr*Wr,sr[9]=hr*xr+fr*Pr+ur*Br+pr*$r,sr[13]=hr*Cr+fr*Fr+ur*Or+pr*Yr,sr[2]=gr*br+_r*Ir+mr*Nr+dr*Dr,sr[6]=gr*Sr+_r*Rr+mr*Ur+dr*Wr,sr[10]=gr*xr+_r*Pr+mr*Br+dr*$r,sr[14]=gr*Cr+_r*Fr+mr*Or+dr*Yr,sr[3]=vr*br+Ar*Ir+yr*Nr+wr*Dr,sr[7]=vr*Sr+Ar*Rr+yr*Ur+wr*Wr,sr[11]=vr*xr+Ar*Pr+yr*Br+wr*$r,sr[15]=vr*Cr+Ar*Fr+yr*Or+wr*Yr,this}multiplyScalar(er){const tr=this.elements;return tr[0]*=er,tr[4]*=er,tr[8]*=er,tr[12]*=er,tr[1]*=er,tr[5]*=er,tr[9]*=er,tr[13]*=er,tr[2]*=er,tr[6]*=er,tr[10]*=er,tr[14]*=er,tr[3]*=er,tr[7]*=er,tr[11]*=er,tr[15]*=er,this}determinant(){const er=this.elements,tr=er[0],rr=er[4],nr=er[8],sr=er[12],ar=er[1],or=er[5],lr=er[9],cr=er[13],hr=er[2],fr=er[6],ur=er[10],pr=er[14],gr=er[3],_r=er[7],mr=er[11],dr=er[15];return gr*(+sr*lr*fr-nr*cr*fr-sr*or*ur+rr*cr*ur+nr*or*pr-rr*lr*pr)+_r*(+tr*lr*pr-tr*cr*ur+sr*ar*ur-nr*ar*pr+nr*cr*hr-sr*lr*hr)+mr*(+tr*cr*fr-tr*or*pr-sr*ar*fr+rr*ar*pr+sr*or*hr-rr*cr*hr)+dr*(-nr*or*hr-tr*lr*fr+tr*or*ur+nr*ar*fr-rr*ar*ur+rr*lr*hr)}transpose(){const er=this.elements;let tr;return tr=er[1],er[1]=er[4],er[4]=tr,tr=er[2],er[2]=er[8],er[8]=tr,tr=er[6],er[6]=er[9],er[9]=tr,tr=er[3],er[3]=er[12],er[12]=tr,tr=er[7],er[7]=er[13],er[13]=tr,tr=er[11],er[11]=er[14],er[14]=tr,this}setPosition(er,tr,rr){const nr=this.elements;return er.isVector3?(nr[12]=er.x,nr[13]=er.y,nr[14]=er.z):(nr[12]=er,nr[13]=tr,nr[14]=rr),this}invert(){const er=this.elements,tr=er[0],rr=er[1],nr=er[2],sr=er[3],ar=er[4],or=er[5],lr=er[6],cr=er[7],hr=er[8],fr=er[9],ur=er[10],pr=er[11],gr=er[12],_r=er[13],mr=er[14],dr=er[15],vr=fr*mr*cr-_r*ur*cr+_r*lr*pr-or*mr*pr-fr*lr*dr+or*ur*dr,Ar=gr*ur*cr-hr*mr*cr-gr*lr*pr+ar*mr*pr+hr*lr*dr-ar*ur*dr,yr=hr*_r*cr-gr*fr*cr+gr*or*pr-ar*_r*pr-hr*or*dr+ar*fr*dr,wr=gr*fr*lr-hr*_r*lr-gr*or*ur+ar*_r*ur+hr*or*mr-ar*fr*mr,br=tr*vr+rr*Ar+nr*yr+sr*wr;if(br===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Sr=1/br;return er[0]=vr*Sr,er[1]=(_r*ur*sr-fr*mr*sr-_r*nr*pr+rr*mr*pr+fr*nr*dr-rr*ur*dr)*Sr,er[2]=(or*mr*sr-_r*lr*sr+_r*nr*cr-rr*mr*cr-or*nr*dr+rr*lr*dr)*Sr,er[3]=(fr*lr*sr-or*ur*sr-fr*nr*cr+rr*ur*cr+or*nr*pr-rr*lr*pr)*Sr,er[4]=Ar*Sr,er[5]=(hr*mr*sr-gr*ur*sr+gr*nr*pr-tr*mr*pr-hr*nr*dr+tr*ur*dr)*Sr,er[6]=(gr*lr*sr-ar*mr*sr-gr*nr*cr+tr*mr*cr+ar*nr*dr-tr*lr*dr)*Sr,er[7]=(ar*ur*sr-hr*lr*sr+hr*nr*cr-tr*ur*cr-ar*nr*pr+tr*lr*pr)*Sr,er[8]=yr*Sr,er[9]=(gr*fr*sr-hr*_r*sr-gr*rr*pr+tr*_r*pr+hr*rr*dr-tr*fr*dr)*Sr,er[10]=(ar*_r*sr-gr*or*sr+gr*rr*cr-tr*_r*cr-ar*rr*dr+tr*or*dr)*Sr,er[11]=(hr*or*sr-ar*fr*sr-hr*rr*cr+tr*fr*cr+ar*rr*pr-tr*or*pr)*Sr,er[12]=wr*Sr,er[13]=(hr*_r*nr-gr*fr*nr+gr*rr*ur-tr*_r*ur-hr*rr*mr+tr*fr*mr)*Sr,er[14]=(gr*or*nr-ar*_r*nr-gr*rr*lr+tr*_r*lr+ar*rr*mr-tr*or*mr)*Sr,er[15]=(ar*fr*nr-hr*or*nr+hr*rr*lr-tr*fr*lr-ar*rr*ur+tr*or*ur)*Sr,this}scale(er){const tr=this.elements,rr=er.x,nr=er.y,sr=er.z;return tr[0]*=rr,tr[4]*=nr,tr[8]*=sr,tr[1]*=rr,tr[5]*=nr,tr[9]*=sr,tr[2]*=rr,tr[6]*=nr,tr[10]*=sr,tr[3]*=rr,tr[7]*=nr,tr[11]*=sr,this}getMaxScaleOnAxis(){const er=this.elements,tr=er[0]*er[0]+er[1]*er[1]+er[2]*er[2],rr=er[4]*er[4]+er[5]*er[5]+er[6]*er[6],nr=er[8]*er[8]+er[9]*er[9]+er[10]*er[10];return Math.sqrt(Math.max(tr,rr,nr))}makeTranslation(er,tr,rr){return er.isVector3?this.set(1,0,0,er.x,0,1,0,er.y,0,0,1,er.z,0,0,0,1):this.set(1,0,0,er,0,1,0,tr,0,0,1,rr,0,0,0,1),this}makeRotationX(er){const tr=Math.cos(er),rr=Math.sin(er);return this.set(1,0,0,0,0,tr,-rr,0,0,rr,tr,0,0,0,0,1),this}makeRotationY(er){const tr=Math.cos(er),rr=Math.sin(er);return this.set(tr,0,rr,0,0,1,0,0,-rr,0,tr,0,0,0,0,1),this}makeRotationZ(er){const tr=Math.cos(er),rr=Math.sin(er);return this.set(tr,-rr,0,0,rr,tr,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(er,tr){const rr=Math.cos(tr),nr=Math.sin(tr),sr=1-rr,ar=er.x,or=er.y,lr=er.z,cr=sr*ar,hr=sr*or;return this.set(cr*ar+rr,cr*or-nr*lr,cr*lr+nr*or,0,cr*or+nr*lr,hr*or+rr,hr*lr-nr*ar,0,cr*lr-nr*or,hr*lr+nr*ar,sr*lr*lr+rr,0,0,0,0,1),this}makeScale(er,tr,rr){return this.set(er,0,0,0,0,tr,0,0,0,0,rr,0,0,0,0,1),this}makeShear(er,tr,rr,nr,sr,ar){return this.set(1,rr,sr,0,er,1,ar,0,tr,nr,1,0,0,0,0,1),this}compose(er,tr,rr){const nr=this.elements,sr=tr._x,ar=tr._y,or=tr._z,lr=tr._w,cr=sr+sr,hr=ar+ar,fr=or+or,ur=sr*cr,pr=sr*hr,gr=sr*fr,_r=ar*hr,mr=ar*fr,dr=or*fr,vr=lr*cr,Ar=lr*hr,yr=lr*fr,wr=rr.x,br=rr.y,Sr=rr.z;return nr[0]=(1-(_r+dr))*wr,nr[1]=(pr+yr)*wr,nr[2]=(gr-Ar)*wr,nr[3]=0,nr[4]=(pr-yr)*br,nr[5]=(1-(ur+dr))*br,nr[6]=(mr+vr)*br,nr[7]=0,nr[8]=(gr+Ar)*Sr,nr[9]=(mr-vr)*Sr,nr[10]=(1-(ur+_r))*Sr,nr[11]=0,nr[12]=er.x,nr[13]=er.y,nr[14]=er.z,nr[15]=1,this}decompose(er,tr,rr){const nr=this.elements;let sr=_v1$5$1.set(nr[0],nr[1],nr[2]).length();const ar=_v1$5$1.set(nr[4],nr[5],nr[6]).length(),or=_v1$5$1.set(nr[8],nr[9],nr[10]).length();this.determinant()<0&&(sr=-sr),er.x=nr[12],er.y=nr[13],er.z=nr[14],_m1$2.copy(this);const cr=1/sr,hr=1/ar,fr=1/or;return _m1$2.elements[0]*=cr,_m1$2.elements[1]*=cr,_m1$2.elements[2]*=cr,_m1$2.elements[4]*=hr,_m1$2.elements[5]*=hr,_m1$2.elements[6]*=hr,_m1$2.elements[8]*=fr,_m1$2.elements[9]*=fr,_m1$2.elements[10]*=fr,tr.setFromRotationMatrix(_m1$2),rr.x=sr,rr.y=ar,rr.z=or,this}makePerspective(er,tr,rr,nr,sr,ar,or=WebGLCoordinateSystem){const lr=this.elements,cr=2*sr/(tr-er),hr=2*sr/(rr-nr),fr=(tr+er)/(tr-er),ur=(rr+nr)/(rr-nr);let pr,gr;if(or===WebGLCoordinateSystem)pr=-(ar+sr)/(ar-sr),gr=-2*ar*sr/(ar-sr);else if(or===WebGPUCoordinateSystem)pr=-ar/(ar-sr),gr=-ar*sr/(ar-sr);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+or);return lr[0]=cr,lr[4]=0,lr[8]=fr,lr[12]=0,lr[1]=0,lr[5]=hr,lr[9]=ur,lr[13]=0,lr[2]=0,lr[6]=0,lr[10]=pr,lr[14]=gr,lr[3]=0,lr[7]=0,lr[11]=-1,lr[15]=0,this}makeOrthographic(er,tr,rr,nr,sr,ar,or=WebGLCoordinateSystem){const lr=this.elements,cr=1/(tr-er),hr=1/(rr-nr),fr=1/(ar-sr),ur=(tr+er)*cr,pr=(rr+nr)*hr;let gr,_r;if(or===WebGLCoordinateSystem)gr=(ar+sr)*fr,_r=-2*fr;else if(or===WebGPUCoordinateSystem)gr=sr*fr,_r=-1*fr;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+or);return lr[0]=2*cr,lr[4]=0,lr[8]=0,lr[12]=-ur,lr[1]=0,lr[5]=2*hr,lr[9]=0,lr[13]=-pr,lr[2]=0,lr[6]=0,lr[10]=_r,lr[14]=-gr,lr[3]=0,lr[7]=0,lr[11]=0,lr[15]=1,this}equals(er){const tr=this.elements,rr=er.elements;for(let nr=0;nr<16;nr++)if(tr[nr]!==rr[nr])return!1;return!0}fromArray(er,tr=0){for(let rr=0;rr<16;rr++)this.elements[rr]=er[rr+tr];return this}toArray(er=[],tr=0){const rr=this.elements;return er[tr]=rr[0],er[tr+1]=rr[1],er[tr+2]=rr[2],er[tr+3]=rr[3],er[tr+4]=rr[4],er[tr+5]=rr[5],er[tr+6]=rr[6],er[tr+7]=rr[7],er[tr+8]=rr[8],er[tr+9]=rr[9],er[tr+10]=rr[10],er[tr+11]=rr[11],er[tr+12]=rr[12],er[tr+13]=rr[13],er[tr+14]=rr[14],er[tr+15]=rr[15],er}}const _v1$5$1=new Vector3$1,_m1$2=new Matrix4,_zero=new Vector3$1(0,0,0),_one=new Vector3$1(1,1,1),_x=new Vector3$1,_y=new Vector3$1,_z=new Vector3$1,_matrix$2$1=new Matrix4,_quaternion$3=new Quaternion$1;class Euler{constructor(er=0,tr=0,rr=0,nr=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=er,this._y=tr,this._z=rr,this._order=nr}get x(){return this._x}set x(er){this._x=er,this._onChangeCallback()}get y(){return this._y}set y(er){this._y=er,this._onChangeCallback()}get z(){return this._z}set z(er){this._z=er,this._onChangeCallback()}get order(){return this._order}set order(er){this._order=er,this._onChangeCallback()}set(er,tr,rr,nr=this._order){return this._x=er,this._y=tr,this._z=rr,this._order=nr,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(er){return this._x=er._x,this._y=er._y,this._z=er._z,this._order=er._order,this._onChangeCallback(),this}setFromRotationMatrix(er,tr=this._order,rr=!0){const nr=er.elements,sr=nr[0],ar=nr[4],or=nr[8],lr=nr[1],cr=nr[5],hr=nr[9],fr=nr[2],ur=nr[6],pr=nr[10];switch(tr){case"XYZ":this._y=Math.asin(clamp(or,-1,1)),Math.abs(or)<.9999999?(this._x=Math.atan2(-hr,pr),this._z=Math.atan2(-ar,sr)):(this._x=Math.atan2(ur,cr),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(hr,-1,1)),Math.abs(hr)<.9999999?(this._y=Math.atan2(or,pr),this._z=Math.atan2(lr,cr)):(this._y=Math.atan2(-fr,sr),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(ur,-1,1)),Math.abs(ur)<.9999999?(this._y=Math.atan2(-fr,pr),this._z=Math.atan2(-ar,cr)):(this._y=0,this._z=Math.atan2(lr,sr));break;case"ZYX":this._y=Math.asin(-clamp(fr,-1,1)),Math.abs(fr)<.9999999?(this._x=Math.atan2(ur,pr),this._z=Math.atan2(lr,sr)):(this._x=0,this._z=Math.atan2(-ar,cr));break;case"YZX":this._z=Math.asin(clamp(lr,-1,1)),Math.abs(lr)<.9999999?(this._x=Math.atan2(-hr,cr),this._y=Math.atan2(-fr,sr)):(this._x=0,this._y=Math.atan2(or,pr));break;case"XZY":this._z=Math.asin(-clamp(ar,-1,1)),Math.abs(ar)<.9999999?(this._x=Math.atan2(ur,cr),this._y=Math.atan2(or,sr)):(this._x=Math.atan2(-hr,pr),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+tr)}return this._order=tr,rr===!0&&this._onChangeCallback(),this}setFromQuaternion(er,tr,rr){return _matrix$2$1.makeRotationFromQuaternion(er),this.setFromRotationMatrix(_matrix$2$1,tr,rr)}setFromVector3(er,tr=this._order){return this.set(er.x,er.y,er.z,tr)}reorder(er){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,er)}equals(er){return er._x===this._x&&er._y===this._y&&er._z===this._z&&er._order===this._order}fromArray(er){return this._x=er[0],this._y=er[1],this._z=er[2],er[3]!==void 0&&(this._order=er[3]),this._onChangeCallback(),this}toArray(er=[],tr=0){return er[tr]=this._x,er[tr+1]=this._y,er[tr+2]=this._z,er[tr+3]=this._order,er}_onChange(er){return this._onChangeCallback=er,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(er){this.mask=(1<<er|0)>>>0}enable(er){this.mask|=1<<er|0}enableAll(){this.mask=-1}toggle(er){this.mask^=1<<er|0}disable(er){this.mask&=~(1<<er|0)}disableAll(){this.mask=0}test(er){return(this.mask&er.mask)!==0}isEnabled(er){return(this.mask&(1<<er|0))!==0}}let _object3DId=0;const _v1$4$1=new Vector3$1,_q1=new Quaternion$1,_m1$1$1=new Matrix4,_target$1=new Vector3$1,_position$3=new Vector3$1,_scale$2$1=new Vector3$1,_quaternion$2$1=new Quaternion$1,_xAxis=new Vector3$1(1,0,0),_yAxis=new Vector3$1(0,1,0),_zAxis=new Vector3$1(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const er=new Vector3$1,tr=new Euler,rr=new Quaternion$1,nr=new Vector3$1(1,1,1);function sr(){rr.setFromEuler(tr,!1)}function ar(){tr.setFromQuaternion(rr,void 0,!1)}tr._onChange(sr),rr._onChange(ar),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:er},rotation:{configurable:!0,enumerable:!0,value:tr},quaternion:{configurable:!0,enumerable:!0,value:rr},scale:{configurable:!0,enumerable:!0,value:nr},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(er){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(er),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(er){return this.quaternion.premultiply(er),this}setRotationFromAxisAngle(er,tr){this.quaternion.setFromAxisAngle(er,tr)}setRotationFromEuler(er){this.quaternion.setFromEuler(er,!0)}setRotationFromMatrix(er){this.quaternion.setFromRotationMatrix(er)}setRotationFromQuaternion(er){this.quaternion.copy(er)}rotateOnAxis(er,tr){return _q1.setFromAxisAngle(er,tr),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(er,tr){return _q1.setFromAxisAngle(er,tr),this.quaternion.premultiply(_q1),this}rotateX(er){return this.rotateOnAxis(_xAxis,er)}rotateY(er){return this.rotateOnAxis(_yAxis,er)}rotateZ(er){return this.rotateOnAxis(_zAxis,er)}translateOnAxis(er,tr){return _v1$4$1.copy(er).applyQuaternion(this.quaternion),this.position.add(_v1$4$1.multiplyScalar(tr)),this}translateX(er){return this.translateOnAxis(_xAxis,er)}translateY(er){return this.translateOnAxis(_yAxis,er)}translateZ(er){return this.translateOnAxis(_zAxis,er)}localToWorld(er){return this.updateWorldMatrix(!0,!1),er.applyMatrix4(this.matrixWorld)}worldToLocal(er){return this.updateWorldMatrix(!0,!1),er.applyMatrix4(_m1$1$1.copy(this.matrixWorld).invert())}lookAt(er,tr,rr){er.isVector3?_target$1.copy(er):_target$1.set(er,tr,rr);const nr=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1$1.lookAt(_position$3,_target$1,this.up):_m1$1$1.lookAt(_target$1,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1$1),nr&&(_m1$1$1.extractRotation(nr.matrixWorld),_q1.setFromRotationMatrix(_m1$1$1),this.quaternion.premultiply(_q1.invert()))}add(er){if(arguments.length>1){for(let tr=0;tr<arguments.length;tr++)this.add(arguments[tr]);return this}return er===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",er),this):(er&&er.isObject3D?(er.removeFromParent(),er.parent=this,this.children.push(er),er.dispatchEvent(_addedEvent),_childaddedEvent.child=er,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",er),this)}remove(er){if(arguments.length>1){for(let rr=0;rr<arguments.length;rr++)this.remove(arguments[rr]);return this}const tr=this.children.indexOf(er);return tr!==-1&&(er.parent=null,this.children.splice(tr,1),er.dispatchEvent(_removedEvent),_childremovedEvent.child=er,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const er=this.parent;return er!==null&&er.remove(this),this}clear(){return this.remove(...this.children)}attach(er){return this.updateWorldMatrix(!0,!1),_m1$1$1.copy(this.matrixWorld).invert(),er.parent!==null&&(er.parent.updateWorldMatrix(!0,!1),_m1$1$1.multiply(er.parent.matrixWorld)),er.applyMatrix4(_m1$1$1),er.removeFromParent(),er.parent=this,this.children.push(er),er.updateWorldMatrix(!1,!0),er.dispatchEvent(_addedEvent),_childaddedEvent.child=er,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(er){return this.getObjectByProperty("id",er)}getObjectByName(er){return this.getObjectByProperty("name",er)}getObjectByProperty(er,tr){if(this[er]===tr)return this;for(let rr=0,nr=this.children.length;rr<nr;rr++){const ar=this.children[rr].getObjectByProperty(er,tr);if(ar!==void 0)return ar}}getObjectsByProperty(er,tr,rr=[]){this[er]===tr&&rr.push(this);const nr=this.children;for(let sr=0,ar=nr.length;sr<ar;sr++)nr[sr].getObjectsByProperty(er,tr,rr);return rr}getWorldPosition(er){return this.updateWorldMatrix(!0,!1),er.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(er){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,er,_scale$2$1),er}getWorldScale(er){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2$1,er),er}getWorldDirection(er){this.updateWorldMatrix(!0,!1);const tr=this.matrixWorld.elements;return er.set(tr[8],tr[9],tr[10]).normalize()}raycast(){}traverse(er){er(this);const tr=this.children;for(let rr=0,nr=tr.length;rr<nr;rr++)tr[rr].traverse(er)}traverseVisible(er){if(this.visible===!1)return;er(this);const tr=this.children;for(let rr=0,nr=tr.length;rr<nr;rr++)tr[rr].traverseVisible(er)}traverseAncestors(er){const tr=this.parent;tr!==null&&(er(tr),tr.traverseAncestors(er))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(er){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||er)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,er=!0);const tr=this.children;for(let rr=0,nr=tr.length;rr<nr;rr++)tr[rr].updateMatrixWorld(er)}updateWorldMatrix(er,tr){const rr=this.parent;if(er===!0&&rr!==null&&rr.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),tr===!0){const nr=this.children;for(let sr=0,ar=nr.length;sr<ar;sr++)nr[sr].updateWorldMatrix(!1,!0)}}toJSON(er){const tr=er===void 0||typeof er=="string",rr={};tr&&(er={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},rr.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const nr={};nr.uuid=this.uuid,nr.type=this.type,this.name!==""&&(nr.name=this.name),this.castShadow===!0&&(nr.castShadow=!0),this.receiveShadow===!0&&(nr.receiveShadow=!0),this.visible===!1&&(nr.visible=!1),this.frustumCulled===!1&&(nr.frustumCulled=!1),this.renderOrder!==0&&(nr.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(nr.userData=this.userData),nr.layers=this.layers.mask,nr.matrix=this.matrix.toArray(),nr.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(nr.matrixAutoUpdate=!1),this.isInstancedMesh&&(nr.type="InstancedMesh",nr.count=this.count,nr.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(nr.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(nr.type="BatchedMesh",nr.perObjectFrustumCulled=this.perObjectFrustumCulled,nr.sortObjects=this.sortObjects,nr.drawRanges=this._drawRanges,nr.reservedRanges=this._reservedRanges,nr.visibility=this._visibility,nr.active=this._active,nr.bounds=this._bounds.map(or=>({boxInitialized:or.boxInitialized,boxMin:or.box.min.toArray(),boxMax:or.box.max.toArray(),sphereInitialized:or.sphereInitialized,sphereRadius:or.sphere.radius,sphereCenter:or.sphere.center.toArray()})),nr.maxInstanceCount=this._maxInstanceCount,nr.maxVertexCount=this._maxVertexCount,nr.maxIndexCount=this._maxIndexCount,nr.geometryInitialized=this._geometryInitialized,nr.geometryCount=this._geometryCount,nr.matricesTexture=this._matricesTexture.toJSON(er),this._colorsTexture!==null&&(nr.colorsTexture=this._colorsTexture.toJSON(er)),this.boundingSphere!==null&&(nr.boundingSphere={center:nr.boundingSphere.center.toArray(),radius:nr.boundingSphere.radius}),this.boundingBox!==null&&(nr.boundingBox={min:nr.boundingBox.min.toArray(),max:nr.boundingBox.max.toArray()}));function sr(or,lr){return or[lr.uuid]===void 0&&(or[lr.uuid]=lr.toJSON(er)),lr.uuid}if(this.isScene)this.background&&(this.background.isColor?nr.background=this.background.toJSON():this.background.isTexture&&(nr.background=this.background.toJSON(er).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(nr.environment=this.environment.toJSON(er).uuid);else if(this.isMesh||this.isLine||this.isPoints){nr.geometry=sr(er.geometries,this.geometry);const or=this.geometry.parameters;if(or!==void 0&&or.shapes!==void 0){const lr=or.shapes;if(Array.isArray(lr))for(let cr=0,hr=lr.length;cr<hr;cr++){const fr=lr[cr];sr(er.shapes,fr)}else sr(er.shapes,lr)}}if(this.isSkinnedMesh&&(nr.bindMode=this.bindMode,nr.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(sr(er.skeletons,this.skeleton),nr.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const or=[];for(let lr=0,cr=this.material.length;lr<cr;lr++)or.push(sr(er.materials,this.material[lr]));nr.material=or}else nr.material=sr(er.materials,this.material);if(this.children.length>0){nr.children=[];for(let or=0;or<this.children.length;or++)nr.children.push(this.children[or].toJSON(er).object)}if(this.animations.length>0){nr.animations=[];for(let or=0;or<this.animations.length;or++){const lr=this.animations[or];nr.animations.push(sr(er.animations,lr))}}if(tr){const or=ar(er.geometries),lr=ar(er.materials),cr=ar(er.textures),hr=ar(er.images),fr=ar(er.shapes),ur=ar(er.skeletons),pr=ar(er.animations),gr=ar(er.nodes);or.length>0&&(rr.geometries=or),lr.length>0&&(rr.materials=lr),cr.length>0&&(rr.textures=cr),hr.length>0&&(rr.images=hr),fr.length>0&&(rr.shapes=fr),ur.length>0&&(rr.skeletons=ur),pr.length>0&&(rr.animations=pr),gr.length>0&&(rr.nodes=gr)}return rr.object=nr,rr;function ar(or){const lr=[];for(const cr in or){const hr=or[cr];delete hr.metadata,lr.push(hr)}return lr}}clone(er){return new this.constructor().copy(this,er)}copy(er,tr=!0){if(this.name=er.name,this.up.copy(er.up),this.position.copy(er.position),this.rotation.order=er.rotation.order,this.quaternion.copy(er.quaternion),this.scale.copy(er.scale),this.matrix.copy(er.matrix),this.matrixWorld.copy(er.matrixWorld),this.matrixAutoUpdate=er.matrixAutoUpdate,this.matrixWorldAutoUpdate=er.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=er.matrixWorldNeedsUpdate,this.layers.mask=er.layers.mask,this.visible=er.visible,this.castShadow=er.castShadow,this.receiveShadow=er.receiveShadow,this.frustumCulled=er.frustumCulled,this.renderOrder=er.renderOrder,this.animations=er.animations.slice(),this.userData=JSON.parse(JSON.stringify(er.userData)),tr===!0)for(let rr=0;rr<er.children.length;rr++){const nr=er.children[rr];this.add(nr.clone())}return this}}Object3D.DEFAULT_UP=new Vector3$1(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3$1,_v1$3$1=new Vector3$1,_v2$2$1=new Vector3$1,_v3$2=new Vector3$1,_vab=new Vector3$1,_vac=new Vector3$1,_vbc=new Vector3$1,_vap=new Vector3$1,_vbp=new Vector3$1,_vcp=new Vector3$1,_v40=new Vector4,_v41=new Vector4,_v42=new Vector4;let Triangle$2=class so{constructor(er=new Vector3$1,tr=new Vector3$1,rr=new Vector3$1){this.a=er,this.b=tr,this.c=rr}static getNormal(er,tr,rr,nr){nr.subVectors(rr,tr),_v0$1.subVectors(er,tr),nr.cross(_v0$1);const sr=nr.lengthSq();return sr>0?nr.multiplyScalar(1/Math.sqrt(sr)):nr.set(0,0,0)}static getBarycoord(er,tr,rr,nr,sr){_v0$1.subVectors(nr,tr),_v1$3$1.subVectors(rr,tr),_v2$2$1.subVectors(er,tr);const ar=_v0$1.dot(_v0$1),or=_v0$1.dot(_v1$3$1),lr=_v0$1.dot(_v2$2$1),cr=_v1$3$1.dot(_v1$3$1),hr=_v1$3$1.dot(_v2$2$1),fr=ar*cr-or*or;if(fr===0)return sr.set(0,0,0),null;const ur=1/fr,pr=(cr*lr-or*hr)*ur,gr=(ar*hr-or*lr)*ur;return sr.set(1-pr-gr,gr,pr)}static containsPoint(er,tr,rr,nr){return this.getBarycoord(er,tr,rr,nr,_v3$2)===null?!1:_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(er,tr,rr,nr,sr,ar,or,lr){return this.getBarycoord(er,tr,rr,nr,_v3$2)===null?(lr.x=0,lr.y=0,"z"in lr&&(lr.z=0),"w"in lr&&(lr.w=0),null):(lr.setScalar(0),lr.addScaledVector(sr,_v3$2.x),lr.addScaledVector(ar,_v3$2.y),lr.addScaledVector(or,_v3$2.z),lr)}static getInterpolatedAttribute(er,tr,rr,nr,sr,ar){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(er,tr),_v41.fromBufferAttribute(er,rr),_v42.fromBufferAttribute(er,nr),ar.setScalar(0),ar.addScaledVector(_v40,sr.x),ar.addScaledVector(_v41,sr.y),ar.addScaledVector(_v42,sr.z),ar}static isFrontFacing(er,tr,rr,nr){return _v0$1.subVectors(rr,tr),_v1$3$1.subVectors(er,tr),_v0$1.cross(_v1$3$1).dot(nr)<0}set(er,tr,rr){return this.a.copy(er),this.b.copy(tr),this.c.copy(rr),this}setFromPointsAndIndices(er,tr,rr,nr){return this.a.copy(er[tr]),this.b.copy(er[rr]),this.c.copy(er[nr]),this}setFromAttributeAndIndices(er,tr,rr,nr){return this.a.fromBufferAttribute(er,tr),this.b.fromBufferAttribute(er,rr),this.c.fromBufferAttribute(er,nr),this}clone(){return new this.constructor().copy(this)}copy(er){return this.a.copy(er.a),this.b.copy(er.b),this.c.copy(er.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3$1.subVectors(this.a,this.b),_v0$1.cross(_v1$3$1).length()*.5}getMidpoint(er){return er.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(er){return so.getNormal(this.a,this.b,this.c,er)}getPlane(er){return er.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(er,tr){return so.getBarycoord(er,this.a,this.b,this.c,tr)}getInterpolation(er,tr,rr,nr,sr){return so.getInterpolation(er,this.a,this.b,this.c,tr,rr,nr,sr)}containsPoint(er){return so.containsPoint(er,this.a,this.b,this.c)}isFrontFacing(er){return so.isFrontFacing(this.a,this.b,this.c,er)}intersectsBox(er){return er.intersectsTriangle(this)}closestPointToPoint(er,tr){const rr=this.a,nr=this.b,sr=this.c;let ar,or;_vab.subVectors(nr,rr),_vac.subVectors(sr,rr),_vap.subVectors(er,rr);const lr=_vab.dot(_vap),cr=_vac.dot(_vap);if(lr<=0&&cr<=0)return tr.copy(rr);_vbp.subVectors(er,nr);const hr=_vab.dot(_vbp),fr=_vac.dot(_vbp);if(hr>=0&&fr<=hr)return tr.copy(nr);const ur=lr*fr-hr*cr;if(ur<=0&&lr>=0&&hr<=0)return ar=lr/(lr-hr),tr.copy(rr).addScaledVector(_vab,ar);_vcp.subVectors(er,sr);const pr=_vab.dot(_vcp),gr=_vac.dot(_vcp);if(gr>=0&&pr<=gr)return tr.copy(sr);const _r=pr*cr-lr*gr;if(_r<=0&&cr>=0&&gr<=0)return or=cr/(cr-gr),tr.copy(rr).addScaledVector(_vac,or);const mr=hr*gr-pr*fr;if(mr<=0&&fr-hr>=0&&pr-gr>=0)return _vbc.subVectors(sr,nr),or=(fr-hr)/(fr-hr+(pr-gr)),tr.copy(nr).addScaledVector(_vbc,or);const dr=1/(mr+_r+ur);return ar=_r*dr,or=ur*dr,tr.copy(rr).addScaledVector(_vab,ar).addScaledVector(_vac,or)}equals(er){return er.a.equals(this.a)&&er.b.equals(this.b)&&er.c.equals(this.c)}};const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(ir,er,tr){return tr<0&&(tr+=1),tr>1&&(tr-=1),tr<1/6?ir+(er-ir)*6*tr:tr<1/2?er:tr<2/3?ir+(er-ir)*6*(2/3-tr):ir}class Color{constructor(er,tr,rr){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(er,tr,rr)}set(er,tr,rr){if(tr===void 0&&rr===void 0){const nr=er;nr&&nr.isColor?this.copy(nr):typeof nr=="number"?this.setHex(nr):typeof nr=="string"&&this.setStyle(nr)}else this.setRGB(er,tr,rr);return this}setScalar(er){return this.r=er,this.g=er,this.b=er,this}setHex(er,tr=SRGBColorSpace){return er=Math.floor(er),this.r=(er>>16&255)/255,this.g=(er>>8&255)/255,this.b=(er&255)/255,ColorManagement.toWorkingColorSpace(this,tr),this}setRGB(er,tr,rr,nr=ColorManagement.workingColorSpace){return this.r=er,this.g=tr,this.b=rr,ColorManagement.toWorkingColorSpace(this,nr),this}setHSL(er,tr,rr,nr=ColorManagement.workingColorSpace){if(er=euclideanModulo(er,1),tr=clamp(tr,0,1),rr=clamp(rr,0,1),tr===0)this.r=this.g=this.b=rr;else{const sr=rr<=.5?rr*(1+tr):rr+tr-rr*tr,ar=2*rr-sr;this.r=hue2rgb(ar,sr,er+1/3),this.g=hue2rgb(ar,sr,er),this.b=hue2rgb(ar,sr,er-1/3)}return ColorManagement.toWorkingColorSpace(this,nr),this}setStyle(er,tr=SRGBColorSpace){function rr(sr){sr!==void 0&&parseFloat(sr)<1&&console.warn("THREE.Color: Alpha component of "+er+" will be ignored.")}let nr;if(nr=/^(\w+)\(([^\)]*)\)/.exec(er)){let sr;const ar=nr[1],or=nr[2];switch(ar){case"rgb":case"rgba":if(sr=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(or))return rr(sr[4]),this.setRGB(Math.min(255,parseInt(sr[1],10))/255,Math.min(255,parseInt(sr[2],10))/255,Math.min(255,parseInt(sr[3],10))/255,tr);if(sr=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(or))return rr(sr[4]),this.setRGB(Math.min(100,parseInt(sr[1],10))/100,Math.min(100,parseInt(sr[2],10))/100,Math.min(100,parseInt(sr[3],10))/100,tr);break;case"hsl":case"hsla":if(sr=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(or))return rr(sr[4]),this.setHSL(parseFloat(sr[1])/360,parseFloat(sr[2])/100,parseFloat(sr[3])/100,tr);break;default:console.warn("THREE.Color: Unknown color model "+er)}}else if(nr=/^\#([A-Fa-f\d]+)$/.exec(er)){const sr=nr[1],ar=sr.length;if(ar===3)return this.setRGB(parseInt(sr.charAt(0),16)/15,parseInt(sr.charAt(1),16)/15,parseInt(sr.charAt(2),16)/15,tr);if(ar===6)return this.setHex(parseInt(sr,16),tr);console.warn("THREE.Color: Invalid hex color "+er)}else if(er&&er.length>0)return this.setColorName(er,tr);return this}setColorName(er,tr=SRGBColorSpace){const rr=_colorKeywords[er.toLowerCase()];return rr!==void 0?this.setHex(rr,tr):console.warn("THREE.Color: Unknown color "+er),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(er){return this.r=er.r,this.g=er.g,this.b=er.b,this}copySRGBToLinear(er){return this.r=SRGBToLinear(er.r),this.g=SRGBToLinear(er.g),this.b=SRGBToLinear(er.b),this}copyLinearToSRGB(er){return this.r=LinearToSRGB(er.r),this.g=LinearToSRGB(er.g),this.b=LinearToSRGB(er.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(er=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color$4.copy(this),er),Math.round(clamp(_color$4.r*255,0,255))*65536+Math.round(clamp(_color$4.g*255,0,255))*256+Math.round(clamp(_color$4.b*255,0,255))}getHexString(er=SRGBColorSpace){return("000000"+this.getHex(er).toString(16)).slice(-6)}getHSL(er,tr=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color$4.copy(this),tr);const rr=_color$4.r,nr=_color$4.g,sr=_color$4.b,ar=Math.max(rr,nr,sr),or=Math.min(rr,nr,sr);let lr,cr;const hr=(or+ar)/2;if(or===ar)lr=0,cr=0;else{const fr=ar-or;switch(cr=hr<=.5?fr/(ar+or):fr/(2-ar-or),ar){case rr:lr=(nr-sr)/fr+(nr<sr?6:0);break;case nr:lr=(sr-rr)/fr+2;break;case sr:lr=(rr-nr)/fr+4;break}lr/=6}return er.h=lr,er.s=cr,er.l=hr,er}getRGB(er,tr=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color$4.copy(this),tr),er.r=_color$4.r,er.g=_color$4.g,er.b=_color$4.b,er}getStyle(er=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color$4.copy(this),er);const tr=_color$4.r,rr=_color$4.g,nr=_color$4.b;return er!==SRGBColorSpace?`color(${er} ${tr.toFixed(3)} ${rr.toFixed(3)} ${nr.toFixed(3)})`:`rgb(${Math.round(tr*255)},${Math.round(rr*255)},${Math.round(nr*255)})`}offsetHSL(er,tr,rr){return this.getHSL(_hslA),this.setHSL(_hslA.h+er,_hslA.s+tr,_hslA.l+rr)}add(er){return this.r+=er.r,this.g+=er.g,this.b+=er.b,this}addColors(er,tr){return this.r=er.r+tr.r,this.g=er.g+tr.g,this.b=er.b+tr.b,this}addScalar(er){return this.r+=er,this.g+=er,this.b+=er,this}sub(er){return this.r=Math.max(0,this.r-er.r),this.g=Math.max(0,this.g-er.g),this.b=Math.max(0,this.b-er.b),this}multiply(er){return this.r*=er.r,this.g*=er.g,this.b*=er.b,this}multiplyScalar(er){return this.r*=er,this.g*=er,this.b*=er,this}lerp(er,tr){return this.r+=(er.r-this.r)*tr,this.g+=(er.g-this.g)*tr,this.b+=(er.b-this.b)*tr,this}lerpColors(er,tr,rr){return this.r=er.r+(tr.r-er.r)*rr,this.g=er.g+(tr.g-er.g)*rr,this.b=er.b+(tr.b-er.b)*rr,this}lerpHSL(er,tr){this.getHSL(_hslA),er.getHSL(_hslB);const rr=lerp$1(_hslA.h,_hslB.h,tr),nr=lerp$1(_hslA.s,_hslB.s,tr),sr=lerp$1(_hslA.l,_hslB.l,tr);return this.setHSL(rr,nr,sr),this}setFromVector3(er){return this.r=er.x,this.g=er.y,this.b=er.z,this}applyMatrix3(er){const tr=this.r,rr=this.g,nr=this.b,sr=er.elements;return this.r=sr[0]*tr+sr[3]*rr+sr[6]*nr,this.g=sr[1]*tr+sr[4]*rr+sr[7]*nr,this.b=sr[2]*tr+sr[5]*rr+sr[8]*nr,this}equals(er){return er.r===this.r&&er.g===this.g&&er.b===this.b}fromArray(er,tr=0){return this.r=er[tr],this.g=er[tr+1],this.b=er[tr+2],this}toArray(er=[],tr=0){return er[tr]=this.r,er[tr+1]=this.g,er[tr+2]=this.b,er}fromBufferAttribute(er,tr){return this.r=er.getX(tr),this.g=er.getY(tr),this.b=er.getZ(tr),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color$4=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(er){this._alphaTest>0!=er>0&&this.version++,this._alphaTest=er}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(er){if(er!==void 0)for(const tr in er){const rr=er[tr];if(rr===void 0){console.warn(`THREE.Material: parameter '${tr}' has value of undefined.`);continue}const nr=this[tr];if(nr===void 0){console.warn(`THREE.Material: '${tr}' is not a property of THREE.${this.type}.`);continue}nr&&nr.isColor?nr.set(rr):nr&&nr.isVector3&&rr&&rr.isVector3?nr.copy(rr):this[tr]=rr}}toJSON(er){const tr=er===void 0||typeof er=="string";tr&&(er={textures:{},images:{}});const rr={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};rr.uuid=this.uuid,rr.type=this.type,this.name!==""&&(rr.name=this.name),this.color&&this.color.isColor&&(rr.color=this.color.getHex()),this.roughness!==void 0&&(rr.roughness=this.roughness),this.metalness!==void 0&&(rr.metalness=this.metalness),this.sheen!==void 0&&(rr.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(rr.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(rr.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(rr.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(rr.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(rr.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(rr.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(rr.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(rr.shininess=this.shininess),this.clearcoat!==void 0&&(rr.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(rr.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(rr.clearcoatMap=this.clearcoatMap.toJSON(er).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(rr.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(er).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(rr.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(er).uuid,rr.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(rr.dispersion=this.dispersion),this.iridescence!==void 0&&(rr.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(rr.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(rr.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(rr.iridescenceMap=this.iridescenceMap.toJSON(er).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(rr.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(er).uuid),this.anisotropy!==void 0&&(rr.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(rr.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(rr.anisotropyMap=this.anisotropyMap.toJSON(er).uuid),this.map&&this.map.isTexture&&(rr.map=this.map.toJSON(er).uuid),this.matcap&&this.matcap.isTexture&&(rr.matcap=this.matcap.toJSON(er).uuid),this.alphaMap&&this.alphaMap.isTexture&&(rr.alphaMap=this.alphaMap.toJSON(er).uuid),this.lightMap&&this.lightMap.isTexture&&(rr.lightMap=this.lightMap.toJSON(er).uuid,rr.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(rr.aoMap=this.aoMap.toJSON(er).uuid,rr.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(rr.bumpMap=this.bumpMap.toJSON(er).uuid,rr.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(rr.normalMap=this.normalMap.toJSON(er).uuid,rr.normalMapType=this.normalMapType,rr.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(rr.displacementMap=this.displacementMap.toJSON(er).uuid,rr.displacementScale=this.displacementScale,rr.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(rr.roughnessMap=this.roughnessMap.toJSON(er).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(rr.metalnessMap=this.metalnessMap.toJSON(er).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(rr.emissiveMap=this.emissiveMap.toJSON(er).uuid),this.specularMap&&this.specularMap.isTexture&&(rr.specularMap=this.specularMap.toJSON(er).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(rr.specularIntensityMap=this.specularIntensityMap.toJSON(er).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(rr.specularColorMap=this.specularColorMap.toJSON(er).uuid),this.envMap&&this.envMap.isTexture&&(rr.envMap=this.envMap.toJSON(er).uuid,this.combine!==void 0&&(rr.combine=this.combine)),this.envMapRotation!==void 0&&(rr.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(rr.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(rr.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(rr.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(rr.gradientMap=this.gradientMap.toJSON(er).uuid),this.transmission!==void 0&&(rr.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(rr.transmissionMap=this.transmissionMap.toJSON(er).uuid),this.thickness!==void 0&&(rr.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(rr.thicknessMap=this.thicknessMap.toJSON(er).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(rr.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(rr.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(rr.size=this.size),this.shadowSide!==null&&(rr.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(rr.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(rr.blending=this.blending),this.side!==FrontSide&&(rr.side=this.side),this.vertexColors===!0&&(rr.vertexColors=!0),this.opacity<1&&(rr.opacity=this.opacity),this.transparent===!0&&(rr.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(rr.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(rr.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(rr.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(rr.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(rr.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(rr.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(rr.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(rr.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(rr.depthFunc=this.depthFunc),this.depthTest===!1&&(rr.depthTest=this.depthTest),this.depthWrite===!1&&(rr.depthWrite=this.depthWrite),this.colorWrite===!1&&(rr.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(rr.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(rr.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(rr.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(rr.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(rr.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(rr.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(rr.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(rr.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(rr.rotation=this.rotation),this.polygonOffset===!0&&(rr.polygonOffset=!0),this.polygonOffsetFactor!==0&&(rr.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(rr.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(rr.linewidth=this.linewidth),this.dashSize!==void 0&&(rr.dashSize=this.dashSize),this.gapSize!==void 0&&(rr.gapSize=this.gapSize),this.scale!==void 0&&(rr.scale=this.scale),this.dithering===!0&&(rr.dithering=!0),this.alphaTest>0&&(rr.alphaTest=this.alphaTest),this.alphaHash===!0&&(rr.alphaHash=!0),this.alphaToCoverage===!0&&(rr.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(rr.premultipliedAlpha=!0),this.forceSinglePass===!0&&(rr.forceSinglePass=!0),this.wireframe===!0&&(rr.wireframe=!0),this.wireframeLinewidth>1&&(rr.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(rr.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(rr.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(rr.flatShading=!0),this.visible===!1&&(rr.visible=!1),this.toneMapped===!1&&(rr.toneMapped=!1),this.fog===!1&&(rr.fog=!1),Object.keys(this.userData).length>0&&(rr.userData=this.userData);function nr(sr){const ar=[];for(const or in sr){const lr=sr[or];delete lr.metadata,ar.push(lr)}return ar}if(tr){const sr=nr(er.textures),ar=nr(er.images);sr.length>0&&(rr.textures=sr),ar.length>0&&(rr.images=ar)}return rr}clone(){return new this.constructor().copy(this)}copy(er){this.name=er.name,this.blending=er.blending,this.side=er.side,this.vertexColors=er.vertexColors,this.opacity=er.opacity,this.transparent=er.transparent,this.blendSrc=er.blendSrc,this.blendDst=er.blendDst,this.blendEquation=er.blendEquation,this.blendSrcAlpha=er.blendSrcAlpha,this.blendDstAlpha=er.blendDstAlpha,this.blendEquationAlpha=er.blendEquationAlpha,this.blendColor.copy(er.blendColor),this.blendAlpha=er.blendAlpha,this.depthFunc=er.depthFunc,this.depthTest=er.depthTest,this.depthWrite=er.depthWrite,this.stencilWriteMask=er.stencilWriteMask,this.stencilFunc=er.stencilFunc,this.stencilRef=er.stencilRef,this.stencilFuncMask=er.stencilFuncMask,this.stencilFail=er.stencilFail,this.stencilZFail=er.stencilZFail,this.stencilZPass=er.stencilZPass,this.stencilWrite=er.stencilWrite;const tr=er.clippingPlanes;let rr=null;if(tr!==null){const nr=tr.length;rr=new Array(nr);for(let sr=0;sr!==nr;++sr)rr[sr]=tr[sr].clone()}return this.clippingPlanes=rr,this.clipIntersection=er.clipIntersection,this.clipShadows=er.clipShadows,this.shadowSide=er.shadowSide,this.colorWrite=er.colorWrite,this.precision=er.precision,this.polygonOffset=er.polygonOffset,this.polygonOffsetFactor=er.polygonOffsetFactor,this.polygonOffsetUnits=er.polygonOffsetUnits,this.dithering=er.dithering,this.alphaTest=er.alphaTest,this.alphaHash=er.alphaHash,this.alphaToCoverage=er.alphaToCoverage,this.premultipliedAlpha=er.premultipliedAlpha,this.forceSinglePass=er.forceSinglePass,this.visible=er.visible,this.toneMapped=er.toneMapped,this.userData=JSON.parse(JSON.stringify(er.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(er){er===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class MeshBasicMaterial extends Material{constructor(er){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.specularMap=er.specularMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.envMapRotation.copy(er.envMapRotation),this.combine=er.combine,this.reflectivity=er.reflectivity,this.refractionRatio=er.refractionRatio,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.fog=er.fog,this}}const _tables=_generateTables();function _generateTables(){const ir=new ArrayBuffer(4),er=new Float32Array(ir),tr=new Uint32Array(ir),rr=new Uint32Array(512),nr=new Uint32Array(512);for(let lr=0;lr<256;++lr){const cr=lr-127;cr<-27?(rr[lr]=0,rr[lr|256]=32768,nr[lr]=24,nr[lr|256]=24):cr<-14?(rr[lr]=1024>>-cr-14,rr[lr|256]=1024>>-cr-14|32768,nr[lr]=-cr-1,nr[lr|256]=-cr-1):cr<=15?(rr[lr]=cr+15<<10,rr[lr|256]=cr+15<<10|32768,nr[lr]=13,nr[lr|256]=13):cr<128?(rr[lr]=31744,rr[lr|256]=64512,nr[lr]=24,nr[lr|256]=24):(rr[lr]=31744,rr[lr|256]=64512,nr[lr]=13,nr[lr|256]=13)}const sr=new Uint32Array(2048),ar=new Uint32Array(64),or=new Uint32Array(64);for(let lr=1;lr<1024;++lr){let cr=lr<<13,hr=0;for(;!(cr&8388608);)cr<<=1,hr-=8388608;cr&=-8388609,hr+=947912704,sr[lr]=cr|hr}for(let lr=1024;lr<2048;++lr)sr[lr]=939524096+(lr-1024<<13);for(let lr=1;lr<31;++lr)ar[lr]=lr<<23;ar[31]=1199570944,ar[32]=2147483648;for(let lr=33;lr<63;++lr)ar[lr]=2147483648+(lr-32<<23);ar[63]=3347054592;for(let lr=1;lr<64;++lr)lr!==32&&(or[lr]=1024);return{floatView:er,uint32View:tr,baseTable:rr,shiftTable:nr,mantissaTable:sr,exponentTable:ar,offsetTable:or}}function toHalfFloat(ir){Math.abs(ir)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),ir=clamp(ir,-65504,65504),_tables.floatView[0]=ir;const er=_tables.uint32View[0],tr=er>>23&511;return _tables.baseTable[tr]+((er&8388607)>>_tables.shiftTable[tr])}function fromHalfFloat(ir){const er=ir>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[er]+(ir&1023)]+_tables.exponentTable[er],_tables.floatView[0]}const DataUtils={toHalfFloat,fromHalfFloat},_vector$9=new Vector3$1,_vector2$1=new Vector2;let _id$2=0;class BufferAttribute{constructor(er,tr,rr=!1){if(Array.isArray(er))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.name="",this.array=er,this.itemSize=tr,this.count=er!==void 0?er.length/tr:0,this.normalized=rr,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(er){er===!0&&this.version++}setUsage(er){return this.usage=er,this}addUpdateRange(er,tr){this.updateRanges.push({start:er,count:tr})}clearUpdateRanges(){this.updateRanges.length=0}copy(er){return this.name=er.name,this.array=new er.array.constructor(er.array),this.itemSize=er.itemSize,this.count=er.count,this.normalized=er.normalized,this.usage=er.usage,this.gpuType=er.gpuType,this}copyAt(er,tr,rr){er*=this.itemSize,rr*=tr.itemSize;for(let nr=0,sr=this.itemSize;nr<sr;nr++)this.array[er+nr]=tr.array[rr+nr];return this}copyArray(er){return this.array.set(er),this}applyMatrix3(er){if(this.itemSize===2)for(let tr=0,rr=this.count;tr<rr;tr++)_vector2$1.fromBufferAttribute(this,tr),_vector2$1.applyMatrix3(er),this.setXY(tr,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let tr=0,rr=this.count;tr<rr;tr++)_vector$9.fromBufferAttribute(this,tr),_vector$9.applyMatrix3(er),this.setXYZ(tr,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(er){for(let tr=0,rr=this.count;tr<rr;tr++)_vector$9.fromBufferAttribute(this,tr),_vector$9.applyMatrix4(er),this.setXYZ(tr,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(er){for(let tr=0,rr=this.count;tr<rr;tr++)_vector$9.fromBufferAttribute(this,tr),_vector$9.applyNormalMatrix(er),this.setXYZ(tr,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(er){for(let tr=0,rr=this.count;tr<rr;tr++)_vector$9.fromBufferAttribute(this,tr),_vector$9.transformDirection(er),this.setXYZ(tr,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(er,tr=0){return this.array.set(er,tr),this}getComponent(er,tr){let rr=this.array[er*this.itemSize+tr];return this.normalized&&(rr=denormalize(rr,this.array)),rr}setComponent(er,tr,rr){return this.normalized&&(rr=normalize(rr,this.array)),this.array[er*this.itemSize+tr]=rr,this}getX(er){let tr=this.array[er*this.itemSize];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setX(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize]=tr,this}getY(er){let tr=this.array[er*this.itemSize+1];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setY(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+1]=tr,this}getZ(er){let tr=this.array[er*this.itemSize+2];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setZ(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+2]=tr,this}getW(er){let tr=this.array[er*this.itemSize+3];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setW(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+3]=tr,this}setXY(er,tr,rr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array)),this.array[er+0]=tr,this.array[er+1]=rr,this}setXYZ(er,tr,rr,nr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array),nr=normalize(nr,this.array)),this.array[er+0]=tr,this.array[er+1]=rr,this.array[er+2]=nr,this}setXYZW(er,tr,rr,nr,sr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array),nr=normalize(nr,this.array),sr=normalize(sr,this.array)),this.array[er+0]=tr,this.array[er+1]=rr,this.array[er+2]=nr,this.array[er+3]=sr,this}onUpload(er){return this.onUploadCallback=er,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const er={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(er.name=this.name),this.usage!==StaticDrawUsage&&(er.usage=this.usage),er}}class Int8BufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Int8Array(er),tr,rr)}}class Uint8BufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Uint8Array(er),tr,rr)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Uint8ClampedArray(er),tr,rr)}}class Int16BufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Int16Array(er),tr,rr)}}class Uint16BufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Uint16Array(er),tr,rr)}}class Int32BufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Int32Array(er),tr,rr)}}class Uint32BufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Uint32Array(er),tr,rr)}}class Float16BufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Uint16Array(er),tr,rr),this.isFloat16BufferAttribute=!0}getX(er){let tr=fromHalfFloat(this.array[er*this.itemSize]);return this.normalized&&(tr=denormalize(tr,this.array)),tr}setX(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize]=toHalfFloat(tr),this}getY(er){let tr=fromHalfFloat(this.array[er*this.itemSize+1]);return this.normalized&&(tr=denormalize(tr,this.array)),tr}setY(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+1]=toHalfFloat(tr),this}getZ(er){let tr=fromHalfFloat(this.array[er*this.itemSize+2]);return this.normalized&&(tr=denormalize(tr,this.array)),tr}setZ(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+2]=toHalfFloat(tr),this}getW(er){let tr=fromHalfFloat(this.array[er*this.itemSize+3]);return this.normalized&&(tr=denormalize(tr,this.array)),tr}setW(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+3]=toHalfFloat(tr),this}setXY(er,tr,rr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array)),this.array[er+0]=toHalfFloat(tr),this.array[er+1]=toHalfFloat(rr),this}setXYZ(er,tr,rr,nr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array),nr=normalize(nr,this.array)),this.array[er+0]=toHalfFloat(tr),this.array[er+1]=toHalfFloat(rr),this.array[er+2]=toHalfFloat(nr),this}setXYZW(er,tr,rr,nr,sr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array),nr=normalize(nr,this.array),sr=normalize(sr,this.array)),this.array[er+0]=toHalfFloat(tr),this.array[er+1]=toHalfFloat(rr),this.array[er+2]=toHalfFloat(nr),this.array[er+3]=toHalfFloat(sr),this}}class Float32BufferAttribute extends BufferAttribute{constructor(er,tr,rr){super(new Float32Array(er),tr,rr)}}let _id$1=0;const _m1$3=new Matrix4,_obj=new Object3D,_offset$2=new Vector3$1,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3$1;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(er){return Array.isArray(er)?this.index=new(arrayNeedsUint32(er)?Uint32BufferAttribute:Uint16BufferAttribute)(er,1):this.index=er,this}setIndirect(er){return this.indirect=er,this}getIndirect(){return this.indirect}getAttribute(er){return this.attributes[er]}setAttribute(er,tr){return this.attributes[er]=tr,this}deleteAttribute(er){return delete this.attributes[er],this}hasAttribute(er){return this.attributes[er]!==void 0}addGroup(er,tr,rr=0){this.groups.push({start:er,count:tr,materialIndex:rr})}clearGroups(){this.groups=[]}setDrawRange(er,tr){this.drawRange.start=er,this.drawRange.count=tr}applyMatrix4(er){const tr=this.attributes.position;tr!==void 0&&(tr.applyMatrix4(er),tr.needsUpdate=!0);const rr=this.attributes.normal;if(rr!==void 0){const sr=new Matrix3().getNormalMatrix(er);rr.applyNormalMatrix(sr),rr.needsUpdate=!0}const nr=this.attributes.tangent;return nr!==void 0&&(nr.transformDirection(er),nr.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(er){return _m1$3.makeRotationFromQuaternion(er),this.applyMatrix4(_m1$3),this}rotateX(er){return _m1$3.makeRotationX(er),this.applyMatrix4(_m1$3),this}rotateY(er){return _m1$3.makeRotationY(er),this.applyMatrix4(_m1$3),this}rotateZ(er){return _m1$3.makeRotationZ(er),this.applyMatrix4(_m1$3),this}translate(er,tr,rr){return _m1$3.makeTranslation(er,tr,rr),this.applyMatrix4(_m1$3),this}scale(er,tr,rr){return _m1$3.makeScale(er,tr,rr),this.applyMatrix4(_m1$3),this}lookAt(er){return _obj.lookAt(er),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset$2).negate(),this.translate(_offset$2.x,_offset$2.y,_offset$2.z),this}setFromPoints(er){const tr=this.getAttribute("position");if(tr===void 0){const rr=[];for(let nr=0,sr=er.length;nr<sr;nr++){const ar=er[nr];rr.push(ar.x,ar.y,ar.z||0)}this.setAttribute("position",new Float32BufferAttribute(rr,3))}else{const rr=Math.min(er.length,tr.count);for(let nr=0;nr<rr;nr++){const sr=er[nr];tr.setXYZ(nr,sr.x,sr.y,sr.z||0)}er.length>tr.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),tr.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const er=this.attributes.position,tr=this.morphAttributes.position;if(er&&er.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3$1(-1/0,-1/0,-1/0),new Vector3$1(1/0,1/0,1/0));return}if(er!==void 0){if(this.boundingBox.setFromBufferAttribute(er),tr)for(let rr=0,nr=tr.length;rr<nr;rr++){const sr=tr[rr];_box$2.setFromBufferAttribute(sr),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const er=this.attributes.position,tr=this.morphAttributes.position;if(er&&er.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3$1,1/0);return}if(er){const rr=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(er),tr)for(let sr=0,ar=tr.length;sr<ar;sr++){const or=tr[sr];_boxMorphTargets.setFromBufferAttribute(or),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(rr);let nr=0;for(let sr=0,ar=er.count;sr<ar;sr++)_vector$8.fromBufferAttribute(er,sr),nr=Math.max(nr,rr.distanceToSquared(_vector$8));if(tr)for(let sr=0,ar=tr.length;sr<ar;sr++){const or=tr[sr],lr=this.morphTargetsRelative;for(let cr=0,hr=or.count;cr<hr;cr++)_vector$8.fromBufferAttribute(or,cr),lr&&(_offset$2.fromBufferAttribute(er,cr),_vector$8.add(_offset$2)),nr=Math.max(nr,rr.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(nr),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const er=this.index,tr=this.attributes;if(er===null||tr.position===void 0||tr.normal===void 0||tr.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const rr=tr.position,nr=tr.normal,sr=tr.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*rr.count),4));const ar=this.getAttribute("tangent"),or=[],lr=[];for(let xr=0;xr<rr.count;xr++)or[xr]=new Vector3$1,lr[xr]=new Vector3$1;const cr=new Vector3$1,hr=new Vector3$1,fr=new Vector3$1,ur=new Vector2,pr=new Vector2,gr=new Vector2,_r=new Vector3$1,mr=new Vector3$1;function dr(xr,Cr,Ir){cr.fromBufferAttribute(rr,xr),hr.fromBufferAttribute(rr,Cr),fr.fromBufferAttribute(rr,Ir),ur.fromBufferAttribute(sr,xr),pr.fromBufferAttribute(sr,Cr),gr.fromBufferAttribute(sr,Ir),hr.sub(cr),fr.sub(cr),pr.sub(ur),gr.sub(ur);const Rr=1/(pr.x*gr.y-gr.x*pr.y);isFinite(Rr)&&(_r.copy(hr).multiplyScalar(gr.y).addScaledVector(fr,-pr.y).multiplyScalar(Rr),mr.copy(fr).multiplyScalar(pr.x).addScaledVector(hr,-gr.x).multiplyScalar(Rr),or[xr].add(_r),or[Cr].add(_r),or[Ir].add(_r),lr[xr].add(mr),lr[Cr].add(mr),lr[Ir].add(mr))}let vr=this.groups;vr.length===0&&(vr=[{start:0,count:er.count}]);for(let xr=0,Cr=vr.length;xr<Cr;++xr){const Ir=vr[xr],Rr=Ir.start,Pr=Ir.count;for(let Fr=Rr,Nr=Rr+Pr;Fr<Nr;Fr+=3)dr(er.getX(Fr+0),er.getX(Fr+1),er.getX(Fr+2))}const Ar=new Vector3$1,yr=new Vector3$1,wr=new Vector3$1,br=new Vector3$1;function Sr(xr){wr.fromBufferAttribute(nr,xr),br.copy(wr);const Cr=or[xr];Ar.copy(Cr),Ar.sub(wr.multiplyScalar(wr.dot(Cr))).normalize(),yr.crossVectors(br,Cr);const Rr=yr.dot(lr[xr])<0?-1:1;ar.setXYZW(xr,Ar.x,Ar.y,Ar.z,Rr)}for(let xr=0,Cr=vr.length;xr<Cr;++xr){const Ir=vr[xr],Rr=Ir.start,Pr=Ir.count;for(let Fr=Rr,Nr=Rr+Pr;Fr<Nr;Fr+=3)Sr(er.getX(Fr+0)),Sr(er.getX(Fr+1)),Sr(er.getX(Fr+2))}}computeVertexNormals(){const er=this.index,tr=this.getAttribute("position");if(tr!==void 0){let rr=this.getAttribute("normal");if(rr===void 0)rr=new BufferAttribute(new Float32Array(tr.count*3),3),this.setAttribute("normal",rr);else for(let ur=0,pr=rr.count;ur<pr;ur++)rr.setXYZ(ur,0,0,0);const nr=new Vector3$1,sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1,hr=new Vector3$1,fr=new Vector3$1;if(er)for(let ur=0,pr=er.count;ur<pr;ur+=3){const gr=er.getX(ur+0),_r=er.getX(ur+1),mr=er.getX(ur+2);nr.fromBufferAttribute(tr,gr),sr.fromBufferAttribute(tr,_r),ar.fromBufferAttribute(tr,mr),hr.subVectors(ar,sr),fr.subVectors(nr,sr),hr.cross(fr),or.fromBufferAttribute(rr,gr),lr.fromBufferAttribute(rr,_r),cr.fromBufferAttribute(rr,mr),or.add(hr),lr.add(hr),cr.add(hr),rr.setXYZ(gr,or.x,or.y,or.z),rr.setXYZ(_r,lr.x,lr.y,lr.z),rr.setXYZ(mr,cr.x,cr.y,cr.z)}else for(let ur=0,pr=tr.count;ur<pr;ur+=3)nr.fromBufferAttribute(tr,ur+0),sr.fromBufferAttribute(tr,ur+1),ar.fromBufferAttribute(tr,ur+2),hr.subVectors(ar,sr),fr.subVectors(nr,sr),hr.cross(fr),rr.setXYZ(ur+0,hr.x,hr.y,hr.z),rr.setXYZ(ur+1,hr.x,hr.y,hr.z),rr.setXYZ(ur+2,hr.x,hr.y,hr.z);this.normalizeNormals(),rr.needsUpdate=!0}}normalizeNormals(){const er=this.attributes.normal;for(let tr=0,rr=er.count;tr<rr;tr++)_vector$8.fromBufferAttribute(er,tr),_vector$8.normalize(),er.setXYZ(tr,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function er(or,lr){const cr=or.array,hr=or.itemSize,fr=or.normalized,ur=new cr.constructor(lr.length*hr);let pr=0,gr=0;for(let _r=0,mr=lr.length;_r<mr;_r++){or.isInterleavedBufferAttribute?pr=lr[_r]*or.data.stride+or.offset:pr=lr[_r]*hr;for(let dr=0;dr<hr;dr++)ur[gr++]=cr[pr++]}return new BufferAttribute(ur,hr,fr)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const tr=new BufferGeometry,rr=this.index.array,nr=this.attributes;for(const or in nr){const lr=nr[or],cr=er(lr,rr);tr.setAttribute(or,cr)}const sr=this.morphAttributes;for(const or in sr){const lr=[],cr=sr[or];for(let hr=0,fr=cr.length;hr<fr;hr++){const ur=cr[hr],pr=er(ur,rr);lr.push(pr)}tr.morphAttributes[or]=lr}tr.morphTargetsRelative=this.morphTargetsRelative;const ar=this.groups;for(let or=0,lr=ar.length;or<lr;or++){const cr=ar[or];tr.addGroup(cr.start,cr.count,cr.materialIndex)}return tr}toJSON(){const er={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(er.uuid=this.uuid,er.type=this.type,this.name!==""&&(er.name=this.name),Object.keys(this.userData).length>0&&(er.userData=this.userData),this.parameters!==void 0){const lr=this.parameters;for(const cr in lr)lr[cr]!==void 0&&(er[cr]=lr[cr]);return er}er.data={attributes:{}};const tr=this.index;tr!==null&&(er.data.index={type:tr.array.constructor.name,array:Array.prototype.slice.call(tr.array)});const rr=this.attributes;for(const lr in rr){const cr=rr[lr];er.data.attributes[lr]=cr.toJSON(er.data)}const nr={};let sr=!1;for(const lr in this.morphAttributes){const cr=this.morphAttributes[lr],hr=[];for(let fr=0,ur=cr.length;fr<ur;fr++){const pr=cr[fr];hr.push(pr.toJSON(er.data))}hr.length>0&&(nr[lr]=hr,sr=!0)}sr&&(er.data.morphAttributes=nr,er.data.morphTargetsRelative=this.morphTargetsRelative);const ar=this.groups;ar.length>0&&(er.data.groups=JSON.parse(JSON.stringify(ar)));const or=this.boundingSphere;return or!==null&&(er.data.boundingSphere={center:or.center.toArray(),radius:or.radius}),er}clone(){return new this.constructor().copy(this)}copy(er){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const tr={};this.name=er.name;const rr=er.index;rr!==null&&this.setIndex(rr.clone(tr));const nr=er.attributes;for(const cr in nr){const hr=nr[cr];this.setAttribute(cr,hr.clone(tr))}const sr=er.morphAttributes;for(const cr in sr){const hr=[],fr=sr[cr];for(let ur=0,pr=fr.length;ur<pr;ur++)hr.push(fr[ur].clone(tr));this.morphAttributes[cr]=hr}this.morphTargetsRelative=er.morphTargetsRelative;const ar=er.groups;for(let cr=0,hr=ar.length;cr<hr;cr++){const fr=ar[cr];this.addGroup(fr.start,fr.count,fr.materialIndex)}const or=er.boundingBox;or!==null&&(this.boundingBox=or.clone());const lr=er.boundingSphere;return lr!==null&&(this.boundingSphere=lr.clone()),this.drawRange.start=er.drawRange.start,this.drawRange.count=er.drawRange.count,this.userData=er.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray$1,_sphere$6=new Sphere,_sphereHitAt=new Vector3$1,_vA$1=new Vector3$1,_vB$1=new Vector3$1,_vC$1=new Vector3$1,_tempA=new Vector3$1,_morphA=new Vector3$1,_intersectionPoint=new Vector3$1,_intersectionPointWorld=new Vector3$1;class Mesh extends Object3D{constructor(er=new BufferGeometry,tr=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=er,this.material=tr,this.updateMorphTargets()}copy(er,tr){return super.copy(er,tr),er.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=er.morphTargetInfluences.slice()),er.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},er.morphTargetDictionary)),this.material=Array.isArray(er.material)?er.material.slice():er.material,this.geometry=er.geometry,this}updateMorphTargets(){const tr=this.geometry.morphAttributes,rr=Object.keys(tr);if(rr.length>0){const nr=tr[rr[0]];if(nr!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let sr=0,ar=nr.length;sr<ar;sr++){const or=nr[sr].name||String(sr);this.morphTargetInfluences.push(0),this.morphTargetDictionary[or]=sr}}}}getVertexPosition(er,tr){const rr=this.geometry,nr=rr.attributes.position,sr=rr.morphAttributes.position,ar=rr.morphTargetsRelative;tr.fromBufferAttribute(nr,er);const or=this.morphTargetInfluences;if(sr&&or){_morphA.set(0,0,0);for(let lr=0,cr=sr.length;lr<cr;lr++){const hr=or[lr],fr=sr[lr];hr!==0&&(_tempA.fromBufferAttribute(fr,er),ar?_morphA.addScaledVector(_tempA,hr):_morphA.addScaledVector(_tempA.sub(tr),hr))}tr.add(_morphA)}return tr}raycast(er,tr){const rr=this.geometry,nr=this.material,sr=this.matrixWorld;nr!==void 0&&(rr.boundingSphere===null&&rr.computeBoundingSphere(),_sphere$6.copy(rr.boundingSphere),_sphere$6.applyMatrix4(sr),_ray$3.copy(er.ray).recast(er.near),!(_sphere$6.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(er.far-er.near)**2))&&(_inverseMatrix$3.copy(sr).invert(),_ray$3.copy(er.ray).applyMatrix4(_inverseMatrix$3),!(rr.boundingBox!==null&&_ray$3.intersectsBox(rr.boundingBox)===!1)&&this._computeIntersections(er,tr,_ray$3)))}_computeIntersections(er,tr,rr){let nr;const sr=this.geometry,ar=this.material,or=sr.index,lr=sr.attributes.position,cr=sr.attributes.uv,hr=sr.attributes.uv1,fr=sr.attributes.normal,ur=sr.groups,pr=sr.drawRange;if(or!==null)if(Array.isArray(ar))for(let gr=0,_r=ur.length;gr<_r;gr++){const mr=ur[gr],dr=ar[mr.materialIndex],vr=Math.max(mr.start,pr.start),Ar=Math.min(or.count,Math.min(mr.start+mr.count,pr.start+pr.count));for(let yr=vr,wr=Ar;yr<wr;yr+=3){const br=or.getX(yr),Sr=or.getX(yr+1),xr=or.getX(yr+2);nr=checkGeometryIntersection(this,dr,er,rr,cr,hr,fr,br,Sr,xr),nr&&(nr.faceIndex=Math.floor(yr/3),nr.face.materialIndex=mr.materialIndex,tr.push(nr))}}else{const gr=Math.max(0,pr.start),_r=Math.min(or.count,pr.start+pr.count);for(let mr=gr,dr=_r;mr<dr;mr+=3){const vr=or.getX(mr),Ar=or.getX(mr+1),yr=or.getX(mr+2);nr=checkGeometryIntersection(this,ar,er,rr,cr,hr,fr,vr,Ar,yr),nr&&(nr.faceIndex=Math.floor(mr/3),tr.push(nr))}}else if(lr!==void 0)if(Array.isArray(ar))for(let gr=0,_r=ur.length;gr<_r;gr++){const mr=ur[gr],dr=ar[mr.materialIndex],vr=Math.max(mr.start,pr.start),Ar=Math.min(lr.count,Math.min(mr.start+mr.count,pr.start+pr.count));for(let yr=vr,wr=Ar;yr<wr;yr+=3){const br=yr,Sr=yr+1,xr=yr+2;nr=checkGeometryIntersection(this,dr,er,rr,cr,hr,fr,br,Sr,xr),nr&&(nr.faceIndex=Math.floor(yr/3),nr.face.materialIndex=mr.materialIndex,tr.push(nr))}}else{const gr=Math.max(0,pr.start),_r=Math.min(lr.count,pr.start+pr.count);for(let mr=gr,dr=_r;mr<dr;mr+=3){const vr=mr,Ar=mr+1,yr=mr+2;nr=checkGeometryIntersection(this,ar,er,rr,cr,hr,fr,vr,Ar,yr),nr&&(nr.faceIndex=Math.floor(mr/3),tr.push(nr))}}}}function checkIntersection$1(ir,er,tr,rr,nr,sr,ar,or){let lr;if(er.side===BackSide?lr=rr.intersectTriangle(ar,sr,nr,!0,or):lr=rr.intersectTriangle(nr,sr,ar,er.side===FrontSide,or),lr===null)return null;_intersectionPointWorld.copy(or),_intersectionPointWorld.applyMatrix4(ir.matrixWorld);const cr=tr.ray.origin.distanceTo(_intersectionPointWorld);return cr<tr.near||cr>tr.far?null:{distance:cr,point:_intersectionPointWorld.clone(),object:ir}}function checkGeometryIntersection(ir,er,tr,rr,nr,sr,ar,or,lr,cr){ir.getVertexPosition(or,_vA$1),ir.getVertexPosition(lr,_vB$1),ir.getVertexPosition(cr,_vC$1);const hr=checkIntersection$1(ir,er,tr,rr,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(hr){const fr=new Vector3$1;Triangle$2.getBarycoord(_intersectionPoint,_vA$1,_vB$1,_vC$1,fr),nr&&(hr.uv=Triangle$2.getInterpolatedAttribute(nr,or,lr,cr,fr,new Vector2)),sr&&(hr.uv1=Triangle$2.getInterpolatedAttribute(sr,or,lr,cr,fr,new Vector2)),ar&&(hr.normal=Triangle$2.getInterpolatedAttribute(ar,or,lr,cr,fr,new Vector3$1),hr.normal.dot(rr.direction)>0&&hr.normal.multiplyScalar(-1));const ur={a:or,b:lr,c:cr,normal:new Vector3$1,materialIndex:0};Triangle$2.getNormal(_vA$1,_vB$1,_vC$1,ur.normal),hr.face=ur,hr.barycoord=fr}return hr}class BoxGeometry extends BufferGeometry{constructor(er=1,tr=1,rr=1,nr=1,sr=1,ar=1){super(),this.type="BoxGeometry",this.parameters={width:er,height:tr,depth:rr,widthSegments:nr,heightSegments:sr,depthSegments:ar};const or=this;nr=Math.floor(nr),sr=Math.floor(sr),ar=Math.floor(ar);const lr=[],cr=[],hr=[],fr=[];let ur=0,pr=0;gr("z","y","x",-1,-1,rr,tr,er,ar,sr,0),gr("z","y","x",1,-1,rr,tr,-er,ar,sr,1),gr("x","z","y",1,1,er,rr,tr,nr,ar,2),gr("x","z","y",1,-1,er,rr,-tr,nr,ar,3),gr("x","y","z",1,-1,er,tr,rr,nr,sr,4),gr("x","y","z",-1,-1,er,tr,-rr,nr,sr,5),this.setIndex(lr),this.setAttribute("position",new Float32BufferAttribute(cr,3)),this.setAttribute("normal",new Float32BufferAttribute(hr,3)),this.setAttribute("uv",new Float32BufferAttribute(fr,2));function gr(_r,mr,dr,vr,Ar,yr,wr,br,Sr,xr,Cr){const Ir=yr/Sr,Rr=wr/xr,Pr=yr/2,Fr=wr/2,Nr=br/2,Ur=Sr+1,Br=xr+1;let Or=0,Dr=0;const Wr=new Vector3$1;for(let $r=0;$r<Br;$r++){const Yr=$r*Rr-Fr;for(let Qi=0;Qi<Ur;Qi++){const rs=Qi*Ir-Pr;Wr[_r]=rs*vr,Wr[mr]=Yr*Ar,Wr[dr]=Nr,cr.push(Wr.x,Wr.y,Wr.z),Wr[_r]=0,Wr[mr]=0,Wr[dr]=br>0?1:-1,hr.push(Wr.x,Wr.y,Wr.z),fr.push(Qi/Sr),fr.push(1-$r/xr),Or+=1}}for(let $r=0;$r<xr;$r++)for(let Yr=0;Yr<Sr;Yr++){const Qi=ur+Yr+Ur*$r,rs=ur+Yr+Ur*($r+1),Kr=ur+(Yr+1)+Ur*($r+1),Qr=ur+(Yr+1)+Ur*$r;lr.push(Qi,rs,Qr),lr.push(rs,Kr,Qr),Dr+=6}or.addGroup(pr,Dr,Cr),pr+=Dr,ur+=Or}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new BoxGeometry(er.width,er.height,er.depth,er.widthSegments,er.heightSegments,er.depthSegments)}}function cloneUniforms(ir){const er={};for(const tr in ir){er[tr]={};for(const rr in ir[tr]){const nr=ir[tr][rr];nr&&(nr.isColor||nr.isMatrix3||nr.isMatrix4||nr.isVector2||nr.isVector3||nr.isVector4||nr.isTexture||nr.isQuaternion)?nr.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),er[tr][rr]=null):er[tr][rr]=nr.clone():Array.isArray(nr)?er[tr][rr]=nr.slice():er[tr][rr]=nr}}return er}function mergeUniforms(ir){const er={};for(let tr=0;tr<ir.length;tr++){const rr=cloneUniforms(ir[tr]);for(const nr in rr)er[nr]=rr[nr]}return er}function cloneUniformsGroups(ir){const er=[];for(let tr=0;tr<ir.length;tr++)er.push(ir[tr].clone());return er}function getUnlitUniformColorSpace(ir){const er=ir.getRenderTarget();return er===null?ir.outputColorSpace:er.isXRRenderTarget===!0?er.texture.colorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(er){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,er!==void 0&&this.setValues(er)}copy(er){return super.copy(er),this.fragmentShader=er.fragmentShader,this.vertexShader=er.vertexShader,this.uniforms=cloneUniforms(er.uniforms),this.uniformsGroups=cloneUniformsGroups(er.uniformsGroups),this.defines=Object.assign({},er.defines),this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.fog=er.fog,this.lights=er.lights,this.clipping=er.clipping,this.extensions=Object.assign({},er.extensions),this.glslVersion=er.glslVersion,this}toJSON(er){const tr=super.toJSON(er);tr.glslVersion=this.glslVersion,tr.uniforms={};for(const nr in this.uniforms){const ar=this.uniforms[nr].value;ar&&ar.isTexture?tr.uniforms[nr]={type:"t",value:ar.toJSON(er).uuid}:ar&&ar.isColor?tr.uniforms[nr]={type:"c",value:ar.getHex()}:ar&&ar.isVector2?tr.uniforms[nr]={type:"v2",value:ar.toArray()}:ar&&ar.isVector3?tr.uniforms[nr]={type:"v3",value:ar.toArray()}:ar&&ar.isVector4?tr.uniforms[nr]={type:"v4",value:ar.toArray()}:ar&&ar.isMatrix3?tr.uniforms[nr]={type:"m3",value:ar.toArray()}:ar&&ar.isMatrix4?tr.uniforms[nr]={type:"m4",value:ar.toArray()}:tr.uniforms[nr]={value:ar}}Object.keys(this.defines).length>0&&(tr.defines=this.defines),tr.vertexShader=this.vertexShader,tr.fragmentShader=this.fragmentShader,tr.lights=this.lights,tr.clipping=this.clipping;const rr={};for(const nr in this.extensions)this.extensions[nr]===!0&&(rr[nr]=!0);return Object.keys(rr).length>0&&(tr.extensions=rr),tr}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(er,tr){return super.copy(er,tr),this.matrixWorldInverse.copy(er.matrixWorldInverse),this.projectionMatrix.copy(er.projectionMatrix),this.projectionMatrixInverse.copy(er.projectionMatrixInverse),this.coordinateSystem=er.coordinateSystem,this}getWorldDirection(er){return super.getWorldDirection(er).negate()}updateMatrixWorld(er){super.updateMatrixWorld(er),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(er,tr){super.updateWorldMatrix(er,tr),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v3$1=new Vector3$1,_minTarget=new Vector2,_maxTarget=new Vector2;class PerspectiveCamera extends Camera{constructor(er=50,tr=1,rr=.1,nr=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=er,this.zoom=1,this.near=rr,this.far=nr,this.focus=10,this.aspect=tr,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(er,tr){return super.copy(er,tr),this.fov=er.fov,this.zoom=er.zoom,this.near=er.near,this.far=er.far,this.focus=er.focus,this.aspect=er.aspect,this.view=er.view===null?null:Object.assign({},er.view),this.filmGauge=er.filmGauge,this.filmOffset=er.filmOffset,this}setFocalLength(er){const tr=.5*this.getFilmHeight()/er;this.fov=RAD2DEG*2*Math.atan(tr),this.updateProjectionMatrix()}getFocalLength(){const er=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/er}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(er,tr,rr){_v3$1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),tr.set(_v3$1.x,_v3$1.y).multiplyScalar(-er/_v3$1.z),_v3$1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),rr.set(_v3$1.x,_v3$1.y).multiplyScalar(-er/_v3$1.z)}getViewSize(er,tr){return this.getViewBounds(er,_minTarget,_maxTarget),tr.subVectors(_maxTarget,_minTarget)}setViewOffset(er,tr,rr,nr,sr,ar){this.aspect=er/tr,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=er,this.view.fullHeight=tr,this.view.offsetX=rr,this.view.offsetY=nr,this.view.width=sr,this.view.height=ar,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const er=this.near;let tr=er*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,rr=2*tr,nr=this.aspect*rr,sr=-.5*nr;const ar=this.view;if(this.view!==null&&this.view.enabled){const lr=ar.fullWidth,cr=ar.fullHeight;sr+=ar.offsetX*nr/lr,tr-=ar.offsetY*rr/cr,nr*=ar.width/lr,rr*=ar.height/cr}const or=this.filmOffset;or!==0&&(sr+=er*or/this.getFilmWidth()),this.projectionMatrix.makePerspective(sr,sr+nr,tr,tr-rr,er,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(er){const tr=super.toJSON(er);return tr.object.fov=this.fov,tr.object.zoom=this.zoom,tr.object.near=this.near,tr.object.far=this.far,tr.object.focus=this.focus,tr.object.aspect=this.aspect,this.view!==null&&(tr.object.view=Object.assign({},this.view)),tr.object.filmGauge=this.filmGauge,tr.object.filmOffset=this.filmOffset,tr}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(er,tr,rr){super(),this.type="CubeCamera",this.renderTarget=rr,this.coordinateSystem=null,this.activeMipmapLevel=0;const nr=new PerspectiveCamera(fov,aspect,er,tr);nr.layers=this.layers,this.add(nr);const sr=new PerspectiveCamera(fov,aspect,er,tr);sr.layers=this.layers,this.add(sr);const ar=new PerspectiveCamera(fov,aspect,er,tr);ar.layers=this.layers,this.add(ar);const or=new PerspectiveCamera(fov,aspect,er,tr);or.layers=this.layers,this.add(or);const lr=new PerspectiveCamera(fov,aspect,er,tr);lr.layers=this.layers,this.add(lr);const cr=new PerspectiveCamera(fov,aspect,er,tr);cr.layers=this.layers,this.add(cr)}updateCoordinateSystem(){const er=this.coordinateSystem,tr=this.children.concat(),[rr,nr,sr,ar,or,lr]=tr;for(const cr of tr)this.remove(cr);if(er===WebGLCoordinateSystem)rr.up.set(0,1,0),rr.lookAt(1,0,0),nr.up.set(0,1,0),nr.lookAt(-1,0,0),sr.up.set(0,0,-1),sr.lookAt(0,1,0),ar.up.set(0,0,1),ar.lookAt(0,-1,0),or.up.set(0,1,0),or.lookAt(0,0,1),lr.up.set(0,1,0),lr.lookAt(0,0,-1);else if(er===WebGPUCoordinateSystem)rr.up.set(0,-1,0),rr.lookAt(-1,0,0),nr.up.set(0,-1,0),nr.lookAt(1,0,0),sr.up.set(0,0,1),sr.lookAt(0,1,0),ar.up.set(0,0,-1),ar.lookAt(0,-1,0),or.up.set(0,-1,0),or.lookAt(0,0,1),lr.up.set(0,-1,0),lr.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+er);for(const cr of tr)this.add(cr),cr.updateMatrixWorld()}update(er,tr){this.parent===null&&this.updateMatrixWorld();const{renderTarget:rr,activeMipmapLevel:nr}=this;this.coordinateSystem!==er.coordinateSystem&&(this.coordinateSystem=er.coordinateSystem,this.updateCoordinateSystem());const[sr,ar,or,lr,cr,hr]=this.children,fr=er.getRenderTarget(),ur=er.getActiveCubeFace(),pr=er.getActiveMipmapLevel(),gr=er.xr.enabled;er.xr.enabled=!1;const _r=rr.texture.generateMipmaps;rr.texture.generateMipmaps=!1,er.setRenderTarget(rr,0,nr),er.render(tr,sr),er.setRenderTarget(rr,1,nr),er.render(tr,ar),er.setRenderTarget(rr,2,nr),er.render(tr,or),er.setRenderTarget(rr,3,nr),er.render(tr,lr),er.setRenderTarget(rr,4,nr),er.render(tr,cr),rr.texture.generateMipmaps=_r,er.setRenderTarget(rr,5,nr),er.render(tr,hr),er.setRenderTarget(fr,ur,pr),er.xr.enabled=gr,rr.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(er,tr,rr,nr,sr,ar,or,lr,cr,hr){er=er!==void 0?er:[],tr=tr!==void 0?tr:CubeReflectionMapping,super(er,tr,rr,nr,sr,ar,or,lr,cr,hr),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(er){this.image=er}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(er=1,tr={}){super(er,er,tr),this.isWebGLCubeRenderTarget=!0;const rr={width:er,height:er,depth:1},nr=[rr,rr,rr,rr,rr,rr];this.texture=new CubeTexture(nr,tr.mapping,tr.wrapS,tr.wrapT,tr.magFilter,tr.minFilter,tr.format,tr.type,tr.anisotropy,tr.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=tr.generateMipmaps!==void 0?tr.generateMipmaps:!1,this.texture.minFilter=tr.minFilter!==void 0?tr.minFilter:LinearFilter}fromEquirectangularTexture(er,tr){this.texture.type=tr.type,this.texture.colorSpace=tr.colorSpace,this.texture.generateMipmaps=tr.generateMipmaps,this.texture.minFilter=tr.minFilter,this.texture.magFilter=tr.magFilter;const rr={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},nr=new BoxGeometry(5,5,5),sr=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(rr.uniforms),vertexShader:rr.vertexShader,fragmentShader:rr.fragmentShader,side:BackSide,blending:NoBlending});sr.uniforms.tEquirect.value=tr;const ar=new Mesh(nr,sr),or=tr.minFilter;return tr.minFilter===LinearMipmapLinearFilter&&(tr.minFilter=LinearFilter),new CubeCamera(1,10,this).update(er,ar),tr.minFilter=or,ar.geometry.dispose(),ar.material.dispose(),this}clear(er,tr,rr,nr){const sr=er.getRenderTarget();for(let ar=0;ar<6;ar++)er.setRenderTarget(this,ar),er.clear(tr,rr,nr);er.setRenderTarget(sr)}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3$1,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3$1),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3$1,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3$1),this._grip}dispatchEvent(er){return this._targetRay!==null&&this._targetRay.dispatchEvent(er),this._grip!==null&&this._grip.dispatchEvent(er),this._hand!==null&&this._hand.dispatchEvent(er),this}connect(er){if(er&&er.hand){const tr=this._hand;if(tr)for(const rr of er.hand.values())this._getHandJoint(tr,rr)}return this.dispatchEvent({type:"connected",data:er}),this}disconnect(er){return this.dispatchEvent({type:"disconnected",data:er}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(er,tr,rr){let nr=null,sr=null,ar=null;const or=this._targetRay,lr=this._grip,cr=this._hand;if(er&&tr.session.visibilityState!=="visible-blurred"){if(cr&&er.hand){ar=!0;for(const _r of er.hand.values()){const mr=tr.getJointPose(_r,rr),dr=this._getHandJoint(cr,_r);mr!==null&&(dr.matrix.fromArray(mr.transform.matrix),dr.matrix.decompose(dr.position,dr.rotation,dr.scale),dr.matrixWorldNeedsUpdate=!0,dr.jointRadius=mr.radius),dr.visible=mr!==null}const hr=cr.joints["index-finger-tip"],fr=cr.joints["thumb-tip"],ur=hr.position.distanceTo(fr.position),pr=.02,gr=.005;cr.inputState.pinching&&ur>pr+gr?(cr.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:er.handedness,target:this})):!cr.inputState.pinching&&ur<=pr-gr&&(cr.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:er.handedness,target:this}))}else lr!==null&&er.gripSpace&&(sr=tr.getPose(er.gripSpace,rr),sr!==null&&(lr.matrix.fromArray(sr.transform.matrix),lr.matrix.decompose(lr.position,lr.rotation,lr.scale),lr.matrixWorldNeedsUpdate=!0,sr.linearVelocity?(lr.hasLinearVelocity=!0,lr.linearVelocity.copy(sr.linearVelocity)):lr.hasLinearVelocity=!1,sr.angularVelocity?(lr.hasAngularVelocity=!0,lr.angularVelocity.copy(sr.angularVelocity)):lr.hasAngularVelocity=!1));or!==null&&(nr=tr.getPose(er.targetRaySpace,rr),nr===null&&sr!==null&&(nr=sr),nr!==null&&(or.matrix.fromArray(nr.transform.matrix),or.matrix.decompose(or.position,or.rotation,or.scale),or.matrixWorldNeedsUpdate=!0,nr.linearVelocity?(or.hasLinearVelocity=!0,or.linearVelocity.copy(nr.linearVelocity)):or.hasLinearVelocity=!1,nr.angularVelocity?(or.hasAngularVelocity=!0,or.angularVelocity.copy(nr.angularVelocity)):or.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return or!==null&&(or.visible=nr!==null),lr!==null&&(lr.visible=sr!==null),cr!==null&&(cr.visible=ar!==null),this}_getHandJoint(er,tr){if(er.joints[tr.jointName]===void 0){const rr=new Group;rr.matrixAutoUpdate=!1,rr.visible=!1,er.joints[tr.jointName]=rr,er.add(rr)}return er.joints[tr.jointName]}}class FogExp2{constructor(er,tr=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(er),this.density=tr}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fog{constructor(er,tr=1,rr=1e3){this.isFog=!0,this.name="",this.color=new Color(er),this.near=tr,this.far=rr}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(er,tr){return super.copy(er,tr),er.background!==null&&(this.background=er.background.clone()),er.environment!==null&&(this.environment=er.environment.clone()),er.fog!==null&&(this.fog=er.fog.clone()),this.backgroundBlurriness=er.backgroundBlurriness,this.backgroundIntensity=er.backgroundIntensity,this.backgroundRotation.copy(er.backgroundRotation),this.environmentIntensity=er.environmentIntensity,this.environmentRotation.copy(er.environmentRotation),er.overrideMaterial!==null&&(this.overrideMaterial=er.overrideMaterial.clone()),this.matrixAutoUpdate=er.matrixAutoUpdate,this}toJSON(er){const tr=super.toJSON(er);return this.fog!==null&&(tr.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(tr.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(tr.object.backgroundIntensity=this.backgroundIntensity),tr.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(tr.object.environmentIntensity=this.environmentIntensity),tr.object.environmentRotation=this.environmentRotation.toArray(),tr}}class InterleavedBuffer{constructor(er,tr){this.isInterleavedBuffer=!0,this.array=er,this.stride=tr,this.count=er!==void 0?er.length/tr:0,this.usage=StaticDrawUsage,this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(er){er===!0&&this.version++}setUsage(er){return this.usage=er,this}addUpdateRange(er,tr){this.updateRanges.push({start:er,count:tr})}clearUpdateRanges(){this.updateRanges.length=0}copy(er){return this.array=new er.array.constructor(er.array),this.count=er.count,this.stride=er.stride,this.usage=er.usage,this}copyAt(er,tr,rr){er*=this.stride,rr*=tr.stride;for(let nr=0,sr=this.stride;nr<sr;nr++)this.array[er+nr]=tr.array[rr+nr];return this}set(er,tr=0){return this.array.set(er,tr),this}clone(er){er.arrayBuffers===void 0&&(er.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),er.arrayBuffers[this.array.buffer._uuid]===void 0&&(er.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const tr=new this.array.constructor(er.arrayBuffers[this.array.buffer._uuid]),rr=new this.constructor(tr,this.stride);return rr.setUsage(this.usage),rr}onUpload(er){return this.onUploadCallback=er,this}toJSON(er){return er.arrayBuffers===void 0&&(er.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),er.arrayBuffers[this.array.buffer._uuid]===void 0&&(er.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$7=new Vector3$1;class InterleavedBufferAttribute{constructor(er,tr,rr,nr=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=er,this.itemSize=tr,this.offset=rr,this.normalized=nr}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(er){this.data.needsUpdate=er}applyMatrix4(er){for(let tr=0,rr=this.data.count;tr<rr;tr++)_vector$7.fromBufferAttribute(this,tr),_vector$7.applyMatrix4(er),this.setXYZ(tr,_vector$7.x,_vector$7.y,_vector$7.z);return this}applyNormalMatrix(er){for(let tr=0,rr=this.count;tr<rr;tr++)_vector$7.fromBufferAttribute(this,tr),_vector$7.applyNormalMatrix(er),this.setXYZ(tr,_vector$7.x,_vector$7.y,_vector$7.z);return this}transformDirection(er){for(let tr=0,rr=this.count;tr<rr;tr++)_vector$7.fromBufferAttribute(this,tr),_vector$7.transformDirection(er),this.setXYZ(tr,_vector$7.x,_vector$7.y,_vector$7.z);return this}getComponent(er,tr){let rr=this.array[er*this.data.stride+this.offset+tr];return this.normalized&&(rr=denormalize(rr,this.array)),rr}setComponent(er,tr,rr){return this.normalized&&(rr=normalize(rr,this.array)),this.data.array[er*this.data.stride+this.offset+tr]=rr,this}setX(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.data.array[er*this.data.stride+this.offset]=tr,this}setY(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.data.array[er*this.data.stride+this.offset+1]=tr,this}setZ(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.data.array[er*this.data.stride+this.offset+2]=tr,this}setW(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.data.array[er*this.data.stride+this.offset+3]=tr,this}getX(er){let tr=this.data.array[er*this.data.stride+this.offset];return this.normalized&&(tr=denormalize(tr,this.array)),tr}getY(er){let tr=this.data.array[er*this.data.stride+this.offset+1];return this.normalized&&(tr=denormalize(tr,this.array)),tr}getZ(er){let tr=this.data.array[er*this.data.stride+this.offset+2];return this.normalized&&(tr=denormalize(tr,this.array)),tr}getW(er){let tr=this.data.array[er*this.data.stride+this.offset+3];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setXY(er,tr,rr){return er=er*this.data.stride+this.offset,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array)),this.data.array[er+0]=tr,this.data.array[er+1]=rr,this}setXYZ(er,tr,rr,nr){return er=er*this.data.stride+this.offset,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array),nr=normalize(nr,this.array)),this.data.array[er+0]=tr,this.data.array[er+1]=rr,this.data.array[er+2]=nr,this}setXYZW(er,tr,rr,nr,sr){return er=er*this.data.stride+this.offset,this.normalized&&(tr=normalize(tr,this.array),rr=normalize(rr,this.array),nr=normalize(nr,this.array),sr=normalize(sr,this.array)),this.data.array[er+0]=tr,this.data.array[er+1]=rr,this.data.array[er+2]=nr,this.data.array[er+3]=sr,this}clone(er){if(er===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const tr=[];for(let rr=0;rr<this.count;rr++){const nr=rr*this.data.stride+this.offset;for(let sr=0;sr<this.itemSize;sr++)tr.push(this.data.array[nr+sr])}return new BufferAttribute(new this.array.constructor(tr),this.itemSize,this.normalized)}else return er.interleavedBuffers===void 0&&(er.interleavedBuffers={}),er.interleavedBuffers[this.data.uuid]===void 0&&(er.interleavedBuffers[this.data.uuid]=this.data.clone(er)),new InterleavedBufferAttribute(er.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(er){if(er===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const tr=[];for(let rr=0;rr<this.count;rr++){const nr=rr*this.data.stride+this.offset;for(let sr=0;sr<this.itemSize;sr++)tr.push(this.data.array[nr+sr])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:tr,normalized:this.normalized}}else return er.interleavedBuffers===void 0&&(er.interleavedBuffers={}),er.interleavedBuffers[this.data.uuid]===void 0&&(er.interleavedBuffers[this.data.uuid]=this.data.toJSON(er)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(er){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.alphaMap=er.alphaMap,this.rotation=er.rotation,this.sizeAttenuation=er.sizeAttenuation,this.fog=er.fog,this}}let _geometry$1;const _intersectPoint=new Vector3$1,_worldScale=new Vector3$1,_mvPosition=new Vector3$1,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA$2=new Vector3$1,_vB$2=new Vector3$1,_vC$2=new Vector3$1,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(er=new SpriteMaterial){if(super(),this.isSprite=!0,this.type="Sprite",_geometry$1===void 0){_geometry$1=new BufferGeometry;const tr=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),rr=new InterleavedBuffer(tr,5);_geometry$1.setIndex([0,1,2,0,2,3]),_geometry$1.setAttribute("position",new InterleavedBufferAttribute(rr,3,0,!1)),_geometry$1.setAttribute("uv",new InterleavedBufferAttribute(rr,2,3,!1))}this.geometry=_geometry$1,this.material=er,this.center=new Vector2(.5,.5)}raycast(er,tr){er.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(er.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(er.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),er.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const rr=this.material.rotation;let nr,sr;rr!==0&&(sr=Math.cos(rr),nr=Math.sin(rr));const ar=this.center;transformVertex(_vA$2.set(-.5,-.5,0),_mvPosition,ar,_worldScale,nr,sr),transformVertex(_vB$2.set(.5,-.5,0),_mvPosition,ar,_worldScale,nr,sr),transformVertex(_vC$2.set(.5,.5,0),_mvPosition,ar,_worldScale,nr,sr),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let or=er.ray.intersectTriangle(_vA$2,_vB$2,_vC$2,!1,_intersectPoint);if(or===null&&(transformVertex(_vB$2.set(-.5,.5,0),_mvPosition,ar,_worldScale,nr,sr),_uvB.set(0,1),or=er.ray.intersectTriangle(_vA$2,_vC$2,_vB$2,!1,_intersectPoint),or===null))return;const lr=er.ray.origin.distanceTo(_intersectPoint);lr<er.near||lr>er.far||tr.push({distance:lr,point:_intersectPoint.clone(),uv:Triangle$2.getInterpolation(_intersectPoint,_vA$2,_vB$2,_vC$2,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(er,tr){return super.copy(er,tr),er.center!==void 0&&this.center.copy(er.center),this.material=er.material,this}}function transformVertex(ir,er,tr,rr,nr,sr){_alignedPosition.subVectors(ir,tr).addScalar(.5).multiply(rr),nr!==void 0?(_rotatedPosition.x=sr*_alignedPosition.x-nr*_alignedPosition.y,_rotatedPosition.y=nr*_alignedPosition.x+sr*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),ir.copy(er),ir.x+=_rotatedPosition.x,ir.y+=_rotatedPosition.y,ir.applyMatrix4(_viewWorldMatrix)}const _v1$2$1=new Vector3$1,_v2$1$1=new Vector3$1;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(er){super.copy(er,!1);const tr=er.levels;for(let rr=0,nr=tr.length;rr<nr;rr++){const sr=tr[rr];this.addLevel(sr.object.clone(),sr.distance,sr.hysteresis)}return this.autoUpdate=er.autoUpdate,this}addLevel(er,tr=0,rr=0){tr=Math.abs(tr);const nr=this.levels;let sr;for(sr=0;sr<nr.length&&!(tr<nr[sr].distance);sr++);return nr.splice(sr,0,{distance:tr,hysteresis:rr,object:er}),this.add(er),this}removeLevel(er){const tr=this.levels;for(let rr=0;rr<tr.length;rr++)if(tr[rr].distance===er){const nr=tr.splice(rr,1);return this.remove(nr[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(er){const tr=this.levels;if(tr.length>0){let rr,nr;for(rr=1,nr=tr.length;rr<nr;rr++){let sr=tr[rr].distance;if(tr[rr].object.visible&&(sr-=sr*tr[rr].hysteresis),er<sr)break}return tr[rr-1].object}return null}raycast(er,tr){if(this.levels.length>0){_v1$2$1.setFromMatrixPosition(this.matrixWorld);const nr=er.ray.origin.distanceTo(_v1$2$1);this.getObjectForDistance(nr).raycast(er,tr)}}update(er){const tr=this.levels;if(tr.length>1){_v1$2$1.setFromMatrixPosition(er.matrixWorld),_v2$1$1.setFromMatrixPosition(this.matrixWorld);const rr=_v1$2$1.distanceTo(_v2$1$1)/er.zoom;tr[0].object.visible=!0;let nr,sr;for(nr=1,sr=tr.length;nr<sr;nr++){let ar=tr[nr].distance;if(tr[nr].object.visible&&(ar-=ar*tr[nr].hysteresis),rr>=ar)tr[nr-1].object.visible=!1,tr[nr].object.visible=!0;else break}for(this._currentLevel=nr-1;nr<sr;nr++)tr[nr].object.visible=!1}}toJSON(er){const tr=super.toJSON(er);this.autoUpdate===!1&&(tr.object.autoUpdate=!1),tr.object.levels=[];const rr=this.levels;for(let nr=0,sr=rr.length;nr<sr;nr++){const ar=rr[nr];tr.object.levels.push({object:ar.object.uuid,distance:ar.distance,hysteresis:ar.hysteresis})}return tr}}const _basePosition=new Vector3$1,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3$1,_matrix4=new Matrix4,_vertex=new Vector3$1,_sphere$5=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2$1=new Ray$1;class SkinnedMesh extends Mesh{constructor(er,tr){super(er,tr),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const er=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const tr=er.getAttribute("position");for(let rr=0;rr<tr.count;rr++)this.getVertexPosition(rr,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const er=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const tr=er.getAttribute("position");for(let rr=0;rr<tr.count;rr++)this.getVertexPosition(rr,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(er,tr){return super.copy(er,tr),this.bindMode=er.bindMode,this.bindMatrix.copy(er.bindMatrix),this.bindMatrixInverse.copy(er.bindMatrixInverse),this.skeleton=er.skeleton,er.boundingBox!==null&&(this.boundingBox=er.boundingBox.clone()),er.boundingSphere!==null&&(this.boundingSphere=er.boundingSphere.clone()),this}raycast(er,tr){const rr=this.material,nr=this.matrixWorld;rr!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$5.copy(this.boundingSphere),_sphere$5.applyMatrix4(nr),er.ray.intersectsSphere(_sphere$5)!==!1&&(_inverseMatrix$2.copy(nr).invert(),_ray$2$1.copy(er.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2$1.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(er,tr,_ray$2$1)))}getVertexPosition(er,tr){return super.getVertexPosition(er,tr),this.applyBoneTransform(er,tr),tr}bind(er,tr){this.skeleton=er,tr===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),tr=this.matrixWorld),this.bindMatrix.copy(tr),this.bindMatrixInverse.copy(tr).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const er=new Vector4,tr=this.geometry.attributes.skinWeight;for(let rr=0,nr=tr.count;rr<nr;rr++){er.fromBufferAttribute(tr,rr);const sr=1/er.manhattanLength();sr!==1/0?er.multiplyScalar(sr):er.set(1,0,0,0),tr.setXYZW(rr,er.x,er.y,er.z,er.w)}}updateMatrixWorld(er){super.updateMatrixWorld(er),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(er,tr){const rr=this.skeleton,nr=this.geometry;_skinIndex.fromBufferAttribute(nr.attributes.skinIndex,er),_skinWeight.fromBufferAttribute(nr.attributes.skinWeight,er),_basePosition.copy(tr).applyMatrix4(this.bindMatrix),tr.set(0,0,0);for(let sr=0;sr<4;sr++){const ar=_skinWeight.getComponent(sr);if(ar!==0){const or=_skinIndex.getComponent(sr);_matrix4.multiplyMatrices(rr.bones[or].matrixWorld,rr.boneInverses[or]),tr.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),ar)}}return tr.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(er=null,tr=1,rr=1,nr,sr,ar,or,lr,cr=NearestFilter,hr=NearestFilter,fr,ur){super(null,ar,or,lr,cr,hr,nr,sr,fr,ur),this.isDataTexture=!0,this.image={data:er,width:tr,height:rr},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix$1=new Matrix4;class Skeleton{constructor(er=[],tr=[]){this.uuid=generateUUID(),this.bones=er.slice(0),this.boneInverses=tr,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const er=this.bones,tr=this.boneInverses;if(this.boneMatrices=new Float32Array(er.length*16),tr.length===0)this.calculateInverses();else if(er.length!==tr.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let rr=0,nr=this.bones.length;rr<nr;rr++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let er=0,tr=this.bones.length;er<tr;er++){const rr=new Matrix4;this.bones[er]&&rr.copy(this.bones[er].matrixWorld).invert(),this.boneInverses.push(rr)}}pose(){for(let er=0,tr=this.bones.length;er<tr;er++){const rr=this.bones[er];rr&&rr.matrixWorld.copy(this.boneInverses[er]).invert()}for(let er=0,tr=this.bones.length;er<tr;er++){const rr=this.bones[er];rr&&(rr.parent&&rr.parent.isBone?(rr.matrix.copy(rr.parent.matrixWorld).invert(),rr.matrix.multiply(rr.matrixWorld)):rr.matrix.copy(rr.matrixWorld),rr.matrix.decompose(rr.position,rr.quaternion,rr.scale))}}update(){const er=this.bones,tr=this.boneInverses,rr=this.boneMatrices,nr=this.boneTexture;for(let sr=0,ar=er.length;sr<ar;sr++){const or=er[sr]?er[sr].matrixWorld:_identityMatrix$1;_offsetMatrix.multiplyMatrices(or,tr[sr]),_offsetMatrix.toArray(rr,sr*16)}nr!==null&&(nr.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let er=Math.sqrt(this.bones.length*4);er=Math.ceil(er/4)*4,er=Math.max(er,4);const tr=new Float32Array(er*er*4);tr.set(this.boneMatrices);const rr=new DataTexture(tr,er,er,RGBAFormat,FloatType);return rr.needsUpdate=!0,this.boneMatrices=tr,this.boneTexture=rr,this}getBoneByName(er){for(let tr=0,rr=this.bones.length;tr<rr;tr++){const nr=this.bones[tr];if(nr.name===er)return nr}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(er,tr){this.uuid=er.uuid;for(let rr=0,nr=er.bones.length;rr<nr;rr++){const sr=er.bones[rr];let ar=tr[sr];ar===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",sr),ar=new Bone),this.bones.push(ar),this.boneInverses.push(new Matrix4().fromArray(er.boneInverses[rr]))}return this.init(),this}toJSON(){const er={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};er.uuid=this.uuid;const tr=this.bones,rr=this.boneInverses;for(let nr=0,sr=tr.length;nr<sr;nr++){const ar=tr[nr];er.bones.push(ar.uuid);const or=rr[nr];er.boneInverses.push(or.toArray())}return er}}class InstancedBufferAttribute extends BufferAttribute{constructor(er,tr,rr,nr=1){super(er,tr,rr),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=nr}copy(er){return super.copy(er),this.meshPerAttribute=er.meshPerAttribute,this}toJSON(){const er=super.toJSON();return er.meshPerAttribute=this.meshPerAttribute,er.isInstancedBufferAttribute=!0,er}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$4=new Sphere;class InstancedMesh extends Mesh{constructor(er,tr,rr){super(er,tr),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(rr*16),16),this.instanceColor=null,this.morphTexture=null,this.count=rr,this.boundingBox=null,this.boundingSphere=null;for(let nr=0;nr<rr;nr++)this.setMatrixAt(nr,_identity)}computeBoundingBox(){const er=this.geometry,tr=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),er.boundingBox===null&&er.computeBoundingBox(),this.boundingBox.makeEmpty();for(let rr=0;rr<tr;rr++)this.getMatrixAt(rr,_instanceLocalMatrix),_box3.copy(er.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const er=this.geometry,tr=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),er.boundingSphere===null&&er.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let rr=0;rr<tr;rr++)this.getMatrixAt(rr,_instanceLocalMatrix),_sphere$4.copy(er.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$4)}copy(er,tr){return super.copy(er,tr),this.instanceMatrix.copy(er.instanceMatrix),er.morphTexture!==null&&(this.morphTexture=er.morphTexture.clone()),er.instanceColor!==null&&(this.instanceColor=er.instanceColor.clone()),this.count=er.count,er.boundingBox!==null&&(this.boundingBox=er.boundingBox.clone()),er.boundingSphere!==null&&(this.boundingSphere=er.boundingSphere.clone()),this}getColorAt(er,tr){tr.fromArray(this.instanceColor.array,er*3)}getMatrixAt(er,tr){tr.fromArray(this.instanceMatrix.array,er*16)}getMorphAt(er,tr){const rr=tr.morphTargetInfluences,nr=this.morphTexture.source.data.data,sr=rr.length+1,ar=er*sr+1;for(let or=0;or<rr.length;or++)rr[or]=nr[ar+or]}raycast(er,tr){const rr=this.matrixWorld,nr=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,_mesh$1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(rr),er.ray.intersectsSphere(_sphere$4)!==!1))for(let sr=0;sr<nr;sr++){this.getMatrixAt(sr,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(rr,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(er,_instanceIntersects);for(let ar=0,or=_instanceIntersects.length;ar<or;ar++){const lr=_instanceIntersects[ar];lr.instanceId=sr,lr.object=this,tr.push(lr)}_instanceIntersects.length=0}}setColorAt(er,tr){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),tr.toArray(this.instanceColor.array,er*3)}setMatrixAt(er,tr){tr.toArray(this.instanceMatrix.array,er*16)}setMorphAt(er,tr){const rr=tr.morphTargetInfluences,nr=rr.length+1;this.morphTexture===null&&(this.morphTexture=new DataTexture(new Float32Array(nr*this.count),nr,this.count,RedFormat,FloatType));const sr=this.morphTexture.source.data.data;let ar=0;for(let cr=0;cr<rr.length;cr++)ar+=rr[cr];const or=this.geometry.morphTargetsRelative?1:1-ar,lr=nr*er;sr[lr]=or,sr.set(rr,lr+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const _vector1=new Vector3$1,_vector2=new Vector3$1,_normalMatrix$1=new Matrix3;class Plane{constructor(er=new Vector3$1(1,0,0),tr=0){this.isPlane=!0,this.normal=er,this.constant=tr}set(er,tr){return this.normal.copy(er),this.constant=tr,this}setComponents(er,tr,rr,nr){return this.normal.set(er,tr,rr),this.constant=nr,this}setFromNormalAndCoplanarPoint(er,tr){return this.normal.copy(er),this.constant=-tr.dot(this.normal),this}setFromCoplanarPoints(er,tr,rr){const nr=_vector1.subVectors(rr,tr).cross(_vector2.subVectors(er,tr)).normalize();return this.setFromNormalAndCoplanarPoint(nr,er),this}copy(er){return this.normal.copy(er.normal),this.constant=er.constant,this}normalize(){const er=1/this.normal.length();return this.normal.multiplyScalar(er),this.constant*=er,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(er){return this.normal.dot(er)+this.constant}distanceToSphere(er){return this.distanceToPoint(er.center)-er.radius}projectPoint(er,tr){return tr.copy(er).addScaledVector(this.normal,-this.distanceToPoint(er))}intersectLine(er,tr){const rr=er.delta(_vector1),nr=this.normal.dot(rr);if(nr===0)return this.distanceToPoint(er.start)===0?tr.copy(er.start):null;const sr=-(er.start.dot(this.normal)+this.constant)/nr;return sr<0||sr>1?null:tr.copy(er.start).addScaledVector(rr,sr)}intersectsLine(er){const tr=this.distanceToPoint(er.start),rr=this.distanceToPoint(er.end);return tr<0&&rr>0||rr<0&&tr>0}intersectsBox(er){return er.intersectsPlane(this)}intersectsSphere(er){return er.intersectsPlane(this)}coplanarPoint(er){return er.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(er,tr){const rr=tr||_normalMatrix$1.getNormalMatrix(er),nr=this.coplanarPoint(_vector1).applyMatrix4(er),sr=this.normal.applyMatrix3(rr).normalize();return this.constant=-nr.dot(sr),this}translate(er){return this.constant-=er.dot(this.normal),this}equals(er){return er.normal.equals(this.normal)&&er.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$3=new Sphere,_vector$6=new Vector3$1;class Frustum{constructor(er=new Plane,tr=new Plane,rr=new Plane,nr=new Plane,sr=new Plane,ar=new Plane){this.planes=[er,tr,rr,nr,sr,ar]}set(er,tr,rr,nr,sr,ar){const or=this.planes;return or[0].copy(er),or[1].copy(tr),or[2].copy(rr),or[3].copy(nr),or[4].copy(sr),or[5].copy(ar),this}copy(er){const tr=this.planes;for(let rr=0;rr<6;rr++)tr[rr].copy(er.planes[rr]);return this}setFromProjectionMatrix(er,tr=WebGLCoordinateSystem){const rr=this.planes,nr=er.elements,sr=nr[0],ar=nr[1],or=nr[2],lr=nr[3],cr=nr[4],hr=nr[5],fr=nr[6],ur=nr[7],pr=nr[8],gr=nr[9],_r=nr[10],mr=nr[11],dr=nr[12],vr=nr[13],Ar=nr[14],yr=nr[15];if(rr[0].setComponents(lr-sr,ur-cr,mr-pr,yr-dr).normalize(),rr[1].setComponents(lr+sr,ur+cr,mr+pr,yr+dr).normalize(),rr[2].setComponents(lr+ar,ur+hr,mr+gr,yr+vr).normalize(),rr[3].setComponents(lr-ar,ur-hr,mr-gr,yr-vr).normalize(),rr[4].setComponents(lr-or,ur-fr,mr-_r,yr-Ar).normalize(),tr===WebGLCoordinateSystem)rr[5].setComponents(lr+or,ur+fr,mr+_r,yr+Ar).normalize();else if(tr===WebGPUCoordinateSystem)rr[5].setComponents(or,fr,_r,Ar).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+tr);return this}intersectsObject(er){if(er.boundingSphere!==void 0)er.boundingSphere===null&&er.computeBoundingSphere(),_sphere$3.copy(er.boundingSphere).applyMatrix4(er.matrixWorld);else{const tr=er.geometry;tr.boundingSphere===null&&tr.computeBoundingSphere(),_sphere$3.copy(tr.boundingSphere).applyMatrix4(er.matrixWorld)}return this.intersectsSphere(_sphere$3)}intersectsSprite(er){return _sphere$3.center.set(0,0,0),_sphere$3.radius=.7071067811865476,_sphere$3.applyMatrix4(er.matrixWorld),this.intersectsSphere(_sphere$3)}intersectsSphere(er){const tr=this.planes,rr=er.center,nr=-er.radius;for(let sr=0;sr<6;sr++)if(tr[sr].distanceToPoint(rr)<nr)return!1;return!0}intersectsBox(er){const tr=this.planes;for(let rr=0;rr<6;rr++){const nr=tr[rr];if(_vector$6.x=nr.normal.x>0?er.max.x:er.min.x,_vector$6.y=nr.normal.y>0?er.max.y:er.min.y,_vector$6.z=nr.normal.z>0?er.max.z:er.min.z,nr.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(er){const tr=this.planes;for(let rr=0;rr<6;rr++)if(tr[rr].distanceToPoint(er)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ascIdSort(ir,er){return ir-er}function sortOpaque(ir,er){return ir.z-er.z}function sortTransparent(ir,er){return er.z-ir.z}class MultiDrawRenderList{constructor(){this.index=0,this.pool=[],this.list=[]}push(er,tr,rr,nr){const sr=this.pool,ar=this.list;this.index>=sr.length&&sr.push({start:-1,count:-1,z:-1,index:-1});const or=sr[this.index];ar.push(or),this.index++,or.start=er,or.count=tr,or.z=rr,or.index=nr}reset(){this.list.length=0,this.index=0}}const _matrix$1$1=new Matrix4,_whiteColor=new Color(1,1,1),_frustum$1=new Frustum,_box$1$1=new Box3,_sphere$2=new Sphere,_vector$5=new Vector3$1,_forward=new Vector3$1,_temp=new Vector3$1,_renderList=new MultiDrawRenderList,_mesh=new Mesh,_batchIntersects=[];function copyAttributeData(ir,er,tr=0){const rr=er.itemSize;if(ir.isInterleavedBufferAttribute||ir.array.constructor!==er.array.constructor){const nr=ir.count;for(let sr=0;sr<nr;sr++)for(let ar=0;ar<rr;ar++)er.setComponent(sr+tr,ar,ir.getComponent(sr,ar))}else er.array.set(ir.array,tr*rr);er.needsUpdate=!0}function copyArrayContents(ir,er){if(ir.constructor!==er.constructor){const tr=Math.min(ir.length,er.length);for(let rr=0;rr<tr;rr++)er[rr]=ir[rr]}else{const tr=Math.min(ir.length,er.length);er.set(new ir.constructor(ir.buffer,0,tr))}}class BatchedMesh extends Mesh{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(er,tr,rr=tr*2,nr){super(new BufferGeometry,nr),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=er,this._maxVertexCount=tr,this._maxIndexCount=rr,this._multiDrawCounts=new Int32Array(er),this._multiDrawStarts=new Int32Array(er),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let er=Math.sqrt(this._maxInstanceCount*4);er=Math.ceil(er/4)*4,er=Math.max(er,4);const tr=new Float32Array(er*er*4),rr=new DataTexture(tr,er,er,RGBAFormat,FloatType);this._matricesTexture=rr}_initIndirectTexture(){let er=Math.sqrt(this._maxInstanceCount);er=Math.ceil(er);const tr=new Uint32Array(er*er),rr=new DataTexture(tr,er,er,RedIntegerFormat,UnsignedIntType);this._indirectTexture=rr}_initColorsTexture(){let er=Math.sqrt(this._maxInstanceCount);er=Math.ceil(er);const tr=new Float32Array(er*er*4).fill(1),rr=new DataTexture(tr,er,er,RGBAFormat,FloatType);rr.colorSpace=ColorManagement.workingColorSpace,this._colorsTexture=rr}_initializeGeometry(er){const tr=this.geometry,rr=this._maxVertexCount,nr=this._maxIndexCount;if(this._geometryInitialized===!1){for(const sr in er.attributes){const ar=er.getAttribute(sr),{array:or,itemSize:lr,normalized:cr}=ar,hr=new or.constructor(rr*lr),fr=new BufferAttribute(hr,lr,cr);tr.setAttribute(sr,fr)}if(er.getIndex()!==null){const sr=rr>65535?new Uint32Array(nr):new Uint16Array(nr);tr.setIndex(new BufferAttribute(sr,1))}this._geometryInitialized=!0}}_validateGeometry(er){const tr=this.geometry;if(!!er.getIndex()!=!!tr.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const rr in tr.attributes){if(!er.hasAttribute(rr))throw new Error(`THREE.BatchedMesh: Added geometry missing "${rr}". All geometries must have consistent attributes.`);const nr=er.getAttribute(rr),sr=tr.getAttribute(rr);if(nr.itemSize!==sr.itemSize||nr.normalized!==sr.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(er){const tr=this._instanceInfo;if(er<0||er>=tr.length||tr[er].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${er}. Instance is either out of range or has been deleted.`)}validateGeometryId(er){const tr=this._geometryInfo;if(er<0||er>=tr.length||tr[er].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${er}. Geometry is either out of range or has been deleted.`)}setCustomSort(er){return this.customSort=er,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const er=this.boundingBox,tr=this._instanceInfo;er.makeEmpty();for(let rr=0,nr=tr.length;rr<nr;rr++){if(tr[rr].active===!1)continue;const sr=tr[rr].geometryIndex;this.getMatrixAt(rr,_matrix$1$1),this.getBoundingBoxAt(sr,_box$1$1).applyMatrix4(_matrix$1$1),er.union(_box$1$1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const er=this.boundingSphere,tr=this._instanceInfo;er.makeEmpty();for(let rr=0,nr=tr.length;rr<nr;rr++){if(tr[rr].active===!1)continue;const sr=tr[rr].geometryIndex;this.getMatrixAt(rr,_matrix$1$1),this.getBoundingSphereAt(sr,_sphere$2).applyMatrix4(_matrix$1$1),er.union(_sphere$2)}}addInstance(er){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const rr={visible:!0,active:!0,geometryIndex:er};let nr=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ascIdSort),nr=this._availableInstanceIds.shift(),this._instanceInfo[nr]=rr):(nr=this._instanceInfo.length,this._instanceInfo.push(rr));const sr=this._matricesTexture;_matrix$1$1.identity().toArray(sr.image.data,nr*16),sr.needsUpdate=!0;const ar=this._colorsTexture;return ar&&(_whiteColor.toArray(ar.image.data,nr*4),ar.needsUpdate=!0),this._visibilityChanged=!0,nr}addGeometry(er,tr=-1,rr=-1){this._initializeGeometry(er),this._validateGeometry(er);const nr={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},sr=this._geometryInfo;nr.vertexStart=this._nextVertexStart,nr.reservedVertexCount=tr===-1?er.getAttribute("position").count:tr;const ar=er.getIndex();if(ar!==null&&(nr.indexStart=this._nextIndexStart,nr.reservedIndexCount=rr===-1?ar.count:rr),nr.indexStart!==-1&&nr.indexStart+nr.reservedIndexCount>this._maxIndexCount||nr.vertexStart+nr.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let lr;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ascIdSort),lr=this._availableGeometryIds.shift(),sr[lr]=nr):(lr=this._geometryCount,this._geometryCount++,sr.push(nr)),this.setGeometryAt(lr,er),this._nextIndexStart=nr.indexStart+nr.reservedIndexCount,this._nextVertexStart=nr.vertexStart+nr.reservedVertexCount,lr}setGeometryAt(er,tr){if(er>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(tr);const rr=this.geometry,nr=rr.getIndex()!==null,sr=rr.getIndex(),ar=tr.getIndex(),or=this._geometryInfo[er];if(nr&&ar.count>or.reservedIndexCount||tr.attributes.position.count>or.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const lr=or.vertexStart,cr=or.reservedVertexCount;or.vertexCount=tr.getAttribute("position").count;for(const hr in rr.attributes){const fr=tr.getAttribute(hr),ur=rr.getAttribute(hr);copyAttributeData(fr,ur,lr);const pr=fr.itemSize;for(let gr=fr.count,_r=cr;gr<_r;gr++){const mr=lr+gr;for(let dr=0;dr<pr;dr++)ur.setComponent(mr,dr,0)}ur.needsUpdate=!0,ur.addUpdateRange(lr*pr,cr*pr)}if(nr){const hr=or.indexStart,fr=or.reservedIndexCount;or.indexCount=tr.getIndex().count;for(let ur=0;ur<ar.count;ur++)sr.setX(hr+ur,lr+ar.getX(ur));for(let ur=ar.count,pr=fr;ur<pr;ur++)sr.setX(hr+ur,lr);sr.needsUpdate=!0,sr.addUpdateRange(hr,or.reservedIndexCount)}return or.start=nr?or.indexStart:or.vertexStart,or.count=nr?or.indexCount:or.vertexCount,or.boundingBox=null,tr.boundingBox!==null&&(or.boundingBox=tr.boundingBox.clone()),or.boundingSphere=null,tr.boundingSphere!==null&&(or.boundingSphere=tr.boundingSphere.clone()),this._visibilityChanged=!0,er}deleteGeometry(er){const tr=this._geometryInfo;if(er>=tr.length||tr[er].active===!1)return this;const rr=this._instanceInfo;for(let nr=0,sr=rr.length;nr<sr;nr++)rr[nr].active&&rr[nr].geometryIndex===er&&this.deleteInstance(nr);return tr[er].active=!1,this._availableGeometryIds.push(er),this._visibilityChanged=!0,this}deleteInstance(er){return this.validateInstanceId(er),this._instanceInfo[er].active=!1,this._availableInstanceIds.push(er),this._visibilityChanged=!0,this}optimize(){let er=0,tr=0;const rr=this._geometryInfo,nr=rr.map((ar,or)=>or).sort((ar,or)=>rr[ar].vertexStart-rr[or].vertexStart),sr=this.geometry;for(let ar=0,or=rr.length;ar<or;ar++){const lr=nr[ar],cr=rr[lr];if(cr.active!==!1){if(sr.index!==null){if(cr.indexStart!==tr){const{indexStart:hr,vertexStart:fr,reservedIndexCount:ur}=cr,pr=sr.index,gr=pr.array,_r=er-fr;for(let mr=hr;mr<hr+ur;mr++)gr[mr]=gr[mr]+_r;pr.array.copyWithin(tr,hr,hr+ur),pr.addUpdateRange(tr,ur),cr.indexStart=tr}tr+=cr.reservedIndexCount}if(cr.vertexStart!==er){const{vertexStart:hr,reservedVertexCount:fr}=cr,ur=sr.attributes;for(const pr in ur){const gr=ur[pr],{array:_r,itemSize:mr}=gr;_r.copyWithin(er*mr,hr*mr,(hr+fr)*mr),gr.addUpdateRange(er*mr,fr*mr)}cr.vertexStart=er}er+=cr.reservedVertexCount,cr.start=sr.index?cr.indexStart:cr.vertexStart,this._nextIndexStart=sr.index?cr.indexStart+cr.reservedIndexCount:0,this._nextVertexStart=cr.vertexStart+cr.reservedVertexCount}}return this}getBoundingBoxAt(er,tr){if(er>=this._geometryCount)return null;const rr=this.geometry,nr=this._geometryInfo[er];if(nr.boundingBox===null){const sr=new Box3,ar=rr.index,or=rr.attributes.position;for(let lr=nr.start,cr=nr.start+nr.count;lr<cr;lr++){let hr=lr;ar&&(hr=ar.getX(hr)),sr.expandByPoint(_vector$5.fromBufferAttribute(or,hr))}nr.boundingBox=sr}return tr.copy(nr.boundingBox),tr}getBoundingSphereAt(er,tr){if(er>=this._geometryCount)return null;const rr=this.geometry,nr=this._geometryInfo[er];if(nr.boundingSphere===null){const sr=new Sphere;this.getBoundingBoxAt(er,_box$1$1),_box$1$1.getCenter(sr.center);const ar=rr.index,or=rr.attributes.position;let lr=0;for(let cr=nr.start,hr=nr.start+nr.count;cr<hr;cr++){let fr=cr;ar&&(fr=ar.getX(fr)),_vector$5.fromBufferAttribute(or,fr),lr=Math.max(lr,sr.center.distanceToSquared(_vector$5))}sr.radius=Math.sqrt(lr),nr.boundingSphere=sr}return tr.copy(nr.boundingSphere),tr}setMatrixAt(er,tr){this.validateInstanceId(er);const rr=this._matricesTexture,nr=this._matricesTexture.image.data;return tr.toArray(nr,er*16),rr.needsUpdate=!0,this}getMatrixAt(er,tr){return this.validateInstanceId(er),tr.fromArray(this._matricesTexture.image.data,er*16)}setColorAt(er,tr){return this.validateInstanceId(er),this._colorsTexture===null&&this._initColorsTexture(),tr.toArray(this._colorsTexture.image.data,er*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(er,tr){return this.validateInstanceId(er),tr.fromArray(this._colorsTexture.image.data,er*4)}setVisibleAt(er,tr){return this.validateInstanceId(er),this._instanceInfo[er].visible===tr?this:(this._instanceInfo[er].visible=tr,this._visibilityChanged=!0,this)}getVisibleAt(er){return this.validateInstanceId(er),this._instanceInfo[er].visible}setGeometryIdAt(er,tr){return this.validateInstanceId(er),this.validateGeometryId(tr),this._instanceInfo[er].geometryIndex=tr,this}getGeometryIdAt(er){return this.validateInstanceId(er),this._instanceInfo[er].geometryIndex}getGeometryRangeAt(er,tr={}){this.validateGeometryId(er);const rr=this._geometryInfo[er];return tr.vertexStart=rr.vertexStart,tr.vertexCount=rr.vertexCount,tr.reservedVertexCount=rr.reservedVertexCount,tr.indexStart=rr.indexStart,tr.indexCount=rr.indexCount,tr.reservedIndexCount=rr.reservedIndexCount,tr.start=rr.start,tr.count=rr.count,tr}setInstanceCount(er){const tr=this._availableInstanceIds,rr=this._instanceInfo;for(tr.sort(ascIdSort);tr[tr.length-1]===rr.length;)rr.pop(),tr.pop();if(er<rr.length)throw new Error(`BatchedMesh: Instance ids outside the range ${er} are being used. Cannot shrink instance count.`);const nr=new Int32Array(er),sr=new Int32Array(er);copyArrayContents(this._multiDrawCounts,nr),copyArrayContents(this._multiDrawStarts,sr),this._multiDrawCounts=nr,this._multiDrawStarts=sr,this._maxInstanceCount=er;const ar=this._indirectTexture,or=this._matricesTexture,lr=this._colorsTexture;ar.dispose(),this._initIndirectTexture(),copyArrayContents(ar.image.data,this._indirectTexture.image.data),or.dispose(),this._initMatricesTexture(),copyArrayContents(or.image.data,this._matricesTexture.image.data),lr&&(lr.dispose(),this._initColorsTexture(),copyArrayContents(lr.image.data,this._colorsTexture.image.data))}setGeometrySize(er,tr){const rr=[...this._geometryInfo].filter(or=>or.active);if(Math.max(...rr.map(or=>or.vertexStart+or.reservedVertexCount))>er)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${tr}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...rr.map(lr=>lr.indexStart+lr.reservedIndexCount))>tr)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${tr}. Cannot shrink further.`);const sr=this.geometry;sr.dispose(),this._maxVertexCount=er,this._maxIndexCount=tr,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new BufferGeometry,this._initializeGeometry(sr));const ar=this.geometry;sr.index&&copyArrayContents(sr.index.array,ar.index.array);for(const or in sr.attributes)copyArrayContents(sr.attributes[or].array,ar.attributes[or].array)}raycast(er,tr){const rr=this._instanceInfo,nr=this._geometryInfo,sr=this.matrixWorld,ar=this.geometry;_mesh.material=this.material,_mesh.geometry.index=ar.index,_mesh.geometry.attributes=ar.attributes,_mesh.geometry.boundingBox===null&&(_mesh.geometry.boundingBox=new Box3),_mesh.geometry.boundingSphere===null&&(_mesh.geometry.boundingSphere=new Sphere);for(let or=0,lr=rr.length;or<lr;or++){if(!rr[or].visible||!rr[or].active)continue;const cr=rr[or].geometryIndex,hr=nr[cr];_mesh.geometry.setDrawRange(hr.start,hr.count),this.getMatrixAt(or,_mesh.matrixWorld).premultiply(sr),this.getBoundingBoxAt(cr,_mesh.geometry.boundingBox),this.getBoundingSphereAt(cr,_mesh.geometry.boundingSphere),_mesh.raycast(er,_batchIntersects);for(let fr=0,ur=_batchIntersects.length;fr<ur;fr++){const pr=_batchIntersects[fr];pr.object=this,pr.batchId=or,tr.push(pr)}_batchIntersects.length=0}_mesh.material=null,_mesh.geometry.index=null,_mesh.geometry.attributes={},_mesh.geometry.setDrawRange(0,1/0)}copy(er){return super.copy(er),this.geometry=er.geometry.clone(),this.perObjectFrustumCulled=er.perObjectFrustumCulled,this.sortObjects=er.sortObjects,this.boundingBox=er.boundingBox!==null?er.boundingBox.clone():null,this.boundingSphere=er.boundingSphere!==null?er.boundingSphere.clone():null,this._geometryInfo=er._geometryInfo.map(tr=>({...tr,boundingBox:tr.boundingBox!==null?tr.boundingBox.clone():null,boundingSphere:tr.boundingSphere!==null?tr.boundingSphere.clone():null})),this._instanceInfo=er._instanceInfo.map(tr=>({...tr})),this._maxInstanceCount=er._maxInstanceCount,this._maxVertexCount=er._maxVertexCount,this._maxIndexCount=er._maxIndexCount,this._geometryInitialized=er._geometryInitialized,this._geometryCount=er._geometryCount,this._multiDrawCounts=er._multiDrawCounts.slice(),this._multiDrawStarts=er._multiDrawStarts.slice(),this._matricesTexture=er._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=er._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(er,tr,rr,nr,sr){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const ar=nr.getIndex(),or=ar===null?1:ar.array.BYTES_PER_ELEMENT,lr=this._instanceInfo,cr=this._multiDrawStarts,hr=this._multiDrawCounts,fr=this._geometryInfo,ur=this.perObjectFrustumCulled,pr=this._indirectTexture,gr=pr.image.data;ur&&(_matrix$1$1.multiplyMatrices(rr.projectionMatrix,rr.matrixWorldInverse).multiply(this.matrixWorld),_frustum$1.setFromProjectionMatrix(_matrix$1$1,er.coordinateSystem));let _r=0;if(this.sortObjects){_matrix$1$1.copy(this.matrixWorld).invert(),_vector$5.setFromMatrixPosition(rr.matrixWorld).applyMatrix4(_matrix$1$1),_forward.set(0,0,-1).transformDirection(rr.matrixWorld).transformDirection(_matrix$1$1);for(let vr=0,Ar=lr.length;vr<Ar;vr++)if(lr[vr].visible&&lr[vr].active){const yr=lr[vr].geometryIndex;this.getMatrixAt(vr,_matrix$1$1),this.getBoundingSphereAt(yr,_sphere$2).applyMatrix4(_matrix$1$1);let wr=!1;if(ur&&(wr=!_frustum$1.intersectsSphere(_sphere$2)),!wr){const br=fr[yr],Sr=_temp.subVectors(_sphere$2.center,_vector$5).dot(_forward);_renderList.push(br.start,br.count,Sr,vr)}}const mr=_renderList.list,dr=this.customSort;dr===null?mr.sort(sr.transparent?sortTransparent:sortOpaque):dr.call(this,mr,rr);for(let vr=0,Ar=mr.length;vr<Ar;vr++){const yr=mr[vr];cr[_r]=yr.start*or,hr[_r]=yr.count,gr[_r]=yr.index,_r++}_renderList.reset()}else for(let mr=0,dr=lr.length;mr<dr;mr++)if(lr[mr].visible&&lr[mr].active){const vr=lr[mr].geometryIndex;let Ar=!1;if(ur&&(this.getMatrixAt(mr,_matrix$1$1),this.getBoundingSphereAt(vr,_sphere$2).applyMatrix4(_matrix$1$1),Ar=!_frustum$1.intersectsSphere(_sphere$2)),!Ar){const yr=fr[vr];cr[_r]=yr.start*or,hr[_r]=yr.count,gr[_r]=mr,_r++}}pr.needsUpdate=!0,this._multiDrawCount=_r,this._visibilityChanged=!1}onBeforeShadow(er,tr,rr,nr,sr,ar){this.onBeforeRender(er,null,nr,sr,ar)}}class LineBasicMaterial extends Material{constructor(er){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.linewidth=er.linewidth,this.linecap=er.linecap,this.linejoin=er.linejoin,this.fog=er.fog,this}}const _vStart=new Vector3$1,_vEnd=new Vector3$1,_inverseMatrix$1=new Matrix4,_ray$1$1=new Ray$1,_sphere$1$1=new Sphere,_intersectPointOnRay=new Vector3$1,_intersectPointOnSegment=new Vector3$1;class Line extends Object3D{constructor(er=new BufferGeometry,tr=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=er,this.material=tr,this.updateMorphTargets()}copy(er,tr){return super.copy(er,tr),this.material=Array.isArray(er.material)?er.material.slice():er.material,this.geometry=er.geometry,this}computeLineDistances(){const er=this.geometry;if(er.index===null){const tr=er.attributes.position,rr=[0];for(let nr=1,sr=tr.count;nr<sr;nr++)_vStart.fromBufferAttribute(tr,nr-1),_vEnd.fromBufferAttribute(tr,nr),rr[nr]=rr[nr-1],rr[nr]+=_vStart.distanceTo(_vEnd);er.setAttribute("lineDistance",new Float32BufferAttribute(rr,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(er,tr){const rr=this.geometry,nr=this.matrixWorld,sr=er.params.Line.threshold,ar=rr.drawRange;if(rr.boundingSphere===null&&rr.computeBoundingSphere(),_sphere$1$1.copy(rr.boundingSphere),_sphere$1$1.applyMatrix4(nr),_sphere$1$1.radius+=sr,er.ray.intersectsSphere(_sphere$1$1)===!1)return;_inverseMatrix$1.copy(nr).invert(),_ray$1$1.copy(er.ray).applyMatrix4(_inverseMatrix$1);const or=sr/((this.scale.x+this.scale.y+this.scale.z)/3),lr=or*or,cr=this.isLineSegments?2:1,hr=rr.index,ur=rr.attributes.position;if(hr!==null){const pr=Math.max(0,ar.start),gr=Math.min(hr.count,ar.start+ar.count);for(let _r=pr,mr=gr-1;_r<mr;_r+=cr){const dr=hr.getX(_r),vr=hr.getX(_r+1),Ar=checkIntersection(this,er,_ray$1$1,lr,dr,vr,_r);Ar&&tr.push(Ar)}if(this.isLineLoop){const _r=hr.getX(gr-1),mr=hr.getX(pr),dr=checkIntersection(this,er,_ray$1$1,lr,_r,mr,gr-1);dr&&tr.push(dr)}}else{const pr=Math.max(0,ar.start),gr=Math.min(ur.count,ar.start+ar.count);for(let _r=pr,mr=gr-1;_r<mr;_r+=cr){const dr=checkIntersection(this,er,_ray$1$1,lr,_r,_r+1,_r);dr&&tr.push(dr)}if(this.isLineLoop){const _r=checkIntersection(this,er,_ray$1$1,lr,gr-1,pr,gr-1);_r&&tr.push(_r)}}}updateMorphTargets(){const tr=this.geometry.morphAttributes,rr=Object.keys(tr);if(rr.length>0){const nr=tr[rr[0]];if(nr!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let sr=0,ar=nr.length;sr<ar;sr++){const or=nr[sr].name||String(sr);this.morphTargetInfluences.push(0),this.morphTargetDictionary[or]=sr}}}}}function checkIntersection(ir,er,tr,rr,nr,sr,ar){const or=ir.geometry.attributes.position;if(_vStart.fromBufferAttribute(or,nr),_vEnd.fromBufferAttribute(or,sr),tr.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>rr)return;_intersectPointOnRay.applyMatrix4(ir.matrixWorld);const cr=er.ray.origin.distanceTo(_intersectPointOnRay);if(!(cr<er.near||cr>er.far))return{distance:cr,point:_intersectPointOnSegment.clone().applyMatrix4(ir.matrixWorld),index:ar,face:null,faceIndex:null,barycoord:null,object:ir}}const _start$2=new Vector3$1,_end$2=new Vector3$1;class LineSegments extends Line{constructor(er,tr){super(er,tr),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const er=this.geometry;if(er.index===null){const tr=er.attributes.position,rr=[];for(let nr=0,sr=tr.count;nr<sr;nr+=2)_start$2.fromBufferAttribute(tr,nr),_end$2.fromBufferAttribute(tr,nr+1),rr[nr]=nr===0?0:rr[nr-1],rr[nr+1]=rr[nr]+_start$2.distanceTo(_end$2);er.setAttribute("lineDistance",new Float32BufferAttribute(rr,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(er,tr){super(er,tr),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(er){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.alphaMap=er.alphaMap,this.size=er.size,this.sizeAttenuation=er.sizeAttenuation,this.fog=er.fog,this}}const _inverseMatrix$4=new Matrix4,_ray$4=new Ray$1,_sphere$7=new Sphere,_position$2=new Vector3$1;class Points extends Object3D{constructor(er=new BufferGeometry,tr=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=er,this.material=tr,this.updateMorphTargets()}copy(er,tr){return super.copy(er,tr),this.material=Array.isArray(er.material)?er.material.slice():er.material,this.geometry=er.geometry,this}raycast(er,tr){const rr=this.geometry,nr=this.matrixWorld,sr=er.params.Points.threshold,ar=rr.drawRange;if(rr.boundingSphere===null&&rr.computeBoundingSphere(),_sphere$7.copy(rr.boundingSphere),_sphere$7.applyMatrix4(nr),_sphere$7.radius+=sr,er.ray.intersectsSphere(_sphere$7)===!1)return;_inverseMatrix$4.copy(nr).invert(),_ray$4.copy(er.ray).applyMatrix4(_inverseMatrix$4);const or=sr/((this.scale.x+this.scale.y+this.scale.z)/3),lr=or*or,cr=rr.index,fr=rr.attributes.position;if(cr!==null){const ur=Math.max(0,ar.start),pr=Math.min(cr.count,ar.start+ar.count);for(let gr=ur,_r=pr;gr<_r;gr++){const mr=cr.getX(gr);_position$2.fromBufferAttribute(fr,mr),testPoint(_position$2,mr,lr,nr,er,tr,this)}}else{const ur=Math.max(0,ar.start),pr=Math.min(fr.count,ar.start+ar.count);for(let gr=ur,_r=pr;gr<_r;gr++)_position$2.fromBufferAttribute(fr,gr),testPoint(_position$2,gr,lr,nr,er,tr,this)}}updateMorphTargets(){const tr=this.geometry.morphAttributes,rr=Object.keys(tr);if(rr.length>0){const nr=tr[rr[0]];if(nr!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let sr=0,ar=nr.length;sr<ar;sr++){const or=nr[sr].name||String(sr);this.morphTargetInfluences.push(0),this.morphTargetDictionary[or]=sr}}}}}function testPoint(ir,er,tr,rr,nr,sr,ar){const or=_ray$4.distanceSqToPoint(ir);if(or<tr){const lr=new Vector3$1;_ray$4.closestPointToPoint(ir,lr),lr.applyMatrix4(rr);const cr=nr.ray.origin.distanceTo(lr);if(cr<nr.near||cr>nr.far)return;sr.push({distance:cr,distanceToRay:Math.sqrt(or),point:lr,index:er,face:null,faceIndex:null,barycoord:null,object:ar})}}class VideoTexture extends Texture{constructor(er,tr,rr,nr,sr,ar,or,lr,cr){super(er,tr,rr,nr,sr,ar,or,lr,cr),this.isVideoTexture=!0,this.minFilter=ar!==void 0?ar:LinearFilter,this.magFilter=sr!==void 0?sr:LinearFilter,this.generateMipmaps=!1;const hr=this;function fr(){hr.needsUpdate=!0,er.requestVideoFrameCallback(fr)}"requestVideoFrameCallback"in er&&er.requestVideoFrameCallback(fr)}clone(){return new this.constructor(this.image).copy(this)}update(){const er=this.image;"requestVideoFrameCallback"in er===!1&&er.readyState>=er.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class VideoFrameTexture extends VideoTexture{constructor(er,tr,rr,nr,sr,ar,or,lr){super({},er,tr,rr,nr,sr,ar,or,lr),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(er){this.image=er,this.needsUpdate=!0}}class FramebufferTexture extends Texture{constructor(er,tr){super({width:er,height:tr}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur){super(null,ar,or,lr,cr,hr,nr,sr,fr,ur),this.isCompressedTexture=!0,this.image={width:tr,height:rr},this.mipmaps=er,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(er,tr,rr,nr,sr,ar){super(er,tr,rr,sr,ar),this.isCompressedArrayTexture=!0,this.image.depth=nr,this.wrapR=ClampToEdgeWrapping,this.layerUpdates=new Set}addLayerUpdate(er){this.layerUpdates.add(er)}clearLayerUpdates(){this.layerUpdates.clear()}}class CompressedCubeTexture extends CompressedTexture{constructor(er,tr,rr){super(void 0,er[0].width,er[0].height,tr,rr,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=er}}class CanvasTexture extends Texture{constructor(er,tr,rr,nr,sr,ar,or,lr,cr){super(er,tr,rr,nr,sr,ar,or,lr,cr),this.isCanvasTexture=!0,this.needsUpdate=!0}}class DepthTexture extends Texture{constructor(er,tr,rr,nr,sr,ar,or,lr,cr,hr=DepthFormat){if(hr!==DepthFormat&&hr!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");rr===void 0&&hr===DepthFormat&&(rr=UnsignedIntType),rr===void 0&&hr===DepthStencilFormat&&(rr=UnsignedInt248Type),super(null,nr,sr,ar,or,lr,hr,rr,cr),this.isDepthTexture=!0,this.image={width:er,height:tr},this.magFilter=or!==void 0?or:NearestFilter,this.minFilter=lr!==void 0?lr:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(er){return super.copy(er),this.compareFunction=er.compareFunction,this}toJSON(er){const tr=super.toJSON(er);return this.compareFunction!==null&&(tr.compareFunction=this.compareFunction),tr}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(er,tr){const rr=this.getUtoTmapping(er);return this.getPoint(rr,tr)}getPoints(er=5){const tr=[];for(let rr=0;rr<=er;rr++)tr.push(this.getPoint(rr/er));return tr}getSpacedPoints(er=5){const tr=[];for(let rr=0;rr<=er;rr++)tr.push(this.getPointAt(rr/er));return tr}getLength(){const er=this.getLengths();return er[er.length-1]}getLengths(er=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===er+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const tr=[];let rr,nr=this.getPoint(0),sr=0;tr.push(0);for(let ar=1;ar<=er;ar++)rr=this.getPoint(ar/er),sr+=rr.distanceTo(nr),tr.push(sr),nr=rr;return this.cacheArcLengths=tr,tr}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(er,tr){const rr=this.getLengths();let nr=0;const sr=rr.length;let ar;tr?ar=tr:ar=er*rr[sr-1];let or=0,lr=sr-1,cr;for(;or<=lr;)if(nr=Math.floor(or+(lr-or)/2),cr=rr[nr]-ar,cr<0)or=nr+1;else if(cr>0)lr=nr-1;else{lr=nr;break}if(nr=lr,rr[nr]===ar)return nr/(sr-1);const hr=rr[nr],ur=rr[nr+1]-hr,pr=(ar-hr)/ur;return(nr+pr)/(sr-1)}getTangent(er,tr){let nr=er-1e-4,sr=er+1e-4;nr<0&&(nr=0),sr>1&&(sr=1);const ar=this.getPoint(nr),or=this.getPoint(sr),lr=tr||(ar.isVector2?new Vector2:new Vector3$1);return lr.copy(or).sub(ar).normalize(),lr}getTangentAt(er,tr){const rr=this.getUtoTmapping(er);return this.getTangent(rr,tr)}computeFrenetFrames(er,tr){const rr=new Vector3$1,nr=[],sr=[],ar=[],or=new Vector3$1,lr=new Matrix4;for(let pr=0;pr<=er;pr++){const gr=pr/er;nr[pr]=this.getTangentAt(gr,new Vector3$1)}sr[0]=new Vector3$1,ar[0]=new Vector3$1;let cr=Number.MAX_VALUE;const hr=Math.abs(nr[0].x),fr=Math.abs(nr[0].y),ur=Math.abs(nr[0].z);hr<=cr&&(cr=hr,rr.set(1,0,0)),fr<=cr&&(cr=fr,rr.set(0,1,0)),ur<=cr&&rr.set(0,0,1),or.crossVectors(nr[0],rr).normalize(),sr[0].crossVectors(nr[0],or),ar[0].crossVectors(nr[0],sr[0]);for(let pr=1;pr<=er;pr++){if(sr[pr]=sr[pr-1].clone(),ar[pr]=ar[pr-1].clone(),or.crossVectors(nr[pr-1],nr[pr]),or.length()>Number.EPSILON){or.normalize();const gr=Math.acos(clamp(nr[pr-1].dot(nr[pr]),-1,1));sr[pr].applyMatrix4(lr.makeRotationAxis(or,gr))}ar[pr].crossVectors(nr[pr],sr[pr])}if(tr===!0){let pr=Math.acos(clamp(sr[0].dot(sr[er]),-1,1));pr/=er,nr[0].dot(or.crossVectors(sr[0],sr[er]))>0&&(pr=-pr);for(let gr=1;gr<=er;gr++)sr[gr].applyMatrix4(lr.makeRotationAxis(nr[gr],pr*gr)),ar[gr].crossVectors(nr[gr],sr[gr])}return{tangents:nr,normals:sr,binormals:ar}}clone(){return new this.constructor().copy(this)}copy(er){return this.arcLengthDivisions=er.arcLengthDivisions,this}toJSON(){const er={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return er.arcLengthDivisions=this.arcLengthDivisions,er.type=this.type,er}fromJSON(er){return this.arcLengthDivisions=er.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(er=0,tr=0,rr=1,nr=1,sr=0,ar=Math.PI*2,or=!1,lr=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=er,this.aY=tr,this.xRadius=rr,this.yRadius=nr,this.aStartAngle=sr,this.aEndAngle=ar,this.aClockwise=or,this.aRotation=lr}getPoint(er,tr=new Vector2){const rr=tr,nr=Math.PI*2;let sr=this.aEndAngle-this.aStartAngle;const ar=Math.abs(sr)<Number.EPSILON;for(;sr<0;)sr+=nr;for(;sr>nr;)sr-=nr;sr<Number.EPSILON&&(ar?sr=0:sr=nr),this.aClockwise===!0&&!ar&&(sr===nr?sr=-nr:sr=sr-nr);const or=this.aStartAngle+er*sr;let lr=this.aX+this.xRadius*Math.cos(or),cr=this.aY+this.yRadius*Math.sin(or);if(this.aRotation!==0){const hr=Math.cos(this.aRotation),fr=Math.sin(this.aRotation),ur=lr-this.aX,pr=cr-this.aY;lr=ur*hr-pr*fr+this.aX,cr=ur*fr+pr*hr+this.aY}return rr.set(lr,cr)}copy(er){return super.copy(er),this.aX=er.aX,this.aY=er.aY,this.xRadius=er.xRadius,this.yRadius=er.yRadius,this.aStartAngle=er.aStartAngle,this.aEndAngle=er.aEndAngle,this.aClockwise=er.aClockwise,this.aRotation=er.aRotation,this}toJSON(){const er=super.toJSON();return er.aX=this.aX,er.aY=this.aY,er.xRadius=this.xRadius,er.yRadius=this.yRadius,er.aStartAngle=this.aStartAngle,er.aEndAngle=this.aEndAngle,er.aClockwise=this.aClockwise,er.aRotation=this.aRotation,er}fromJSON(er){return super.fromJSON(er),this.aX=er.aX,this.aY=er.aY,this.xRadius=er.xRadius,this.yRadius=er.yRadius,this.aStartAngle=er.aStartAngle,this.aEndAngle=er.aEndAngle,this.aClockwise=er.aClockwise,this.aRotation=er.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(er,tr,rr,nr,sr,ar){super(er,tr,rr,rr,nr,sr,ar),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let ir=0,er=0,tr=0,rr=0;function nr(sr,ar,or,lr){ir=sr,er=or,tr=-3*sr+3*ar-2*or-lr,rr=2*sr-2*ar+or+lr}return{initCatmullRom:function(sr,ar,or,lr,cr){nr(ar,or,cr*(or-sr),cr*(lr-ar))},initNonuniformCatmullRom:function(sr,ar,or,lr,cr,hr,fr){let ur=(ar-sr)/cr-(or-sr)/(cr+hr)+(or-ar)/hr,pr=(or-ar)/hr-(lr-ar)/(hr+fr)+(lr-or)/fr;ur*=hr,pr*=hr,nr(ar,or,ur,pr)},calc:function(sr){const ar=sr*sr,or=ar*sr;return ir+er*sr+tr*ar+rr*or}}}const tmp=new Vector3$1,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(er=[],tr=!1,rr="centripetal",nr=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=er,this.closed=tr,this.curveType=rr,this.tension=nr}getPoint(er,tr=new Vector3$1){const rr=tr,nr=this.points,sr=nr.length,ar=(sr-(this.closed?0:1))*er;let or=Math.floor(ar),lr=ar-or;this.closed?or+=or>0?0:(Math.floor(Math.abs(or)/sr)+1)*sr:lr===0&&or===sr-1&&(or=sr-2,lr=1);let cr,hr;this.closed||or>0?cr=nr[(or-1)%sr]:(tmp.subVectors(nr[0],nr[1]).add(nr[0]),cr=tmp);const fr=nr[or%sr],ur=nr[(or+1)%sr];if(this.closed||or+2<sr?hr=nr[(or+2)%sr]:(tmp.subVectors(nr[sr-1],nr[sr-2]).add(nr[sr-1]),hr=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const pr=this.curveType==="chordal"?.5:.25;let gr=Math.pow(cr.distanceToSquared(fr),pr),_r=Math.pow(fr.distanceToSquared(ur),pr),mr=Math.pow(ur.distanceToSquared(hr),pr);_r<1e-4&&(_r=1),gr<1e-4&&(gr=_r),mr<1e-4&&(mr=_r),px.initNonuniformCatmullRom(cr.x,fr.x,ur.x,hr.x,gr,_r,mr),py.initNonuniformCatmullRom(cr.y,fr.y,ur.y,hr.y,gr,_r,mr),pz.initNonuniformCatmullRom(cr.z,fr.z,ur.z,hr.z,gr,_r,mr)}else this.curveType==="catmullrom"&&(px.initCatmullRom(cr.x,fr.x,ur.x,hr.x,this.tension),py.initCatmullRom(cr.y,fr.y,ur.y,hr.y,this.tension),pz.initCatmullRom(cr.z,fr.z,ur.z,hr.z,this.tension));return rr.set(px.calc(lr),py.calc(lr),pz.calc(lr)),rr}copy(er){super.copy(er),this.points=[];for(let tr=0,rr=er.points.length;tr<rr;tr++){const nr=er.points[tr];this.points.push(nr.clone())}return this.closed=er.closed,this.curveType=er.curveType,this.tension=er.tension,this}toJSON(){const er=super.toJSON();er.points=[];for(let tr=0,rr=this.points.length;tr<rr;tr++){const nr=this.points[tr];er.points.push(nr.toArray())}return er.closed=this.closed,er.curveType=this.curveType,er.tension=this.tension,er}fromJSON(er){super.fromJSON(er),this.points=[];for(let tr=0,rr=er.points.length;tr<rr;tr++){const nr=er.points[tr];this.points.push(new Vector3$1().fromArray(nr))}return this.closed=er.closed,this.curveType=er.curveType,this.tension=er.tension,this}}function CatmullRom(ir,er,tr,rr,nr){const sr=(rr-er)*.5,ar=(nr-tr)*.5,or=ir*ir,lr=ir*or;return(2*tr-2*rr+sr+ar)*lr+(-3*tr+3*rr-2*sr-ar)*or+sr*ir+tr}function QuadraticBezierP0(ir,er){const tr=1-ir;return tr*tr*er}function QuadraticBezierP1(ir,er){return 2*(1-ir)*ir*er}function QuadraticBezierP2(ir,er){return ir*ir*er}function QuadraticBezier(ir,er,tr,rr){return QuadraticBezierP0(ir,er)+QuadraticBezierP1(ir,tr)+QuadraticBezierP2(ir,rr)}function CubicBezierP0(ir,er){const tr=1-ir;return tr*tr*tr*er}function CubicBezierP1(ir,er){const tr=1-ir;return 3*tr*tr*ir*er}function CubicBezierP2(ir,er){return 3*(1-ir)*ir*ir*er}function CubicBezierP3(ir,er){return ir*ir*ir*er}function CubicBezier(ir,er,tr,rr,nr){return CubicBezierP0(ir,er)+CubicBezierP1(ir,tr)+CubicBezierP2(ir,rr)+CubicBezierP3(ir,nr)}class CubicBezierCurve extends Curve{constructor(er=new Vector2,tr=new Vector2,rr=new Vector2,nr=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=er,this.v1=tr,this.v2=rr,this.v3=nr}getPoint(er,tr=new Vector2){const rr=tr,nr=this.v0,sr=this.v1,ar=this.v2,or=this.v3;return rr.set(CubicBezier(er,nr.x,sr.x,ar.x,or.x),CubicBezier(er,nr.y,sr.y,ar.y,or.y)),rr}copy(er){return super.copy(er),this.v0.copy(er.v0),this.v1.copy(er.v1),this.v2.copy(er.v2),this.v3.copy(er.v3),this}toJSON(){const er=super.toJSON();return er.v0=this.v0.toArray(),er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er.v3=this.v3.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v0.fromArray(er.v0),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this.v3.fromArray(er.v3),this}}class CubicBezierCurve3 extends Curve{constructor(er=new Vector3$1,tr=new Vector3$1,rr=new Vector3$1,nr=new Vector3$1){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=er,this.v1=tr,this.v2=rr,this.v3=nr}getPoint(er,tr=new Vector3$1){const rr=tr,nr=this.v0,sr=this.v1,ar=this.v2,or=this.v3;return rr.set(CubicBezier(er,nr.x,sr.x,ar.x,or.x),CubicBezier(er,nr.y,sr.y,ar.y,or.y),CubicBezier(er,nr.z,sr.z,ar.z,or.z)),rr}copy(er){return super.copy(er),this.v0.copy(er.v0),this.v1.copy(er.v1),this.v2.copy(er.v2),this.v3.copy(er.v3),this}toJSON(){const er=super.toJSON();return er.v0=this.v0.toArray(),er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er.v3=this.v3.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v0.fromArray(er.v0),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this.v3.fromArray(er.v3),this}}class LineCurve extends Curve{constructor(er=new Vector2,tr=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=er,this.v2=tr}getPoint(er,tr=new Vector2){const rr=tr;return er===1?rr.copy(this.v2):(rr.copy(this.v2).sub(this.v1),rr.multiplyScalar(er).add(this.v1)),rr}getPointAt(er,tr){return this.getPoint(er,tr)}getTangent(er,tr=new Vector2){return tr.subVectors(this.v2,this.v1).normalize()}getTangentAt(er,tr){return this.getTangent(er,tr)}copy(er){return super.copy(er),this.v1.copy(er.v1),this.v2.copy(er.v2),this}toJSON(){const er=super.toJSON();return er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this}}class LineCurve3 extends Curve{constructor(er=new Vector3$1,tr=new Vector3$1){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=er,this.v2=tr}getPoint(er,tr=new Vector3$1){const rr=tr;return er===1?rr.copy(this.v2):(rr.copy(this.v2).sub(this.v1),rr.multiplyScalar(er).add(this.v1)),rr}getPointAt(er,tr){return this.getPoint(er,tr)}getTangent(er,tr=new Vector3$1){return tr.subVectors(this.v2,this.v1).normalize()}getTangentAt(er,tr){return this.getTangent(er,tr)}copy(er){return super.copy(er),this.v1.copy(er.v1),this.v2.copy(er.v2),this}toJSON(){const er=super.toJSON();return er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this}}class QuadraticBezierCurve extends Curve{constructor(er=new Vector2,tr=new Vector2,rr=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=er,this.v1=tr,this.v2=rr}getPoint(er,tr=new Vector2){const rr=tr,nr=this.v0,sr=this.v1,ar=this.v2;return rr.set(QuadraticBezier(er,nr.x,sr.x,ar.x),QuadraticBezier(er,nr.y,sr.y,ar.y)),rr}copy(er){return super.copy(er),this.v0.copy(er.v0),this.v1.copy(er.v1),this.v2.copy(er.v2),this}toJSON(){const er=super.toJSON();return er.v0=this.v0.toArray(),er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v0.fromArray(er.v0),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(er=new Vector3$1,tr=new Vector3$1,rr=new Vector3$1){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=er,this.v1=tr,this.v2=rr}getPoint(er,tr=new Vector3$1){const rr=tr,nr=this.v0,sr=this.v1,ar=this.v2;return rr.set(QuadraticBezier(er,nr.x,sr.x,ar.x),QuadraticBezier(er,nr.y,sr.y,ar.y),QuadraticBezier(er,nr.z,sr.z,ar.z)),rr}copy(er){return super.copy(er),this.v0.copy(er.v0),this.v1.copy(er.v1),this.v2.copy(er.v2),this}toJSON(){const er=super.toJSON();return er.v0=this.v0.toArray(),er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v0.fromArray(er.v0),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this}}class SplineCurve extends Curve{constructor(er=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=er}getPoint(er,tr=new Vector2){const rr=tr,nr=this.points,sr=(nr.length-1)*er,ar=Math.floor(sr),or=sr-ar,lr=nr[ar===0?ar:ar-1],cr=nr[ar],hr=nr[ar>nr.length-2?nr.length-1:ar+1],fr=nr[ar>nr.length-3?nr.length-1:ar+2];return rr.set(CatmullRom(or,lr.x,cr.x,hr.x,fr.x),CatmullRom(or,lr.y,cr.y,hr.y,fr.y)),rr}copy(er){super.copy(er),this.points=[];for(let tr=0,rr=er.points.length;tr<rr;tr++){const nr=er.points[tr];this.points.push(nr.clone())}return this}toJSON(){const er=super.toJSON();er.points=[];for(let tr=0,rr=this.points.length;tr<rr;tr++){const nr=this.points[tr];er.points.push(nr.toArray())}return er}fromJSON(er){super.fromJSON(er),this.points=[];for(let tr=0,rr=er.points.length;tr<rr;tr++){const nr=er.points[tr];this.points.push(new Vector2().fromArray(nr))}return this}}var Curves$1=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(er){this.curves.push(er)}closePath(){const er=this.curves[0].getPoint(0),tr=this.curves[this.curves.length-1].getPoint(1);if(!er.equals(tr)){const rr=er.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Curves$1[rr](tr,er))}return this}getPoint(er,tr){const rr=er*this.getLength(),nr=this.getCurveLengths();let sr=0;for(;sr<nr.length;){if(nr[sr]>=rr){const ar=nr[sr]-rr,or=this.curves[sr],lr=or.getLength(),cr=lr===0?0:1-ar/lr;return or.getPointAt(cr,tr)}sr++}return null}getLength(){const er=this.getCurveLengths();return er[er.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const er=[];let tr=0;for(let rr=0,nr=this.curves.length;rr<nr;rr++)tr+=this.curves[rr].getLength(),er.push(tr);return this.cacheLengths=er,er}getSpacedPoints(er=40){const tr=[];for(let rr=0;rr<=er;rr++)tr.push(this.getPoint(rr/er));return this.autoClose&&tr.push(tr[0]),tr}getPoints(er=12){const tr=[];let rr;for(let nr=0,sr=this.curves;nr<sr.length;nr++){const ar=sr[nr],or=ar.isEllipseCurve?er*2:ar.isLineCurve||ar.isLineCurve3?1:ar.isSplineCurve?er*ar.points.length:er,lr=ar.getPoints(or);for(let cr=0;cr<lr.length;cr++){const hr=lr[cr];rr&&rr.equals(hr)||(tr.push(hr),rr=hr)}}return this.autoClose&&tr.length>1&&!tr[tr.length-1].equals(tr[0])&&tr.push(tr[0]),tr}copy(er){super.copy(er),this.curves=[];for(let tr=0,rr=er.curves.length;tr<rr;tr++){const nr=er.curves[tr];this.curves.push(nr.clone())}return this.autoClose=er.autoClose,this}toJSON(){const er=super.toJSON();er.autoClose=this.autoClose,er.curves=[];for(let tr=0,rr=this.curves.length;tr<rr;tr++){const nr=this.curves[tr];er.curves.push(nr.toJSON())}return er}fromJSON(er){super.fromJSON(er),this.autoClose=er.autoClose,this.curves=[];for(let tr=0,rr=er.curves.length;tr<rr;tr++){const nr=er.curves[tr];this.curves.push(new Curves$1[nr.type]().fromJSON(nr))}return this}}let Path$1=class extends CurvePath{constructor(er){super(),this.type="Path",this.currentPoint=new Vector2,er&&this.setFromPoints(er)}setFromPoints(er){this.moveTo(er[0].x,er[0].y);for(let tr=1,rr=er.length;tr<rr;tr++)this.lineTo(er[tr].x,er[tr].y);return this}moveTo(er,tr){return this.currentPoint.set(er,tr),this}lineTo(er,tr){const rr=new LineCurve(this.currentPoint.clone(),new Vector2(er,tr));return this.curves.push(rr),this.currentPoint.set(er,tr),this}quadraticCurveTo(er,tr,rr,nr){const sr=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(er,tr),new Vector2(rr,nr));return this.curves.push(sr),this.currentPoint.set(rr,nr),this}bezierCurveTo(er,tr,rr,nr,sr,ar){const or=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(er,tr),new Vector2(rr,nr),new Vector2(sr,ar));return this.curves.push(or),this.currentPoint.set(sr,ar),this}splineThru(er){const tr=[this.currentPoint.clone()].concat(er),rr=new SplineCurve(tr);return this.curves.push(rr),this.currentPoint.copy(er[er.length-1]),this}arc(er,tr,rr,nr,sr,ar){const or=this.currentPoint.x,lr=this.currentPoint.y;return this.absarc(er+or,tr+lr,rr,nr,sr,ar),this}absarc(er,tr,rr,nr,sr,ar){return this.absellipse(er,tr,rr,rr,nr,sr,ar),this}ellipse(er,tr,rr,nr,sr,ar,or,lr){const cr=this.currentPoint.x,hr=this.currentPoint.y;return this.absellipse(er+cr,tr+hr,rr,nr,sr,ar,or,lr),this}absellipse(er,tr,rr,nr,sr,ar,or,lr){const cr=new EllipseCurve(er,tr,rr,nr,sr,ar,or,lr);if(this.curves.length>0){const fr=cr.getPoint(0);fr.equals(this.currentPoint)||this.lineTo(fr.x,fr.y)}this.curves.push(cr);const hr=cr.getPoint(1);return this.currentPoint.copy(hr),this}copy(er){return super.copy(er),this.currentPoint.copy(er.currentPoint),this}toJSON(){const er=super.toJSON();return er.currentPoint=this.currentPoint.toArray(),er}fromJSON(er){return super.fromJSON(er),this.currentPoint.fromArray(er.currentPoint),this}};class LatheGeometry extends BufferGeometry{constructor(er=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],tr=12,rr=0,nr=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:er,segments:tr,phiStart:rr,phiLength:nr},tr=Math.floor(tr),nr=clamp(nr,0,Math.PI*2);const sr=[],ar=[],or=[],lr=[],cr=[],hr=1/tr,fr=new Vector3$1,ur=new Vector2,pr=new Vector3$1,gr=new Vector3$1,_r=new Vector3$1;let mr=0,dr=0;for(let vr=0;vr<=er.length-1;vr++)switch(vr){case 0:mr=er[vr+1].x-er[vr].x,dr=er[vr+1].y-er[vr].y,pr.x=dr*1,pr.y=-mr,pr.z=dr*0,_r.copy(pr),pr.normalize(),lr.push(pr.x,pr.y,pr.z);break;case er.length-1:lr.push(_r.x,_r.y,_r.z);break;default:mr=er[vr+1].x-er[vr].x,dr=er[vr+1].y-er[vr].y,pr.x=dr*1,pr.y=-mr,pr.z=dr*0,gr.copy(pr),pr.x+=_r.x,pr.y+=_r.y,pr.z+=_r.z,pr.normalize(),lr.push(pr.x,pr.y,pr.z),_r.copy(gr)}for(let vr=0;vr<=tr;vr++){const Ar=rr+vr*hr*nr,yr=Math.sin(Ar),wr=Math.cos(Ar);for(let br=0;br<=er.length-1;br++){fr.x=er[br].x*yr,fr.y=er[br].y,fr.z=er[br].x*wr,ar.push(fr.x,fr.y,fr.z),ur.x=vr/tr,ur.y=br/(er.length-1),or.push(ur.x,ur.y);const Sr=lr[3*br+0]*yr,xr=lr[3*br+1],Cr=lr[3*br+0]*wr;cr.push(Sr,xr,Cr)}}for(let vr=0;vr<tr;vr++)for(let Ar=0;Ar<er.length-1;Ar++){const yr=Ar+vr*er.length,wr=yr,br=yr+er.length,Sr=yr+er.length+1,xr=yr+1;sr.push(wr,br,xr),sr.push(Sr,xr,br)}this.setIndex(sr),this.setAttribute("position",new Float32BufferAttribute(ar,3)),this.setAttribute("uv",new Float32BufferAttribute(or,2)),this.setAttribute("normal",new Float32BufferAttribute(cr,3))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new LatheGeometry(er.points,er.segments,er.phiStart,er.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(er=1,tr=1,rr=4,nr=8){const sr=new Path$1;sr.absarc(0,-tr/2,er,Math.PI*1.5,0),sr.absarc(0,tr/2,er,0,Math.PI*.5),super(sr.getPoints(rr),nr),this.type="CapsuleGeometry",this.parameters={radius:er,length:tr,capSegments:rr,radialSegments:nr}}static fromJSON(er){return new CapsuleGeometry(er.radius,er.length,er.capSegments,er.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(er=1,tr=32,rr=0,nr=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:er,segments:tr,thetaStart:rr,thetaLength:nr},tr=Math.max(3,tr);const sr=[],ar=[],or=[],lr=[],cr=new Vector3$1,hr=new Vector2;ar.push(0,0,0),or.push(0,0,1),lr.push(.5,.5);for(let fr=0,ur=3;fr<=tr;fr++,ur+=3){const pr=rr+fr/tr*nr;cr.x=er*Math.cos(pr),cr.y=er*Math.sin(pr),ar.push(cr.x,cr.y,cr.z),or.push(0,0,1),hr.x=(ar[ur]/er+1)/2,hr.y=(ar[ur+1]/er+1)/2,lr.push(hr.x,hr.y)}for(let fr=1;fr<=tr;fr++)sr.push(fr,fr+1,0);this.setIndex(sr),this.setAttribute("position",new Float32BufferAttribute(ar,3)),this.setAttribute("normal",new Float32BufferAttribute(or,3)),this.setAttribute("uv",new Float32BufferAttribute(lr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new CircleGeometry(er.radius,er.segments,er.thetaStart,er.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(er=1,tr=1,rr=1,nr=32,sr=1,ar=!1,or=0,lr=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:er,radiusBottom:tr,height:rr,radialSegments:nr,heightSegments:sr,openEnded:ar,thetaStart:or,thetaLength:lr};const cr=this;nr=Math.floor(nr),sr=Math.floor(sr);const hr=[],fr=[],ur=[],pr=[];let gr=0;const _r=[],mr=rr/2;let dr=0;vr(),ar===!1&&(er>0&&Ar(!0),tr>0&&Ar(!1)),this.setIndex(hr),this.setAttribute("position",new Float32BufferAttribute(fr,3)),this.setAttribute("normal",new Float32BufferAttribute(ur,3)),this.setAttribute("uv",new Float32BufferAttribute(pr,2));function vr(){const yr=new Vector3$1,wr=new Vector3$1;let br=0;const Sr=(tr-er)/rr;for(let xr=0;xr<=sr;xr++){const Cr=[],Ir=xr/sr,Rr=Ir*(tr-er)+er;for(let Pr=0;Pr<=nr;Pr++){const Fr=Pr/nr,Nr=Fr*lr+or,Ur=Math.sin(Nr),Br=Math.cos(Nr);wr.x=Rr*Ur,wr.y=-Ir*rr+mr,wr.z=Rr*Br,fr.push(wr.x,wr.y,wr.z),yr.set(Ur,Sr,Br).normalize(),ur.push(yr.x,yr.y,yr.z),pr.push(Fr,1-Ir),Cr.push(gr++)}_r.push(Cr)}for(let xr=0;xr<nr;xr++)for(let Cr=0;Cr<sr;Cr++){const Ir=_r[Cr][xr],Rr=_r[Cr+1][xr],Pr=_r[Cr+1][xr+1],Fr=_r[Cr][xr+1];(er>0||Cr!==0)&&(hr.push(Ir,Rr,Fr),br+=3),(tr>0||Cr!==sr-1)&&(hr.push(Rr,Pr,Fr),br+=3)}cr.addGroup(dr,br,0),dr+=br}function Ar(yr){const wr=gr,br=new Vector2,Sr=new Vector3$1;let xr=0;const Cr=yr===!0?er:tr,Ir=yr===!0?1:-1;for(let Pr=1;Pr<=nr;Pr++)fr.push(0,mr*Ir,0),ur.push(0,Ir,0),pr.push(.5,.5),gr++;const Rr=gr;for(let Pr=0;Pr<=nr;Pr++){const Nr=Pr/nr*lr+or,Ur=Math.cos(Nr),Br=Math.sin(Nr);Sr.x=Cr*Br,Sr.y=mr*Ir,Sr.z=Cr*Ur,fr.push(Sr.x,Sr.y,Sr.z),ur.push(0,Ir,0),br.x=Ur*.5+.5,br.y=Br*.5*Ir+.5,pr.push(br.x,br.y),gr++}for(let Pr=0;Pr<nr;Pr++){const Fr=wr+Pr,Nr=Rr+Pr;yr===!0?hr.push(Nr,Nr+1,Fr):hr.push(Nr+1,Nr,Fr),xr+=3}cr.addGroup(dr,xr,yr===!0?1:2),dr+=xr}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new CylinderGeometry(er.radiusTop,er.radiusBottom,er.height,er.radialSegments,er.heightSegments,er.openEnded,er.thetaStart,er.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(er=1,tr=1,rr=32,nr=1,sr=!1,ar=0,or=Math.PI*2){super(0,er,tr,rr,nr,sr,ar,or),this.type="ConeGeometry",this.parameters={radius:er,height:tr,radialSegments:rr,heightSegments:nr,openEnded:sr,thetaStart:ar,thetaLength:or}}static fromJSON(er){return new ConeGeometry(er.radius,er.height,er.radialSegments,er.heightSegments,er.openEnded,er.thetaStart,er.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(er=[],tr=[],rr=1,nr=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:er,indices:tr,radius:rr,detail:nr};const sr=[],ar=[];or(nr),cr(rr),hr(),this.setAttribute("position",new Float32BufferAttribute(sr,3)),this.setAttribute("normal",new Float32BufferAttribute(sr.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(ar,2)),nr===0?this.computeVertexNormals():this.normalizeNormals();function or(vr){const Ar=new Vector3$1,yr=new Vector3$1,wr=new Vector3$1;for(let br=0;br<tr.length;br+=3)pr(tr[br+0],Ar),pr(tr[br+1],yr),pr(tr[br+2],wr),lr(Ar,yr,wr,vr)}function lr(vr,Ar,yr,wr){const br=wr+1,Sr=[];for(let xr=0;xr<=br;xr++){Sr[xr]=[];const Cr=vr.clone().lerp(yr,xr/br),Ir=Ar.clone().lerp(yr,xr/br),Rr=br-xr;for(let Pr=0;Pr<=Rr;Pr++)Pr===0&&xr===br?Sr[xr][Pr]=Cr:Sr[xr][Pr]=Cr.clone().lerp(Ir,Pr/Rr)}for(let xr=0;xr<br;xr++)for(let Cr=0;Cr<2*(br-xr)-1;Cr++){const Ir=Math.floor(Cr/2);Cr%2===0?(ur(Sr[xr][Ir+1]),ur(Sr[xr+1][Ir]),ur(Sr[xr][Ir])):(ur(Sr[xr][Ir+1]),ur(Sr[xr+1][Ir+1]),ur(Sr[xr+1][Ir]))}}function cr(vr){const Ar=new Vector3$1;for(let yr=0;yr<sr.length;yr+=3)Ar.x=sr[yr+0],Ar.y=sr[yr+1],Ar.z=sr[yr+2],Ar.normalize().multiplyScalar(vr),sr[yr+0]=Ar.x,sr[yr+1]=Ar.y,sr[yr+2]=Ar.z}function hr(){const vr=new Vector3$1;for(let Ar=0;Ar<sr.length;Ar+=3){vr.x=sr[Ar+0],vr.y=sr[Ar+1],vr.z=sr[Ar+2];const yr=mr(vr)/2/Math.PI+.5,wr=dr(vr)/Math.PI+.5;ar.push(yr,1-wr)}gr(),fr()}function fr(){for(let vr=0;vr<ar.length;vr+=6){const Ar=ar[vr+0],yr=ar[vr+2],wr=ar[vr+4],br=Math.max(Ar,yr,wr),Sr=Math.min(Ar,yr,wr);br>.9&&Sr<.1&&(Ar<.2&&(ar[vr+0]+=1),yr<.2&&(ar[vr+2]+=1),wr<.2&&(ar[vr+4]+=1))}}function ur(vr){sr.push(vr.x,vr.y,vr.z)}function pr(vr,Ar){const yr=vr*3;Ar.x=er[yr+0],Ar.y=er[yr+1],Ar.z=er[yr+2]}function gr(){const vr=new Vector3$1,Ar=new Vector3$1,yr=new Vector3$1,wr=new Vector3$1,br=new Vector2,Sr=new Vector2,xr=new Vector2;for(let Cr=0,Ir=0;Cr<sr.length;Cr+=9,Ir+=6){vr.set(sr[Cr+0],sr[Cr+1],sr[Cr+2]),Ar.set(sr[Cr+3],sr[Cr+4],sr[Cr+5]),yr.set(sr[Cr+6],sr[Cr+7],sr[Cr+8]),br.set(ar[Ir+0],ar[Ir+1]),Sr.set(ar[Ir+2],ar[Ir+3]),xr.set(ar[Ir+4],ar[Ir+5]),wr.copy(vr).add(Ar).add(yr).divideScalar(3);const Rr=mr(wr);_r(br,Ir+0,vr,Rr),_r(Sr,Ir+2,Ar,Rr),_r(xr,Ir+4,yr,Rr)}}function _r(vr,Ar,yr,wr){wr<0&&vr.x===1&&(ar[Ar]=vr.x-1),yr.x===0&&yr.z===0&&(ar[Ar]=wr/2/Math.PI+.5)}function mr(vr){return Math.atan2(vr.z,-vr.x)}function dr(vr){return Math.atan2(-vr.y,Math.sqrt(vr.x*vr.x+vr.z*vr.z))}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new PolyhedronGeometry(er.vertices,er.indices,er.radius,er.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(er=1,tr=0){const rr=(1+Math.sqrt(5))/2,nr=1/rr,sr=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-nr,-rr,0,-nr,rr,0,nr,-rr,0,nr,rr,-nr,-rr,0,-nr,rr,0,nr,-rr,0,nr,rr,0,-rr,0,-nr,rr,0,-nr,-rr,0,nr,rr,0,nr],ar=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(sr,ar,er,tr),this.type="DodecahedronGeometry",this.parameters={radius:er,detail:tr}}static fromJSON(er){return new DodecahedronGeometry(er.radius,er.detail)}}const _v0$3=new Vector3$1,_v1$1$1=new Vector3$1,_normal=new Vector3$1,_triangle$1=new Triangle$2;class EdgesGeometry extends BufferGeometry{constructor(er=null,tr=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:er,thresholdAngle:tr},er!==null){const nr=Math.pow(10,4),sr=Math.cos(DEG2RAD*tr),ar=er.getIndex(),or=er.getAttribute("position"),lr=ar?ar.count:or.count,cr=[0,0,0],hr=["a","b","c"],fr=new Array(3),ur={},pr=[];for(let gr=0;gr<lr;gr+=3){ar?(cr[0]=ar.getX(gr),cr[1]=ar.getX(gr+1),cr[2]=ar.getX(gr+2)):(cr[0]=gr,cr[1]=gr+1,cr[2]=gr+2);const{a:_r,b:mr,c:dr}=_triangle$1;if(_r.fromBufferAttribute(or,cr[0]),mr.fromBufferAttribute(or,cr[1]),dr.fromBufferAttribute(or,cr[2]),_triangle$1.getNormal(_normal),fr[0]=`${Math.round(_r.x*nr)},${Math.round(_r.y*nr)},${Math.round(_r.z*nr)}`,fr[1]=`${Math.round(mr.x*nr)},${Math.round(mr.y*nr)},${Math.round(mr.z*nr)}`,fr[2]=`${Math.round(dr.x*nr)},${Math.round(dr.y*nr)},${Math.round(dr.z*nr)}`,!(fr[0]===fr[1]||fr[1]===fr[2]||fr[2]===fr[0]))for(let vr=0;vr<3;vr++){const Ar=(vr+1)%3,yr=fr[vr],wr=fr[Ar],br=_triangle$1[hr[vr]],Sr=_triangle$1[hr[Ar]],xr=`${yr}_${wr}`,Cr=`${wr}_${yr}`;Cr in ur&&ur[Cr]?(_normal.dot(ur[Cr].normal)<=sr&&(pr.push(br.x,br.y,br.z),pr.push(Sr.x,Sr.y,Sr.z)),ur[Cr]=null):xr in ur||(ur[xr]={index0:cr[vr],index1:cr[Ar],normal:_normal.clone()})}}for(const gr in ur)if(ur[gr]){const{index0:_r,index1:mr}=ur[gr];_v0$3.fromBufferAttribute(or,_r),_v1$1$1.fromBufferAttribute(or,mr),pr.push(_v0$3.x,_v0$3.y,_v0$3.z),pr.push(_v1$1$1.x,_v1$1$1.y,_v1$1$1.z)}this.setAttribute("position",new Float32BufferAttribute(pr,3))}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}}let Shape$1=class extends Path$1{constructor(er){super(er),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(er){const tr=[];for(let rr=0,nr=this.holes.length;rr<nr;rr++)tr[rr]=this.holes[rr].getPoints(er);return tr}extractPoints(er){return{shape:this.getPoints(er),holes:this.getPointsHoles(er)}}copy(er){super.copy(er),this.holes=[];for(let tr=0,rr=er.holes.length;tr<rr;tr++){const nr=er.holes[tr];this.holes.push(nr.clone())}return this}toJSON(){const er=super.toJSON();er.uuid=this.uuid,er.holes=[];for(let tr=0,rr=this.holes.length;tr<rr;tr++){const nr=this.holes[tr];er.holes.push(nr.toJSON())}return er}fromJSON(er){super.fromJSON(er),this.uuid=er.uuid,this.holes=[];for(let tr=0,rr=er.holes.length;tr<rr;tr++){const nr=er.holes[tr];this.holes.push(new Path$1().fromJSON(nr))}return this}};const Earcut={triangulate:function(ir,er,tr=2){const rr=er&&er.length,nr=rr?er[0]*tr:ir.length;let sr=linkedList(ir,0,nr,tr,!0);const ar=[];if(!sr||sr.next===sr.prev)return ar;let or,lr,cr,hr,fr,ur,pr;if(rr&&(sr=eliminateHoles(ir,er,sr,tr)),ir.length>80*tr){or=cr=ir[0],lr=hr=ir[1];for(let gr=tr;gr<nr;gr+=tr)fr=ir[gr],ur=ir[gr+1],fr<or&&(or=fr),ur<lr&&(lr=ur),fr>cr&&(cr=fr),ur>hr&&(hr=ur);pr=Math.max(cr-or,hr-lr),pr=pr!==0?32767/pr:0}return earcutLinked(sr,ar,tr,or,lr,pr,0),ar}};function linkedList(ir,er,tr,rr,nr){let sr,ar;if(nr===signedArea(ir,er,tr,rr)>0)for(sr=er;sr<tr;sr+=rr)ar=insertNode(sr,ir[sr],ir[sr+1],ar);else for(sr=tr-rr;sr>=er;sr-=rr)ar=insertNode(sr,ir[sr],ir[sr+1],ar);return ar&&equals$1(ar,ar.next)&&(removeNode(ar),ar=ar.next),ar}function filterPoints(ir,er){if(!ir)return ir;er||(er=ir);let tr=ir,rr;do if(rr=!1,!tr.steiner&&(equals$1(tr,tr.next)||area(tr.prev,tr,tr.next)===0)){if(removeNode(tr),tr=er=tr.prev,tr===tr.next)break;rr=!0}else tr=tr.next;while(rr||tr!==er);return er}function earcutLinked(ir,er,tr,rr,nr,sr,ar){if(!ir)return;!ar&&sr&&indexCurve(ir,rr,nr,sr);let or=ir,lr,cr;for(;ir.prev!==ir.next;){if(lr=ir.prev,cr=ir.next,sr?isEarHashed(ir,rr,nr,sr):isEar(ir)){er.push(lr.i/tr|0),er.push(ir.i/tr|0),er.push(cr.i/tr|0),removeNode(ir),ir=cr.next,or=cr.next;continue}if(ir=cr,ir===or){ar?ar===1?(ir=cureLocalIntersections(filterPoints(ir),er,tr),earcutLinked(ir,er,tr,rr,nr,sr,2)):ar===2&&splitEarcut(ir,er,tr,rr,nr,sr):earcutLinked(filterPoints(ir),er,tr,rr,nr,sr,1);break}}}function isEar(ir){const er=ir.prev,tr=ir,rr=ir.next;if(area(er,tr,rr)>=0)return!1;const nr=er.x,sr=tr.x,ar=rr.x,or=er.y,lr=tr.y,cr=rr.y,hr=nr<sr?nr<ar?nr:ar:sr<ar?sr:ar,fr=or<lr?or<cr?or:cr:lr<cr?lr:cr,ur=nr>sr?nr>ar?nr:ar:sr>ar?sr:ar,pr=or>lr?or>cr?or:cr:lr>cr?lr:cr;let gr=rr.next;for(;gr!==er;){if(gr.x>=hr&&gr.x<=ur&&gr.y>=fr&&gr.y<=pr&&pointInTriangle(nr,or,sr,lr,ar,cr,gr.x,gr.y)&&area(gr.prev,gr,gr.next)>=0)return!1;gr=gr.next}return!0}function isEarHashed(ir,er,tr,rr){const nr=ir.prev,sr=ir,ar=ir.next;if(area(nr,sr,ar)>=0)return!1;const or=nr.x,lr=sr.x,cr=ar.x,hr=nr.y,fr=sr.y,ur=ar.y,pr=or<lr?or<cr?or:cr:lr<cr?lr:cr,gr=hr<fr?hr<ur?hr:ur:fr<ur?fr:ur,_r=or>lr?or>cr?or:cr:lr>cr?lr:cr,mr=hr>fr?hr>ur?hr:ur:fr>ur?fr:ur,dr=zOrder(pr,gr,er,tr,rr),vr=zOrder(_r,mr,er,tr,rr);let Ar=ir.prevZ,yr=ir.nextZ;for(;Ar&&Ar.z>=dr&&yr&&yr.z<=vr;){if(Ar.x>=pr&&Ar.x<=_r&&Ar.y>=gr&&Ar.y<=mr&&Ar!==nr&&Ar!==ar&&pointInTriangle(or,hr,lr,fr,cr,ur,Ar.x,Ar.y)&&area(Ar.prev,Ar,Ar.next)>=0||(Ar=Ar.prevZ,yr.x>=pr&&yr.x<=_r&&yr.y>=gr&&yr.y<=mr&&yr!==nr&&yr!==ar&&pointInTriangle(or,hr,lr,fr,cr,ur,yr.x,yr.y)&&area(yr.prev,yr,yr.next)>=0))return!1;yr=yr.nextZ}for(;Ar&&Ar.z>=dr;){if(Ar.x>=pr&&Ar.x<=_r&&Ar.y>=gr&&Ar.y<=mr&&Ar!==nr&&Ar!==ar&&pointInTriangle(or,hr,lr,fr,cr,ur,Ar.x,Ar.y)&&area(Ar.prev,Ar,Ar.next)>=0)return!1;Ar=Ar.prevZ}for(;yr&&yr.z<=vr;){if(yr.x>=pr&&yr.x<=_r&&yr.y>=gr&&yr.y<=mr&&yr!==nr&&yr!==ar&&pointInTriangle(or,hr,lr,fr,cr,ur,yr.x,yr.y)&&area(yr.prev,yr,yr.next)>=0)return!1;yr=yr.nextZ}return!0}function cureLocalIntersections(ir,er,tr){let rr=ir;do{const nr=rr.prev,sr=rr.next.next;!equals$1(nr,sr)&&intersects(nr,rr,rr.next,sr)&&locallyInside(nr,sr)&&locallyInside(sr,nr)&&(er.push(nr.i/tr|0),er.push(rr.i/tr|0),er.push(sr.i/tr|0),removeNode(rr),removeNode(rr.next),rr=ir=sr),rr=rr.next}while(rr!==ir);return filterPoints(rr)}function splitEarcut(ir,er,tr,rr,nr,sr){let ar=ir;do{let or=ar.next.next;for(;or!==ar.prev;){if(ar.i!==or.i&&isValidDiagonal(ar,or)){let lr=splitPolygon(ar,or);ar=filterPoints(ar,ar.next),lr=filterPoints(lr,lr.next),earcutLinked(ar,er,tr,rr,nr,sr,0),earcutLinked(lr,er,tr,rr,nr,sr,0);return}or=or.next}ar=ar.next}while(ar!==ir)}function eliminateHoles(ir,er,tr,rr){const nr=[];let sr,ar,or,lr,cr;for(sr=0,ar=er.length;sr<ar;sr++)or=er[sr]*rr,lr=sr<ar-1?er[sr+1]*rr:ir.length,cr=linkedList(ir,or,lr,rr,!1),cr===cr.next&&(cr.steiner=!0),nr.push(getLeftmost(cr));for(nr.sort(compareX),sr=0;sr<nr.length;sr++)tr=eliminateHole(nr[sr],tr);return tr}function compareX(ir,er){return ir.x-er.x}function eliminateHole(ir,er){const tr=findHoleBridge(ir,er);if(!tr)return er;const rr=splitPolygon(tr,ir);return filterPoints(rr,rr.next),filterPoints(tr,tr.next)}function findHoleBridge(ir,er){let tr=er,rr=-1/0,nr;const sr=ir.x,ar=ir.y;do{if(ar<=tr.y&&ar>=tr.next.y&&tr.next.y!==tr.y){const ur=tr.x+(ar-tr.y)*(tr.next.x-tr.x)/(tr.next.y-tr.y);if(ur<=sr&&ur>rr&&(rr=ur,nr=tr.x<tr.next.x?tr:tr.next,ur===sr))return nr}tr=tr.next}while(tr!==er);if(!nr)return null;const or=nr,lr=nr.x,cr=nr.y;let hr=1/0,fr;tr=nr;do sr>=tr.x&&tr.x>=lr&&sr!==tr.x&&pointInTriangle(ar<cr?sr:rr,ar,lr,cr,ar<cr?rr:sr,ar,tr.x,tr.y)&&(fr=Math.abs(ar-tr.y)/(sr-tr.x),locallyInside(tr,ir)&&(fr<hr||fr===hr&&(tr.x>nr.x||tr.x===nr.x&&sectorContainsSector(nr,tr)))&&(nr=tr,hr=fr)),tr=tr.next;while(tr!==or);return nr}function sectorContainsSector(ir,er){return area(ir.prev,ir,er.prev)<0&&area(er.next,ir,ir.next)<0}function indexCurve(ir,er,tr,rr){let nr=ir;do nr.z===0&&(nr.z=zOrder(nr.x,nr.y,er,tr,rr)),nr.prevZ=nr.prev,nr.nextZ=nr.next,nr=nr.next;while(nr!==ir);nr.prevZ.nextZ=null,nr.prevZ=null,sortLinked(nr)}function sortLinked(ir){let er,tr,rr,nr,sr,ar,or,lr,cr=1;do{for(tr=ir,ir=null,sr=null,ar=0;tr;){for(ar++,rr=tr,or=0,er=0;er<cr&&(or++,rr=rr.nextZ,!!rr);er++);for(lr=cr;or>0||lr>0&&rr;)or!==0&&(lr===0||!rr||tr.z<=rr.z)?(nr=tr,tr=tr.nextZ,or--):(nr=rr,rr=rr.nextZ,lr--),sr?sr.nextZ=nr:ir=nr,nr.prevZ=sr,sr=nr;tr=rr}sr.nextZ=null,cr*=2}while(ar>1);return ir}function zOrder(ir,er,tr,rr,nr){return ir=(ir-tr)*nr|0,er=(er-rr)*nr|0,ir=(ir|ir<<8)&16711935,ir=(ir|ir<<4)&252645135,ir=(ir|ir<<2)&858993459,ir=(ir|ir<<1)&1431655765,er=(er|er<<8)&16711935,er=(er|er<<4)&252645135,er=(er|er<<2)&858993459,er=(er|er<<1)&1431655765,ir|er<<1}function getLeftmost(ir){let er=ir,tr=ir;do(er.x<tr.x||er.x===tr.x&&er.y<tr.y)&&(tr=er),er=er.next;while(er!==ir);return tr}function pointInTriangle(ir,er,tr,rr,nr,sr,ar,or){return(nr-ar)*(er-or)>=(ir-ar)*(sr-or)&&(ir-ar)*(rr-or)>=(tr-ar)*(er-or)&&(tr-ar)*(sr-or)>=(nr-ar)*(rr-or)}function isValidDiagonal(ir,er){return ir.next.i!==er.i&&ir.prev.i!==er.i&&!intersectsPolygon(ir,er)&&(locallyInside(ir,er)&&locallyInside(er,ir)&&middleInside(ir,er)&&(area(ir.prev,ir,er.prev)||area(ir,er.prev,er))||equals$1(ir,er)&&area(ir.prev,ir,ir.next)>0&&area(er.prev,er,er.next)>0)}function area(ir,er,tr){return(er.y-ir.y)*(tr.x-er.x)-(er.x-ir.x)*(tr.y-er.y)}function equals$1(ir,er){return ir.x===er.x&&ir.y===er.y}function intersects(ir,er,tr,rr){const nr=sign(area(ir,er,tr)),sr=sign(area(ir,er,rr)),ar=sign(area(tr,rr,ir)),or=sign(area(tr,rr,er));return!!(nr!==sr&&ar!==or||nr===0&&onSegment(ir,tr,er)||sr===0&&onSegment(ir,rr,er)||ar===0&&onSegment(tr,ir,rr)||or===0&&onSegment(tr,er,rr))}function onSegment(ir,er,tr){return er.x<=Math.max(ir.x,tr.x)&&er.x>=Math.min(ir.x,tr.x)&&er.y<=Math.max(ir.y,tr.y)&&er.y>=Math.min(ir.y,tr.y)}function sign(ir){return ir>0?1:ir<0?-1:0}function intersectsPolygon(ir,er){let tr=ir;do{if(tr.i!==ir.i&&tr.next.i!==ir.i&&tr.i!==er.i&&tr.next.i!==er.i&&intersects(tr,tr.next,ir,er))return!0;tr=tr.next}while(tr!==ir);return!1}function locallyInside(ir,er){return area(ir.prev,ir,ir.next)<0?area(ir,er,ir.next)>=0&&area(ir,ir.prev,er)>=0:area(ir,er,ir.prev)<0||area(ir,ir.next,er)<0}function middleInside(ir,er){let tr=ir,rr=!1;const nr=(ir.x+er.x)/2,sr=(ir.y+er.y)/2;do tr.y>sr!=tr.next.y>sr&&tr.next.y!==tr.y&&nr<(tr.next.x-tr.x)*(sr-tr.y)/(tr.next.y-tr.y)+tr.x&&(rr=!rr),tr=tr.next;while(tr!==ir);return rr}function splitPolygon(ir,er){const tr=new Node$1(ir.i,ir.x,ir.y),rr=new Node$1(er.i,er.x,er.y),nr=ir.next,sr=er.prev;return ir.next=er,er.prev=ir,tr.next=nr,nr.prev=tr,rr.next=tr,tr.prev=rr,sr.next=rr,rr.prev=sr,rr}function insertNode(ir,er,tr,rr){const nr=new Node$1(ir,er,tr);return rr?(nr.next=rr.next,nr.prev=rr,rr.next.prev=nr,rr.next=nr):(nr.prev=nr,nr.next=nr),nr}function removeNode(ir){ir.next.prev=ir.prev,ir.prev.next=ir.next,ir.prevZ&&(ir.prevZ.nextZ=ir.nextZ),ir.nextZ&&(ir.nextZ.prevZ=ir.prevZ)}function Node$1(ir,er,tr){this.i=ir,this.x=er,this.y=tr,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(ir,er,tr,rr){let nr=0;for(let sr=er,ar=tr-rr;sr<tr;sr+=rr)nr+=(ir[ar]-ir[sr])*(ir[sr+1]+ir[ar+1]),ar=sr;return nr}class ShapeUtils{static area(er){const tr=er.length;let rr=0;for(let nr=tr-1,sr=0;sr<tr;nr=sr++)rr+=er[nr].x*er[sr].y-er[sr].x*er[nr].y;return rr*.5}static isClockWise(er){return ShapeUtils.area(er)<0}static triangulateShape(er,tr){const rr=[],nr=[],sr=[];removeDupEndPts(er),addContour(rr,er);let ar=er.length;tr.forEach(removeDupEndPts);for(let lr=0;lr<tr.length;lr++)nr.push(ar),ar+=tr[lr].length,addContour(rr,tr[lr]);const or=Earcut.triangulate(rr,nr);for(let lr=0;lr<or.length;lr+=3)sr.push(or.slice(lr,lr+3));return sr}}function removeDupEndPts(ir){const er=ir.length;er>2&&ir[er-1].equals(ir[0])&&ir.pop()}function addContour(ir,er){for(let tr=0;tr<er.length;tr++)ir.push(er[tr].x),ir.push(er[tr].y)}class ExtrudeGeometry extends BufferGeometry{constructor(er=new Shape$1([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),tr={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:er,options:tr},er=Array.isArray(er)?er:[er];const rr=this,nr=[],sr=[];for(let or=0,lr=er.length;or<lr;or++){const cr=er[or];ar(cr)}this.setAttribute("position",new Float32BufferAttribute(nr,3)),this.setAttribute("uv",new Float32BufferAttribute(sr,2)),this.computeVertexNormals();function ar(or){const lr=[],cr=tr.curveSegments!==void 0?tr.curveSegments:12,hr=tr.steps!==void 0?tr.steps:1,fr=tr.depth!==void 0?tr.depth:1;let ur=tr.bevelEnabled!==void 0?tr.bevelEnabled:!0,pr=tr.bevelThickness!==void 0?tr.bevelThickness:.2,gr=tr.bevelSize!==void 0?tr.bevelSize:pr-.1,_r=tr.bevelOffset!==void 0?tr.bevelOffset:0,mr=tr.bevelSegments!==void 0?tr.bevelSegments:3;const dr=tr.extrudePath,vr=tr.UVGenerator!==void 0?tr.UVGenerator:WorldUVGenerator;let Ar,yr=!1,wr,br,Sr,xr;dr&&(Ar=dr.getSpacedPoints(hr),yr=!0,ur=!1,wr=dr.computeFrenetFrames(hr,!1),br=new Vector3$1,Sr=new Vector3$1,xr=new Vector3$1),ur||(mr=0,pr=0,gr=0,_r=0);const Cr=or.extractPoints(cr);let Ir=Cr.shape;const Rr=Cr.holes;if(!ShapeUtils.isClockWise(Ir)){Ir=Ir.reverse();for(let Yi=0,qi=Rr.length;Yi<qi;Yi++){const Xr=Rr[Yi];ShapeUtils.isClockWise(Xr)&&(Rr[Yi]=Xr.reverse())}}const Fr=ShapeUtils.triangulateShape(Ir,Rr),Nr=Ir;for(let Yi=0,qi=Rr.length;Yi<qi;Yi++){const Xr=Rr[Yi];Ir=Ir.concat(Xr)}function Ur(Yi,qi,Xr){return qi||console.error("THREE.ExtrudeGeometry: vec does not exist"),Yi.clone().addScaledVector(qi,Xr)}const Br=Ir.length,Or=Fr.length;function Dr(Yi,qi,Xr){let ns,os,us;const is=Yi.x-qi.x,Ji=Yi.y-qi.y,ms=Xr.x-Yi.x,Ki=Xr.y-Yi.y,Ni=is*is+Ji*Ji,Ri=is*Ki-Ji*ms;if(Math.abs(Ri)>Number.EPSILON){const Jr=Math.sqrt(Ni),Xi=Math.sqrt(ms*ms+Ki*Ki),ss=qi.x-Ji/Jr,ls=qi.y+is/Jr,gs=Xr.x-Ki/Xi,_s=Xr.y+ms/Xi,vs=((gs-ss)*Ki-(_s-ls)*ms)/(is*Ki-Ji*ms);ns=ss+is*vs-Yi.x,os=ls+Ji*vs-Yi.y;const As=ns*ns+os*os;if(As<=2)return new Vector2(ns,os);us=Math.sqrt(As/2)}else{let Jr=!1;is>Number.EPSILON?ms>Number.EPSILON&&(Jr=!0):is<-Number.EPSILON?ms<-Number.EPSILON&&(Jr=!0):Math.sign(Ji)===Math.sign(Ki)&&(Jr=!0),Jr?(ns=-Ji,os=is,us=Math.sqrt(Ni)):(ns=is,os=Ji,us=Math.sqrt(Ni/2))}return new Vector2(ns/us,os/us)}const Wr=[];for(let Yi=0,qi=Nr.length,Xr=qi-1,ns=Yi+1;Yi<qi;Yi++,Xr++,ns++)Xr===qi&&(Xr=0),ns===qi&&(ns=0),Wr[Yi]=Dr(Nr[Yi],Nr[Xr],Nr[ns]);const $r=[];let Yr,Qi=Wr.concat();for(let Yi=0,qi=Rr.length;Yi<qi;Yi++){const Xr=Rr[Yi];Yr=[];for(let ns=0,os=Xr.length,us=os-1,is=ns+1;ns<os;ns++,us++,is++)us===os&&(us=0),is===os&&(is=0),Yr[ns]=Dr(Xr[ns],Xr[us],Xr[is]);$r.push(Yr),Qi=Qi.concat(Yr)}for(let Yi=0;Yi<mr;Yi++){const qi=Yi/mr,Xr=pr*Math.cos(qi*Math.PI/2),ns=gr*Math.sin(qi*Math.PI/2)+_r;for(let os=0,us=Nr.length;os<us;os++){const is=Ur(Nr[os],Wr[os],ns);Gr(is.x,is.y,-Xr)}for(let os=0,us=Rr.length;os<us;os++){const is=Rr[os];Yr=$r[os];for(let Ji=0,ms=is.length;Ji<ms;Ji++){const Ki=Ur(is[Ji],Yr[Ji],ns);Gr(Ki.x,Ki.y,-Xr)}}}const rs=gr+_r;for(let Yi=0;Yi<Br;Yi++){const qi=ur?Ur(Ir[Yi],Qi[Yi],rs):Ir[Yi];yr?(Sr.copy(wr.normals[0]).multiplyScalar(qi.x),br.copy(wr.binormals[0]).multiplyScalar(qi.y),xr.copy(Ar[0]).add(Sr).add(br),Gr(xr.x,xr.y,xr.z)):Gr(qi.x,qi.y,0)}for(let Yi=1;Yi<=hr;Yi++)for(let qi=0;qi<Br;qi++){const Xr=ur?Ur(Ir[qi],Qi[qi],rs):Ir[qi];yr?(Sr.copy(wr.normals[Yi]).multiplyScalar(Xr.x),br.copy(wr.binormals[Yi]).multiplyScalar(Xr.y),xr.copy(Ar[Yi]).add(Sr).add(br),Gr(xr.x,xr.y,xr.z)):Gr(Xr.x,Xr.y,fr/hr*Yi)}for(let Yi=mr-1;Yi>=0;Yi--){const qi=Yi/mr,Xr=pr*Math.cos(qi*Math.PI/2),ns=gr*Math.sin(qi*Math.PI/2)+_r;for(let os=0,us=Nr.length;os<us;os++){const is=Ur(Nr[os],Wr[os],ns);Gr(is.x,is.y,fr+Xr)}for(let os=0,us=Rr.length;os<us;os++){const is=Rr[os];Yr=$r[os];for(let Ji=0,ms=is.length;Ji<ms;Ji++){const Ki=Ur(is[Ji],Yr[Ji],ns);yr?Gr(Ki.x,Ki.y+Ar[hr-1].y,Ar[hr-1].x+Xr):Gr(Ki.x,Ki.y,fr+Xr)}}}Kr(),Qr();function Kr(){const Yi=nr.length/3;if(ur){let qi=0,Xr=Br*qi;for(let ns=0;ns<Or;ns++){const os=Fr[ns];qr(os[2]+Xr,os[1]+Xr,os[0]+Xr)}qi=hr+mr*2,Xr=Br*qi;for(let ns=0;ns<Or;ns++){const os=Fr[ns];qr(os[0]+Xr,os[1]+Xr,os[2]+Xr)}}else{for(let qi=0;qi<Or;qi++){const Xr=Fr[qi];qr(Xr[2],Xr[1],Xr[0])}for(let qi=0;qi<Or;qi++){const Xr=Fr[qi];qr(Xr[0]+Br*hr,Xr[1]+Br*hr,Xr[2]+Br*hr)}}rr.addGroup(Yi,nr.length/3-Yi,0)}function Qr(){const Yi=nr.length/3;let qi=0;Vr(Nr,qi),qi+=Nr.length;for(let Xr=0,ns=Rr.length;Xr<ns;Xr++){const os=Rr[Xr];Vr(os,qi),qi+=os.length}rr.addGroup(Yi,nr.length/3-Yi,1)}function Vr(Yi,qi){let Xr=Yi.length;for(;--Xr>=0;){const ns=Xr;let os=Xr-1;os<0&&(os=Yi.length-1);for(let us=0,is=hr+mr*2;us<is;us++){const Ji=Br*us,ms=Br*(us+1),Ki=qi+ns+Ji,Ni=qi+os+Ji,Ri=qi+os+ms,Jr=qi+ns+ms;ji(Ki,Ni,Ri,Jr)}}}function Gr(Yi,qi,Xr){lr.push(Yi),lr.push(qi),lr.push(Xr)}function qr(Yi,qi,Xr){Zr(Yi),Zr(qi),Zr(Xr);const ns=nr.length/3,os=vr.generateTopUV(rr,nr,ns-3,ns-2,ns-1);Zi(os[0]),Zi(os[1]),Zi(os[2])}function ji(Yi,qi,Xr,ns){Zr(Yi),Zr(qi),Zr(ns),Zr(qi),Zr(Xr),Zr(ns);const os=nr.length/3,us=vr.generateSideWallUV(rr,nr,os-6,os-3,os-2,os-1);Zi(us[0]),Zi(us[1]),Zi(us[3]),Zi(us[1]),Zi(us[2]),Zi(us[3])}function Zr(Yi){nr.push(lr[Yi*3+0]),nr.push(lr[Yi*3+1]),nr.push(lr[Yi*3+2])}function Zi(Yi){sr.push(Yi.x),sr.push(Yi.y)}}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}toJSON(){const er=super.toJSON(),tr=this.parameters.shapes,rr=this.parameters.options;return toJSON$1(tr,rr,er)}static fromJSON(er,tr){const rr=[];for(let sr=0,ar=er.shapes.length;sr<ar;sr++){const or=tr[er.shapes[sr]];rr.push(or)}const nr=er.options.extrudePath;return nr!==void 0&&(er.options.extrudePath=new Curves$1[nr.type]().fromJSON(nr)),new ExtrudeGeometry(rr,er.options)}}const WorldUVGenerator={generateTopUV:function(ir,er,tr,rr,nr){const sr=er[tr*3],ar=er[tr*3+1],or=er[rr*3],lr=er[rr*3+1],cr=er[nr*3],hr=er[nr*3+1];return[new Vector2(sr,ar),new Vector2(or,lr),new Vector2(cr,hr)]},generateSideWallUV:function(ir,er,tr,rr,nr,sr){const ar=er[tr*3],or=er[tr*3+1],lr=er[tr*3+2],cr=er[rr*3],hr=er[rr*3+1],fr=er[rr*3+2],ur=er[nr*3],pr=er[nr*3+1],gr=er[nr*3+2],_r=er[sr*3],mr=er[sr*3+1],dr=er[sr*3+2];return Math.abs(or-hr)<Math.abs(ar-cr)?[new Vector2(ar,1-lr),new Vector2(cr,1-fr),new Vector2(ur,1-gr),new Vector2(_r,1-dr)]:[new Vector2(or,1-lr),new Vector2(hr,1-fr),new Vector2(pr,1-gr),new Vector2(mr,1-dr)]}};function toJSON$1(ir,er,tr){if(tr.shapes=[],Array.isArray(ir))for(let rr=0,nr=ir.length;rr<nr;rr++){const sr=ir[rr];tr.shapes.push(sr.uuid)}else tr.shapes.push(ir.uuid);return tr.options=Object.assign({},er),er.extrudePath!==void 0&&(tr.options.extrudePath=er.extrudePath.toJSON()),tr}class IcosahedronGeometry extends PolyhedronGeometry{constructor(er=1,tr=0){const rr=(1+Math.sqrt(5))/2,nr=[-1,rr,0,1,rr,0,-1,-rr,0,1,-rr,0,0,-1,rr,0,1,rr,0,-1,-rr,0,1,-rr,rr,0,-1,rr,0,1,-rr,0,-1,-rr,0,1],sr=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(nr,sr,er,tr),this.type="IcosahedronGeometry",this.parameters={radius:er,detail:tr}}static fromJSON(er){return new IcosahedronGeometry(er.radius,er.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(er=1,tr=0){const rr=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],nr=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(rr,nr,er,tr),this.type="OctahedronGeometry",this.parameters={radius:er,detail:tr}}static fromJSON(er){return new OctahedronGeometry(er.radius,er.detail)}}class PlaneGeometry extends BufferGeometry{constructor(er=1,tr=1,rr=1,nr=1){super(),this.type="PlaneGeometry",this.parameters={width:er,height:tr,widthSegments:rr,heightSegments:nr};const sr=er/2,ar=tr/2,or=Math.floor(rr),lr=Math.floor(nr),cr=or+1,hr=lr+1,fr=er/or,ur=tr/lr,pr=[],gr=[],_r=[],mr=[];for(let dr=0;dr<hr;dr++){const vr=dr*ur-ar;for(let Ar=0;Ar<cr;Ar++){const yr=Ar*fr-sr;gr.push(yr,-vr,0),_r.push(0,0,1),mr.push(Ar/or),mr.push(1-dr/lr)}}for(let dr=0;dr<lr;dr++)for(let vr=0;vr<or;vr++){const Ar=vr+cr*dr,yr=vr+cr*(dr+1),wr=vr+1+cr*(dr+1),br=vr+1+cr*dr;pr.push(Ar,yr,br),pr.push(yr,wr,br)}this.setIndex(pr),this.setAttribute("position",new Float32BufferAttribute(gr,3)),this.setAttribute("normal",new Float32BufferAttribute(_r,3)),this.setAttribute("uv",new Float32BufferAttribute(mr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new PlaneGeometry(er.width,er.height,er.widthSegments,er.heightSegments)}}class RingGeometry extends BufferGeometry{constructor(er=.5,tr=1,rr=32,nr=1,sr=0,ar=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:er,outerRadius:tr,thetaSegments:rr,phiSegments:nr,thetaStart:sr,thetaLength:ar},rr=Math.max(3,rr),nr=Math.max(1,nr);const or=[],lr=[],cr=[],hr=[];let fr=er;const ur=(tr-er)/nr,pr=new Vector3$1,gr=new Vector2;for(let _r=0;_r<=nr;_r++){for(let mr=0;mr<=rr;mr++){const dr=sr+mr/rr*ar;pr.x=fr*Math.cos(dr),pr.y=fr*Math.sin(dr),lr.push(pr.x,pr.y,pr.z),cr.push(0,0,1),gr.x=(pr.x/tr+1)/2,gr.y=(pr.y/tr+1)/2,hr.push(gr.x,gr.y)}fr+=ur}for(let _r=0;_r<nr;_r++){const mr=_r*(rr+1);for(let dr=0;dr<rr;dr++){const vr=dr+mr,Ar=vr,yr=vr+rr+1,wr=vr+rr+2,br=vr+1;or.push(Ar,yr,br),or.push(yr,wr,br)}}this.setIndex(or),this.setAttribute("position",new Float32BufferAttribute(lr,3)),this.setAttribute("normal",new Float32BufferAttribute(cr,3)),this.setAttribute("uv",new Float32BufferAttribute(hr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new RingGeometry(er.innerRadius,er.outerRadius,er.thetaSegments,er.phiSegments,er.thetaStart,er.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(er=new Shape$1([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),tr=12){super(),this.type="ShapeGeometry",this.parameters={shapes:er,curveSegments:tr};const rr=[],nr=[],sr=[],ar=[];let or=0,lr=0;if(Array.isArray(er)===!1)cr(er);else for(let hr=0;hr<er.length;hr++)cr(er[hr]),this.addGroup(or,lr,hr),or+=lr,lr=0;this.setIndex(rr),this.setAttribute("position",new Float32BufferAttribute(nr,3)),this.setAttribute("normal",new Float32BufferAttribute(sr,3)),this.setAttribute("uv",new Float32BufferAttribute(ar,2));function cr(hr){const fr=nr.length/3,ur=hr.extractPoints(tr);let pr=ur.shape;const gr=ur.holes;ShapeUtils.isClockWise(pr)===!1&&(pr=pr.reverse());for(let mr=0,dr=gr.length;mr<dr;mr++){const vr=gr[mr];ShapeUtils.isClockWise(vr)===!0&&(gr[mr]=vr.reverse())}const _r=ShapeUtils.triangulateShape(pr,gr);for(let mr=0,dr=gr.length;mr<dr;mr++){const vr=gr[mr];pr=pr.concat(vr)}for(let mr=0,dr=pr.length;mr<dr;mr++){const vr=pr[mr];nr.push(vr.x,vr.y,0),sr.push(0,0,1),ar.push(vr.x,vr.y)}for(let mr=0,dr=_r.length;mr<dr;mr++){const vr=_r[mr],Ar=vr[0]+fr,yr=vr[1]+fr,wr=vr[2]+fr;rr.push(Ar,yr,wr),lr+=3}}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}toJSON(){const er=super.toJSON(),tr=this.parameters.shapes;return toJSON(tr,er)}static fromJSON(er,tr){const rr=[];for(let nr=0,sr=er.shapes.length;nr<sr;nr++){const ar=tr[er.shapes[nr]];rr.push(ar)}return new ShapeGeometry(rr,er.curveSegments)}}function toJSON(ir,er){if(er.shapes=[],Array.isArray(ir))for(let tr=0,rr=ir.length;tr<rr;tr++){const nr=ir[tr];er.shapes.push(nr.uuid)}else er.shapes.push(ir.uuid);return er}class SphereGeometry extends BufferGeometry{constructor(er=1,tr=32,rr=16,nr=0,sr=Math.PI*2,ar=0,or=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:er,widthSegments:tr,heightSegments:rr,phiStart:nr,phiLength:sr,thetaStart:ar,thetaLength:or},tr=Math.max(3,Math.floor(tr)),rr=Math.max(2,Math.floor(rr));const lr=Math.min(ar+or,Math.PI);let cr=0;const hr=[],fr=new Vector3$1,ur=new Vector3$1,pr=[],gr=[],_r=[],mr=[];for(let dr=0;dr<=rr;dr++){const vr=[],Ar=dr/rr;let yr=0;dr===0&&ar===0?yr=.5/tr:dr===rr&&lr===Math.PI&&(yr=-.5/tr);for(let wr=0;wr<=tr;wr++){const br=wr/tr;fr.x=-er*Math.cos(nr+br*sr)*Math.sin(ar+Ar*or),fr.y=er*Math.cos(ar+Ar*or),fr.z=er*Math.sin(nr+br*sr)*Math.sin(ar+Ar*or),gr.push(fr.x,fr.y,fr.z),ur.copy(fr).normalize(),_r.push(ur.x,ur.y,ur.z),mr.push(br+yr,1-Ar),vr.push(cr++)}hr.push(vr)}for(let dr=0;dr<rr;dr++)for(let vr=0;vr<tr;vr++){const Ar=hr[dr][vr+1],yr=hr[dr][vr],wr=hr[dr+1][vr],br=hr[dr+1][vr+1];(dr!==0||ar>0)&&pr.push(Ar,yr,br),(dr!==rr-1||lr<Math.PI)&&pr.push(yr,wr,br)}this.setIndex(pr),this.setAttribute("position",new Float32BufferAttribute(gr,3)),this.setAttribute("normal",new Float32BufferAttribute(_r,3)),this.setAttribute("uv",new Float32BufferAttribute(mr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new SphereGeometry(er.radius,er.widthSegments,er.heightSegments,er.phiStart,er.phiLength,er.thetaStart,er.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(er=1,tr=0){const rr=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],nr=[2,1,0,0,3,2,1,3,0,2,3,1];super(rr,nr,er,tr),this.type="TetrahedronGeometry",this.parameters={radius:er,detail:tr}}static fromJSON(er){return new TetrahedronGeometry(er.radius,er.detail)}}class TorusGeometry extends BufferGeometry{constructor(er=1,tr=.4,rr=12,nr=48,sr=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:er,tube:tr,radialSegments:rr,tubularSegments:nr,arc:sr},rr=Math.floor(rr),nr=Math.floor(nr);const ar=[],or=[],lr=[],cr=[],hr=new Vector3$1,fr=new Vector3$1,ur=new Vector3$1;for(let pr=0;pr<=rr;pr++)for(let gr=0;gr<=nr;gr++){const _r=gr/nr*sr,mr=pr/rr*Math.PI*2;fr.x=(er+tr*Math.cos(mr))*Math.cos(_r),fr.y=(er+tr*Math.cos(mr))*Math.sin(_r),fr.z=tr*Math.sin(mr),or.push(fr.x,fr.y,fr.z),hr.x=er*Math.cos(_r),hr.y=er*Math.sin(_r),ur.subVectors(fr,hr).normalize(),lr.push(ur.x,ur.y,ur.z),cr.push(gr/nr),cr.push(pr/rr)}for(let pr=1;pr<=rr;pr++)for(let gr=1;gr<=nr;gr++){const _r=(nr+1)*pr+gr-1,mr=(nr+1)*(pr-1)+gr-1,dr=(nr+1)*(pr-1)+gr,vr=(nr+1)*pr+gr;ar.push(_r,mr,vr),ar.push(mr,dr,vr)}this.setIndex(ar),this.setAttribute("position",new Float32BufferAttribute(or,3)),this.setAttribute("normal",new Float32BufferAttribute(lr,3)),this.setAttribute("uv",new Float32BufferAttribute(cr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new TorusGeometry(er.radius,er.tube,er.radialSegments,er.tubularSegments,er.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(er=1,tr=.4,rr=64,nr=8,sr=2,ar=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:er,tube:tr,tubularSegments:rr,radialSegments:nr,p:sr,q:ar},rr=Math.floor(rr),nr=Math.floor(nr);const or=[],lr=[],cr=[],hr=[],fr=new Vector3$1,ur=new Vector3$1,pr=new Vector3$1,gr=new Vector3$1,_r=new Vector3$1,mr=new Vector3$1,dr=new Vector3$1;for(let Ar=0;Ar<=rr;++Ar){const yr=Ar/rr*sr*Math.PI*2;vr(yr,sr,ar,er,pr),vr(yr+.01,sr,ar,er,gr),mr.subVectors(gr,pr),dr.addVectors(gr,pr),_r.crossVectors(mr,dr),dr.crossVectors(_r,mr),_r.normalize(),dr.normalize();for(let wr=0;wr<=nr;++wr){const br=wr/nr*Math.PI*2,Sr=-tr*Math.cos(br),xr=tr*Math.sin(br);fr.x=pr.x+(Sr*dr.x+xr*_r.x),fr.y=pr.y+(Sr*dr.y+xr*_r.y),fr.z=pr.z+(Sr*dr.z+xr*_r.z),lr.push(fr.x,fr.y,fr.z),ur.subVectors(fr,pr).normalize(),cr.push(ur.x,ur.y,ur.z),hr.push(Ar/rr),hr.push(wr/nr)}}for(let Ar=1;Ar<=rr;Ar++)for(let yr=1;yr<=nr;yr++){const wr=(nr+1)*(Ar-1)+(yr-1),br=(nr+1)*Ar+(yr-1),Sr=(nr+1)*Ar+yr,xr=(nr+1)*(Ar-1)+yr;or.push(wr,br,xr),or.push(br,Sr,xr)}this.setIndex(or),this.setAttribute("position",new Float32BufferAttribute(lr,3)),this.setAttribute("normal",new Float32BufferAttribute(cr,3)),this.setAttribute("uv",new Float32BufferAttribute(hr,2));function vr(Ar,yr,wr,br,Sr){const xr=Math.cos(Ar),Cr=Math.sin(Ar),Ir=wr/yr*Ar,Rr=Math.cos(Ir);Sr.x=br*(2+Rr)*.5*xr,Sr.y=br*(2+Rr)*Cr*.5,Sr.z=br*Math.sin(Ir)*.5}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new TorusKnotGeometry(er.radius,er.tube,er.tubularSegments,er.radialSegments,er.p,er.q)}}class TubeGeometry extends BufferGeometry{constructor(er=new QuadraticBezierCurve3(new Vector3$1(-1,-1,0),new Vector3$1(-1,1,0),new Vector3$1(1,1,0)),tr=64,rr=1,nr=8,sr=!1){super(),this.type="TubeGeometry",this.parameters={path:er,tubularSegments:tr,radius:rr,radialSegments:nr,closed:sr};const ar=er.computeFrenetFrames(tr,sr);this.tangents=ar.tangents,this.normals=ar.normals,this.binormals=ar.binormals;const or=new Vector3$1,lr=new Vector3$1,cr=new Vector2;let hr=new Vector3$1;const fr=[],ur=[],pr=[],gr=[];_r(),this.setIndex(gr),this.setAttribute("position",new Float32BufferAttribute(fr,3)),this.setAttribute("normal",new Float32BufferAttribute(ur,3)),this.setAttribute("uv",new Float32BufferAttribute(pr,2));function _r(){for(let Ar=0;Ar<tr;Ar++)mr(Ar);mr(sr===!1?tr:0),vr(),dr()}function mr(Ar){hr=er.getPointAt(Ar/tr,hr);const yr=ar.normals[Ar],wr=ar.binormals[Ar];for(let br=0;br<=nr;br++){const Sr=br/nr*Math.PI*2,xr=Math.sin(Sr),Cr=-Math.cos(Sr);lr.x=Cr*yr.x+xr*wr.x,lr.y=Cr*yr.y+xr*wr.y,lr.z=Cr*yr.z+xr*wr.z,lr.normalize(),ur.push(lr.x,lr.y,lr.z),or.x=hr.x+rr*lr.x,or.y=hr.y+rr*lr.y,or.z=hr.z+rr*lr.z,fr.push(or.x,or.y,or.z)}}function dr(){for(let Ar=1;Ar<=tr;Ar++)for(let yr=1;yr<=nr;yr++){const wr=(nr+1)*(Ar-1)+(yr-1),br=(nr+1)*Ar+(yr-1),Sr=(nr+1)*Ar+yr,xr=(nr+1)*(Ar-1)+yr;gr.push(wr,br,xr),gr.push(br,Sr,xr)}}function vr(){for(let Ar=0;Ar<=tr;Ar++)for(let yr=0;yr<=nr;yr++)cr.x=Ar/tr,cr.y=yr/nr,pr.push(cr.x,cr.y)}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}toJSON(){const er=super.toJSON();return er.path=this.parameters.path.toJSON(),er}static fromJSON(er){return new TubeGeometry(new Curves$1[er.path.type]().fromJSON(er.path),er.tubularSegments,er.radius,er.radialSegments,er.closed)}}class WireframeGeometry extends BufferGeometry{constructor(er=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:er},er!==null){const tr=[],rr=new Set,nr=new Vector3$1,sr=new Vector3$1;if(er.index!==null){const ar=er.attributes.position,or=er.index;let lr=er.groups;lr.length===0&&(lr=[{start:0,count:or.count,materialIndex:0}]);for(let cr=0,hr=lr.length;cr<hr;++cr){const fr=lr[cr],ur=fr.start,pr=fr.count;for(let gr=ur,_r=ur+pr;gr<_r;gr+=3)for(let mr=0;mr<3;mr++){const dr=or.getX(gr+mr),vr=or.getX(gr+(mr+1)%3);nr.fromBufferAttribute(ar,dr),sr.fromBufferAttribute(ar,vr),isUniqueEdge(nr,sr,rr)===!0&&(tr.push(nr.x,nr.y,nr.z),tr.push(sr.x,sr.y,sr.z))}}}else{const ar=er.attributes.position;for(let or=0,lr=ar.count/3;or<lr;or++)for(let cr=0;cr<3;cr++){const hr=3*or+cr,fr=3*or+(cr+1)%3;nr.fromBufferAttribute(ar,hr),sr.fromBufferAttribute(ar,fr),isUniqueEdge(nr,sr,rr)===!0&&(tr.push(nr.x,nr.y,nr.z),tr.push(sr.x,sr.y,sr.z))}}this.setAttribute("position",new Float32BufferAttribute(tr,3))}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}}function isUniqueEdge(ir,er,tr){const rr=`${ir.x},${ir.y},${ir.z}-${er.x},${er.y},${er.z}`,nr=`${er.x},${er.y},${er.z}-${ir.x},${ir.y},${ir.z}`;return tr.has(rr)===!0||tr.has(nr)===!0?!1:(tr.add(rr),tr.add(nr),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(er){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.fog=er.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(er){super(er),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(er){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.defines={STANDARD:""},this.color.copy(er.color),this.roughness=er.roughness,this.metalness=er.metalness,this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.roughnessMap=er.roughnessMap,this.metalnessMap=er.metalnessMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.envMapRotation.copy(er.envMapRotation),this.envMapIntensity=er.envMapIntensity,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.flatShading=er.flatShading,this.fog=er.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(er){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(tr){this.ior=(1+.4*tr)/(1-.4*tr)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(er)}get anisotropy(){return this._anisotropy}set anisotropy(er){this._anisotropy>0!=er>0&&this.version++,this._anisotropy=er}get clearcoat(){return this._clearcoat}set clearcoat(er){this._clearcoat>0!=er>0&&this.version++,this._clearcoat=er}get iridescence(){return this._iridescence}set iridescence(er){this._iridescence>0!=er>0&&this.version++,this._iridescence=er}get dispersion(){return this._dispersion}set dispersion(er){this._dispersion>0!=er>0&&this.version++,this._dispersion=er}get sheen(){return this._sheen}set sheen(er){this._sheen>0!=er>0&&this.version++,this._sheen=er}get transmission(){return this._transmission}set transmission(er){this._transmission>0!=er>0&&this.version++,this._transmission=er}copy(er){return super.copy(er),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=er.anisotropy,this.anisotropyRotation=er.anisotropyRotation,this.anisotropyMap=er.anisotropyMap,this.clearcoat=er.clearcoat,this.clearcoatMap=er.clearcoatMap,this.clearcoatRoughness=er.clearcoatRoughness,this.clearcoatRoughnessMap=er.clearcoatRoughnessMap,this.clearcoatNormalMap=er.clearcoatNormalMap,this.clearcoatNormalScale.copy(er.clearcoatNormalScale),this.dispersion=er.dispersion,this.ior=er.ior,this.iridescence=er.iridescence,this.iridescenceMap=er.iridescenceMap,this.iridescenceIOR=er.iridescenceIOR,this.iridescenceThicknessRange=[...er.iridescenceThicknessRange],this.iridescenceThicknessMap=er.iridescenceThicknessMap,this.sheen=er.sheen,this.sheenColor.copy(er.sheenColor),this.sheenColorMap=er.sheenColorMap,this.sheenRoughness=er.sheenRoughness,this.sheenRoughnessMap=er.sheenRoughnessMap,this.transmission=er.transmission,this.transmissionMap=er.transmissionMap,this.thickness=er.thickness,this.thicknessMap=er.thicknessMap,this.attenuationDistance=er.attenuationDistance,this.attenuationColor.copy(er.attenuationColor),this.specularIntensity=er.specularIntensity,this.specularIntensityMap=er.specularIntensityMap,this.specularColor.copy(er.specularColor),this.specularColorMap=er.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(er){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.specular.copy(er.specular),this.shininess=er.shininess,this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.specularMap=er.specularMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.envMapRotation.copy(er.envMapRotation),this.combine=er.combine,this.reflectivity=er.reflectivity,this.refractionRatio=er.refractionRatio,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.flatShading=er.flatShading,this.fog=er.fog,this}}class MeshToonMaterial extends Material{constructor(er){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.gradientMap=er.gradientMap,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.alphaMap=er.alphaMap,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.fog=er.fog,this}}class MeshNormalMaterial extends Material{constructor(er){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(er)}copy(er){return super.copy(er),this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.flatShading=er.flatShading,this}}class MeshLambertMaterial extends Material{constructor(er){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.specularMap=er.specularMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.envMapRotation.copy(er.envMapRotation),this.combine=er.combine,this.reflectivity=er.reflectivity,this.refractionRatio=er.refractionRatio,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.flatShading=er.flatShading,this.fog=er.fog,this}}class MeshDepthMaterial extends Material{constructor(er){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(er)}copy(er){return super.copy(er),this.depthPacking=er.depthPacking,this.map=er.map,this.alphaMap=er.alphaMap,this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(er){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(er)}copy(er){return super.copy(er),this.map=er.map,this.alphaMap=er.alphaMap,this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this}}class MeshMatcapMaterial extends Material{constructor(er){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.defines={MATCAP:""},this.color.copy(er.color),this.matcap=er.matcap,this.map=er.map,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.alphaMap=er.alphaMap,this.flatShading=er.flatShading,this.fog=er.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(er){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(er)}copy(er){return super.copy(er),this.scale=er.scale,this.dashSize=er.dashSize,this.gapSize=er.gapSize,this}}function convertArray(ir,er,tr){return!ir||!tr&&ir.constructor===er?ir:typeof er.BYTES_PER_ELEMENT=="number"?new er(ir):Array.prototype.slice.call(ir)}function isTypedArray(ir){return ArrayBuffer.isView(ir)&&!(ir instanceof DataView)}function getKeyframeOrder(ir){function er(nr,sr){return ir[nr]-ir[sr]}const tr=ir.length,rr=new Array(tr);for(let nr=0;nr!==tr;++nr)rr[nr]=nr;return rr.sort(er),rr}function sortedArray(ir,er,tr){const rr=ir.length,nr=new ir.constructor(rr);for(let sr=0,ar=0;ar!==rr;++sr){const or=tr[sr]*er;for(let lr=0;lr!==er;++lr)nr[ar++]=ir[or+lr]}return nr}function flattenJSON(ir,er,tr,rr){let nr=1,sr=ir[0];for(;sr!==void 0&&sr[rr]===void 0;)sr=ir[nr++];if(sr===void 0)return;let ar=sr[rr];if(ar!==void 0)if(Array.isArray(ar))do ar=sr[rr],ar!==void 0&&(er.push(sr.time),tr.push.apply(tr,ar)),sr=ir[nr++];while(sr!==void 0);else if(ar.toArray!==void 0)do ar=sr[rr],ar!==void 0&&(er.push(sr.time),ar.toArray(tr,tr.length)),sr=ir[nr++];while(sr!==void 0);else do ar=sr[rr],ar!==void 0&&(er.push(sr.time),tr.push(ar)),sr=ir[nr++];while(sr!==void 0)}function subclip(ir,er,tr,rr,nr=30){const sr=ir.clone();sr.name=er;const ar=[];for(let lr=0;lr<sr.tracks.length;++lr){const cr=sr.tracks[lr],hr=cr.getValueSize(),fr=[],ur=[];for(let pr=0;pr<cr.times.length;++pr){const gr=cr.times[pr]*nr;if(!(gr<tr||gr>=rr)){fr.push(cr.times[pr]);for(let _r=0;_r<hr;++_r)ur.push(cr.values[pr*hr+_r])}}fr.length!==0&&(cr.times=convertArray(fr,cr.times.constructor),cr.values=convertArray(ur,cr.values.constructor),ar.push(cr))}sr.tracks=ar;let or=1/0;for(let lr=0;lr<sr.tracks.length;++lr)or>sr.tracks[lr].times[0]&&(or=sr.tracks[lr].times[0]);for(let lr=0;lr<sr.tracks.length;++lr)sr.tracks[lr].shift(-1*or);return sr.resetDuration(),sr}function makeClipAdditive(ir,er=0,tr=ir,rr=30){rr<=0&&(rr=30);const nr=tr.tracks.length,sr=er/rr;for(let ar=0;ar<nr;++ar){const or=tr.tracks[ar],lr=or.ValueTypeName;if(lr==="bool"||lr==="string")continue;const cr=ir.tracks.find(function(dr){return dr.name===or.name&&dr.ValueTypeName===lr});if(cr===void 0)continue;let hr=0;const fr=or.getValueSize();or.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(hr=fr/3);let ur=0;const pr=cr.getValueSize();cr.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(ur=pr/3);const gr=or.times.length-1;let _r;if(sr<=or.times[0]){const dr=hr,vr=fr-hr;_r=or.values.slice(dr,vr)}else if(sr>=or.times[gr]){const dr=gr*fr+hr,vr=dr+fr-hr;_r=or.values.slice(dr,vr)}else{const dr=or.createInterpolant(),vr=hr,Ar=fr-hr;dr.evaluate(sr),_r=dr.resultBuffer.slice(vr,Ar)}lr==="quaternion"&&new Quaternion$1().fromArray(_r).normalize().conjugate().toArray(_r);const mr=cr.times.length;for(let dr=0;dr<mr;++dr){const vr=dr*pr+ur;if(lr==="quaternion")Quaternion$1.multiplyQuaternionsFlat(cr.values,vr,_r,0,cr.values,vr);else{const Ar=pr-ur*2;for(let yr=0;yr<Ar;++yr)cr.values[vr+yr]-=_r[yr]}}}return ir.blendMode=AdditiveAnimationBlendMode,ir}const AnimationUtils={convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(er,tr,rr,nr){this.parameterPositions=er,this._cachedIndex=0,this.resultBuffer=nr!==void 0?nr:new tr.constructor(rr),this.sampleValues=tr,this.valueSize=rr,this.settings=null,this.DefaultSettings_={}}evaluate(er){const tr=this.parameterPositions;let rr=this._cachedIndex,nr=tr[rr],sr=tr[rr-1];e:{t:{let ar;r:{i:if(!(er<nr)){for(let or=rr+2;;){if(nr===void 0){if(er<sr)break i;return rr=tr.length,this._cachedIndex=rr,this.copySampleValue_(rr-1)}if(rr===or)break;if(sr=nr,nr=tr[++rr],er<nr)break t}ar=tr.length;break r}if(!(er>=sr)){const or=tr[1];er<or&&(rr=2,sr=or);for(let lr=rr-2;;){if(sr===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(rr===lr)break;if(nr=sr,sr=tr[--rr-1],er>=sr)break t}ar=rr,rr=0;break r}break e}for(;rr<ar;){const or=rr+ar>>>1;er<tr[or]?ar=or:rr=or+1}if(nr=tr[rr],sr=tr[rr-1],sr===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(nr===void 0)return rr=tr.length,this._cachedIndex=rr,this.copySampleValue_(rr-1)}this._cachedIndex=rr,this.intervalChanged_(rr,sr,nr)}return this.interpolate_(rr,sr,er,nr)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(er){const tr=this.resultBuffer,rr=this.sampleValues,nr=this.valueSize,sr=er*nr;for(let ar=0;ar!==nr;++ar)tr[ar]=rr[sr+ar];return tr}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(er,tr,rr,nr){super(er,tr,rr,nr),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(er,tr,rr){const nr=this.parameterPositions;let sr=er-2,ar=er+1,or=nr[sr],lr=nr[ar];if(or===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:sr=er,or=2*tr-rr;break;case WrapAroundEnding:sr=nr.length-2,or=tr+nr[sr]-nr[sr+1];break;default:sr=er,or=rr}if(lr===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:ar=er,lr=2*rr-tr;break;case WrapAroundEnding:ar=1,lr=rr+nr[1]-nr[0];break;default:ar=er-1,lr=tr}const cr=(rr-tr)*.5,hr=this.valueSize;this._weightPrev=cr/(tr-or),this._weightNext=cr/(lr-rr),this._offsetPrev=sr*hr,this._offsetNext=ar*hr}interpolate_(er,tr,rr,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=er*or,cr=lr-or,hr=this._offsetPrev,fr=this._offsetNext,ur=this._weightPrev,pr=this._weightNext,gr=(rr-tr)/(nr-tr),_r=gr*gr,mr=_r*gr,dr=-ur*mr+2*ur*_r-ur*gr,vr=(1+ur)*mr+(-1.5-2*ur)*_r+(-.5+ur)*gr+1,Ar=(-1-pr)*mr+(1.5+pr)*_r+.5*gr,yr=pr*mr-pr*_r;for(let wr=0;wr!==or;++wr)sr[wr]=dr*ar[hr+wr]+vr*ar[cr+wr]+Ar*ar[lr+wr]+yr*ar[fr+wr];return sr}}class LinearInterpolant extends Interpolant{constructor(er,tr,rr,nr){super(er,tr,rr,nr)}interpolate_(er,tr,rr,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=er*or,cr=lr-or,hr=(rr-tr)/(nr-tr),fr=1-hr;for(let ur=0;ur!==or;++ur)sr[ur]=ar[cr+ur]*fr+ar[lr+ur]*hr;return sr}}class DiscreteInterpolant extends Interpolant{constructor(er,tr,rr,nr){super(er,tr,rr,nr)}interpolate_(er){return this.copySampleValue_(er-1)}}class KeyframeTrack{constructor(er,tr,rr,nr){if(er===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(tr===void 0||tr.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+er);this.name=er,this.times=convertArray(tr,this.TimeBufferType),this.values=convertArray(rr,this.ValueBufferType),this.setInterpolation(nr||this.DefaultInterpolation)}static toJSON(er){const tr=er.constructor;let rr;if(tr.toJSON!==this.toJSON)rr=tr.toJSON(er);else{rr={name:er.name,times:convertArray(er.times,Array),values:convertArray(er.values,Array)};const nr=er.getInterpolation();nr!==er.DefaultInterpolation&&(rr.interpolation=nr)}return rr.type=er.ValueTypeName,rr}InterpolantFactoryMethodDiscrete(er){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),er)}InterpolantFactoryMethodLinear(er){return new LinearInterpolant(this.times,this.values,this.getValueSize(),er)}InterpolantFactoryMethodSmooth(er){return new CubicInterpolant(this.times,this.values,this.getValueSize(),er)}setInterpolation(er){let tr;switch(er){case InterpolateDiscrete:tr=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:tr=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:tr=this.InterpolantFactoryMethodSmooth;break}if(tr===void 0){const rr="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(er!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(rr);return console.warn("THREE.KeyframeTrack:",rr),this}return this.createInterpolant=tr,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(er){if(er!==0){const tr=this.times;for(let rr=0,nr=tr.length;rr!==nr;++rr)tr[rr]+=er}return this}scale(er){if(er!==1){const tr=this.times;for(let rr=0,nr=tr.length;rr!==nr;++rr)tr[rr]*=er}return this}trim(er,tr){const rr=this.times,nr=rr.length;let sr=0,ar=nr-1;for(;sr!==nr&&rr[sr]<er;)++sr;for(;ar!==-1&&rr[ar]>tr;)--ar;if(++ar,sr!==0||ar!==nr){sr>=ar&&(ar=Math.max(ar,1),sr=ar-1);const or=this.getValueSize();this.times=rr.slice(sr,ar),this.values=this.values.slice(sr*or,ar*or)}return this}validate(){let er=!0;const tr=this.getValueSize();tr-Math.floor(tr)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),er=!1);const rr=this.times,nr=this.values,sr=rr.length;sr===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),er=!1);let ar=null;for(let or=0;or!==sr;or++){const lr=rr[or];if(typeof lr=="number"&&isNaN(lr)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,or,lr),er=!1;break}if(ar!==null&&ar>lr){console.error("THREE.KeyframeTrack: Out of order keys.",this,or,lr,ar),er=!1;break}ar=lr}if(nr!==void 0&&isTypedArray(nr))for(let or=0,lr=nr.length;or!==lr;++or){const cr=nr[or];if(isNaN(cr)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,or,cr),er=!1;break}}return er}optimize(){const er=this.times.slice(),tr=this.values.slice(),rr=this.getValueSize(),nr=this.getInterpolation()===InterpolateSmooth,sr=er.length-1;let ar=1;for(let or=1;or<sr;++or){let lr=!1;const cr=er[or],hr=er[or+1];if(cr!==hr&&(or!==1||cr!==er[0]))if(nr)lr=!0;else{const fr=or*rr,ur=fr-rr,pr=fr+rr;for(let gr=0;gr!==rr;++gr){const _r=tr[fr+gr];if(_r!==tr[ur+gr]||_r!==tr[pr+gr]){lr=!0;break}}}if(lr){if(or!==ar){er[ar]=er[or];const fr=or*rr,ur=ar*rr;for(let pr=0;pr!==rr;++pr)tr[ur+pr]=tr[fr+pr]}++ar}}if(sr>0){er[ar]=er[sr];for(let or=sr*rr,lr=ar*rr,cr=0;cr!==rr;++cr)tr[lr+cr]=tr[or+cr];++ar}return ar!==er.length?(this.times=er.slice(0,ar),this.values=tr.slice(0,ar*rr)):(this.times=er,this.values=tr),this}clone(){const er=this.times.slice(),tr=this.values.slice(),rr=this.constructor,nr=new rr(this.name,er,tr);return nr.createInterpolant=this.createInterpolant,nr}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(er,tr,rr){super(er,tr,rr)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(er,tr,rr,nr){super(er,tr,rr,nr)}interpolate_(er,tr,rr,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=(rr-tr)/(nr-tr);let cr=er*or;for(let hr=cr+or;cr!==hr;cr+=4)Quaternion$1.slerpFlat(sr,0,ar,cr-or,ar,cr,lr);return sr}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(er){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),er)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(er,tr,rr){super(er,tr,rr)}}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(er="",tr=-1,rr=[],nr=NormalAnimationBlendMode){this.name=er,this.tracks=rr,this.duration=tr,this.blendMode=nr,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(er){const tr=[],rr=er.tracks,nr=1/(er.fps||1);for(let ar=0,or=rr.length;ar!==or;++ar)tr.push(parseKeyframeTrack(rr[ar]).scale(nr));const sr=new this(er.name,er.duration,tr,er.blendMode);return sr.uuid=er.uuid,sr}static toJSON(er){const tr=[],rr=er.tracks,nr={name:er.name,duration:er.duration,tracks:tr,uuid:er.uuid,blendMode:er.blendMode};for(let sr=0,ar=rr.length;sr!==ar;++sr)tr.push(KeyframeTrack.toJSON(rr[sr]));return nr}static CreateFromMorphTargetSequence(er,tr,rr,nr){const sr=tr.length,ar=[];for(let or=0;or<sr;or++){let lr=[],cr=[];lr.push((or+sr-1)%sr,or,(or+1)%sr),cr.push(0,1,0);const hr=getKeyframeOrder(lr);lr=sortedArray(lr,1,hr),cr=sortedArray(cr,1,hr),!nr&&lr[0]===0&&(lr.push(sr),cr.push(cr[0])),ar.push(new NumberKeyframeTrack(".morphTargetInfluences["+tr[or].name+"]",lr,cr).scale(1/rr))}return new this(er,-1,ar)}static findByName(er,tr){let rr=er;if(!Array.isArray(er)){const nr=er;rr=nr.geometry&&nr.geometry.animations||nr.animations}for(let nr=0;nr<rr.length;nr++)if(rr[nr].name===tr)return rr[nr];return null}static CreateClipsFromMorphTargetSequences(er,tr,rr){const nr={},sr=/^([\w-]*?)([\d]+)$/;for(let or=0,lr=er.length;or<lr;or++){const cr=er[or],hr=cr.name.match(sr);if(hr&&hr.length>1){const fr=hr[1];let ur=nr[fr];ur||(nr[fr]=ur=[]),ur.push(cr)}}const ar=[];for(const or in nr)ar.push(this.CreateFromMorphTargetSequence(or,nr[or],tr,rr));return ar}static parseAnimation(er,tr){if(!er)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const rr=function(fr,ur,pr,gr,_r){if(pr.length!==0){const mr=[],dr=[];flattenJSON(pr,mr,dr,gr),mr.length!==0&&_r.push(new fr(ur,mr,dr))}},nr=[],sr=er.name||"default",ar=er.fps||30,or=er.blendMode;let lr=er.length||-1;const cr=er.hierarchy||[];for(let fr=0;fr<cr.length;fr++){const ur=cr[fr].keys;if(!(!ur||ur.length===0))if(ur[0].morphTargets){const pr={};let gr;for(gr=0;gr<ur.length;gr++)if(ur[gr].morphTargets)for(let _r=0;_r<ur[gr].morphTargets.length;_r++)pr[ur[gr].morphTargets[_r]]=-1;for(const _r in pr){const mr=[],dr=[];for(let vr=0;vr!==ur[gr].morphTargets.length;++vr){const Ar=ur[gr];mr.push(Ar.time),dr.push(Ar.morphTarget===_r?1:0)}nr.push(new NumberKeyframeTrack(".morphTargetInfluence["+_r+"]",mr,dr))}lr=pr.length*ar}else{const pr=".bones["+tr[fr].name+"]";rr(VectorKeyframeTrack,pr+".position",ur,"pos",nr),rr(QuaternionKeyframeTrack,pr+".quaternion",ur,"rot",nr),rr(VectorKeyframeTrack,pr+".scale",ur,"scl",nr)}}return nr.length===0?null:new this(sr,lr,nr,or)}resetDuration(){const er=this.tracks;let tr=0;for(let rr=0,nr=er.length;rr!==nr;++rr){const sr=this.tracks[rr];tr=Math.max(tr,sr.times[sr.times.length-1])}return this.duration=tr,this}trim(){for(let er=0;er<this.tracks.length;er++)this.tracks[er].trim(0,this.duration);return this}validate(){let er=!0;for(let tr=0;tr<this.tracks.length;tr++)er=er&&this.tracks[tr].validate();return er}optimize(){for(let er=0;er<this.tracks.length;er++)this.tracks[er].optimize();return this}clone(){const er=[];for(let tr=0;tr<this.tracks.length;tr++)er.push(this.tracks[tr].clone());return new this.constructor(this.name,this.duration,er,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(ir){switch(ir.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+ir)}function parseKeyframeTrack(ir){if(ir.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const er=getTrackTypeForValueTypeName(ir.type);if(ir.times===void 0){const tr=[],rr=[];flattenJSON(ir.keys,tr,rr,"value"),ir.times=tr,ir.values=rr}return er.parse!==void 0?er.parse(ir):new er(ir.name,ir.times,ir.values,ir.interpolation)}const Cache={enabled:!1,files:{},add:function(ir,er){this.enabled!==!1&&(this.files[ir]=er)},get:function(ir){if(this.enabled!==!1)return this.files[ir]},remove:function(ir){delete this.files[ir]},clear:function(){this.files={}}};class LoadingManager{constructor(er,tr,rr){const nr=this;let sr=!1,ar=0,or=0,lr;const cr=[];this.onStart=void 0,this.onLoad=er,this.onProgress=tr,this.onError=rr,this.itemStart=function(hr){or++,sr===!1&&nr.onStart!==void 0&&nr.onStart(hr,ar,or),sr=!0},this.itemEnd=function(hr){ar++,nr.onProgress!==void 0&&nr.onProgress(hr,ar,or),ar===or&&(sr=!1,nr.onLoad!==void 0&&nr.onLoad())},this.itemError=function(hr){nr.onError!==void 0&&nr.onError(hr)},this.resolveURL=function(hr){return lr?lr(hr):hr},this.setURLModifier=function(hr){return lr=hr,this},this.addHandler=function(hr,fr){return cr.push(hr,fr),this},this.removeHandler=function(hr){const fr=cr.indexOf(hr);return fr!==-1&&cr.splice(fr,2),this},this.getHandler=function(hr){for(let fr=0,ur=cr.length;fr<ur;fr+=2){const pr=cr[fr],gr=cr[fr+1];if(pr.global&&(pr.lastIndex=0),pr.test(hr))return gr}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(er){this.manager=er!==void 0?er:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(er,tr){const rr=this;return new Promise(function(nr,sr){rr.load(er,nr,tr,sr)})}parse(){}setCrossOrigin(er){return this.crossOrigin=er,this}setWithCredentials(er){return this.withCredentials=er,this}setPath(er){return this.path=er,this}setResourcePath(er){return this.resourcePath=er,this}setRequestHeader(er){return this.requestHeader=er,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(er,tr){super(er),this.response=tr}}class FileLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){er===void 0&&(er=""),this.path!==void 0&&(er=this.path+er),er=this.manager.resolveURL(er);const sr=Cache.get(er);if(sr!==void 0)return this.manager.itemStart(er),setTimeout(()=>{tr&&tr(sr),this.manager.itemEnd(er)},0),sr;if(loading[er]!==void 0){loading[er].push({onLoad:tr,onProgress:rr,onError:nr});return}loading[er]=[],loading[er].push({onLoad:tr,onProgress:rr,onError:nr});const ar=new Request(er,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),or=this.mimeType,lr=this.responseType;fetch(ar).then(cr=>{if(cr.status===200||cr.status===0){if(cr.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||cr.body===void 0||cr.body.getReader===void 0)return cr;const hr=loading[er],fr=cr.body.getReader(),ur=cr.headers.get("X-File-Size")||cr.headers.get("Content-Length"),pr=ur?parseInt(ur):0,gr=pr!==0;let _r=0;const mr=new ReadableStream({start(dr){vr();function vr(){fr.read().then(({done:Ar,value:yr})=>{if(Ar)dr.close();else{_r+=yr.byteLength;const wr=new ProgressEvent("progress",{lengthComputable:gr,loaded:_r,total:pr});for(let br=0,Sr=hr.length;br<Sr;br++){const xr=hr[br];xr.onProgress&&xr.onProgress(wr)}dr.enqueue(yr),vr()}},Ar=>{dr.error(Ar)})}}});return new Response(mr)}else throw new HttpError(`fetch for "${cr.url}" responded with ${cr.status}: ${cr.statusText}`,cr)}).then(cr=>{switch(lr){case"arraybuffer":return cr.arrayBuffer();case"blob":return cr.blob();case"document":return cr.text().then(hr=>new DOMParser().parseFromString(hr,or));case"json":return cr.json();default:if(or===void 0)return cr.text();{const fr=/charset="?([^;"\s]*)"?/i.exec(or),ur=fr&&fr[1]?fr[1].toLowerCase():void 0,pr=new TextDecoder(ur);return cr.arrayBuffer().then(gr=>pr.decode(gr))}}}).then(cr=>{Cache.add(er,cr);const hr=loading[er];delete loading[er];for(let fr=0,ur=hr.length;fr<ur;fr++){const pr=hr[fr];pr.onLoad&&pr.onLoad(cr)}}).catch(cr=>{const hr=loading[er];if(hr===void 0)throw this.manager.itemError(er),cr;delete loading[er];for(let fr=0,ur=hr.length;fr<ur;fr++){const pr=hr[fr];pr.onError&&pr.onError(cr)}this.manager.itemError(er)}).finally(()=>{this.manager.itemEnd(er)}),this.manager.itemStart(er)}setResponseType(er){return this.responseType=er,this}setMimeType(er){return this.mimeType=er,this}}class AnimationLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(JSON.parse(or)))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr=[];for(let rr=0;rr<er.length;rr++){const nr=AnimationClip.parse(er[rr]);tr.push(nr)}return tr}}class CompressedTextureLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=[],or=new CompressedTexture,lr=new FileLoader(this.manager);lr.setPath(this.path),lr.setResponseType("arraybuffer"),lr.setRequestHeader(this.requestHeader),lr.setWithCredentials(sr.withCredentials);let cr=0;function hr(fr){lr.load(er[fr],function(ur){const pr=sr.parse(ur,!0);ar[fr]={width:pr.width,height:pr.height,format:pr.format,mipmaps:pr.mipmaps},cr+=1,cr===6&&(pr.mipmapCount===1&&(or.minFilter=LinearFilter),or.image=ar,or.format=pr.format,or.needsUpdate=!0,tr&&tr(or))},rr,nr)}if(Array.isArray(er))for(let fr=0,ur=er.length;fr<ur;++fr)hr(fr);else lr.load(er,function(fr){const ur=sr.parse(fr,!0);if(ur.isCubemap){const pr=ur.mipmaps.length/ur.mipmapCount;for(let gr=0;gr<pr;gr++){ar[gr]={mipmaps:[]};for(let _r=0;_r<ur.mipmapCount;_r++)ar[gr].mipmaps.push(ur.mipmaps[gr*ur.mipmapCount+_r]),ar[gr].format=ur.format,ar[gr].width=ur.width,ar[gr].height=ur.height}or.image=ar}else or.image.width=ur.width,or.image.height=ur.height,or.mipmaps=ur.mipmaps;ur.mipmapCount===1&&(or.minFilter=LinearFilter),or.format=ur.format,or.needsUpdate=!0,tr&&tr(or)},rr,nr);return or}}class ImageLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){this.path!==void 0&&(er=this.path+er),er=this.manager.resolveURL(er);const sr=this,ar=Cache.get(er);if(ar!==void 0)return sr.manager.itemStart(er),setTimeout(function(){tr&&tr(ar),sr.manager.itemEnd(er)},0),ar;const or=createElementNS("img");function lr(){hr(),Cache.add(er,this),tr&&tr(this),sr.manager.itemEnd(er)}function cr(fr){hr(),nr&&nr(fr),sr.manager.itemError(er),sr.manager.itemEnd(er)}function hr(){or.removeEventListener("load",lr,!1),or.removeEventListener("error",cr,!1)}return or.addEventListener("load",lr,!1),or.addEventListener("error",cr,!1),er.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(or.crossOrigin=this.crossOrigin),sr.manager.itemStart(er),or.src=er,or}}class CubeTextureLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=new CubeTexture;sr.colorSpace=SRGBColorSpace;const ar=new ImageLoader(this.manager);ar.setCrossOrigin(this.crossOrigin),ar.setPath(this.path);let or=0;function lr(cr){ar.load(er[cr],function(hr){sr.images[cr]=hr,or++,or===6&&(sr.needsUpdate=!0,tr&&tr(sr))},void 0,nr)}for(let cr=0;cr<er.length;++cr)lr(cr);return sr}}class DataTextureLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new DataTexture,or=new FileLoader(this.manager);return or.setResponseType("arraybuffer"),or.setRequestHeader(this.requestHeader),or.setPath(this.path),or.setWithCredentials(sr.withCredentials),or.load(er,function(lr){let cr;try{cr=sr.parse(lr)}catch(hr){if(nr!==void 0)nr(hr);else{console.error(hr);return}}cr.image!==void 0?ar.image=cr.image:cr.data!==void 0&&(ar.image.width=cr.width,ar.image.height=cr.height,ar.image.data=cr.data),ar.wrapS=cr.wrapS!==void 0?cr.wrapS:ClampToEdgeWrapping,ar.wrapT=cr.wrapT!==void 0?cr.wrapT:ClampToEdgeWrapping,ar.magFilter=cr.magFilter!==void 0?cr.magFilter:LinearFilter,ar.minFilter=cr.minFilter!==void 0?cr.minFilter:LinearFilter,ar.anisotropy=cr.anisotropy!==void 0?cr.anisotropy:1,cr.colorSpace!==void 0&&(ar.colorSpace=cr.colorSpace),cr.flipY!==void 0&&(ar.flipY=cr.flipY),cr.format!==void 0&&(ar.format=cr.format),cr.type!==void 0&&(ar.type=cr.type),cr.mipmaps!==void 0&&(ar.mipmaps=cr.mipmaps,ar.minFilter=LinearMipmapLinearFilter),cr.mipmapCount===1&&(ar.minFilter=LinearFilter),cr.generateMipmaps!==void 0&&(ar.generateMipmaps=cr.generateMipmaps),ar.needsUpdate=!0,tr&&tr(ar,cr)},rr,nr),ar}}class TextureLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=new Texture,ar=new ImageLoader(this.manager);return ar.setCrossOrigin(this.crossOrigin),ar.setPath(this.path),ar.load(er,function(or){sr.image=or,sr.needsUpdate=!0,tr!==void 0&&tr(sr)},rr,nr),sr}}class Light extends Object3D{constructor(er,tr=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(er),this.intensity=tr}dispose(){}copy(er,tr){return super.copy(er,tr),this.color.copy(er.color),this.intensity=er.intensity,this}toJSON(er){const tr=super.toJSON(er);return tr.object.color=this.color.getHex(),tr.object.intensity=this.intensity,this.groundColor!==void 0&&(tr.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(tr.object.distance=this.distance),this.angle!==void 0&&(tr.object.angle=this.angle),this.decay!==void 0&&(tr.object.decay=this.decay),this.penumbra!==void 0&&(tr.object.penumbra=this.penumbra),this.shadow!==void 0&&(tr.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(tr.object.target=this.target.uuid),tr}}class HemisphereLight extends Light{constructor(er,tr,rr){super(er,rr),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(tr)}copy(er,tr){return super.copy(er,tr),this.groundColor.copy(er.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3$1,_lookTarget$1=new Vector3$1;class LightShadow{constructor(er){this.camera=er,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(er){const tr=this.camera,rr=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(er.matrixWorld),tr.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(er.target.matrixWorld),tr.lookAt(_lookTarget$1),tr.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(tr.projectionMatrix,tr.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),rr.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),rr.multiply(_projScreenMatrix$1)}getViewport(er){return this._viewports[er]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(er){return this.camera=er.camera.clone(),this.intensity=er.intensity,this.bias=er.bias,this.radius=er.radius,this.mapSize.copy(er.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const er={};return this.intensity!==1&&(er.intensity=this.intensity),this.bias!==0&&(er.bias=this.bias),this.normalBias!==0&&(er.normalBias=this.normalBias),this.radius!==1&&(er.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(er.mapSize=this.mapSize.toArray()),er.camera=this.camera.toJSON(!1).object,delete er.camera.matrix,er}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(er){const tr=this.camera,rr=RAD2DEG*2*er.angle*this.focus,nr=this.mapSize.width/this.mapSize.height,sr=er.distance||tr.far;(rr!==tr.fov||nr!==tr.aspect||sr!==tr.far)&&(tr.fov=rr,tr.aspect=nr,tr.far=sr,tr.updateProjectionMatrix()),super.updateMatrices(er)}copy(er){return super.copy(er),this.focus=er.focus,this}}class SpotLight extends Light{constructor(er,tr,rr=0,nr=Math.PI/3,sr=0,ar=2){super(er,tr),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=rr,this.angle=nr,this.penumbra=sr,this.decay=ar,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(er){this.intensity=er/Math.PI}dispose(){this.shadow.dispose()}copy(er,tr){return super.copy(er,tr),this.distance=er.distance,this.angle=er.angle,this.penumbra=er.penumbra,this.decay=er.decay,this.target=er.target.clone(),this.shadow=er.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3$1,_lookTarget=new Vector3$1;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3$1(1,0,0),new Vector3$1(-1,0,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1),new Vector3$1(0,1,0),new Vector3$1(0,-1,0)],this._cubeUps=[new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1)]}updateMatrices(er,tr=0){const rr=this.camera,nr=this.matrix,sr=er.distance||rr.far;sr!==rr.far&&(rr.far=sr,rr.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(er.matrixWorld),rr.position.copy(_lightPositionWorld),_lookTarget.copy(rr.position),_lookTarget.add(this._cubeDirections[tr]),rr.up.copy(this._cubeUps[tr]),rr.lookAt(_lookTarget),rr.updateMatrixWorld(),nr.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(rr.projectionMatrix,rr.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(er,tr,rr=0,nr=2){super(er,tr),this.isPointLight=!0,this.type="PointLight",this.distance=rr,this.decay=nr,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(er){this.intensity=er/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(er,tr){return super.copy(er,tr),this.distance=er.distance,this.decay=er.decay,this.shadow=er.shadow.clone(),this}}class OrthographicCamera extends Camera{constructor(er=-1,tr=1,rr=1,nr=-1,sr=.1,ar=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=er,this.right=tr,this.top=rr,this.bottom=nr,this.near=sr,this.far=ar,this.updateProjectionMatrix()}copy(er,tr){return super.copy(er,tr),this.left=er.left,this.right=er.right,this.top=er.top,this.bottom=er.bottom,this.near=er.near,this.far=er.far,this.zoom=er.zoom,this.view=er.view===null?null:Object.assign({},er.view),this}setViewOffset(er,tr,rr,nr,sr,ar){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=er,this.view.fullHeight=tr,this.view.offsetX=rr,this.view.offsetY=nr,this.view.width=sr,this.view.height=ar,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const er=(this.right-this.left)/(2*this.zoom),tr=(this.top-this.bottom)/(2*this.zoom),rr=(this.right+this.left)/2,nr=(this.top+this.bottom)/2;let sr=rr-er,ar=rr+er,or=nr+tr,lr=nr-tr;if(this.view!==null&&this.view.enabled){const cr=(this.right-this.left)/this.view.fullWidth/this.zoom,hr=(this.top-this.bottom)/this.view.fullHeight/this.zoom;sr+=cr*this.view.offsetX,ar=sr+cr*this.view.width,or-=hr*this.view.offsetY,lr=or-hr*this.view.height}this.projectionMatrix.makeOrthographic(sr,ar,or,lr,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(er){const tr=super.toJSON(er);return tr.object.zoom=this.zoom,tr.object.left=this.left,tr.object.right=this.right,tr.object.top=this.top,tr.object.bottom=this.bottom,tr.object.near=this.near,tr.object.far=this.far,this.view!==null&&(tr.object.view=Object.assign({},this.view)),tr}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(er,tr){super(er,tr),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(er){return super.copy(er),this.target=er.target.clone(),this.shadow=er.shadow.clone(),this}}class AmbientLight extends Light{constructor(er,tr){super(er,tr),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(er,tr,rr=10,nr=10){super(er,tr),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=rr,this.height=nr}get power(){return this.intensity*this.width*this.height*Math.PI}set power(er){this.intensity=er/(this.width*this.height*Math.PI)}copy(er){return super.copy(er),this.width=er.width,this.height=er.height,this}toJSON(er){const tr=super.toJSON(er);return tr.object.width=this.width,tr.object.height=this.height,tr}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let er=0;er<9;er++)this.coefficients.push(new Vector3$1)}set(er){for(let tr=0;tr<9;tr++)this.coefficients[tr].copy(er[tr]);return this}zero(){for(let er=0;er<9;er++)this.coefficients[er].set(0,0,0);return this}getAt(er,tr){const rr=er.x,nr=er.y,sr=er.z,ar=this.coefficients;return tr.copy(ar[0]).multiplyScalar(.282095),tr.addScaledVector(ar[1],.488603*nr),tr.addScaledVector(ar[2],.488603*sr),tr.addScaledVector(ar[3],.488603*rr),tr.addScaledVector(ar[4],1.092548*(rr*nr)),tr.addScaledVector(ar[5],1.092548*(nr*sr)),tr.addScaledVector(ar[6],.315392*(3*sr*sr-1)),tr.addScaledVector(ar[7],1.092548*(rr*sr)),tr.addScaledVector(ar[8],.546274*(rr*rr-nr*nr)),tr}getIrradianceAt(er,tr){const rr=er.x,nr=er.y,sr=er.z,ar=this.coefficients;return tr.copy(ar[0]).multiplyScalar(.886227),tr.addScaledVector(ar[1],2*.511664*nr),tr.addScaledVector(ar[2],2*.511664*sr),tr.addScaledVector(ar[3],2*.511664*rr),tr.addScaledVector(ar[4],2*.429043*rr*nr),tr.addScaledVector(ar[5],2*.429043*nr*sr),tr.addScaledVector(ar[6],.743125*sr*sr-.247708),tr.addScaledVector(ar[7],2*.429043*rr*sr),tr.addScaledVector(ar[8],.429043*(rr*rr-nr*nr)),tr}add(er){for(let tr=0;tr<9;tr++)this.coefficients[tr].add(er.coefficients[tr]);return this}addScaledSH(er,tr){for(let rr=0;rr<9;rr++)this.coefficients[rr].addScaledVector(er.coefficients[rr],tr);return this}scale(er){for(let tr=0;tr<9;tr++)this.coefficients[tr].multiplyScalar(er);return this}lerp(er,tr){for(let rr=0;rr<9;rr++)this.coefficients[rr].lerp(er.coefficients[rr],tr);return this}equals(er){for(let tr=0;tr<9;tr++)if(!this.coefficients[tr].equals(er.coefficients[tr]))return!1;return!0}copy(er){return this.set(er.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(er,tr=0){const rr=this.coefficients;for(let nr=0;nr<9;nr++)rr[nr].fromArray(er,tr+nr*3);return this}toArray(er=[],tr=0){const rr=this.coefficients;for(let nr=0;nr<9;nr++)rr[nr].toArray(er,tr+nr*3);return er}static getBasisAt(er,tr){const rr=er.x,nr=er.y,sr=er.z;tr[0]=.282095,tr[1]=.488603*nr,tr[2]=.488603*sr,tr[3]=.488603*rr,tr[4]=1.092548*rr*nr,tr[5]=1.092548*nr*sr,tr[6]=.315392*(3*sr*sr-1),tr[7]=1.092548*rr*sr,tr[8]=.546274*(rr*rr-nr*nr)}}class LightProbe extends Light{constructor(er=new SphericalHarmonics3,tr=1){super(void 0,tr),this.isLightProbe=!0,this.sh=er}copy(er){return super.copy(er),this.sh.copy(er.sh),this}fromJSON(er){return this.intensity=er.intensity,this.sh.fromArray(er.sh),this}toJSON(er){const tr=super.toJSON(er);return tr.object.sh=this.sh.toArray(),tr}}class MaterialLoader extends Loader{constructor(er){super(er),this.textures={}}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(JSON.parse(or)))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr=this.textures;function rr(sr){return tr[sr]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",sr),tr[sr]}const nr=this.createMaterialFromType(er.type);if(er.uuid!==void 0&&(nr.uuid=er.uuid),er.name!==void 0&&(nr.name=er.name),er.color!==void 0&&nr.color!==void 0&&nr.color.setHex(er.color),er.roughness!==void 0&&(nr.roughness=er.roughness),er.metalness!==void 0&&(nr.metalness=er.metalness),er.sheen!==void 0&&(nr.sheen=er.sheen),er.sheenColor!==void 0&&(nr.sheenColor=new Color().setHex(er.sheenColor)),er.sheenRoughness!==void 0&&(nr.sheenRoughness=er.sheenRoughness),er.emissive!==void 0&&nr.emissive!==void 0&&nr.emissive.setHex(er.emissive),er.specular!==void 0&&nr.specular!==void 0&&nr.specular.setHex(er.specular),er.specularIntensity!==void 0&&(nr.specularIntensity=er.specularIntensity),er.specularColor!==void 0&&nr.specularColor!==void 0&&nr.specularColor.setHex(er.specularColor),er.shininess!==void 0&&(nr.shininess=er.shininess),er.clearcoat!==void 0&&(nr.clearcoat=er.clearcoat),er.clearcoatRoughness!==void 0&&(nr.clearcoatRoughness=er.clearcoatRoughness),er.dispersion!==void 0&&(nr.dispersion=er.dispersion),er.iridescence!==void 0&&(nr.iridescence=er.iridescence),er.iridescenceIOR!==void 0&&(nr.iridescenceIOR=er.iridescenceIOR),er.iridescenceThicknessRange!==void 0&&(nr.iridescenceThicknessRange=er.iridescenceThicknessRange),er.transmission!==void 0&&(nr.transmission=er.transmission),er.thickness!==void 0&&(nr.thickness=er.thickness),er.attenuationDistance!==void 0&&(nr.attenuationDistance=er.attenuationDistance),er.attenuationColor!==void 0&&nr.attenuationColor!==void 0&&nr.attenuationColor.setHex(er.attenuationColor),er.anisotropy!==void 0&&(nr.anisotropy=er.anisotropy),er.anisotropyRotation!==void 0&&(nr.anisotropyRotation=er.anisotropyRotation),er.fog!==void 0&&(nr.fog=er.fog),er.flatShading!==void 0&&(nr.flatShading=er.flatShading),er.blending!==void 0&&(nr.blending=er.blending),er.combine!==void 0&&(nr.combine=er.combine),er.side!==void 0&&(nr.side=er.side),er.shadowSide!==void 0&&(nr.shadowSide=er.shadowSide),er.opacity!==void 0&&(nr.opacity=er.opacity),er.transparent!==void 0&&(nr.transparent=er.transparent),er.alphaTest!==void 0&&(nr.alphaTest=er.alphaTest),er.alphaHash!==void 0&&(nr.alphaHash=er.alphaHash),er.depthFunc!==void 0&&(nr.depthFunc=er.depthFunc),er.depthTest!==void 0&&(nr.depthTest=er.depthTest),er.depthWrite!==void 0&&(nr.depthWrite=er.depthWrite),er.colorWrite!==void 0&&(nr.colorWrite=er.colorWrite),er.blendSrc!==void 0&&(nr.blendSrc=er.blendSrc),er.blendDst!==void 0&&(nr.blendDst=er.blendDst),er.blendEquation!==void 0&&(nr.blendEquation=er.blendEquation),er.blendSrcAlpha!==void 0&&(nr.blendSrcAlpha=er.blendSrcAlpha),er.blendDstAlpha!==void 0&&(nr.blendDstAlpha=er.blendDstAlpha),er.blendEquationAlpha!==void 0&&(nr.blendEquationAlpha=er.blendEquationAlpha),er.blendColor!==void 0&&nr.blendColor!==void 0&&nr.blendColor.setHex(er.blendColor),er.blendAlpha!==void 0&&(nr.blendAlpha=er.blendAlpha),er.stencilWriteMask!==void 0&&(nr.stencilWriteMask=er.stencilWriteMask),er.stencilFunc!==void 0&&(nr.stencilFunc=er.stencilFunc),er.stencilRef!==void 0&&(nr.stencilRef=er.stencilRef),er.stencilFuncMask!==void 0&&(nr.stencilFuncMask=er.stencilFuncMask),er.stencilFail!==void 0&&(nr.stencilFail=er.stencilFail),er.stencilZFail!==void 0&&(nr.stencilZFail=er.stencilZFail),er.stencilZPass!==void 0&&(nr.stencilZPass=er.stencilZPass),er.stencilWrite!==void 0&&(nr.stencilWrite=er.stencilWrite),er.wireframe!==void 0&&(nr.wireframe=er.wireframe),er.wireframeLinewidth!==void 0&&(nr.wireframeLinewidth=er.wireframeLinewidth),er.wireframeLinecap!==void 0&&(nr.wireframeLinecap=er.wireframeLinecap),er.wireframeLinejoin!==void 0&&(nr.wireframeLinejoin=er.wireframeLinejoin),er.rotation!==void 0&&(nr.rotation=er.rotation),er.linewidth!==void 0&&(nr.linewidth=er.linewidth),er.dashSize!==void 0&&(nr.dashSize=er.dashSize),er.gapSize!==void 0&&(nr.gapSize=er.gapSize),er.scale!==void 0&&(nr.scale=er.scale),er.polygonOffset!==void 0&&(nr.polygonOffset=er.polygonOffset),er.polygonOffsetFactor!==void 0&&(nr.polygonOffsetFactor=er.polygonOffsetFactor),er.polygonOffsetUnits!==void 0&&(nr.polygonOffsetUnits=er.polygonOffsetUnits),er.dithering!==void 0&&(nr.dithering=er.dithering),er.alphaToCoverage!==void 0&&(nr.alphaToCoverage=er.alphaToCoverage),er.premultipliedAlpha!==void 0&&(nr.premultipliedAlpha=er.premultipliedAlpha),er.forceSinglePass!==void 0&&(nr.forceSinglePass=er.forceSinglePass),er.visible!==void 0&&(nr.visible=er.visible),er.toneMapped!==void 0&&(nr.toneMapped=er.toneMapped),er.userData!==void 0&&(nr.userData=er.userData),er.vertexColors!==void 0&&(typeof er.vertexColors=="number"?nr.vertexColors=er.vertexColors>0:nr.vertexColors=er.vertexColors),er.uniforms!==void 0)for(const sr in er.uniforms){const ar=er.uniforms[sr];switch(nr.uniforms[sr]={},ar.type){case"t":nr.uniforms[sr].value=rr(ar.value);break;case"c":nr.uniforms[sr].value=new Color().setHex(ar.value);break;case"v2":nr.uniforms[sr].value=new Vector2().fromArray(ar.value);break;case"v3":nr.uniforms[sr].value=new Vector3$1().fromArray(ar.value);break;case"v4":nr.uniforms[sr].value=new Vector4().fromArray(ar.value);break;case"m3":nr.uniforms[sr].value=new Matrix3().fromArray(ar.value);break;case"m4":nr.uniforms[sr].value=new Matrix4().fromArray(ar.value);break;default:nr.uniforms[sr].value=ar.value}}if(er.defines!==void 0&&(nr.defines=er.defines),er.vertexShader!==void 0&&(nr.vertexShader=er.vertexShader),er.fragmentShader!==void 0&&(nr.fragmentShader=er.fragmentShader),er.glslVersion!==void 0&&(nr.glslVersion=er.glslVersion),er.extensions!==void 0)for(const sr in er.extensions)nr.extensions[sr]=er.extensions[sr];if(er.lights!==void 0&&(nr.lights=er.lights),er.clipping!==void 0&&(nr.clipping=er.clipping),er.size!==void 0&&(nr.size=er.size),er.sizeAttenuation!==void 0&&(nr.sizeAttenuation=er.sizeAttenuation),er.map!==void 0&&(nr.map=rr(er.map)),er.matcap!==void 0&&(nr.matcap=rr(er.matcap)),er.alphaMap!==void 0&&(nr.alphaMap=rr(er.alphaMap)),er.bumpMap!==void 0&&(nr.bumpMap=rr(er.bumpMap)),er.bumpScale!==void 0&&(nr.bumpScale=er.bumpScale),er.normalMap!==void 0&&(nr.normalMap=rr(er.normalMap)),er.normalMapType!==void 0&&(nr.normalMapType=er.normalMapType),er.normalScale!==void 0){let sr=er.normalScale;Array.isArray(sr)===!1&&(sr=[sr,sr]),nr.normalScale=new Vector2().fromArray(sr)}return er.displacementMap!==void 0&&(nr.displacementMap=rr(er.displacementMap)),er.displacementScale!==void 0&&(nr.displacementScale=er.displacementScale),er.displacementBias!==void 0&&(nr.displacementBias=er.displacementBias),er.roughnessMap!==void 0&&(nr.roughnessMap=rr(er.roughnessMap)),er.metalnessMap!==void 0&&(nr.metalnessMap=rr(er.metalnessMap)),er.emissiveMap!==void 0&&(nr.emissiveMap=rr(er.emissiveMap)),er.emissiveIntensity!==void 0&&(nr.emissiveIntensity=er.emissiveIntensity),er.specularMap!==void 0&&(nr.specularMap=rr(er.specularMap)),er.specularIntensityMap!==void 0&&(nr.specularIntensityMap=rr(er.specularIntensityMap)),er.specularColorMap!==void 0&&(nr.specularColorMap=rr(er.specularColorMap)),er.envMap!==void 0&&(nr.envMap=rr(er.envMap)),er.envMapRotation!==void 0&&nr.envMapRotation.fromArray(er.envMapRotation),er.envMapIntensity!==void 0&&(nr.envMapIntensity=er.envMapIntensity),er.reflectivity!==void 0&&(nr.reflectivity=er.reflectivity),er.refractionRatio!==void 0&&(nr.refractionRatio=er.refractionRatio),er.lightMap!==void 0&&(nr.lightMap=rr(er.lightMap)),er.lightMapIntensity!==void 0&&(nr.lightMapIntensity=er.lightMapIntensity),er.aoMap!==void 0&&(nr.aoMap=rr(er.aoMap)),er.aoMapIntensity!==void 0&&(nr.aoMapIntensity=er.aoMapIntensity),er.gradientMap!==void 0&&(nr.gradientMap=rr(er.gradientMap)),er.clearcoatMap!==void 0&&(nr.clearcoatMap=rr(er.clearcoatMap)),er.clearcoatRoughnessMap!==void 0&&(nr.clearcoatRoughnessMap=rr(er.clearcoatRoughnessMap)),er.clearcoatNormalMap!==void 0&&(nr.clearcoatNormalMap=rr(er.clearcoatNormalMap)),er.clearcoatNormalScale!==void 0&&(nr.clearcoatNormalScale=new Vector2().fromArray(er.clearcoatNormalScale)),er.iridescenceMap!==void 0&&(nr.iridescenceMap=rr(er.iridescenceMap)),er.iridescenceThicknessMap!==void 0&&(nr.iridescenceThicknessMap=rr(er.iridescenceThicknessMap)),er.transmissionMap!==void 0&&(nr.transmissionMap=rr(er.transmissionMap)),er.thicknessMap!==void 0&&(nr.thicknessMap=rr(er.thicknessMap)),er.anisotropyMap!==void 0&&(nr.anisotropyMap=rr(er.anisotropyMap)),er.sheenColorMap!==void 0&&(nr.sheenColorMap=rr(er.sheenColorMap)),er.sheenRoughnessMap!==void 0&&(nr.sheenRoughnessMap=rr(er.sheenRoughnessMap)),nr}setTextures(er){return this.textures=er,this}createMaterialFromType(er){return MaterialLoader.createMaterialFromType(er)}static createMaterialFromType(er){const tr={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new tr[er]}}class LoaderUtils{static decodeText(er){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(er);let tr="";for(let rr=0,nr=er.length;rr<nr;rr++)tr+=String.fromCharCode(er[rr]);try{return decodeURIComponent(escape(tr))}catch{return tr}}static extractUrlBase(er){const tr=er.lastIndexOf("/");return tr===-1?"./":er.slice(0,tr+1)}static resolveURL(er,tr){return typeof er!="string"||er===""?"":(/^https?:\/\//i.test(tr)&&/^\//.test(er)&&(tr=tr.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(er)||/^data:.*,.*$/i.test(er)||/^blob:.*$/i.test(er)?er:tr+er)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(er){return super.copy(er),this.instanceCount=er.instanceCount,this}toJSON(){const er=super.toJSON();return er.instanceCount=this.instanceCount,er.isInstancedBufferGeometry=!0,er}}class BufferGeometryLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(JSON.parse(or)))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr={},rr={};function nr(pr,gr){if(tr[gr]!==void 0)return tr[gr];const mr=pr.interleavedBuffers[gr],dr=sr(pr,mr.buffer),vr=getTypedArray(mr.type,dr),Ar=new InterleavedBuffer(vr,mr.stride);return Ar.uuid=mr.uuid,tr[gr]=Ar,Ar}function sr(pr,gr){if(rr[gr]!==void 0)return rr[gr];const mr=pr.arrayBuffers[gr],dr=new Uint32Array(mr).buffer;return rr[gr]=dr,dr}const ar=er.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,or=er.data.index;if(or!==void 0){const pr=getTypedArray(or.type,or.array);ar.setIndex(new BufferAttribute(pr,1))}const lr=er.data.attributes;for(const pr in lr){const gr=lr[pr];let _r;if(gr.isInterleavedBufferAttribute){const mr=nr(er.data,gr.data);_r=new InterleavedBufferAttribute(mr,gr.itemSize,gr.offset,gr.normalized)}else{const mr=getTypedArray(gr.type,gr.array),dr=gr.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;_r=new dr(mr,gr.itemSize,gr.normalized)}gr.name!==void 0&&(_r.name=gr.name),gr.usage!==void 0&&_r.setUsage(gr.usage),ar.setAttribute(pr,_r)}const cr=er.data.morphAttributes;if(cr)for(const pr in cr){const gr=cr[pr],_r=[];for(let mr=0,dr=gr.length;mr<dr;mr++){const vr=gr[mr];let Ar;if(vr.isInterleavedBufferAttribute){const yr=nr(er.data,vr.data);Ar=new InterleavedBufferAttribute(yr,vr.itemSize,vr.offset,vr.normalized)}else{const yr=getTypedArray(vr.type,vr.array);Ar=new BufferAttribute(yr,vr.itemSize,vr.normalized)}vr.name!==void 0&&(Ar.name=vr.name),_r.push(Ar)}ar.morphAttributes[pr]=_r}er.data.morphTargetsRelative&&(ar.morphTargetsRelative=!0);const fr=er.data.groups||er.data.drawcalls||er.data.offsets;if(fr!==void 0)for(let pr=0,gr=fr.length;pr!==gr;++pr){const _r=fr[pr];ar.addGroup(_r.start,_r.count,_r.materialIndex)}const ur=er.data.boundingSphere;if(ur!==void 0){const pr=new Vector3$1;ur.center!==void 0&&pr.fromArray(ur.center),ar.boundingSphere=new Sphere(pr,ur.radius)}return er.name&&(ar.name=er.name),er.userData&&(ar.userData=er.userData),ar}}class ObjectLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=this.path===""?LoaderUtils.extractUrlBase(er):this.path;this.resourcePath=this.resourcePath||ar;const or=new FileLoader(this.manager);or.setPath(this.path),or.setRequestHeader(this.requestHeader),or.setWithCredentials(this.withCredentials),or.load(er,function(lr){let cr=null;try{cr=JSON.parse(lr)}catch(fr){nr!==void 0&&nr(fr),console.error("THREE:ObjectLoader: Can't parse "+er+".",fr.message);return}const hr=cr.metadata;if(hr===void 0||hr.type===void 0||hr.type.toLowerCase()==="geometry"){nr!==void 0&&nr(new Error("THREE.ObjectLoader: Can't load "+er)),console.error("THREE.ObjectLoader: Can't load "+er);return}sr.parse(cr,tr)},rr,nr)}async loadAsync(er,tr){const rr=this,nr=this.path===""?LoaderUtils.extractUrlBase(er):this.path;this.resourcePath=this.resourcePath||nr;const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setRequestHeader(this.requestHeader),sr.setWithCredentials(this.withCredentials);const ar=await sr.loadAsync(er,tr),or=JSON.parse(ar),lr=or.metadata;if(lr===void 0||lr.type===void 0||lr.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+er);return await rr.parseAsync(or)}parse(er,tr){const rr=this.parseAnimations(er.animations),nr=this.parseShapes(er.shapes),sr=this.parseGeometries(er.geometries,nr),ar=this.parseImages(er.images,function(){tr!==void 0&&tr(cr)}),or=this.parseTextures(er.textures,ar),lr=this.parseMaterials(er.materials,or),cr=this.parseObject(er.object,sr,lr,or,rr),hr=this.parseSkeletons(er.skeletons,cr);if(this.bindSkeletons(cr,hr),this.bindLightTargets(cr),tr!==void 0){let fr=!1;for(const ur in ar)if(ar[ur].data instanceof HTMLImageElement){fr=!0;break}fr===!1&&tr(cr)}return cr}async parseAsync(er){const tr=this.parseAnimations(er.animations),rr=this.parseShapes(er.shapes),nr=this.parseGeometries(er.geometries,rr),sr=await this.parseImagesAsync(er.images),ar=this.parseTextures(er.textures,sr),or=this.parseMaterials(er.materials,ar),lr=this.parseObject(er.object,nr,or,ar,tr),cr=this.parseSkeletons(er.skeletons,lr);return this.bindSkeletons(lr,cr),this.bindLightTargets(lr),lr}parseShapes(er){const tr={};if(er!==void 0)for(let rr=0,nr=er.length;rr<nr;rr++){const sr=new Shape$1().fromJSON(er[rr]);tr[sr.uuid]=sr}return tr}parseSkeletons(er,tr){const rr={},nr={};if(tr.traverse(function(sr){sr.isBone&&(nr[sr.uuid]=sr)}),er!==void 0)for(let sr=0,ar=er.length;sr<ar;sr++){const or=new Skeleton().fromJSON(er[sr],nr);rr[or.uuid]=or}return rr}parseGeometries(er,tr){const rr={};if(er!==void 0){const nr=new BufferGeometryLoader;for(let sr=0,ar=er.length;sr<ar;sr++){let or;const lr=er[sr];switch(lr.type){case"BufferGeometry":case"InstancedBufferGeometry":or=nr.parse(lr);break;default:lr.type in Geometries?or=Geometries[lr.type].fromJSON(lr,tr):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${lr.type}"`)}or.uuid=lr.uuid,lr.name!==void 0&&(or.name=lr.name),lr.userData!==void 0&&(or.userData=lr.userData),rr[lr.uuid]=or}}return rr}parseMaterials(er,tr){const rr={},nr={};if(er!==void 0){const sr=new MaterialLoader;sr.setTextures(tr);for(let ar=0,or=er.length;ar<or;ar++){const lr=er[ar];rr[lr.uuid]===void 0&&(rr[lr.uuid]=sr.parse(lr)),nr[lr.uuid]=rr[lr.uuid]}}return nr}parseAnimations(er){const tr={};if(er!==void 0)for(let rr=0;rr<er.length;rr++){const nr=er[rr],sr=AnimationClip.parse(nr);tr[sr.uuid]=sr}return tr}parseImages(er,tr){const rr=this,nr={};let sr;function ar(lr){return rr.manager.itemStart(lr),sr.load(lr,function(){rr.manager.itemEnd(lr)},void 0,function(){rr.manager.itemError(lr),rr.manager.itemEnd(lr)})}function or(lr){if(typeof lr=="string"){const cr=lr,hr=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(cr)?cr:rr.resourcePath+cr;return ar(hr)}else return lr.data?{data:getTypedArray(lr.type,lr.data),width:lr.width,height:lr.height}:null}if(er!==void 0&&er.length>0){const lr=new LoadingManager(tr);sr=new ImageLoader(lr),sr.setCrossOrigin(this.crossOrigin);for(let cr=0,hr=er.length;cr<hr;cr++){const fr=er[cr],ur=fr.url;if(Array.isArray(ur)){const pr=[];for(let gr=0,_r=ur.length;gr<_r;gr++){const mr=ur[gr],dr=or(mr);dr!==null&&(dr instanceof HTMLImageElement?pr.push(dr):pr.push(new DataTexture(dr.data,dr.width,dr.height)))}nr[fr.uuid]=new Source(pr)}else{const pr=or(fr.url);nr[fr.uuid]=new Source(pr)}}}return nr}async parseImagesAsync(er){const tr=this,rr={};let nr;async function sr(ar){if(typeof ar=="string"){const or=ar,lr=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(or)?or:tr.resourcePath+or;return await nr.loadAsync(lr)}else return ar.data?{data:getTypedArray(ar.type,ar.data),width:ar.width,height:ar.height}:null}if(er!==void 0&&er.length>0){nr=new ImageLoader(this.manager),nr.setCrossOrigin(this.crossOrigin);for(let ar=0,or=er.length;ar<or;ar++){const lr=er[ar],cr=lr.url;if(Array.isArray(cr)){const hr=[];for(let fr=0,ur=cr.length;fr<ur;fr++){const pr=cr[fr],gr=await sr(pr);gr!==null&&(gr instanceof HTMLImageElement?hr.push(gr):hr.push(new DataTexture(gr.data,gr.width,gr.height)))}rr[lr.uuid]=new Source(hr)}else{const hr=await sr(lr.url);rr[lr.uuid]=new Source(hr)}}}return rr}parseTextures(er,tr){function rr(sr,ar){return typeof sr=="number"?sr:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",sr),ar[sr])}const nr={};if(er!==void 0)for(let sr=0,ar=er.length;sr<ar;sr++){const or=er[sr];or.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',or.uuid),tr[or.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",or.image);const lr=tr[or.image],cr=lr.data;let hr;Array.isArray(cr)?(hr=new CubeTexture,cr.length===6&&(hr.needsUpdate=!0)):(cr&&cr.data?hr=new DataTexture:hr=new Texture,cr&&(hr.needsUpdate=!0)),hr.source=lr,hr.uuid=or.uuid,or.name!==void 0&&(hr.name=or.name),or.mapping!==void 0&&(hr.mapping=rr(or.mapping,TEXTURE_MAPPING)),or.channel!==void 0&&(hr.channel=or.channel),or.offset!==void 0&&hr.offset.fromArray(or.offset),or.repeat!==void 0&&hr.repeat.fromArray(or.repeat),or.center!==void 0&&hr.center.fromArray(or.center),or.rotation!==void 0&&(hr.rotation=or.rotation),or.wrap!==void 0&&(hr.wrapS=rr(or.wrap[0],TEXTURE_WRAPPING),hr.wrapT=rr(or.wrap[1],TEXTURE_WRAPPING)),or.format!==void 0&&(hr.format=or.format),or.internalFormat!==void 0&&(hr.internalFormat=or.internalFormat),or.type!==void 0&&(hr.type=or.type),or.colorSpace!==void 0&&(hr.colorSpace=or.colorSpace),or.minFilter!==void 0&&(hr.minFilter=rr(or.minFilter,TEXTURE_FILTER)),or.magFilter!==void 0&&(hr.magFilter=rr(or.magFilter,TEXTURE_FILTER)),or.anisotropy!==void 0&&(hr.anisotropy=or.anisotropy),or.flipY!==void 0&&(hr.flipY=or.flipY),or.generateMipmaps!==void 0&&(hr.generateMipmaps=or.generateMipmaps),or.premultiplyAlpha!==void 0&&(hr.premultiplyAlpha=or.premultiplyAlpha),or.unpackAlignment!==void 0&&(hr.unpackAlignment=or.unpackAlignment),or.compareFunction!==void 0&&(hr.compareFunction=or.compareFunction),or.userData!==void 0&&(hr.userData=or.userData),nr[or.uuid]=hr}return nr}parseObject(er,tr,rr,nr,sr){let ar;function or(ur){return tr[ur]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",ur),tr[ur]}function lr(ur){if(ur!==void 0){if(Array.isArray(ur)){const pr=[];for(let gr=0,_r=ur.length;gr<_r;gr++){const mr=ur[gr];rr[mr]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",mr),pr.push(rr[mr])}return pr}return rr[ur]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ur),rr[ur]}}function cr(ur){return nr[ur]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",ur),nr[ur]}let hr,fr;switch(er.type){case"Scene":ar=new Scene,er.background!==void 0&&(Number.isInteger(er.background)?ar.background=new Color(er.background):ar.background=cr(er.background)),er.environment!==void 0&&(ar.environment=cr(er.environment)),er.fog!==void 0&&(er.fog.type==="Fog"?ar.fog=new Fog(er.fog.color,er.fog.near,er.fog.far):er.fog.type==="FogExp2"&&(ar.fog=new FogExp2(er.fog.color,er.fog.density)),er.fog.name!==""&&(ar.fog.name=er.fog.name)),er.backgroundBlurriness!==void 0&&(ar.backgroundBlurriness=er.backgroundBlurriness),er.backgroundIntensity!==void 0&&(ar.backgroundIntensity=er.backgroundIntensity),er.backgroundRotation!==void 0&&ar.backgroundRotation.fromArray(er.backgroundRotation),er.environmentIntensity!==void 0&&(ar.environmentIntensity=er.environmentIntensity),er.environmentRotation!==void 0&&ar.environmentRotation.fromArray(er.environmentRotation);break;case"PerspectiveCamera":ar=new PerspectiveCamera(er.fov,er.aspect,er.near,er.far),er.focus!==void 0&&(ar.focus=er.focus),er.zoom!==void 0&&(ar.zoom=er.zoom),er.filmGauge!==void 0&&(ar.filmGauge=er.filmGauge),er.filmOffset!==void 0&&(ar.filmOffset=er.filmOffset),er.view!==void 0&&(ar.view=Object.assign({},er.view));break;case"OrthographicCamera":ar=new OrthographicCamera(er.left,er.right,er.top,er.bottom,er.near,er.far),er.zoom!==void 0&&(ar.zoom=er.zoom),er.view!==void 0&&(ar.view=Object.assign({},er.view));break;case"AmbientLight":ar=new AmbientLight(er.color,er.intensity);break;case"DirectionalLight":ar=new DirectionalLight(er.color,er.intensity),ar.target=er.target||"";break;case"PointLight":ar=new PointLight(er.color,er.intensity,er.distance,er.decay);break;case"RectAreaLight":ar=new RectAreaLight(er.color,er.intensity,er.width,er.height);break;case"SpotLight":ar=new SpotLight(er.color,er.intensity,er.distance,er.angle,er.penumbra,er.decay),ar.target=er.target||"";break;case"HemisphereLight":ar=new HemisphereLight(er.color,er.groundColor,er.intensity);break;case"LightProbe":ar=new LightProbe().fromJSON(er);break;case"SkinnedMesh":hr=or(er.geometry),fr=lr(er.material),ar=new SkinnedMesh(hr,fr),er.bindMode!==void 0&&(ar.bindMode=er.bindMode),er.bindMatrix!==void 0&&ar.bindMatrix.fromArray(er.bindMatrix),er.skeleton!==void 0&&(ar.skeleton=er.skeleton);break;case"Mesh":hr=or(er.geometry),fr=lr(er.material),ar=new Mesh(hr,fr);break;case"InstancedMesh":hr=or(er.geometry),fr=lr(er.material);const ur=er.count,pr=er.instanceMatrix,gr=er.instanceColor;ar=new InstancedMesh(hr,fr,ur),ar.instanceMatrix=new InstancedBufferAttribute(new Float32Array(pr.array),16),gr!==void 0&&(ar.instanceColor=new InstancedBufferAttribute(new Float32Array(gr.array),gr.itemSize));break;case"BatchedMesh":hr=or(er.geometry),fr=lr(er.material),ar=new BatchedMesh(er.maxInstanceCount,er.maxVertexCount,er.maxIndexCount,fr),ar.geometry=hr,ar.perObjectFrustumCulled=er.perObjectFrustumCulled,ar.sortObjects=er.sortObjects,ar._drawRanges=er.drawRanges,ar._reservedRanges=er.reservedRanges,ar._visibility=er.visibility,ar._active=er.active,ar._bounds=er.bounds.map(_r=>{const mr=new Box3;mr.min.fromArray(_r.boxMin),mr.max.fromArray(_r.boxMax);const dr=new Sphere;return dr.radius=_r.sphereRadius,dr.center.fromArray(_r.sphereCenter),{boxInitialized:_r.boxInitialized,box:mr,sphereInitialized:_r.sphereInitialized,sphere:dr}}),ar._maxInstanceCount=er.maxInstanceCount,ar._maxVertexCount=er.maxVertexCount,ar._maxIndexCount=er.maxIndexCount,ar._geometryInitialized=er.geometryInitialized,ar._geometryCount=er.geometryCount,ar._matricesTexture=cr(er.matricesTexture.uuid),er.colorsTexture!==void 0&&(ar._colorsTexture=cr(er.colorsTexture.uuid));break;case"LOD":ar=new LOD;break;case"Line":ar=new Line(or(er.geometry),lr(er.material));break;case"LineLoop":ar=new LineLoop(or(er.geometry),lr(er.material));break;case"LineSegments":ar=new LineSegments(or(er.geometry),lr(er.material));break;case"PointCloud":case"Points":ar=new Points(or(er.geometry),lr(er.material));break;case"Sprite":ar=new Sprite(lr(er.material));break;case"Group":ar=new Group;break;case"Bone":ar=new Bone;break;default:ar=new Object3D}if(ar.uuid=er.uuid,er.name!==void 0&&(ar.name=er.name),er.matrix!==void 0?(ar.matrix.fromArray(er.matrix),er.matrixAutoUpdate!==void 0&&(ar.matrixAutoUpdate=er.matrixAutoUpdate),ar.matrixAutoUpdate&&ar.matrix.decompose(ar.position,ar.quaternion,ar.scale)):(er.position!==void 0&&ar.position.fromArray(er.position),er.rotation!==void 0&&ar.rotation.fromArray(er.rotation),er.quaternion!==void 0&&ar.quaternion.fromArray(er.quaternion),er.scale!==void 0&&ar.scale.fromArray(er.scale)),er.up!==void 0&&ar.up.fromArray(er.up),er.castShadow!==void 0&&(ar.castShadow=er.castShadow),er.receiveShadow!==void 0&&(ar.receiveShadow=er.receiveShadow),er.shadow&&(er.shadow.intensity!==void 0&&(ar.shadow.intensity=er.shadow.intensity),er.shadow.bias!==void 0&&(ar.shadow.bias=er.shadow.bias),er.shadow.normalBias!==void 0&&(ar.shadow.normalBias=er.shadow.normalBias),er.shadow.radius!==void 0&&(ar.shadow.radius=er.shadow.radius),er.shadow.mapSize!==void 0&&ar.shadow.mapSize.fromArray(er.shadow.mapSize),er.shadow.camera!==void 0&&(ar.shadow.camera=this.parseObject(er.shadow.camera))),er.visible!==void 0&&(ar.visible=er.visible),er.frustumCulled!==void 0&&(ar.frustumCulled=er.frustumCulled),er.renderOrder!==void 0&&(ar.renderOrder=er.renderOrder),er.userData!==void 0&&(ar.userData=er.userData),er.layers!==void 0&&(ar.layers.mask=er.layers),er.children!==void 0){const ur=er.children;for(let pr=0;pr<ur.length;pr++)ar.add(this.parseObject(ur[pr],tr,rr,nr,sr))}if(er.animations!==void 0){const ur=er.animations;for(let pr=0;pr<ur.length;pr++){const gr=ur[pr];ar.animations.push(sr[gr])}}if(er.type==="LOD"){er.autoUpdate!==void 0&&(ar.autoUpdate=er.autoUpdate);const ur=er.levels;for(let pr=0;pr<ur.length;pr++){const gr=ur[pr],_r=ar.getObjectByProperty("uuid",gr.object);_r!==void 0&&ar.addLevel(_r,gr.distance,gr.hysteresis)}}return ar}bindSkeletons(er,tr){Object.keys(tr).length!==0&&er.traverse(function(rr){if(rr.isSkinnedMesh===!0&&rr.skeleton!==void 0){const nr=tr[rr.skeleton];nr===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",rr.skeleton):rr.bind(nr,rr.bindMatrix)}})}bindLightTargets(er){er.traverse(function(tr){if(tr.isDirectionalLight||tr.isSpotLight){const rr=tr.target,nr=er.getObjectByProperty("uuid",rr);nr!==void 0?tr.target=nr:tr.target=new Object3D}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(er){super(er),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(er){return this.options=er,this}load(er,tr,rr,nr){er===void 0&&(er=""),this.path!==void 0&&(er=this.path+er),er=this.manager.resolveURL(er);const sr=this,ar=Cache.get(er);if(ar!==void 0){if(sr.manager.itemStart(er),ar.then){ar.then(cr=>{tr&&tr(cr),sr.manager.itemEnd(er)}).catch(cr=>{nr&&nr(cr)});return}return setTimeout(function(){tr&&tr(ar),sr.manager.itemEnd(er)},0),ar}const or={};or.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",or.headers=this.requestHeader;const lr=fetch(er,or).then(function(cr){return cr.blob()}).then(function(cr){return createImageBitmap(cr,Object.assign(sr.options,{colorSpaceConversion:"none"}))}).then(function(cr){return Cache.add(er,cr),tr&&tr(cr),sr.manager.itemEnd(er),cr}).catch(function(cr){nr&&nr(cr),Cache.remove(er),sr.manager.itemError(er),sr.manager.itemEnd(er)});Cache.add(er,lr),sr.manager.itemStart(er)}}let _context;class AudioContext{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(er){_context=er}}class AudioLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setResponseType("arraybuffer"),ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(lr){try{const cr=lr.slice(0);AudioContext.getContext().decodeAudioData(cr,function(fr){tr(fr)}).catch(or)}catch(cr){or(cr)}},rr,nr);function or(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(er){const tr=this._cache;if(tr.focus!==er.focus||tr.fov!==er.fov||tr.aspect!==er.aspect*this.aspect||tr.near!==er.near||tr.far!==er.far||tr.zoom!==er.zoom||tr.eyeSep!==this.eyeSep){tr.focus=er.focus,tr.fov=er.fov,tr.aspect=er.aspect*this.aspect,tr.near=er.near,tr.far=er.far,tr.zoom=er.zoom,tr.eyeSep=this.eyeSep,_projectionMatrix.copy(er.projectionMatrix);const nr=tr.eyeSep/2,sr=nr*tr.near/tr.focus,ar=tr.near*Math.tan(DEG2RAD*tr.fov*.5)/tr.zoom;let or,lr;_eyeLeft.elements[12]=-nr,_eyeRight.elements[12]=nr,or=-ar*tr.aspect+sr,lr=ar*tr.aspect+sr,_projectionMatrix.elements[0]=2*tr.near/(lr-or),_projectionMatrix.elements[8]=(lr+or)/(lr-or),this.cameraL.projectionMatrix.copy(_projectionMatrix),or=-ar*tr.aspect-sr,lr=ar*tr.aspect-sr,_projectionMatrix.elements[0]=2*tr.near/(lr-or),_projectionMatrix.elements[8]=(lr+or)/(lr-or),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(er.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(er.matrixWorld).multiply(_eyeRight)}}class ArrayCamera extends PerspectiveCamera{constructor(er=[]){super(),this.isArrayCamera=!0,this.cameras=er,this.index=0}}class Clock{constructor(er=!0){this.autoStart=er,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now$1(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let er=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const tr=now$1();er=(tr-this.oldTime)/1e3,this.oldTime=tr,this.elapsedTime+=er}return er}}function now$1(){return performance.now()}const _position$1=new Vector3$1,_quaternion$1$1=new Quaternion$1,_scale$1$1=new Vector3$1,_orientation$1=new Vector3$1;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(er){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=er,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(er){return this.gain.gain.setTargetAtTime(er,this.context.currentTime,.01),this}updateMatrixWorld(er){super.updateMatrixWorld(er);const tr=this.context.listener,rr=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1$1,_scale$1$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1$1),tr.positionX){const nr=this.context.currentTime+this.timeDelta;tr.positionX.linearRampToValueAtTime(_position$1.x,nr),tr.positionY.linearRampToValueAtTime(_position$1.y,nr),tr.positionZ.linearRampToValueAtTime(_position$1.z,nr),tr.forwardX.linearRampToValueAtTime(_orientation$1.x,nr),tr.forwardY.linearRampToValueAtTime(_orientation$1.y,nr),tr.forwardZ.linearRampToValueAtTime(_orientation$1.z,nr),tr.upX.linearRampToValueAtTime(rr.x,nr),tr.upY.linearRampToValueAtTime(rr.y,nr),tr.upZ.linearRampToValueAtTime(rr.z,nr)}else tr.setPosition(_position$1.x,_position$1.y,_position$1.z),tr.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,rr.x,rr.y,rr.z)}}class Audio extends Object3D{constructor(er){super(),this.type="Audio",this.listener=er,this.context=er.context,this.gain=this.context.createGain(),this.gain.connect(er.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(er){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=er,this.connect(),this}setMediaElementSource(er){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(er),this.connect(),this}setMediaStreamSource(er){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(er),this.connect(),this}setBuffer(er){return this.buffer=er,this.sourceType="buffer",this.autoplay&&this.play(),this}play(er=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+er;const tr=this.context.createBufferSource();return tr.buffer=this.buffer,tr.loop=this.loop,tr.loopStart=this.loopStart,tr.loopEnd=this.loopEnd,tr.onended=this.onEnded.bind(this),tr.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=tr,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(er=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+er),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let er=1,tr=this.filters.length;er<tr;er++)this.filters[er-1].connect(this.filters[er]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let er=1,tr=this.filters.length;er<tr;er++)this.filters[er-1].disconnect(this.filters[er]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(er){return er||(er=[]),this._connected===!0?(this.disconnect(),this.filters=er.slice(),this.connect()):this.filters=er.slice(),this}setDetune(er){return this.detune=er,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(er){return this.setFilters(er?[er]:[])}setPlaybackRate(er){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=er,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(er){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=er,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(er){return this.loopStart=er,this}setLoopEnd(er){return this.loopEnd=er,this}getVolume(){return this.gain.gain.value}setVolume(er){return this.gain.gain.setTargetAtTime(er,this.context.currentTime,.01),this}copy(er,tr){return super.copy(er,tr),er.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=er.autoplay,this.buffer=er.buffer,this.detune=er.detune,this.loop=er.loop,this.loopStart=er.loopStart,this.loopEnd=er.loopEnd,this.offset=er.offset,this.duration=er.duration,this.playbackRate=er.playbackRate,this.hasPlaybackControl=er.hasPlaybackControl,this.sourceType=er.sourceType,this.filters=er.filters.slice(),this)}clone(er){return new this.constructor(this.listener).copy(this,er)}}const _position$4=new Vector3$1,_quaternion$5=new Quaternion$1,_scale$3=new Vector3$1,_orientation=new Vector3$1;class PositionalAudio extends Audio{constructor(er){super(er),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(er){return this.panner.refDistance=er,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(er){return this.panner.rolloffFactor=er,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(er){return this.panner.distanceModel=er,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(er){return this.panner.maxDistance=er,this}setDirectionalCone(er,tr,rr){return this.panner.coneInnerAngle=er,this.panner.coneOuterAngle=tr,this.panner.coneOuterGain=rr,this}updateMatrixWorld(er){if(super.updateMatrixWorld(er),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position$4,_quaternion$5,_scale$3),_orientation.set(0,0,1).applyQuaternion(_quaternion$5);const tr=this.panner;if(tr.positionX){const rr=this.context.currentTime+this.listener.timeDelta;tr.positionX.linearRampToValueAtTime(_position$4.x,rr),tr.positionY.linearRampToValueAtTime(_position$4.y,rr),tr.positionZ.linearRampToValueAtTime(_position$4.z,rr),tr.orientationX.linearRampToValueAtTime(_orientation.x,rr),tr.orientationY.linearRampToValueAtTime(_orientation.y,rr),tr.orientationZ.linearRampToValueAtTime(_orientation.z,rr)}else tr.setPosition(_position$4.x,_position$4.y,_position$4.z),tr.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(er,tr=2048){this.analyser=er.context.createAnalyser(),this.analyser.fftSize=tr,this.data=new Uint8Array(this.analyser.frequencyBinCount),er.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let er=0;const tr=this.getFrequencyData();for(let rr=0;rr<tr.length;rr++)er+=tr[rr];return er/tr.length}}class PropertyMixer{constructor(er,tr,rr){this.binding=er,this.valueSize=rr;let nr,sr,ar;switch(tr){case"quaternion":nr=this._slerp,sr=this._slerpAdditive,ar=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(rr*6),this._workIndex=5;break;case"string":case"bool":nr=this._select,sr=this._select,ar=this._setAdditiveIdentityOther,this.buffer=new Array(rr*5);break;default:nr=this._lerp,sr=this._lerpAdditive,ar=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(rr*5)}this._mixBufferRegion=nr,this._mixBufferRegionAdditive=sr,this._setIdentity=ar,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(er,tr){const rr=this.buffer,nr=this.valueSize,sr=er*nr+nr;let ar=this.cumulativeWeight;if(ar===0){for(let or=0;or!==nr;++or)rr[sr+or]=rr[or];ar=tr}else{ar+=tr;const or=tr/ar;this._mixBufferRegion(rr,sr,0,or,nr)}this.cumulativeWeight=ar}accumulateAdditive(er){const tr=this.buffer,rr=this.valueSize,nr=rr*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(tr,nr,0,er,rr),this.cumulativeWeightAdditive+=er}apply(er){const tr=this.valueSize,rr=this.buffer,nr=er*tr+tr,sr=this.cumulativeWeight,ar=this.cumulativeWeightAdditive,or=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,sr<1){const lr=tr*this._origIndex;this._mixBufferRegion(rr,nr,lr,1-sr,tr)}ar>0&&this._mixBufferRegionAdditive(rr,nr,this._addIndex*tr,1,tr);for(let lr=tr,cr=tr+tr;lr!==cr;++lr)if(rr[lr]!==rr[lr+tr]){or.setValue(rr,nr);break}}saveOriginalState(){const er=this.binding,tr=this.buffer,rr=this.valueSize,nr=rr*this._origIndex;er.getValue(tr,nr);for(let sr=rr,ar=nr;sr!==ar;++sr)tr[sr]=tr[nr+sr%rr];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const er=this.valueSize*3;this.binding.setValue(this.buffer,er)}_setAdditiveIdentityNumeric(){const er=this._addIndex*this.valueSize,tr=er+this.valueSize;for(let rr=er;rr<tr;rr++)this.buffer[rr]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const er=this._origIndex*this.valueSize,tr=this._addIndex*this.valueSize;for(let rr=0;rr<this.valueSize;rr++)this.buffer[tr+rr]=this.buffer[er+rr]}_select(er,tr,rr,nr,sr){if(nr>=.5)for(let ar=0;ar!==sr;++ar)er[tr+ar]=er[rr+ar]}_slerp(er,tr,rr,nr){Quaternion$1.slerpFlat(er,tr,er,tr,er,rr,nr)}_slerpAdditive(er,tr,rr,nr,sr){const ar=this._workIndex*sr;Quaternion$1.multiplyQuaternionsFlat(er,ar,er,tr,er,rr),Quaternion$1.slerpFlat(er,tr,er,tr,er,ar,nr)}_lerp(er,tr,rr,nr,sr){const ar=1-nr;for(let or=0;or!==sr;++or){const lr=tr+or;er[lr]=er[lr]*ar+er[rr+or]*nr}}_lerpAdditive(er,tr,rr,nr,sr){for(let ar=0;ar!==sr;++ar){const or=tr+ar;er[or]=er[or]+er[rr+ar]*nr}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(er,tr,rr){const nr=rr||PropertyBinding.parseTrackName(tr);this._targetGroup=er,this._bindings=er.subscribe_(tr,nr)}getValue(er,tr){this.bind();const rr=this._targetGroup.nCachedObjects_,nr=this._bindings[rr];nr!==void 0&&nr.getValue(er,tr)}setValue(er,tr){const rr=this._bindings;for(let nr=this._targetGroup.nCachedObjects_,sr=rr.length;nr!==sr;++nr)rr[nr].setValue(er,tr)}bind(){const er=this._bindings;for(let tr=this._targetGroup.nCachedObjects_,rr=er.length;tr!==rr;++tr)er[tr].bind()}unbind(){const er=this._bindings;for(let tr=this._targetGroup.nCachedObjects_,rr=er.length;tr!==rr;++tr)er[tr].unbind()}}class PropertyBinding{constructor(er,tr,rr){this.path=tr,this.parsedPath=rr||PropertyBinding.parseTrackName(tr),this.node=PropertyBinding.findNode(er,this.parsedPath.nodeName),this.rootNode=er,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(er,tr,rr){return er&&er.isAnimationObjectGroup?new PropertyBinding.Composite(er,tr,rr):new PropertyBinding(er,tr,rr)}static sanitizeNodeName(er){return er.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(er){const tr=_trackRe.exec(er);if(tr===null)throw new Error("PropertyBinding: Cannot parse trackName: "+er);const rr={nodeName:tr[2],objectName:tr[3],objectIndex:tr[4],propertyName:tr[5],propertyIndex:tr[6]},nr=rr.nodeName&&rr.nodeName.lastIndexOf(".");if(nr!==void 0&&nr!==-1){const sr=rr.nodeName.substring(nr+1);_supportedObjectNames.indexOf(sr)!==-1&&(rr.nodeName=rr.nodeName.substring(0,nr),rr.objectName=sr)}if(rr.propertyName===null||rr.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+er);return rr}static findNode(er,tr){if(tr===void 0||tr===""||tr==="."||tr===-1||tr===er.name||tr===er.uuid)return er;if(er.skeleton){const rr=er.skeleton.getBoneByName(tr);if(rr!==void 0)return rr}if(er.children){const rr=function(sr){for(let ar=0;ar<sr.length;ar++){const or=sr[ar];if(or.name===tr||or.uuid===tr)return or;const lr=rr(or.children);if(lr)return lr}return null},nr=rr(er.children);if(nr)return nr}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(er,tr){er[tr]=this.targetObject[this.propertyName]}_getValue_array(er,tr){const rr=this.resolvedProperty;for(let nr=0,sr=rr.length;nr!==sr;++nr)er[tr++]=rr[nr]}_getValue_arrayElement(er,tr){er[tr]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(er,tr){this.resolvedProperty.toArray(er,tr)}_setValue_direct(er,tr){this.targetObject[this.propertyName]=er[tr]}_setValue_direct_setNeedsUpdate(er,tr){this.targetObject[this.propertyName]=er[tr],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(er,tr){this.targetObject[this.propertyName]=er[tr],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(er,tr){const rr=this.resolvedProperty;for(let nr=0,sr=rr.length;nr!==sr;++nr)rr[nr]=er[tr++]}_setValue_array_setNeedsUpdate(er,tr){const rr=this.resolvedProperty;for(let nr=0,sr=rr.length;nr!==sr;++nr)rr[nr]=er[tr++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(er,tr){const rr=this.resolvedProperty;for(let nr=0,sr=rr.length;nr!==sr;++nr)rr[nr]=er[tr++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(er,tr){this.resolvedProperty[this.propertyIndex]=er[tr]}_setValue_arrayElement_setNeedsUpdate(er,tr){this.resolvedProperty[this.propertyIndex]=er[tr],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(er,tr){this.resolvedProperty[this.propertyIndex]=er[tr],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(er,tr){this.resolvedProperty.fromArray(er,tr)}_setValue_fromArray_setNeedsUpdate(er,tr){this.resolvedProperty.fromArray(er,tr),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(er,tr){this.resolvedProperty.fromArray(er,tr),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(er,tr){this.bind(),this.getValue(er,tr)}_setValue_unbound(er,tr){this.bind(),this.setValue(er,tr)}bind(){let er=this.node;const tr=this.parsedPath,rr=tr.objectName,nr=tr.propertyName;let sr=tr.propertyIndex;if(er||(er=PropertyBinding.findNode(this.rootNode,tr.nodeName),this.node=er),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!er){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(rr){let cr=tr.objectIndex;switch(rr){case"materials":if(!er.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!er.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}er=er.material.materials;break;case"bones":if(!er.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}er=er.skeleton.bones;for(let hr=0;hr<er.length;hr++)if(er[hr].name===cr){cr=hr;break}break;case"map":if("map"in er){er=er.map;break}if(!er.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!er.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}er=er.material.map;break;default:if(er[rr]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}er=er[rr]}if(cr!==void 0){if(er[cr]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,er);return}er=er[cr]}}const ar=er[nr];if(ar===void 0){const cr=tr.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+cr+"."+nr+" but it wasn't found.",er);return}let or=this.Versioning.None;this.targetObject=er,er.isMaterial===!0?or=this.Versioning.NeedsUpdate:er.isObject3D===!0&&(or=this.Versioning.MatrixWorldNeedsUpdate);let lr=this.BindingType.Direct;if(sr!==void 0){if(nr==="morphTargetInfluences"){if(!er.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!er.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}er.morphTargetDictionary[sr]!==void 0&&(sr=er.morphTargetDictionary[sr])}lr=this.BindingType.ArrayElement,this.resolvedProperty=ar,this.propertyIndex=sr}else ar.fromArray!==void 0&&ar.toArray!==void 0?(lr=this.BindingType.HasFromToArray,this.resolvedProperty=ar):Array.isArray(ar)?(lr=this.BindingType.EntireArray,this.resolvedProperty=ar):this.propertyName=nr;this.getValue=this.GetterByBindingType[lr],this.setValue=this.SetterByBindingTypeAndVersioning[lr][or]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const er={};this._indicesByUUID=er;for(let rr=0,nr=arguments.length;rr!==nr;++rr)er[arguments[rr].uuid]=rr;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const tr=this;this.stats={objects:{get total(){return tr._objects.length},get inUse(){return this.total-tr.nCachedObjects_}},get bindingsPerObject(){return tr._bindings.length}}}add(){const er=this._objects,tr=this._indicesByUUID,rr=this._paths,nr=this._parsedPaths,sr=this._bindings,ar=sr.length;let or,lr=er.length,cr=this.nCachedObjects_;for(let hr=0,fr=arguments.length;hr!==fr;++hr){const ur=arguments[hr],pr=ur.uuid;let gr=tr[pr];if(gr===void 0){gr=lr++,tr[pr]=gr,er.push(ur);for(let _r=0,mr=ar;_r!==mr;++_r)sr[_r].push(new PropertyBinding(ur,rr[_r],nr[_r]))}else if(gr<cr){or=er[gr];const _r=--cr,mr=er[_r];tr[mr.uuid]=gr,er[gr]=mr,tr[pr]=_r,er[_r]=ur;for(let dr=0,vr=ar;dr!==vr;++dr){const Ar=sr[dr],yr=Ar[_r];let wr=Ar[gr];Ar[gr]=yr,wr===void 0&&(wr=new PropertyBinding(ur,rr[dr],nr[dr])),Ar[_r]=wr}}else er[gr]!==or&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=cr}remove(){const er=this._objects,tr=this._indicesByUUID,rr=this._bindings,nr=rr.length;let sr=this.nCachedObjects_;for(let ar=0,or=arguments.length;ar!==or;++ar){const lr=arguments[ar],cr=lr.uuid,hr=tr[cr];if(hr!==void 0&&hr>=sr){const fr=sr++,ur=er[fr];tr[ur.uuid]=hr,er[hr]=ur,tr[cr]=fr,er[fr]=lr;for(let pr=0,gr=nr;pr!==gr;++pr){const _r=rr[pr],mr=_r[fr],dr=_r[hr];_r[hr]=mr,_r[fr]=dr}}}this.nCachedObjects_=sr}uncache(){const er=this._objects,tr=this._indicesByUUID,rr=this._bindings,nr=rr.length;let sr=this.nCachedObjects_,ar=er.length;for(let or=0,lr=arguments.length;or!==lr;++or){const cr=arguments[or],hr=cr.uuid,fr=tr[hr];if(fr!==void 0)if(delete tr[hr],fr<sr){const ur=--sr,pr=er[ur],gr=--ar,_r=er[gr];tr[pr.uuid]=fr,er[fr]=pr,tr[_r.uuid]=ur,er[ur]=_r,er.pop();for(let mr=0,dr=nr;mr!==dr;++mr){const vr=rr[mr],Ar=vr[ur],yr=vr[gr];vr[fr]=Ar,vr[ur]=yr,vr.pop()}}else{const ur=--ar,pr=er[ur];ur>0&&(tr[pr.uuid]=fr),er[fr]=pr,er.pop();for(let gr=0,_r=nr;gr!==_r;++gr){const mr=rr[gr];mr[fr]=mr[ur],mr.pop()}}}this.nCachedObjects_=sr}subscribe_(er,tr){const rr=this._bindingsIndicesByPath;let nr=rr[er];const sr=this._bindings;if(nr!==void 0)return sr[nr];const ar=this._paths,or=this._parsedPaths,lr=this._objects,cr=lr.length,hr=this.nCachedObjects_,fr=new Array(cr);nr=sr.length,rr[er]=nr,ar.push(er),or.push(tr),sr.push(fr);for(let ur=hr,pr=lr.length;ur!==pr;++ur){const gr=lr[ur];fr[ur]=new PropertyBinding(gr,er,tr)}return fr}unsubscribe_(er){const tr=this._bindingsIndicesByPath,rr=tr[er];if(rr!==void 0){const nr=this._paths,sr=this._parsedPaths,ar=this._bindings,or=ar.length-1,lr=ar[or],cr=er[or];tr[cr]=rr,ar[rr]=lr,ar.pop(),sr[rr]=sr[or],sr.pop(),nr[rr]=nr[or],nr.pop()}}}class AnimationAction{constructor(er,tr,rr=null,nr=tr.blendMode){this._mixer=er,this._clip=tr,this._localRoot=rr,this.blendMode=nr;const sr=tr.tracks,ar=sr.length,or=new Array(ar),lr={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let cr=0;cr!==ar;++cr){const hr=sr[cr].createInterpolant(null);or[cr]=hr,hr.settings=lr}this._interpolantSettings=lr,this._interpolants=or,this._propertyBindings=new Array(ar),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(er){return this._startTime=er,this}setLoop(er,tr){return this.loop=er,this.repetitions=tr,this}setEffectiveWeight(er){return this.weight=er,this._effectiveWeight=this.enabled?er:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(er){return this._scheduleFading(er,0,1)}fadeOut(er){return this._scheduleFading(er,1,0)}crossFadeFrom(er,tr,rr){if(er.fadeOut(tr),this.fadeIn(tr),rr){const nr=this._clip.duration,sr=er._clip.duration,ar=sr/nr,or=nr/sr;er.warp(1,ar,tr),this.warp(or,1,tr)}return this}crossFadeTo(er,tr,rr){return er.crossFadeFrom(this,tr,rr)}stopFading(){const er=this._weightInterpolant;return er!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(er)),this}setEffectiveTimeScale(er){return this.timeScale=er,this._effectiveTimeScale=this.paused?0:er,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(er){return this.timeScale=this._clip.duration/er,this.stopWarping()}syncWith(er){return this.time=er.time,this.timeScale=er.timeScale,this.stopWarping()}halt(er){return this.warp(this._effectiveTimeScale,0,er)}warp(er,tr,rr){const nr=this._mixer,sr=nr.time,ar=this.timeScale;let or=this._timeScaleInterpolant;or===null&&(or=nr._lendControlInterpolant(),this._timeScaleInterpolant=or);const lr=or.parameterPositions,cr=or.sampleValues;return lr[0]=sr,lr[1]=sr+rr,cr[0]=er/ar,cr[1]=tr/ar,this}stopWarping(){const er=this._timeScaleInterpolant;return er!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(er)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(er,tr,rr,nr){if(!this.enabled){this._updateWeight(er);return}const sr=this._startTime;if(sr!==null){const lr=(er-sr)*rr;lr<0||rr===0?tr=0:(this._startTime=null,tr=rr*lr)}tr*=this._updateTimeScale(er);const ar=this._updateTime(tr),or=this._updateWeight(er);if(or>0){const lr=this._interpolants,cr=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let hr=0,fr=lr.length;hr!==fr;++hr)lr[hr].evaluate(ar),cr[hr].accumulateAdditive(or);break;case NormalAnimationBlendMode:default:for(let hr=0,fr=lr.length;hr!==fr;++hr)lr[hr].evaluate(ar),cr[hr].accumulate(nr,or)}}}_updateWeight(er){let tr=0;if(this.enabled){tr=this.weight;const rr=this._weightInterpolant;if(rr!==null){const nr=rr.evaluate(er)[0];tr*=nr,er>rr.parameterPositions[1]&&(this.stopFading(),nr===0&&(this.enabled=!1))}}return this._effectiveWeight=tr,tr}_updateTimeScale(er){let tr=0;if(!this.paused){tr=this.timeScale;const rr=this._timeScaleInterpolant;if(rr!==null){const nr=rr.evaluate(er)[0];tr*=nr,er>rr.parameterPositions[1]&&(this.stopWarping(),tr===0?this.paused=!0:this.timeScale=tr)}}return this._effectiveTimeScale=tr,tr}_updateTime(er){const tr=this._clip.duration,rr=this.loop;let nr=this.time+er,sr=this._loopCount;const ar=rr===LoopPingPong;if(er===0)return sr===-1?nr:ar&&(sr&1)===1?tr-nr:nr;if(rr===LoopOnce){sr===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(nr>=tr)nr=tr;else if(nr<0)nr=0;else{this.time=nr;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=nr,this._mixer.dispatchEvent({type:"finished",action:this,direction:er<0?-1:1})}}else{if(sr===-1&&(er>=0?(sr=0,this._setEndings(!0,this.repetitions===0,ar)):this._setEndings(this.repetitions===0,!0,ar)),nr>=tr||nr<0){const or=Math.floor(nr/tr);nr-=tr*or,sr+=Math.abs(or);const lr=this.repetitions-sr;if(lr<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,nr=er>0?tr:0,this.time=nr,this._mixer.dispatchEvent({type:"finished",action:this,direction:er>0?1:-1});else{if(lr===1){const cr=er<0;this._setEndings(cr,!cr,ar)}else this._setEndings(!1,!1,ar);this._loopCount=sr,this.time=nr,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:or})}}else this.time=nr;if(ar&&(sr&1)===1)return tr-nr}return nr}_setEndings(er,tr,rr){const nr=this._interpolantSettings;rr?(nr.endingStart=ZeroSlopeEnding,nr.endingEnd=ZeroSlopeEnding):(er?nr.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:nr.endingStart=WrapAroundEnding,tr?nr.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:nr.endingEnd=WrapAroundEnding)}_scheduleFading(er,tr,rr){const nr=this._mixer,sr=nr.time;let ar=this._weightInterpolant;ar===null&&(ar=nr._lendControlInterpolant(),this._weightInterpolant=ar);const or=ar.parameterPositions,lr=ar.sampleValues;return or[0]=sr,lr[0]=tr,or[1]=sr+er,lr[1]=rr,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher{constructor(er){super(),this._root=er,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(er,tr){const rr=er._localRoot||this._root,nr=er._clip.tracks,sr=nr.length,ar=er._propertyBindings,or=er._interpolants,lr=rr.uuid,cr=this._bindingsByRootAndName;let hr=cr[lr];hr===void 0&&(hr={},cr[lr]=hr);for(let fr=0;fr!==sr;++fr){const ur=nr[fr],pr=ur.name;let gr=hr[pr];if(gr!==void 0)++gr.referenceCount,ar[fr]=gr;else{if(gr=ar[fr],gr!==void 0){gr._cacheIndex===null&&(++gr.referenceCount,this._addInactiveBinding(gr,lr,pr));continue}const _r=tr&&tr._propertyBindings[fr].binding.parsedPath;gr=new PropertyMixer(PropertyBinding.create(rr,pr,_r),ur.ValueTypeName,ur.getValueSize()),++gr.referenceCount,this._addInactiveBinding(gr,lr,pr),ar[fr]=gr}or[fr].resultBuffer=gr.buffer}}_activateAction(er){if(!this._isActiveAction(er)){if(er._cacheIndex===null){const rr=(er._localRoot||this._root).uuid,nr=er._clip.uuid,sr=this._actionsByClip[nr];this._bindAction(er,sr&&sr.knownActions[0]),this._addInactiveAction(er,nr,rr)}const tr=er._propertyBindings;for(let rr=0,nr=tr.length;rr!==nr;++rr){const sr=tr[rr];sr.useCount++===0&&(this._lendBinding(sr),sr.saveOriginalState())}this._lendAction(er)}}_deactivateAction(er){if(this._isActiveAction(er)){const tr=er._propertyBindings;for(let rr=0,nr=tr.length;rr!==nr;++rr){const sr=tr[rr];--sr.useCount===0&&(sr.restoreOriginalState(),this._takeBackBinding(sr))}this._takeBackAction(er)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const er=this;this.stats={actions:{get total(){return er._actions.length},get inUse(){return er._nActiveActions}},bindings:{get total(){return er._bindings.length},get inUse(){return er._nActiveBindings}},controlInterpolants:{get total(){return er._controlInterpolants.length},get inUse(){return er._nActiveControlInterpolants}}}}_isActiveAction(er){const tr=er._cacheIndex;return tr!==null&&tr<this._nActiveActions}_addInactiveAction(er,tr,rr){const nr=this._actions,sr=this._actionsByClip;let ar=sr[tr];if(ar===void 0)ar={knownActions:[er],actionByRoot:{}},er._byClipCacheIndex=0,sr[tr]=ar;else{const or=ar.knownActions;er._byClipCacheIndex=or.length,or.push(er)}er._cacheIndex=nr.length,nr.push(er),ar.actionByRoot[rr]=er}_removeInactiveAction(er){const tr=this._actions,rr=tr[tr.length-1],nr=er._cacheIndex;rr._cacheIndex=nr,tr[nr]=rr,tr.pop(),er._cacheIndex=null;const sr=er._clip.uuid,ar=this._actionsByClip,or=ar[sr],lr=or.knownActions,cr=lr[lr.length-1],hr=er._byClipCacheIndex;cr._byClipCacheIndex=hr,lr[hr]=cr,lr.pop(),er._byClipCacheIndex=null;const fr=or.actionByRoot,ur=(er._localRoot||this._root).uuid;delete fr[ur],lr.length===0&&delete ar[sr],this._removeInactiveBindingsForAction(er)}_removeInactiveBindingsForAction(er){const tr=er._propertyBindings;for(let rr=0,nr=tr.length;rr!==nr;++rr){const sr=tr[rr];--sr.referenceCount===0&&this._removeInactiveBinding(sr)}}_lendAction(er){const tr=this._actions,rr=er._cacheIndex,nr=this._nActiveActions++,sr=tr[nr];er._cacheIndex=nr,tr[nr]=er,sr._cacheIndex=rr,tr[rr]=sr}_takeBackAction(er){const tr=this._actions,rr=er._cacheIndex,nr=--this._nActiveActions,sr=tr[nr];er._cacheIndex=nr,tr[nr]=er,sr._cacheIndex=rr,tr[rr]=sr}_addInactiveBinding(er,tr,rr){const nr=this._bindingsByRootAndName,sr=this._bindings;let ar=nr[tr];ar===void 0&&(ar={},nr[tr]=ar),ar[rr]=er,er._cacheIndex=sr.length,sr.push(er)}_removeInactiveBinding(er){const tr=this._bindings,rr=er.binding,nr=rr.rootNode.uuid,sr=rr.path,ar=this._bindingsByRootAndName,or=ar[nr],lr=tr[tr.length-1],cr=er._cacheIndex;lr._cacheIndex=cr,tr[cr]=lr,tr.pop(),delete or[sr],Object.keys(or).length===0&&delete ar[nr]}_lendBinding(er){const tr=this._bindings,rr=er._cacheIndex,nr=this._nActiveBindings++,sr=tr[nr];er._cacheIndex=nr,tr[nr]=er,sr._cacheIndex=rr,tr[rr]=sr}_takeBackBinding(er){const tr=this._bindings,rr=er._cacheIndex,nr=--this._nActiveBindings,sr=tr[nr];er._cacheIndex=nr,tr[nr]=er,sr._cacheIndex=rr,tr[rr]=sr}_lendControlInterpolant(){const er=this._controlInterpolants,tr=this._nActiveControlInterpolants++;let rr=er[tr];return rr===void 0&&(rr=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),rr.__cacheIndex=tr,er[tr]=rr),rr}_takeBackControlInterpolant(er){const tr=this._controlInterpolants,rr=er.__cacheIndex,nr=--this._nActiveControlInterpolants,sr=tr[nr];er.__cacheIndex=nr,tr[nr]=er,sr.__cacheIndex=rr,tr[rr]=sr}clipAction(er,tr,rr){const nr=tr||this._root,sr=nr.uuid;let ar=typeof er=="string"?AnimationClip.findByName(nr,er):er;const or=ar!==null?ar.uuid:er,lr=this._actionsByClip[or];let cr=null;if(rr===void 0&&(ar!==null?rr=ar.blendMode:rr=NormalAnimationBlendMode),lr!==void 0){const fr=lr.actionByRoot[sr];if(fr!==void 0&&fr.blendMode===rr)return fr;cr=lr.knownActions[0],ar===null&&(ar=cr._clip)}if(ar===null)return null;const hr=new AnimationAction(this,ar,tr,rr);return this._bindAction(hr,cr),this._addInactiveAction(hr,or,sr),hr}existingAction(er,tr){const rr=tr||this._root,nr=rr.uuid,sr=typeof er=="string"?AnimationClip.findByName(rr,er):er,ar=sr?sr.uuid:er,or=this._actionsByClip[ar];return or!==void 0&&or.actionByRoot[nr]||null}stopAllAction(){const er=this._actions,tr=this._nActiveActions;for(let rr=tr-1;rr>=0;--rr)er[rr].stop();return this}update(er){er*=this.timeScale;const tr=this._actions,rr=this._nActiveActions,nr=this.time+=er,sr=Math.sign(er),ar=this._accuIndex^=1;for(let cr=0;cr!==rr;++cr)tr[cr]._update(nr,er,sr,ar);const or=this._bindings,lr=this._nActiveBindings;for(let cr=0;cr!==lr;++cr)or[cr].apply(ar);return this}setTime(er){this.time=0;for(let tr=0;tr<this._actions.length;tr++)this._actions[tr].time=0;return this.update(er)}getRoot(){return this._root}uncacheClip(er){const tr=this._actions,rr=er.uuid,nr=this._actionsByClip,sr=nr[rr];if(sr!==void 0){const ar=sr.knownActions;for(let or=0,lr=ar.length;or!==lr;++or){const cr=ar[or];this._deactivateAction(cr);const hr=cr._cacheIndex,fr=tr[tr.length-1];cr._cacheIndex=null,cr._byClipCacheIndex=null,fr._cacheIndex=hr,tr[hr]=fr,tr.pop(),this._removeInactiveBindingsForAction(cr)}delete nr[rr]}}uncacheRoot(er){const tr=er.uuid,rr=this._actionsByClip;for(const ar in rr){const or=rr[ar].actionByRoot,lr=or[tr];lr!==void 0&&(this._deactivateAction(lr),this._removeInactiveAction(lr))}const nr=this._bindingsByRootAndName,sr=nr[tr];if(sr!==void 0)for(const ar in sr){const or=sr[ar];or.restoreOriginalState(),this._removeInactiveBinding(or)}}uncacheAction(er,tr){const rr=this.existingAction(er,tr);rr!==null&&(this._deactivateAction(rr),this._removeInactiveAction(rr))}}class RenderTarget3D extends RenderTarget{constructor(er=1,tr=1,rr=1,nr={}){super(er,tr,nr),this.isRenderTarget3D=!0,this.depth=rr,this.texture=new Data3DTexture(null,er,tr,rr),this.texture.isRenderTargetTexture=!0}}class RenderTargetArray extends RenderTarget{constructor(er=1,tr=1,rr=1,nr={}){super(er,tr,nr),this.isRenderTargetArray=!0,this.depth=rr,this.texture=new DataArrayTexture(null,er,tr,rr),this.texture.isRenderTargetTexture=!0}}class Uniform{constructor(er){this.value=er}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let _id$3=0;class UniformsGroup extends EventDispatcher{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id$3++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(er){return this.uniforms.push(er),this}remove(er){const tr=this.uniforms.indexOf(er);return tr!==-1&&this.uniforms.splice(tr,1),this}setName(er){return this.name=er,this}setUsage(er){return this.usage=er,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(er){this.name=er.name,this.usage=er.usage;const tr=er.uniforms;this.uniforms.length=0;for(let rr=0,nr=tr.length;rr<nr;rr++){const sr=Array.isArray(tr[rr])?tr[rr]:[tr[rr]];for(let ar=0;ar<sr.length;ar++)this.uniforms.push(sr[ar].clone())}return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(er,tr,rr=1){super(er,tr),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=rr}copy(er){return super.copy(er),this.meshPerAttribute=er.meshPerAttribute,this}clone(er){const tr=super.clone(er);return tr.meshPerAttribute=this.meshPerAttribute,tr}toJSON(er){const tr=super.toJSON(er);return tr.isInstancedInterleavedBuffer=!0,tr.meshPerAttribute=this.meshPerAttribute,tr}}class GLBufferAttribute{constructor(er,tr,rr,nr,sr){this.isGLBufferAttribute=!0,this.name="",this.buffer=er,this.type=tr,this.itemSize=rr,this.elementSize=nr,this.count=sr,this.version=0}set needsUpdate(er){er===!0&&this.version++}setBuffer(er){return this.buffer=er,this}setType(er,tr){return this.type=er,this.elementSize=tr,this}setItemSize(er){return this.itemSize=er,this}setCount(er){return this.count=er,this}}const _matrix$5=new Matrix4;class Raycaster{constructor(er,tr,rr=0,nr=1/0){this.ray=new Ray$1(er,tr),this.near=rr,this.far=nr,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(er,tr){this.ray.set(er,tr)}setFromCamera(er,tr){tr.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(tr.matrixWorld),this.ray.direction.set(er.x,er.y,.5).unproject(tr).sub(this.ray.origin).normalize(),this.camera=tr):tr.isOrthographicCamera?(this.ray.origin.set(er.x,er.y,(tr.near+tr.far)/(tr.near-tr.far)).unproject(tr),this.ray.direction.set(0,0,-1).transformDirection(tr.matrixWorld),this.camera=tr):console.error("THREE.Raycaster: Unsupported camera type: "+tr.type)}setFromXRController(er){return _matrix$5.identity().extractRotation(er.matrixWorld),this.ray.origin.setFromMatrixPosition(er.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_matrix$5),this}intersectObject(er,tr=!0,rr=[]){return intersect(er,this,rr,tr),rr.sort(ascSort),rr}intersectObjects(er,tr=!0,rr=[]){for(let nr=0,sr=er.length;nr<sr;nr++)intersect(er[nr],this,rr,tr);return rr.sort(ascSort),rr}}function ascSort(ir,er){return ir.distance-er.distance}function intersect(ir,er,tr,rr){let nr=!0;if(ir.layers.test(er.layers)&&ir.raycast(er,tr)===!1&&(nr=!1),nr===!0&&rr===!0){const sr=ir.children;for(let ar=0,or=sr.length;ar<or;ar++)intersect(sr[ar],er,tr,!0)}}class Spherical{constructor(er=1,tr=0,rr=0){return this.radius=er,this.phi=tr,this.theta=rr,this}set(er,tr,rr){return this.radius=er,this.phi=tr,this.theta=rr,this}copy(er){return this.radius=er.radius,this.phi=er.phi,this.theta=er.theta,this}makeSafe(){return this.phi=clamp(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(er){return this.setFromCartesianCoords(er.x,er.y,er.z)}setFromCartesianCoords(er,tr,rr){return this.radius=Math.sqrt(er*er+tr*tr+rr*rr),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(er,rr),this.phi=Math.acos(clamp(tr/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(er=1,tr=0,rr=0){return this.radius=er,this.theta=tr,this.y=rr,this}set(er,tr,rr){return this.radius=er,this.theta=tr,this.y=rr,this}copy(er){return this.radius=er.radius,this.theta=er.theta,this.y=er.y,this}setFromVector3(er){return this.setFromCartesianCoords(er.x,er.y,er.z)}setFromCartesianCoords(er,tr,rr){return this.radius=Math.sqrt(er*er+rr*rr),this.theta=Math.atan2(er,rr),this.y=tr,this}clone(){return new this.constructor().copy(this)}}class Matrix2{constructor(er,tr,rr,nr){Matrix2.prototype.isMatrix2=!0,this.elements=[1,0,0,1],er!==void 0&&this.set(er,tr,rr,nr)}identity(){return this.set(1,0,0,1),this}fromArray(er,tr=0){for(let rr=0;rr<4;rr++)this.elements[rr]=er[rr+tr];return this}set(er,tr,rr,nr){const sr=this.elements;return sr[0]=er,sr[2]=tr,sr[1]=rr,sr[3]=nr,this}}const _vector$4$1=new Vector2;class Box2{constructor(er=new Vector2(1/0,1/0),tr=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=er,this.max=tr}set(er,tr){return this.min.copy(er),this.max.copy(tr),this}setFromPoints(er){this.makeEmpty();for(let tr=0,rr=er.length;tr<rr;tr++)this.expandByPoint(er[tr]);return this}setFromCenterAndSize(er,tr){const rr=_vector$4$1.copy(tr).multiplyScalar(.5);return this.min.copy(er).sub(rr),this.max.copy(er).add(rr),this}clone(){return new this.constructor().copy(this)}copy(er){return this.min.copy(er.min),this.max.copy(er.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(er){return this.isEmpty()?er.set(0,0):er.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(er){return this.isEmpty()?er.set(0,0):er.subVectors(this.max,this.min)}expandByPoint(er){return this.min.min(er),this.max.max(er),this}expandByVector(er){return this.min.sub(er),this.max.add(er),this}expandByScalar(er){return this.min.addScalar(-er),this.max.addScalar(er),this}containsPoint(er){return er.x>=this.min.x&&er.x<=this.max.x&&er.y>=this.min.y&&er.y<=this.max.y}containsBox(er){return this.min.x<=er.min.x&&er.max.x<=this.max.x&&this.min.y<=er.min.y&&er.max.y<=this.max.y}getParameter(er,tr){return tr.set((er.x-this.min.x)/(this.max.x-this.min.x),(er.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(er){return er.max.x>=this.min.x&&er.min.x<=this.max.x&&er.max.y>=this.min.y&&er.min.y<=this.max.y}clampPoint(er,tr){return tr.copy(er).clamp(this.min,this.max)}distanceToPoint(er){return this.clampPoint(er,_vector$4$1).distanceTo(er)}intersect(er){return this.min.max(er.min),this.max.min(er.max),this.isEmpty()&&this.makeEmpty(),this}union(er){return this.min.min(er.min),this.max.max(er.max),this}translate(er){return this.min.add(er),this.max.add(er),this}equals(er){return er.min.equals(this.min)&&er.max.equals(this.max)}}const _startP=new Vector3$1,_startEnd=new Vector3$1;class Line3{constructor(er=new Vector3$1,tr=new Vector3$1){this.start=er,this.end=tr}set(er,tr){return this.start.copy(er),this.end.copy(tr),this}copy(er){return this.start.copy(er.start),this.end.copy(er.end),this}getCenter(er){return er.addVectors(this.start,this.end).multiplyScalar(.5)}delta(er){return er.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(er,tr){return this.delta(tr).multiplyScalar(er).add(this.start)}closestPointToPointParameter(er,tr){_startP.subVectors(er,this.start),_startEnd.subVectors(this.end,this.start);const rr=_startEnd.dot(_startEnd);let sr=_startEnd.dot(_startP)/rr;return tr&&(sr=clamp(sr,0,1)),sr}closestPointToPoint(er,tr,rr){const nr=this.closestPointToPointParameter(er,tr);return this.delta(rr).multiplyScalar(nr).add(this.start)}applyMatrix4(er){return this.start.applyMatrix4(er),this.end.applyMatrix4(er),this}equals(er){return er.start.equals(this.start)&&er.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$3$1=new Vector3$1;class SpotLightHelper extends Object3D{constructor(er,tr){super(),this.light=er,this.matrixAutoUpdate=!1,this.color=tr,this.type="SpotLightHelper";const rr=new BufferGeometry,nr=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let ar=0,or=1,lr=32;ar<lr;ar++,or++){const cr=ar/lr*Math.PI*2,hr=or/lr*Math.PI*2;nr.push(Math.cos(cr),Math.sin(cr),1,Math.cos(hr),Math.sin(hr),1)}rr.setAttribute("position",new Float32BufferAttribute(nr,3));const sr=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(rr,sr),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const er=this.light.distance?this.light.distance:1e3,tr=er*Math.tan(this.light.angle);this.cone.scale.set(tr,tr,er),_vector$3$1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3$1),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2$1=new Vector3$1,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(er){const tr=getBoneList(er),rr=new BufferGeometry,nr=[],sr=[],ar=new Color(0,0,1),or=new Color(0,1,0);for(let cr=0;cr<tr.length;cr++){const hr=tr[cr];hr.parent&&hr.parent.isBone&&(nr.push(0,0,0),nr.push(0,0,0),sr.push(ar.r,ar.g,ar.b),sr.push(or.r,or.g,or.b))}rr.setAttribute("position",new Float32BufferAttribute(nr,3)),rr.setAttribute("color",new Float32BufferAttribute(sr,3));const lr=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(rr,lr),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=er,this.bones=tr,this.matrix=er.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(er){const tr=this.bones,rr=this.geometry,nr=rr.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let sr=0,ar=0;sr<tr.length;sr++){const or=tr[sr];or.parent&&or.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,or.matrixWorld),_vector$2$1.setFromMatrixPosition(_boneMatrix),nr.setXYZ(ar,_vector$2$1.x,_vector$2$1.y,_vector$2$1.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,or.parent.matrixWorld),_vector$2$1.setFromMatrixPosition(_boneMatrix),nr.setXYZ(ar+1,_vector$2$1.x,_vector$2$1.y,_vector$2$1.z),ar+=2)}rr.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(er)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(ir){const er=[];ir.isBone===!0&&er.push(ir);for(let tr=0;tr<ir.children.length;tr++)er.push.apply(er,getBoneList(ir.children[tr]));return er}class PointLightHelper extends Mesh{constructor(er,tr,rr){const nr=new SphereGeometry(tr,4,2),sr=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(nr,sr),this.light=er,this.color=rr,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1$1=new Vector3$1,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(er,tr,rr){super(),this.light=er,this.matrix=er.matrixWorld,this.matrixAutoUpdate=!1,this.color=rr,this.type="HemisphereLightHelper";const nr=new OctahedronGeometry(tr);nr.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const sr=nr.getAttribute("position"),ar=new Float32Array(sr.count*3);nr.setAttribute("color",new BufferAttribute(ar,3)),this.add(new Mesh(nr,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const er=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const tr=er.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let rr=0,nr=tr.count;rr<nr;rr++){const sr=rr<nr/2?_color1:_color2;tr.setXYZ(rr,sr.r,sr.g,sr.b)}tr.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),er.lookAt(_vector$1$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(er=10,tr=10,rr=4473924,nr=8947848){rr=new Color(rr),nr=new Color(nr);const sr=tr/2,ar=er/tr,or=er/2,lr=[],cr=[];for(let ur=0,pr=0,gr=-or;ur<=tr;ur++,gr+=ar){lr.push(-or,0,gr,or,0,gr),lr.push(gr,0,-or,gr,0,or);const _r=ur===sr?rr:nr;_r.toArray(cr,pr),pr+=3,_r.toArray(cr,pr),pr+=3,_r.toArray(cr,pr),pr+=3,_r.toArray(cr,pr),pr+=3}const hr=new BufferGeometry;hr.setAttribute("position",new Float32BufferAttribute(lr,3)),hr.setAttribute("color",new Float32BufferAttribute(cr,3));const fr=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(hr,fr),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(er=10,tr=16,rr=8,nr=64,sr=4473924,ar=8947848){sr=new Color(sr),ar=new Color(ar);const or=[],lr=[];if(tr>1)for(let fr=0;fr<tr;fr++){const ur=fr/tr*(Math.PI*2),pr=Math.sin(ur)*er,gr=Math.cos(ur)*er;or.push(0,0,0),or.push(pr,0,gr);const _r=fr&1?sr:ar;lr.push(_r.r,_r.g,_r.b),lr.push(_r.r,_r.g,_r.b)}for(let fr=0;fr<rr;fr++){const ur=fr&1?sr:ar,pr=er-er/rr*fr;for(let gr=0;gr<nr;gr++){let _r=gr/nr*(Math.PI*2),mr=Math.sin(_r)*pr,dr=Math.cos(_r)*pr;or.push(mr,0,dr),lr.push(ur.r,ur.g,ur.b),_r=(gr+1)/nr*(Math.PI*2),mr=Math.sin(_r)*pr,dr=Math.cos(_r)*pr,or.push(mr,0,dr),lr.push(ur.r,ur.g,ur.b)}}const cr=new BufferGeometry;cr.setAttribute("position",new Float32BufferAttribute(or,3)),cr.setAttribute("color",new Float32BufferAttribute(lr,3));const hr=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(cr,hr),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1$8=new Vector3$1,_v2$5=new Vector3$1,_v3$3=new Vector3$1;class DirectionalLightHelper extends Object3D{constructor(er,tr,rr){super(),this.light=er,this.matrix=er.matrixWorld,this.matrixAutoUpdate=!1,this.color=rr,this.type="DirectionalLightHelper",tr===void 0&&(tr=1);let nr=new BufferGeometry;nr.setAttribute("position",new Float32BufferAttribute([-tr,tr,0,tr,tr,0,tr,-tr,0,-tr,-tr,0,-tr,tr,0],3));const sr=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(nr,sr),this.add(this.lightPlane),nr=new BufferGeometry,nr.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(nr,sr),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1$8.setFromMatrixPosition(this.light.matrixWorld),_v2$5.setFromMatrixPosition(this.light.target.matrixWorld),_v3$3.subVectors(_v2$5,_v1$8),this.lightPlane.lookAt(_v2$5),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$5),this.targetLine.scale.z=_v3$3.length()}}const _vector$d=new Vector3$1,_camera$1=new Camera;class CameraHelper extends LineSegments{constructor(er){const tr=new BufferGeometry,rr=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),nr=[],sr=[],ar={};or("n1","n2"),or("n2","n4"),or("n4","n3"),or("n3","n1"),or("f1","f2"),or("f2","f4"),or("f4","f3"),or("f3","f1"),or("n1","f1"),or("n2","f2"),or("n3","f3"),or("n4","f4"),or("p","n1"),or("p","n2"),or("p","n3"),or("p","n4"),or("u1","u2"),or("u2","u3"),or("u3","u1"),or("c","t"),or("p","c"),or("cn1","cn2"),or("cn3","cn4"),or("cf1","cf2"),or("cf3","cf4");function or(gr,_r){lr(gr),lr(_r)}function lr(gr){nr.push(0,0,0),sr.push(0,0,0),ar[gr]===void 0&&(ar[gr]=[]),ar[gr].push(nr.length/3-1)}tr.setAttribute("position",new Float32BufferAttribute(nr,3)),tr.setAttribute("color",new Float32BufferAttribute(sr,3)),super(tr,rr),this.type="CameraHelper",this.camera=er,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=er.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=ar,this.update();const cr=new Color(16755200),hr=new Color(16711680),fr=new Color(43775),ur=new Color(16777215),pr=new Color(3355443);this.setColors(cr,hr,fr,ur,pr)}setColors(er,tr,rr,nr,sr){const or=this.geometry.getAttribute("color");or.setXYZ(0,er.r,er.g,er.b),or.setXYZ(1,er.r,er.g,er.b),or.setXYZ(2,er.r,er.g,er.b),or.setXYZ(3,er.r,er.g,er.b),or.setXYZ(4,er.r,er.g,er.b),or.setXYZ(5,er.r,er.g,er.b),or.setXYZ(6,er.r,er.g,er.b),or.setXYZ(7,er.r,er.g,er.b),or.setXYZ(8,er.r,er.g,er.b),or.setXYZ(9,er.r,er.g,er.b),or.setXYZ(10,er.r,er.g,er.b),or.setXYZ(11,er.r,er.g,er.b),or.setXYZ(12,er.r,er.g,er.b),or.setXYZ(13,er.r,er.g,er.b),or.setXYZ(14,er.r,er.g,er.b),or.setXYZ(15,er.r,er.g,er.b),or.setXYZ(16,er.r,er.g,er.b),or.setXYZ(17,er.r,er.g,er.b),or.setXYZ(18,er.r,er.g,er.b),or.setXYZ(19,er.r,er.g,er.b),or.setXYZ(20,er.r,er.g,er.b),or.setXYZ(21,er.r,er.g,er.b),or.setXYZ(22,er.r,er.g,er.b),or.setXYZ(23,er.r,er.g,er.b),or.setXYZ(24,tr.r,tr.g,tr.b),or.setXYZ(25,tr.r,tr.g,tr.b),or.setXYZ(26,tr.r,tr.g,tr.b),or.setXYZ(27,tr.r,tr.g,tr.b),or.setXYZ(28,tr.r,tr.g,tr.b),or.setXYZ(29,tr.r,tr.g,tr.b),or.setXYZ(30,tr.r,tr.g,tr.b),or.setXYZ(31,tr.r,tr.g,tr.b),or.setXYZ(32,rr.r,rr.g,rr.b),or.setXYZ(33,rr.r,rr.g,rr.b),or.setXYZ(34,rr.r,rr.g,rr.b),or.setXYZ(35,rr.r,rr.g,rr.b),or.setXYZ(36,rr.r,rr.g,rr.b),or.setXYZ(37,rr.r,rr.g,rr.b),or.setXYZ(38,nr.r,nr.g,nr.b),or.setXYZ(39,nr.r,nr.g,nr.b),or.setXYZ(40,sr.r,sr.g,sr.b),or.setXYZ(41,sr.r,sr.g,sr.b),or.setXYZ(42,sr.r,sr.g,sr.b),or.setXYZ(43,sr.r,sr.g,sr.b),or.setXYZ(44,sr.r,sr.g,sr.b),or.setXYZ(45,sr.r,sr.g,sr.b),or.setXYZ(46,sr.r,sr.g,sr.b),or.setXYZ(47,sr.r,sr.g,sr.b),or.setXYZ(48,sr.r,sr.g,sr.b),or.setXYZ(49,sr.r,sr.g,sr.b),or.needsUpdate=!0}update(){const er=this.geometry,tr=this.pointMap,rr=1,nr=1;_camera$1.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const sr=this.camera.coordinateSystem===WebGLCoordinateSystem?-1:0;setPoint("c",tr,er,_camera$1,0,0,sr),setPoint("t",tr,er,_camera$1,0,0,1),setPoint("n1",tr,er,_camera$1,-rr,-nr,sr),setPoint("n2",tr,er,_camera$1,rr,-nr,sr),setPoint("n3",tr,er,_camera$1,-rr,nr,sr),setPoint("n4",tr,er,_camera$1,rr,nr,sr),setPoint("f1",tr,er,_camera$1,-rr,-nr,1),setPoint("f2",tr,er,_camera$1,rr,-nr,1),setPoint("f3",tr,er,_camera$1,-rr,nr,1),setPoint("f4",tr,er,_camera$1,rr,nr,1),setPoint("u1",tr,er,_camera$1,rr*.7,nr*1.1,sr),setPoint("u2",tr,er,_camera$1,-rr*.7,nr*1.1,sr),setPoint("u3",tr,er,_camera$1,0,nr*2,sr),setPoint("cf1",tr,er,_camera$1,-rr,0,1),setPoint("cf2",tr,er,_camera$1,rr,0,1),setPoint("cf3",tr,er,_camera$1,0,-nr,1),setPoint("cf4",tr,er,_camera$1,0,nr,1),setPoint("cn1",tr,er,_camera$1,-rr,0,sr),setPoint("cn2",tr,er,_camera$1,rr,0,sr),setPoint("cn3",tr,er,_camera$1,0,-nr,sr),setPoint("cn4",tr,er,_camera$1,0,nr,sr),er.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(ir,er,tr,rr,nr,sr,ar){_vector$d.set(nr,sr,ar).unproject(rr);const or=er[ir];if(or!==void 0){const lr=tr.getAttribute("position");for(let cr=0,hr=or.length;cr<hr;cr++)lr.setXYZ(or[cr],_vector$d.x,_vector$d.y,_vector$d.z)}}const _box$5=new Box3;class BoxHelper extends LineSegments{constructor(er,tr=16776960){const rr=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),nr=new Float32Array(8*3),sr=new BufferGeometry;sr.setIndex(new BufferAttribute(rr,1)),sr.setAttribute("position",new BufferAttribute(nr,3)),super(sr,new LineBasicMaterial({color:tr,toneMapped:!1})),this.object=er,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(er){if(er!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&_box$5.setFromObject(this.object),_box$5.isEmpty())return;const tr=_box$5.min,rr=_box$5.max,nr=this.geometry.attributes.position,sr=nr.array;sr[0]=rr.x,sr[1]=rr.y,sr[2]=rr.z,sr[3]=tr.x,sr[4]=rr.y,sr[5]=rr.z,sr[6]=tr.x,sr[7]=tr.y,sr[8]=rr.z,sr[9]=rr.x,sr[10]=tr.y,sr[11]=rr.z,sr[12]=rr.x,sr[13]=rr.y,sr[14]=tr.z,sr[15]=tr.x,sr[16]=rr.y,sr[17]=tr.z,sr[18]=tr.x,sr[19]=tr.y,sr[20]=tr.z,sr[21]=rr.x,sr[22]=tr.y,sr[23]=tr.z,nr.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(er){return this.object=er,this.update(),this}copy(er,tr){return super.copy(er,tr),this.object=er.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(er,tr=16776960){const rr=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),nr=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],sr=new BufferGeometry;sr.setIndex(new BufferAttribute(rr,1)),sr.setAttribute("position",new Float32BufferAttribute(nr,3)),super(sr,new LineBasicMaterial({color:tr,toneMapped:!1})),this.box=er,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(er){const tr=this.box;tr.isEmpty()||(tr.getCenter(this.position),tr.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(er))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(er,tr=1,rr=16776960){const nr=rr,sr=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],ar=new BufferGeometry;ar.setAttribute("position",new Float32BufferAttribute(sr,3)),ar.computeBoundingSphere(),super(ar,new LineBasicMaterial({color:nr,toneMapped:!1})),this.type="PlaneHelper",this.plane=er,this.size=tr;const or=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],lr=new BufferGeometry;lr.setAttribute("position",new Float32BufferAttribute(or,3)),lr.computeBoundingSphere(),this.add(new Mesh(lr,new MeshBasicMaterial({color:nr,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(er){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(er)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis$2=new Vector3$1;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(er=new Vector3$1(0,0,1),tr=new Vector3$1(0,0,0),rr=1,nr=16776960,sr=rr*.2,ar=sr*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(tr),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:nr,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:nr,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(er),this.setLength(rr,sr,ar)}setDirection(er){if(er.y>.99999)this.quaternion.set(0,0,0,1);else if(er.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis$2.set(er.z,0,-er.x).normalize();const tr=Math.acos(er.y);this.quaternion.setFromAxisAngle(_axis$2,tr)}}setLength(er,tr=er*.2,rr=tr*.2){this.line.scale.set(1,Math.max(1e-4,er-tr),1),this.line.updateMatrix(),this.cone.scale.set(rr,tr,rr),this.cone.position.y=er,this.cone.updateMatrix()}setColor(er){this.line.material.color.set(er),this.cone.material.color.set(er)}copy(er){return super.copy(er,!1),this.line.copy(er.line),this.cone.copy(er.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(er=1){const tr=[0,0,0,er,0,0,0,0,0,0,er,0,0,0,0,0,0,er],rr=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],nr=new BufferGeometry;nr.setAttribute("position",new Float32BufferAttribute(tr,3)),nr.setAttribute("color",new Float32BufferAttribute(rr,3));const sr=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(nr,sr),this.type="AxesHelper"}setColors(er,tr,rr){const nr=new Color,sr=this.geometry.attributes.color.array;return nr.set(er),nr.toArray(sr,0),nr.toArray(sr,3),nr.set(tr),nr.toArray(sr,6),nr.toArray(sr,9),nr.set(rr),nr.toArray(sr,12),nr.toArray(sr,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(er,tr){return this.currentPath=new Path$1,this.subPaths.push(this.currentPath),this.currentPath.moveTo(er,tr),this}lineTo(er,tr){return this.currentPath.lineTo(er,tr),this}quadraticCurveTo(er,tr,rr,nr){return this.currentPath.quadraticCurveTo(er,tr,rr,nr),this}bezierCurveTo(er,tr,rr,nr,sr,ar){return this.currentPath.bezierCurveTo(er,tr,rr,nr,sr,ar),this}splineThru(er){return this.currentPath.splineThru(er),this}toShapes(er){function tr(dr){const vr=[];for(let Ar=0,yr=dr.length;Ar<yr;Ar++){const wr=dr[Ar],br=new Shape$1;br.curves=wr.curves,vr.push(br)}return vr}function rr(dr,vr){const Ar=vr.length;let yr=!1;for(let wr=Ar-1,br=0;br<Ar;wr=br++){let Sr=vr[wr],xr=vr[br],Cr=xr.x-Sr.x,Ir=xr.y-Sr.y;if(Math.abs(Ir)>Number.EPSILON){if(Ir<0&&(Sr=vr[br],Cr=-Cr,xr=vr[wr],Ir=-Ir),dr.y<Sr.y||dr.y>xr.y)continue;if(dr.y===Sr.y){if(dr.x===Sr.x)return!0}else{const Rr=Ir*(dr.x-Sr.x)-Cr*(dr.y-Sr.y);if(Rr===0)return!0;if(Rr<0)continue;yr=!yr}}else{if(dr.y!==Sr.y)continue;if(xr.x<=dr.x&&dr.x<=Sr.x||Sr.x<=dr.x&&dr.x<=xr.x)return!0}}return yr}const nr=ShapeUtils.isClockWise,sr=this.subPaths;if(sr.length===0)return[];let ar,or,lr;const cr=[];if(sr.length===1)return or=sr[0],lr=new Shape$1,lr.curves=or.curves,cr.push(lr),cr;let hr=!nr(sr[0].getPoints());hr=er?!hr:hr;const fr=[],ur=[];let pr=[],gr=0,_r;ur[gr]=void 0,pr[gr]=[];for(let dr=0,vr=sr.length;dr<vr;dr++)or=sr[dr],_r=or.getPoints(),ar=nr(_r),ar=er?!ar:ar,ar?(!hr&&ur[gr]&&gr++,ur[gr]={s:new Shape$1,p:_r},ur[gr].s.curves=or.curves,hr&&gr++,pr[gr]=[]):pr[gr].push({h:or,p:_r[0]});if(!ur[0])return tr(sr);if(ur.length>1){let dr=!1,vr=0;for(let Ar=0,yr=ur.length;Ar<yr;Ar++)fr[Ar]=[];for(let Ar=0,yr=ur.length;Ar<yr;Ar++){const wr=pr[Ar];for(let br=0;br<wr.length;br++){const Sr=wr[br];let xr=!0;for(let Cr=0;Cr<ur.length;Cr++)rr(Sr.p,ur[Cr].p)&&(Ar!==Cr&&vr++,xr?(xr=!1,fr[Cr].push(Sr)):dr=!0);xr&&fr[Ar].push(Sr)}}vr>0&&dr===!1&&(pr=fr)}let mr;for(let dr=0,vr=ur.length;dr<vr;dr++){lr=ur[dr].s,cr.push(lr),mr=pr[dr];for(let Ar=0,yr=mr.length;Ar<yr;Ar++)lr.holes.push(mr[Ar].h)}return cr}}class Controls extends EventDispatcher{constructor(er,tr=null){super(),this.object=er,this.domElement=tr,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function contain(ir,er){const tr=ir.image&&ir.image.width?ir.image.width/ir.image.height:1;return tr>er?(ir.repeat.x=1,ir.repeat.y=tr/er,ir.offset.x=0,ir.offset.y=(1-ir.repeat.y)/2):(ir.repeat.x=er/tr,ir.repeat.y=1,ir.offset.x=(1-ir.repeat.x)/2,ir.offset.y=0),ir}function cover(ir,er){const tr=ir.image&&ir.image.width?ir.image.width/ir.image.height:1;return tr>er?(ir.repeat.x=er/tr,ir.repeat.y=1,ir.offset.x=(1-ir.repeat.x)/2,ir.offset.y=0):(ir.repeat.x=1,ir.repeat.y=tr/er,ir.offset.x=0,ir.offset.y=(1-ir.repeat.y)/2),ir}function fill(ir){return ir.repeat.x=1,ir.repeat.y=1,ir.offset.x=0,ir.offset.y=0,ir}function getByteLength(ir,er,tr,rr){const nr=getTextureTypeByteLength(rr);switch(tr){case AlphaFormat:return ir*er;case LuminanceFormat:return ir*er;case LuminanceAlphaFormat:return ir*er*2;case RedFormat:return ir*er/nr.components*nr.byteLength;case RedIntegerFormat:return ir*er/nr.components*nr.byteLength;case RGFormat:return ir*er*2/nr.components*nr.byteLength;case RGIntegerFormat:return ir*er*2/nr.components*nr.byteLength;case RGBFormat:return ir*er*3/nr.components*nr.byteLength;case RGBAFormat:return ir*er*4/nr.components*nr.byteLength;case RGBAIntegerFormat:return ir*er*4/nr.components*nr.byteLength;case RGB_S3TC_DXT1_Format:case RGBA_S3TC_DXT1_Format:return Math.floor((ir+3)/4)*Math.floor((er+3)/4)*8;case RGBA_S3TC_DXT3_Format:case RGBA_S3TC_DXT5_Format:return Math.floor((ir+3)/4)*Math.floor((er+3)/4)*16;case RGB_PVRTC_2BPPV1_Format:case RGBA_PVRTC_2BPPV1_Format:return Math.max(ir,16)*Math.max(er,8)/4;case RGB_PVRTC_4BPPV1_Format:case RGBA_PVRTC_4BPPV1_Format:return Math.max(ir,8)*Math.max(er,8)/2;case RGB_ETC1_Format:case RGB_ETC2_Format:return Math.floor((ir+3)/4)*Math.floor((er+3)/4)*8;case RGBA_ETC2_EAC_Format:return Math.floor((ir+3)/4)*Math.floor((er+3)/4)*16;case RGBA_ASTC_4x4_Format:return Math.floor((ir+3)/4)*Math.floor((er+3)/4)*16;case RGBA_ASTC_5x4_Format:return Math.floor((ir+4)/5)*Math.floor((er+3)/4)*16;case RGBA_ASTC_5x5_Format:return Math.floor((ir+4)/5)*Math.floor((er+4)/5)*16;case RGBA_ASTC_6x5_Format:return Math.floor((ir+5)/6)*Math.floor((er+4)/5)*16;case RGBA_ASTC_6x6_Format:return Math.floor((ir+5)/6)*Math.floor((er+5)/6)*16;case RGBA_ASTC_8x5_Format:return Math.floor((ir+7)/8)*Math.floor((er+4)/5)*16;case RGBA_ASTC_8x6_Format:return Math.floor((ir+7)/8)*Math.floor((er+5)/6)*16;case RGBA_ASTC_8x8_Format:return Math.floor((ir+7)/8)*Math.floor((er+7)/8)*16;case RGBA_ASTC_10x5_Format:return Math.floor((ir+9)/10)*Math.floor((er+4)/5)*16;case RGBA_ASTC_10x6_Format:return Math.floor((ir+9)/10)*Math.floor((er+5)/6)*16;case RGBA_ASTC_10x8_Format:return Math.floor((ir+9)/10)*Math.floor((er+7)/8)*16;case RGBA_ASTC_10x10_Format:return Math.floor((ir+9)/10)*Math.floor((er+9)/10)*16;case RGBA_ASTC_12x10_Format:return Math.floor((ir+11)/12)*Math.floor((er+9)/10)*16;case RGBA_ASTC_12x12_Format:return Math.floor((ir+11)/12)*Math.floor((er+11)/12)*16;case RGBA_BPTC_Format:case RGB_BPTC_SIGNED_Format:case RGB_BPTC_UNSIGNED_Format:return Math.ceil(ir/4)*Math.ceil(er/4)*16;case RED_RGTC1_Format:case SIGNED_RED_RGTC1_Format:return Math.ceil(ir/4)*Math.ceil(er/4)*8;case RED_GREEN_RGTC2_Format:case SIGNED_RED_GREEN_RGTC2_Format:return Math.ceil(ir/4)*Math.ceil(er/4)*16}throw new Error(`Unable to determine texture byte length for ${tr} format.`)}function getTextureTypeByteLength(ir){switch(ir){case UnsignedByteType:case ByteType:return{byteLength:1,components:1};case UnsignedShortType:case ShortType:case HalfFloatType:return{byteLength:2,components:1};case UnsignedShort4444Type:case UnsignedShort5551Type:return{byteLength:2,components:4};case UnsignedIntType:case IntType:case FloatType:return{byteLength:4,components:1};case UnsignedInt5999Type:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${ir}.`)}const TextureUtils={contain,cover,fill,getByteLength};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function WebGLAnimation(){let ir=null,er=!1,tr=null,rr=null;function nr(sr,ar){tr(sr,ar),rr=ir.requestAnimationFrame(nr)}return{start:function(){er!==!0&&tr!==null&&(rr=ir.requestAnimationFrame(nr),er=!0)},stop:function(){ir.cancelAnimationFrame(rr),er=!1},setAnimationLoop:function(sr){tr=sr},setContext:function(sr){ir=sr}}}function WebGLAttributes(ir){const er=new WeakMap;function tr(or,lr){const cr=or.array,hr=or.usage,fr=cr.byteLength,ur=ir.createBuffer();ir.bindBuffer(lr,ur),ir.bufferData(lr,cr,hr),or.onUploadCallback();let pr;if(cr instanceof Float32Array)pr=ir.FLOAT;else if(cr instanceof Uint16Array)or.isFloat16BufferAttribute?pr=ir.HALF_FLOAT:pr=ir.UNSIGNED_SHORT;else if(cr instanceof Int16Array)pr=ir.SHORT;else if(cr instanceof Uint32Array)pr=ir.UNSIGNED_INT;else if(cr instanceof Int32Array)pr=ir.INT;else if(cr instanceof Int8Array)pr=ir.BYTE;else if(cr instanceof Uint8Array)pr=ir.UNSIGNED_BYTE;else if(cr instanceof Uint8ClampedArray)pr=ir.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+cr);return{buffer:ur,type:pr,bytesPerElement:cr.BYTES_PER_ELEMENT,version:or.version,size:fr}}function rr(or,lr,cr){const hr=lr.array,fr=lr.updateRanges;if(ir.bindBuffer(cr,or),fr.length===0)ir.bufferSubData(cr,0,hr);else{fr.sort((pr,gr)=>pr.start-gr.start);let ur=0;for(let pr=1;pr<fr.length;pr++){const gr=fr[ur],_r=fr[pr];_r.start<=gr.start+gr.count+1?gr.count=Math.max(gr.count,_r.start+_r.count-gr.start):(++ur,fr[ur]=_r)}fr.length=ur+1;for(let pr=0,gr=fr.length;pr<gr;pr++){const _r=fr[pr];ir.bufferSubData(cr,_r.start*hr.BYTES_PER_ELEMENT,hr,_r.start,_r.count)}lr.clearUpdateRanges()}lr.onUploadCallback()}function nr(or){return or.isInterleavedBufferAttribute&&(or=or.data),er.get(or)}function sr(or){or.isInterleavedBufferAttribute&&(or=or.data);const lr=er.get(or);lr&&(ir.deleteBuffer(lr.buffer),er.delete(or))}function ar(or,lr){if(or.isInterleavedBufferAttribute&&(or=or.data),or.isGLBufferAttribute){const hr=er.get(or);(!hr||hr.version<or.version)&&er.set(or,{buffer:or.buffer,type:or.type,bytesPerElement:or.elementSize,version:or.version});return}const cr=er.get(or);if(cr===void 0)er.set(or,tr(or,lr));else if(cr.version<or.version){if(cr.size!==or.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");rr(cr.buffer,or,lr),cr.version=or.version}}return{get:nr,remove:sr,update:ar}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,batching_pars_vertex,batching_vertex,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphinstance_vertex,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},envMapRotation:{value:new Matrix3},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Matrix3}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3$1},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0},_e1$1=new Euler,_m1$1=new Matrix4;function WebGLBackground(ir,er,tr,rr,nr,sr,ar){const or=new Color(0);let lr=sr===!0?0:1,cr,hr,fr=null,ur=0,pr=null;function gr(Ar){let yr=Ar.isScene===!0?Ar.background:null;return yr&&yr.isTexture&&(yr=(Ar.backgroundBlurriness>0?tr:er).get(yr)),yr}function _r(Ar){let yr=!1;const wr=gr(Ar);wr===null?dr(or,lr):wr&&wr.isColor&&(dr(wr,1),yr=!0);const br=ir.xr.getEnvironmentBlendMode();br==="additive"?rr.buffers.color.setClear(0,0,0,1,ar):br==="alpha-blend"&&rr.buffers.color.setClear(0,0,0,0,ar),(ir.autoClear||yr)&&(rr.buffers.depth.setTest(!0),rr.buffers.depth.setMask(!0),rr.buffers.color.setMask(!0),ir.clear(ir.autoClearColor,ir.autoClearDepth,ir.autoClearStencil))}function mr(Ar,yr){const wr=gr(yr);wr&&(wr.isCubeTexture||wr.mapping===CubeUVReflectionMapping)?(hr===void 0&&(hr=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),hr.geometry.deleteAttribute("normal"),hr.geometry.deleteAttribute("uv"),hr.onBeforeRender=function(br,Sr,xr){this.matrixWorld.copyPosition(xr.matrixWorld)},Object.defineProperty(hr.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),nr.update(hr)),_e1$1.copy(yr.backgroundRotation),_e1$1.x*=-1,_e1$1.y*=-1,_e1$1.z*=-1,wr.isCubeTexture&&wr.isRenderTargetTexture===!1&&(_e1$1.y*=-1,_e1$1.z*=-1),hr.material.uniforms.envMap.value=wr,hr.material.uniforms.flipEnvMap.value=wr.isCubeTexture&&wr.isRenderTargetTexture===!1?-1:1,hr.material.uniforms.backgroundBlurriness.value=yr.backgroundBlurriness,hr.material.uniforms.backgroundIntensity.value=yr.backgroundIntensity,hr.material.uniforms.backgroundRotation.value.setFromMatrix4(_m1$1.makeRotationFromEuler(_e1$1)),hr.material.toneMapped=ColorManagement.getTransfer(wr.colorSpace)!==SRGBTransfer,(fr!==wr||ur!==wr.version||pr!==ir.toneMapping)&&(hr.material.needsUpdate=!0,fr=wr,ur=wr.version,pr=ir.toneMapping),hr.layers.enableAll(),Ar.unshift(hr,hr.geometry,hr.material,0,0,null)):wr&&wr.isTexture&&(cr===void 0&&(cr=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),cr.geometry.deleteAttribute("normal"),Object.defineProperty(cr.material,"map",{get:function(){return this.uniforms.t2D.value}}),nr.update(cr)),cr.material.uniforms.t2D.value=wr,cr.material.uniforms.backgroundIntensity.value=yr.backgroundIntensity,cr.material.toneMapped=ColorManagement.getTransfer(wr.colorSpace)!==SRGBTransfer,wr.matrixAutoUpdate===!0&&wr.updateMatrix(),cr.material.uniforms.uvTransform.value.copy(wr.matrix),(fr!==wr||ur!==wr.version||pr!==ir.toneMapping)&&(cr.material.needsUpdate=!0,fr=wr,ur=wr.version,pr=ir.toneMapping),cr.layers.enableAll(),Ar.unshift(cr,cr.geometry,cr.material,0,0,null))}function dr(Ar,yr){Ar.getRGB(_rgb,getUnlitUniformColorSpace(ir)),rr.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,yr,ar)}function vr(){hr!==void 0&&(hr.geometry.dispose(),hr.material.dispose(),hr=void 0),cr!==void 0&&(cr.geometry.dispose(),cr.material.dispose(),cr=void 0)}return{getClearColor:function(){return or},setClearColor:function(Ar,yr=1){or.set(Ar),lr=yr,dr(or,lr)},getClearAlpha:function(){return lr},setClearAlpha:function(Ar){lr=Ar,dr(or,lr)},render:_r,addToRenderList:mr,dispose:vr}}function WebGLBindingStates(ir,er){const tr=ir.getParameter(ir.MAX_VERTEX_ATTRIBS),rr={},nr=ur(null);let sr=nr,ar=!1;function or(Ir,Rr,Pr,Fr,Nr){let Ur=!1;const Br=fr(Fr,Pr,Rr);sr!==Br&&(sr=Br,cr(sr.object)),Ur=pr(Ir,Fr,Pr,Nr),Ur&&gr(Ir,Fr,Pr,Nr),Nr!==null&&er.update(Nr,ir.ELEMENT_ARRAY_BUFFER),(Ur||ar)&&(ar=!1,yr(Ir,Rr,Pr,Fr),Nr!==null&&ir.bindBuffer(ir.ELEMENT_ARRAY_BUFFER,er.get(Nr).buffer))}function lr(){return ir.createVertexArray()}function cr(Ir){return ir.bindVertexArray(Ir)}function hr(Ir){return ir.deleteVertexArray(Ir)}function fr(Ir,Rr,Pr){const Fr=Pr.wireframe===!0;let Nr=rr[Ir.id];Nr===void 0&&(Nr={},rr[Ir.id]=Nr);let Ur=Nr[Rr.id];Ur===void 0&&(Ur={},Nr[Rr.id]=Ur);let Br=Ur[Fr];return Br===void 0&&(Br=ur(lr()),Ur[Fr]=Br),Br}function ur(Ir){const Rr=[],Pr=[],Fr=[];for(let Nr=0;Nr<tr;Nr++)Rr[Nr]=0,Pr[Nr]=0,Fr[Nr]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Rr,enabledAttributes:Pr,attributeDivisors:Fr,object:Ir,attributes:{},index:null}}function pr(Ir,Rr,Pr,Fr){const Nr=sr.attributes,Ur=Rr.attributes;let Br=0;const Or=Pr.getAttributes();for(const Dr in Or)if(Or[Dr].location>=0){const $r=Nr[Dr];let Yr=Ur[Dr];if(Yr===void 0&&(Dr==="instanceMatrix"&&Ir.instanceMatrix&&(Yr=Ir.instanceMatrix),Dr==="instanceColor"&&Ir.instanceColor&&(Yr=Ir.instanceColor)),$r===void 0||$r.attribute!==Yr||Yr&&$r.data!==Yr.data)return!0;Br++}return sr.attributesNum!==Br||sr.index!==Fr}function gr(Ir,Rr,Pr,Fr){const Nr={},Ur=Rr.attributes;let Br=0;const Or=Pr.getAttributes();for(const Dr in Or)if(Or[Dr].location>=0){let $r=Ur[Dr];$r===void 0&&(Dr==="instanceMatrix"&&Ir.instanceMatrix&&($r=Ir.instanceMatrix),Dr==="instanceColor"&&Ir.instanceColor&&($r=Ir.instanceColor));const Yr={};Yr.attribute=$r,$r&&$r.data&&(Yr.data=$r.data),Nr[Dr]=Yr,Br++}sr.attributes=Nr,sr.attributesNum=Br,sr.index=Fr}function _r(){const Ir=sr.newAttributes;for(let Rr=0,Pr=Ir.length;Rr<Pr;Rr++)Ir[Rr]=0}function mr(Ir){dr(Ir,0)}function dr(Ir,Rr){const Pr=sr.newAttributes,Fr=sr.enabledAttributes,Nr=sr.attributeDivisors;Pr[Ir]=1,Fr[Ir]===0&&(ir.enableVertexAttribArray(Ir),Fr[Ir]=1),Nr[Ir]!==Rr&&(ir.vertexAttribDivisor(Ir,Rr),Nr[Ir]=Rr)}function vr(){const Ir=sr.newAttributes,Rr=sr.enabledAttributes;for(let Pr=0,Fr=Rr.length;Pr<Fr;Pr++)Rr[Pr]!==Ir[Pr]&&(ir.disableVertexAttribArray(Pr),Rr[Pr]=0)}function Ar(Ir,Rr,Pr,Fr,Nr,Ur,Br){Br===!0?ir.vertexAttribIPointer(Ir,Rr,Pr,Nr,Ur):ir.vertexAttribPointer(Ir,Rr,Pr,Fr,Nr,Ur)}function yr(Ir,Rr,Pr,Fr){_r();const Nr=Fr.attributes,Ur=Pr.getAttributes(),Br=Rr.defaultAttributeValues;for(const Or in Ur){const Dr=Ur[Or];if(Dr.location>=0){let Wr=Nr[Or];if(Wr===void 0&&(Or==="instanceMatrix"&&Ir.instanceMatrix&&(Wr=Ir.instanceMatrix),Or==="instanceColor"&&Ir.instanceColor&&(Wr=Ir.instanceColor)),Wr!==void 0){const $r=Wr.normalized,Yr=Wr.itemSize,Qi=er.get(Wr);if(Qi===void 0)continue;const rs=Qi.buffer,Kr=Qi.type,Qr=Qi.bytesPerElement,Vr=Kr===ir.INT||Kr===ir.UNSIGNED_INT||Wr.gpuType===IntType;if(Wr.isInterleavedBufferAttribute){const Gr=Wr.data,qr=Gr.stride,ji=Wr.offset;if(Gr.isInstancedInterleavedBuffer){for(let Zr=0;Zr<Dr.locationSize;Zr++)dr(Dr.location+Zr,Gr.meshPerAttribute);Ir.isInstancedMesh!==!0&&Fr._maxInstanceCount===void 0&&(Fr._maxInstanceCount=Gr.meshPerAttribute*Gr.count)}else for(let Zr=0;Zr<Dr.locationSize;Zr++)mr(Dr.location+Zr);ir.bindBuffer(ir.ARRAY_BUFFER,rs);for(let Zr=0;Zr<Dr.locationSize;Zr++)Ar(Dr.location+Zr,Yr/Dr.locationSize,Kr,$r,qr*Qr,(ji+Yr/Dr.locationSize*Zr)*Qr,Vr)}else{if(Wr.isInstancedBufferAttribute){for(let Gr=0;Gr<Dr.locationSize;Gr++)dr(Dr.location+Gr,Wr.meshPerAttribute);Ir.isInstancedMesh!==!0&&Fr._maxInstanceCount===void 0&&(Fr._maxInstanceCount=Wr.meshPerAttribute*Wr.count)}else for(let Gr=0;Gr<Dr.locationSize;Gr++)mr(Dr.location+Gr);ir.bindBuffer(ir.ARRAY_BUFFER,rs);for(let Gr=0;Gr<Dr.locationSize;Gr++)Ar(Dr.location+Gr,Yr/Dr.locationSize,Kr,$r,Yr*Qr,Yr/Dr.locationSize*Gr*Qr,Vr)}}else if(Br!==void 0){const $r=Br[Or];if($r!==void 0)switch($r.length){case 2:ir.vertexAttrib2fv(Dr.location,$r);break;case 3:ir.vertexAttrib3fv(Dr.location,$r);break;case 4:ir.vertexAttrib4fv(Dr.location,$r);break;default:ir.vertexAttrib1fv(Dr.location,$r)}}}}vr()}function wr(){xr();for(const Ir in rr){const Rr=rr[Ir];for(const Pr in Rr){const Fr=Rr[Pr];for(const Nr in Fr)hr(Fr[Nr].object),delete Fr[Nr];delete Rr[Pr]}delete rr[Ir]}}function br(Ir){if(rr[Ir.id]===void 0)return;const Rr=rr[Ir.id];for(const Pr in Rr){const Fr=Rr[Pr];for(const Nr in Fr)hr(Fr[Nr].object),delete Fr[Nr];delete Rr[Pr]}delete rr[Ir.id]}function Sr(Ir){for(const Rr in rr){const Pr=rr[Rr];if(Pr[Ir.id]===void 0)continue;const Fr=Pr[Ir.id];for(const Nr in Fr)hr(Fr[Nr].object),delete Fr[Nr];delete Pr[Ir.id]}}function xr(){Cr(),ar=!0,sr!==nr&&(sr=nr,cr(sr.object))}function Cr(){nr.geometry=null,nr.program=null,nr.wireframe=!1}return{setup:or,reset:xr,resetDefaultState:Cr,dispose:wr,releaseStatesOfGeometry:br,releaseStatesOfProgram:Sr,initAttributes:_r,enableAttribute:mr,disableUnusedAttributes:vr}}function WebGLBufferRenderer(ir,er,tr){let rr;function nr(cr){rr=cr}function sr(cr,hr){ir.drawArrays(rr,cr,hr),tr.update(hr,rr,1)}function ar(cr,hr,fr){fr!==0&&(ir.drawArraysInstanced(rr,cr,hr,fr),tr.update(hr,rr,fr))}function or(cr,hr,fr){if(fr===0)return;er.get("WEBGL_multi_draw").multiDrawArraysWEBGL(rr,cr,0,hr,0,fr);let pr=0;for(let gr=0;gr<fr;gr++)pr+=hr[gr];tr.update(pr,rr,1)}function lr(cr,hr,fr,ur){if(fr===0)return;const pr=er.get("WEBGL_multi_draw");if(pr===null)for(let gr=0;gr<cr.length;gr++)ar(cr[gr],hr[gr],ur[gr]);else{pr.multiDrawArraysInstancedWEBGL(rr,cr,0,hr,0,ur,0,fr);let gr=0;for(let _r=0;_r<fr;_r++)gr+=hr[_r]*ur[_r];tr.update(gr,rr,1)}}this.setMode=nr,this.render=sr,this.renderInstances=ar,this.renderMultiDraw=or,this.renderMultiDrawInstances=lr}function WebGLCapabilities(ir,er,tr,rr){let nr;function sr(){if(nr!==void 0)return nr;if(er.has("EXT_texture_filter_anisotropic")===!0){const Sr=er.get("EXT_texture_filter_anisotropic");nr=ir.getParameter(Sr.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else nr=0;return nr}function ar(Sr){return!(Sr!==RGBAFormat&&rr.convert(Sr)!==ir.getParameter(ir.IMPLEMENTATION_COLOR_READ_FORMAT))}function or(Sr){const xr=Sr===HalfFloatType&&(er.has("EXT_color_buffer_half_float")||er.has("EXT_color_buffer_float"));return!(Sr!==UnsignedByteType&&rr.convert(Sr)!==ir.getParameter(ir.IMPLEMENTATION_COLOR_READ_TYPE)&&Sr!==FloatType&&!xr)}function lr(Sr){if(Sr==="highp"){if(ir.getShaderPrecisionFormat(ir.VERTEX_SHADER,ir.HIGH_FLOAT).precision>0&&ir.getShaderPrecisionFormat(ir.FRAGMENT_SHADER,ir.HIGH_FLOAT).precision>0)return"highp";Sr="mediump"}return Sr==="mediump"&&ir.getShaderPrecisionFormat(ir.VERTEX_SHADER,ir.MEDIUM_FLOAT).precision>0&&ir.getShaderPrecisionFormat(ir.FRAGMENT_SHADER,ir.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let cr=tr.precision!==void 0?tr.precision:"highp";const hr=lr(cr);hr!==cr&&(console.warn("THREE.WebGLRenderer:",cr,"not supported, using",hr,"instead."),cr=hr);const fr=tr.logarithmicDepthBuffer===!0,ur=tr.reverseDepthBuffer===!0&&er.has("EXT_clip_control"),pr=ir.getParameter(ir.MAX_TEXTURE_IMAGE_UNITS),gr=ir.getParameter(ir.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_r=ir.getParameter(ir.MAX_TEXTURE_SIZE),mr=ir.getParameter(ir.MAX_CUBE_MAP_TEXTURE_SIZE),dr=ir.getParameter(ir.MAX_VERTEX_ATTRIBS),vr=ir.getParameter(ir.MAX_VERTEX_UNIFORM_VECTORS),Ar=ir.getParameter(ir.MAX_VARYING_VECTORS),yr=ir.getParameter(ir.MAX_FRAGMENT_UNIFORM_VECTORS),wr=gr>0,br=ir.getParameter(ir.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:sr,getMaxPrecision:lr,textureFormatReadable:ar,textureTypeReadable:or,precision:cr,logarithmicDepthBuffer:fr,reverseDepthBuffer:ur,maxTextures:pr,maxVertexTextures:gr,maxTextureSize:_r,maxCubemapSize:mr,maxAttributes:dr,maxVertexUniforms:vr,maxVaryings:Ar,maxFragmentUniforms:yr,vertexTextures:wr,maxSamples:br}}function WebGLClipping(ir){const er=this;let tr=null,rr=0,nr=!1,sr=!1;const ar=new Plane,or=new Matrix3,lr={value:null,needsUpdate:!1};this.uniform=lr,this.numPlanes=0,this.numIntersection=0,this.init=function(fr,ur){const pr=fr.length!==0||ur||rr!==0||nr;return nr=ur,rr=fr.length,pr},this.beginShadows=function(){sr=!0,hr(null)},this.endShadows=function(){sr=!1},this.setGlobalState=function(fr,ur){tr=hr(fr,ur,0)},this.setState=function(fr,ur,pr){const gr=fr.clippingPlanes,_r=fr.clipIntersection,mr=fr.clipShadows,dr=ir.get(fr);if(!nr||gr===null||gr.length===0||sr&&!mr)sr?hr(null):cr();else{const vr=sr?0:rr,Ar=vr*4;let yr=dr.clippingState||null;lr.value=yr,yr=hr(gr,ur,Ar,pr);for(let wr=0;wr!==Ar;++wr)yr[wr]=tr[wr];dr.clippingState=yr,this.numIntersection=_r?this.numPlanes:0,this.numPlanes+=vr}};function cr(){lr.value!==tr&&(lr.value=tr,lr.needsUpdate=rr>0),er.numPlanes=rr,er.numIntersection=0}function hr(fr,ur,pr,gr){const _r=fr!==null?fr.length:0;let mr=null;if(_r!==0){if(mr=lr.value,gr!==!0||mr===null){const dr=pr+_r*4,vr=ur.matrixWorldInverse;or.getNormalMatrix(vr),(mr===null||mr.length<dr)&&(mr=new Float32Array(dr));for(let Ar=0,yr=pr;Ar!==_r;++Ar,yr+=4)ar.copy(fr[Ar]).applyMatrix4(vr,or),ar.normal.toArray(mr,yr),mr[yr+3]=ar.constant}lr.value=mr,lr.needsUpdate=!0}return er.numPlanes=_r,er.numIntersection=0,mr}}function WebGLCubeMaps(ir){let er=new WeakMap;function tr(ar,or){return or===EquirectangularReflectionMapping?ar.mapping=CubeReflectionMapping:or===EquirectangularRefractionMapping&&(ar.mapping=CubeRefractionMapping),ar}function rr(ar){if(ar&&ar.isTexture){const or=ar.mapping;if(or===EquirectangularReflectionMapping||or===EquirectangularRefractionMapping)if(er.has(ar)){const lr=er.get(ar).texture;return tr(lr,ar.mapping)}else{const lr=ar.image;if(lr&&lr.height>0){const cr=new WebGLCubeRenderTarget(lr.height);return cr.fromEquirectangularTexture(ir,ar),er.set(ar,cr),ar.addEventListener("dispose",nr),tr(cr.texture,ar.mapping)}else return null}}return ar}function nr(ar){const or=ar.target;or.removeEventListener("dispose",nr);const lr=er.get(or);lr!==void 0&&(er.delete(or),lr.dispose())}function sr(){er=new WeakMap}return{get:rr,dispose:sr}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0,_oldXrEnabled=!1;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3$1(-PHI,INV_PHI,0),new Vector3$1(PHI,INV_PHI,0),new Vector3$1(-INV_PHI,0,PHI),new Vector3$1(INV_PHI,0,PHI),new Vector3$1(0,PHI,-INV_PHI),new Vector3$1(0,PHI,INV_PHI),new Vector3$1(-1,1,-1),new Vector3$1(1,1,-1),new Vector3$1(-1,1,1),new Vector3$1(1,1,1)];class PMREMGenerator{constructor(er){this._renderer=er,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(er,tr=0,rr=.1,nr=100){_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const sr=this._allocateTargets();return sr.depthBuffer=!0,this._sceneToCubeUV(er,rr,nr,sr),tr>0&&this._blur(sr,0,0,tr),this._applyPMREM(sr),this._cleanup(sr),sr}fromEquirectangular(er,tr=null){return this._fromTexture(er,tr)}fromCubemap(er,tr=null){return this._fromTexture(er,tr)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(er){this._lodMax=Math.floor(Math.log2(er)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let er=0;er<this._lodPlanes.length;er++)this._lodPlanes[er].dispose()}_cleanup(er){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),this._renderer.xr.enabled=_oldXrEnabled,er.scissorTest=!1,_setViewport(er,0,0,er.width,er.height)}_fromTexture(er,tr){er.mapping===CubeReflectionMapping||er.mapping===CubeRefractionMapping?this._setSize(er.image.length===0?16:er.image[0].width||er.image[0].image.width):this._setSize(er.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const rr=tr||this._allocateTargets();return this._textureToCubeUV(er,rr),this._applyPMREM(rr),this._cleanup(rr),rr}_allocateTargets(){const er=3*Math.max(this._cubeSize,112),tr=4*this._cubeSize,rr={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},nr=_createRenderTarget(er,tr,rr);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==er||this._pingPongRenderTarget.height!==tr){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(er,tr,rr);const{_lodMax:sr}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(sr)),this._blurMaterial=_getBlurShader(sr,er,tr)}return nr}_compileMaterial(er){const tr=new Mesh(this._lodPlanes[0],er);this._renderer.compile(tr,_flatCamera)}_sceneToCubeUV(er,tr,rr,nr){const or=new PerspectiveCamera(90,1,tr,rr),lr=[1,-1,1,1,1,1],cr=[1,1,1,-1,-1,-1],hr=this._renderer,fr=hr.autoClear,ur=hr.toneMapping;hr.getClearColor(_clearColor),hr.toneMapping=NoToneMapping,hr.autoClear=!1;const pr=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),gr=new Mesh(new BoxGeometry,pr);let _r=!1;const mr=er.background;mr?mr.isColor&&(pr.color.copy(mr),er.background=null,_r=!0):(pr.color.copy(_clearColor),_r=!0);for(let dr=0;dr<6;dr++){const vr=dr%3;vr===0?(or.up.set(0,lr[dr],0),or.lookAt(cr[dr],0,0)):vr===1?(or.up.set(0,0,lr[dr]),or.lookAt(0,cr[dr],0)):(or.up.set(0,lr[dr],0),or.lookAt(0,0,cr[dr]));const Ar=this._cubeSize;_setViewport(nr,vr*Ar,dr>2?Ar:0,Ar,Ar),hr.setRenderTarget(nr),_r&&hr.render(gr,or),hr.render(er,or)}gr.geometry.dispose(),gr.material.dispose(),hr.toneMapping=ur,hr.autoClear=fr,er.background=mr}_textureToCubeUV(er,tr){const rr=this._renderer,nr=er.mapping===CubeReflectionMapping||er.mapping===CubeRefractionMapping;nr?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=er.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const sr=nr?this._cubemapMaterial:this._equirectMaterial,ar=new Mesh(this._lodPlanes[0],sr),or=sr.uniforms;or.envMap.value=er;const lr=this._cubeSize;_setViewport(tr,0,0,3*lr,2*lr),rr.setRenderTarget(tr),rr.render(ar,_flatCamera)}_applyPMREM(er){const tr=this._renderer,rr=tr.autoClear;tr.autoClear=!1;const nr=this._lodPlanes.length;for(let sr=1;sr<nr;sr++){const ar=Math.sqrt(this._sigmas[sr]*this._sigmas[sr]-this._sigmas[sr-1]*this._sigmas[sr-1]),or=_axisDirections[(nr-sr-1)%_axisDirections.length];this._blur(er,sr-1,sr,ar,or)}tr.autoClear=rr}_blur(er,tr,rr,nr,sr){const ar=this._pingPongRenderTarget;this._halfBlur(er,ar,tr,rr,nr,"latitudinal",sr),this._halfBlur(ar,er,rr,rr,nr,"longitudinal",sr)}_halfBlur(er,tr,rr,nr,sr,ar,or){const lr=this._renderer,cr=this._blurMaterial;ar!=="latitudinal"&&ar!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const hr=3,fr=new Mesh(this._lodPlanes[nr],cr),ur=cr.uniforms,pr=this._sizeLods[rr]-1,gr=isFinite(sr)?Math.PI/(2*pr):2*Math.PI/(2*MAX_SAMPLES-1),_r=sr/gr,mr=isFinite(sr)?1+Math.floor(hr*_r):MAX_SAMPLES;mr>MAX_SAMPLES&&console.warn(`sigmaRadians, ${sr}, is too large and will clip, as it requested ${mr} samples when the maximum is set to ${MAX_SAMPLES}`);const dr=[];let vr=0;for(let Sr=0;Sr<MAX_SAMPLES;++Sr){const xr=Sr/_r,Cr=Math.exp(-xr*xr/2);dr.push(Cr),Sr===0?vr+=Cr:Sr<mr&&(vr+=2*Cr)}for(let Sr=0;Sr<dr.length;Sr++)dr[Sr]=dr[Sr]/vr;ur.envMap.value=er.texture,ur.samples.value=mr,ur.weights.value=dr,ur.latitudinal.value=ar==="latitudinal",or&&(ur.poleAxis.value=or);const{_lodMax:Ar}=this;ur.dTheta.value=gr,ur.mipInt.value=Ar-rr;const yr=this._sizeLods[nr],wr=3*yr*(nr>Ar-LOD_MIN?nr-Ar+LOD_MIN:0),br=4*(this._cubeSize-yr);_setViewport(tr,wr,br,3*yr,2*yr),lr.setRenderTarget(tr),lr.render(fr,_flatCamera)}}function _createPlanes(ir){const er=[],tr=[],rr=[];let nr=ir;const sr=ir-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let ar=0;ar<sr;ar++){const or=Math.pow(2,nr);tr.push(or);let lr=1/or;ar>ir-LOD_MIN?lr=EXTRA_LOD_SIGMA[ar-ir+LOD_MIN-1]:ar===0&&(lr=0),rr.push(lr);const cr=1/(or-2),hr=-cr,fr=1+cr,ur=[hr,hr,fr,hr,fr,fr,hr,hr,fr,fr,hr,fr],pr=6,gr=6,_r=3,mr=2,dr=1,vr=new Float32Array(_r*gr*pr),Ar=new Float32Array(mr*gr*pr),yr=new Float32Array(dr*gr*pr);for(let br=0;br<pr;br++){const Sr=br%3*2/3-1,xr=br>2?0:-1,Cr=[Sr,xr,0,Sr+2/3,xr,0,Sr+2/3,xr+1,0,Sr,xr,0,Sr+2/3,xr+1,0,Sr,xr+1,0];vr.set(Cr,_r*gr*br),Ar.set(ur,mr*gr*br);const Ir=[br,br,br,br,br,br];yr.set(Ir,dr*gr*br)}const wr=new BufferGeometry;wr.setAttribute("position",new BufferAttribute(vr,_r)),wr.setAttribute("uv",new BufferAttribute(Ar,mr)),wr.setAttribute("faceIndex",new BufferAttribute(yr,dr)),er.push(wr),nr>LOD_MIN&&nr--}return{lodPlanes:er,sizeLods:tr,sigmas:rr}}function _createRenderTarget(ir,er,tr){const rr=new WebGLRenderTarget(ir,er,tr);return rr.texture.mapping=CubeUVReflectionMapping,rr.texture.name="PMREM.cubeUv",rr.scissorTest=!0,rr}function _setViewport(ir,er,tr,rr,nr){ir.viewport.set(er,tr,rr,nr),ir.scissor.set(er,tr,rr,nr)}function _getBlurShader(ir,er,tr){const rr=new Float32Array(MAX_SAMPLES),nr=new Vector3$1(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/er,CUBEUV_TEXEL_HEIGHT:1/tr,CUBEUV_MAX_MIP:`${ir}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:rr},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:nr}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(ir){let er=new WeakMap,tr=null;function rr(or){if(or&&or.isTexture){const lr=or.mapping,cr=lr===EquirectangularReflectionMapping||lr===EquirectangularRefractionMapping,hr=lr===CubeReflectionMapping||lr===CubeRefractionMapping;if(cr||hr){let fr=er.get(or);const ur=fr!==void 0?fr.texture.pmremVersion:0;if(or.isRenderTargetTexture&&or.pmremVersion!==ur)return tr===null&&(tr=new PMREMGenerator(ir)),fr=cr?tr.fromEquirectangular(or,fr):tr.fromCubemap(or,fr),fr.texture.pmremVersion=or.pmremVersion,er.set(or,fr),fr.texture;if(fr!==void 0)return fr.texture;{const pr=or.image;return cr&&pr&&pr.height>0||hr&&pr&&nr(pr)?(tr===null&&(tr=new PMREMGenerator(ir)),fr=cr?tr.fromEquirectangular(or):tr.fromCubemap(or),fr.texture.pmremVersion=or.pmremVersion,er.set(or,fr),or.addEventListener("dispose",sr),fr.texture):null}}}return or}function nr(or){let lr=0;const cr=6;for(let hr=0;hr<cr;hr++)or[hr]!==void 0&&lr++;return lr===cr}function sr(or){const lr=or.target;lr.removeEventListener("dispose",sr);const cr=er.get(lr);cr!==void 0&&(er.delete(lr),cr.dispose())}function ar(){er=new WeakMap,tr!==null&&(tr.dispose(),tr=null)}return{get:rr,dispose:ar}}function WebGLExtensions(ir){const er={};function tr(rr){if(er[rr]!==void 0)return er[rr];let nr;switch(rr){case"WEBGL_depth_texture":nr=ir.getExtension("WEBGL_depth_texture")||ir.getExtension("MOZ_WEBGL_depth_texture")||ir.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":nr=ir.getExtension("EXT_texture_filter_anisotropic")||ir.getExtension("MOZ_EXT_texture_filter_anisotropic")||ir.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":nr=ir.getExtension("WEBGL_compressed_texture_s3tc")||ir.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||ir.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":nr=ir.getExtension("WEBGL_compressed_texture_pvrtc")||ir.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:nr=ir.getExtension(rr)}return er[rr]=nr,nr}return{has:function(rr){return tr(rr)!==null},init:function(){tr("EXT_color_buffer_float"),tr("WEBGL_clip_cull_distance"),tr("OES_texture_float_linear"),tr("EXT_color_buffer_half_float"),tr("WEBGL_multisampled_render_to_texture"),tr("WEBGL_render_shared_exponent")},get:function(rr){const nr=tr(rr);return nr===null&&warnOnce("THREE.WebGLRenderer: "+rr+" extension not supported."),nr}}}function WebGLGeometries(ir,er,tr,rr){const nr={},sr=new WeakMap;function ar(fr){const ur=fr.target;ur.index!==null&&er.remove(ur.index);for(const gr in ur.attributes)er.remove(ur.attributes[gr]);ur.removeEventListener("dispose",ar),delete nr[ur.id];const pr=sr.get(ur);pr&&(er.remove(pr),sr.delete(ur)),rr.releaseStatesOfGeometry(ur),ur.isInstancedBufferGeometry===!0&&delete ur._maxInstanceCount,tr.memory.geometries--}function or(fr,ur){return nr[ur.id]===!0||(ur.addEventListener("dispose",ar),nr[ur.id]=!0,tr.memory.geometries++),ur}function lr(fr){const ur=fr.attributes;for(const pr in ur)er.update(ur[pr],ir.ARRAY_BUFFER)}function cr(fr){const ur=[],pr=fr.index,gr=fr.attributes.position;let _r=0;if(pr!==null){const vr=pr.array;_r=pr.version;for(let Ar=0,yr=vr.length;Ar<yr;Ar+=3){const wr=vr[Ar+0],br=vr[Ar+1],Sr=vr[Ar+2];ur.push(wr,br,br,Sr,Sr,wr)}}else if(gr!==void 0){const vr=gr.array;_r=gr.version;for(let Ar=0,yr=vr.length/3-1;Ar<yr;Ar+=3){const wr=Ar+0,br=Ar+1,Sr=Ar+2;ur.push(wr,br,br,Sr,Sr,wr)}}else return;const mr=new(arrayNeedsUint32(ur)?Uint32BufferAttribute:Uint16BufferAttribute)(ur,1);mr.version=_r;const dr=sr.get(fr);dr&&er.remove(dr),sr.set(fr,mr)}function hr(fr){const ur=sr.get(fr);if(ur){const pr=fr.index;pr!==null&&ur.version<pr.version&&cr(fr)}else cr(fr);return sr.get(fr)}return{get:or,update:lr,getWireframeAttribute:hr}}function WebGLIndexedBufferRenderer(ir,er,tr){let rr;function nr(ur){rr=ur}let sr,ar;function or(ur){sr=ur.type,ar=ur.bytesPerElement}function lr(ur,pr){ir.drawElements(rr,pr,sr,ur*ar),tr.update(pr,rr,1)}function cr(ur,pr,gr){gr!==0&&(ir.drawElementsInstanced(rr,pr,sr,ur*ar,gr),tr.update(pr,rr,gr))}function hr(ur,pr,gr){if(gr===0)return;er.get("WEBGL_multi_draw").multiDrawElementsWEBGL(rr,pr,0,sr,ur,0,gr);let mr=0;for(let dr=0;dr<gr;dr++)mr+=pr[dr];tr.update(mr,rr,1)}function fr(ur,pr,gr,_r){if(gr===0)return;const mr=er.get("WEBGL_multi_draw");if(mr===null)for(let dr=0;dr<ur.length;dr++)cr(ur[dr]/ar,pr[dr],_r[dr]);else{mr.multiDrawElementsInstancedWEBGL(rr,pr,0,sr,ur,0,_r,0,gr);let dr=0;for(let vr=0;vr<gr;vr++)dr+=pr[vr]*_r[vr];tr.update(dr,rr,1)}}this.setMode=nr,this.setIndex=or,this.render=lr,this.renderInstances=cr,this.renderMultiDraw=hr,this.renderMultiDrawInstances=fr}function WebGLInfo(ir){const er={geometries:0,textures:0},tr={frame:0,calls:0,triangles:0,points:0,lines:0};function rr(sr,ar,or){switch(tr.calls++,ar){case ir.TRIANGLES:tr.triangles+=or*(sr/3);break;case ir.LINES:tr.lines+=or*(sr/2);break;case ir.LINE_STRIP:tr.lines+=or*(sr-1);break;case ir.LINE_LOOP:tr.lines+=or*sr;break;case ir.POINTS:tr.points+=or*sr;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",ar);break}}function nr(){tr.calls=0,tr.triangles=0,tr.points=0,tr.lines=0}return{memory:er,render:tr,programs:null,autoReset:!0,reset:nr,update:rr}}function WebGLMorphtargets(ir,er,tr){const rr=new WeakMap,nr=new Vector4;function sr(ar,or,lr){const cr=ar.morphTargetInfluences,hr=or.morphAttributes.position||or.morphAttributes.normal||or.morphAttributes.color,fr=hr!==void 0?hr.length:0;let ur=rr.get(or);if(ur===void 0||ur.count!==fr){let Cr=function(){Sr.dispose(),rr.delete(or),or.removeEventListener("dispose",Cr)};ur!==void 0&&ur.texture.dispose();const pr=or.morphAttributes.position!==void 0,gr=or.morphAttributes.normal!==void 0,_r=or.morphAttributes.color!==void 0,mr=or.morphAttributes.position||[],dr=or.morphAttributes.normal||[],vr=or.morphAttributes.color||[];let Ar=0;pr===!0&&(Ar=1),gr===!0&&(Ar=2),_r===!0&&(Ar=3);let yr=or.attributes.position.count*Ar,wr=1;yr>er.maxTextureSize&&(wr=Math.ceil(yr/er.maxTextureSize),yr=er.maxTextureSize);const br=new Float32Array(yr*wr*4*fr),Sr=new DataArrayTexture(br,yr,wr,fr);Sr.type=FloatType,Sr.needsUpdate=!0;const xr=Ar*4;for(let Ir=0;Ir<fr;Ir++){const Rr=mr[Ir],Pr=dr[Ir],Fr=vr[Ir],Nr=yr*wr*4*Ir;for(let Ur=0;Ur<Rr.count;Ur++){const Br=Ur*xr;pr===!0&&(nr.fromBufferAttribute(Rr,Ur),br[Nr+Br+0]=nr.x,br[Nr+Br+1]=nr.y,br[Nr+Br+2]=nr.z,br[Nr+Br+3]=0),gr===!0&&(nr.fromBufferAttribute(Pr,Ur),br[Nr+Br+4]=nr.x,br[Nr+Br+5]=nr.y,br[Nr+Br+6]=nr.z,br[Nr+Br+7]=0),_r===!0&&(nr.fromBufferAttribute(Fr,Ur),br[Nr+Br+8]=nr.x,br[Nr+Br+9]=nr.y,br[Nr+Br+10]=nr.z,br[Nr+Br+11]=Fr.itemSize===4?nr.w:1)}}ur={count:fr,texture:Sr,size:new Vector2(yr,wr)},rr.set(or,ur),or.addEventListener("dispose",Cr)}if(ar.isInstancedMesh===!0&&ar.morphTexture!==null)lr.getUniforms().setValue(ir,"morphTexture",ar.morphTexture,tr);else{let pr=0;for(let _r=0;_r<cr.length;_r++)pr+=cr[_r];const gr=or.morphTargetsRelative?1:1-pr;lr.getUniforms().setValue(ir,"morphTargetBaseInfluence",gr),lr.getUniforms().setValue(ir,"morphTargetInfluences",cr)}lr.getUniforms().setValue(ir,"morphTargetsTexture",ur.texture,tr),lr.getUniforms().setValue(ir,"morphTargetsTextureSize",ur.size)}return{update:sr}}function WebGLObjects(ir,er,tr,rr){let nr=new WeakMap;function sr(lr){const cr=rr.render.frame,hr=lr.geometry,fr=er.get(lr,hr);if(nr.get(fr)!==cr&&(er.update(fr),nr.set(fr,cr)),lr.isInstancedMesh&&(lr.hasEventListener("dispose",or)===!1&&lr.addEventListener("dispose",or),nr.get(lr)!==cr&&(tr.update(lr.instanceMatrix,ir.ARRAY_BUFFER),lr.instanceColor!==null&&tr.update(lr.instanceColor,ir.ARRAY_BUFFER),nr.set(lr,cr))),lr.isSkinnedMesh){const ur=lr.skeleton;nr.get(ur)!==cr&&(ur.update(),nr.set(ur,cr))}return fr}function ar(){nr=new WeakMap}function or(lr){const cr=lr.target;cr.removeEventListener("dispose",or),tr.remove(cr.instanceMatrix),cr.instanceColor!==null&&tr.remove(cr.instanceColor)}return{update:sr,dispose:ar}}const emptyTexture=new Texture,emptyShadowTexture=new DepthTexture(1,1),emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(ir,er,tr){const rr=ir[0];if(rr<=0||rr>0)return ir;const nr=er*tr;let sr=arrayCacheF32[nr];if(sr===void 0&&(sr=new Float32Array(nr),arrayCacheF32[nr]=sr),er!==0){rr.toArray(sr,0);for(let ar=1,or=0;ar!==er;++ar)or+=tr,ir[ar].toArray(sr,or)}return sr}function arraysEqual$1(ir,er){if(ir.length!==er.length)return!1;for(let tr=0,rr=ir.length;tr<rr;tr++)if(ir[tr]!==er[tr])return!1;return!0}function copyArray(ir,er){for(let tr=0,rr=er.length;tr<rr;tr++)ir[tr]=er[tr]}function allocTexUnits(ir,er){let tr=arrayCacheI32[er];tr===void 0&&(tr=new Int32Array(er),arrayCacheI32[er]=tr);for(let rr=0;rr!==er;++rr)tr[rr]=ir.allocateTextureUnit();return tr}function setValueV1f(ir,er){const tr=this.cache;tr[0]!==er&&(ir.uniform1f(this.addr,er),tr[0]=er)}function setValueV2f(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y)&&(ir.uniform2f(this.addr,er.x,er.y),tr[0]=er.x,tr[1]=er.y);else{if(arraysEqual$1(tr,er))return;ir.uniform2fv(this.addr,er),copyArray(tr,er)}}function setValueV3f(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z)&&(ir.uniform3f(this.addr,er.x,er.y,er.z),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z);else if(er.r!==void 0)(tr[0]!==er.r||tr[1]!==er.g||tr[2]!==er.b)&&(ir.uniform3f(this.addr,er.r,er.g,er.b),tr[0]=er.r,tr[1]=er.g,tr[2]=er.b);else{if(arraysEqual$1(tr,er))return;ir.uniform3fv(this.addr,er),copyArray(tr,er)}}function setValueV4f(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z||tr[3]!==er.w)&&(ir.uniform4f(this.addr,er.x,er.y,er.z,er.w),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z,tr[3]=er.w);else{if(arraysEqual$1(tr,er))return;ir.uniform4fv(this.addr,er),copyArray(tr,er)}}function setValueM2(ir,er){const tr=this.cache,rr=er.elements;if(rr===void 0){if(arraysEqual$1(tr,er))return;ir.uniformMatrix2fv(this.addr,!1,er),copyArray(tr,er)}else{if(arraysEqual$1(tr,rr))return;mat2array.set(rr),ir.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(tr,rr)}}function setValueM3(ir,er){const tr=this.cache,rr=er.elements;if(rr===void 0){if(arraysEqual$1(tr,er))return;ir.uniformMatrix3fv(this.addr,!1,er),copyArray(tr,er)}else{if(arraysEqual$1(tr,rr))return;mat3array.set(rr),ir.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(tr,rr)}}function setValueM4(ir,er){const tr=this.cache,rr=er.elements;if(rr===void 0){if(arraysEqual$1(tr,er))return;ir.uniformMatrix4fv(this.addr,!1,er),copyArray(tr,er)}else{if(arraysEqual$1(tr,rr))return;mat4array.set(rr),ir.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(tr,rr)}}function setValueV1i(ir,er){const tr=this.cache;tr[0]!==er&&(ir.uniform1i(this.addr,er),tr[0]=er)}function setValueV2i(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y)&&(ir.uniform2i(this.addr,er.x,er.y),tr[0]=er.x,tr[1]=er.y);else{if(arraysEqual$1(tr,er))return;ir.uniform2iv(this.addr,er),copyArray(tr,er)}}function setValueV3i(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z)&&(ir.uniform3i(this.addr,er.x,er.y,er.z),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z);else{if(arraysEqual$1(tr,er))return;ir.uniform3iv(this.addr,er),copyArray(tr,er)}}function setValueV4i(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z||tr[3]!==er.w)&&(ir.uniform4i(this.addr,er.x,er.y,er.z,er.w),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z,tr[3]=er.w);else{if(arraysEqual$1(tr,er))return;ir.uniform4iv(this.addr,er),copyArray(tr,er)}}function setValueV1ui(ir,er){const tr=this.cache;tr[0]!==er&&(ir.uniform1ui(this.addr,er),tr[0]=er)}function setValueV2ui(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y)&&(ir.uniform2ui(this.addr,er.x,er.y),tr[0]=er.x,tr[1]=er.y);else{if(arraysEqual$1(tr,er))return;ir.uniform2uiv(this.addr,er),copyArray(tr,er)}}function setValueV3ui(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z)&&(ir.uniform3ui(this.addr,er.x,er.y,er.z),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z);else{if(arraysEqual$1(tr,er))return;ir.uniform3uiv(this.addr,er),copyArray(tr,er)}}function setValueV4ui(ir,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z||tr[3]!==er.w)&&(ir.uniform4ui(this.addr,er.x,er.y,er.z,er.w),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z,tr[3]=er.w);else{if(arraysEqual$1(tr,er))return;ir.uniform4uiv(this.addr,er),copyArray(tr,er)}}function setValueT1(ir,er,tr){const rr=this.cache,nr=tr.allocateTextureUnit();rr[0]!==nr&&(ir.uniform1i(this.addr,nr),rr[0]=nr);let sr;this.type===ir.SAMPLER_2D_SHADOW?(emptyShadowTexture.compareFunction=LessEqualCompare,sr=emptyShadowTexture):sr=emptyTexture,tr.setTexture2D(er||sr,nr)}function setValueT3D1(ir,er,tr){const rr=this.cache,nr=tr.allocateTextureUnit();rr[0]!==nr&&(ir.uniform1i(this.addr,nr),rr[0]=nr),tr.setTexture3D(er||empty3dTexture,nr)}function setValueT6(ir,er,tr){const rr=this.cache,nr=tr.allocateTextureUnit();rr[0]!==nr&&(ir.uniform1i(this.addr,nr),rr[0]=nr),tr.setTextureCube(er||emptyCubeTexture,nr)}function setValueT2DArray1(ir,er,tr){const rr=this.cache,nr=tr.allocateTextureUnit();rr[0]!==nr&&(ir.uniform1i(this.addr,nr),rr[0]=nr),tr.setTexture2DArray(er||emptyArrayTexture,nr)}function getSingularSetter(ir){switch(ir){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(ir,er){ir.uniform1fv(this.addr,er)}function setValueV2fArray(ir,er){const tr=flatten(er,this.size,2);ir.uniform2fv(this.addr,tr)}function setValueV3fArray(ir,er){const tr=flatten(er,this.size,3);ir.uniform3fv(this.addr,tr)}function setValueV4fArray(ir,er){const tr=flatten(er,this.size,4);ir.uniform4fv(this.addr,tr)}function setValueM2Array(ir,er){const tr=flatten(er,this.size,4);ir.uniformMatrix2fv(this.addr,!1,tr)}function setValueM3Array(ir,er){const tr=flatten(er,this.size,9);ir.uniformMatrix3fv(this.addr,!1,tr)}function setValueM4Array(ir,er){const tr=flatten(er,this.size,16);ir.uniformMatrix4fv(this.addr,!1,tr)}function setValueV1iArray(ir,er){ir.uniform1iv(this.addr,er)}function setValueV2iArray(ir,er){ir.uniform2iv(this.addr,er)}function setValueV3iArray(ir,er){ir.uniform3iv(this.addr,er)}function setValueV4iArray(ir,er){ir.uniform4iv(this.addr,er)}function setValueV1uiArray(ir,er){ir.uniform1uiv(this.addr,er)}function setValueV2uiArray(ir,er){ir.uniform2uiv(this.addr,er)}function setValueV3uiArray(ir,er){ir.uniform3uiv(this.addr,er)}function setValueV4uiArray(ir,er){ir.uniform4uiv(this.addr,er)}function setValueT1Array(ir,er,tr){const rr=this.cache,nr=er.length,sr=allocTexUnits(tr,nr);arraysEqual$1(rr,sr)||(ir.uniform1iv(this.addr,sr),copyArray(rr,sr));for(let ar=0;ar!==nr;++ar)tr.setTexture2D(er[ar]||emptyTexture,sr[ar])}function setValueT3DArray(ir,er,tr){const rr=this.cache,nr=er.length,sr=allocTexUnits(tr,nr);arraysEqual$1(rr,sr)||(ir.uniform1iv(this.addr,sr),copyArray(rr,sr));for(let ar=0;ar!==nr;++ar)tr.setTexture3D(er[ar]||empty3dTexture,sr[ar])}function setValueT6Array(ir,er,tr){const rr=this.cache,nr=er.length,sr=allocTexUnits(tr,nr);arraysEqual$1(rr,sr)||(ir.uniform1iv(this.addr,sr),copyArray(rr,sr));for(let ar=0;ar!==nr;++ar)tr.setTextureCube(er[ar]||emptyCubeTexture,sr[ar])}function setValueT2DArrayArray(ir,er,tr){const rr=this.cache,nr=er.length,sr=allocTexUnits(tr,nr);arraysEqual$1(rr,sr)||(ir.uniform1iv(this.addr,sr),copyArray(rr,sr));for(let ar=0;ar!==nr;++ar)tr.setTexture2DArray(er[ar]||emptyArrayTexture,sr[ar])}function getPureArraySetter(ir){switch(ir){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(er,tr,rr){this.id=er,this.addr=rr,this.cache=[],this.type=tr.type,this.setValue=getSingularSetter(tr.type)}}class PureArrayUniform{constructor(er,tr,rr){this.id=er,this.addr=rr,this.cache=[],this.type=tr.type,this.size=tr.size,this.setValue=getPureArraySetter(tr.type)}}class StructuredUniform{constructor(er){this.id=er,this.seq=[],this.map={}}setValue(er,tr,rr){const nr=this.seq;for(let sr=0,ar=nr.length;sr!==ar;++sr){const or=nr[sr];or.setValue(er,tr[or.id],rr)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(ir,er){ir.seq.push(er),ir.map[er.id]=er}function parseUniform(ir,er,tr){const rr=ir.name,nr=rr.length;for(RePathPart.lastIndex=0;;){const sr=RePathPart.exec(rr),ar=RePathPart.lastIndex;let or=sr[1];const lr=sr[2]==="]",cr=sr[3];if(lr&&(or=or|0),cr===void 0||cr==="["&&ar+2===nr){addUniform(tr,cr===void 0?new SingleUniform(or,ir,er):new PureArrayUniform(or,ir,er));break}else{let fr=tr.map[or];fr===void 0&&(fr=new StructuredUniform(or),addUniform(tr,fr)),tr=fr}}}class WebGLUniforms{constructor(er,tr){this.seq=[],this.map={};const rr=er.getProgramParameter(tr,er.ACTIVE_UNIFORMS);for(let nr=0;nr<rr;++nr){const sr=er.getActiveUniform(tr,nr),ar=er.getUniformLocation(tr,sr.name);parseUniform(sr,ar,this)}}setValue(er,tr,rr,nr){const sr=this.map[tr];sr!==void 0&&sr.setValue(er,rr,nr)}setOptional(er,tr,rr){const nr=tr[rr];nr!==void 0&&this.setValue(er,rr,nr)}static upload(er,tr,rr,nr){for(let sr=0,ar=tr.length;sr!==ar;++sr){const or=tr[sr],lr=rr[or.id];lr.needsUpdate!==!1&&or.setValue(er,lr.value,nr)}}static seqWithValue(er,tr){const rr=[];for(let nr=0,sr=er.length;nr!==sr;++nr){const ar=er[nr];ar.id in tr&&rr.push(ar)}return rr}}function WebGLShader(ir,er,tr){const rr=ir.createShader(er);return ir.shaderSource(rr,tr),ir.compileShader(rr),rr}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(ir,er){const tr=ir.split(`
`),rr=[],nr=Math.max(er-6,0),sr=Math.min(er+6,tr.length);for(let ar=nr;ar<sr;ar++){const or=ar+1;rr.push(`${or===er?">":" "} ${or}: ${tr[ar]}`)}return rr.join(`
`)}const _m0=new Matrix3;function getEncodingComponents(ir){ColorManagement._getMatrix(_m0,ColorManagement.workingColorSpace,ir);const er=`mat3( ${_m0.elements.map(tr=>tr.toFixed(4))} )`;switch(ColorManagement.getTransfer(ir)){case LinearTransfer:return[er,"LinearTransferOETF"];case SRGBTransfer:return[er,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",ir),[er,"LinearTransferOETF"]}}function getShaderErrors(ir,er,tr){const rr=ir.getShaderParameter(er,ir.COMPILE_STATUS),nr=ir.getShaderInfoLog(er).trim();if(rr&&nr==="")return"";const sr=/ERROR: 0:(\d+)/.exec(nr);if(sr){const ar=parseInt(sr[1]);return tr.toUpperCase()+`

`+nr+`

`+handleSource(ir.getShaderSource(er),ar)}else return nr}function getTexelEncodingFunction(ir,er){const tr=getEncodingComponents(er);return[`vec4 ${ir}( vec4 value ) {`,`	return ${tr[1]}( vec4( value.rgb * ${tr[0]}, value.a ) );`,"}"].join(`
`)}function getToneMappingFunction(ir,er){let tr;switch(er){case LinearToneMapping:tr="Linear";break;case ReinhardToneMapping:tr="Reinhard";break;case CineonToneMapping:tr="Cineon";break;case ACESFilmicToneMapping:tr="ACESFilmic";break;case AgXToneMapping:tr="AgX";break;case NeutralToneMapping:tr="Neutral";break;case CustomToneMapping:tr="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",er),tr="Linear"}return"vec3 "+ir+"( vec3 color ) { return "+tr+"ToneMapping( color ); }"}const _v0=new Vector3$1;function getLuminanceFunction(){ColorManagement.getLuminanceCoefficients(_v0);const ir=_v0.x.toFixed(4),er=_v0.y.toFixed(4),tr=_v0.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${ir}, ${er}, ${tr} );`,"	return dot( weights, rgb );","}"].join(`
`)}function generateVertexExtensions(ir){return[ir.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",ir.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(filterEmptyLine).join(`
`)}function generateDefines(ir){const er=[];for(const tr in ir){const rr=ir[tr];rr!==!1&&er.push("#define "+tr+" "+rr)}return er.join(`
`)}function fetchAttributeLocations(ir,er){const tr={},rr=ir.getProgramParameter(er,ir.ACTIVE_ATTRIBUTES);for(let nr=0;nr<rr;nr++){const sr=ir.getActiveAttrib(er,nr),ar=sr.name;let or=1;sr.type===ir.FLOAT_MAT2&&(or=2),sr.type===ir.FLOAT_MAT3&&(or=3),sr.type===ir.FLOAT_MAT4&&(or=4),tr[ar]={type:sr.type,location:ir.getAttribLocation(er,ar),locationSize:or}}return tr}function filterEmptyLine(ir){return ir!==""}function replaceLightNums(ir,er){const tr=er.numSpotLightShadows+er.numSpotLightMaps-er.numSpotLightShadowsWithMaps;return ir.replace(/NUM_DIR_LIGHTS/g,er.numDirLights).replace(/NUM_SPOT_LIGHTS/g,er.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,er.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,tr).replace(/NUM_RECT_AREA_LIGHTS/g,er.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,er.numPointLights).replace(/NUM_HEMI_LIGHTS/g,er.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,er.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,er.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,er.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,er.numPointLightShadows)}function replaceClippingPlaneNums(ir,er){return ir.replace(/NUM_CLIPPING_PLANES/g,er.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,er.numClippingPlanes-er.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(ir){return ir.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map;function includeReplacer(ir,er){let tr=ShaderChunk[er];if(tr===void 0){const rr=shaderChunkMap.get(er);if(rr!==void 0)tr=ShaderChunk[rr],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',er,rr);else throw new Error("Can not resolve #include <"+er+">")}return resolveIncludes(tr)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(ir){return ir.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(ir,er,tr,rr){let nr="";for(let sr=parseInt(er);sr<parseInt(tr);sr++)nr+=rr.replace(/\[\s*i\s*\]/g,"[ "+sr+" ]").replace(/UNROLLED_LOOP_INDEX/g,sr);return nr}function generatePrecision(ir){let er=`precision ${ir.precision} float;
	precision ${ir.precision} int;
	precision ${ir.precision} sampler2D;
	precision ${ir.precision} samplerCube;
	precision ${ir.precision} sampler3D;
	precision ${ir.precision} sampler2DArray;
	precision ${ir.precision} sampler2DShadow;
	precision ${ir.precision} samplerCubeShadow;
	precision ${ir.precision} sampler2DArrayShadow;
	precision ${ir.precision} isampler2D;
	precision ${ir.precision} isampler3D;
	precision ${ir.precision} isamplerCube;
	precision ${ir.precision} isampler2DArray;
	precision ${ir.precision} usampler2D;
	precision ${ir.precision} usampler3D;
	precision ${ir.precision} usamplerCube;
	precision ${ir.precision} usampler2DArray;
	`;return ir.precision==="highp"?er+=`
#define HIGH_PRECISION`:ir.precision==="mediump"?er+=`
#define MEDIUM_PRECISION`:ir.precision==="lowp"&&(er+=`
#define LOW_PRECISION`),er}function generateShadowMapTypeDefine(ir){let er="SHADOWMAP_TYPE_BASIC";return ir.shadowMapType===PCFShadowMap?er="SHADOWMAP_TYPE_PCF":ir.shadowMapType===PCFSoftShadowMap?er="SHADOWMAP_TYPE_PCF_SOFT":ir.shadowMapType===VSMShadowMap&&(er="SHADOWMAP_TYPE_VSM"),er}function generateEnvMapTypeDefine(ir){let er="ENVMAP_TYPE_CUBE";if(ir.envMap)switch(ir.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:er="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:er="ENVMAP_TYPE_CUBE_UV";break}return er}function generateEnvMapModeDefine(ir){let er="ENVMAP_MODE_REFLECTION";if(ir.envMap)switch(ir.envMapMode){case CubeRefractionMapping:er="ENVMAP_MODE_REFRACTION";break}return er}function generateEnvMapBlendingDefine(ir){let er="ENVMAP_BLENDING_NONE";if(ir.envMap)switch(ir.combine){case MultiplyOperation:er="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:er="ENVMAP_BLENDING_MIX";break;case AddOperation:er="ENVMAP_BLENDING_ADD";break}return er}function generateCubeUVSize(ir){const er=ir.envMapCubeUVHeight;if(er===null)return null;const tr=Math.log2(er)-2,rr=1/er;return{texelWidth:1/(3*Math.max(Math.pow(2,tr),7*16)),texelHeight:rr,maxMip:tr}}function WebGLProgram(ir,er,tr,rr){const nr=ir.getContext(),sr=tr.defines;let ar=tr.vertexShader,or=tr.fragmentShader;const lr=generateShadowMapTypeDefine(tr),cr=generateEnvMapTypeDefine(tr),hr=generateEnvMapModeDefine(tr),fr=generateEnvMapBlendingDefine(tr),ur=generateCubeUVSize(tr),pr=generateVertexExtensions(tr),gr=generateDefines(sr),_r=nr.createProgram();let mr,dr,vr=tr.glslVersion?"#version "+tr.glslVersion+`
`:"";tr.isRawShaderMaterial?(mr=["#define SHADER_TYPE "+tr.shaderType,"#define SHADER_NAME "+tr.shaderName,gr].filter(filterEmptyLine).join(`
`),mr.length>0&&(mr+=`
`),dr=["#define SHADER_TYPE "+tr.shaderType,"#define SHADER_NAME "+tr.shaderName,gr].filter(filterEmptyLine).join(`
`),dr.length>0&&(dr+=`
`)):(mr=[generatePrecision(tr),"#define SHADER_TYPE "+tr.shaderType,"#define SHADER_NAME "+tr.shaderName,gr,tr.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",tr.batching?"#define USE_BATCHING":"",tr.batchingColor?"#define USE_BATCHING_COLOR":"",tr.instancing?"#define USE_INSTANCING":"",tr.instancingColor?"#define USE_INSTANCING_COLOR":"",tr.instancingMorph?"#define USE_INSTANCING_MORPH":"",tr.useFog&&tr.fog?"#define USE_FOG":"",tr.useFog&&tr.fogExp2?"#define FOG_EXP2":"",tr.map?"#define USE_MAP":"",tr.envMap?"#define USE_ENVMAP":"",tr.envMap?"#define "+hr:"",tr.lightMap?"#define USE_LIGHTMAP":"",tr.aoMap?"#define USE_AOMAP":"",tr.bumpMap?"#define USE_BUMPMAP":"",tr.normalMap?"#define USE_NORMALMAP":"",tr.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",tr.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",tr.displacementMap?"#define USE_DISPLACEMENTMAP":"",tr.emissiveMap?"#define USE_EMISSIVEMAP":"",tr.anisotropy?"#define USE_ANISOTROPY":"",tr.anisotropyMap?"#define USE_ANISOTROPYMAP":"",tr.clearcoatMap?"#define USE_CLEARCOATMAP":"",tr.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",tr.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",tr.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",tr.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",tr.specularMap?"#define USE_SPECULARMAP":"",tr.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",tr.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",tr.roughnessMap?"#define USE_ROUGHNESSMAP":"",tr.metalnessMap?"#define USE_METALNESSMAP":"",tr.alphaMap?"#define USE_ALPHAMAP":"",tr.alphaHash?"#define USE_ALPHAHASH":"",tr.transmission?"#define USE_TRANSMISSION":"",tr.transmissionMap?"#define USE_TRANSMISSIONMAP":"",tr.thicknessMap?"#define USE_THICKNESSMAP":"",tr.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",tr.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",tr.mapUv?"#define MAP_UV "+tr.mapUv:"",tr.alphaMapUv?"#define ALPHAMAP_UV "+tr.alphaMapUv:"",tr.lightMapUv?"#define LIGHTMAP_UV "+tr.lightMapUv:"",tr.aoMapUv?"#define AOMAP_UV "+tr.aoMapUv:"",tr.emissiveMapUv?"#define EMISSIVEMAP_UV "+tr.emissiveMapUv:"",tr.bumpMapUv?"#define BUMPMAP_UV "+tr.bumpMapUv:"",tr.normalMapUv?"#define NORMALMAP_UV "+tr.normalMapUv:"",tr.displacementMapUv?"#define DISPLACEMENTMAP_UV "+tr.displacementMapUv:"",tr.metalnessMapUv?"#define METALNESSMAP_UV "+tr.metalnessMapUv:"",tr.roughnessMapUv?"#define ROUGHNESSMAP_UV "+tr.roughnessMapUv:"",tr.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+tr.anisotropyMapUv:"",tr.clearcoatMapUv?"#define CLEARCOATMAP_UV "+tr.clearcoatMapUv:"",tr.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+tr.clearcoatNormalMapUv:"",tr.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+tr.clearcoatRoughnessMapUv:"",tr.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+tr.iridescenceMapUv:"",tr.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+tr.iridescenceThicknessMapUv:"",tr.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+tr.sheenColorMapUv:"",tr.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+tr.sheenRoughnessMapUv:"",tr.specularMapUv?"#define SPECULARMAP_UV "+tr.specularMapUv:"",tr.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+tr.specularColorMapUv:"",tr.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+tr.specularIntensityMapUv:"",tr.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+tr.transmissionMapUv:"",tr.thicknessMapUv?"#define THICKNESSMAP_UV "+tr.thicknessMapUv:"",tr.vertexTangents&&tr.flatShading===!1?"#define USE_TANGENT":"",tr.vertexColors?"#define USE_COLOR":"",tr.vertexAlphas?"#define USE_COLOR_ALPHA":"",tr.vertexUv1s?"#define USE_UV1":"",tr.vertexUv2s?"#define USE_UV2":"",tr.vertexUv3s?"#define USE_UV3":"",tr.pointsUvs?"#define USE_POINTS_UV":"",tr.flatShading?"#define FLAT_SHADED":"",tr.skinning?"#define USE_SKINNING":"",tr.morphTargets?"#define USE_MORPHTARGETS":"",tr.morphNormals&&tr.flatShading===!1?"#define USE_MORPHNORMALS":"",tr.morphColors?"#define USE_MORPHCOLORS":"",tr.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+tr.morphTextureStride:"",tr.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+tr.morphTargetsCount:"",tr.doubleSided?"#define DOUBLE_SIDED":"",tr.flipSided?"#define FLIP_SIDED":"",tr.shadowMapEnabled?"#define USE_SHADOWMAP":"",tr.shadowMapEnabled?"#define "+lr:"",tr.sizeAttenuation?"#define USE_SIZEATTENUATION":"",tr.numLightProbes>0?"#define USE_LIGHT_PROBES":"",tr.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",tr.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),dr=[generatePrecision(tr),"#define SHADER_TYPE "+tr.shaderType,"#define SHADER_NAME "+tr.shaderName,gr,tr.useFog&&tr.fog?"#define USE_FOG":"",tr.useFog&&tr.fogExp2?"#define FOG_EXP2":"",tr.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",tr.map?"#define USE_MAP":"",tr.matcap?"#define USE_MATCAP":"",tr.envMap?"#define USE_ENVMAP":"",tr.envMap?"#define "+cr:"",tr.envMap?"#define "+hr:"",tr.envMap?"#define "+fr:"",ur?"#define CUBEUV_TEXEL_WIDTH "+ur.texelWidth:"",ur?"#define CUBEUV_TEXEL_HEIGHT "+ur.texelHeight:"",ur?"#define CUBEUV_MAX_MIP "+ur.maxMip+".0":"",tr.lightMap?"#define USE_LIGHTMAP":"",tr.aoMap?"#define USE_AOMAP":"",tr.bumpMap?"#define USE_BUMPMAP":"",tr.normalMap?"#define USE_NORMALMAP":"",tr.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",tr.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",tr.emissiveMap?"#define USE_EMISSIVEMAP":"",tr.anisotropy?"#define USE_ANISOTROPY":"",tr.anisotropyMap?"#define USE_ANISOTROPYMAP":"",tr.clearcoat?"#define USE_CLEARCOAT":"",tr.clearcoatMap?"#define USE_CLEARCOATMAP":"",tr.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",tr.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",tr.dispersion?"#define USE_DISPERSION":"",tr.iridescence?"#define USE_IRIDESCENCE":"",tr.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",tr.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",tr.specularMap?"#define USE_SPECULARMAP":"",tr.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",tr.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",tr.roughnessMap?"#define USE_ROUGHNESSMAP":"",tr.metalnessMap?"#define USE_METALNESSMAP":"",tr.alphaMap?"#define USE_ALPHAMAP":"",tr.alphaTest?"#define USE_ALPHATEST":"",tr.alphaHash?"#define USE_ALPHAHASH":"",tr.sheen?"#define USE_SHEEN":"",tr.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",tr.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",tr.transmission?"#define USE_TRANSMISSION":"",tr.transmissionMap?"#define USE_TRANSMISSIONMAP":"",tr.thicknessMap?"#define USE_THICKNESSMAP":"",tr.vertexTangents&&tr.flatShading===!1?"#define USE_TANGENT":"",tr.vertexColors||tr.instancingColor||tr.batchingColor?"#define USE_COLOR":"",tr.vertexAlphas?"#define USE_COLOR_ALPHA":"",tr.vertexUv1s?"#define USE_UV1":"",tr.vertexUv2s?"#define USE_UV2":"",tr.vertexUv3s?"#define USE_UV3":"",tr.pointsUvs?"#define USE_POINTS_UV":"",tr.gradientMap?"#define USE_GRADIENTMAP":"",tr.flatShading?"#define FLAT_SHADED":"",tr.doubleSided?"#define DOUBLE_SIDED":"",tr.flipSided?"#define FLIP_SIDED":"",tr.shadowMapEnabled?"#define USE_SHADOWMAP":"",tr.shadowMapEnabled?"#define "+lr:"",tr.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",tr.numLightProbes>0?"#define USE_LIGHT_PROBES":"",tr.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",tr.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",tr.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",tr.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",tr.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",tr.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",tr.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",tr.toneMapping):"",tr.dithering?"#define DITHERING":"",tr.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",tr.outputColorSpace),getLuminanceFunction(),tr.useDepthPacking?"#define DEPTH_PACKING "+tr.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),ar=resolveIncludes(ar),ar=replaceLightNums(ar,tr),ar=replaceClippingPlaneNums(ar,tr),or=resolveIncludes(or),or=replaceLightNums(or,tr),or=replaceClippingPlaneNums(or,tr),ar=unrollLoops(ar),or=unrollLoops(or),tr.isRawShaderMaterial!==!0&&(vr=`#version 300 es
`,mr=[pr,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+mr,dr=["#define varying in",tr.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",tr.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+dr);const Ar=vr+mr+ar,yr=vr+dr+or,wr=WebGLShader(nr,nr.VERTEX_SHADER,Ar),br=WebGLShader(nr,nr.FRAGMENT_SHADER,yr);nr.attachShader(_r,wr),nr.attachShader(_r,br),tr.index0AttributeName!==void 0?nr.bindAttribLocation(_r,0,tr.index0AttributeName):tr.morphTargets===!0&&nr.bindAttribLocation(_r,0,"position"),nr.linkProgram(_r);function Sr(Rr){if(ir.debug.checkShaderErrors){const Pr=nr.getProgramInfoLog(_r).trim(),Fr=nr.getShaderInfoLog(wr).trim(),Nr=nr.getShaderInfoLog(br).trim();let Ur=!0,Br=!0;if(nr.getProgramParameter(_r,nr.LINK_STATUS)===!1)if(Ur=!1,typeof ir.debug.onShaderError=="function")ir.debug.onShaderError(nr,_r,wr,br);else{const Or=getShaderErrors(nr,wr,"vertex"),Dr=getShaderErrors(nr,br,"fragment");console.error("THREE.WebGLProgram: Shader Error "+nr.getError()+" - VALIDATE_STATUS "+nr.getProgramParameter(_r,nr.VALIDATE_STATUS)+`

Material Name: `+Rr.name+`
Material Type: `+Rr.type+`

Program Info Log: `+Pr+`
`+Or+`
`+Dr)}else Pr!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Pr):(Fr===""||Nr==="")&&(Br=!1);Br&&(Rr.diagnostics={runnable:Ur,programLog:Pr,vertexShader:{log:Fr,prefix:mr},fragmentShader:{log:Nr,prefix:dr}})}nr.deleteShader(wr),nr.deleteShader(br),xr=new WebGLUniforms(nr,_r),Cr=fetchAttributeLocations(nr,_r)}let xr;this.getUniforms=function(){return xr===void 0&&Sr(this),xr};let Cr;this.getAttributes=function(){return Cr===void 0&&Sr(this),Cr};let Ir=tr.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Ir===!1&&(Ir=nr.getProgramParameter(_r,COMPLETION_STATUS_KHR)),Ir},this.destroy=function(){rr.releaseStatesOfProgram(this),nr.deleteProgram(_r),this.program=void 0},this.type=tr.shaderType,this.name=tr.shaderName,this.id=programIdCount++,this.cacheKey=er,this.usedTimes=1,this.program=_r,this.vertexShader=wr,this.fragmentShader=br,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(er){const tr=er.vertexShader,rr=er.fragmentShader,nr=this._getShaderStage(tr),sr=this._getShaderStage(rr),ar=this._getShaderCacheForMaterial(er);return ar.has(nr)===!1&&(ar.add(nr),nr.usedTimes++),ar.has(sr)===!1&&(ar.add(sr),sr.usedTimes++),this}remove(er){const tr=this.materialCache.get(er);for(const rr of tr)rr.usedTimes--,rr.usedTimes===0&&this.shaderCache.delete(rr.code);return this.materialCache.delete(er),this}getVertexShaderID(er){return this._getShaderStage(er.vertexShader).id}getFragmentShaderID(er){return this._getShaderStage(er.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(er){const tr=this.materialCache;let rr=tr.get(er);return rr===void 0&&(rr=new Set,tr.set(er,rr)),rr}_getShaderStage(er){const tr=this.shaderCache;let rr=tr.get(er);return rr===void 0&&(rr=new WebGLShaderStage(er),tr.set(er,rr)),rr}}class WebGLShaderStage{constructor(er){this.id=_id++,this.code=er,this.usedTimes=0}}function WebGLPrograms(ir,er,tr,rr,nr,sr,ar){const or=new Layers,lr=new WebGLShaderCache,cr=new Set,hr=[],fr=nr.logarithmicDepthBuffer,ur=nr.vertexTextures;let pr=nr.precision;const gr={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _r(Cr){return cr.add(Cr),Cr===0?"uv":`uv${Cr}`}function mr(Cr,Ir,Rr,Pr,Fr){const Nr=Pr.fog,Ur=Fr.geometry,Br=Cr.isMeshStandardMaterial?Pr.environment:null,Or=(Cr.isMeshStandardMaterial?tr:er).get(Cr.envMap||Br),Dr=Or&&Or.mapping===CubeUVReflectionMapping?Or.image.height:null,Wr=gr[Cr.type];Cr.precision!==null&&(pr=nr.getMaxPrecision(Cr.precision),pr!==Cr.precision&&console.warn("THREE.WebGLProgram.getParameters:",Cr.precision,"not supported, using",pr,"instead."));const $r=Ur.morphAttributes.position||Ur.morphAttributes.normal||Ur.morphAttributes.color,Yr=$r!==void 0?$r.length:0;let Qi=0;Ur.morphAttributes.position!==void 0&&(Qi=1),Ur.morphAttributes.normal!==void 0&&(Qi=2),Ur.morphAttributes.color!==void 0&&(Qi=3);let rs,Kr,Qr,Vr;if(Wr){const $s=ShaderLib[Wr];rs=$s.vertexShader,Kr=$s.fragmentShader}else rs=Cr.vertexShader,Kr=Cr.fragmentShader,lr.update(Cr),Qr=lr.getVertexShaderID(Cr),Vr=lr.getFragmentShaderID(Cr);const Gr=ir.getRenderTarget(),qr=ir.state.buffers.depth.getReversed(),ji=Fr.isInstancedMesh===!0,Zr=Fr.isBatchedMesh===!0,Zi=!!Cr.map,Yi=!!Cr.matcap,qi=!!Or,Xr=!!Cr.aoMap,ns=!!Cr.lightMap,os=!!Cr.bumpMap,us=!!Cr.normalMap,is=!!Cr.displacementMap,Ji=!!Cr.emissiveMap,ms=!!Cr.metalnessMap,Ki=!!Cr.roughnessMap,Ni=Cr.anisotropy>0,Ri=Cr.clearcoat>0,Jr=Cr.dispersion>0,Xi=Cr.iridescence>0,ss=Cr.sheen>0,ls=Cr.transmission>0,gs=Ni&&!!Cr.anisotropyMap,_s=Ri&&!!Cr.clearcoatMap,vs=Ri&&!!Cr.clearcoatNormalMap,As=Ri&&!!Cr.clearcoatRoughnessMap,Ss=Xi&&!!Cr.iridescenceMap,Is=Xi&&!!Cr.iridescenceThicknessMap,Fs=ss&&!!Cr.sheenColorMap,Ns=ss&&!!Cr.sheenRoughnessMap,Ws=!!Cr.specularMap,ks=!!Cr.specularColorMap,Vs=!!Cr.specularIntensityMap,bs=ls&&!!Cr.transmissionMap,Ms=ls&&!!Cr.thicknessMap,Cs=!!Cr.gradientMap,Ps=!!Cr.alphaMap,Qs=Cr.alphaTest>0,Hs=!!Cr.alphaHash,ta=!!Cr.extensions;let Sa=NoToneMapping;Cr.toneMapped&&(Gr===null||Gr.isXRRenderTarget===!0)&&(Sa=ir.toneMapping);const ga={shaderID:Wr,shaderType:Cr.type,shaderName:Cr.name,vertexShader:rs,fragmentShader:Kr,defines:Cr.defines,customVertexShaderID:Qr,customFragmentShaderID:Vr,isRawShaderMaterial:Cr.isRawShaderMaterial===!0,glslVersion:Cr.glslVersion,precision:pr,batching:Zr,batchingColor:Zr&&Fr._colorsTexture!==null,instancing:ji,instancingColor:ji&&Fr.instanceColor!==null,instancingMorph:ji&&Fr.morphTexture!==null,supportsVertexTextures:ur,outputColorSpace:Gr===null?ir.outputColorSpace:Gr.isXRRenderTarget===!0?Gr.texture.colorSpace:LinearSRGBColorSpace,alphaToCoverage:!!Cr.alphaToCoverage,map:Zi,matcap:Yi,envMap:qi,envMapMode:qi&&Or.mapping,envMapCubeUVHeight:Dr,aoMap:Xr,lightMap:ns,bumpMap:os,normalMap:us,displacementMap:ur&&is,emissiveMap:Ji,normalMapObjectSpace:us&&Cr.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:us&&Cr.normalMapType===TangentSpaceNormalMap,metalnessMap:ms,roughnessMap:Ki,anisotropy:Ni,anisotropyMap:gs,clearcoat:Ri,clearcoatMap:_s,clearcoatNormalMap:vs,clearcoatRoughnessMap:As,dispersion:Jr,iridescence:Xi,iridescenceMap:Ss,iridescenceThicknessMap:Is,sheen:ss,sheenColorMap:Fs,sheenRoughnessMap:Ns,specularMap:Ws,specularColorMap:ks,specularIntensityMap:Vs,transmission:ls,transmissionMap:bs,thicknessMap:Ms,gradientMap:Cs,opaque:Cr.transparent===!1&&Cr.blending===NormalBlending&&Cr.alphaToCoverage===!1,alphaMap:Ps,alphaTest:Qs,alphaHash:Hs,combine:Cr.combine,mapUv:Zi&&_r(Cr.map.channel),aoMapUv:Xr&&_r(Cr.aoMap.channel),lightMapUv:ns&&_r(Cr.lightMap.channel),bumpMapUv:os&&_r(Cr.bumpMap.channel),normalMapUv:us&&_r(Cr.normalMap.channel),displacementMapUv:is&&_r(Cr.displacementMap.channel),emissiveMapUv:Ji&&_r(Cr.emissiveMap.channel),metalnessMapUv:ms&&_r(Cr.metalnessMap.channel),roughnessMapUv:Ki&&_r(Cr.roughnessMap.channel),anisotropyMapUv:gs&&_r(Cr.anisotropyMap.channel),clearcoatMapUv:_s&&_r(Cr.clearcoatMap.channel),clearcoatNormalMapUv:vs&&_r(Cr.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:As&&_r(Cr.clearcoatRoughnessMap.channel),iridescenceMapUv:Ss&&_r(Cr.iridescenceMap.channel),iridescenceThicknessMapUv:Is&&_r(Cr.iridescenceThicknessMap.channel),sheenColorMapUv:Fs&&_r(Cr.sheenColorMap.channel),sheenRoughnessMapUv:Ns&&_r(Cr.sheenRoughnessMap.channel),specularMapUv:Ws&&_r(Cr.specularMap.channel),specularColorMapUv:ks&&_r(Cr.specularColorMap.channel),specularIntensityMapUv:Vs&&_r(Cr.specularIntensityMap.channel),transmissionMapUv:bs&&_r(Cr.transmissionMap.channel),thicknessMapUv:Ms&&_r(Cr.thicknessMap.channel),alphaMapUv:Ps&&_r(Cr.alphaMap.channel),vertexTangents:!!Ur.attributes.tangent&&(us||Ni),vertexColors:Cr.vertexColors,vertexAlphas:Cr.vertexColors===!0&&!!Ur.attributes.color&&Ur.attributes.color.itemSize===4,pointsUvs:Fr.isPoints===!0&&!!Ur.attributes.uv&&(Zi||Ps),fog:!!Nr,useFog:Cr.fog===!0,fogExp2:!!Nr&&Nr.isFogExp2,flatShading:Cr.flatShading===!0,sizeAttenuation:Cr.sizeAttenuation===!0,logarithmicDepthBuffer:fr,reverseDepthBuffer:qr,skinning:Fr.isSkinnedMesh===!0,morphTargets:Ur.morphAttributes.position!==void 0,morphNormals:Ur.morphAttributes.normal!==void 0,morphColors:Ur.morphAttributes.color!==void 0,morphTargetsCount:Yr,morphTextureStride:Qi,numDirLights:Ir.directional.length,numPointLights:Ir.point.length,numSpotLights:Ir.spot.length,numSpotLightMaps:Ir.spotLightMap.length,numRectAreaLights:Ir.rectArea.length,numHemiLights:Ir.hemi.length,numDirLightShadows:Ir.directionalShadowMap.length,numPointLightShadows:Ir.pointShadowMap.length,numSpotLightShadows:Ir.spotShadowMap.length,numSpotLightShadowsWithMaps:Ir.numSpotLightShadowsWithMaps,numLightProbes:Ir.numLightProbes,numClippingPlanes:ar.numPlanes,numClipIntersection:ar.numIntersection,dithering:Cr.dithering,shadowMapEnabled:ir.shadowMap.enabled&&Rr.length>0,shadowMapType:ir.shadowMap.type,toneMapping:Sa,decodeVideoTexture:Zi&&Cr.map.isVideoTexture===!0&&ColorManagement.getTransfer(Cr.map.colorSpace)===SRGBTransfer,decodeVideoTextureEmissive:Ji&&Cr.emissiveMap.isVideoTexture===!0&&ColorManagement.getTransfer(Cr.emissiveMap.colorSpace)===SRGBTransfer,premultipliedAlpha:Cr.premultipliedAlpha,doubleSided:Cr.side===DoubleSide,flipSided:Cr.side===BackSide,useDepthPacking:Cr.depthPacking>=0,depthPacking:Cr.depthPacking||0,index0AttributeName:Cr.index0AttributeName,extensionClipCullDistance:ta&&Cr.extensions.clipCullDistance===!0&&rr.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ta&&Cr.extensions.multiDraw===!0||Zr)&&rr.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:rr.has("KHR_parallel_shader_compile"),customProgramCacheKey:Cr.customProgramCacheKey()};return ga.vertexUv1s=cr.has(1),ga.vertexUv2s=cr.has(2),ga.vertexUv3s=cr.has(3),cr.clear(),ga}function dr(Cr){const Ir=[];if(Cr.shaderID?Ir.push(Cr.shaderID):(Ir.push(Cr.customVertexShaderID),Ir.push(Cr.customFragmentShaderID)),Cr.defines!==void 0)for(const Rr in Cr.defines)Ir.push(Rr),Ir.push(Cr.defines[Rr]);return Cr.isRawShaderMaterial===!1&&(vr(Ir,Cr),Ar(Ir,Cr),Ir.push(ir.outputColorSpace)),Ir.push(Cr.customProgramCacheKey),Ir.join()}function vr(Cr,Ir){Cr.push(Ir.precision),Cr.push(Ir.outputColorSpace),Cr.push(Ir.envMapMode),Cr.push(Ir.envMapCubeUVHeight),Cr.push(Ir.mapUv),Cr.push(Ir.alphaMapUv),Cr.push(Ir.lightMapUv),Cr.push(Ir.aoMapUv),Cr.push(Ir.bumpMapUv),Cr.push(Ir.normalMapUv),Cr.push(Ir.displacementMapUv),Cr.push(Ir.emissiveMapUv),Cr.push(Ir.metalnessMapUv),Cr.push(Ir.roughnessMapUv),Cr.push(Ir.anisotropyMapUv),Cr.push(Ir.clearcoatMapUv),Cr.push(Ir.clearcoatNormalMapUv),Cr.push(Ir.clearcoatRoughnessMapUv),Cr.push(Ir.iridescenceMapUv),Cr.push(Ir.iridescenceThicknessMapUv),Cr.push(Ir.sheenColorMapUv),Cr.push(Ir.sheenRoughnessMapUv),Cr.push(Ir.specularMapUv),Cr.push(Ir.specularColorMapUv),Cr.push(Ir.specularIntensityMapUv),Cr.push(Ir.transmissionMapUv),Cr.push(Ir.thicknessMapUv),Cr.push(Ir.combine),Cr.push(Ir.fogExp2),Cr.push(Ir.sizeAttenuation),Cr.push(Ir.morphTargetsCount),Cr.push(Ir.morphAttributeCount),Cr.push(Ir.numDirLights),Cr.push(Ir.numPointLights),Cr.push(Ir.numSpotLights),Cr.push(Ir.numSpotLightMaps),Cr.push(Ir.numHemiLights),Cr.push(Ir.numRectAreaLights),Cr.push(Ir.numDirLightShadows),Cr.push(Ir.numPointLightShadows),Cr.push(Ir.numSpotLightShadows),Cr.push(Ir.numSpotLightShadowsWithMaps),Cr.push(Ir.numLightProbes),Cr.push(Ir.shadowMapType),Cr.push(Ir.toneMapping),Cr.push(Ir.numClippingPlanes),Cr.push(Ir.numClipIntersection),Cr.push(Ir.depthPacking)}function Ar(Cr,Ir){or.disableAll(),Ir.supportsVertexTextures&&or.enable(0),Ir.instancing&&or.enable(1),Ir.instancingColor&&or.enable(2),Ir.instancingMorph&&or.enable(3),Ir.matcap&&or.enable(4),Ir.envMap&&or.enable(5),Ir.normalMapObjectSpace&&or.enable(6),Ir.normalMapTangentSpace&&or.enable(7),Ir.clearcoat&&or.enable(8),Ir.iridescence&&or.enable(9),Ir.alphaTest&&or.enable(10),Ir.vertexColors&&or.enable(11),Ir.vertexAlphas&&or.enable(12),Ir.vertexUv1s&&or.enable(13),Ir.vertexUv2s&&or.enable(14),Ir.vertexUv3s&&or.enable(15),Ir.vertexTangents&&or.enable(16),Ir.anisotropy&&or.enable(17),Ir.alphaHash&&or.enable(18),Ir.batching&&or.enable(19),Ir.dispersion&&or.enable(20),Ir.batchingColor&&or.enable(21),Cr.push(or.mask),or.disableAll(),Ir.fog&&or.enable(0),Ir.useFog&&or.enable(1),Ir.flatShading&&or.enable(2),Ir.logarithmicDepthBuffer&&or.enable(3),Ir.reverseDepthBuffer&&or.enable(4),Ir.skinning&&or.enable(5),Ir.morphTargets&&or.enable(6),Ir.morphNormals&&or.enable(7),Ir.morphColors&&or.enable(8),Ir.premultipliedAlpha&&or.enable(9),Ir.shadowMapEnabled&&or.enable(10),Ir.doubleSided&&or.enable(11),Ir.flipSided&&or.enable(12),Ir.useDepthPacking&&or.enable(13),Ir.dithering&&or.enable(14),Ir.transmission&&or.enable(15),Ir.sheen&&or.enable(16),Ir.opaque&&or.enable(17),Ir.pointsUvs&&or.enable(18),Ir.decodeVideoTexture&&or.enable(19),Ir.decodeVideoTextureEmissive&&or.enable(20),Ir.alphaToCoverage&&or.enable(21),Cr.push(or.mask)}function yr(Cr){const Ir=gr[Cr.type];let Rr;if(Ir){const Pr=ShaderLib[Ir];Rr=UniformsUtils.clone(Pr.uniforms)}else Rr=Cr.uniforms;return Rr}function wr(Cr,Ir){let Rr;for(let Pr=0,Fr=hr.length;Pr<Fr;Pr++){const Nr=hr[Pr];if(Nr.cacheKey===Ir){Rr=Nr,++Rr.usedTimes;break}}return Rr===void 0&&(Rr=new WebGLProgram(ir,Ir,Cr,sr),hr.push(Rr)),Rr}function br(Cr){if(--Cr.usedTimes===0){const Ir=hr.indexOf(Cr);hr[Ir]=hr[hr.length-1],hr.pop(),Cr.destroy()}}function Sr(Cr){lr.remove(Cr)}function xr(){lr.dispose()}return{getParameters:mr,getProgramCacheKey:dr,getUniforms:yr,acquireProgram:wr,releaseProgram:br,releaseShaderCache:Sr,programs:hr,dispose:xr}}function WebGLProperties(){let ir=new WeakMap;function er(ar){return ir.has(ar)}function tr(ar){let or=ir.get(ar);return or===void 0&&(or={},ir.set(ar,or)),or}function rr(ar){ir.delete(ar)}function nr(ar,or,lr){ir.get(ar)[or]=lr}function sr(){ir=new WeakMap}return{has:er,get:tr,remove:rr,update:nr,dispose:sr}}function painterSortStable(ir,er){return ir.groupOrder!==er.groupOrder?ir.groupOrder-er.groupOrder:ir.renderOrder!==er.renderOrder?ir.renderOrder-er.renderOrder:ir.material.id!==er.material.id?ir.material.id-er.material.id:ir.z!==er.z?ir.z-er.z:ir.id-er.id}function reversePainterSortStable(ir,er){return ir.groupOrder!==er.groupOrder?ir.groupOrder-er.groupOrder:ir.renderOrder!==er.renderOrder?ir.renderOrder-er.renderOrder:ir.z!==er.z?er.z-ir.z:ir.id-er.id}function WebGLRenderList(){const ir=[];let er=0;const tr=[],rr=[],nr=[];function sr(){er=0,tr.length=0,rr.length=0,nr.length=0}function ar(fr,ur,pr,gr,_r,mr){let dr=ir[er];return dr===void 0?(dr={id:fr.id,object:fr,geometry:ur,material:pr,groupOrder:gr,renderOrder:fr.renderOrder,z:_r,group:mr},ir[er]=dr):(dr.id=fr.id,dr.object=fr,dr.geometry=ur,dr.material=pr,dr.groupOrder=gr,dr.renderOrder=fr.renderOrder,dr.z=_r,dr.group=mr),er++,dr}function or(fr,ur,pr,gr,_r,mr){const dr=ar(fr,ur,pr,gr,_r,mr);pr.transmission>0?rr.push(dr):pr.transparent===!0?nr.push(dr):tr.push(dr)}function lr(fr,ur,pr,gr,_r,mr){const dr=ar(fr,ur,pr,gr,_r,mr);pr.transmission>0?rr.unshift(dr):pr.transparent===!0?nr.unshift(dr):tr.unshift(dr)}function cr(fr,ur){tr.length>1&&tr.sort(fr||painterSortStable),rr.length>1&&rr.sort(ur||reversePainterSortStable),nr.length>1&&nr.sort(ur||reversePainterSortStable)}function hr(){for(let fr=er,ur=ir.length;fr<ur;fr++){const pr=ir[fr];if(pr.id===null)break;pr.id=null,pr.object=null,pr.geometry=null,pr.material=null,pr.group=null}}return{opaque:tr,transmissive:rr,transparent:nr,init:sr,push:or,unshift:lr,finish:hr,sort:cr}}function WebGLRenderLists(){let ir=new WeakMap;function er(rr,nr){const sr=ir.get(rr);let ar;return sr===void 0?(ar=new WebGLRenderList,ir.set(rr,[ar])):nr>=sr.length?(ar=new WebGLRenderList,sr.push(ar)):ar=sr[nr],ar}function tr(){ir=new WeakMap}return{get:er,dispose:tr}}function UniformsCache(){const ir={};return{get:function(er){if(ir[er.id]!==void 0)return ir[er.id];let tr;switch(er.type){case"DirectionalLight":tr={direction:new Vector3$1,color:new Color};break;case"SpotLight":tr={position:new Vector3$1,direction:new Vector3$1,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":tr={position:new Vector3$1,color:new Color,distance:0,decay:0};break;case"HemisphereLight":tr={direction:new Vector3$1,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":tr={color:new Color,position:new Vector3$1,halfWidth:new Vector3$1,halfHeight:new Vector3$1};break}return ir[er.id]=tr,tr}}}function ShadowUniformsCache(){const ir={};return{get:function(er){if(ir[er.id]!==void 0)return ir[er.id];let tr;switch(er.type){case"DirectionalLight":tr={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":tr={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":tr={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return ir[er.id]=tr,tr}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(ir,er){return(er.castShadow?2:0)-(ir.castShadow?2:0)+(er.map?1:0)-(ir.map?1:0)}function WebGLLights(ir){const er=new UniformsCache,tr=ShadowUniformsCache(),rr={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let cr=0;cr<9;cr++)rr.probe.push(new Vector3$1);const nr=new Vector3$1,sr=new Matrix4,ar=new Matrix4;function or(cr){let hr=0,fr=0,ur=0;for(let Cr=0;Cr<9;Cr++)rr.probe[Cr].set(0,0,0);let pr=0,gr=0,_r=0,mr=0,dr=0,vr=0,Ar=0,yr=0,wr=0,br=0,Sr=0;cr.sort(shadowCastingAndTexturingLightsFirst);for(let Cr=0,Ir=cr.length;Cr<Ir;Cr++){const Rr=cr[Cr],Pr=Rr.color,Fr=Rr.intensity,Nr=Rr.distance,Ur=Rr.shadow&&Rr.shadow.map?Rr.shadow.map.texture:null;if(Rr.isAmbientLight)hr+=Pr.r*Fr,fr+=Pr.g*Fr,ur+=Pr.b*Fr;else if(Rr.isLightProbe){for(let Br=0;Br<9;Br++)rr.probe[Br].addScaledVector(Rr.sh.coefficients[Br],Fr);Sr++}else if(Rr.isDirectionalLight){const Br=er.get(Rr);if(Br.color.copy(Rr.color).multiplyScalar(Rr.intensity),Rr.castShadow){const Or=Rr.shadow,Dr=tr.get(Rr);Dr.shadowIntensity=Or.intensity,Dr.shadowBias=Or.bias,Dr.shadowNormalBias=Or.normalBias,Dr.shadowRadius=Or.radius,Dr.shadowMapSize=Or.mapSize,rr.directionalShadow[pr]=Dr,rr.directionalShadowMap[pr]=Ur,rr.directionalShadowMatrix[pr]=Rr.shadow.matrix,vr++}rr.directional[pr]=Br,pr++}else if(Rr.isSpotLight){const Br=er.get(Rr);Br.position.setFromMatrixPosition(Rr.matrixWorld),Br.color.copy(Pr).multiplyScalar(Fr),Br.distance=Nr,Br.coneCos=Math.cos(Rr.angle),Br.penumbraCos=Math.cos(Rr.angle*(1-Rr.penumbra)),Br.decay=Rr.decay,rr.spot[_r]=Br;const Or=Rr.shadow;if(Rr.map&&(rr.spotLightMap[wr]=Rr.map,wr++,Or.updateMatrices(Rr),Rr.castShadow&&br++),rr.spotLightMatrix[_r]=Or.matrix,Rr.castShadow){const Dr=tr.get(Rr);Dr.shadowIntensity=Or.intensity,Dr.shadowBias=Or.bias,Dr.shadowNormalBias=Or.normalBias,Dr.shadowRadius=Or.radius,Dr.shadowMapSize=Or.mapSize,rr.spotShadow[_r]=Dr,rr.spotShadowMap[_r]=Ur,yr++}_r++}else if(Rr.isRectAreaLight){const Br=er.get(Rr);Br.color.copy(Pr).multiplyScalar(Fr),Br.halfWidth.set(Rr.width*.5,0,0),Br.halfHeight.set(0,Rr.height*.5,0),rr.rectArea[mr]=Br,mr++}else if(Rr.isPointLight){const Br=er.get(Rr);if(Br.color.copy(Rr.color).multiplyScalar(Rr.intensity),Br.distance=Rr.distance,Br.decay=Rr.decay,Rr.castShadow){const Or=Rr.shadow,Dr=tr.get(Rr);Dr.shadowIntensity=Or.intensity,Dr.shadowBias=Or.bias,Dr.shadowNormalBias=Or.normalBias,Dr.shadowRadius=Or.radius,Dr.shadowMapSize=Or.mapSize,Dr.shadowCameraNear=Or.camera.near,Dr.shadowCameraFar=Or.camera.far,rr.pointShadow[gr]=Dr,rr.pointShadowMap[gr]=Ur,rr.pointShadowMatrix[gr]=Rr.shadow.matrix,Ar++}rr.point[gr]=Br,gr++}else if(Rr.isHemisphereLight){const Br=er.get(Rr);Br.skyColor.copy(Rr.color).multiplyScalar(Fr),Br.groundColor.copy(Rr.groundColor).multiplyScalar(Fr),rr.hemi[dr]=Br,dr++}}mr>0&&(ir.has("OES_texture_float_linear")===!0?(rr.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,rr.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):(rr.rectAreaLTC1=UniformsLib.LTC_HALF_1,rr.rectAreaLTC2=UniformsLib.LTC_HALF_2)),rr.ambient[0]=hr,rr.ambient[1]=fr,rr.ambient[2]=ur;const xr=rr.hash;(xr.directionalLength!==pr||xr.pointLength!==gr||xr.spotLength!==_r||xr.rectAreaLength!==mr||xr.hemiLength!==dr||xr.numDirectionalShadows!==vr||xr.numPointShadows!==Ar||xr.numSpotShadows!==yr||xr.numSpotMaps!==wr||xr.numLightProbes!==Sr)&&(rr.directional.length=pr,rr.spot.length=_r,rr.rectArea.length=mr,rr.point.length=gr,rr.hemi.length=dr,rr.directionalShadow.length=vr,rr.directionalShadowMap.length=vr,rr.pointShadow.length=Ar,rr.pointShadowMap.length=Ar,rr.spotShadow.length=yr,rr.spotShadowMap.length=yr,rr.directionalShadowMatrix.length=vr,rr.pointShadowMatrix.length=Ar,rr.spotLightMatrix.length=yr+wr-br,rr.spotLightMap.length=wr,rr.numSpotLightShadowsWithMaps=br,rr.numLightProbes=Sr,xr.directionalLength=pr,xr.pointLength=gr,xr.spotLength=_r,xr.rectAreaLength=mr,xr.hemiLength=dr,xr.numDirectionalShadows=vr,xr.numPointShadows=Ar,xr.numSpotShadows=yr,xr.numSpotMaps=wr,xr.numLightProbes=Sr,rr.version=nextVersion++)}function lr(cr,hr){let fr=0,ur=0,pr=0,gr=0,_r=0;const mr=hr.matrixWorldInverse;for(let dr=0,vr=cr.length;dr<vr;dr++){const Ar=cr[dr];if(Ar.isDirectionalLight){const yr=rr.directional[fr];yr.direction.setFromMatrixPosition(Ar.matrixWorld),nr.setFromMatrixPosition(Ar.target.matrixWorld),yr.direction.sub(nr),yr.direction.transformDirection(mr),fr++}else if(Ar.isSpotLight){const yr=rr.spot[pr];yr.position.setFromMatrixPosition(Ar.matrixWorld),yr.position.applyMatrix4(mr),yr.direction.setFromMatrixPosition(Ar.matrixWorld),nr.setFromMatrixPosition(Ar.target.matrixWorld),yr.direction.sub(nr),yr.direction.transformDirection(mr),pr++}else if(Ar.isRectAreaLight){const yr=rr.rectArea[gr];yr.position.setFromMatrixPosition(Ar.matrixWorld),yr.position.applyMatrix4(mr),ar.identity(),sr.copy(Ar.matrixWorld),sr.premultiply(mr),ar.extractRotation(sr),yr.halfWidth.set(Ar.width*.5,0,0),yr.halfHeight.set(0,Ar.height*.5,0),yr.halfWidth.applyMatrix4(ar),yr.halfHeight.applyMatrix4(ar),gr++}else if(Ar.isPointLight){const yr=rr.point[ur];yr.position.setFromMatrixPosition(Ar.matrixWorld),yr.position.applyMatrix4(mr),ur++}else if(Ar.isHemisphereLight){const yr=rr.hemi[_r];yr.direction.setFromMatrixPosition(Ar.matrixWorld),yr.direction.transformDirection(mr),_r++}}}return{setup:or,setupView:lr,state:rr}}function WebGLRenderState(ir){const er=new WebGLLights(ir),tr=[],rr=[];function nr(hr){cr.camera=hr,tr.length=0,rr.length=0}function sr(hr){tr.push(hr)}function ar(hr){rr.push(hr)}function or(){er.setup(tr)}function lr(hr){er.setupView(tr,hr)}const cr={lightsArray:tr,shadowsArray:rr,camera:null,lights:er,transmissionRenderTarget:{}};return{init:nr,state:cr,setupLights:or,setupLightsView:lr,pushLight:sr,pushShadow:ar}}function WebGLRenderStates(ir){let er=new WeakMap;function tr(nr,sr=0){const ar=er.get(nr);let or;return ar===void 0?(or=new WebGLRenderState(ir),er.set(nr,[or])):sr>=ar.length?(or=new WebGLRenderState(ir),ar.push(or)):or=ar[sr],or}function rr(){er=new WeakMap}return{get:tr,dispose:rr}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(ir,er,tr){let rr=new Frustum;const nr=new Vector2,sr=new Vector2,ar=new Vector4,or=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),lr=new MeshDistanceMaterial,cr={},hr=tr.maxTextureSize,fr={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},ur=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),pr=ur.clone();pr.defines.HORIZONTAL_PASS=1;const gr=new BufferGeometry;gr.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _r=new Mesh(gr,ur),mr=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let dr=this.type;this.render=function(br,Sr,xr){if(mr.enabled===!1||mr.autoUpdate===!1&&mr.needsUpdate===!1||br.length===0)return;const Cr=ir.getRenderTarget(),Ir=ir.getActiveCubeFace(),Rr=ir.getActiveMipmapLevel(),Pr=ir.state;Pr.setBlending(NoBlending),Pr.buffers.color.setClear(1,1,1,1),Pr.buffers.depth.setTest(!0),Pr.setScissorTest(!1);const Fr=dr!==VSMShadowMap&&this.type===VSMShadowMap,Nr=dr===VSMShadowMap&&this.type!==VSMShadowMap;for(let Ur=0,Br=br.length;Ur<Br;Ur++){const Or=br[Ur],Dr=Or.shadow;if(Dr===void 0){console.warn("THREE.WebGLShadowMap:",Or,"has no shadow.");continue}if(Dr.autoUpdate===!1&&Dr.needsUpdate===!1)continue;nr.copy(Dr.mapSize);const Wr=Dr.getFrameExtents();if(nr.multiply(Wr),sr.copy(Dr.mapSize),(nr.x>hr||nr.y>hr)&&(nr.x>hr&&(sr.x=Math.floor(hr/Wr.x),nr.x=sr.x*Wr.x,Dr.mapSize.x=sr.x),nr.y>hr&&(sr.y=Math.floor(hr/Wr.y),nr.y=sr.y*Wr.y,Dr.mapSize.y=sr.y)),Dr.map===null||Fr===!0||Nr===!0){const Yr=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};Dr.map!==null&&Dr.map.dispose(),Dr.map=new WebGLRenderTarget(nr.x,nr.y,Yr),Dr.map.texture.name=Or.name+".shadowMap",Dr.camera.updateProjectionMatrix()}ir.setRenderTarget(Dr.map),ir.clear();const $r=Dr.getViewportCount();for(let Yr=0;Yr<$r;Yr++){const Qi=Dr.getViewport(Yr);ar.set(sr.x*Qi.x,sr.y*Qi.y,sr.x*Qi.z,sr.y*Qi.w),Pr.viewport(ar),Dr.updateMatrices(Or,Yr),rr=Dr.getFrustum(),yr(Sr,xr,Dr.camera,Or,this.type)}Dr.isPointLightShadow!==!0&&this.type===VSMShadowMap&&vr(Dr,xr),Dr.needsUpdate=!1}dr=this.type,mr.needsUpdate=!1,ir.setRenderTarget(Cr,Ir,Rr)};function vr(br,Sr){const xr=er.update(_r);ur.defines.VSM_SAMPLES!==br.blurSamples&&(ur.defines.VSM_SAMPLES=br.blurSamples,pr.defines.VSM_SAMPLES=br.blurSamples,ur.needsUpdate=!0,pr.needsUpdate=!0),br.mapPass===null&&(br.mapPass=new WebGLRenderTarget(nr.x,nr.y)),ur.uniforms.shadow_pass.value=br.map.texture,ur.uniforms.resolution.value=br.mapSize,ur.uniforms.radius.value=br.radius,ir.setRenderTarget(br.mapPass),ir.clear(),ir.renderBufferDirect(Sr,null,xr,ur,_r,null),pr.uniforms.shadow_pass.value=br.mapPass.texture,pr.uniforms.resolution.value=br.mapSize,pr.uniforms.radius.value=br.radius,ir.setRenderTarget(br.map),ir.clear(),ir.renderBufferDirect(Sr,null,xr,pr,_r,null)}function Ar(br,Sr,xr,Cr){let Ir=null;const Rr=xr.isPointLight===!0?br.customDistanceMaterial:br.customDepthMaterial;if(Rr!==void 0)Ir=Rr;else if(Ir=xr.isPointLight===!0?lr:or,ir.localClippingEnabled&&Sr.clipShadows===!0&&Array.isArray(Sr.clippingPlanes)&&Sr.clippingPlanes.length!==0||Sr.displacementMap&&Sr.displacementScale!==0||Sr.alphaMap&&Sr.alphaTest>0||Sr.map&&Sr.alphaTest>0){const Pr=Ir.uuid,Fr=Sr.uuid;let Nr=cr[Pr];Nr===void 0&&(Nr={},cr[Pr]=Nr);let Ur=Nr[Fr];Ur===void 0&&(Ur=Ir.clone(),Nr[Fr]=Ur,Sr.addEventListener("dispose",wr)),Ir=Ur}if(Ir.visible=Sr.visible,Ir.wireframe=Sr.wireframe,Cr===VSMShadowMap?Ir.side=Sr.shadowSide!==null?Sr.shadowSide:Sr.side:Ir.side=Sr.shadowSide!==null?Sr.shadowSide:fr[Sr.side],Ir.alphaMap=Sr.alphaMap,Ir.alphaTest=Sr.alphaTest,Ir.map=Sr.map,Ir.clipShadows=Sr.clipShadows,Ir.clippingPlanes=Sr.clippingPlanes,Ir.clipIntersection=Sr.clipIntersection,Ir.displacementMap=Sr.displacementMap,Ir.displacementScale=Sr.displacementScale,Ir.displacementBias=Sr.displacementBias,Ir.wireframeLinewidth=Sr.wireframeLinewidth,Ir.linewidth=Sr.linewidth,xr.isPointLight===!0&&Ir.isMeshDistanceMaterial===!0){const Pr=ir.properties.get(Ir);Pr.light=xr}return Ir}function yr(br,Sr,xr,Cr,Ir){if(br.visible===!1)return;if(br.layers.test(Sr.layers)&&(br.isMesh||br.isLine||br.isPoints)&&(br.castShadow||br.receiveShadow&&Ir===VSMShadowMap)&&(!br.frustumCulled||rr.intersectsObject(br))){br.modelViewMatrix.multiplyMatrices(xr.matrixWorldInverse,br.matrixWorld);const Fr=er.update(br),Nr=br.material;if(Array.isArray(Nr)){const Ur=Fr.groups;for(let Br=0,Or=Ur.length;Br<Or;Br++){const Dr=Ur[Br],Wr=Nr[Dr.materialIndex];if(Wr&&Wr.visible){const $r=Ar(br,Wr,Cr,Ir);br.onBeforeShadow(ir,br,Sr,xr,Fr,$r,Dr),ir.renderBufferDirect(xr,null,Fr,$r,br,Dr),br.onAfterShadow(ir,br,Sr,xr,Fr,$r,Dr)}}}else if(Nr.visible){const Ur=Ar(br,Nr,Cr,Ir);br.onBeforeShadow(ir,br,Sr,xr,Fr,Ur,null),ir.renderBufferDirect(xr,null,Fr,Ur,br,null),br.onAfterShadow(ir,br,Sr,xr,Fr,Ur,null)}}const Pr=br.children;for(let Fr=0,Nr=Pr.length;Fr<Nr;Fr++)yr(Pr[Fr],Sr,xr,Cr,Ir)}function wr(br){br.target.removeEventListener("dispose",wr);for(const xr in cr){const Cr=cr[xr],Ir=br.target.uuid;Ir in Cr&&(Cr[Ir].dispose(),delete Cr[Ir])}}}const reversedFuncs={[NeverDepth]:AlwaysDepth,[LessDepth]:GreaterDepth,[EqualDepth]:NotEqualDepth,[LessEqualDepth]:GreaterEqualDepth,[AlwaysDepth]:NeverDepth,[GreaterDepth]:LessDepth,[NotEqualDepth]:EqualDepth,[GreaterEqualDepth]:LessEqualDepth};function WebGLState(ir,er){function tr(){let bs=!1;const Ms=new Vector4;let Cs=null;const Ps=new Vector4(0,0,0,0);return{setMask:function(Qs){Cs!==Qs&&!bs&&(ir.colorMask(Qs,Qs,Qs,Qs),Cs=Qs)},setLocked:function(Qs){bs=Qs},setClear:function(Qs,Hs,ta,Sa,ga){ga===!0&&(Qs*=Sa,Hs*=Sa,ta*=Sa),Ms.set(Qs,Hs,ta,Sa),Ps.equals(Ms)===!1&&(ir.clearColor(Qs,Hs,ta,Sa),Ps.copy(Ms))},reset:function(){bs=!1,Cs=null,Ps.set(-1,0,0,0)}}}function rr(){let bs=!1,Ms=!1,Cs=null,Ps=null,Qs=null;return{setReversed:function(Hs){if(Ms!==Hs){const ta=er.get("EXT_clip_control");Ms?ta.clipControlEXT(ta.LOWER_LEFT_EXT,ta.ZERO_TO_ONE_EXT):ta.clipControlEXT(ta.LOWER_LEFT_EXT,ta.NEGATIVE_ONE_TO_ONE_EXT);const Sa=Qs;Qs=null,this.setClear(Sa)}Ms=Hs},getReversed:function(){return Ms},setTest:function(Hs){Hs?Gr(ir.DEPTH_TEST):qr(ir.DEPTH_TEST)},setMask:function(Hs){Cs!==Hs&&!bs&&(ir.depthMask(Hs),Cs=Hs)},setFunc:function(Hs){if(Ms&&(Hs=reversedFuncs[Hs]),Ps!==Hs){switch(Hs){case NeverDepth:ir.depthFunc(ir.NEVER);break;case AlwaysDepth:ir.depthFunc(ir.ALWAYS);break;case LessDepth:ir.depthFunc(ir.LESS);break;case LessEqualDepth:ir.depthFunc(ir.LEQUAL);break;case EqualDepth:ir.depthFunc(ir.EQUAL);break;case GreaterEqualDepth:ir.depthFunc(ir.GEQUAL);break;case GreaterDepth:ir.depthFunc(ir.GREATER);break;case NotEqualDepth:ir.depthFunc(ir.NOTEQUAL);break;default:ir.depthFunc(ir.LEQUAL)}Ps=Hs}},setLocked:function(Hs){bs=Hs},setClear:function(Hs){Qs!==Hs&&(Ms&&(Hs=1-Hs),ir.clearDepth(Hs),Qs=Hs)},reset:function(){bs=!1,Cs=null,Ps=null,Qs=null,Ms=!1}}}function nr(){let bs=!1,Ms=null,Cs=null,Ps=null,Qs=null,Hs=null,ta=null,Sa=null,ga=null;return{setTest:function($s){bs||($s?Gr(ir.STENCIL_TEST):qr(ir.STENCIL_TEST))},setMask:function($s){Ms!==$s&&!bs&&(ir.stencilMask($s),Ms=$s)},setFunc:function($s,Ks,qs){(Cs!==$s||Ps!==Ks||Qs!==qs)&&(ir.stencilFunc($s,Ks,qs),Cs=$s,Ps=Ks,Qs=qs)},setOp:function($s,Ks,qs){(Hs!==$s||ta!==Ks||Sa!==qs)&&(ir.stencilOp($s,Ks,qs),Hs=$s,ta=Ks,Sa=qs)},setLocked:function($s){bs=$s},setClear:function($s){ga!==$s&&(ir.clearStencil($s),ga=$s)},reset:function(){bs=!1,Ms=null,Cs=null,Ps=null,Qs=null,Hs=null,ta=null,Sa=null,ga=null}}}const sr=new tr,ar=new rr,or=new nr,lr=new WeakMap,cr=new WeakMap;let hr={},fr={},ur=new WeakMap,pr=[],gr=null,_r=!1,mr=null,dr=null,vr=null,Ar=null,yr=null,wr=null,br=null,Sr=new Color(0,0,0),xr=0,Cr=!1,Ir=null,Rr=null,Pr=null,Fr=null,Nr=null;const Ur=ir.getParameter(ir.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Br=!1,Or=0;const Dr=ir.getParameter(ir.VERSION);Dr.indexOf("WebGL")!==-1?(Or=parseFloat(/^WebGL (\d)/.exec(Dr)[1]),Br=Or>=1):Dr.indexOf("OpenGL ES")!==-1&&(Or=parseFloat(/^OpenGL ES (\d)/.exec(Dr)[1]),Br=Or>=2);let Wr=null,$r={};const Yr=ir.getParameter(ir.SCISSOR_BOX),Qi=ir.getParameter(ir.VIEWPORT),rs=new Vector4().fromArray(Yr),Kr=new Vector4().fromArray(Qi);function Qr(bs,Ms,Cs,Ps){const Qs=new Uint8Array(4),Hs=ir.createTexture();ir.bindTexture(bs,Hs),ir.texParameteri(bs,ir.TEXTURE_MIN_FILTER,ir.NEAREST),ir.texParameteri(bs,ir.TEXTURE_MAG_FILTER,ir.NEAREST);for(let ta=0;ta<Cs;ta++)bs===ir.TEXTURE_3D||bs===ir.TEXTURE_2D_ARRAY?ir.texImage3D(Ms,0,ir.RGBA,1,1,Ps,0,ir.RGBA,ir.UNSIGNED_BYTE,Qs):ir.texImage2D(Ms+ta,0,ir.RGBA,1,1,0,ir.RGBA,ir.UNSIGNED_BYTE,Qs);return Hs}const Vr={};Vr[ir.TEXTURE_2D]=Qr(ir.TEXTURE_2D,ir.TEXTURE_2D,1),Vr[ir.TEXTURE_CUBE_MAP]=Qr(ir.TEXTURE_CUBE_MAP,ir.TEXTURE_CUBE_MAP_POSITIVE_X,6),Vr[ir.TEXTURE_2D_ARRAY]=Qr(ir.TEXTURE_2D_ARRAY,ir.TEXTURE_2D_ARRAY,1,1),Vr[ir.TEXTURE_3D]=Qr(ir.TEXTURE_3D,ir.TEXTURE_3D,1,1),sr.setClear(0,0,0,1),ar.setClear(1),or.setClear(0),Gr(ir.DEPTH_TEST),ar.setFunc(LessEqualDepth),os(!1),us(CullFaceBack),Gr(ir.CULL_FACE),Xr(NoBlending);function Gr(bs){hr[bs]!==!0&&(ir.enable(bs),hr[bs]=!0)}function qr(bs){hr[bs]!==!1&&(ir.disable(bs),hr[bs]=!1)}function ji(bs,Ms){return fr[bs]!==Ms?(ir.bindFramebuffer(bs,Ms),fr[bs]=Ms,bs===ir.DRAW_FRAMEBUFFER&&(fr[ir.FRAMEBUFFER]=Ms),bs===ir.FRAMEBUFFER&&(fr[ir.DRAW_FRAMEBUFFER]=Ms),!0):!1}function Zr(bs,Ms){let Cs=pr,Ps=!1;if(bs){Cs=ur.get(Ms),Cs===void 0&&(Cs=[],ur.set(Ms,Cs));const Qs=bs.textures;if(Cs.length!==Qs.length||Cs[0]!==ir.COLOR_ATTACHMENT0){for(let Hs=0,ta=Qs.length;Hs<ta;Hs++)Cs[Hs]=ir.COLOR_ATTACHMENT0+Hs;Cs.length=Qs.length,Ps=!0}}else Cs[0]!==ir.BACK&&(Cs[0]=ir.BACK,Ps=!0);Ps&&ir.drawBuffers(Cs)}function Zi(bs){return gr!==bs?(ir.useProgram(bs),gr=bs,!0):!1}const Yi={[AddEquation]:ir.FUNC_ADD,[SubtractEquation]:ir.FUNC_SUBTRACT,[ReverseSubtractEquation]:ir.FUNC_REVERSE_SUBTRACT};Yi[MinEquation]=ir.MIN,Yi[MaxEquation]=ir.MAX;const qi={[ZeroFactor]:ir.ZERO,[OneFactor]:ir.ONE,[SrcColorFactor]:ir.SRC_COLOR,[SrcAlphaFactor]:ir.SRC_ALPHA,[SrcAlphaSaturateFactor]:ir.SRC_ALPHA_SATURATE,[DstColorFactor]:ir.DST_COLOR,[DstAlphaFactor]:ir.DST_ALPHA,[OneMinusSrcColorFactor]:ir.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:ir.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:ir.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:ir.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:ir.CONSTANT_COLOR,[OneMinusConstantColorFactor]:ir.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:ir.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:ir.ONE_MINUS_CONSTANT_ALPHA};function Xr(bs,Ms,Cs,Ps,Qs,Hs,ta,Sa,ga,$s){if(bs===NoBlending){_r===!0&&(qr(ir.BLEND),_r=!1);return}if(_r===!1&&(Gr(ir.BLEND),_r=!0),bs!==CustomBlending){if(bs!==mr||$s!==Cr){if((dr!==AddEquation||yr!==AddEquation)&&(ir.blendEquation(ir.FUNC_ADD),dr=AddEquation,yr=AddEquation),$s)switch(bs){case NormalBlending:ir.blendFuncSeparate(ir.ONE,ir.ONE_MINUS_SRC_ALPHA,ir.ONE,ir.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:ir.blendFunc(ir.ONE,ir.ONE);break;case SubtractiveBlending:ir.blendFuncSeparate(ir.ZERO,ir.ONE_MINUS_SRC_COLOR,ir.ZERO,ir.ONE);break;case MultiplyBlending:ir.blendFuncSeparate(ir.ZERO,ir.SRC_COLOR,ir.ZERO,ir.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",bs);break}else switch(bs){case NormalBlending:ir.blendFuncSeparate(ir.SRC_ALPHA,ir.ONE_MINUS_SRC_ALPHA,ir.ONE,ir.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:ir.blendFunc(ir.SRC_ALPHA,ir.ONE);break;case SubtractiveBlending:ir.blendFuncSeparate(ir.ZERO,ir.ONE_MINUS_SRC_COLOR,ir.ZERO,ir.ONE);break;case MultiplyBlending:ir.blendFunc(ir.ZERO,ir.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",bs);break}vr=null,Ar=null,wr=null,br=null,Sr.set(0,0,0),xr=0,mr=bs,Cr=$s}return}Qs=Qs||Ms,Hs=Hs||Cs,ta=ta||Ps,(Ms!==dr||Qs!==yr)&&(ir.blendEquationSeparate(Yi[Ms],Yi[Qs]),dr=Ms,yr=Qs),(Cs!==vr||Ps!==Ar||Hs!==wr||ta!==br)&&(ir.blendFuncSeparate(qi[Cs],qi[Ps],qi[Hs],qi[ta]),vr=Cs,Ar=Ps,wr=Hs,br=ta),(Sa.equals(Sr)===!1||ga!==xr)&&(ir.blendColor(Sa.r,Sa.g,Sa.b,ga),Sr.copy(Sa),xr=ga),mr=bs,Cr=!1}function ns(bs,Ms){bs.side===DoubleSide?qr(ir.CULL_FACE):Gr(ir.CULL_FACE);let Cs=bs.side===BackSide;Ms&&(Cs=!Cs),os(Cs),bs.blending===NormalBlending&&bs.transparent===!1?Xr(NoBlending):Xr(bs.blending,bs.blendEquation,bs.blendSrc,bs.blendDst,bs.blendEquationAlpha,bs.blendSrcAlpha,bs.blendDstAlpha,bs.blendColor,bs.blendAlpha,bs.premultipliedAlpha),ar.setFunc(bs.depthFunc),ar.setTest(bs.depthTest),ar.setMask(bs.depthWrite),sr.setMask(bs.colorWrite);const Ps=bs.stencilWrite;or.setTest(Ps),Ps&&(or.setMask(bs.stencilWriteMask),or.setFunc(bs.stencilFunc,bs.stencilRef,bs.stencilFuncMask),or.setOp(bs.stencilFail,bs.stencilZFail,bs.stencilZPass)),Ji(bs.polygonOffset,bs.polygonOffsetFactor,bs.polygonOffsetUnits),bs.alphaToCoverage===!0?Gr(ir.SAMPLE_ALPHA_TO_COVERAGE):qr(ir.SAMPLE_ALPHA_TO_COVERAGE)}function os(bs){Ir!==bs&&(bs?ir.frontFace(ir.CW):ir.frontFace(ir.CCW),Ir=bs)}function us(bs){bs!==CullFaceNone?(Gr(ir.CULL_FACE),bs!==Rr&&(bs===CullFaceBack?ir.cullFace(ir.BACK):bs===CullFaceFront?ir.cullFace(ir.FRONT):ir.cullFace(ir.FRONT_AND_BACK))):qr(ir.CULL_FACE),Rr=bs}function is(bs){bs!==Pr&&(Br&&ir.lineWidth(bs),Pr=bs)}function Ji(bs,Ms,Cs){bs?(Gr(ir.POLYGON_OFFSET_FILL),(Fr!==Ms||Nr!==Cs)&&(ir.polygonOffset(Ms,Cs),Fr=Ms,Nr=Cs)):qr(ir.POLYGON_OFFSET_FILL)}function ms(bs){bs?Gr(ir.SCISSOR_TEST):qr(ir.SCISSOR_TEST)}function Ki(bs){bs===void 0&&(bs=ir.TEXTURE0+Ur-1),Wr!==bs&&(ir.activeTexture(bs),Wr=bs)}function Ni(bs,Ms,Cs){Cs===void 0&&(Wr===null?Cs=ir.TEXTURE0+Ur-1:Cs=Wr);let Ps=$r[Cs];Ps===void 0&&(Ps={type:void 0,texture:void 0},$r[Cs]=Ps),(Ps.type!==bs||Ps.texture!==Ms)&&(Wr!==Cs&&(ir.activeTexture(Cs),Wr=Cs),ir.bindTexture(bs,Ms||Vr[bs]),Ps.type=bs,Ps.texture=Ms)}function Ri(){const bs=$r[Wr];bs!==void 0&&bs.type!==void 0&&(ir.bindTexture(bs.type,null),bs.type=void 0,bs.texture=void 0)}function Jr(){try{ir.compressedTexImage2D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function Xi(){try{ir.compressedTexImage3D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function ss(){try{ir.texSubImage2D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function ls(){try{ir.texSubImage3D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function gs(){try{ir.compressedTexSubImage2D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function _s(){try{ir.compressedTexSubImage3D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function vs(){try{ir.texStorage2D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function As(){try{ir.texStorage3D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function Ss(){try{ir.texImage2D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function Is(){try{ir.texImage3D.apply(ir,arguments)}catch(bs){console.error("THREE.WebGLState:",bs)}}function Fs(bs){rs.equals(bs)===!1&&(ir.scissor(bs.x,bs.y,bs.z,bs.w),rs.copy(bs))}function Ns(bs){Kr.equals(bs)===!1&&(ir.viewport(bs.x,bs.y,bs.z,bs.w),Kr.copy(bs))}function Ws(bs,Ms){let Cs=cr.get(Ms);Cs===void 0&&(Cs=new WeakMap,cr.set(Ms,Cs));let Ps=Cs.get(bs);Ps===void 0&&(Ps=ir.getUniformBlockIndex(Ms,bs.name),Cs.set(bs,Ps))}function ks(bs,Ms){const Ps=cr.get(Ms).get(bs);lr.get(Ms)!==Ps&&(ir.uniformBlockBinding(Ms,Ps,bs.__bindingPointIndex),lr.set(Ms,Ps))}function Vs(){ir.disable(ir.BLEND),ir.disable(ir.CULL_FACE),ir.disable(ir.DEPTH_TEST),ir.disable(ir.POLYGON_OFFSET_FILL),ir.disable(ir.SCISSOR_TEST),ir.disable(ir.STENCIL_TEST),ir.disable(ir.SAMPLE_ALPHA_TO_COVERAGE),ir.blendEquation(ir.FUNC_ADD),ir.blendFunc(ir.ONE,ir.ZERO),ir.blendFuncSeparate(ir.ONE,ir.ZERO,ir.ONE,ir.ZERO),ir.blendColor(0,0,0,0),ir.colorMask(!0,!0,!0,!0),ir.clearColor(0,0,0,0),ir.depthMask(!0),ir.depthFunc(ir.LESS),ar.setReversed(!1),ir.clearDepth(1),ir.stencilMask(4294967295),ir.stencilFunc(ir.ALWAYS,0,4294967295),ir.stencilOp(ir.KEEP,ir.KEEP,ir.KEEP),ir.clearStencil(0),ir.cullFace(ir.BACK),ir.frontFace(ir.CCW),ir.polygonOffset(0,0),ir.activeTexture(ir.TEXTURE0),ir.bindFramebuffer(ir.FRAMEBUFFER,null),ir.bindFramebuffer(ir.DRAW_FRAMEBUFFER,null),ir.bindFramebuffer(ir.READ_FRAMEBUFFER,null),ir.useProgram(null),ir.lineWidth(1),ir.scissor(0,0,ir.canvas.width,ir.canvas.height),ir.viewport(0,0,ir.canvas.width,ir.canvas.height),hr={},Wr=null,$r={},fr={},ur=new WeakMap,pr=[],gr=null,_r=!1,mr=null,dr=null,vr=null,Ar=null,yr=null,wr=null,br=null,Sr=new Color(0,0,0),xr=0,Cr=!1,Ir=null,Rr=null,Pr=null,Fr=null,Nr=null,rs.set(0,0,ir.canvas.width,ir.canvas.height),Kr.set(0,0,ir.canvas.width,ir.canvas.height),sr.reset(),ar.reset(),or.reset()}return{buffers:{color:sr,depth:ar,stencil:or},enable:Gr,disable:qr,bindFramebuffer:ji,drawBuffers:Zr,useProgram:Zi,setBlending:Xr,setMaterial:ns,setFlipSided:os,setCullFace:us,setLineWidth:is,setPolygonOffset:Ji,setScissorTest:ms,activeTexture:Ki,bindTexture:Ni,unbindTexture:Ri,compressedTexImage2D:Jr,compressedTexImage3D:Xi,texImage2D:Ss,texImage3D:Is,updateUBOMapping:Ws,uniformBlockBinding:ks,texStorage2D:vs,texStorage3D:As,texSubImage2D:ss,texSubImage3D:ls,compressedTexSubImage2D:gs,compressedTexSubImage3D:_s,scissor:Fs,viewport:Ns,reset:Vs}}function WebGLTextures(ir,er,tr,rr,nr,sr,ar){const or=er.has("WEBGL_multisampled_render_to_texture")?er.get("WEBGL_multisampled_render_to_texture"):null,lr=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),cr=new Vector2,hr=new WeakMap;let fr;const ur=new WeakMap;let pr=!1;try{pr=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function gr(Ki,Ni){return pr?new OffscreenCanvas(Ki,Ni):createElementNS("canvas")}function _r(Ki,Ni,Ri){let Jr=1;const Xi=ms(Ki);if((Xi.width>Ri||Xi.height>Ri)&&(Jr=Ri/Math.max(Xi.width,Xi.height)),Jr<1)if(typeof HTMLImageElement<"u"&&Ki instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ki instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ki instanceof ImageBitmap||typeof VideoFrame<"u"&&Ki instanceof VideoFrame){const ss=Math.floor(Jr*Xi.width),ls=Math.floor(Jr*Xi.height);fr===void 0&&(fr=gr(ss,ls));const gs=Ni?gr(ss,ls):fr;return gs.width=ss,gs.height=ls,gs.getContext("2d").drawImage(Ki,0,0,ss,ls),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Xi.width+"x"+Xi.height+") to ("+ss+"x"+ls+")."),gs}else return"data"in Ki&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Xi.width+"x"+Xi.height+")."),Ki;return Ki}function mr(Ki){return Ki.generateMipmaps}function dr(Ki){ir.generateMipmap(Ki)}function vr(Ki){return Ki.isWebGLCubeRenderTarget?ir.TEXTURE_CUBE_MAP:Ki.isWebGL3DRenderTarget?ir.TEXTURE_3D:Ki.isWebGLArrayRenderTarget||Ki.isCompressedArrayTexture?ir.TEXTURE_2D_ARRAY:ir.TEXTURE_2D}function Ar(Ki,Ni,Ri,Jr,Xi=!1){if(Ki!==null){if(ir[Ki]!==void 0)return ir[Ki];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ki+"'")}let ss=Ni;if(Ni===ir.RED&&(Ri===ir.FLOAT&&(ss=ir.R32F),Ri===ir.HALF_FLOAT&&(ss=ir.R16F),Ri===ir.UNSIGNED_BYTE&&(ss=ir.R8)),Ni===ir.RED_INTEGER&&(Ri===ir.UNSIGNED_BYTE&&(ss=ir.R8UI),Ri===ir.UNSIGNED_SHORT&&(ss=ir.R16UI),Ri===ir.UNSIGNED_INT&&(ss=ir.R32UI),Ri===ir.BYTE&&(ss=ir.R8I),Ri===ir.SHORT&&(ss=ir.R16I),Ri===ir.INT&&(ss=ir.R32I)),Ni===ir.RG&&(Ri===ir.FLOAT&&(ss=ir.RG32F),Ri===ir.HALF_FLOAT&&(ss=ir.RG16F),Ri===ir.UNSIGNED_BYTE&&(ss=ir.RG8)),Ni===ir.RG_INTEGER&&(Ri===ir.UNSIGNED_BYTE&&(ss=ir.RG8UI),Ri===ir.UNSIGNED_SHORT&&(ss=ir.RG16UI),Ri===ir.UNSIGNED_INT&&(ss=ir.RG32UI),Ri===ir.BYTE&&(ss=ir.RG8I),Ri===ir.SHORT&&(ss=ir.RG16I),Ri===ir.INT&&(ss=ir.RG32I)),Ni===ir.RGB_INTEGER&&(Ri===ir.UNSIGNED_BYTE&&(ss=ir.RGB8UI),Ri===ir.UNSIGNED_SHORT&&(ss=ir.RGB16UI),Ri===ir.UNSIGNED_INT&&(ss=ir.RGB32UI),Ri===ir.BYTE&&(ss=ir.RGB8I),Ri===ir.SHORT&&(ss=ir.RGB16I),Ri===ir.INT&&(ss=ir.RGB32I)),Ni===ir.RGBA_INTEGER&&(Ri===ir.UNSIGNED_BYTE&&(ss=ir.RGBA8UI),Ri===ir.UNSIGNED_SHORT&&(ss=ir.RGBA16UI),Ri===ir.UNSIGNED_INT&&(ss=ir.RGBA32UI),Ri===ir.BYTE&&(ss=ir.RGBA8I),Ri===ir.SHORT&&(ss=ir.RGBA16I),Ri===ir.INT&&(ss=ir.RGBA32I)),Ni===ir.RGB&&Ri===ir.UNSIGNED_INT_5_9_9_9_REV&&(ss=ir.RGB9_E5),Ni===ir.RGBA){const ls=Xi?LinearTransfer:ColorManagement.getTransfer(Jr);Ri===ir.FLOAT&&(ss=ir.RGBA32F),Ri===ir.HALF_FLOAT&&(ss=ir.RGBA16F),Ri===ir.UNSIGNED_BYTE&&(ss=ls===SRGBTransfer?ir.SRGB8_ALPHA8:ir.RGBA8),Ri===ir.UNSIGNED_SHORT_4_4_4_4&&(ss=ir.RGBA4),Ri===ir.UNSIGNED_SHORT_5_5_5_1&&(ss=ir.RGB5_A1)}return(ss===ir.R16F||ss===ir.R32F||ss===ir.RG16F||ss===ir.RG32F||ss===ir.RGBA16F||ss===ir.RGBA32F)&&er.get("EXT_color_buffer_float"),ss}function yr(Ki,Ni){let Ri;return Ki?Ni===null||Ni===UnsignedIntType||Ni===UnsignedInt248Type?Ri=ir.DEPTH24_STENCIL8:Ni===FloatType?Ri=ir.DEPTH32F_STENCIL8:Ni===UnsignedShortType&&(Ri=ir.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Ni===null||Ni===UnsignedIntType||Ni===UnsignedInt248Type?Ri=ir.DEPTH_COMPONENT24:Ni===FloatType?Ri=ir.DEPTH_COMPONENT32F:Ni===UnsignedShortType&&(Ri=ir.DEPTH_COMPONENT16),Ri}function wr(Ki,Ni){return mr(Ki)===!0||Ki.isFramebufferTexture&&Ki.minFilter!==NearestFilter&&Ki.minFilter!==LinearFilter?Math.log2(Math.max(Ni.width,Ni.height))+1:Ki.mipmaps!==void 0&&Ki.mipmaps.length>0?Ki.mipmaps.length:Ki.isCompressedTexture&&Array.isArray(Ki.image)?Ni.mipmaps.length:1}function br(Ki){const Ni=Ki.target;Ni.removeEventListener("dispose",br),xr(Ni),Ni.isVideoTexture&&hr.delete(Ni)}function Sr(Ki){const Ni=Ki.target;Ni.removeEventListener("dispose",Sr),Ir(Ni)}function xr(Ki){const Ni=rr.get(Ki);if(Ni.__webglInit===void 0)return;const Ri=Ki.source,Jr=ur.get(Ri);if(Jr){const Xi=Jr[Ni.__cacheKey];Xi.usedTimes--,Xi.usedTimes===0&&Cr(Ki),Object.keys(Jr).length===0&&ur.delete(Ri)}rr.remove(Ki)}function Cr(Ki){const Ni=rr.get(Ki);ir.deleteTexture(Ni.__webglTexture);const Ri=Ki.source,Jr=ur.get(Ri);delete Jr[Ni.__cacheKey],ar.memory.textures--}function Ir(Ki){const Ni=rr.get(Ki);if(Ki.depthTexture&&(Ki.depthTexture.dispose(),rr.remove(Ki.depthTexture)),Ki.isWebGLCubeRenderTarget)for(let Jr=0;Jr<6;Jr++){if(Array.isArray(Ni.__webglFramebuffer[Jr]))for(let Xi=0;Xi<Ni.__webglFramebuffer[Jr].length;Xi++)ir.deleteFramebuffer(Ni.__webglFramebuffer[Jr][Xi]);else ir.deleteFramebuffer(Ni.__webglFramebuffer[Jr]);Ni.__webglDepthbuffer&&ir.deleteRenderbuffer(Ni.__webglDepthbuffer[Jr])}else{if(Array.isArray(Ni.__webglFramebuffer))for(let Jr=0;Jr<Ni.__webglFramebuffer.length;Jr++)ir.deleteFramebuffer(Ni.__webglFramebuffer[Jr]);else ir.deleteFramebuffer(Ni.__webglFramebuffer);if(Ni.__webglDepthbuffer&&ir.deleteRenderbuffer(Ni.__webglDepthbuffer),Ni.__webglMultisampledFramebuffer&&ir.deleteFramebuffer(Ni.__webglMultisampledFramebuffer),Ni.__webglColorRenderbuffer)for(let Jr=0;Jr<Ni.__webglColorRenderbuffer.length;Jr++)Ni.__webglColorRenderbuffer[Jr]&&ir.deleteRenderbuffer(Ni.__webglColorRenderbuffer[Jr]);Ni.__webglDepthRenderbuffer&&ir.deleteRenderbuffer(Ni.__webglDepthRenderbuffer)}const Ri=Ki.textures;for(let Jr=0,Xi=Ri.length;Jr<Xi;Jr++){const ss=rr.get(Ri[Jr]);ss.__webglTexture&&(ir.deleteTexture(ss.__webglTexture),ar.memory.textures--),rr.remove(Ri[Jr])}rr.remove(Ki)}let Rr=0;function Pr(){Rr=0}function Fr(){const Ki=Rr;return Ki>=nr.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Ki+" texture units while this GPU supports only "+nr.maxTextures),Rr+=1,Ki}function Nr(Ki){const Ni=[];return Ni.push(Ki.wrapS),Ni.push(Ki.wrapT),Ni.push(Ki.wrapR||0),Ni.push(Ki.magFilter),Ni.push(Ki.minFilter),Ni.push(Ki.anisotropy),Ni.push(Ki.internalFormat),Ni.push(Ki.format),Ni.push(Ki.type),Ni.push(Ki.generateMipmaps),Ni.push(Ki.premultiplyAlpha),Ni.push(Ki.flipY),Ni.push(Ki.unpackAlignment),Ni.push(Ki.colorSpace),Ni.join()}function Ur(Ki,Ni){const Ri=rr.get(Ki);if(Ki.isVideoTexture&&is(Ki),Ki.isRenderTargetTexture===!1&&Ki.version>0&&Ri.__version!==Ki.version){const Jr=Ki.image;if(Jr===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Jr.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Kr(Ri,Ki,Ni);return}}tr.bindTexture(ir.TEXTURE_2D,Ri.__webglTexture,ir.TEXTURE0+Ni)}function Br(Ki,Ni){const Ri=rr.get(Ki);if(Ki.version>0&&Ri.__version!==Ki.version){Kr(Ri,Ki,Ni);return}tr.bindTexture(ir.TEXTURE_2D_ARRAY,Ri.__webglTexture,ir.TEXTURE0+Ni)}function Or(Ki,Ni){const Ri=rr.get(Ki);if(Ki.version>0&&Ri.__version!==Ki.version){Kr(Ri,Ki,Ni);return}tr.bindTexture(ir.TEXTURE_3D,Ri.__webglTexture,ir.TEXTURE0+Ni)}function Dr(Ki,Ni){const Ri=rr.get(Ki);if(Ki.version>0&&Ri.__version!==Ki.version){Qr(Ri,Ki,Ni);return}tr.bindTexture(ir.TEXTURE_CUBE_MAP,Ri.__webglTexture,ir.TEXTURE0+Ni)}const Wr={[RepeatWrapping]:ir.REPEAT,[ClampToEdgeWrapping]:ir.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:ir.MIRRORED_REPEAT},$r={[NearestFilter]:ir.NEAREST,[NearestMipmapNearestFilter]:ir.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:ir.NEAREST_MIPMAP_LINEAR,[LinearFilter]:ir.LINEAR,[LinearMipmapNearestFilter]:ir.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:ir.LINEAR_MIPMAP_LINEAR},Yr={[NeverCompare]:ir.NEVER,[AlwaysCompare]:ir.ALWAYS,[LessCompare]:ir.LESS,[LessEqualCompare]:ir.LEQUAL,[EqualCompare]:ir.EQUAL,[GreaterEqualCompare]:ir.GEQUAL,[GreaterCompare]:ir.GREATER,[NotEqualCompare]:ir.NOTEQUAL};function Qi(Ki,Ni){if(Ni.type===FloatType&&er.has("OES_texture_float_linear")===!1&&(Ni.magFilter===LinearFilter||Ni.magFilter===LinearMipmapNearestFilter||Ni.magFilter===NearestMipmapLinearFilter||Ni.magFilter===LinearMipmapLinearFilter||Ni.minFilter===LinearFilter||Ni.minFilter===LinearMipmapNearestFilter||Ni.minFilter===NearestMipmapLinearFilter||Ni.minFilter===LinearMipmapLinearFilter)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),ir.texParameteri(Ki,ir.TEXTURE_WRAP_S,Wr[Ni.wrapS]),ir.texParameteri(Ki,ir.TEXTURE_WRAP_T,Wr[Ni.wrapT]),(Ki===ir.TEXTURE_3D||Ki===ir.TEXTURE_2D_ARRAY)&&ir.texParameteri(Ki,ir.TEXTURE_WRAP_R,Wr[Ni.wrapR]),ir.texParameteri(Ki,ir.TEXTURE_MAG_FILTER,$r[Ni.magFilter]),ir.texParameteri(Ki,ir.TEXTURE_MIN_FILTER,$r[Ni.minFilter]),Ni.compareFunction&&(ir.texParameteri(Ki,ir.TEXTURE_COMPARE_MODE,ir.COMPARE_REF_TO_TEXTURE),ir.texParameteri(Ki,ir.TEXTURE_COMPARE_FUNC,Yr[Ni.compareFunction])),er.has("EXT_texture_filter_anisotropic")===!0){if(Ni.magFilter===NearestFilter||Ni.minFilter!==NearestMipmapLinearFilter&&Ni.minFilter!==LinearMipmapLinearFilter||Ni.type===FloatType&&er.has("OES_texture_float_linear")===!1)return;if(Ni.anisotropy>1||rr.get(Ni).__currentAnisotropy){const Ri=er.get("EXT_texture_filter_anisotropic");ir.texParameterf(Ki,Ri.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ni.anisotropy,nr.getMaxAnisotropy())),rr.get(Ni).__currentAnisotropy=Ni.anisotropy}}}function rs(Ki,Ni){let Ri=!1;Ki.__webglInit===void 0&&(Ki.__webglInit=!0,Ni.addEventListener("dispose",br));const Jr=Ni.source;let Xi=ur.get(Jr);Xi===void 0&&(Xi={},ur.set(Jr,Xi));const ss=Nr(Ni);if(ss!==Ki.__cacheKey){Xi[ss]===void 0&&(Xi[ss]={texture:ir.createTexture(),usedTimes:0},ar.memory.textures++,Ri=!0),Xi[ss].usedTimes++;const ls=Xi[Ki.__cacheKey];ls!==void 0&&(Xi[Ki.__cacheKey].usedTimes--,ls.usedTimes===0&&Cr(Ni)),Ki.__cacheKey=ss,Ki.__webglTexture=Xi[ss].texture}return Ri}function Kr(Ki,Ni,Ri){let Jr=ir.TEXTURE_2D;(Ni.isDataArrayTexture||Ni.isCompressedArrayTexture)&&(Jr=ir.TEXTURE_2D_ARRAY),Ni.isData3DTexture&&(Jr=ir.TEXTURE_3D);const Xi=rs(Ki,Ni),ss=Ni.source;tr.bindTexture(Jr,Ki.__webglTexture,ir.TEXTURE0+Ri);const ls=rr.get(ss);if(ss.version!==ls.__version||Xi===!0){tr.activeTexture(ir.TEXTURE0+Ri);const gs=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),_s=Ni.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(Ni.colorSpace),vs=Ni.colorSpace===NoColorSpace||gs===_s?ir.NONE:ir.BROWSER_DEFAULT_WEBGL;ir.pixelStorei(ir.UNPACK_FLIP_Y_WEBGL,Ni.flipY),ir.pixelStorei(ir.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ni.premultiplyAlpha),ir.pixelStorei(ir.UNPACK_ALIGNMENT,Ni.unpackAlignment),ir.pixelStorei(ir.UNPACK_COLORSPACE_CONVERSION_WEBGL,vs);let As=_r(Ni.image,!1,nr.maxTextureSize);As=Ji(Ni,As);const Ss=sr.convert(Ni.format,Ni.colorSpace),Is=sr.convert(Ni.type);let Fs=Ar(Ni.internalFormat,Ss,Is,Ni.colorSpace,Ni.isVideoTexture);Qi(Jr,Ni);let Ns;const Ws=Ni.mipmaps,ks=Ni.isVideoTexture!==!0,Vs=ls.__version===void 0||Xi===!0,bs=ss.dataReady,Ms=wr(Ni,As);if(Ni.isDepthTexture)Fs=yr(Ni.format===DepthStencilFormat,Ni.type),Vs&&(ks?tr.texStorage2D(ir.TEXTURE_2D,1,Fs,As.width,As.height):tr.texImage2D(ir.TEXTURE_2D,0,Fs,As.width,As.height,0,Ss,Is,null));else if(Ni.isDataTexture)if(Ws.length>0){ks&&Vs&&tr.texStorage2D(ir.TEXTURE_2D,Ms,Fs,Ws[0].width,Ws[0].height);for(let Cs=0,Ps=Ws.length;Cs<Ps;Cs++)Ns=Ws[Cs],ks?bs&&tr.texSubImage2D(ir.TEXTURE_2D,Cs,0,0,Ns.width,Ns.height,Ss,Is,Ns.data):tr.texImage2D(ir.TEXTURE_2D,Cs,Fs,Ns.width,Ns.height,0,Ss,Is,Ns.data);Ni.generateMipmaps=!1}else ks?(Vs&&tr.texStorage2D(ir.TEXTURE_2D,Ms,Fs,As.width,As.height),bs&&tr.texSubImage2D(ir.TEXTURE_2D,0,0,0,As.width,As.height,Ss,Is,As.data)):tr.texImage2D(ir.TEXTURE_2D,0,Fs,As.width,As.height,0,Ss,Is,As.data);else if(Ni.isCompressedTexture)if(Ni.isCompressedArrayTexture){ks&&Vs&&tr.texStorage3D(ir.TEXTURE_2D_ARRAY,Ms,Fs,Ws[0].width,Ws[0].height,As.depth);for(let Cs=0,Ps=Ws.length;Cs<Ps;Cs++)if(Ns=Ws[Cs],Ni.format!==RGBAFormat)if(Ss!==null)if(ks){if(bs)if(Ni.layerUpdates.size>0){const Qs=getByteLength(Ns.width,Ns.height,Ni.format,Ni.type);for(const Hs of Ni.layerUpdates){const ta=Ns.data.subarray(Hs*Qs/Ns.data.BYTES_PER_ELEMENT,(Hs+1)*Qs/Ns.data.BYTES_PER_ELEMENT);tr.compressedTexSubImage3D(ir.TEXTURE_2D_ARRAY,Cs,0,0,Hs,Ns.width,Ns.height,1,Ss,ta)}Ni.clearLayerUpdates()}else tr.compressedTexSubImage3D(ir.TEXTURE_2D_ARRAY,Cs,0,0,0,Ns.width,Ns.height,As.depth,Ss,Ns.data)}else tr.compressedTexImage3D(ir.TEXTURE_2D_ARRAY,Cs,Fs,Ns.width,Ns.height,As.depth,0,Ns.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ks?bs&&tr.texSubImage3D(ir.TEXTURE_2D_ARRAY,Cs,0,0,0,Ns.width,Ns.height,As.depth,Ss,Is,Ns.data):tr.texImage3D(ir.TEXTURE_2D_ARRAY,Cs,Fs,Ns.width,Ns.height,As.depth,0,Ss,Is,Ns.data)}else{ks&&Vs&&tr.texStorage2D(ir.TEXTURE_2D,Ms,Fs,Ws[0].width,Ws[0].height);for(let Cs=0,Ps=Ws.length;Cs<Ps;Cs++)Ns=Ws[Cs],Ni.format!==RGBAFormat?Ss!==null?ks?bs&&tr.compressedTexSubImage2D(ir.TEXTURE_2D,Cs,0,0,Ns.width,Ns.height,Ss,Ns.data):tr.compressedTexImage2D(ir.TEXTURE_2D,Cs,Fs,Ns.width,Ns.height,0,Ns.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ks?bs&&tr.texSubImage2D(ir.TEXTURE_2D,Cs,0,0,Ns.width,Ns.height,Ss,Is,Ns.data):tr.texImage2D(ir.TEXTURE_2D,Cs,Fs,Ns.width,Ns.height,0,Ss,Is,Ns.data)}else if(Ni.isDataArrayTexture)if(ks){if(Vs&&tr.texStorage3D(ir.TEXTURE_2D_ARRAY,Ms,Fs,As.width,As.height,As.depth),bs)if(Ni.layerUpdates.size>0){const Cs=getByteLength(As.width,As.height,Ni.format,Ni.type);for(const Ps of Ni.layerUpdates){const Qs=As.data.subarray(Ps*Cs/As.data.BYTES_PER_ELEMENT,(Ps+1)*Cs/As.data.BYTES_PER_ELEMENT);tr.texSubImage3D(ir.TEXTURE_2D_ARRAY,0,0,0,Ps,As.width,As.height,1,Ss,Is,Qs)}Ni.clearLayerUpdates()}else tr.texSubImage3D(ir.TEXTURE_2D_ARRAY,0,0,0,0,As.width,As.height,As.depth,Ss,Is,As.data)}else tr.texImage3D(ir.TEXTURE_2D_ARRAY,0,Fs,As.width,As.height,As.depth,0,Ss,Is,As.data);else if(Ni.isData3DTexture)ks?(Vs&&tr.texStorage3D(ir.TEXTURE_3D,Ms,Fs,As.width,As.height,As.depth),bs&&tr.texSubImage3D(ir.TEXTURE_3D,0,0,0,0,As.width,As.height,As.depth,Ss,Is,As.data)):tr.texImage3D(ir.TEXTURE_3D,0,Fs,As.width,As.height,As.depth,0,Ss,Is,As.data);else if(Ni.isFramebufferTexture){if(Vs)if(ks)tr.texStorage2D(ir.TEXTURE_2D,Ms,Fs,As.width,As.height);else{let Cs=As.width,Ps=As.height;for(let Qs=0;Qs<Ms;Qs++)tr.texImage2D(ir.TEXTURE_2D,Qs,Fs,Cs,Ps,0,Ss,Is,null),Cs>>=1,Ps>>=1}}else if(Ws.length>0){if(ks&&Vs){const Cs=ms(Ws[0]);tr.texStorage2D(ir.TEXTURE_2D,Ms,Fs,Cs.width,Cs.height)}for(let Cs=0,Ps=Ws.length;Cs<Ps;Cs++)Ns=Ws[Cs],ks?bs&&tr.texSubImage2D(ir.TEXTURE_2D,Cs,0,0,Ss,Is,Ns):tr.texImage2D(ir.TEXTURE_2D,Cs,Fs,Ss,Is,Ns);Ni.generateMipmaps=!1}else if(ks){if(Vs){const Cs=ms(As);tr.texStorage2D(ir.TEXTURE_2D,Ms,Fs,Cs.width,Cs.height)}bs&&tr.texSubImage2D(ir.TEXTURE_2D,0,0,0,Ss,Is,As)}else tr.texImage2D(ir.TEXTURE_2D,0,Fs,Ss,Is,As);mr(Ni)&&dr(Jr),ls.__version=ss.version,Ni.onUpdate&&Ni.onUpdate(Ni)}Ki.__version=Ni.version}function Qr(Ki,Ni,Ri){if(Ni.image.length!==6)return;const Jr=rs(Ki,Ni),Xi=Ni.source;tr.bindTexture(ir.TEXTURE_CUBE_MAP,Ki.__webglTexture,ir.TEXTURE0+Ri);const ss=rr.get(Xi);if(Xi.version!==ss.__version||Jr===!0){tr.activeTexture(ir.TEXTURE0+Ri);const ls=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),gs=Ni.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(Ni.colorSpace),_s=Ni.colorSpace===NoColorSpace||ls===gs?ir.NONE:ir.BROWSER_DEFAULT_WEBGL;ir.pixelStorei(ir.UNPACK_FLIP_Y_WEBGL,Ni.flipY),ir.pixelStorei(ir.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ni.premultiplyAlpha),ir.pixelStorei(ir.UNPACK_ALIGNMENT,Ni.unpackAlignment),ir.pixelStorei(ir.UNPACK_COLORSPACE_CONVERSION_WEBGL,_s);const vs=Ni.isCompressedTexture||Ni.image[0].isCompressedTexture,As=Ni.image[0]&&Ni.image[0].isDataTexture,Ss=[];for(let Ps=0;Ps<6;Ps++)!vs&&!As?Ss[Ps]=_r(Ni.image[Ps],!0,nr.maxCubemapSize):Ss[Ps]=As?Ni.image[Ps].image:Ni.image[Ps],Ss[Ps]=Ji(Ni,Ss[Ps]);const Is=Ss[0],Fs=sr.convert(Ni.format,Ni.colorSpace),Ns=sr.convert(Ni.type),Ws=Ar(Ni.internalFormat,Fs,Ns,Ni.colorSpace),ks=Ni.isVideoTexture!==!0,Vs=ss.__version===void 0||Jr===!0,bs=Xi.dataReady;let Ms=wr(Ni,Is);Qi(ir.TEXTURE_CUBE_MAP,Ni);let Cs;if(vs){ks&&Vs&&tr.texStorage2D(ir.TEXTURE_CUBE_MAP,Ms,Ws,Is.width,Is.height);for(let Ps=0;Ps<6;Ps++){Cs=Ss[Ps].mipmaps;for(let Qs=0;Qs<Cs.length;Qs++){const Hs=Cs[Qs];Ni.format!==RGBAFormat?Fs!==null?ks?bs&&tr.compressedTexSubImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,Qs,0,0,Hs.width,Hs.height,Fs,Hs.data):tr.compressedTexImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,Qs,Ws,Hs.width,Hs.height,0,Hs.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ks?bs&&tr.texSubImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,Qs,0,0,Hs.width,Hs.height,Fs,Ns,Hs.data):tr.texImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,Qs,Ws,Hs.width,Hs.height,0,Fs,Ns,Hs.data)}}}else{if(Cs=Ni.mipmaps,ks&&Vs){Cs.length>0&&Ms++;const Ps=ms(Ss[0]);tr.texStorage2D(ir.TEXTURE_CUBE_MAP,Ms,Ws,Ps.width,Ps.height)}for(let Ps=0;Ps<6;Ps++)if(As){ks?bs&&tr.texSubImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,0,0,0,Ss[Ps].width,Ss[Ps].height,Fs,Ns,Ss[Ps].data):tr.texImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,0,Ws,Ss[Ps].width,Ss[Ps].height,0,Fs,Ns,Ss[Ps].data);for(let Qs=0;Qs<Cs.length;Qs++){const ta=Cs[Qs].image[Ps].image;ks?bs&&tr.texSubImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,Qs+1,0,0,ta.width,ta.height,Fs,Ns,ta.data):tr.texImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,Qs+1,Ws,ta.width,ta.height,0,Fs,Ns,ta.data)}}else{ks?bs&&tr.texSubImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,0,0,0,Fs,Ns,Ss[Ps]):tr.texImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,0,Ws,Fs,Ns,Ss[Ps]);for(let Qs=0;Qs<Cs.length;Qs++){const Hs=Cs[Qs];ks?bs&&tr.texSubImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,Qs+1,0,0,Fs,Ns,Hs.image[Ps]):tr.texImage2D(ir.TEXTURE_CUBE_MAP_POSITIVE_X+Ps,Qs+1,Ws,Fs,Ns,Hs.image[Ps])}}}mr(Ni)&&dr(ir.TEXTURE_CUBE_MAP),ss.__version=Xi.version,Ni.onUpdate&&Ni.onUpdate(Ni)}Ki.__version=Ni.version}function Vr(Ki,Ni,Ri,Jr,Xi,ss){const ls=sr.convert(Ri.format,Ri.colorSpace),gs=sr.convert(Ri.type),_s=Ar(Ri.internalFormat,ls,gs,Ri.colorSpace),vs=rr.get(Ni),As=rr.get(Ri);if(As.__renderTarget=Ni,!vs.__hasExternalTextures){const Ss=Math.max(1,Ni.width>>ss),Is=Math.max(1,Ni.height>>ss);Xi===ir.TEXTURE_3D||Xi===ir.TEXTURE_2D_ARRAY?tr.texImage3D(Xi,ss,_s,Ss,Is,Ni.depth,0,ls,gs,null):tr.texImage2D(Xi,ss,_s,Ss,Is,0,ls,gs,null)}tr.bindFramebuffer(ir.FRAMEBUFFER,Ki),us(Ni)?or.framebufferTexture2DMultisampleEXT(ir.FRAMEBUFFER,Jr,Xi,As.__webglTexture,0,os(Ni)):(Xi===ir.TEXTURE_2D||Xi>=ir.TEXTURE_CUBE_MAP_POSITIVE_X&&Xi<=ir.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&ir.framebufferTexture2D(ir.FRAMEBUFFER,Jr,Xi,As.__webglTexture,ss),tr.bindFramebuffer(ir.FRAMEBUFFER,null)}function Gr(Ki,Ni,Ri){if(ir.bindRenderbuffer(ir.RENDERBUFFER,Ki),Ni.depthBuffer){const Jr=Ni.depthTexture,Xi=Jr&&Jr.isDepthTexture?Jr.type:null,ss=yr(Ni.stencilBuffer,Xi),ls=Ni.stencilBuffer?ir.DEPTH_STENCIL_ATTACHMENT:ir.DEPTH_ATTACHMENT,gs=os(Ni);us(Ni)?or.renderbufferStorageMultisampleEXT(ir.RENDERBUFFER,gs,ss,Ni.width,Ni.height):Ri?ir.renderbufferStorageMultisample(ir.RENDERBUFFER,gs,ss,Ni.width,Ni.height):ir.renderbufferStorage(ir.RENDERBUFFER,ss,Ni.width,Ni.height),ir.framebufferRenderbuffer(ir.FRAMEBUFFER,ls,ir.RENDERBUFFER,Ki)}else{const Jr=Ni.textures;for(let Xi=0;Xi<Jr.length;Xi++){const ss=Jr[Xi],ls=sr.convert(ss.format,ss.colorSpace),gs=sr.convert(ss.type),_s=Ar(ss.internalFormat,ls,gs,ss.colorSpace),vs=os(Ni);Ri&&us(Ni)===!1?ir.renderbufferStorageMultisample(ir.RENDERBUFFER,vs,_s,Ni.width,Ni.height):us(Ni)?or.renderbufferStorageMultisampleEXT(ir.RENDERBUFFER,vs,_s,Ni.width,Ni.height):ir.renderbufferStorage(ir.RENDERBUFFER,_s,Ni.width,Ni.height)}}ir.bindRenderbuffer(ir.RENDERBUFFER,null)}function qr(Ki,Ni){if(Ni&&Ni.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(tr.bindFramebuffer(ir.FRAMEBUFFER,Ki),!(Ni.depthTexture&&Ni.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Jr=rr.get(Ni.depthTexture);Jr.__renderTarget=Ni,(!Jr.__webglTexture||Ni.depthTexture.image.width!==Ni.width||Ni.depthTexture.image.height!==Ni.height)&&(Ni.depthTexture.image.width=Ni.width,Ni.depthTexture.image.height=Ni.height,Ni.depthTexture.needsUpdate=!0),Ur(Ni.depthTexture,0);const Xi=Jr.__webglTexture,ss=os(Ni);if(Ni.depthTexture.format===DepthFormat)us(Ni)?or.framebufferTexture2DMultisampleEXT(ir.FRAMEBUFFER,ir.DEPTH_ATTACHMENT,ir.TEXTURE_2D,Xi,0,ss):ir.framebufferTexture2D(ir.FRAMEBUFFER,ir.DEPTH_ATTACHMENT,ir.TEXTURE_2D,Xi,0);else if(Ni.depthTexture.format===DepthStencilFormat)us(Ni)?or.framebufferTexture2DMultisampleEXT(ir.FRAMEBUFFER,ir.DEPTH_STENCIL_ATTACHMENT,ir.TEXTURE_2D,Xi,0,ss):ir.framebufferTexture2D(ir.FRAMEBUFFER,ir.DEPTH_STENCIL_ATTACHMENT,ir.TEXTURE_2D,Xi,0);else throw new Error("Unknown depthTexture format")}function ji(Ki){const Ni=rr.get(Ki),Ri=Ki.isWebGLCubeRenderTarget===!0;if(Ni.__boundDepthTexture!==Ki.depthTexture){const Jr=Ki.depthTexture;if(Ni.__depthDisposeCallback&&Ni.__depthDisposeCallback(),Jr){const Xi=()=>{delete Ni.__boundDepthTexture,delete Ni.__depthDisposeCallback,Jr.removeEventListener("dispose",Xi)};Jr.addEventListener("dispose",Xi),Ni.__depthDisposeCallback=Xi}Ni.__boundDepthTexture=Jr}if(Ki.depthTexture&&!Ni.__autoAllocateDepthBuffer){if(Ri)throw new Error("target.depthTexture not supported in Cube render targets");qr(Ni.__webglFramebuffer,Ki)}else if(Ri){Ni.__webglDepthbuffer=[];for(let Jr=0;Jr<6;Jr++)if(tr.bindFramebuffer(ir.FRAMEBUFFER,Ni.__webglFramebuffer[Jr]),Ni.__webglDepthbuffer[Jr]===void 0)Ni.__webglDepthbuffer[Jr]=ir.createRenderbuffer(),Gr(Ni.__webglDepthbuffer[Jr],Ki,!1);else{const Xi=Ki.stencilBuffer?ir.DEPTH_STENCIL_ATTACHMENT:ir.DEPTH_ATTACHMENT,ss=Ni.__webglDepthbuffer[Jr];ir.bindRenderbuffer(ir.RENDERBUFFER,ss),ir.framebufferRenderbuffer(ir.FRAMEBUFFER,Xi,ir.RENDERBUFFER,ss)}}else if(tr.bindFramebuffer(ir.FRAMEBUFFER,Ni.__webglFramebuffer),Ni.__webglDepthbuffer===void 0)Ni.__webglDepthbuffer=ir.createRenderbuffer(),Gr(Ni.__webglDepthbuffer,Ki,!1);else{const Jr=Ki.stencilBuffer?ir.DEPTH_STENCIL_ATTACHMENT:ir.DEPTH_ATTACHMENT,Xi=Ni.__webglDepthbuffer;ir.bindRenderbuffer(ir.RENDERBUFFER,Xi),ir.framebufferRenderbuffer(ir.FRAMEBUFFER,Jr,ir.RENDERBUFFER,Xi)}tr.bindFramebuffer(ir.FRAMEBUFFER,null)}function Zr(Ki,Ni,Ri){const Jr=rr.get(Ki);Ni!==void 0&&Vr(Jr.__webglFramebuffer,Ki,Ki.texture,ir.COLOR_ATTACHMENT0,ir.TEXTURE_2D,0),Ri!==void 0&&ji(Ki)}function Zi(Ki){const Ni=Ki.texture,Ri=rr.get(Ki),Jr=rr.get(Ni);Ki.addEventListener("dispose",Sr);const Xi=Ki.textures,ss=Ki.isWebGLCubeRenderTarget===!0,ls=Xi.length>1;if(ls||(Jr.__webglTexture===void 0&&(Jr.__webglTexture=ir.createTexture()),Jr.__version=Ni.version,ar.memory.textures++),ss){Ri.__webglFramebuffer=[];for(let gs=0;gs<6;gs++)if(Ni.mipmaps&&Ni.mipmaps.length>0){Ri.__webglFramebuffer[gs]=[];for(let _s=0;_s<Ni.mipmaps.length;_s++)Ri.__webglFramebuffer[gs][_s]=ir.createFramebuffer()}else Ri.__webglFramebuffer[gs]=ir.createFramebuffer()}else{if(Ni.mipmaps&&Ni.mipmaps.length>0){Ri.__webglFramebuffer=[];for(let gs=0;gs<Ni.mipmaps.length;gs++)Ri.__webglFramebuffer[gs]=ir.createFramebuffer()}else Ri.__webglFramebuffer=ir.createFramebuffer();if(ls)for(let gs=0,_s=Xi.length;gs<_s;gs++){const vs=rr.get(Xi[gs]);vs.__webglTexture===void 0&&(vs.__webglTexture=ir.createTexture(),ar.memory.textures++)}if(Ki.samples>0&&us(Ki)===!1){Ri.__webglMultisampledFramebuffer=ir.createFramebuffer(),Ri.__webglColorRenderbuffer=[],tr.bindFramebuffer(ir.FRAMEBUFFER,Ri.__webglMultisampledFramebuffer);for(let gs=0;gs<Xi.length;gs++){const _s=Xi[gs];Ri.__webglColorRenderbuffer[gs]=ir.createRenderbuffer(),ir.bindRenderbuffer(ir.RENDERBUFFER,Ri.__webglColorRenderbuffer[gs]);const vs=sr.convert(_s.format,_s.colorSpace),As=sr.convert(_s.type),Ss=Ar(_s.internalFormat,vs,As,_s.colorSpace,Ki.isXRRenderTarget===!0),Is=os(Ki);ir.renderbufferStorageMultisample(ir.RENDERBUFFER,Is,Ss,Ki.width,Ki.height),ir.framebufferRenderbuffer(ir.FRAMEBUFFER,ir.COLOR_ATTACHMENT0+gs,ir.RENDERBUFFER,Ri.__webglColorRenderbuffer[gs])}ir.bindRenderbuffer(ir.RENDERBUFFER,null),Ki.depthBuffer&&(Ri.__webglDepthRenderbuffer=ir.createRenderbuffer(),Gr(Ri.__webglDepthRenderbuffer,Ki,!0)),tr.bindFramebuffer(ir.FRAMEBUFFER,null)}}if(ss){tr.bindTexture(ir.TEXTURE_CUBE_MAP,Jr.__webglTexture),Qi(ir.TEXTURE_CUBE_MAP,Ni);for(let gs=0;gs<6;gs++)if(Ni.mipmaps&&Ni.mipmaps.length>0)for(let _s=0;_s<Ni.mipmaps.length;_s++)Vr(Ri.__webglFramebuffer[gs][_s],Ki,Ni,ir.COLOR_ATTACHMENT0,ir.TEXTURE_CUBE_MAP_POSITIVE_X+gs,_s);else Vr(Ri.__webglFramebuffer[gs],Ki,Ni,ir.COLOR_ATTACHMENT0,ir.TEXTURE_CUBE_MAP_POSITIVE_X+gs,0);mr(Ni)&&dr(ir.TEXTURE_CUBE_MAP),tr.unbindTexture()}else if(ls){for(let gs=0,_s=Xi.length;gs<_s;gs++){const vs=Xi[gs],As=rr.get(vs);tr.bindTexture(ir.TEXTURE_2D,As.__webglTexture),Qi(ir.TEXTURE_2D,vs),Vr(Ri.__webglFramebuffer,Ki,vs,ir.COLOR_ATTACHMENT0+gs,ir.TEXTURE_2D,0),mr(vs)&&dr(ir.TEXTURE_2D)}tr.unbindTexture()}else{let gs=ir.TEXTURE_2D;if((Ki.isWebGL3DRenderTarget||Ki.isWebGLArrayRenderTarget)&&(gs=Ki.isWebGL3DRenderTarget?ir.TEXTURE_3D:ir.TEXTURE_2D_ARRAY),tr.bindTexture(gs,Jr.__webglTexture),Qi(gs,Ni),Ni.mipmaps&&Ni.mipmaps.length>0)for(let _s=0;_s<Ni.mipmaps.length;_s++)Vr(Ri.__webglFramebuffer[_s],Ki,Ni,ir.COLOR_ATTACHMENT0,gs,_s);else Vr(Ri.__webglFramebuffer,Ki,Ni,ir.COLOR_ATTACHMENT0,gs,0);mr(Ni)&&dr(gs),tr.unbindTexture()}Ki.depthBuffer&&ji(Ki)}function Yi(Ki){const Ni=Ki.textures;for(let Ri=0,Jr=Ni.length;Ri<Jr;Ri++){const Xi=Ni[Ri];if(mr(Xi)){const ss=vr(Ki),ls=rr.get(Xi).__webglTexture;tr.bindTexture(ss,ls),dr(ss),tr.unbindTexture()}}}const qi=[],Xr=[];function ns(Ki){if(Ki.samples>0){if(us(Ki)===!1){const Ni=Ki.textures,Ri=Ki.width,Jr=Ki.height;let Xi=ir.COLOR_BUFFER_BIT;const ss=Ki.stencilBuffer?ir.DEPTH_STENCIL_ATTACHMENT:ir.DEPTH_ATTACHMENT,ls=rr.get(Ki),gs=Ni.length>1;if(gs)for(let _s=0;_s<Ni.length;_s++)tr.bindFramebuffer(ir.FRAMEBUFFER,ls.__webglMultisampledFramebuffer),ir.framebufferRenderbuffer(ir.FRAMEBUFFER,ir.COLOR_ATTACHMENT0+_s,ir.RENDERBUFFER,null),tr.bindFramebuffer(ir.FRAMEBUFFER,ls.__webglFramebuffer),ir.framebufferTexture2D(ir.DRAW_FRAMEBUFFER,ir.COLOR_ATTACHMENT0+_s,ir.TEXTURE_2D,null,0);tr.bindFramebuffer(ir.READ_FRAMEBUFFER,ls.__webglMultisampledFramebuffer),tr.bindFramebuffer(ir.DRAW_FRAMEBUFFER,ls.__webglFramebuffer);for(let _s=0;_s<Ni.length;_s++){if(Ki.resolveDepthBuffer&&(Ki.depthBuffer&&(Xi|=ir.DEPTH_BUFFER_BIT),Ki.stencilBuffer&&Ki.resolveStencilBuffer&&(Xi|=ir.STENCIL_BUFFER_BIT)),gs){ir.framebufferRenderbuffer(ir.READ_FRAMEBUFFER,ir.COLOR_ATTACHMENT0,ir.RENDERBUFFER,ls.__webglColorRenderbuffer[_s]);const vs=rr.get(Ni[_s]).__webglTexture;ir.framebufferTexture2D(ir.DRAW_FRAMEBUFFER,ir.COLOR_ATTACHMENT0,ir.TEXTURE_2D,vs,0)}ir.blitFramebuffer(0,0,Ri,Jr,0,0,Ri,Jr,Xi,ir.NEAREST),lr===!0&&(qi.length=0,Xr.length=0,qi.push(ir.COLOR_ATTACHMENT0+_s),Ki.depthBuffer&&Ki.resolveDepthBuffer===!1&&(qi.push(ss),Xr.push(ss),ir.invalidateFramebuffer(ir.DRAW_FRAMEBUFFER,Xr)),ir.invalidateFramebuffer(ir.READ_FRAMEBUFFER,qi))}if(tr.bindFramebuffer(ir.READ_FRAMEBUFFER,null),tr.bindFramebuffer(ir.DRAW_FRAMEBUFFER,null),gs)for(let _s=0;_s<Ni.length;_s++){tr.bindFramebuffer(ir.FRAMEBUFFER,ls.__webglMultisampledFramebuffer),ir.framebufferRenderbuffer(ir.FRAMEBUFFER,ir.COLOR_ATTACHMENT0+_s,ir.RENDERBUFFER,ls.__webglColorRenderbuffer[_s]);const vs=rr.get(Ni[_s]).__webglTexture;tr.bindFramebuffer(ir.FRAMEBUFFER,ls.__webglFramebuffer),ir.framebufferTexture2D(ir.DRAW_FRAMEBUFFER,ir.COLOR_ATTACHMENT0+_s,ir.TEXTURE_2D,vs,0)}tr.bindFramebuffer(ir.DRAW_FRAMEBUFFER,ls.__webglMultisampledFramebuffer)}else if(Ki.depthBuffer&&Ki.resolveDepthBuffer===!1&&lr){const Ni=Ki.stencilBuffer?ir.DEPTH_STENCIL_ATTACHMENT:ir.DEPTH_ATTACHMENT;ir.invalidateFramebuffer(ir.DRAW_FRAMEBUFFER,[Ni])}}}function os(Ki){return Math.min(nr.maxSamples,Ki.samples)}function us(Ki){const Ni=rr.get(Ki);return Ki.samples>0&&er.has("WEBGL_multisampled_render_to_texture")===!0&&Ni.__useRenderToTexture!==!1}function is(Ki){const Ni=ar.render.frame;hr.get(Ki)!==Ni&&(hr.set(Ki,Ni),Ki.update())}function Ji(Ki,Ni){const Ri=Ki.colorSpace,Jr=Ki.format,Xi=Ki.type;return Ki.isCompressedTexture===!0||Ki.isVideoTexture===!0||Ri!==LinearSRGBColorSpace&&Ri!==NoColorSpace&&(ColorManagement.getTransfer(Ri)===SRGBTransfer?(Jr!==RGBAFormat||Xi!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ri)),Ni}function ms(Ki){return typeof HTMLImageElement<"u"&&Ki instanceof HTMLImageElement?(cr.width=Ki.naturalWidth||Ki.width,cr.height=Ki.naturalHeight||Ki.height):typeof VideoFrame<"u"&&Ki instanceof VideoFrame?(cr.width=Ki.displayWidth,cr.height=Ki.displayHeight):(cr.width=Ki.width,cr.height=Ki.height),cr}this.allocateTextureUnit=Fr,this.resetTextureUnits=Pr,this.setTexture2D=Ur,this.setTexture2DArray=Br,this.setTexture3D=Or,this.setTextureCube=Dr,this.rebindTextures=Zr,this.setupRenderTarget=Zi,this.updateRenderTargetMipmap=Yi,this.updateMultisampleRenderTarget=ns,this.setupDepthRenderbuffer=ji,this.setupFrameBufferTexture=Vr,this.useMultisampledRTT=us}function WebGLUtils(ir,er){function tr(rr,nr=NoColorSpace){let sr;const ar=ColorManagement.getTransfer(nr);if(rr===UnsignedByteType)return ir.UNSIGNED_BYTE;if(rr===UnsignedShort4444Type)return ir.UNSIGNED_SHORT_4_4_4_4;if(rr===UnsignedShort5551Type)return ir.UNSIGNED_SHORT_5_5_5_1;if(rr===UnsignedInt5999Type)return ir.UNSIGNED_INT_5_9_9_9_REV;if(rr===ByteType)return ir.BYTE;if(rr===ShortType)return ir.SHORT;if(rr===UnsignedShortType)return ir.UNSIGNED_SHORT;if(rr===IntType)return ir.INT;if(rr===UnsignedIntType)return ir.UNSIGNED_INT;if(rr===FloatType)return ir.FLOAT;if(rr===HalfFloatType)return ir.HALF_FLOAT;if(rr===AlphaFormat)return ir.ALPHA;if(rr===RGBFormat)return ir.RGB;if(rr===RGBAFormat)return ir.RGBA;if(rr===LuminanceFormat)return ir.LUMINANCE;if(rr===LuminanceAlphaFormat)return ir.LUMINANCE_ALPHA;if(rr===DepthFormat)return ir.DEPTH_COMPONENT;if(rr===DepthStencilFormat)return ir.DEPTH_STENCIL;if(rr===RedFormat)return ir.RED;if(rr===RedIntegerFormat)return ir.RED_INTEGER;if(rr===RGFormat)return ir.RG;if(rr===RGIntegerFormat)return ir.RG_INTEGER;if(rr===RGBAIntegerFormat)return ir.RGBA_INTEGER;if(rr===RGB_S3TC_DXT1_Format||rr===RGBA_S3TC_DXT1_Format||rr===RGBA_S3TC_DXT3_Format||rr===RGBA_S3TC_DXT5_Format)if(ar===SRGBTransfer)if(sr=er.get("WEBGL_compressed_texture_s3tc_srgb"),sr!==null){if(rr===RGB_S3TC_DXT1_Format)return sr.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(rr===RGBA_S3TC_DXT1_Format)return sr.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(rr===RGBA_S3TC_DXT3_Format)return sr.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(rr===RGBA_S3TC_DXT5_Format)return sr.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(sr=er.get("WEBGL_compressed_texture_s3tc"),sr!==null){if(rr===RGB_S3TC_DXT1_Format)return sr.COMPRESSED_RGB_S3TC_DXT1_EXT;if(rr===RGBA_S3TC_DXT1_Format)return sr.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(rr===RGBA_S3TC_DXT3_Format)return sr.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(rr===RGBA_S3TC_DXT5_Format)return sr.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(rr===RGB_PVRTC_4BPPV1_Format||rr===RGB_PVRTC_2BPPV1_Format||rr===RGBA_PVRTC_4BPPV1_Format||rr===RGBA_PVRTC_2BPPV1_Format)if(sr=er.get("WEBGL_compressed_texture_pvrtc"),sr!==null){if(rr===RGB_PVRTC_4BPPV1_Format)return sr.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(rr===RGB_PVRTC_2BPPV1_Format)return sr.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(rr===RGBA_PVRTC_4BPPV1_Format)return sr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(rr===RGBA_PVRTC_2BPPV1_Format)return sr.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(rr===RGB_ETC1_Format||rr===RGB_ETC2_Format||rr===RGBA_ETC2_EAC_Format)if(sr=er.get("WEBGL_compressed_texture_etc"),sr!==null){if(rr===RGB_ETC1_Format||rr===RGB_ETC2_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ETC2:sr.COMPRESSED_RGB8_ETC2;if(rr===RGBA_ETC2_EAC_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:sr.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(rr===RGBA_ASTC_4x4_Format||rr===RGBA_ASTC_5x4_Format||rr===RGBA_ASTC_5x5_Format||rr===RGBA_ASTC_6x5_Format||rr===RGBA_ASTC_6x6_Format||rr===RGBA_ASTC_8x5_Format||rr===RGBA_ASTC_8x6_Format||rr===RGBA_ASTC_8x8_Format||rr===RGBA_ASTC_10x5_Format||rr===RGBA_ASTC_10x6_Format||rr===RGBA_ASTC_10x8_Format||rr===RGBA_ASTC_10x10_Format||rr===RGBA_ASTC_12x10_Format||rr===RGBA_ASTC_12x12_Format)if(sr=er.get("WEBGL_compressed_texture_astc"),sr!==null){if(rr===RGBA_ASTC_4x4_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:sr.COMPRESSED_RGBA_ASTC_4x4_KHR;if(rr===RGBA_ASTC_5x4_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:sr.COMPRESSED_RGBA_ASTC_5x4_KHR;if(rr===RGBA_ASTC_5x5_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:sr.COMPRESSED_RGBA_ASTC_5x5_KHR;if(rr===RGBA_ASTC_6x5_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:sr.COMPRESSED_RGBA_ASTC_6x5_KHR;if(rr===RGBA_ASTC_6x6_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:sr.COMPRESSED_RGBA_ASTC_6x6_KHR;if(rr===RGBA_ASTC_8x5_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:sr.COMPRESSED_RGBA_ASTC_8x5_KHR;if(rr===RGBA_ASTC_8x6_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:sr.COMPRESSED_RGBA_ASTC_8x6_KHR;if(rr===RGBA_ASTC_8x8_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:sr.COMPRESSED_RGBA_ASTC_8x8_KHR;if(rr===RGBA_ASTC_10x5_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:sr.COMPRESSED_RGBA_ASTC_10x5_KHR;if(rr===RGBA_ASTC_10x6_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:sr.COMPRESSED_RGBA_ASTC_10x6_KHR;if(rr===RGBA_ASTC_10x8_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:sr.COMPRESSED_RGBA_ASTC_10x8_KHR;if(rr===RGBA_ASTC_10x10_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:sr.COMPRESSED_RGBA_ASTC_10x10_KHR;if(rr===RGBA_ASTC_12x10_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:sr.COMPRESSED_RGBA_ASTC_12x10_KHR;if(rr===RGBA_ASTC_12x12_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:sr.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(rr===RGBA_BPTC_Format||rr===RGB_BPTC_SIGNED_Format||rr===RGB_BPTC_UNSIGNED_Format)if(sr=er.get("EXT_texture_compression_bptc"),sr!==null){if(rr===RGBA_BPTC_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:sr.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(rr===RGB_BPTC_SIGNED_Format)return sr.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(rr===RGB_BPTC_UNSIGNED_Format)return sr.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(rr===RED_RGTC1_Format||rr===SIGNED_RED_RGTC1_Format||rr===RED_GREEN_RGTC2_Format||rr===SIGNED_RED_GREEN_RGTC2_Format)if(sr=er.get("EXT_texture_compression_rgtc"),sr!==null){if(rr===RGBA_BPTC_Format)return sr.COMPRESSED_RED_RGTC1_EXT;if(rr===SIGNED_RED_RGTC1_Format)return sr.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(rr===RED_GREEN_RGTC2_Format)return sr.COMPRESSED_RED_GREEN_RGTC2_EXT;if(rr===SIGNED_RED_GREEN_RGTC2_Format)return sr.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return rr===UnsignedInt248Type?ir.UNSIGNED_INT_24_8:ir[rr]!==void 0?ir[rr]:null}return{convert:tr}}const _occlusion_vertex=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,_occlusion_fragment=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WebXRDepthSensing{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(er,tr,rr){if(this.texture===null){const nr=new Texture,sr=er.properties.get(nr);sr.__webglTexture=tr.texture,(tr.depthNear!==rr.depthNear||tr.depthFar!==rr.depthFar)&&(this.depthNear=tr.depthNear,this.depthFar=tr.depthFar),this.texture=nr}}getMesh(er){if(this.texture!==null&&this.mesh===null){const tr=er.cameras[0].viewport,rr=new ShaderMaterial({vertexShader:_occlusion_vertex,fragmentShader:_occlusion_fragment,uniforms:{depthColor:{value:this.texture},depthWidth:{value:tr.z},depthHeight:{value:tr.w}}});this.mesh=new Mesh(new PlaneGeometry(20,20),rr)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class WebXRManager extends EventDispatcher{constructor(er,tr){super();const rr=this;let nr=null,sr=1,ar=null,or="local-floor",lr=1,cr=null,hr=null,fr=null,ur=null,pr=null,gr=null;const _r=new WebXRDepthSensing,mr=tr.getContextAttributes();let dr=null,vr=null;const Ar=[],yr=[],wr=new Vector2;let br=null;const Sr=new PerspectiveCamera;Sr.viewport=new Vector4;const xr=new PerspectiveCamera;xr.viewport=new Vector4;const Cr=[Sr,xr],Ir=new ArrayCamera;let Rr=null,Pr=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Kr){let Qr=Ar[Kr];return Qr===void 0&&(Qr=new WebXRController,Ar[Kr]=Qr),Qr.getTargetRaySpace()},this.getControllerGrip=function(Kr){let Qr=Ar[Kr];return Qr===void 0&&(Qr=new WebXRController,Ar[Kr]=Qr),Qr.getGripSpace()},this.getHand=function(Kr){let Qr=Ar[Kr];return Qr===void 0&&(Qr=new WebXRController,Ar[Kr]=Qr),Qr.getHandSpace()};function Fr(Kr){const Qr=yr.indexOf(Kr.inputSource);if(Qr===-1)return;const Vr=Ar[Qr];Vr!==void 0&&(Vr.update(Kr.inputSource,Kr.frame,cr||ar),Vr.dispatchEvent({type:Kr.type,data:Kr.inputSource}))}function Nr(){nr.removeEventListener("select",Fr),nr.removeEventListener("selectstart",Fr),nr.removeEventListener("selectend",Fr),nr.removeEventListener("squeeze",Fr),nr.removeEventListener("squeezestart",Fr),nr.removeEventListener("squeezeend",Fr),nr.removeEventListener("end",Nr),nr.removeEventListener("inputsourceschange",Ur);for(let Kr=0;Kr<Ar.length;Kr++){const Qr=yr[Kr];Qr!==null&&(yr[Kr]=null,Ar[Kr].disconnect(Qr))}Rr=null,Pr=null,_r.reset(),er.setRenderTarget(dr),pr=null,ur=null,fr=null,nr=null,vr=null,rs.stop(),rr.isPresenting=!1,er.setPixelRatio(br),er.setSize(wr.width,wr.height,!1),rr.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Kr){sr=Kr,rr.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Kr){or=Kr,rr.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return cr||ar},this.setReferenceSpace=function(Kr){cr=Kr},this.getBaseLayer=function(){return ur!==null?ur:pr},this.getBinding=function(){return fr},this.getFrame=function(){return gr},this.getSession=function(){return nr},this.setSession=async function(Kr){if(nr=Kr,nr!==null){if(dr=er.getRenderTarget(),nr.addEventListener("select",Fr),nr.addEventListener("selectstart",Fr),nr.addEventListener("selectend",Fr),nr.addEventListener("squeeze",Fr),nr.addEventListener("squeezestart",Fr),nr.addEventListener("squeezeend",Fr),nr.addEventListener("end",Nr),nr.addEventListener("inputsourceschange",Ur),mr.xrCompatible!==!0&&await tr.makeXRCompatible(),br=er.getPixelRatio(),er.getSize(wr),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Vr=null,Gr=null,qr=null;mr.depth&&(qr=mr.stencil?tr.DEPTH24_STENCIL8:tr.DEPTH_COMPONENT24,Vr=mr.stencil?DepthStencilFormat:DepthFormat,Gr=mr.stencil?UnsignedInt248Type:UnsignedIntType);const ji={colorFormat:tr.RGBA8,depthFormat:qr,scaleFactor:sr};fr=new XRWebGLBinding(nr,tr),ur=fr.createProjectionLayer(ji),nr.updateRenderState({layers:[ur]}),er.setPixelRatio(1),er.setSize(ur.textureWidth,ur.textureHeight,!1),vr=new WebGLRenderTarget(ur.textureWidth,ur.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(ur.textureWidth,ur.textureHeight,Gr,void 0,void 0,void 0,void 0,void 0,void 0,Vr),stencilBuffer:mr.stencil,colorSpace:er.outputColorSpace,samples:mr.antialias?4:0,resolveDepthBuffer:ur.ignoreDepthValues===!1})}else{const Vr={antialias:mr.antialias,alpha:!0,depth:mr.depth,stencil:mr.stencil,framebufferScaleFactor:sr};pr=new XRWebGLLayer(nr,tr,Vr),nr.updateRenderState({baseLayer:pr}),er.setPixelRatio(1),er.setSize(pr.framebufferWidth,pr.framebufferHeight,!1),vr=new WebGLRenderTarget(pr.framebufferWidth,pr.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:er.outputColorSpace,stencilBuffer:mr.stencil})}vr.isXRRenderTarget=!0,this.setFoveation(lr),cr=null,ar=await nr.requestReferenceSpace(or),rs.setContext(nr),rs.start(),rr.isPresenting=!0,rr.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(nr!==null)return nr.environmentBlendMode},this.getDepthTexture=function(){return _r.getDepthTexture()};function Ur(Kr){for(let Qr=0;Qr<Kr.removed.length;Qr++){const Vr=Kr.removed[Qr],Gr=yr.indexOf(Vr);Gr>=0&&(yr[Gr]=null,Ar[Gr].disconnect(Vr))}for(let Qr=0;Qr<Kr.added.length;Qr++){const Vr=Kr.added[Qr];let Gr=yr.indexOf(Vr);if(Gr===-1){for(let ji=0;ji<Ar.length;ji++)if(ji>=yr.length){yr.push(Vr),Gr=ji;break}else if(yr[ji]===null){yr[ji]=Vr,Gr=ji;break}if(Gr===-1)break}const qr=Ar[Gr];qr&&qr.connect(Vr)}}const Br=new Vector3$1,Or=new Vector3$1;function Dr(Kr,Qr,Vr){Br.setFromMatrixPosition(Qr.matrixWorld),Or.setFromMatrixPosition(Vr.matrixWorld);const Gr=Br.distanceTo(Or),qr=Qr.projectionMatrix.elements,ji=Vr.projectionMatrix.elements,Zr=qr[14]/(qr[10]-1),Zi=qr[14]/(qr[10]+1),Yi=(qr[9]+1)/qr[5],qi=(qr[9]-1)/qr[5],Xr=(qr[8]-1)/qr[0],ns=(ji[8]+1)/ji[0],os=Zr*Xr,us=Zr*ns,is=Gr/(-Xr+ns),Ji=is*-Xr;if(Qr.matrixWorld.decompose(Kr.position,Kr.quaternion,Kr.scale),Kr.translateX(Ji),Kr.translateZ(is),Kr.matrixWorld.compose(Kr.position,Kr.quaternion,Kr.scale),Kr.matrixWorldInverse.copy(Kr.matrixWorld).invert(),qr[10]===-1)Kr.projectionMatrix.copy(Qr.projectionMatrix),Kr.projectionMatrixInverse.copy(Qr.projectionMatrixInverse);else{const ms=Zr+is,Ki=Zi+is,Ni=os-Ji,Ri=us+(Gr-Ji),Jr=Yi*Zi/Ki*ms,Xi=qi*Zi/Ki*ms;Kr.projectionMatrix.makePerspective(Ni,Ri,Jr,Xi,ms,Ki),Kr.projectionMatrixInverse.copy(Kr.projectionMatrix).invert()}}function Wr(Kr,Qr){Qr===null?Kr.matrixWorld.copy(Kr.matrix):Kr.matrixWorld.multiplyMatrices(Qr.matrixWorld,Kr.matrix),Kr.matrixWorldInverse.copy(Kr.matrixWorld).invert()}this.updateCamera=function(Kr){if(nr===null)return;let Qr=Kr.near,Vr=Kr.far;_r.texture!==null&&(_r.depthNear>0&&(Qr=_r.depthNear),_r.depthFar>0&&(Vr=_r.depthFar)),Ir.near=xr.near=Sr.near=Qr,Ir.far=xr.far=Sr.far=Vr,(Rr!==Ir.near||Pr!==Ir.far)&&(nr.updateRenderState({depthNear:Ir.near,depthFar:Ir.far}),Rr=Ir.near,Pr=Ir.far),Sr.layers.mask=Kr.layers.mask|2,xr.layers.mask=Kr.layers.mask|4,Ir.layers.mask=Sr.layers.mask|xr.layers.mask;const Gr=Kr.parent,qr=Ir.cameras;Wr(Ir,Gr);for(let ji=0;ji<qr.length;ji++)Wr(qr[ji],Gr);qr.length===2?Dr(Ir,Sr,xr):Ir.projectionMatrix.copy(Sr.projectionMatrix),$r(Kr,Ir,Gr)};function $r(Kr,Qr,Vr){Vr===null?Kr.matrix.copy(Qr.matrixWorld):(Kr.matrix.copy(Vr.matrixWorld),Kr.matrix.invert(),Kr.matrix.multiply(Qr.matrixWorld)),Kr.matrix.decompose(Kr.position,Kr.quaternion,Kr.scale),Kr.updateMatrixWorld(!0),Kr.projectionMatrix.copy(Qr.projectionMatrix),Kr.projectionMatrixInverse.copy(Qr.projectionMatrixInverse),Kr.isPerspectiveCamera&&(Kr.fov=RAD2DEG*2*Math.atan(1/Kr.projectionMatrix.elements[5]),Kr.zoom=1)}this.getCamera=function(){return Ir},this.getFoveation=function(){if(!(ur===null&&pr===null))return lr},this.setFoveation=function(Kr){lr=Kr,ur!==null&&(ur.fixedFoveation=Kr),pr!==null&&pr.fixedFoveation!==void 0&&(pr.fixedFoveation=Kr)},this.hasDepthSensing=function(){return _r.texture!==null},this.getDepthSensingMesh=function(){return _r.getMesh(Ir)};let Yr=null;function Qi(Kr,Qr){if(hr=Qr.getViewerPose(cr||ar),gr=Qr,hr!==null){const Vr=hr.views;pr!==null&&(er.setRenderTargetFramebuffer(vr,pr.framebuffer),er.setRenderTarget(vr));let Gr=!1;Vr.length!==Ir.cameras.length&&(Ir.cameras.length=0,Gr=!0);for(let Zr=0;Zr<Vr.length;Zr++){const Zi=Vr[Zr];let Yi=null;if(pr!==null)Yi=pr.getViewport(Zi);else{const Xr=fr.getViewSubImage(ur,Zi);Yi=Xr.viewport,Zr===0&&(er.setRenderTargetTextures(vr,Xr.colorTexture,ur.ignoreDepthValues?void 0:Xr.depthStencilTexture),er.setRenderTarget(vr))}let qi=Cr[Zr];qi===void 0&&(qi=new PerspectiveCamera,qi.layers.enable(Zr),qi.viewport=new Vector4,Cr[Zr]=qi),qi.matrix.fromArray(Zi.transform.matrix),qi.matrix.decompose(qi.position,qi.quaternion,qi.scale),qi.projectionMatrix.fromArray(Zi.projectionMatrix),qi.projectionMatrixInverse.copy(qi.projectionMatrix).invert(),qi.viewport.set(Yi.x,Yi.y,Yi.width,Yi.height),Zr===0&&(Ir.matrix.copy(qi.matrix),Ir.matrix.decompose(Ir.position,Ir.quaternion,Ir.scale)),Gr===!0&&Ir.cameras.push(qi)}const qr=nr.enabledFeatures;if(qr&&qr.includes("depth-sensing")&&nr.depthUsage=="gpu-optimized"&&fr){const Zr=fr.getDepthInformation(Vr[0]);Zr&&Zr.isValid&&Zr.texture&&_r.init(er,Zr,nr.renderState)}}for(let Vr=0;Vr<Ar.length;Vr++){const Gr=yr[Vr],qr=Ar[Vr];Gr!==null&&qr!==void 0&&qr.update(Gr,Qr,cr||ar)}Yr&&Yr(Kr,Qr),Qr.detectedPlanes&&rr.dispatchEvent({type:"planesdetected",data:Qr}),gr=null}const rs=new WebGLAnimation;rs.setAnimationLoop(Qi),this.setAnimationLoop=function(Kr){Yr=Kr},this.dispose=function(){}}}const _e1=new Euler,_m1=new Matrix4;function WebGLMaterials(ir,er){function tr(mr,dr){mr.matrixAutoUpdate===!0&&mr.updateMatrix(),dr.value.copy(mr.matrix)}function rr(mr,dr){dr.color.getRGB(mr.fogColor.value,getUnlitUniformColorSpace(ir)),dr.isFog?(mr.fogNear.value=dr.near,mr.fogFar.value=dr.far):dr.isFogExp2&&(mr.fogDensity.value=dr.density)}function nr(mr,dr,vr,Ar,yr){dr.isMeshBasicMaterial||dr.isMeshLambertMaterial?sr(mr,dr):dr.isMeshToonMaterial?(sr(mr,dr),fr(mr,dr)):dr.isMeshPhongMaterial?(sr(mr,dr),hr(mr,dr)):dr.isMeshStandardMaterial?(sr(mr,dr),ur(mr,dr),dr.isMeshPhysicalMaterial&&pr(mr,dr,yr)):dr.isMeshMatcapMaterial?(sr(mr,dr),gr(mr,dr)):dr.isMeshDepthMaterial?sr(mr,dr):dr.isMeshDistanceMaterial?(sr(mr,dr),_r(mr,dr)):dr.isMeshNormalMaterial?sr(mr,dr):dr.isLineBasicMaterial?(ar(mr,dr),dr.isLineDashedMaterial&&or(mr,dr)):dr.isPointsMaterial?lr(mr,dr,vr,Ar):dr.isSpriteMaterial?cr(mr,dr):dr.isShadowMaterial?(mr.color.value.copy(dr.color),mr.opacity.value=dr.opacity):dr.isShaderMaterial&&(dr.uniformsNeedUpdate=!1)}function sr(mr,dr){mr.opacity.value=dr.opacity,dr.color&&mr.diffuse.value.copy(dr.color),dr.emissive&&mr.emissive.value.copy(dr.emissive).multiplyScalar(dr.emissiveIntensity),dr.map&&(mr.map.value=dr.map,tr(dr.map,mr.mapTransform)),dr.alphaMap&&(mr.alphaMap.value=dr.alphaMap,tr(dr.alphaMap,mr.alphaMapTransform)),dr.bumpMap&&(mr.bumpMap.value=dr.bumpMap,tr(dr.bumpMap,mr.bumpMapTransform),mr.bumpScale.value=dr.bumpScale,dr.side===BackSide&&(mr.bumpScale.value*=-1)),dr.normalMap&&(mr.normalMap.value=dr.normalMap,tr(dr.normalMap,mr.normalMapTransform),mr.normalScale.value.copy(dr.normalScale),dr.side===BackSide&&mr.normalScale.value.negate()),dr.displacementMap&&(mr.displacementMap.value=dr.displacementMap,tr(dr.displacementMap,mr.displacementMapTransform),mr.displacementScale.value=dr.displacementScale,mr.displacementBias.value=dr.displacementBias),dr.emissiveMap&&(mr.emissiveMap.value=dr.emissiveMap,tr(dr.emissiveMap,mr.emissiveMapTransform)),dr.specularMap&&(mr.specularMap.value=dr.specularMap,tr(dr.specularMap,mr.specularMapTransform)),dr.alphaTest>0&&(mr.alphaTest.value=dr.alphaTest);const vr=er.get(dr),Ar=vr.envMap,yr=vr.envMapRotation;Ar&&(mr.envMap.value=Ar,_e1.copy(yr),_e1.x*=-1,_e1.y*=-1,_e1.z*=-1,Ar.isCubeTexture&&Ar.isRenderTargetTexture===!1&&(_e1.y*=-1,_e1.z*=-1),mr.envMapRotation.value.setFromMatrix4(_m1.makeRotationFromEuler(_e1)),mr.flipEnvMap.value=Ar.isCubeTexture&&Ar.isRenderTargetTexture===!1?-1:1,mr.reflectivity.value=dr.reflectivity,mr.ior.value=dr.ior,mr.refractionRatio.value=dr.refractionRatio),dr.lightMap&&(mr.lightMap.value=dr.lightMap,mr.lightMapIntensity.value=dr.lightMapIntensity,tr(dr.lightMap,mr.lightMapTransform)),dr.aoMap&&(mr.aoMap.value=dr.aoMap,mr.aoMapIntensity.value=dr.aoMapIntensity,tr(dr.aoMap,mr.aoMapTransform))}function ar(mr,dr){mr.diffuse.value.copy(dr.color),mr.opacity.value=dr.opacity,dr.map&&(mr.map.value=dr.map,tr(dr.map,mr.mapTransform))}function or(mr,dr){mr.dashSize.value=dr.dashSize,mr.totalSize.value=dr.dashSize+dr.gapSize,mr.scale.value=dr.scale}function lr(mr,dr,vr,Ar){mr.diffuse.value.copy(dr.color),mr.opacity.value=dr.opacity,mr.size.value=dr.size*vr,mr.scale.value=Ar*.5,dr.map&&(mr.map.value=dr.map,tr(dr.map,mr.uvTransform)),dr.alphaMap&&(mr.alphaMap.value=dr.alphaMap,tr(dr.alphaMap,mr.alphaMapTransform)),dr.alphaTest>0&&(mr.alphaTest.value=dr.alphaTest)}function cr(mr,dr){mr.diffuse.value.copy(dr.color),mr.opacity.value=dr.opacity,mr.rotation.value=dr.rotation,dr.map&&(mr.map.value=dr.map,tr(dr.map,mr.mapTransform)),dr.alphaMap&&(mr.alphaMap.value=dr.alphaMap,tr(dr.alphaMap,mr.alphaMapTransform)),dr.alphaTest>0&&(mr.alphaTest.value=dr.alphaTest)}function hr(mr,dr){mr.specular.value.copy(dr.specular),mr.shininess.value=Math.max(dr.shininess,1e-4)}function fr(mr,dr){dr.gradientMap&&(mr.gradientMap.value=dr.gradientMap)}function ur(mr,dr){mr.metalness.value=dr.metalness,dr.metalnessMap&&(mr.metalnessMap.value=dr.metalnessMap,tr(dr.metalnessMap,mr.metalnessMapTransform)),mr.roughness.value=dr.roughness,dr.roughnessMap&&(mr.roughnessMap.value=dr.roughnessMap,tr(dr.roughnessMap,mr.roughnessMapTransform)),dr.envMap&&(mr.envMapIntensity.value=dr.envMapIntensity)}function pr(mr,dr,vr){mr.ior.value=dr.ior,dr.sheen>0&&(mr.sheenColor.value.copy(dr.sheenColor).multiplyScalar(dr.sheen),mr.sheenRoughness.value=dr.sheenRoughness,dr.sheenColorMap&&(mr.sheenColorMap.value=dr.sheenColorMap,tr(dr.sheenColorMap,mr.sheenColorMapTransform)),dr.sheenRoughnessMap&&(mr.sheenRoughnessMap.value=dr.sheenRoughnessMap,tr(dr.sheenRoughnessMap,mr.sheenRoughnessMapTransform))),dr.clearcoat>0&&(mr.clearcoat.value=dr.clearcoat,mr.clearcoatRoughness.value=dr.clearcoatRoughness,dr.clearcoatMap&&(mr.clearcoatMap.value=dr.clearcoatMap,tr(dr.clearcoatMap,mr.clearcoatMapTransform)),dr.clearcoatRoughnessMap&&(mr.clearcoatRoughnessMap.value=dr.clearcoatRoughnessMap,tr(dr.clearcoatRoughnessMap,mr.clearcoatRoughnessMapTransform)),dr.clearcoatNormalMap&&(mr.clearcoatNormalMap.value=dr.clearcoatNormalMap,tr(dr.clearcoatNormalMap,mr.clearcoatNormalMapTransform),mr.clearcoatNormalScale.value.copy(dr.clearcoatNormalScale),dr.side===BackSide&&mr.clearcoatNormalScale.value.negate())),dr.dispersion>0&&(mr.dispersion.value=dr.dispersion),dr.iridescence>0&&(mr.iridescence.value=dr.iridescence,mr.iridescenceIOR.value=dr.iridescenceIOR,mr.iridescenceThicknessMinimum.value=dr.iridescenceThicknessRange[0],mr.iridescenceThicknessMaximum.value=dr.iridescenceThicknessRange[1],dr.iridescenceMap&&(mr.iridescenceMap.value=dr.iridescenceMap,tr(dr.iridescenceMap,mr.iridescenceMapTransform)),dr.iridescenceThicknessMap&&(mr.iridescenceThicknessMap.value=dr.iridescenceThicknessMap,tr(dr.iridescenceThicknessMap,mr.iridescenceThicknessMapTransform))),dr.transmission>0&&(mr.transmission.value=dr.transmission,mr.transmissionSamplerMap.value=vr.texture,mr.transmissionSamplerSize.value.set(vr.width,vr.height),dr.transmissionMap&&(mr.transmissionMap.value=dr.transmissionMap,tr(dr.transmissionMap,mr.transmissionMapTransform)),mr.thickness.value=dr.thickness,dr.thicknessMap&&(mr.thicknessMap.value=dr.thicknessMap,tr(dr.thicknessMap,mr.thicknessMapTransform)),mr.attenuationDistance.value=dr.attenuationDistance,mr.attenuationColor.value.copy(dr.attenuationColor)),dr.anisotropy>0&&(mr.anisotropyVector.value.set(dr.anisotropy*Math.cos(dr.anisotropyRotation),dr.anisotropy*Math.sin(dr.anisotropyRotation)),dr.anisotropyMap&&(mr.anisotropyMap.value=dr.anisotropyMap,tr(dr.anisotropyMap,mr.anisotropyMapTransform))),mr.specularIntensity.value=dr.specularIntensity,mr.specularColor.value.copy(dr.specularColor),dr.specularColorMap&&(mr.specularColorMap.value=dr.specularColorMap,tr(dr.specularColorMap,mr.specularColorMapTransform)),dr.specularIntensityMap&&(mr.specularIntensityMap.value=dr.specularIntensityMap,tr(dr.specularIntensityMap,mr.specularIntensityMapTransform))}function gr(mr,dr){dr.matcap&&(mr.matcap.value=dr.matcap)}function _r(mr,dr){const vr=er.get(dr).light;mr.referencePosition.value.setFromMatrixPosition(vr.matrixWorld),mr.nearDistance.value=vr.shadow.camera.near,mr.farDistance.value=vr.shadow.camera.far}return{refreshFogUniforms:rr,refreshMaterialUniforms:nr}}function WebGLUniformsGroups(ir,er,tr,rr){let nr={},sr={},ar=[];const or=ir.getParameter(ir.MAX_UNIFORM_BUFFER_BINDINGS);function lr(vr,Ar){const yr=Ar.program;rr.uniformBlockBinding(vr,yr)}function cr(vr,Ar){let yr=nr[vr.id];yr===void 0&&(gr(vr),yr=hr(vr),nr[vr.id]=yr,vr.addEventListener("dispose",mr));const wr=Ar.program;rr.updateUBOMapping(vr,wr);const br=er.render.frame;sr[vr.id]!==br&&(ur(vr),sr[vr.id]=br)}function hr(vr){const Ar=fr();vr.__bindingPointIndex=Ar;const yr=ir.createBuffer(),wr=vr.__size,br=vr.usage;return ir.bindBuffer(ir.UNIFORM_BUFFER,yr),ir.bufferData(ir.UNIFORM_BUFFER,wr,br),ir.bindBuffer(ir.UNIFORM_BUFFER,null),ir.bindBufferBase(ir.UNIFORM_BUFFER,Ar,yr),yr}function fr(){for(let vr=0;vr<or;vr++)if(ar.indexOf(vr)===-1)return ar.push(vr),vr;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function ur(vr){const Ar=nr[vr.id],yr=vr.uniforms,wr=vr.__cache;ir.bindBuffer(ir.UNIFORM_BUFFER,Ar);for(let br=0,Sr=yr.length;br<Sr;br++){const xr=Array.isArray(yr[br])?yr[br]:[yr[br]];for(let Cr=0,Ir=xr.length;Cr<Ir;Cr++){const Rr=xr[Cr];if(pr(Rr,br,Cr,wr)===!0){const Pr=Rr.__offset,Fr=Array.isArray(Rr.value)?Rr.value:[Rr.value];let Nr=0;for(let Ur=0;Ur<Fr.length;Ur++){const Br=Fr[Ur],Or=_r(Br);typeof Br=="number"||typeof Br=="boolean"?(Rr.__data[0]=Br,ir.bufferSubData(ir.UNIFORM_BUFFER,Pr+Nr,Rr.__data)):Br.isMatrix3?(Rr.__data[0]=Br.elements[0],Rr.__data[1]=Br.elements[1],Rr.__data[2]=Br.elements[2],Rr.__data[3]=0,Rr.__data[4]=Br.elements[3],Rr.__data[5]=Br.elements[4],Rr.__data[6]=Br.elements[5],Rr.__data[7]=0,Rr.__data[8]=Br.elements[6],Rr.__data[9]=Br.elements[7],Rr.__data[10]=Br.elements[8],Rr.__data[11]=0):(Br.toArray(Rr.__data,Nr),Nr+=Or.storage/Float32Array.BYTES_PER_ELEMENT)}ir.bufferSubData(ir.UNIFORM_BUFFER,Pr,Rr.__data)}}}ir.bindBuffer(ir.UNIFORM_BUFFER,null)}function pr(vr,Ar,yr,wr){const br=vr.value,Sr=Ar+"_"+yr;if(wr[Sr]===void 0)return typeof br=="number"||typeof br=="boolean"?wr[Sr]=br:wr[Sr]=br.clone(),!0;{const xr=wr[Sr];if(typeof br=="number"||typeof br=="boolean"){if(xr!==br)return wr[Sr]=br,!0}else if(xr.equals(br)===!1)return xr.copy(br),!0}return!1}function gr(vr){const Ar=vr.uniforms;let yr=0;const wr=16;for(let Sr=0,xr=Ar.length;Sr<xr;Sr++){const Cr=Array.isArray(Ar[Sr])?Ar[Sr]:[Ar[Sr]];for(let Ir=0,Rr=Cr.length;Ir<Rr;Ir++){const Pr=Cr[Ir],Fr=Array.isArray(Pr.value)?Pr.value:[Pr.value];for(let Nr=0,Ur=Fr.length;Nr<Ur;Nr++){const Br=Fr[Nr],Or=_r(Br),Dr=yr%wr,Wr=Dr%Or.boundary,$r=Dr+Wr;yr+=Wr,$r!==0&&wr-$r<Or.storage&&(yr+=wr-$r),Pr.__data=new Float32Array(Or.storage/Float32Array.BYTES_PER_ELEMENT),Pr.__offset=yr,yr+=Or.storage}}}const br=yr%wr;return br>0&&(yr+=wr-br),vr.__size=yr,vr.__cache={},this}function _r(vr){const Ar={boundary:0,storage:0};return typeof vr=="number"||typeof vr=="boolean"?(Ar.boundary=4,Ar.storage=4):vr.isVector2?(Ar.boundary=8,Ar.storage=8):vr.isVector3||vr.isColor?(Ar.boundary=16,Ar.storage=12):vr.isVector4?(Ar.boundary=16,Ar.storage=16):vr.isMatrix3?(Ar.boundary=48,Ar.storage=48):vr.isMatrix4?(Ar.boundary=64,Ar.storage=64):vr.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",vr),Ar}function mr(vr){const Ar=vr.target;Ar.removeEventListener("dispose",mr);const yr=ar.indexOf(Ar.__bindingPointIndex);ar.splice(yr,1),ir.deleteBuffer(nr[Ar.id]),delete nr[Ar.id],delete sr[Ar.id]}function dr(){for(const vr in nr)ir.deleteBuffer(nr[vr]);ar=[],nr={},sr={}}return{bind:lr,update:cr,dispose:dr}}class WebGLRenderer{constructor(er={}){const{canvas:tr=createCanvasElement(),context:rr=null,depth:nr=!0,stencil:sr=!1,alpha:ar=!1,antialias:or=!1,premultipliedAlpha:lr=!0,preserveDrawingBuffer:cr=!1,powerPreference:hr="default",failIfMajorPerformanceCaveat:fr=!1,reverseDepthBuffer:ur=!1}=er;this.isWebGLRenderer=!0;let pr;if(rr!==null){if(typeof WebGLRenderingContext<"u"&&rr instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");pr=rr.getContextAttributes().alpha}else pr=ar;const gr=new Uint32Array(4),_r=new Int32Array(4);let mr=null,dr=null;const vr=[],Ar=[];this.domElement=tr,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const yr=this;let wr=!1,br=0,Sr=0,xr=null,Cr=-1,Ir=null;const Rr=new Vector4,Pr=new Vector4;let Fr=null;const Nr=new Color(0);let Ur=0,Br=tr.width,Or=tr.height,Dr=1,Wr=null,$r=null;const Yr=new Vector4(0,0,Br,Or),Qi=new Vector4(0,0,Br,Or);let rs=!1;const Kr=new Frustum;let Qr=!1,Vr=!1;this.transmissionResolutionScale=1;const Gr=new Matrix4,qr=new Matrix4,ji=new Vector3$1,Zr=new Vector4,Zi={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Yi=!1;function qi(){return xr===null?Dr:1}let Xr=rr;function ns($i,ds){return tr.getContext($i,ds)}try{const $i={alpha:!0,depth:nr,stencil:sr,antialias:or,premultipliedAlpha:lr,preserveDrawingBuffer:cr,powerPreference:hr,failIfMajorPerformanceCaveat:fr};if("setAttribute"in tr&&tr.setAttribute("data-engine",`three.js r${REVISION}`),tr.addEventListener("webglcontextlost",Ps,!1),tr.addEventListener("webglcontextrestored",Qs,!1),tr.addEventListener("webglcontextcreationerror",Hs,!1),Xr===null){const ds="webgl2";if(Xr=ns(ds,$i),Xr===null)throw ns(ds)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch($i){throw console.error("THREE.WebGLRenderer: "+$i.message),$i}let os,us,is,Ji,ms,Ki,Ni,Ri,Jr,Xi,ss,ls,gs,_s,vs,As,Ss,Is,Fs,Ns,Ws,ks,Vs,bs;function Ms(){os=new WebGLExtensions(Xr),os.init(),ks=new WebGLUtils(Xr,os),us=new WebGLCapabilities(Xr,os,er,ks),is=new WebGLState(Xr,os),us.reverseDepthBuffer&&ur&&is.buffers.depth.setReversed(!0),Ji=new WebGLInfo(Xr),ms=new WebGLProperties,Ki=new WebGLTextures(Xr,os,is,ms,us,ks,Ji),Ni=new WebGLCubeMaps(yr),Ri=new WebGLCubeUVMaps(yr),Jr=new WebGLAttributes(Xr),Vs=new WebGLBindingStates(Xr,Jr),Xi=new WebGLGeometries(Xr,Jr,Ji,Vs),ss=new WebGLObjects(Xr,Xi,Jr,Ji),Fs=new WebGLMorphtargets(Xr,us,Ki),As=new WebGLClipping(ms),ls=new WebGLPrograms(yr,Ni,Ri,os,us,Vs,As),gs=new WebGLMaterials(yr,ms),_s=new WebGLRenderLists,vs=new WebGLRenderStates(os),Is=new WebGLBackground(yr,Ni,Ri,is,ss,pr,lr),Ss=new WebGLShadowMap(yr,ss,us),bs=new WebGLUniformsGroups(Xr,Ji,us,is),Ns=new WebGLBufferRenderer(Xr,os,Ji),Ws=new WebGLIndexedBufferRenderer(Xr,os,Ji),Ji.programs=ls.programs,yr.capabilities=us,yr.extensions=os,yr.properties=ms,yr.renderLists=_s,yr.shadowMap=Ss,yr.state=is,yr.info=Ji}Ms();const Cs=new WebXRManager(yr,Xr);this.xr=Cs,this.getContext=function(){return Xr},this.getContextAttributes=function(){return Xr.getContextAttributes()},this.forceContextLoss=function(){const $i=os.get("WEBGL_lose_context");$i&&$i.loseContext()},this.forceContextRestore=function(){const $i=os.get("WEBGL_lose_context");$i&&$i.restoreContext()},this.getPixelRatio=function(){return Dr},this.setPixelRatio=function($i){$i!==void 0&&(Dr=$i,this.setSize(Br,Or,!1))},this.getSize=function($i){return $i.set(Br,Or)},this.setSize=function($i,ds,ps=!0){if(Cs.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Br=$i,Or=ds,tr.width=Math.floor($i*Dr),tr.height=Math.floor(ds*Dr),ps===!0&&(tr.style.width=$i+"px",tr.style.height=ds+"px"),this.setViewport(0,0,$i,ds)},this.getDrawingBufferSize=function($i){return $i.set(Br*Dr,Or*Dr).floor()},this.setDrawingBufferSize=function($i,ds,ps){Br=$i,Or=ds,Dr=ps,tr.width=Math.floor($i*ps),tr.height=Math.floor(ds*ps),this.setViewport(0,0,$i,ds)},this.getCurrentViewport=function($i){return $i.copy(Rr)},this.getViewport=function($i){return $i.copy(Yr)},this.setViewport=function($i,ds,ps,ws){$i.isVector4?Yr.set($i.x,$i.y,$i.z,$i.w):Yr.set($i,ds,ps,ws),is.viewport(Rr.copy(Yr).multiplyScalar(Dr).round())},this.getScissor=function($i){return $i.copy(Qi)},this.setScissor=function($i,ds,ps,ws){$i.isVector4?Qi.set($i.x,$i.y,$i.z,$i.w):Qi.set($i,ds,ps,ws),is.scissor(Pr.copy(Qi).multiplyScalar(Dr).round())},this.getScissorTest=function(){return rs},this.setScissorTest=function($i){is.setScissorTest(rs=$i)},this.setOpaqueSort=function($i){Wr=$i},this.setTransparentSort=function($i){$r=$i},this.getClearColor=function($i){return $i.copy(Is.getClearColor())},this.setClearColor=function(){Is.setClearColor.apply(Is,arguments)},this.getClearAlpha=function(){return Is.getClearAlpha()},this.setClearAlpha=function(){Is.setClearAlpha.apply(Is,arguments)},this.clear=function($i=!0,ds=!0,ps=!0){let ws=0;if($i){let ys=!1;if(xr!==null){const Es=xr.texture.format;ys=Es===RGBAIntegerFormat||Es===RGIntegerFormat||Es===RedIntegerFormat}if(ys){const Es=xr.texture.type,Ts=Es===UnsignedByteType||Es===UnsignedIntType||Es===UnsignedShortType||Es===UnsignedInt248Type||Es===UnsignedShort4444Type||Es===UnsignedShort5551Type,Rs=Is.getClearColor(),Ds=Is.getClearAlpha(),Us=Rs.r,Os=Rs.g,Gs=Rs.b;Ts?(gr[0]=Us,gr[1]=Os,gr[2]=Gs,gr[3]=Ds,Xr.clearBufferuiv(Xr.COLOR,0,gr)):(_r[0]=Us,_r[1]=Os,_r[2]=Gs,_r[3]=Ds,Xr.clearBufferiv(Xr.COLOR,0,_r))}else ws|=Xr.COLOR_BUFFER_BIT}ds&&(ws|=Xr.DEPTH_BUFFER_BIT),ps&&(ws|=Xr.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Xr.clear(ws)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){tr.removeEventListener("webglcontextlost",Ps,!1),tr.removeEventListener("webglcontextrestored",Qs,!1),tr.removeEventListener("webglcontextcreationerror",Hs,!1),Is.dispose(),_s.dispose(),vs.dispose(),ms.dispose(),Ni.dispose(),Ri.dispose(),ss.dispose(),Vs.dispose(),bs.dispose(),ls.dispose(),Cs.dispose(),Cs.removeEventListener("sessionstart",Zs),Cs.removeEventListener("sessionend",ha),Ta.stop()};function Ps($i){$i.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),wr=!0}function Qs(){console.log("THREE.WebGLRenderer: Context Restored."),wr=!1;const $i=Ji.autoReset,ds=Ss.enabled,ps=Ss.autoUpdate,ws=Ss.needsUpdate,ys=Ss.type;Ms(),Ji.autoReset=$i,Ss.enabled=ds,Ss.autoUpdate=ps,Ss.needsUpdate=ws,Ss.type=ys}function Hs($i){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",$i.statusMessage)}function ta($i){const ds=$i.target;ds.removeEventListener("dispose",ta),Sa(ds)}function Sa($i){ga($i),ms.remove($i)}function ga($i){const ds=ms.get($i).programs;ds!==void 0&&(ds.forEach(function(ps){ls.releaseProgram(ps)}),$i.isShaderMaterial&&ls.releaseShaderCache($i))}this.renderBufferDirect=function($i,ds,ps,ws,ys,Es){ds===null&&(ds=Zi);const Ts=ys.isMesh&&ys.matrixWorld.determinant()<0,Rs=ao($i,ds,ps,ws,ys);is.setMaterial(ws,Ts);let Ds=ps.index,Us=1;if(ws.wireframe===!0){if(Ds=Xi.getWireframeAttribute(ps),Ds===void 0)return;Us=2}const Os=ps.drawRange,Gs=ps.attributes.position;let zs=Os.start*Us,Xs=(Os.start+Os.count)*Us;Es!==null&&(zs=Math.max(zs,Es.start*Us),Xs=Math.min(Xs,(Es.start+Es.count)*Us)),Ds!==null?(zs=Math.max(zs,0),Xs=Math.min(Xs,Ds.count)):Gs!=null&&(zs=Math.max(zs,0),Xs=Math.min(Xs,Gs.count));const na=Xs-zs;if(na<0||na===1/0)return;Vs.setup(ys,ws,Rs,ps,Ds);let wa,fa=Ns;if(Ds!==null&&(wa=Jr.get(Ds),fa=Ws,fa.setIndex(wa)),ys.isMesh)ws.wireframe===!0?(is.setLineWidth(ws.wireframeLinewidth*qi()),fa.setMode(Xr.LINES)):fa.setMode(Xr.TRIANGLES);else if(ys.isLine){let sa=ws.linewidth;sa===void 0&&(sa=1),is.setLineWidth(sa*qi()),ys.isLineSegments?fa.setMode(Xr.LINES):ys.isLineLoop?fa.setMode(Xr.LINE_LOOP):fa.setMode(Xr.LINE_STRIP)}else ys.isPoints?fa.setMode(Xr.POINTS):ys.isSprite&&fa.setMode(Xr.TRIANGLES);if(ys.isBatchedMesh)if(ys._multiDrawInstances!==null)fa.renderMultiDrawInstances(ys._multiDrawStarts,ys._multiDrawCounts,ys._multiDrawCount,ys._multiDrawInstances);else if(os.get("WEBGL_multi_draw"))fa.renderMultiDraw(ys._multiDrawStarts,ys._multiDrawCounts,ys._multiDrawCount);else{const sa=ys._multiDrawStarts,Ea=ys._multiDrawCounts,ca=ys._multiDrawCount,Da=Ds?Jr.get(Ds).bytesPerElement:1,Ma=ms.get(ws).currentProgram.getUniforms();for(let Pa=0;Pa<ca;Pa++)Ma.setValue(Xr,"_gl_DrawID",Pa),fa.render(sa[Pa]/Da,Ea[Pa])}else if(ys.isInstancedMesh)fa.renderInstances(zs,na,ys.count);else if(ps.isInstancedBufferGeometry){const sa=ps._maxInstanceCount!==void 0?ps._maxInstanceCount:1/0,Ea=Math.min(ps.instanceCount,sa);fa.renderInstances(zs,na,Ea)}else fa.render(zs,na)};function $s($i,ds,ps){$i.transparent===!0&&$i.side===DoubleSide&&$i.forceSinglePass===!1?($i.side=BackSide,$i.needsUpdate=!0,qa($i,ds,ps),$i.side=FrontSide,$i.needsUpdate=!0,qa($i,ds,ps),$i.side=DoubleSide):qa($i,ds,ps)}this.compile=function($i,ds,ps=null){ps===null&&(ps=$i),dr=vs.get(ps),dr.init(ds),Ar.push(dr),ps.traverseVisible(function(ys){ys.isLight&&ys.layers.test(ds.layers)&&(dr.pushLight(ys),ys.castShadow&&dr.pushShadow(ys))}),$i!==ps&&$i.traverseVisible(function(ys){ys.isLight&&ys.layers.test(ds.layers)&&(dr.pushLight(ys),ys.castShadow&&dr.pushShadow(ys))}),dr.setupLights();const ws=new Set;return $i.traverse(function(ys){if(!(ys.isMesh||ys.isPoints||ys.isLine||ys.isSprite))return;const Es=ys.material;if(Es)if(Array.isArray(Es))for(let Ts=0;Ts<Es.length;Ts++){const Rs=Es[Ts];$s(Rs,ps,ys),ws.add(Rs)}else $s(Es,ps,ys),ws.add(Es)}),Ar.pop(),dr=null,ws},this.compileAsync=function($i,ds,ps=null){const ws=this.compile($i,ds,ps);return new Promise(ys=>{function Es(){if(ws.forEach(function(Ts){ms.get(Ts).currentProgram.isReady()&&ws.delete(Ts)}),ws.size===0){ys($i);return}setTimeout(Es,10)}os.get("KHR_parallel_shader_compile")!==null?Es():setTimeout(Es,10)})};let Ks=null;function qs($i){Ks&&Ks($i)}function Zs(){Ta.stop()}function ha(){Ta.start()}const Ta=new WebGLAnimation;Ta.setAnimationLoop(qs),typeof self<"u"&&Ta.setContext(self),this.setAnimationLoop=function($i){Ks=$i,Cs.setAnimationLoop($i),$i===null?Ta.stop():Ta.start()},Cs.addEventListener("sessionstart",Zs),Cs.addEventListener("sessionend",ha),this.render=function($i,ds){if(ds!==void 0&&ds.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(wr===!0)return;if($i.matrixWorldAutoUpdate===!0&&$i.updateMatrixWorld(),ds.parent===null&&ds.matrixWorldAutoUpdate===!0&&ds.updateMatrixWorld(),Cs.enabled===!0&&Cs.isPresenting===!0&&(Cs.cameraAutoUpdate===!0&&Cs.updateCamera(ds),ds=Cs.getCamera()),$i.isScene===!0&&$i.onBeforeRender(yr,$i,ds,xr),dr=vs.get($i,Ar.length),dr.init(ds),Ar.push(dr),qr.multiplyMatrices(ds.projectionMatrix,ds.matrixWorldInverse),Kr.setFromProjectionMatrix(qr),Vr=this.localClippingEnabled,Qr=As.init(this.clippingPlanes,Vr),mr=_s.get($i,vr.length),mr.init(),vr.push(mr),Cs.enabled===!0&&Cs.isPresenting===!0){const Es=yr.xr.getDepthSensingMesh();Es!==null&&$a(Es,ds,-1/0,yr.sortObjects)}$a($i,ds,0,yr.sortObjects),mr.finish(),yr.sortObjects===!0&&mr.sort(Wr,$r),Yi=Cs.enabled===!1||Cs.isPresenting===!1||Cs.hasDepthSensing()===!1,Yi&&Is.addToRenderList(mr,$i),this.info.render.frame++,Qr===!0&&As.beginShadows();const ps=dr.state.shadowsArray;Ss.render(ps,$i,ds),Qr===!0&&As.endShadows(),this.info.autoReset===!0&&this.info.reset();const ws=mr.opaque,ys=mr.transmissive;if(dr.setupLights(),ds.isArrayCamera){const Es=ds.cameras;if(ys.length>0)for(let Ts=0,Rs=Es.length;Ts<Rs;Ts++){const Ds=Es[Ts];Qa(ws,ys,$i,Ds)}Yi&&Is.render($i);for(let Ts=0,Rs=Es.length;Ts<Rs;Ts++){const Ds=Es[Ts];Wa(mr,$i,Ds,Ds.viewport)}}else ys.length>0&&Qa(ws,ys,$i,ds),Yi&&Is.render($i),Wa(mr,$i,ds);xr!==null&&Sr===0&&(Ki.updateMultisampleRenderTarget(xr),Ki.updateRenderTargetMipmap(xr)),$i.isScene===!0&&$i.onAfterRender(yr,$i,ds),Vs.resetDefaultState(),Cr=-1,Ir=null,Ar.pop(),Ar.length>0?(dr=Ar[Ar.length-1],Qr===!0&&As.setGlobalState(yr.clippingPlanes,dr.state.camera)):dr=null,vr.pop(),vr.length>0?mr=vr[vr.length-1]:mr=null};function $a($i,ds,ps,ws){if($i.visible===!1)return;if($i.layers.test(ds.layers)){if($i.isGroup)ps=$i.renderOrder;else if($i.isLOD)$i.autoUpdate===!0&&$i.update(ds);else if($i.isLight)dr.pushLight($i),$i.castShadow&&dr.pushShadow($i);else if($i.isSprite){if(!$i.frustumCulled||Kr.intersectsSprite($i)){ws&&Zr.setFromMatrixPosition($i.matrixWorld).applyMatrix4(qr);const Ts=ss.update($i),Rs=$i.material;Rs.visible&&mr.push($i,Ts,Rs,ps,Zr.z,null)}}else if(($i.isMesh||$i.isLine||$i.isPoints)&&(!$i.frustumCulled||Kr.intersectsObject($i))){const Ts=ss.update($i),Rs=$i.material;if(ws&&($i.boundingSphere!==void 0?($i.boundingSphere===null&&$i.computeBoundingSphere(),Zr.copy($i.boundingSphere.center)):(Ts.boundingSphere===null&&Ts.computeBoundingSphere(),Zr.copy(Ts.boundingSphere.center)),Zr.applyMatrix4($i.matrixWorld).applyMatrix4(qr)),Array.isArray(Rs)){const Ds=Ts.groups;for(let Us=0,Os=Ds.length;Us<Os;Us++){const Gs=Ds[Us],zs=Rs[Gs.materialIndex];zs&&zs.visible&&mr.push($i,Ts,zs,ps,Zr.z,Gs)}}else Rs.visible&&mr.push($i,Ts,Rs,ps,Zr.z,null)}}const Es=$i.children;for(let Ts=0,Rs=Es.length;Ts<Rs;Ts++)$a(Es[Ts],ds,ps,ws)}function Wa($i,ds,ps,ws){const ys=$i.opaque,Es=$i.transmissive,Ts=$i.transparent;dr.setupLightsView(ps),Qr===!0&&As.setGlobalState(yr.clippingPlanes,ps),ws&&is.viewport(Rr.copy(ws)),ys.length>0&&Xa(ys,ds,ps),Es.length>0&&Xa(Es,ds,ps),Ts.length>0&&Xa(Ts,ds,ps),is.buffers.depth.setTest(!0),is.buffers.depth.setMask(!0),is.buffers.color.setMask(!0),is.setPolygonOffset(!1)}function Qa($i,ds,ps,ws){if((ps.isScene===!0?ps.overrideMaterial:null)!==null)return;dr.state.transmissionRenderTarget[ws.id]===void 0&&(dr.state.transmissionRenderTarget[ws.id]=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:os.has("EXT_color_buffer_half_float")||os.has("EXT_color_buffer_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:4,stencilBuffer:sr,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ColorManagement.workingColorSpace}));const Es=dr.state.transmissionRenderTarget[ws.id],Ts=ws.viewport||Rr;Es.setSize(Ts.z*yr.transmissionResolutionScale,Ts.w*yr.transmissionResolutionScale);const Rs=yr.getRenderTarget();yr.setRenderTarget(Es),yr.getClearColor(Nr),Ur=yr.getClearAlpha(),Ur<1&&yr.setClearColor(16777215,.5),yr.clear(),Yi&&Is.render(ps);const Ds=yr.toneMapping;yr.toneMapping=NoToneMapping;const Us=ws.viewport;if(ws.viewport!==void 0&&(ws.viewport=void 0),dr.setupLightsView(ws),Qr===!0&&As.setGlobalState(yr.clippingPlanes,ws),Xa($i,ps,ws),Ki.updateMultisampleRenderTarget(Es),Ki.updateRenderTargetMipmap(Es),os.has("WEBGL_multisampled_render_to_texture")===!1){let Os=!1;for(let Gs=0,zs=ds.length;Gs<zs;Gs++){const Xs=ds[Gs],na=Xs.object,wa=Xs.geometry,fa=Xs.material,sa=Xs.group;if(fa.side===DoubleSide&&na.layers.test(ws.layers)){const Ea=fa.side;fa.side=BackSide,fa.needsUpdate=!0,Ka(na,ps,ws,wa,fa,sa),fa.side=Ea,fa.needsUpdate=!0,Os=!0}}Os===!0&&(Ki.updateMultisampleRenderTarget(Es),Ki.updateRenderTargetMipmap(Es))}yr.setRenderTarget(Rs),yr.setClearColor(Nr,Ur),Us!==void 0&&(ws.viewport=Us),yr.toneMapping=Ds}function Xa($i,ds,ps){const ws=ds.isScene===!0?ds.overrideMaterial:null;for(let ys=0,Es=$i.length;ys<Es;ys++){const Ts=$i[ys],Rs=Ts.object,Ds=Ts.geometry,Us=ws===null?Ts.material:ws,Os=Ts.group;Rs.layers.test(ps.layers)&&Ka(Rs,ds,ps,Ds,Us,Os)}}function Ka($i,ds,ps,ws,ys,Es){$i.onBeforeRender(yr,ds,ps,ws,ys,Es),$i.modelViewMatrix.multiplyMatrices(ps.matrixWorldInverse,$i.matrixWorld),$i.normalMatrix.getNormalMatrix($i.modelViewMatrix),ys.onBeforeRender(yr,ds,ps,ws,$i,Es),ys.transparent===!0&&ys.side===DoubleSide&&ys.forceSinglePass===!1?(ys.side=BackSide,ys.needsUpdate=!0,yr.renderBufferDirect(ps,ds,ws,ys,$i,Es),ys.side=FrontSide,ys.needsUpdate=!0,yr.renderBufferDirect(ps,ds,ws,ys,$i,Es),ys.side=DoubleSide):yr.renderBufferDirect(ps,ds,ws,ys,$i,Es),$i.onAfterRender(yr,ds,ps,ws,ys,Es)}function qa($i,ds,ps){ds.isScene!==!0&&(ds=Zi);const ws=ms.get($i),ys=dr.state.lights,Es=dr.state.shadowsArray,Ts=ys.state.version,Rs=ls.getParameters($i,ys.state,Es,ds,ps),Ds=ls.getProgramCacheKey(Rs);let Us=ws.programs;ws.environment=$i.isMeshStandardMaterial?ds.environment:null,ws.fog=ds.fog,ws.envMap=($i.isMeshStandardMaterial?Ri:Ni).get($i.envMap||ws.environment),ws.envMapRotation=ws.environment!==null&&$i.envMap===null?ds.environmentRotation:$i.envMapRotation,Us===void 0&&($i.addEventListener("dispose",ta),Us=new Map,ws.programs=Us);let Os=Us.get(Ds);if(Os!==void 0){if(ws.currentProgram===Os&&ws.lightsStateVersion===Ts)return ro($i,Rs),Os}else Rs.uniforms=ls.getUniforms($i),$i.onBeforeCompile(Rs,yr),Os=ls.acquireProgram(Rs,Ds),Us.set(Ds,Os),ws.uniforms=Rs.uniforms;const Gs=ws.uniforms;return(!$i.isShaderMaterial&&!$i.isRawShaderMaterial||$i.clipping===!0)&&(Gs.clippingPlanes=As.uniform),ro($i,Rs),ws.needsLights=Za($i),ws.lightsStateVersion=Ts,ws.needsLights&&(Gs.ambientLightColor.value=ys.state.ambient,Gs.lightProbe.value=ys.state.probe,Gs.directionalLights.value=ys.state.directional,Gs.directionalLightShadows.value=ys.state.directionalShadow,Gs.spotLights.value=ys.state.spot,Gs.spotLightShadows.value=ys.state.spotShadow,Gs.rectAreaLights.value=ys.state.rectArea,Gs.ltc_1.value=ys.state.rectAreaLTC1,Gs.ltc_2.value=ys.state.rectAreaLTC2,Gs.pointLights.value=ys.state.point,Gs.pointLightShadows.value=ys.state.pointShadow,Gs.hemisphereLights.value=ys.state.hemi,Gs.directionalShadowMap.value=ys.state.directionalShadowMap,Gs.directionalShadowMatrix.value=ys.state.directionalShadowMatrix,Gs.spotShadowMap.value=ys.state.spotShadowMap,Gs.spotLightMatrix.value=ys.state.spotLightMatrix,Gs.spotLightMap.value=ys.state.spotLightMap,Gs.pointShadowMap.value=ys.state.pointShadowMap,Gs.pointShadowMatrix.value=ys.state.pointShadowMatrix),ws.currentProgram=Os,ws.uniformsList=null,Os}function to($i){if($i.uniformsList===null){const ds=$i.currentProgram.getUniforms();$i.uniformsList=WebGLUniforms.seqWithValue(ds.seq,$i.uniforms)}return $i.uniformsList}function ro($i,ds){const ps=ms.get($i);ps.outputColorSpace=ds.outputColorSpace,ps.batching=ds.batching,ps.batchingColor=ds.batchingColor,ps.instancing=ds.instancing,ps.instancingColor=ds.instancingColor,ps.instancingMorph=ds.instancingMorph,ps.skinning=ds.skinning,ps.morphTargets=ds.morphTargets,ps.morphNormals=ds.morphNormals,ps.morphColors=ds.morphColors,ps.morphTargetsCount=ds.morphTargetsCount,ps.numClippingPlanes=ds.numClippingPlanes,ps.numIntersection=ds.numClipIntersection,ps.vertexAlphas=ds.vertexAlphas,ps.vertexTangents=ds.vertexTangents,ps.toneMapping=ds.toneMapping}function ao($i,ds,ps,ws,ys){ds.isScene!==!0&&(ds=Zi),Ki.resetTextureUnits();const Es=ds.fog,Ts=ws.isMeshStandardMaterial?ds.environment:null,Rs=xr===null?yr.outputColorSpace:xr.isXRRenderTarget===!0?xr.texture.colorSpace:LinearSRGBColorSpace,Ds=(ws.isMeshStandardMaterial?Ri:Ni).get(ws.envMap||Ts),Us=ws.vertexColors===!0&&!!ps.attributes.color&&ps.attributes.color.itemSize===4,Os=!!ps.attributes.tangent&&(!!ws.normalMap||ws.anisotropy>0),Gs=!!ps.morphAttributes.position,zs=!!ps.morphAttributes.normal,Xs=!!ps.morphAttributes.color;let na=NoToneMapping;ws.toneMapped&&(xr===null||xr.isXRRenderTarget===!0)&&(na=yr.toneMapping);const wa=ps.morphAttributes.position||ps.morphAttributes.normal||ps.morphAttributes.color,fa=wa!==void 0?wa.length:0,sa=ms.get(ws),Ea=dr.state.lights;if(Qr===!0&&(Vr===!0||$i!==Ir)){const Oa=$i===Ir&&ws.id===Cr;As.setState(ws,$i,Oa)}let ca=!1;ws.version===sa.__version?(sa.needsLights&&sa.lightsStateVersion!==Ea.state.version||sa.outputColorSpace!==Rs||ys.isBatchedMesh&&sa.batching===!1||!ys.isBatchedMesh&&sa.batching===!0||ys.isBatchedMesh&&sa.batchingColor===!0&&ys.colorTexture===null||ys.isBatchedMesh&&sa.batchingColor===!1&&ys.colorTexture!==null||ys.isInstancedMesh&&sa.instancing===!1||!ys.isInstancedMesh&&sa.instancing===!0||ys.isSkinnedMesh&&sa.skinning===!1||!ys.isSkinnedMesh&&sa.skinning===!0||ys.isInstancedMesh&&sa.instancingColor===!0&&ys.instanceColor===null||ys.isInstancedMesh&&sa.instancingColor===!1&&ys.instanceColor!==null||ys.isInstancedMesh&&sa.instancingMorph===!0&&ys.morphTexture===null||ys.isInstancedMesh&&sa.instancingMorph===!1&&ys.morphTexture!==null||sa.envMap!==Ds||ws.fog===!0&&sa.fog!==Es||sa.numClippingPlanes!==void 0&&(sa.numClippingPlanes!==As.numPlanes||sa.numIntersection!==As.numIntersection)||sa.vertexAlphas!==Us||sa.vertexTangents!==Os||sa.morphTargets!==Gs||sa.morphNormals!==zs||sa.morphColors!==Xs||sa.toneMapping!==na||sa.morphTargetsCount!==fa)&&(ca=!0):(ca=!0,sa.__version=ws.version);let Da=sa.currentProgram;ca===!0&&(Da=qa(ws,ds,ys));let Ma=!1,Pa=!1,Ca=!1;const ya=Da.getUniforms(),Va=sa.uniforms;if(is.useProgram(Da.program)&&(Ma=!0,Pa=!0,Ca=!0),ws.id!==Cr&&(Cr=ws.id,Pa=!0),Ma||Ir!==$i){is.buffers.depth.getReversed()?(Gr.copy($i.projectionMatrix),toNormalizedProjectionMatrix(Gr),toReversedProjectionMatrix(Gr),ya.setValue(Xr,"projectionMatrix",Gr)):ya.setValue(Xr,"projectionMatrix",$i.projectionMatrix),ya.setValue(Xr,"viewMatrix",$i.matrixWorldInverse);const Ga=ya.map.cameraPosition;Ga!==void 0&&Ga.setValue(Xr,ji.setFromMatrixPosition($i.matrixWorld)),us.logarithmicDepthBuffer&&ya.setValue(Xr,"logDepthBufFC",2/(Math.log($i.far+1)/Math.LN2)),(ws.isMeshPhongMaterial||ws.isMeshToonMaterial||ws.isMeshLambertMaterial||ws.isMeshBasicMaterial||ws.isMeshStandardMaterial||ws.isShaderMaterial)&&ya.setValue(Xr,"isOrthographic",$i.isOrthographicCamera===!0),Ir!==$i&&(Ir=$i,Pa=!0,Ca=!0)}if(ys.isSkinnedMesh){ya.setOptional(Xr,ys,"bindMatrix"),ya.setOptional(Xr,ys,"bindMatrixInverse");const Oa=ys.skeleton;Oa&&(Oa.boneTexture===null&&Oa.computeBoneTexture(),ya.setValue(Xr,"boneTexture",Oa.boneTexture,Ki))}ys.isBatchedMesh&&(ya.setOptional(Xr,ys,"batchingTexture"),ya.setValue(Xr,"batchingTexture",ys._matricesTexture,Ki),ya.setOptional(Xr,ys,"batchingIdTexture"),ya.setValue(Xr,"batchingIdTexture",ys._indirectTexture,Ki),ya.setOptional(Xr,ys,"batchingColorTexture"),ys._colorsTexture!==null&&ya.setValue(Xr,"batchingColorTexture",ys._colorsTexture,Ki));const Ha=ps.morphAttributes;if((Ha.position!==void 0||Ha.normal!==void 0||Ha.color!==void 0)&&Fs.update(ys,ps,Da),(Pa||sa.receiveShadow!==ys.receiveShadow)&&(sa.receiveShadow=ys.receiveShadow,ya.setValue(Xr,"receiveShadow",ys.receiveShadow)),ws.isMeshGouraudMaterial&&ws.envMap!==null&&(Va.envMap.value=Ds,Va.flipEnvMap.value=Ds.isCubeTexture&&Ds.isRenderTargetTexture===!1?-1:1),ws.isMeshStandardMaterial&&ws.envMap===null&&ds.environment!==null&&(Va.envMapIntensity.value=ds.environmentIntensity),Pa&&(ya.setValue(Xr,"toneMappingExposure",yr.toneMappingExposure),sa.needsLights&&Ya(Va,Ca),Es&&ws.fog===!0&&gs.refreshFogUniforms(Va,Es),gs.refreshMaterialUniforms(Va,ws,Dr,Or,dr.state.transmissionRenderTarget[$i.id]),WebGLUniforms.upload(Xr,to(sa),Va,Ki)),ws.isShaderMaterial&&ws.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(Xr,to(sa),Va,Ki),ws.uniformsNeedUpdate=!1),ws.isSpriteMaterial&&ya.setValue(Xr,"center",ys.center),ya.setValue(Xr,"modelViewMatrix",ys.modelViewMatrix),ya.setValue(Xr,"normalMatrix",ys.normalMatrix),ya.setValue(Xr,"modelMatrix",ys.matrixWorld),ws.isShaderMaterial||ws.isRawShaderMaterial){const Oa=ws.uniformsGroups;for(let Ga=0,io=Oa.length;Ga<io;Ga++){const Ja=Oa[Ga];bs.update(Ja,Da),bs.bind(Ja,Da)}}return Da}function Ya($i,ds){$i.ambientLightColor.needsUpdate=ds,$i.lightProbe.needsUpdate=ds,$i.directionalLights.needsUpdate=ds,$i.directionalLightShadows.needsUpdate=ds,$i.pointLights.needsUpdate=ds,$i.pointLightShadows.needsUpdate=ds,$i.spotLights.needsUpdate=ds,$i.spotLightShadows.needsUpdate=ds,$i.rectAreaLights.needsUpdate=ds,$i.hemisphereLights.needsUpdate=ds}function Za($i){return $i.isMeshLambertMaterial||$i.isMeshToonMaterial||$i.isMeshPhongMaterial||$i.isMeshStandardMaterial||$i.isShadowMaterial||$i.isShaderMaterial&&$i.lights===!0}this.getActiveCubeFace=function(){return br},this.getActiveMipmapLevel=function(){return Sr},this.getRenderTarget=function(){return xr},this.setRenderTargetTextures=function($i,ds,ps){ms.get($i.texture).__webglTexture=ds,ms.get($i.depthTexture).__webglTexture=ps;const ws=ms.get($i);ws.__hasExternalTextures=!0,ws.__autoAllocateDepthBuffer=ps===void 0,ws.__autoAllocateDepthBuffer||os.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ws.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function($i,ds){const ps=ms.get($i);ps.__webglFramebuffer=ds,ps.__useDefaultFramebuffer=ds===void 0};const Gi=Xr.createFramebuffer();this.setRenderTarget=function($i,ds=0,ps=0){xr=$i,br=ds,Sr=ps;let ws=!0,ys=null,Es=!1,Ts=!1;if($i){const Ds=ms.get($i);if(Ds.__useDefaultFramebuffer!==void 0)is.bindFramebuffer(Xr.FRAMEBUFFER,null),ws=!1;else if(Ds.__webglFramebuffer===void 0)Ki.setupRenderTarget($i);else if(Ds.__hasExternalTextures)Ki.rebindTextures($i,ms.get($i.texture).__webglTexture,ms.get($i.depthTexture).__webglTexture);else if($i.depthBuffer){const Gs=$i.depthTexture;if(Ds.__boundDepthTexture!==Gs){if(Gs!==null&&ms.has(Gs)&&($i.width!==Gs.image.width||$i.height!==Gs.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ki.setupDepthRenderbuffer($i)}}const Us=$i.texture;(Us.isData3DTexture||Us.isDataArrayTexture||Us.isCompressedArrayTexture)&&(Ts=!0);const Os=ms.get($i).__webglFramebuffer;$i.isWebGLCubeRenderTarget?(Array.isArray(Os[ds])?ys=Os[ds][ps]:ys=Os[ds],Es=!0):$i.samples>0&&Ki.useMultisampledRTT($i)===!1?ys=ms.get($i).__webglMultisampledFramebuffer:Array.isArray(Os)?ys=Os[ps]:ys=Os,Rr.copy($i.viewport),Pr.copy($i.scissor),Fr=$i.scissorTest}else Rr.copy(Yr).multiplyScalar(Dr).floor(),Pr.copy(Qi).multiplyScalar(Dr).floor(),Fr=rs;if(ps!==0&&(ys=Gi),is.bindFramebuffer(Xr.FRAMEBUFFER,ys)&&ws&&is.drawBuffers($i,ys),is.viewport(Rr),is.scissor(Pr),is.setScissorTest(Fr),Es){const Ds=ms.get($i.texture);Xr.framebufferTexture2D(Xr.FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,Xr.TEXTURE_CUBE_MAP_POSITIVE_X+ds,Ds.__webglTexture,ps)}else if(Ts){const Ds=ms.get($i.texture),Us=ds;Xr.framebufferTextureLayer(Xr.FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,Ds.__webglTexture,ps,Us)}else if($i!==null&&ps!==0){const Ds=ms.get($i.texture);Xr.framebufferTexture2D(Xr.FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,Xr.TEXTURE_2D,Ds.__webglTexture,ps)}Cr=-1},this.readRenderTargetPixels=function($i,ds,ps,ws,ys,Es,Ts){if(!($i&&$i.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Rs=ms.get($i).__webglFramebuffer;if($i.isWebGLCubeRenderTarget&&Ts!==void 0&&(Rs=Rs[Ts]),Rs){is.bindFramebuffer(Xr.FRAMEBUFFER,Rs);try{const Ds=$i.texture,Us=Ds.format,Os=Ds.type;if(!us.textureFormatReadable(Us)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!us.textureTypeReadable(Os)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ds>=0&&ds<=$i.width-ws&&ps>=0&&ps<=$i.height-ys&&Xr.readPixels(ds,ps,ws,ys,ks.convert(Us),ks.convert(Os),Es)}finally{const Ds=xr!==null?ms.get(xr).__webglFramebuffer:null;is.bindFramebuffer(Xr.FRAMEBUFFER,Ds)}}},this.readRenderTargetPixelsAsync=async function($i,ds,ps,ws,ys,Es,Ts){if(!($i&&$i.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Rs=ms.get($i).__webglFramebuffer;if($i.isWebGLCubeRenderTarget&&Ts!==void 0&&(Rs=Rs[Ts]),Rs){const Ds=$i.texture,Us=Ds.format,Os=Ds.type;if(!us.textureFormatReadable(Us))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!us.textureTypeReadable(Os))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(ds>=0&&ds<=$i.width-ws&&ps>=0&&ps<=$i.height-ys){is.bindFramebuffer(Xr.FRAMEBUFFER,Rs);const Gs=Xr.createBuffer();Xr.bindBuffer(Xr.PIXEL_PACK_BUFFER,Gs),Xr.bufferData(Xr.PIXEL_PACK_BUFFER,Es.byteLength,Xr.STREAM_READ),Xr.readPixels(ds,ps,ws,ys,ks.convert(Us),ks.convert(Os),0);const zs=xr!==null?ms.get(xr).__webglFramebuffer:null;is.bindFramebuffer(Xr.FRAMEBUFFER,zs);const Xs=Xr.fenceSync(Xr.SYNC_GPU_COMMANDS_COMPLETE,0);return Xr.flush(),await probeAsync(Xr,Xs,4),Xr.bindBuffer(Xr.PIXEL_PACK_BUFFER,Gs),Xr.getBufferSubData(Xr.PIXEL_PACK_BUFFER,0,Es),Xr.deleteBuffer(Gs),Xr.deleteSync(Xs),Es}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function($i,ds=null,ps=0){$i.isTexture!==!0&&(warnOnce("WebGLRenderer: copyFramebufferToTexture function signature has changed."),ds=arguments[0]||null,$i=arguments[1]);const ws=Math.pow(2,-ps),ys=Math.floor($i.image.width*ws),Es=Math.floor($i.image.height*ws),Ts=ds!==null?ds.x:0,Rs=ds!==null?ds.y:0;Ki.setTexture2D($i,0),Xr.copyTexSubImage2D(Xr.TEXTURE_2D,ps,0,0,Ts,Rs,ys,Es),is.unbindTexture()};const cs=Xr.createFramebuffer(),xs=Xr.createFramebuffer();this.copyTextureToTexture=function($i,ds,ps=null,ws=null,ys=0,Es=null){$i.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed."),ws=arguments[0]||null,$i=arguments[1],ds=arguments[2],Es=arguments[3]||0,ps=null),Es===null&&(ys!==0?(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Es=ys,ys=0):Es=0);let Ts,Rs,Ds,Us,Os,Gs,zs,Xs,na;const wa=$i.isCompressedTexture?$i.mipmaps[Es]:$i.image;if(ps!==null)Ts=ps.max.x-ps.min.x,Rs=ps.max.y-ps.min.y,Ds=ps.isBox3?ps.max.z-ps.min.z:1,Us=ps.min.x,Os=ps.min.y,Gs=ps.isBox3?ps.min.z:0;else{const Ha=Math.pow(2,-ys);Ts=Math.floor(wa.width*Ha),Rs=Math.floor(wa.height*Ha),$i.isDataArrayTexture?Ds=wa.depth:$i.isData3DTexture?Ds=Math.floor(wa.depth*Ha):Ds=1,Us=0,Os=0,Gs=0}ws!==null?(zs=ws.x,Xs=ws.y,na=ws.z):(zs=0,Xs=0,na=0);const fa=ks.convert(ds.format),sa=ks.convert(ds.type);let Ea;ds.isData3DTexture?(Ki.setTexture3D(ds,0),Ea=Xr.TEXTURE_3D):ds.isDataArrayTexture||ds.isCompressedArrayTexture?(Ki.setTexture2DArray(ds,0),Ea=Xr.TEXTURE_2D_ARRAY):(Ki.setTexture2D(ds,0),Ea=Xr.TEXTURE_2D),Xr.pixelStorei(Xr.UNPACK_FLIP_Y_WEBGL,ds.flipY),Xr.pixelStorei(Xr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ds.premultiplyAlpha),Xr.pixelStorei(Xr.UNPACK_ALIGNMENT,ds.unpackAlignment);const ca=Xr.getParameter(Xr.UNPACK_ROW_LENGTH),Da=Xr.getParameter(Xr.UNPACK_IMAGE_HEIGHT),Ma=Xr.getParameter(Xr.UNPACK_SKIP_PIXELS),Pa=Xr.getParameter(Xr.UNPACK_SKIP_ROWS),Ca=Xr.getParameter(Xr.UNPACK_SKIP_IMAGES);Xr.pixelStorei(Xr.UNPACK_ROW_LENGTH,wa.width),Xr.pixelStorei(Xr.UNPACK_IMAGE_HEIGHT,wa.height),Xr.pixelStorei(Xr.UNPACK_SKIP_PIXELS,Us),Xr.pixelStorei(Xr.UNPACK_SKIP_ROWS,Os),Xr.pixelStorei(Xr.UNPACK_SKIP_IMAGES,Gs);const ya=$i.isDataArrayTexture||$i.isData3DTexture,Va=ds.isDataArrayTexture||ds.isData3DTexture;if($i.isDepthTexture){const Ha=ms.get($i),Oa=ms.get(ds),Ga=ms.get(Ha.__renderTarget),io=ms.get(Oa.__renderTarget);is.bindFramebuffer(Xr.READ_FRAMEBUFFER,Ga.__webglFramebuffer),is.bindFramebuffer(Xr.DRAW_FRAMEBUFFER,io.__webglFramebuffer);for(let Ja=0;Ja<Ds;Ja++)ya&&(Xr.framebufferTextureLayer(Xr.READ_FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,ms.get($i).__webglTexture,ys,Gs+Ja),Xr.framebufferTextureLayer(Xr.DRAW_FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,ms.get(ds).__webglTexture,Es,na+Ja)),Xr.blitFramebuffer(Us,Os,Ts,Rs,zs,Xs,Ts,Rs,Xr.DEPTH_BUFFER_BIT,Xr.NEAREST);is.bindFramebuffer(Xr.READ_FRAMEBUFFER,null),is.bindFramebuffer(Xr.DRAW_FRAMEBUFFER,null)}else if(ys!==0||$i.isRenderTargetTexture||ms.has($i)){const Ha=ms.get($i),Oa=ms.get(ds);is.bindFramebuffer(Xr.READ_FRAMEBUFFER,cs),is.bindFramebuffer(Xr.DRAW_FRAMEBUFFER,xs);for(let Ga=0;Ga<Ds;Ga++)ya?Xr.framebufferTextureLayer(Xr.READ_FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,Ha.__webglTexture,ys,Gs+Ga):Xr.framebufferTexture2D(Xr.READ_FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,Xr.TEXTURE_2D,Ha.__webglTexture,ys),Va?Xr.framebufferTextureLayer(Xr.DRAW_FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,Oa.__webglTexture,Es,na+Ga):Xr.framebufferTexture2D(Xr.DRAW_FRAMEBUFFER,Xr.COLOR_ATTACHMENT0,Xr.TEXTURE_2D,Oa.__webglTexture,Es),ys!==0?Xr.blitFramebuffer(Us,Os,Ts,Rs,zs,Xs,Ts,Rs,Xr.COLOR_BUFFER_BIT,Xr.NEAREST):Va?Xr.copyTexSubImage3D(Ea,Es,zs,Xs,na+Ga,Us,Os,Ts,Rs):Xr.copyTexSubImage2D(Ea,Es,zs,Xs,Us,Os,Ts,Rs);is.bindFramebuffer(Xr.READ_FRAMEBUFFER,null),is.bindFramebuffer(Xr.DRAW_FRAMEBUFFER,null)}else Va?$i.isDataTexture||$i.isData3DTexture?Xr.texSubImage3D(Ea,Es,zs,Xs,na,Ts,Rs,Ds,fa,sa,wa.data):ds.isCompressedArrayTexture?Xr.compressedTexSubImage3D(Ea,Es,zs,Xs,na,Ts,Rs,Ds,fa,wa.data):Xr.texSubImage3D(Ea,Es,zs,Xs,na,Ts,Rs,Ds,fa,sa,wa):$i.isDataTexture?Xr.texSubImage2D(Xr.TEXTURE_2D,Es,zs,Xs,Ts,Rs,fa,sa,wa.data):$i.isCompressedTexture?Xr.compressedTexSubImage2D(Xr.TEXTURE_2D,Es,zs,Xs,wa.width,wa.height,fa,wa.data):Xr.texSubImage2D(Xr.TEXTURE_2D,Es,zs,Xs,Ts,Rs,fa,sa,wa);Xr.pixelStorei(Xr.UNPACK_ROW_LENGTH,ca),Xr.pixelStorei(Xr.UNPACK_IMAGE_HEIGHT,Da),Xr.pixelStorei(Xr.UNPACK_SKIP_PIXELS,Ma),Xr.pixelStorei(Xr.UNPACK_SKIP_ROWS,Pa),Xr.pixelStorei(Xr.UNPACK_SKIP_IMAGES,Ca),Es===0&&ds.generateMipmaps&&Xr.generateMipmap(Ea),is.unbindTexture()},this.copyTextureToTexture3D=function($i,ds,ps=null,ws=null,ys=0){return $i.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture3D function signature has changed."),ps=arguments[0]||null,ws=arguments[1]||null,$i=arguments[2],ds=arguments[3],ys=arguments[4]||0),warnOnce('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture($i,ds,ps,ws,ys)},this.initRenderTarget=function($i){ms.get($i).__webglFramebuffer===void 0&&Ki.setupRenderTarget($i)},this.initTexture=function($i){$i.isCubeTexture?Ki.setTextureCube($i,0):$i.isData3DTexture?Ki.setTexture3D($i,0):$i.isDataArrayTexture||$i.isCompressedArrayTexture?Ki.setTexture2DArray($i,0):Ki.setTexture2D($i,0),is.unbindTexture()},this.resetState=function(){br=0,Sr=0,xr=null,is.reset(),Vs.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(er){this._outputColorSpace=er;const tr=this.getContext();tr.drawingBufferColorspace=ColorManagement._getDrawingBufferColorSpace(er),tr.unpackColorSpace=ColorManagement._getUnpackColorSpace()}}const __vite__wasmUrl="/cloth-button/assets/rapier_wasm3d_bg-CN52XpWN.wasm",__vite__initWasm=async(ir={},er)=>{let tr;if(er.startsWith("data:")){const rr=er.replace(/^data:.*?base64,/,"");let nr;if(typeof Buffer=="function"&&typeof Buffer.from=="function")nr=Buffer.from(rr,"base64");else if(typeof atob=="function"){const sr=atob(rr);nr=new Uint8Array(sr.length);for(let ar=0;ar<sr.length;ar++)nr[ar]=sr.charCodeAt(ar)}else throw new Error("Cannot decode base64-encoded data URL");tr=await WebAssembly.instantiate(nr,ir)}else{const rr=await fetch(er),nr=rr.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&nr.startsWith("application/wasm"))tr=await WebAssembly.instantiateStreaming(rr,ir);else{const sr=await rr.arrayBuffer();tr=await WebAssembly.instantiate(sr,ir)}}return tr.instance.exports};let wasm$1;function __wbg_set_wasm(ir){wasm$1=ir}const heap=new Array(128).fill(void 0);heap.push(void 0,null,!0,!1);let heap_next=heap.length;function addHeapObject(ir){heap_next===heap.length&&heap.push(heap.length+1);const er=heap_next;return heap_next=heap[er],heap[er]=ir,er}function getObject(ir){return heap[ir]}function dropObject(ir){ir<132||(heap[ir]=heap_next,heap_next=ir)}function takeObject(ir){const er=getObject(ir);return dropObject(ir),er}function isLikeNone(ir){return ir==null}let cachedFloat64Memory0=null;function getFloat64Memory0(){return(cachedFloat64Memory0===null||cachedFloat64Memory0.byteLength===0)&&(cachedFloat64Memory0=new Float64Array(wasm$1.memory.buffer)),cachedFloat64Memory0}let cachedInt32Memory0=null;function getInt32Memory0(){return(cachedInt32Memory0===null||cachedInt32Memory0.byteLength===0)&&(cachedInt32Memory0=new Int32Array(wasm$1.memory.buffer)),cachedInt32Memory0}const lTextDecoder=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let cachedTextDecoder=new lTextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();let cachedUint8Memory0=null;function getUint8Memory0(){return(cachedUint8Memory0===null||cachedUint8Memory0.byteLength===0)&&(cachedUint8Memory0=new Uint8Array(wasm$1.memory.buffer)),cachedUint8Memory0}function getStringFromWasm0(ir,er){return ir=ir>>>0,cachedTextDecoder.decode(getUint8Memory0().subarray(ir,ir+er))}function version$2(){let ir,er;try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.version(nr);var tr=getInt32Memory0()[nr/4+0],rr=getInt32Memory0()[nr/4+1];return ir=tr,er=rr,getStringFromWasm0(tr,rr)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(ir,er,1)}}function _assertClass(ir,er){if(!(ir instanceof er))throw new Error(`expected instance of ${er.name}`);return ir.ptr}let cachedFloat32Memory0=null;function getFloat32Memory0(){return(cachedFloat32Memory0===null||cachedFloat32Memory0.byteLength===0)&&(cachedFloat32Memory0=new Float32Array(wasm$1.memory.buffer)),cachedFloat32Memory0}let stack_pointer=128;function addBorrowedObject(ir){if(stack_pointer==1)throw new Error("out of js stack");return heap[--stack_pointer]=ir,stack_pointer}function getArrayF32FromWasm0(ir,er){return ir=ir>>>0,getFloat32Memory0().subarray(ir/4,ir/4+er)}let cachedUint32Memory0=null;function getUint32Memory0(){return(cachedUint32Memory0===null||cachedUint32Memory0.byteLength===0)&&(cachedUint32Memory0=new Uint32Array(wasm$1.memory.buffer)),cachedUint32Memory0}function getArrayU32FromWasm0(ir,er){return ir=ir>>>0,getUint32Memory0().subarray(ir/4,ir/4+er)}let WASM_VECTOR_LEN=0;function passArrayF32ToWasm0(ir,er){const tr=er(ir.length*4,4)>>>0;return getFloat32Memory0().set(ir,tr/4),WASM_VECTOR_LEN=ir.length,tr}function passArray32ToWasm0(ir,er){const tr=er(ir.length*4,4)>>>0;return getUint32Memory0().set(ir,tr/4),WASM_VECTOR_LEN=ir.length,tr}function handleError(ir,er){try{return ir.apply(this,er)}catch(tr){wasm$1.__wbindgen_exn_store(addHeapObject(tr))}}const RawFeatureType=Object.freeze({Vertex:0,0:"Vertex",Edge:1,1:"Edge",Face:2,2:"Face",Unknown:3,3:"Unknown"}),RawShapeType=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"}),RawJointAxis=Object.freeze({LinX:0,0:"LinX",LinY:1,1:"LinY",LinZ:2,2:"LinZ",AngX:3,3:"AngX",AngY:4,4:"AngY",AngZ:5,5:"AngZ"}),RawRigidBodyType=Object.freeze({Dynamic:0,0:"Dynamic",Fixed:1,1:"Fixed",KinematicPositionBased:2,2:"KinematicPositionBased",KinematicVelocityBased:3,3:"KinematicVelocityBased"}),RawMotorModel=Object.freeze({AccelerationBased:0,0:"AccelerationBased",ForceBased:1,1:"ForceBased"}),RawJointType=Object.freeze({Revolute:0,0:"Revolute",Fixed:1,1:"Fixed",Prismatic:2,2:"Prismatic",Rope:3,3:"Rope",Spring:4,4:"Spring",Spherical:5,5:"Spherical",Generic:6,6:"Generic"}),RawBroadPhaseFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawbroadphase_free(ir>>>0));class RawBroadPhase{static __wrap(er){er=er>>>0;const tr=Object.create(RawBroadPhase.prototype);return tr.__wbg_ptr=er,RawBroadPhaseFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawBroadPhaseFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawbroadphase_free(er)}constructor(){const er=wasm$1.rawbroadphase_new();return this.__wbg_ptr=er>>>0,this}}const RawCCDSolverFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawccdsolver_free(ir>>>0));class RawCCDSolver{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawCCDSolverFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawccdsolver_free(er)}constructor(){const er=wasm$1.rawccdsolver_new();return this.__wbg_ptr=er>>>0,this}}const RawCharacterCollisionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawcharactercollision_free(ir>>>0));class RawCharacterCollision{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawCharacterCollisionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcharactercollision_free(er)}constructor(){const er=wasm$1.rawcharactercollision_new();return this.__wbg_ptr=er>>>0,this}handle(){return wasm$1.rawcharactercollision_handle(this.__wbg_ptr)}translationDeltaApplied(){const er=wasm$1.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return RawVector.__wrap(er)}translationDeltaRemaining(){const er=wasm$1.rawcharactercollision_translationDeltaRemaining(this.__wbg_ptr);return RawVector.__wrap(er)}toi(){return wasm$1.rawcharactercollision_toi(this.__wbg_ptr)}worldWitness1(){const er=wasm$1.rawcharactercollision_worldWitness1(this.__wbg_ptr);return RawVector.__wrap(er)}worldWitness2(){const er=wasm$1.rawcharactercollision_worldWitness2(this.__wbg_ptr);return RawVector.__wrap(er)}worldNormal1(){const er=wasm$1.rawcharactercollision_worldNormal1(this.__wbg_ptr);return RawVector.__wrap(er)}worldNormal2(){const er=wasm$1.rawcharactercollision_worldNormal2(this.__wbg_ptr);return RawVector.__wrap(er)}}const RawColliderSetFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawcolliderset_free(ir>>>0));class RawColliderSet{static __wrap(er){er=er>>>0;const tr=Object.create(RawColliderSet.prototype);return tr.__wbg_ptr=er,RawColliderSetFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawColliderSetFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcolliderset_free(er)}coTranslation(er){const tr=wasm$1.rawcolliderset_coTranslation(this.__wbg_ptr,er);return RawVector.__wrap(tr)}coRotation(er){const tr=wasm$1.rawcolliderset_coRotation(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}coSetTranslation(er,tr,rr,nr){wasm$1.rawcolliderset_coSetTranslation(this.__wbg_ptr,er,tr,rr,nr)}coSetTranslationWrtParent(er,tr,rr,nr){wasm$1.rawcolliderset_coSetTranslationWrtParent(this.__wbg_ptr,er,tr,rr,nr)}coSetRotation(er,tr,rr,nr,sr){wasm$1.rawcolliderset_coSetRotation(this.__wbg_ptr,er,tr,rr,nr,sr)}coSetRotationWrtParent(er,tr,rr,nr,sr){wasm$1.rawcolliderset_coSetRotationWrtParent(this.__wbg_ptr,er,tr,rr,nr,sr)}coIsSensor(er){return wasm$1.rawcolliderset_coIsSensor(this.__wbg_ptr,er)!==0}coShapeType(er){return wasm$1.rawcolliderset_coShapeType(this.__wbg_ptr,er)}coHalfspaceNormal(er){const tr=wasm$1.rawcolliderset_coHalfspaceNormal(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}coHalfExtents(er){const tr=wasm$1.rawcolliderset_coHalfExtents(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}coSetHalfExtents(er,tr){_assertClass(tr,RawVector),wasm$1.rawcolliderset_coSetHalfExtents(this.__wbg_ptr,er,tr.__wbg_ptr)}coRadius(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coRadius(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coSetRadius(er,tr){wasm$1.rawcolliderset_coSetRadius(this.__wbg_ptr,er,tr)}coHalfHeight(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHalfHeight(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coSetHalfHeight(er,tr){wasm$1.rawcolliderset_coSetHalfHeight(this.__wbg_ptr,er,tr)}coRoundRadius(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coRoundRadius(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coSetRoundRadius(er,tr){wasm$1.rawcolliderset_coSetRoundRadius(this.__wbg_ptr,er,tr)}coVertices(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coVertices(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getInt32Memory0()[nr/4+1];let sr;return tr!==0&&(sr=getArrayF32FromWasm0(tr,rr).slice(),wasm$1.__wbindgen_free(tr,rr*4,4)),sr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coIndices(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coIndices(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getInt32Memory0()[nr/4+1];let sr;return tr!==0&&(sr=getArrayU32FromWasm0(tr,rr).slice(),wasm$1.__wbindgen_free(tr,rr*4,4)),sr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coTriMeshFlags(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coTriMeshFlags(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getInt32Memory0()[nr/4+1];return tr===0?void 0:rr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coHeightFieldFlags(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHeightFieldFlags(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getInt32Memory0()[nr/4+1];return tr===0?void 0:rr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coHeightfieldHeights(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHeightfieldHeights(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getInt32Memory0()[nr/4+1];let sr;return tr!==0&&(sr=getArrayF32FromWasm0(tr,rr).slice(),wasm$1.__wbindgen_free(tr,rr*4,4)),sr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coHeightfieldScale(er){const tr=wasm$1.rawcolliderset_coHeightfieldScale(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}coHeightfieldNRows(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHeightfieldNRows(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getInt32Memory0()[nr/4+1];return tr===0?void 0:rr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coHeightfieldNCols(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHeightfieldNCols(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getInt32Memory0()[nr/4+1];return tr===0?void 0:rr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coParent(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coParent(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat64Memory0()[nr/8+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coSetEnabled(er,tr){wasm$1.rawcolliderset_coSetEnabled(this.__wbg_ptr,er,tr)}coIsEnabled(er){return wasm$1.rawcolliderset_coIsEnabled(this.__wbg_ptr,er)!==0}coSetContactSkin(er,tr){wasm$1.rawcolliderset_coSetContactSkin(this.__wbg_ptr,er,tr)}coContactSkin(er){return wasm$1.rawcolliderset_coContactSkin(this.__wbg_ptr,er)}coFriction(er){return wasm$1.rawcolliderset_coFriction(this.__wbg_ptr,er)}coRestitution(er){return wasm$1.rawcolliderset_coRestitution(this.__wbg_ptr,er)}coDensity(er){return wasm$1.rawcolliderset_coDensity(this.__wbg_ptr,er)}coMass(er){return wasm$1.rawcolliderset_coMass(this.__wbg_ptr,er)}coVolume(er){return wasm$1.rawcolliderset_coVolume(this.__wbg_ptr,er)}coCollisionGroups(er){return wasm$1.rawcolliderset_coCollisionGroups(this.__wbg_ptr,er)>>>0}coSolverGroups(er){return wasm$1.rawcolliderset_coSolverGroups(this.__wbg_ptr,er)>>>0}coActiveHooks(er){return wasm$1.rawcolliderset_coActiveHooks(this.__wbg_ptr,er)>>>0}coActiveCollisionTypes(er){return wasm$1.rawcolliderset_coActiveCollisionTypes(this.__wbg_ptr,er)}coActiveEvents(er){return wasm$1.rawcolliderset_coActiveEvents(this.__wbg_ptr,er)>>>0}coContactForceEventThreshold(er){return wasm$1.rawcolliderset_coContactForceEventThreshold(this.__wbg_ptr,er)}coContainsPoint(er,tr){return _assertClass(tr,RawVector),wasm$1.rawcolliderset_coContainsPoint(this.__wbg_ptr,er,tr.__wbg_ptr)!==0}coCastShape(er,tr,rr,nr,sr,ar,or,lr,cr){_assertClass(tr,RawVector),_assertClass(rr,RawShape),_assertClass(nr,RawVector),_assertClass(sr,RawRotation),_assertClass(ar,RawVector);const hr=wasm$1.rawcolliderset_coCastShape(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or,lr,cr);return hr===0?void 0:RawShapeCastHit.__wrap(hr)}coCastCollider(er,tr,rr,nr,sr,ar,or){_assertClass(tr,RawVector),_assertClass(nr,RawVector);const lr=wasm$1.rawcolliderset_coCastCollider(this.__wbg_ptr,er,tr.__wbg_ptr,rr,nr.__wbg_ptr,sr,ar,or);return lr===0?void 0:RawColliderShapeCastHit.__wrap(lr)}coIntersectsShape(er,tr,rr,nr){return _assertClass(tr,RawShape),_assertClass(rr,RawVector),_assertClass(nr,RawRotation),wasm$1.rawcolliderset_coIntersectsShape(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr)!==0}coContactShape(er,tr,rr,nr,sr){_assertClass(tr,RawShape),_assertClass(rr,RawVector),_assertClass(nr,RawRotation);const ar=wasm$1.rawcolliderset_coContactShape(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr);return ar===0?void 0:RawShapeContact.__wrap(ar)}coContactCollider(er,tr,rr){const nr=wasm$1.rawcolliderset_coContactCollider(this.__wbg_ptr,er,tr,rr);return nr===0?void 0:RawShapeContact.__wrap(nr)}coProjectPoint(er,tr,rr){_assertClass(tr,RawVector);const nr=wasm$1.rawcolliderset_coProjectPoint(this.__wbg_ptr,er,tr.__wbg_ptr,rr);return RawPointProjection.__wrap(nr)}coIntersectsRay(er,tr,rr,nr){return _assertClass(tr,RawVector),_assertClass(rr,RawVector),wasm$1.rawcolliderset_coIntersectsRay(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr)!==0}coCastRay(er,tr,rr,nr,sr){return _assertClass(tr,RawVector),_assertClass(rr,RawVector),wasm$1.rawcolliderset_coCastRay(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr,sr)}coCastRayAndGetNormal(er,tr,rr,nr,sr){_assertClass(tr,RawVector),_assertClass(rr,RawVector);const ar=wasm$1.rawcolliderset_coCastRayAndGetNormal(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr,sr);return ar===0?void 0:RawRayIntersection.__wrap(ar)}coSetSensor(er,tr){wasm$1.rawcolliderset_coSetSensor(this.__wbg_ptr,er,tr)}coSetRestitution(er,tr){wasm$1.rawcolliderset_coSetRestitution(this.__wbg_ptr,er,tr)}coSetFriction(er,tr){wasm$1.rawcolliderset_coSetFriction(this.__wbg_ptr,er,tr)}coFrictionCombineRule(er){return wasm$1.rawcolliderset_coFrictionCombineRule(this.__wbg_ptr,er)>>>0}coSetFrictionCombineRule(er,tr){wasm$1.rawcolliderset_coSetFrictionCombineRule(this.__wbg_ptr,er,tr)}coRestitutionCombineRule(er){return wasm$1.rawcolliderset_coRestitutionCombineRule(this.__wbg_ptr,er)>>>0}coSetRestitutionCombineRule(er,tr){wasm$1.rawcolliderset_coSetRestitutionCombineRule(this.__wbg_ptr,er,tr)}coSetCollisionGroups(er,tr){wasm$1.rawcolliderset_coSetCollisionGroups(this.__wbg_ptr,er,tr)}coSetSolverGroups(er,tr){wasm$1.rawcolliderset_coSetSolverGroups(this.__wbg_ptr,er,tr)}coSetActiveHooks(er,tr){wasm$1.rawcolliderset_coSetActiveHooks(this.__wbg_ptr,er,tr)}coSetActiveEvents(er,tr){wasm$1.rawcolliderset_coSetActiveEvents(this.__wbg_ptr,er,tr)}coSetActiveCollisionTypes(er,tr){wasm$1.rawcolliderset_coSetActiveCollisionTypes(this.__wbg_ptr,er,tr)}coSetShape(er,tr){_assertClass(tr,RawShape),wasm$1.rawcolliderset_coSetShape(this.__wbg_ptr,er,tr.__wbg_ptr)}coSetContactForceEventThreshold(er,tr){wasm$1.rawcolliderset_coSetContactForceEventThreshold(this.__wbg_ptr,er,tr)}coSetDensity(er,tr){wasm$1.rawcolliderset_coSetDensity(this.__wbg_ptr,er,tr)}coSetMass(er,tr){wasm$1.rawcolliderset_coSetMass(this.__wbg_ptr,er,tr)}coSetMassProperties(er,tr,rr,nr,sr){_assertClass(rr,RawVector),_assertClass(nr,RawVector),_assertClass(sr,RawRotation),wasm$1.rawcolliderset_coSetMassProperties(this.__wbg_ptr,er,tr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr)}constructor(){const er=wasm$1.rawcolliderset_new();return this.__wbg_ptr=er>>>0,this}len(){return wasm$1.rawcolliderset_len(this.__wbg_ptr)>>>0}contains(er){return wasm$1.rawcolliderset_contains(this.__wbg_ptr,er)!==0}createCollider(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr,_r,mr,dr,vr,Ar,yr,wr,br,Sr,xr,Cr){try{const Pr=wasm$1.__wbindgen_add_to_stack_pointer(-16);_assertClass(tr,RawShape),_assertClass(rr,RawVector),_assertClass(nr,RawRotation),_assertClass(or,RawVector),_assertClass(lr,RawVector),_assertClass(cr,RawRotation),_assertClass(Cr,RawRigidBodySet),wasm$1.rawcolliderset_createCollider(Pr,this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr,ar,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr,hr,fr,ur,pr,gr,_r,mr,dr,vr,Ar,yr,wr,br,Sr,xr,Cr.__wbg_ptr);var Ir=getInt32Memory0()[Pr/4+0],Rr=getFloat64Memory0()[Pr/8+1];return Ir===0?void 0:Rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}remove(er,tr,rr,nr){_assertClass(tr,RawIslandManager),_assertClass(rr,RawRigidBodySet),wasm$1.rawcolliderset_remove(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr)}isHandleValid(er){return wasm$1.rawcolliderset_contains(this.__wbg_ptr,er)!==0}forEachColliderHandle(er){try{wasm$1.rawcolliderset_forEachColliderHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}}const RawColliderShapeCastHitFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawcollidershapecasthit_free(ir>>>0));class RawColliderShapeCastHit{static __wrap(er){er=er>>>0;const tr=Object.create(RawColliderShapeCastHit.prototype);return tr.__wbg_ptr=er,RawColliderShapeCastHitFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawColliderShapeCastHitFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcollidershapecasthit_free(er)}colliderHandle(){return wasm$1.rawcharactercollision_handle(this.__wbg_ptr)}time_of_impact(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}witness1(){const er=wasm$1.rawcollidershapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}witness2(){const er=wasm$1.rawcollidershapecasthit_witness2(this.__wbg_ptr);return RawVector.__wrap(er)}normal1(){const er=wasm$1.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return RawVector.__wrap(er)}normal2(){const er=wasm$1.rawcharactercollision_translationDeltaRemaining(this.__wbg_ptr);return RawVector.__wrap(er)}}const RawContactForceEventFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawcontactforceevent_free(ir>>>0));class RawContactForceEvent{static __wrap(er){er=er>>>0;const tr=Object.create(RawContactForceEvent.prototype);return tr.__wbg_ptr=er,RawContactForceEventFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawContactForceEventFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcontactforceevent_free(er)}collider1(){return wasm$1.rawcharactercollision_handle(this.__wbg_ptr)}collider2(){return wasm$1.rawcontactforceevent_collider2(this.__wbg_ptr)}total_force(){const er=wasm$1.rawcontactforceevent_total_force(this.__wbg_ptr);return RawVector.__wrap(er)}total_force_magnitude(){return wasm$1.rawcontactforceevent_total_force_magnitude(this.__wbg_ptr)}max_force_direction(){const er=wasm$1.rawcontactforceevent_max_force_direction(this.__wbg_ptr);return RawVector.__wrap(er)}max_force_magnitude(){return wasm$1.rawcontactforceevent_max_force_magnitude(this.__wbg_ptr)}}const RawContactManifoldFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawcontactmanifold_free(ir>>>0));class RawContactManifold{static __wrap(er){er=er>>>0;const tr=Object.create(RawContactManifold.prototype);return tr.__wbg_ptr=er,RawContactManifoldFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawContactManifoldFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcontactmanifold_free(er)}normal(){const er=wasm$1.rawcontactmanifold_normal(this.__wbg_ptr);return RawVector.__wrap(er)}local_n1(){const er=wasm$1.rawcontactmanifold_local_n1(this.__wbg_ptr);return RawVector.__wrap(er)}local_n2(){const er=wasm$1.rawcontactmanifold_local_n2(this.__wbg_ptr);return RawVector.__wrap(er)}subshape1(){return wasm$1.rawcontactmanifold_subshape1(this.__wbg_ptr)>>>0}subshape2(){return wasm$1.rawcontactmanifold_subshape2(this.__wbg_ptr)>>>0}num_contacts(){return wasm$1.rawcontactmanifold_num_contacts(this.__wbg_ptr)>>>0}contact_local_p1(er){const tr=wasm$1.rawcontactmanifold_contact_local_p1(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}contact_local_p2(er){const tr=wasm$1.rawcontactmanifold_contact_local_p2(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}contact_dist(er){return wasm$1.rawcontactmanifold_contact_dist(this.__wbg_ptr,er)}contact_fid1(er){return wasm$1.rawcontactmanifold_contact_fid1(this.__wbg_ptr,er)>>>0}contact_fid2(er){return wasm$1.rawcontactmanifold_contact_fid2(this.__wbg_ptr,er)>>>0}contact_impulse(er){return wasm$1.rawcontactmanifold_contact_impulse(this.__wbg_ptr,er)}contact_tangent_impulse_x(er){return wasm$1.rawcontactmanifold_contact_tangent_impulse_x(this.__wbg_ptr,er)}contact_tangent_impulse_y(er){return wasm$1.rawcontactmanifold_contact_tangent_impulse_y(this.__wbg_ptr,er)}num_solver_contacts(){return wasm$1.rawcontactmanifold_num_solver_contacts(this.__wbg_ptr)>>>0}solver_contact_point(er){const tr=wasm$1.rawcontactmanifold_solver_contact_point(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}solver_contact_dist(er){return wasm$1.rawcontactmanifold_solver_contact_dist(this.__wbg_ptr,er)}solver_contact_friction(er){return wasm$1.rawcontactmanifold_solver_contact_friction(this.__wbg_ptr,er)}solver_contact_restitution(er){return wasm$1.rawcontactmanifold_solver_contact_restitution(this.__wbg_ptr,er)}solver_contact_tangent_velocity(er){const tr=wasm$1.rawcontactmanifold_solver_contact_tangent_velocity(this.__wbg_ptr,er);return RawVector.__wrap(tr)}}const RawContactPairFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawcontactpair_free(ir>>>0));class RawContactPair{static __wrap(er){er=er>>>0;const tr=Object.create(RawContactPair.prototype);return tr.__wbg_ptr=er,RawContactPairFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawContactPairFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcontactpair_free(er)}collider1(){return wasm$1.rawcontactpair_collider1(this.__wbg_ptr)}collider2(){return wasm$1.rawcontactpair_collider2(this.__wbg_ptr)}numContactManifolds(){return wasm$1.rawcontactpair_numContactManifolds(this.__wbg_ptr)>>>0}contactManifold(er){const tr=wasm$1.rawcontactpair_contactManifold(this.__wbg_ptr,er);return tr===0?void 0:RawContactManifold.__wrap(tr)}}const RawDebugRenderPipelineFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawdebugrenderpipeline_free(ir>>>0));class RawDebugRenderPipeline{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawDebugRenderPipelineFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawdebugrenderpipeline_free(er)}constructor(){const er=wasm$1.rawdebugrenderpipeline_new();return this.__wbg_ptr=er>>>0,this}vertices(){const er=wasm$1.rawdebugrenderpipeline_vertices(this.__wbg_ptr);return takeObject(er)}colors(){const er=wasm$1.rawdebugrenderpipeline_colors(this.__wbg_ptr);return takeObject(er)}render(er,tr,rr,nr,sr){_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawImpulseJointSet),_assertClass(nr,RawMultibodyJointSet),_assertClass(sr,RawNarrowPhase),wasm$1.rawdebugrenderpipeline_render(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr)}}const RawDeserializedWorldFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawdeserializedworld_free(ir>>>0));class RawDeserializedWorld{static __wrap(er){er=er>>>0;const tr=Object.create(RawDeserializedWorld.prototype);return tr.__wbg_ptr=er,RawDeserializedWorldFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawDeserializedWorldFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawdeserializedworld_free(er)}takeGravity(){const er=wasm$1.rawdeserializedworld_takeGravity(this.__wbg_ptr);return er===0?void 0:RawVector.__wrap(er)}takeIntegrationParameters(){const er=wasm$1.rawdeserializedworld_takeIntegrationParameters(this.__wbg_ptr);return er===0?void 0:RawIntegrationParameters.__wrap(er)}takeIslandManager(){const er=wasm$1.rawdeserializedworld_takeIslandManager(this.__wbg_ptr);return er===0?void 0:RawIslandManager.__wrap(er)}takeBroadPhase(){const er=wasm$1.rawdeserializedworld_takeBroadPhase(this.__wbg_ptr);return er===0?void 0:RawBroadPhase.__wrap(er)}takeNarrowPhase(){const er=wasm$1.rawdeserializedworld_takeNarrowPhase(this.__wbg_ptr);return er===0?void 0:RawNarrowPhase.__wrap(er)}takeBodies(){const er=wasm$1.rawdeserializedworld_takeBodies(this.__wbg_ptr);return er===0?void 0:RawRigidBodySet.__wrap(er)}takeColliders(){const er=wasm$1.rawdeserializedworld_takeColliders(this.__wbg_ptr);return er===0?void 0:RawColliderSet.__wrap(er)}takeImpulseJoints(){const er=wasm$1.rawdeserializedworld_takeImpulseJoints(this.__wbg_ptr);return er===0?void 0:RawImpulseJointSet.__wrap(er)}takeMultibodyJoints(){const er=wasm$1.rawdeserializedworld_takeMultibodyJoints(this.__wbg_ptr);return er===0?void 0:RawMultibodyJointSet.__wrap(er)}}const RawDynamicRayCastVehicleControllerFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawdynamicraycastvehiclecontroller_free(ir>>>0));class RawDynamicRayCastVehicleController{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawDynamicRayCastVehicleControllerFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawdynamicraycastvehiclecontroller_free(er)}constructor(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_new(er);return this.__wbg_ptr=tr>>>0,this}current_vehicle_speed(){return wasm$1.rawdynamicraycastvehiclecontroller_current_vehicle_speed(this.__wbg_ptr)}chassis(){return wasm$1.rawdynamicraycastvehiclecontroller_chassis(this.__wbg_ptr)}index_up_axis(){return wasm$1.rawdynamicraycastvehiclecontroller_index_up_axis(this.__wbg_ptr)>>>0}set_index_up_axis(er){wasm$1.rawdynamicraycastvehiclecontroller_set_index_up_axis(this.__wbg_ptr,er)}index_forward_axis(){return wasm$1.rawdynamicraycastvehiclecontroller_index_forward_axis(this.__wbg_ptr)>>>0}set_index_forward_axis(er){wasm$1.rawdynamicraycastvehiclecontroller_set_index_forward_axis(this.__wbg_ptr,er)}add_wheel(er,tr,rr,nr,sr){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(rr,RawVector),wasm$1.rawdynamicraycastvehiclecontroller_add_wheel(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr,sr)}num_wheels(){return wasm$1.rawdynamicraycastvehiclecontroller_num_wheels(this.__wbg_ptr)>>>0}update_vehicle(er,tr,rr,nr,sr,ar,or){try{_assertClass(tr,RawRigidBodySet),_assertClass(rr,RawColliderSet),_assertClass(nr,RawQueryPipeline),wasm$1.rawdynamicraycastvehiclecontroller_update_vehicle(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr,!isLikeNone(ar),isLikeNone(ar)?0:ar,addBorrowedObject(or))}finally{heap[stack_pointer++]=void 0}}wheel_chassis_connection_point_cs(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_chassis_connection_point_cs(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}set_wheel_chassis_connection_point_cs(er,tr){_assertClass(tr,RawVector),wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_chassis_connection_point_cs(this.__wbg_ptr,er,tr.__wbg_ptr)}wheel_suspension_rest_length(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_rest_length(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_suspension_rest_length(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_suspension_rest_length(this.__wbg_ptr,er,tr)}wheel_max_suspension_travel(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_max_suspension_travel(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_max_suspension_travel(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_travel(this.__wbg_ptr,er,tr)}wheel_radius(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_radius(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_radius(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_radius(this.__wbg_ptr,er,tr)}wheel_suspension_stiffness(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_stiffness(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_suspension_stiffness(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_suspension_stiffness(this.__wbg_ptr,er,tr)}wheel_suspension_compression(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_compression(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_suspension_compression(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_suspension_compression(this.__wbg_ptr,er,tr)}wheel_suspension_relaxation(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_relaxation(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_suspension_relaxation(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_suspension_relaxation(this.__wbg_ptr,er,tr)}wheel_max_suspension_force(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_max_suspension_force(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_max_suspension_force(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_force(this.__wbg_ptr,er,tr)}wheel_brake(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_brake(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_brake(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_brake(this.__wbg_ptr,er,tr)}wheel_steering(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_steering(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_steering(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_steering(this.__wbg_ptr,er,tr)}wheel_engine_force(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_engine_force(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_engine_force(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_engine_force(this.__wbg_ptr,er,tr)}wheel_direction_cs(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_direction_cs(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}set_wheel_direction_cs(er,tr){_assertClass(tr,RawVector),wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_direction_cs(this.__wbg_ptr,er,tr.__wbg_ptr)}wheel_axle_cs(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_axle_cs(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}set_wheel_axle_cs(er,tr){_assertClass(tr,RawVector),wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_axle_cs(this.__wbg_ptr,er,tr.__wbg_ptr)}wheel_friction_slip(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_friction_slip(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_friction_slip(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_friction_slip(this.__wbg_ptr,er,tr)}wheel_side_friction_stiffness(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_side_friction_stiffness(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_side_friction_stiffness(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_side_friction_stiffness(this.__wbg_ptr,er,tr)}wheel_rotation(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_rotation(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_forward_impulse(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_forward_impulse(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_side_impulse(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_side_impulse(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_suspension_force(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_force(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_contact_normal_ws(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_contact_normal_ws(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}wheel_contact_point_ws(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_contact_point_ws(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}wheel_suspension_length(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_length(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat32Memory0()[nr/4+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_hard_point_ws(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_hard_point_ws(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}wheel_is_in_contact(er){return wasm$1.rawdynamicraycastvehiclecontroller_wheel_is_in_contact(this.__wbg_ptr,er)!==0}wheel_ground_object(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_ground_object(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],rr=getFloat64Memory0()[nr/8+1];return tr===0?void 0:rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}}const RawEventQueueFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_raweventqueue_free(ir>>>0));class RawEventQueue{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawEventQueueFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_raweventqueue_free(er)}constructor(er){const tr=wasm$1.raweventqueue_new(er);return this.__wbg_ptr=tr>>>0,this}drainCollisionEvents(er){try{wasm$1.raweventqueue_drainCollisionEvents(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}drainContactForceEvents(er){try{wasm$1.raweventqueue_drainContactForceEvents(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}clear(){wasm$1.raweventqueue_clear(this.__wbg_ptr)}}const RawGenericJointFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawgenericjoint_free(ir>>>0));class RawGenericJoint{static __wrap(er){er=er>>>0;const tr=Object.create(RawGenericJoint.prototype);return tr.__wbg_ptr=er,RawGenericJointFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawGenericJointFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawgenericjoint_free(er)}static generic(er,tr,rr,nr){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(rr,RawVector);const sr=wasm$1.rawgenericjoint_generic(er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr);return sr===0?void 0:RawGenericJoint.__wrap(sr)}static spring(er,tr,rr,nr,sr){_assertClass(nr,RawVector),_assertClass(sr,RawVector);const ar=wasm$1.rawgenericjoint_spring(er,tr,rr,nr.__wbg_ptr,sr.__wbg_ptr);return RawGenericJoint.__wrap(ar)}static rope(er,tr,rr){_assertClass(tr,RawVector),_assertClass(rr,RawVector);const nr=wasm$1.rawgenericjoint_rope(er,tr.__wbg_ptr,rr.__wbg_ptr);return RawGenericJoint.__wrap(nr)}static spherical(er,tr){_assertClass(er,RawVector),_assertClass(tr,RawVector);const rr=wasm$1.rawgenericjoint_spherical(er.__wbg_ptr,tr.__wbg_ptr);return RawGenericJoint.__wrap(rr)}static prismatic(er,tr,rr,nr,sr,ar){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(rr,RawVector);const or=wasm$1.rawgenericjoint_prismatic(er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr,sr,ar);return or===0?void 0:RawGenericJoint.__wrap(or)}static fixed(er,tr,rr,nr){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawVector),_assertClass(nr,RawRotation);const sr=wasm$1.rawgenericjoint_fixed(er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr);return RawGenericJoint.__wrap(sr)}static revolute(er,tr,rr){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(rr,RawVector);const nr=wasm$1.rawgenericjoint_revolute(er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr);return nr===0?void 0:RawGenericJoint.__wrap(nr)}}const RawImpulseJointSetFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawimpulsejointset_free(ir>>>0));class RawImpulseJointSet{static __wrap(er){er=er>>>0;const tr=Object.create(RawImpulseJointSet.prototype);return tr.__wbg_ptr=er,RawImpulseJointSetFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawImpulseJointSetFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawimpulsejointset_free(er)}jointType(er){return wasm$1.rawimpulsejointset_jointType(this.__wbg_ptr,er)}jointBodyHandle1(er){return wasm$1.rawimpulsejointset_jointBodyHandle1(this.__wbg_ptr,er)}jointBodyHandle2(er){return wasm$1.rawimpulsejointset_jointBodyHandle2(this.__wbg_ptr,er)}jointFrameX1(er){const tr=wasm$1.rawimpulsejointset_jointFrameX1(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}jointFrameX2(er){const tr=wasm$1.rawimpulsejointset_jointFrameX2(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}jointAnchor1(er){const tr=wasm$1.rawimpulsejointset_jointAnchor1(this.__wbg_ptr,er);return RawVector.__wrap(tr)}jointAnchor2(er){const tr=wasm$1.rawimpulsejointset_jointAnchor2(this.__wbg_ptr,er);return RawVector.__wrap(tr)}jointSetAnchor1(er,tr){_assertClass(tr,RawVector),wasm$1.rawimpulsejointset_jointSetAnchor1(this.__wbg_ptr,er,tr.__wbg_ptr)}jointSetAnchor2(er,tr){_assertClass(tr,RawVector),wasm$1.rawimpulsejointset_jointSetAnchor2(this.__wbg_ptr,er,tr.__wbg_ptr)}jointContactsEnabled(er){return wasm$1.rawimpulsejointset_jointContactsEnabled(this.__wbg_ptr,er)!==0}jointSetContactsEnabled(er,tr){wasm$1.rawimpulsejointset_jointSetContactsEnabled(this.__wbg_ptr,er,tr)}jointLimitsEnabled(er,tr){return wasm$1.rawimpulsejointset_jointLimitsEnabled(this.__wbg_ptr,er,tr)!==0}jointLimitsMin(er,tr){return wasm$1.rawimpulsejointset_jointLimitsMin(this.__wbg_ptr,er,tr)}jointLimitsMax(er,tr){return wasm$1.rawimpulsejointset_jointLimitsMax(this.__wbg_ptr,er,tr)}jointSetLimits(er,tr,rr,nr){wasm$1.rawimpulsejointset_jointSetLimits(this.__wbg_ptr,er,tr,rr,nr)}jointConfigureMotorModel(er,tr,rr){wasm$1.rawimpulsejointset_jointConfigureMotorModel(this.__wbg_ptr,er,tr,rr)}jointConfigureMotorVelocity(er,tr,rr,nr){wasm$1.rawimpulsejointset_jointConfigureMotorVelocity(this.__wbg_ptr,er,tr,rr,nr)}jointConfigureMotorPosition(er,tr,rr,nr,sr){wasm$1.rawimpulsejointset_jointConfigureMotorPosition(this.__wbg_ptr,er,tr,rr,nr,sr)}jointConfigureMotor(er,tr,rr,nr,sr,ar){wasm$1.rawimpulsejointset_jointConfigureMotor(this.__wbg_ptr,er,tr,rr,nr,sr,ar)}constructor(){const er=wasm$1.rawimpulsejointset_new();return this.__wbg_ptr=er>>>0,this}createJoint(er,tr,rr,nr){return _assertClass(er,RawGenericJoint),wasm$1.rawimpulsejointset_createJoint(this.__wbg_ptr,er.__wbg_ptr,tr,rr,nr)}remove(er,tr){wasm$1.rawimpulsejointset_remove(this.__wbg_ptr,er,tr)}len(){return wasm$1.rawimpulsejointset_len(this.__wbg_ptr)>>>0}contains(er){return wasm$1.rawimpulsejointset_contains(this.__wbg_ptr,er)!==0}forEachJointHandle(er){try{wasm$1.rawimpulsejointset_forEachJointHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}forEachJointAttachedToRigidBody(er,tr){try{wasm$1.rawimpulsejointset_forEachJointAttachedToRigidBody(this.__wbg_ptr,er,addBorrowedObject(tr))}finally{heap[stack_pointer++]=void 0}}}const RawIntegrationParametersFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawintegrationparameters_free(ir>>>0));class RawIntegrationParameters{static __wrap(er){er=er>>>0;const tr=Object.create(RawIntegrationParameters.prototype);return tr.__wbg_ptr=er,RawIntegrationParametersFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawIntegrationParametersFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawintegrationparameters_free(er)}constructor(){const er=wasm$1.rawintegrationparameters_new();return this.__wbg_ptr=er>>>0,this}get dt(){return wasm$1.rawintegrationparameters_dt(this.__wbg_ptr)}get contact_erp(){return wasm$1.rawintegrationparameters_contact_erp(this.__wbg_ptr)}get normalizedAllowedLinearError(){return wasm$1.rawdynamicraycastvehiclecontroller_current_vehicle_speed(this.__wbg_ptr)}get normalizedPredictionDistance(){return wasm$1.rawcontactforceevent_max_force_magnitude(this.__wbg_ptr)}get numSolverIterations(){return wasm$1.rawintegrationparameters_numSolverIterations(this.__wbg_ptr)>>>0}get numAdditionalFrictionIterations(){return wasm$1.rawdynamicraycastvehiclecontroller_index_up_axis(this.__wbg_ptr)>>>0}get numInternalPgsIterations(){return wasm$1.rawdynamicraycastvehiclecontroller_index_forward_axis(this.__wbg_ptr)>>>0}get minIslandSize(){return wasm$1.rawimpulsejointset_len(this.__wbg_ptr)>>>0}get maxCcdSubsteps(){return wasm$1.rawintegrationparameters_maxCcdSubsteps(this.__wbg_ptr)>>>0}get lengthUnit(){return wasm$1.rawintegrationparameters_lengthUnit(this.__wbg_ptr)}set dt(er){wasm$1.rawintegrationparameters_set_dt(this.__wbg_ptr,er)}set contact_natural_frequency(er){wasm$1.rawintegrationparameters_set_contact_natural_frequency(this.__wbg_ptr,er)}set normalizedAllowedLinearError(er){wasm$1.rawintegrationparameters_set_normalizedAllowedLinearError(this.__wbg_ptr,er)}set normalizedPredictionDistance(er){wasm$1.rawintegrationparameters_set_normalizedPredictionDistance(this.__wbg_ptr,er)}set numSolverIterations(er){wasm$1.rawintegrationparameters_set_numSolverIterations(this.__wbg_ptr,er)}set numAdditionalFrictionIterations(er){wasm$1.rawdynamicraycastvehiclecontroller_set_index_up_axis(this.__wbg_ptr,er)}set numInternalPgsIterations(er){wasm$1.rawdynamicraycastvehiclecontroller_set_index_forward_axis(this.__wbg_ptr,er)}set minIslandSize(er){wasm$1.rawintegrationparameters_set_minIslandSize(this.__wbg_ptr,er)}set maxCcdSubsteps(er){wasm$1.rawintegrationparameters_set_maxCcdSubsteps(this.__wbg_ptr,er)}set lengthUnit(er){wasm$1.rawintegrationparameters_set_lengthUnit(this.__wbg_ptr,er)}switchToStandardPgsSolver(){wasm$1.rawintegrationparameters_switchToStandardPgsSolver(this.__wbg_ptr)}switchToSmallStepsPgsSolver(){wasm$1.rawintegrationparameters_switchToSmallStepsPgsSolver(this.__wbg_ptr)}switchToSmallStepsPgsSolverWithoutWarmstart(){wasm$1.rawintegrationparameters_switchToSmallStepsPgsSolverWithoutWarmstart(this.__wbg_ptr)}}const RawIslandManagerFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawislandmanager_free(ir>>>0));class RawIslandManager{static __wrap(er){er=er>>>0;const tr=Object.create(RawIslandManager.prototype);return tr.__wbg_ptr=er,RawIslandManagerFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawIslandManagerFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawislandmanager_free(er)}constructor(){const er=wasm$1.rawislandmanager_new();return this.__wbg_ptr=er>>>0,this}forEachActiveRigidBodyHandle(er){try{wasm$1.rawislandmanager_forEachActiveRigidBodyHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}}const RawKinematicCharacterControllerFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawkinematiccharactercontroller_free(ir>>>0));class RawKinematicCharacterController{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawKinematicCharacterControllerFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawkinematiccharactercontroller_free(er)}constructor(er){const tr=wasm$1.rawkinematiccharactercontroller_new(er);return this.__wbg_ptr=tr>>>0,this}up(){const er=wasm$1.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return RawVector.__wrap(er)}setUp(er){_assertClass(er,RawVector),wasm$1.rawkinematiccharactercontroller_setUp(this.__wbg_ptr,er.__wbg_ptr)}normalNudgeFactor(){return wasm$1.rawkinematiccharactercontroller_normalNudgeFactor(this.__wbg_ptr)}setNormalNudgeFactor(er){wasm$1.rawkinematiccharactercontroller_setNormalNudgeFactor(this.__wbg_ptr,er)}offset(){return wasm$1.rawintegrationparameters_dt(this.__wbg_ptr)}setOffset(er){wasm$1.rawkinematiccharactercontroller_setOffset(this.__wbg_ptr,er)}slideEnabled(){return wasm$1.rawkinematiccharactercontroller_slideEnabled(this.__wbg_ptr)!==0}setSlideEnabled(er){wasm$1.rawkinematiccharactercontroller_setSlideEnabled(this.__wbg_ptr,er)}autostepMaxHeight(){try{const rr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawkinematiccharactercontroller_autostepMaxHeight(rr,this.__wbg_ptr);var er=getInt32Memory0()[rr/4+0],tr=getFloat32Memory0()[rr/4+1];return er===0?void 0:tr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}autostepMinWidth(){try{const rr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawkinematiccharactercontroller_autostepMinWidth(rr,this.__wbg_ptr);var er=getInt32Memory0()[rr/4+0],tr=getFloat32Memory0()[rr/4+1];return er===0?void 0:tr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}autostepIncludesDynamicBodies(){const er=wasm$1.rawkinematiccharactercontroller_autostepIncludesDynamicBodies(this.__wbg_ptr);return er===16777215?void 0:er!==0}autostepEnabled(){return wasm$1.rawkinematiccharactercontroller_autostepEnabled(this.__wbg_ptr)!==0}enableAutostep(er,tr,rr){wasm$1.rawkinematiccharactercontroller_enableAutostep(this.__wbg_ptr,er,tr,rr)}disableAutostep(){wasm$1.rawkinematiccharactercontroller_disableAutostep(this.__wbg_ptr)}maxSlopeClimbAngle(){return wasm$1.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}setMaxSlopeClimbAngle(er){wasm$1.rawkinematiccharactercontroller_setMaxSlopeClimbAngle(this.__wbg_ptr,er)}minSlopeSlideAngle(){return wasm$1.rawkinematiccharactercontroller_minSlopeSlideAngle(this.__wbg_ptr)}setMinSlopeSlideAngle(er){wasm$1.rawkinematiccharactercontroller_setMinSlopeSlideAngle(this.__wbg_ptr,er)}snapToGroundDistance(){try{const rr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawkinematiccharactercontroller_snapToGroundDistance(rr,this.__wbg_ptr);var er=getInt32Memory0()[rr/4+0],tr=getFloat32Memory0()[rr/4+1];return er===0?void 0:tr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}enableSnapToGround(er){wasm$1.rawkinematiccharactercontroller_enableSnapToGround(this.__wbg_ptr,er)}disableSnapToGround(){wasm$1.rawkinematiccharactercontroller_disableSnapToGround(this.__wbg_ptr)}snapToGroundEnabled(){return wasm$1.rawkinematiccharactercontroller_snapToGroundEnabled(this.__wbg_ptr)!==0}computeColliderMovement(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr){try{_assertClass(tr,RawRigidBodySet),_assertClass(rr,RawColliderSet),_assertClass(nr,RawQueryPipeline),_assertClass(ar,RawVector),wasm$1.rawkinematiccharactercontroller_computeColliderMovement(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr,ar.__wbg_ptr,or,!isLikeNone(lr),isLikeNone(lr)?0:lr,cr,!isLikeNone(hr),isLikeNone(hr)?0:hr,addBorrowedObject(fr))}finally{heap[stack_pointer++]=void 0}}computedMovement(){const er=wasm$1.rawkinematiccharactercontroller_computedMovement(this.__wbg_ptr);return RawVector.__wrap(er)}computedGrounded(){return wasm$1.rawkinematiccharactercontroller_computedGrounded(this.__wbg_ptr)!==0}numComputedCollisions(){return wasm$1.rawkinematiccharactercontroller_numComputedCollisions(this.__wbg_ptr)>>>0}computedCollision(er,tr){return _assertClass(tr,RawCharacterCollision),wasm$1.rawkinematiccharactercontroller_computedCollision(this.__wbg_ptr,er,tr.__wbg_ptr)!==0}}const RawMultibodyJointSetFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawmultibodyjointset_free(ir>>>0));class RawMultibodyJointSet{static __wrap(er){er=er>>>0;const tr=Object.create(RawMultibodyJointSet.prototype);return tr.__wbg_ptr=er,RawMultibodyJointSetFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawMultibodyJointSetFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawmultibodyjointset_free(er)}jointType(er){return wasm$1.rawmultibodyjointset_jointType(this.__wbg_ptr,er)}jointFrameX1(er){const tr=wasm$1.rawmultibodyjointset_jointFrameX1(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}jointFrameX2(er){const tr=wasm$1.rawmultibodyjointset_jointFrameX2(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}jointAnchor1(er){const tr=wasm$1.rawmultibodyjointset_jointAnchor1(this.__wbg_ptr,er);return RawVector.__wrap(tr)}jointAnchor2(er){const tr=wasm$1.rawmultibodyjointset_jointAnchor2(this.__wbg_ptr,er);return RawVector.__wrap(tr)}jointContactsEnabled(er){return wasm$1.rawmultibodyjointset_jointContactsEnabled(this.__wbg_ptr,er)!==0}jointSetContactsEnabled(er,tr){wasm$1.rawmultibodyjointset_jointSetContactsEnabled(this.__wbg_ptr,er,tr)}jointLimitsEnabled(er,tr){return wasm$1.rawmultibodyjointset_jointLimitsEnabled(this.__wbg_ptr,er,tr)!==0}jointLimitsMin(er,tr){return wasm$1.rawmultibodyjointset_jointLimitsMin(this.__wbg_ptr,er,tr)}jointLimitsMax(er,tr){return wasm$1.rawmultibodyjointset_jointLimitsMax(this.__wbg_ptr,er,tr)}constructor(){const er=wasm$1.rawmultibodyjointset_new();return this.__wbg_ptr=er>>>0,this}createJoint(er,tr,rr,nr){return _assertClass(er,RawGenericJoint),wasm$1.rawmultibodyjointset_createJoint(this.__wbg_ptr,er.__wbg_ptr,tr,rr,nr)}remove(er,tr){wasm$1.rawmultibodyjointset_remove(this.__wbg_ptr,er,tr)}contains(er){return wasm$1.rawmultibodyjointset_contains(this.__wbg_ptr,er)!==0}forEachJointHandle(er){try{wasm$1.rawmultibodyjointset_forEachJointHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}forEachJointAttachedToRigidBody(er,tr){try{wasm$1.rawmultibodyjointset_forEachJointAttachedToRigidBody(this.__wbg_ptr,er,addBorrowedObject(tr))}finally{heap[stack_pointer++]=void 0}}}const RawNarrowPhaseFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawnarrowphase_free(ir>>>0));class RawNarrowPhase{static __wrap(er){er=er>>>0;const tr=Object.create(RawNarrowPhase.prototype);return tr.__wbg_ptr=er,RawNarrowPhaseFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawNarrowPhaseFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawnarrowphase_free(er)}constructor(){const er=wasm$1.rawnarrowphase_new();return this.__wbg_ptr=er>>>0,this}contact_pairs_with(er,tr){wasm$1.rawnarrowphase_contact_pairs_with(this.__wbg_ptr,er,addHeapObject(tr))}contact_pair(er,tr){const rr=wasm$1.rawnarrowphase_contact_pair(this.__wbg_ptr,er,tr);return rr===0?void 0:RawContactPair.__wrap(rr)}intersection_pairs_with(er,tr){wasm$1.rawnarrowphase_intersection_pairs_with(this.__wbg_ptr,er,addHeapObject(tr))}intersection_pair(er,tr){return wasm$1.rawnarrowphase_intersection_pair(this.__wbg_ptr,er,tr)!==0}}const RawPhysicsPipelineFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawphysicspipeline_free(ir>>>0));class RawPhysicsPipeline{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawPhysicsPipelineFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawphysicspipeline_free(er)}constructor(){const er=wasm$1.rawphysicspipeline_new();return this.__wbg_ptr=er>>>0,this}step(er,tr,rr,nr,sr,ar,or,lr,cr,hr){_assertClass(er,RawVector),_assertClass(tr,RawIntegrationParameters),_assertClass(rr,RawIslandManager),_assertClass(nr,RawBroadPhase),_assertClass(sr,RawNarrowPhase),_assertClass(ar,RawRigidBodySet),_assertClass(or,RawColliderSet),_assertClass(lr,RawImpulseJointSet),_assertClass(cr,RawMultibodyJointSet),_assertClass(hr,RawCCDSolver),wasm$1.rawphysicspipeline_step(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr,hr.__wbg_ptr)}stepWithEvents(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr){_assertClass(er,RawVector),_assertClass(tr,RawIntegrationParameters),_assertClass(rr,RawIslandManager),_assertClass(nr,RawBroadPhase),_assertClass(sr,RawNarrowPhase),_assertClass(ar,RawRigidBodySet),_assertClass(or,RawColliderSet),_assertClass(lr,RawImpulseJointSet),_assertClass(cr,RawMultibodyJointSet),_assertClass(hr,RawCCDSolver),_assertClass(fr,RawEventQueue),wasm$1.rawphysicspipeline_stepWithEvents(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr,hr.__wbg_ptr,fr.__wbg_ptr,addHeapObject(ur),addHeapObject(pr),addHeapObject(gr))}}const RawPointColliderProjectionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawpointcolliderprojection_free(ir>>>0));class RawPointColliderProjection{static __wrap(er){er=er>>>0;const tr=Object.create(RawPointColliderProjection.prototype);return tr.__wbg_ptr=er,RawPointColliderProjectionFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawPointColliderProjectionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawpointcolliderprojection_free(er)}colliderHandle(){return wasm$1.rawpointcolliderprojection_colliderHandle(this.__wbg_ptr)}point(){const er=wasm$1.rawpointcolliderprojection_point(this.__wbg_ptr);return RawVector.__wrap(er)}isInside(){return wasm$1.rawpointcolliderprojection_isInside(this.__wbg_ptr)!==0}featureType(){return wasm$1.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const rr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawpointcolliderprojection_featureId(rr,this.__wbg_ptr);var er=getInt32Memory0()[rr/4+0],tr=getInt32Memory0()[rr/4+1];return er===0?void 0:tr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}}const RawPointProjectionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawpointprojection_free(ir>>>0));class RawPointProjection{static __wrap(er){er=er>>>0;const tr=Object.create(RawPointProjection.prototype);return tr.__wbg_ptr=er,RawPointProjectionFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawPointProjectionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawpointprojection_free(er)}point(){const er=wasm$1.rawpointprojection_point(this.__wbg_ptr);return RawVector.__wrap(er)}isInside(){return wasm$1.rawpointprojection_isInside(this.__wbg_ptr)!==0}}const RawQueryPipelineFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawquerypipeline_free(ir>>>0));class RawQueryPipeline{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawQueryPipelineFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawquerypipeline_free(er)}constructor(){const er=wasm$1.rawquerypipeline_new();return this.__wbg_ptr=er>>>0,this}update(er){_assertClass(er,RawColliderSet),wasm$1.rawquerypipeline_update(this.__wbg_ptr,er.__wbg_ptr)}castRay(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector),_assertClass(nr,RawVector);const ur=wasm$1.rawquerypipeline_castRay(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr,ar,or,!isLikeNone(lr),isLikeNone(lr)?0:lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,!isLikeNone(hr),isLikeNone(hr)?0:hr,addBorrowedObject(fr));return ur===0?void 0:RawRayColliderHit.__wrap(ur)}finally{heap[stack_pointer++]=void 0}}castRayAndGetNormal(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector),_assertClass(nr,RawVector);const ur=wasm$1.rawquerypipeline_castRayAndGetNormal(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr,ar,or,!isLikeNone(lr),isLikeNone(lr)?0:lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,!isLikeNone(hr),isLikeNone(hr)?0:hr,addBorrowedObject(fr));return ur===0?void 0:RawRayColliderIntersection.__wrap(ur)}finally{heap[stack_pointer++]=void 0}}intersectionsWithRay(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector),_assertClass(nr,RawVector),wasm$1.rawquerypipeline_intersectionsWithRay(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr,ar,addBorrowedObject(or),lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,!isLikeNone(hr),isLikeNone(hr)?0:hr,!isLikeNone(fr),isLikeNone(fr)?0:fr,addBorrowedObject(ur))}finally{heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}intersectionWithShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr){try{const pr=wasm$1.__wbindgen_add_to_stack_pointer(-16);_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector),_assertClass(nr,RawRotation),_assertClass(sr,RawShape),wasm$1.rawquerypipeline_intersectionWithShape(pr,this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar,!isLikeNone(or),isLikeNone(or)?0:or,!isLikeNone(lr),isLikeNone(lr)?0:lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,addBorrowedObject(hr));var fr=getInt32Memory0()[pr/4+0],ur=getFloat64Memory0()[pr/8+1];return fr===0?void 0:ur}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}projectPoint(er,tr,rr,nr,sr,ar,or,lr,cr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector);const hr=wasm$1.rawquerypipeline_projectPoint(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr,sr,!isLikeNone(ar),isLikeNone(ar)?0:ar,!isLikeNone(or),isLikeNone(or)?0:or,!isLikeNone(lr),isLikeNone(lr)?0:lr,addBorrowedObject(cr));return hr===0?void 0:RawPointColliderProjection.__wrap(hr)}finally{heap[stack_pointer++]=void 0}}projectPointAndGetFeature(er,tr,rr,nr,sr,ar,or,lr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector);const cr=wasm$1.rawquerypipeline_projectPointAndGetFeature(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr,!isLikeNone(sr),isLikeNone(sr)?0:sr,!isLikeNone(ar),isLikeNone(ar)?0:ar,!isLikeNone(or),isLikeNone(or)?0:or,addBorrowedObject(lr));return cr===0?void 0:RawPointColliderProjection.__wrap(cr)}finally{heap[stack_pointer++]=void 0}}intersectionsWithPoint(er,tr,rr,nr,sr,ar,or,lr,cr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector),wasm$1.rawquerypipeline_intersectionsWithPoint(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,addBorrowedObject(nr),sr,!isLikeNone(ar),isLikeNone(ar)?0:ar,!isLikeNone(or),isLikeNone(or)?0:or,!isLikeNone(lr),isLikeNone(lr)?0:lr,addBorrowedObject(cr))}finally{heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}castShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector),_assertClass(nr,RawRotation),_assertClass(sr,RawVector),_assertClass(ar,RawShape);const _r=wasm$1.rawquerypipeline_castShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or,lr,cr,hr,!isLikeNone(fr),isLikeNone(fr)?0:fr,!isLikeNone(ur),isLikeNone(ur)?0:ur,!isLikeNone(pr),isLikeNone(pr)?0:pr,addBorrowedObject(gr));return _r===0?void 0:RawColliderShapeCastHit.__wrap(_r)}finally{heap[stack_pointer++]=void 0}}intersectionsWithShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(rr,RawVector),_assertClass(nr,RawRotation),_assertClass(sr,RawShape),wasm$1.rawquerypipeline_intersectionsWithShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,addBorrowedObject(ar),or,!isLikeNone(lr),isLikeNone(lr)?0:lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,!isLikeNone(hr),isLikeNone(hr)?0:hr,addBorrowedObject(fr))}finally{heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}collidersWithAabbIntersectingAabb(er,tr,rr){try{_assertClass(er,RawVector),_assertClass(tr,RawVector),wasm$1.rawquerypipeline_collidersWithAabbIntersectingAabb(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,addBorrowedObject(rr))}finally{heap[stack_pointer++]=void 0}}}const RawRayColliderHitFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawraycolliderhit_free(ir>>>0));class RawRayColliderHit{static __wrap(er){er=er>>>0;const tr=Object.create(RawRayColliderHit.prototype);return tr.__wbg_ptr=er,RawRayColliderHitFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRayColliderHitFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawraycolliderhit_free(er)}colliderHandle(){return wasm$1.rawcharactercollision_handle(this.__wbg_ptr)}timeOfImpact(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}}const RawRayColliderIntersectionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawraycolliderintersection_free(ir>>>0));class RawRayColliderIntersection{static __wrap(er){er=er>>>0;const tr=Object.create(RawRayColliderIntersection.prototype);return tr.__wbg_ptr=er,RawRayColliderIntersectionFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRayColliderIntersectionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawraycolliderintersection_free(er)}colliderHandle(){return wasm$1.rawpointcolliderprojection_colliderHandle(this.__wbg_ptr)}normal(){const er=wasm$1.rawcollidershapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}time_of_impact(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}featureType(){return wasm$1.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const rr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawpointcolliderprojection_featureId(rr,this.__wbg_ptr);var er=getInt32Memory0()[rr/4+0],tr=getInt32Memory0()[rr/4+1];return er===0?void 0:tr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}}const RawRayIntersectionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawrayintersection_free(ir>>>0));class RawRayIntersection{static __wrap(er){er=er>>>0;const tr=Object.create(RawRayIntersection.prototype);return tr.__wbg_ptr=er,RawRayIntersectionFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRayIntersectionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawrayintersection_free(er)}normal(){const er=wasm$1.rawcollidershapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}time_of_impact(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}featureType(){return wasm$1.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const rr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawpointcolliderprojection_featureId(rr,this.__wbg_ptr);var er=getInt32Memory0()[rr/4+0],tr=getInt32Memory0()[rr/4+1];return er===0?void 0:tr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}}const RawRigidBodySetFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawrigidbodyset_free(ir>>>0));class RawRigidBodySet{static __wrap(er){er=er>>>0;const tr=Object.create(RawRigidBodySet.prototype);return tr.__wbg_ptr=er,RawRigidBodySetFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRigidBodySetFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawrigidbodyset_free(er)}rbTranslation(er){const tr=wasm$1.rawrigidbodyset_rbTranslation(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbRotation(er){const tr=wasm$1.rawrigidbodyset_rbRotation(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}rbSleep(er){wasm$1.rawrigidbodyset_rbSleep(this.__wbg_ptr,er)}rbIsSleeping(er){return wasm$1.rawrigidbodyset_rbIsSleeping(this.__wbg_ptr,er)!==0}rbIsMoving(er){return wasm$1.rawrigidbodyset_rbIsMoving(this.__wbg_ptr,er)!==0}rbNextTranslation(er){const tr=wasm$1.rawrigidbodyset_rbNextTranslation(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbNextRotation(er){const tr=wasm$1.rawrigidbodyset_rbNextRotation(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}rbSetTranslation(er,tr,rr,nr,sr){wasm$1.rawrigidbodyset_rbSetTranslation(this.__wbg_ptr,er,tr,rr,nr,sr)}rbSetRotation(er,tr,rr,nr,sr,ar){wasm$1.rawrigidbodyset_rbSetRotation(this.__wbg_ptr,er,tr,rr,nr,sr,ar)}rbSetLinvel(er,tr,rr){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbSetLinvel(this.__wbg_ptr,er,tr.__wbg_ptr,rr)}rbSetAngvel(er,tr,rr){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbSetAngvel(this.__wbg_ptr,er,tr.__wbg_ptr,rr)}rbSetNextKinematicTranslation(er,tr,rr,nr){wasm$1.rawrigidbodyset_rbSetNextKinematicTranslation(this.__wbg_ptr,er,tr,rr,nr)}rbSetNextKinematicRotation(er,tr,rr,nr,sr){wasm$1.rawrigidbodyset_rbSetNextKinematicRotation(this.__wbg_ptr,er,tr,rr,nr,sr)}rbRecomputeMassPropertiesFromColliders(er,tr){_assertClass(tr,RawColliderSet),wasm$1.rawrigidbodyset_rbRecomputeMassPropertiesFromColliders(this.__wbg_ptr,er,tr.__wbg_ptr)}rbSetAdditionalMass(er,tr,rr){wasm$1.rawrigidbodyset_rbSetAdditionalMass(this.__wbg_ptr,er,tr,rr)}rbSetAdditionalMassProperties(er,tr,rr,nr,sr,ar){_assertClass(rr,RawVector),_assertClass(nr,RawVector),_assertClass(sr,RawRotation),wasm$1.rawrigidbodyset_rbSetAdditionalMassProperties(this.__wbg_ptr,er,tr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar)}rbLinvel(er){const tr=wasm$1.rawrigidbodyset_rbLinvel(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbAngvel(er){const tr=wasm$1.rawrigidbodyset_rbAngvel(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbLockTranslations(er,tr,rr){wasm$1.rawrigidbodyset_rbLockTranslations(this.__wbg_ptr,er,tr,rr)}rbSetEnabledTranslations(er,tr,rr,nr,sr){wasm$1.rawrigidbodyset_rbSetEnabledTranslations(this.__wbg_ptr,er,tr,rr,nr,sr)}rbLockRotations(er,tr,rr){wasm$1.rawrigidbodyset_rbLockRotations(this.__wbg_ptr,er,tr,rr)}rbSetEnabledRotations(er,tr,rr,nr,sr){wasm$1.rawrigidbodyset_rbSetEnabledRotations(this.__wbg_ptr,er,tr,rr,nr,sr)}rbDominanceGroup(er){return wasm$1.rawrigidbodyset_rbDominanceGroup(this.__wbg_ptr,er)}rbSetDominanceGroup(er,tr){wasm$1.rawrigidbodyset_rbSetDominanceGroup(this.__wbg_ptr,er,tr)}rbEnableCcd(er,tr){wasm$1.rawrigidbodyset_rbEnableCcd(this.__wbg_ptr,er,tr)}rbSetSoftCcdPrediction(er,tr){wasm$1.rawrigidbodyset_rbSetSoftCcdPrediction(this.__wbg_ptr,er,tr)}rbMass(er){return wasm$1.rawrigidbodyset_rbMass(this.__wbg_ptr,er)}rbInvMass(er){return wasm$1.rawrigidbodyset_rbInvMass(this.__wbg_ptr,er)}rbEffectiveInvMass(er){const tr=wasm$1.rawrigidbodyset_rbEffectiveInvMass(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbLocalCom(er){const tr=wasm$1.rawrigidbodyset_rbLocalCom(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbWorldCom(er){const tr=wasm$1.rawrigidbodyset_rbWorldCom(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbInvPrincipalInertiaSqrt(er){const tr=wasm$1.rawrigidbodyset_rbInvPrincipalInertiaSqrt(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbPrincipalInertiaLocalFrame(er){const tr=wasm$1.rawrigidbodyset_rbPrincipalInertiaLocalFrame(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}rbPrincipalInertia(er){const tr=wasm$1.rawrigidbodyset_rbPrincipalInertia(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbEffectiveWorldInvInertiaSqrt(er){const tr=wasm$1.rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt(this.__wbg_ptr,er);return RawSdpMatrix3.__wrap(tr)}rbEffectiveAngularInertia(er){const tr=wasm$1.rawrigidbodyset_rbEffectiveAngularInertia(this.__wbg_ptr,er);return RawSdpMatrix3.__wrap(tr)}rbWakeUp(er){wasm$1.rawrigidbodyset_rbWakeUp(this.__wbg_ptr,er)}rbIsCcdEnabled(er){return wasm$1.rawrigidbodyset_rbIsCcdEnabled(this.__wbg_ptr,er)!==0}rbSoftCcdPrediction(er){return wasm$1.rawrigidbodyset_rbSoftCcdPrediction(this.__wbg_ptr,er)}rbNumColliders(er){return wasm$1.rawrigidbodyset_rbNumColliders(this.__wbg_ptr,er)>>>0}rbCollider(er,tr){return wasm$1.rawrigidbodyset_rbCollider(this.__wbg_ptr,er,tr)}rbBodyType(er){return wasm$1.rawrigidbodyset_rbBodyType(this.__wbg_ptr,er)}rbSetBodyType(er,tr,rr){wasm$1.rawrigidbodyset_rbSetBodyType(this.__wbg_ptr,er,tr,rr)}rbIsFixed(er){return wasm$1.rawrigidbodyset_rbIsFixed(this.__wbg_ptr,er)!==0}rbIsKinematic(er){return wasm$1.rawrigidbodyset_rbIsKinematic(this.__wbg_ptr,er)!==0}rbIsDynamic(er){return wasm$1.rawrigidbodyset_rbIsDynamic(this.__wbg_ptr,er)!==0}rbLinearDamping(er){return wasm$1.rawrigidbodyset_rbLinearDamping(this.__wbg_ptr,er)}rbAngularDamping(er){return wasm$1.rawrigidbodyset_rbAngularDamping(this.__wbg_ptr,er)}rbSetLinearDamping(er,tr){wasm$1.rawrigidbodyset_rbSetLinearDamping(this.__wbg_ptr,er,tr)}rbSetAngularDamping(er,tr){wasm$1.rawrigidbodyset_rbSetAngularDamping(this.__wbg_ptr,er,tr)}rbSetEnabled(er,tr){wasm$1.rawrigidbodyset_rbSetEnabled(this.__wbg_ptr,er,tr)}rbIsEnabled(er){return wasm$1.rawrigidbodyset_rbIsEnabled(this.__wbg_ptr,er)!==0}rbGravityScale(er){return wasm$1.rawrigidbodyset_rbGravityScale(this.__wbg_ptr,er)}rbSetGravityScale(er,tr,rr){wasm$1.rawrigidbodyset_rbSetGravityScale(this.__wbg_ptr,er,tr,rr)}rbResetForces(er,tr){wasm$1.rawrigidbodyset_rbResetForces(this.__wbg_ptr,er,tr)}rbResetTorques(er,tr){wasm$1.rawrigidbodyset_rbResetTorques(this.__wbg_ptr,er,tr)}rbAddForce(er,tr,rr){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbAddForce(this.__wbg_ptr,er,tr.__wbg_ptr,rr)}rbApplyImpulse(er,tr,rr){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbApplyImpulse(this.__wbg_ptr,er,tr.__wbg_ptr,rr)}rbAddTorque(er,tr,rr){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbAddTorque(this.__wbg_ptr,er,tr.__wbg_ptr,rr)}rbApplyTorqueImpulse(er,tr,rr){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbApplyTorqueImpulse(this.__wbg_ptr,er,tr.__wbg_ptr,rr)}rbAddForceAtPoint(er,tr,rr,nr){_assertClass(tr,RawVector),_assertClass(rr,RawVector),wasm$1.rawrigidbodyset_rbAddForceAtPoint(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr)}rbApplyImpulseAtPoint(er,tr,rr,nr){_assertClass(tr,RawVector),_assertClass(rr,RawVector),wasm$1.rawrigidbodyset_rbApplyImpulseAtPoint(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr)}rbAdditionalSolverIterations(er){return wasm$1.rawrigidbodyset_rbAdditionalSolverIterations(this.__wbg_ptr,er)>>>0}rbSetAdditionalSolverIterations(er,tr){wasm$1.rawrigidbodyset_rbSetAdditionalSolverIterations(this.__wbg_ptr,er,tr)}rbUserData(er){return wasm$1.rawrigidbodyset_rbUserData(this.__wbg_ptr,er)>>>0}rbSetUserData(er,tr){wasm$1.rawrigidbodyset_rbSetUserData(this.__wbg_ptr,er,tr)}rbUserForce(er){const tr=wasm$1.rawrigidbodyset_rbUserForce(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbUserTorque(er){const tr=wasm$1.rawrigidbodyset_rbUserTorque(this.__wbg_ptr,er);return RawVector.__wrap(tr)}constructor(){const er=wasm$1.rawrigidbodyset_new();return this.__wbg_ptr=er>>>0,this}createRigidBody(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr,_r,mr,dr,vr,Ar,yr,wr,br,Sr,xr,Cr,Ir){return _assertClass(tr,RawVector),_assertClass(rr,RawRotation),_assertClass(or,RawVector),_assertClass(lr,RawVector),_assertClass(cr,RawVector),_assertClass(hr,RawVector),_assertClass(fr,RawRotation),wasm$1.rawrigidbodyset_createRigidBody(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr,sr,ar,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr,hr.__wbg_ptr,fr.__wbg_ptr,ur,pr,gr,_r,mr,dr,vr,Ar,yr,wr,br,Sr,xr,Cr,Ir)}remove(er,tr,rr,nr,sr){_assertClass(tr,RawIslandManager),_assertClass(rr,RawColliderSet),_assertClass(nr,RawImpulseJointSet),_assertClass(sr,RawMultibodyJointSet),wasm$1.rawrigidbodyset_remove(this.__wbg_ptr,er,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr)}len(){return wasm$1.rawcolliderset_len(this.__wbg_ptr)>>>0}contains(er){return wasm$1.rawrigidbodyset_contains(this.__wbg_ptr,er)!==0}forEachRigidBodyHandle(er){try{wasm$1.rawrigidbodyset_forEachRigidBodyHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}propagateModifiedBodyPositionsToColliders(er){_assertClass(er,RawColliderSet),wasm$1.rawrigidbodyset_propagateModifiedBodyPositionsToColliders(this.__wbg_ptr,er.__wbg_ptr)}}const RawRotationFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawrotation_free(ir>>>0));class RawRotation{static __wrap(er){er=er>>>0;const tr=Object.create(RawRotation.prototype);return tr.__wbg_ptr=er,RawRotationFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRotationFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawrotation_free(er)}constructor(er,tr,rr,nr){const sr=wasm$1.rawrotation_new(er,tr,rr,nr);return this.__wbg_ptr=sr>>>0,this}static identity(){const er=wasm$1.rawrotation_identity();return RawRotation.__wrap(er)}get x(){return wasm$1.rawrotation_x(this.__wbg_ptr)}get y(){return wasm$1.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}get w(){return wasm$1.rawrotation_w(this.__wbg_ptr)}}const RawSdpMatrix3Finalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawsdpmatrix3_free(ir>>>0));class RawSdpMatrix3{static __wrap(er){er=er>>>0;const tr=Object.create(RawSdpMatrix3.prototype);return tr.__wbg_ptr=er,RawSdpMatrix3Finalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawSdpMatrix3Finalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawsdpmatrix3_free(er)}elements(){const er=wasm$1.rawsdpmatrix3_elements(this.__wbg_ptr);return takeObject(er)}}const RawSerializationPipelineFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawserializationpipeline_free(ir>>>0));class RawSerializationPipeline{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawSerializationPipelineFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawserializationpipeline_free(er)}constructor(){const er=wasm$1.rawserializationpipeline_new();return this.__wbg_ptr=er>>>0,this}serializeAll(er,tr,rr,nr,sr,ar,or,lr,cr){_assertClass(er,RawVector),_assertClass(tr,RawIntegrationParameters),_assertClass(rr,RawIslandManager),_assertClass(nr,RawBroadPhase),_assertClass(sr,RawNarrowPhase),_assertClass(ar,RawRigidBodySet),_assertClass(or,RawColliderSet),_assertClass(lr,RawImpulseJointSet),_assertClass(cr,RawMultibodyJointSet);const hr=wasm$1.rawserializationpipeline_serializeAll(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr);return takeObject(hr)}deserializeAll(er){const tr=wasm$1.rawserializationpipeline_deserializeAll(this.__wbg_ptr,addHeapObject(er));return tr===0?void 0:RawDeserializedWorld.__wrap(tr)}}const RawShapeFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawshape_free(ir>>>0));class RawShape{static __wrap(er){er=er>>>0;const tr=Object.create(RawShape.prototype);return tr.__wbg_ptr=er,RawShapeFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawShapeFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawshape_free(er)}static cuboid(er,tr,rr){const nr=wasm$1.rawshape_cuboid(er,tr,rr);return RawShape.__wrap(nr)}static roundCuboid(er,tr,rr,nr){const sr=wasm$1.rawshape_roundCuboid(er,tr,rr,nr);return RawShape.__wrap(sr)}static ball(er){const tr=wasm$1.rawshape_ball(er);return RawShape.__wrap(tr)}static halfspace(er){_assertClass(er,RawVector);const tr=wasm$1.rawshape_halfspace(er.__wbg_ptr);return RawShape.__wrap(tr)}static capsule(er,tr){const rr=wasm$1.rawshape_capsule(er,tr);return RawShape.__wrap(rr)}static cylinder(er,tr){const rr=wasm$1.rawshape_cylinder(er,tr);return RawShape.__wrap(rr)}static roundCylinder(er,tr,rr){const nr=wasm$1.rawshape_roundCylinder(er,tr,rr);return RawShape.__wrap(nr)}static cone(er,tr){const rr=wasm$1.rawshape_cone(er,tr);return RawShape.__wrap(rr)}static roundCone(er,tr,rr){const nr=wasm$1.rawshape_roundCone(er,tr,rr);return RawShape.__wrap(nr)}static polyline(er,tr){const rr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),nr=WASM_VECTOR_LEN,sr=passArray32ToWasm0(tr,wasm$1.__wbindgen_malloc),ar=WASM_VECTOR_LEN,or=wasm$1.rawshape_polyline(rr,nr,sr,ar);return RawShape.__wrap(or)}static trimesh(er,tr,rr){const nr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),sr=WASM_VECTOR_LEN,ar=passArray32ToWasm0(tr,wasm$1.__wbindgen_malloc),or=WASM_VECTOR_LEN,lr=wasm$1.rawshape_trimesh(nr,sr,ar,or,rr);return RawShape.__wrap(lr)}static heightfield(er,tr,rr,nr,sr){const ar=passArrayF32ToWasm0(rr,wasm$1.__wbindgen_malloc),or=WASM_VECTOR_LEN;_assertClass(nr,RawVector);const lr=wasm$1.rawshape_heightfield(er,tr,ar,or,nr.__wbg_ptr,sr);return RawShape.__wrap(lr)}static segment(er,tr){_assertClass(er,RawVector),_assertClass(tr,RawVector);const rr=wasm$1.rawshape_segment(er.__wbg_ptr,tr.__wbg_ptr);return RawShape.__wrap(rr)}static triangle(er,tr,rr){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(rr,RawVector);const nr=wasm$1.rawshape_triangle(er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr);return RawShape.__wrap(nr)}static roundTriangle(er,tr,rr,nr){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(rr,RawVector);const sr=wasm$1.rawshape_roundTriangle(er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr);return RawShape.__wrap(sr)}static convexHull(er){const tr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),rr=WASM_VECTOR_LEN,nr=wasm$1.rawshape_convexHull(tr,rr);return nr===0?void 0:RawShape.__wrap(nr)}static roundConvexHull(er,tr){const rr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),nr=WASM_VECTOR_LEN,sr=wasm$1.rawshape_roundConvexHull(rr,nr,tr);return sr===0?void 0:RawShape.__wrap(sr)}static convexMesh(er,tr){const rr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),nr=WASM_VECTOR_LEN,sr=passArray32ToWasm0(tr,wasm$1.__wbindgen_malloc),ar=WASM_VECTOR_LEN,or=wasm$1.rawshape_convexMesh(rr,nr,sr,ar);return or===0?void 0:RawShape.__wrap(or)}static roundConvexMesh(er,tr,rr){const nr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),sr=WASM_VECTOR_LEN,ar=passArray32ToWasm0(tr,wasm$1.__wbindgen_malloc),or=WASM_VECTOR_LEN,lr=wasm$1.rawshape_roundConvexMesh(nr,sr,ar,or,rr);return lr===0?void 0:RawShape.__wrap(lr)}castShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawVector),_assertClass(nr,RawShape),_assertClass(sr,RawVector),_assertClass(ar,RawRotation),_assertClass(or,RawVector);const fr=wasm$1.rawshape_castShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or.__wbg_ptr,lr,cr,hr);return fr===0?void 0:RawShapeCastHit.__wrap(fr)}intersectsShape(er,tr,rr,nr,sr){return _assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawShape),_assertClass(nr,RawVector),_assertClass(sr,RawRotation),wasm$1.rawshape_intersectsShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr)!==0}contactShape(er,tr,rr,nr,sr,ar){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawShape),_assertClass(nr,RawVector),_assertClass(sr,RawRotation);const or=wasm$1.rawshape_contactShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar);return or===0?void 0:RawShapeContact.__wrap(or)}containsPoint(er,tr,rr){return _assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawVector),wasm$1.rawshape_containsPoint(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr)!==0}projectPoint(er,tr,rr,nr){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawVector);const sr=wasm$1.rawshape_projectPoint(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr);return RawPointProjection.__wrap(sr)}intersectsRay(er,tr,rr,nr,sr){return _assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawVector),_assertClass(nr,RawVector),wasm$1.rawshape_intersectsRay(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr)!==0}castRay(er,tr,rr,nr,sr,ar){return _assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawVector),_assertClass(nr,RawVector),wasm$1.rawshape_castRay(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr,ar)}castRayAndGetNormal(er,tr,rr,nr,sr,ar){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(rr,RawVector),_assertClass(nr,RawVector);const or=wasm$1.rawshape_castRayAndGetNormal(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,rr.__wbg_ptr,nr.__wbg_ptr,sr,ar);return or===0?void 0:RawRayIntersection.__wrap(or)}}const RawShapeCastHitFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawshapecasthit_free(ir>>>0));class RawShapeCastHit{static __wrap(er){er=er>>>0;const tr=Object.create(RawShapeCastHit.prototype);return tr.__wbg_ptr=er,RawShapeCastHitFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawShapeCastHitFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawshapecasthit_free(er)}time_of_impact(){return wasm$1.rawrotation_x(this.__wbg_ptr)}witness1(){const er=wasm$1.rawshapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}witness2(){const er=wasm$1.rawcontactforceevent_total_force(this.__wbg_ptr);return RawVector.__wrap(er)}normal1(){const er=wasm$1.rawshapecasthit_normal1(this.__wbg_ptr);return RawVector.__wrap(er)}normal2(){const er=wasm$1.rawshapecasthit_normal2(this.__wbg_ptr);return RawVector.__wrap(er)}}const RawShapeContactFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawshapecontact_free(ir>>>0));class RawShapeContact{static __wrap(er){er=er>>>0;const tr=Object.create(RawShapeContact.prototype);return tr.__wbg_ptr=er,RawShapeContactFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawShapeContactFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawshapecontact_free(er)}distance(){return wasm$1.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const er=wasm$1.rawpointprojection_point(this.__wbg_ptr);return RawVector.__wrap(er)}point2(){const er=wasm$1.rawcollidershapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}normal1(){const er=wasm$1.rawcollidershapecasthit_witness2(this.__wbg_ptr);return RawVector.__wrap(er)}normal2(){const er=wasm$1.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return RawVector.__wrap(er)}}const RawVectorFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(ir=>wasm$1.__wbg_rawvector_free(ir>>>0));class RawVector{static __wrap(er){er=er>>>0;const tr=Object.create(RawVector.prototype);return tr.__wbg_ptr=er,RawVectorFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawVectorFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawvector_free(er)}static zero(){const er=wasm$1.rawvector_zero();return RawVector.__wrap(er)}constructor(er,tr,rr){const nr=wasm$1.rawvector_new(er,tr,rr);return this.__wbg_ptr=nr>>>0,this}get x(){return wasm$1.rawrotation_x(this.__wbg_ptr)}set x(er){wasm$1.rawvector_set_x(this.__wbg_ptr,er)}get y(){return wasm$1.rawintegrationparameters_dt(this.__wbg_ptr)}set y(er){wasm$1.rawintegrationparameters_set_dt(this.__wbg_ptr,er)}get z(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}set z(er){wasm$1.rawvector_set_z(this.__wbg_ptr,er)}xyz(){const er=wasm$1.rawvector_xyz(this.__wbg_ptr);return RawVector.__wrap(er)}yxz(){const er=wasm$1.rawvector_yxz(this.__wbg_ptr);return RawVector.__wrap(er)}zxy(){const er=wasm$1.rawvector_zxy(this.__wbg_ptr);return RawVector.__wrap(er)}xzy(){const er=wasm$1.rawvector_xzy(this.__wbg_ptr);return RawVector.__wrap(er)}yzx(){const er=wasm$1.rawvector_yzx(this.__wbg_ptr);return RawVector.__wrap(er)}zyx(){const er=wasm$1.rawvector_zyx(this.__wbg_ptr);return RawVector.__wrap(er)}}function __wbindgen_number_new(ir){return addHeapObject(ir)}function __wbindgen_boolean_get(ir){const er=getObject(ir);return typeof er=="boolean"?er?1:0:2}function __wbindgen_object_drop_ref(ir){takeObject(ir)}function __wbindgen_number_get(ir,er){const tr=getObject(er),rr=typeof tr=="number"?tr:void 0;getFloat64Memory0()[ir/8+1]=isLikeNone(rr)?0:rr,getInt32Memory0()[ir/4+0]=!isLikeNone(rr)}function __wbindgen_is_function(ir){return typeof getObject(ir)=="function"}function __wbg_rawraycolliderintersection_new(ir){const er=RawRayColliderIntersection.__wrap(ir);return addHeapObject(er)}function __wbg_rawcontactforceevent_new(ir){const er=RawContactForceEvent.__wrap(ir);return addHeapObject(er)}function __wbg_call_b3ca7c6051f9bec1(){return handleError(function(ir,er,tr){const rr=getObject(ir).call(getObject(er),getObject(tr));return addHeapObject(rr)},arguments)}function __wbg_call_8e7cb608789c2528(){return handleError(function(ir,er,tr,rr){const nr=getObject(ir).call(getObject(er),getObject(tr),getObject(rr));return addHeapObject(nr)},arguments)}function __wbg_call_938992c832f74314(){return handleError(function(ir,er,tr,rr,nr){const sr=getObject(ir).call(getObject(er),getObject(tr),getObject(rr),getObject(nr));return addHeapObject(sr)},arguments)}function __wbg_bind_4d857b598695205e(ir,er,tr,rr){const nr=getObject(ir).bind(getObject(er),getObject(tr),getObject(rr));return addHeapObject(nr)}function __wbg_buffer_12d079cc21e14bdb(ir){const er=getObject(ir).buffer;return addHeapObject(er)}function __wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb(ir,er,tr){const rr=new Uint8Array(getObject(ir),er>>>0,tr>>>0);return addHeapObject(rr)}function __wbg_new_63b92bc8671ed464(ir){const er=new Uint8Array(getObject(ir));return addHeapObject(er)}function __wbg_set_a47bac70306a19a7(ir,er,tr){getObject(ir).set(getObject(er),tr>>>0)}function __wbg_length_c20a40f15020d68a(ir){return getObject(ir).length}function __wbg_newwithbyteoffsetandlength_4a659d079a1650e0(ir,er,tr){const rr=new Float32Array(getObject(ir),er>>>0,tr>>>0);return addHeapObject(rr)}function __wbg_set_bd975934d1b1fddb(ir,er,tr){getObject(ir).set(getObject(er),tr>>>0)}function __wbg_length_d25bbcbc3367f684(ir){return getObject(ir).length}function __wbg_newwithlength_1e8b839a06de01c5(ir){const er=new Float32Array(ir>>>0);return addHeapObject(er)}function __wbindgen_throw(ir,er){throw new Error(getStringFromWasm0(ir,er))}function __wbindgen_memory(){const ir=wasm$1.memory;return addHeapObject(ir)}URL=globalThis.URL;const __vite__wasmModule=await __vite__initWasm({"./rapier_wasm3d_bg.js":{__wbindgen_number_new,__wbindgen_boolean_get,__wbindgen_object_drop_ref,__wbindgen_number_get,__wbindgen_is_function,__wbg_rawraycolliderintersection_new,__wbg_rawcontactforceevent_new,__wbg_call_b3ca7c6051f9bec1,__wbg_call_8e7cb608789c2528,__wbg_call_938992c832f74314,__wbg_bind_4d857b598695205e,__wbg_buffer_12d079cc21e14bdb,__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb,__wbg_new_63b92bc8671ed464,__wbg_set_a47bac70306a19a7,__wbg_length_c20a40f15020d68a,__wbg_newwithbyteoffsetandlength_4a659d079a1650e0,__wbg_set_bd975934d1b1fddb,__wbg_length_d25bbcbc3367f684,__wbg_newwithlength_1e8b839a06de01c5,__wbindgen_throw,__wbindgen_memory}},__vite__wasmUrl),memory=__vite__wasmModule.memory,version$1=__vite__wasmModule.version,__wbg_rawkinematiccharactercontroller_free=__vite__wasmModule.__wbg_rawkinematiccharactercontroller_free,rawkinematiccharactercontroller_new=__vite__wasmModule.rawkinematiccharactercontroller_new,rawkinematiccharactercontroller_setUp=__vite__wasmModule.rawkinematiccharactercontroller_setUp,rawkinematiccharactercontroller_normalNudgeFactor=__vite__wasmModule.rawkinematiccharactercontroller_normalNudgeFactor,rawkinematiccharactercontroller_setNormalNudgeFactor=__vite__wasmModule.rawkinematiccharactercontroller_setNormalNudgeFactor,rawkinematiccharactercontroller_setOffset=__vite__wasmModule.rawkinematiccharactercontroller_setOffset,rawkinematiccharactercontroller_slideEnabled=__vite__wasmModule.rawkinematiccharactercontroller_slideEnabled,rawkinematiccharactercontroller_setSlideEnabled=__vite__wasmModule.rawkinematiccharactercontroller_setSlideEnabled,rawkinematiccharactercontroller_autostepMaxHeight=__vite__wasmModule.rawkinematiccharactercontroller_autostepMaxHeight,rawkinematiccharactercontroller_autostepMinWidth=__vite__wasmModule.rawkinematiccharactercontroller_autostepMinWidth,rawkinematiccharactercontroller_autostepIncludesDynamicBodies=__vite__wasmModule.rawkinematiccharactercontroller_autostepIncludesDynamicBodies,rawkinematiccharactercontroller_autostepEnabled=__vite__wasmModule.rawkinematiccharactercontroller_autostepEnabled,rawkinematiccharactercontroller_enableAutostep=__vite__wasmModule.rawkinematiccharactercontroller_enableAutostep,rawkinematiccharactercontroller_disableAutostep=__vite__wasmModule.rawkinematiccharactercontroller_disableAutostep,rawkinematiccharactercontroller_maxSlopeClimbAngle=__vite__wasmModule.rawkinematiccharactercontroller_maxSlopeClimbAngle,rawkinematiccharactercontroller_setMaxSlopeClimbAngle=__vite__wasmModule.rawkinematiccharactercontroller_setMaxSlopeClimbAngle,rawkinematiccharactercontroller_minSlopeSlideAngle=__vite__wasmModule.rawkinematiccharactercontroller_minSlopeSlideAngle,rawkinematiccharactercontroller_setMinSlopeSlideAngle=__vite__wasmModule.rawkinematiccharactercontroller_setMinSlopeSlideAngle,rawkinematiccharactercontroller_snapToGroundDistance=__vite__wasmModule.rawkinematiccharactercontroller_snapToGroundDistance,rawkinematiccharactercontroller_enableSnapToGround=__vite__wasmModule.rawkinematiccharactercontroller_enableSnapToGround,rawkinematiccharactercontroller_disableSnapToGround=__vite__wasmModule.rawkinematiccharactercontroller_disableSnapToGround,rawkinematiccharactercontroller_snapToGroundEnabled=__vite__wasmModule.rawkinematiccharactercontroller_snapToGroundEnabled,rawkinematiccharactercontroller_computeColliderMovement=__vite__wasmModule.rawkinematiccharactercontroller_computeColliderMovement,rawkinematiccharactercontroller_computedMovement=__vite__wasmModule.rawkinematiccharactercontroller_computedMovement,rawkinematiccharactercontroller_computedGrounded=__vite__wasmModule.rawkinematiccharactercontroller_computedGrounded,rawkinematiccharactercontroller_numComputedCollisions=__vite__wasmModule.rawkinematiccharactercontroller_numComputedCollisions,rawkinematiccharactercontroller_computedCollision=__vite__wasmModule.rawkinematiccharactercontroller_computedCollision,__wbg_rawcharactercollision_free=__vite__wasmModule.__wbg_rawcharactercollision_free,rawcharactercollision_new=__vite__wasmModule.rawcharactercollision_new,rawcharactercollision_handle=__vite__wasmModule.rawcharactercollision_handle,rawcharactercollision_translationDeltaApplied=__vite__wasmModule.rawcharactercollision_translationDeltaApplied,rawcharactercollision_translationDeltaRemaining=__vite__wasmModule.rawcharactercollision_translationDeltaRemaining,rawcharactercollision_toi=__vite__wasmModule.rawcharactercollision_toi,rawcharactercollision_worldWitness1=__vite__wasmModule.rawcharactercollision_worldWitness1,rawcharactercollision_worldWitness2=__vite__wasmModule.rawcharactercollision_worldWitness2,rawcharactercollision_worldNormal1=__vite__wasmModule.rawcharactercollision_worldNormal1,rawcharactercollision_worldNormal2=__vite__wasmModule.rawcharactercollision_worldNormal2,__wbg_rawdynamicraycastvehiclecontroller_free=__vite__wasmModule.__wbg_rawdynamicraycastvehiclecontroller_free,rawdynamicraycastvehiclecontroller_new=__vite__wasmModule.rawdynamicraycastvehiclecontroller_new,rawdynamicraycastvehiclecontroller_current_vehicle_speed=__vite__wasmModule.rawdynamicraycastvehiclecontroller_current_vehicle_speed,rawdynamicraycastvehiclecontroller_chassis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_chassis,rawdynamicraycastvehiclecontroller_index_up_axis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_index_up_axis,rawdynamicraycastvehiclecontroller_set_index_up_axis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_index_up_axis,rawdynamicraycastvehiclecontroller_index_forward_axis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_index_forward_axis,rawdynamicraycastvehiclecontroller_set_index_forward_axis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_index_forward_axis,rawdynamicraycastvehiclecontroller_add_wheel=__vite__wasmModule.rawdynamicraycastvehiclecontroller_add_wheel,rawdynamicraycastvehiclecontroller_num_wheels=__vite__wasmModule.rawdynamicraycastvehiclecontroller_num_wheels,rawdynamicraycastvehiclecontroller_update_vehicle=__vite__wasmModule.rawdynamicraycastvehiclecontroller_update_vehicle,rawdynamicraycastvehiclecontroller_wheel_chassis_connection_point_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_chassis_connection_point_cs,rawdynamicraycastvehiclecontroller_set_wheel_chassis_connection_point_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_chassis_connection_point_cs,rawdynamicraycastvehiclecontroller_wheel_suspension_rest_length=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_rest_length,rawdynamicraycastvehiclecontroller_set_wheel_suspension_rest_length=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_suspension_rest_length,rawdynamicraycastvehiclecontroller_wheel_max_suspension_travel=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_max_suspension_travel,rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_travel=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_travel,rawdynamicraycastvehiclecontroller_wheel_radius=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_radius,rawdynamicraycastvehiclecontroller_set_wheel_radius=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_radius,rawdynamicraycastvehiclecontroller_wheel_suspension_stiffness=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_stiffness,rawdynamicraycastvehiclecontroller_set_wheel_suspension_stiffness=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_suspension_stiffness,rawdynamicraycastvehiclecontroller_wheel_suspension_compression=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_compression,rawdynamicraycastvehiclecontroller_set_wheel_suspension_compression=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_suspension_compression,rawdynamicraycastvehiclecontroller_wheel_suspension_relaxation=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_relaxation,rawdynamicraycastvehiclecontroller_set_wheel_suspension_relaxation=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_suspension_relaxation,rawdynamicraycastvehiclecontroller_wheel_max_suspension_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_max_suspension_force,rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_force,rawdynamicraycastvehiclecontroller_wheel_brake=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_brake,rawdynamicraycastvehiclecontroller_set_wheel_brake=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_brake,rawdynamicraycastvehiclecontroller_wheel_steering=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_steering,rawdynamicraycastvehiclecontroller_set_wheel_steering=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_steering,rawdynamicraycastvehiclecontroller_wheel_engine_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_engine_force,rawdynamicraycastvehiclecontroller_set_wheel_engine_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_engine_force,rawdynamicraycastvehiclecontroller_wheel_direction_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_direction_cs,rawdynamicraycastvehiclecontroller_set_wheel_direction_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_direction_cs,rawdynamicraycastvehiclecontroller_wheel_axle_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_axle_cs,rawdynamicraycastvehiclecontroller_set_wheel_axle_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_axle_cs,rawdynamicraycastvehiclecontroller_wheel_friction_slip=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_friction_slip,rawdynamicraycastvehiclecontroller_set_wheel_friction_slip=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_friction_slip,rawdynamicraycastvehiclecontroller_wheel_side_friction_stiffness=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_side_friction_stiffness,rawdynamicraycastvehiclecontroller_set_wheel_side_friction_stiffness=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_side_friction_stiffness,rawdynamicraycastvehiclecontroller_wheel_rotation=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_rotation,rawdynamicraycastvehiclecontroller_wheel_forward_impulse=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_forward_impulse,rawdynamicraycastvehiclecontroller_wheel_side_impulse=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_side_impulse,rawdynamicraycastvehiclecontroller_wheel_suspension_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_force,rawdynamicraycastvehiclecontroller_wheel_contact_normal_ws=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_contact_normal_ws,rawdynamicraycastvehiclecontroller_wheel_contact_point_ws=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_contact_point_ws,rawdynamicraycastvehiclecontroller_wheel_suspension_length=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_length,rawdynamicraycastvehiclecontroller_wheel_hard_point_ws=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_hard_point_ws,rawdynamicraycastvehiclecontroller_wheel_is_in_contact=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_is_in_contact,rawdynamicraycastvehiclecontroller_wheel_ground_object=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_ground_object,__wbg_rawccdsolver_free=__vite__wasmModule.__wbg_rawccdsolver_free,rawccdsolver_new=__vite__wasmModule.rawccdsolver_new,rawimpulsejointset_jointType=__vite__wasmModule.rawimpulsejointset_jointType,rawimpulsejointset_jointBodyHandle1=__vite__wasmModule.rawimpulsejointset_jointBodyHandle1,rawimpulsejointset_jointBodyHandle2=__vite__wasmModule.rawimpulsejointset_jointBodyHandle2,rawimpulsejointset_jointFrameX1=__vite__wasmModule.rawimpulsejointset_jointFrameX1,rawimpulsejointset_jointFrameX2=__vite__wasmModule.rawimpulsejointset_jointFrameX2,rawimpulsejointset_jointAnchor1=__vite__wasmModule.rawimpulsejointset_jointAnchor1,rawimpulsejointset_jointAnchor2=__vite__wasmModule.rawimpulsejointset_jointAnchor2,rawimpulsejointset_jointSetAnchor1=__vite__wasmModule.rawimpulsejointset_jointSetAnchor1,rawimpulsejointset_jointSetAnchor2=__vite__wasmModule.rawimpulsejointset_jointSetAnchor2,rawimpulsejointset_jointContactsEnabled=__vite__wasmModule.rawimpulsejointset_jointContactsEnabled,rawimpulsejointset_jointSetContactsEnabled=__vite__wasmModule.rawimpulsejointset_jointSetContactsEnabled,rawimpulsejointset_jointLimitsEnabled=__vite__wasmModule.rawimpulsejointset_jointLimitsEnabled,rawimpulsejointset_jointLimitsMin=__vite__wasmModule.rawimpulsejointset_jointLimitsMin,rawimpulsejointset_jointLimitsMax=__vite__wasmModule.rawimpulsejointset_jointLimitsMax,rawimpulsejointset_jointSetLimits=__vite__wasmModule.rawimpulsejointset_jointSetLimits,rawimpulsejointset_jointConfigureMotorModel=__vite__wasmModule.rawimpulsejointset_jointConfigureMotorModel,rawimpulsejointset_jointConfigureMotorVelocity=__vite__wasmModule.rawimpulsejointset_jointConfigureMotorVelocity,rawimpulsejointset_jointConfigureMotorPosition=__vite__wasmModule.rawimpulsejointset_jointConfigureMotorPosition,rawimpulsejointset_jointConfigureMotor=__vite__wasmModule.rawimpulsejointset_jointConfigureMotor,__wbg_rawimpulsejointset_free=__vite__wasmModule.__wbg_rawimpulsejointset_free,rawimpulsejointset_new=__vite__wasmModule.rawimpulsejointset_new,rawimpulsejointset_createJoint=__vite__wasmModule.rawimpulsejointset_createJoint,rawimpulsejointset_remove=__vite__wasmModule.rawimpulsejointset_remove,rawimpulsejointset_len=__vite__wasmModule.rawimpulsejointset_len,rawimpulsejointset_contains=__vite__wasmModule.rawimpulsejointset_contains,rawimpulsejointset_forEachJointHandle=__vite__wasmModule.rawimpulsejointset_forEachJointHandle,rawimpulsejointset_forEachJointAttachedToRigidBody=__vite__wasmModule.rawimpulsejointset_forEachJointAttachedToRigidBody,__wbg_rawintegrationparameters_free=__vite__wasmModule.__wbg_rawintegrationparameters_free,rawintegrationparameters_new=__vite__wasmModule.rawintegrationparameters_new,rawintegrationparameters_dt=__vite__wasmModule.rawintegrationparameters_dt,rawintegrationparameters_contact_erp=__vite__wasmModule.rawintegrationparameters_contact_erp,rawintegrationparameters_numSolverIterations=__vite__wasmModule.rawintegrationparameters_numSolverIterations,rawintegrationparameters_maxCcdSubsteps=__vite__wasmModule.rawintegrationparameters_maxCcdSubsteps,rawintegrationparameters_lengthUnit=__vite__wasmModule.rawintegrationparameters_lengthUnit,rawintegrationparameters_set_dt=__vite__wasmModule.rawintegrationparameters_set_dt,rawintegrationparameters_set_contact_natural_frequency=__vite__wasmModule.rawintegrationparameters_set_contact_natural_frequency,rawintegrationparameters_set_normalizedAllowedLinearError=__vite__wasmModule.rawintegrationparameters_set_normalizedAllowedLinearError,rawintegrationparameters_set_normalizedPredictionDistance=__vite__wasmModule.rawintegrationparameters_set_normalizedPredictionDistance,rawintegrationparameters_set_numSolverIterations=__vite__wasmModule.rawintegrationparameters_set_numSolverIterations,rawintegrationparameters_set_minIslandSize=__vite__wasmModule.rawintegrationparameters_set_minIslandSize,rawintegrationparameters_set_maxCcdSubsteps=__vite__wasmModule.rawintegrationparameters_set_maxCcdSubsteps,rawintegrationparameters_set_lengthUnit=__vite__wasmModule.rawintegrationparameters_set_lengthUnit,rawintegrationparameters_switchToStandardPgsSolver=__vite__wasmModule.rawintegrationparameters_switchToStandardPgsSolver,rawintegrationparameters_switchToSmallStepsPgsSolver=__vite__wasmModule.rawintegrationparameters_switchToSmallStepsPgsSolver,rawintegrationparameters_switchToSmallStepsPgsSolverWithoutWarmstart=__vite__wasmModule.rawintegrationparameters_switchToSmallStepsPgsSolverWithoutWarmstart,__wbg_rawislandmanager_free=__vite__wasmModule.__wbg_rawislandmanager_free,rawislandmanager_new=__vite__wasmModule.rawislandmanager_new,rawislandmanager_forEachActiveRigidBodyHandle=__vite__wasmModule.rawislandmanager_forEachActiveRigidBodyHandle,__wbg_rawgenericjoint_free=__vite__wasmModule.__wbg_rawgenericjoint_free,rawgenericjoint_generic=__vite__wasmModule.rawgenericjoint_generic,rawgenericjoint_spring=__vite__wasmModule.rawgenericjoint_spring,rawgenericjoint_rope=__vite__wasmModule.rawgenericjoint_rope,rawgenericjoint_spherical=__vite__wasmModule.rawgenericjoint_spherical,rawgenericjoint_prismatic=__vite__wasmModule.rawgenericjoint_prismatic,rawgenericjoint_fixed=__vite__wasmModule.rawgenericjoint_fixed,rawgenericjoint_revolute=__vite__wasmModule.rawgenericjoint_revolute,rawmultibodyjointset_jointType=__vite__wasmModule.rawmultibodyjointset_jointType,rawmultibodyjointset_jointFrameX1=__vite__wasmModule.rawmultibodyjointset_jointFrameX1,rawmultibodyjointset_jointFrameX2=__vite__wasmModule.rawmultibodyjointset_jointFrameX2,rawmultibodyjointset_jointAnchor1=__vite__wasmModule.rawmultibodyjointset_jointAnchor1,rawmultibodyjointset_jointAnchor2=__vite__wasmModule.rawmultibodyjointset_jointAnchor2,rawmultibodyjointset_jointContactsEnabled=__vite__wasmModule.rawmultibodyjointset_jointContactsEnabled,rawmultibodyjointset_jointSetContactsEnabled=__vite__wasmModule.rawmultibodyjointset_jointSetContactsEnabled,rawmultibodyjointset_jointLimitsEnabled=__vite__wasmModule.rawmultibodyjointset_jointLimitsEnabled,rawmultibodyjointset_jointLimitsMin=__vite__wasmModule.rawmultibodyjointset_jointLimitsMin,rawmultibodyjointset_jointLimitsMax=__vite__wasmModule.rawmultibodyjointset_jointLimitsMax,__wbg_rawmultibodyjointset_free=__vite__wasmModule.__wbg_rawmultibodyjointset_free,rawmultibodyjointset_new=__vite__wasmModule.rawmultibodyjointset_new,rawmultibodyjointset_createJoint=__vite__wasmModule.rawmultibodyjointset_createJoint,rawmultibodyjointset_remove=__vite__wasmModule.rawmultibodyjointset_remove,rawmultibodyjointset_contains=__vite__wasmModule.rawmultibodyjointset_contains,rawmultibodyjointset_forEachJointHandle=__vite__wasmModule.rawmultibodyjointset_forEachJointHandle,rawmultibodyjointset_forEachJointAttachedToRigidBody=__vite__wasmModule.rawmultibodyjointset_forEachJointAttachedToRigidBody,rawrigidbodyset_rbTranslation=__vite__wasmModule.rawrigidbodyset_rbTranslation,rawrigidbodyset_rbRotation=__vite__wasmModule.rawrigidbodyset_rbRotation,rawrigidbodyset_rbSleep=__vite__wasmModule.rawrigidbodyset_rbSleep,rawrigidbodyset_rbIsSleeping=__vite__wasmModule.rawrigidbodyset_rbIsSleeping,rawrigidbodyset_rbIsMoving=__vite__wasmModule.rawrigidbodyset_rbIsMoving,rawrigidbodyset_rbNextTranslation=__vite__wasmModule.rawrigidbodyset_rbNextTranslation,rawrigidbodyset_rbNextRotation=__vite__wasmModule.rawrigidbodyset_rbNextRotation,rawrigidbodyset_rbSetTranslation=__vite__wasmModule.rawrigidbodyset_rbSetTranslation,rawrigidbodyset_rbSetRotation=__vite__wasmModule.rawrigidbodyset_rbSetRotation,rawrigidbodyset_rbSetLinvel=__vite__wasmModule.rawrigidbodyset_rbSetLinvel,rawrigidbodyset_rbSetAngvel=__vite__wasmModule.rawrigidbodyset_rbSetAngvel,rawrigidbodyset_rbSetNextKinematicTranslation=__vite__wasmModule.rawrigidbodyset_rbSetNextKinematicTranslation,rawrigidbodyset_rbSetNextKinematicRotation=__vite__wasmModule.rawrigidbodyset_rbSetNextKinematicRotation,rawrigidbodyset_rbRecomputeMassPropertiesFromColliders=__vite__wasmModule.rawrigidbodyset_rbRecomputeMassPropertiesFromColliders,rawrigidbodyset_rbSetAdditionalMass=__vite__wasmModule.rawrigidbodyset_rbSetAdditionalMass,rawrigidbodyset_rbSetAdditionalMassProperties=__vite__wasmModule.rawrigidbodyset_rbSetAdditionalMassProperties,rawrigidbodyset_rbLinvel=__vite__wasmModule.rawrigidbodyset_rbLinvel,rawrigidbodyset_rbAngvel=__vite__wasmModule.rawrigidbodyset_rbAngvel,rawrigidbodyset_rbLockTranslations=__vite__wasmModule.rawrigidbodyset_rbLockTranslations,rawrigidbodyset_rbSetEnabledTranslations=__vite__wasmModule.rawrigidbodyset_rbSetEnabledTranslations,rawrigidbodyset_rbLockRotations=__vite__wasmModule.rawrigidbodyset_rbLockRotations,rawrigidbodyset_rbSetEnabledRotations=__vite__wasmModule.rawrigidbodyset_rbSetEnabledRotations,rawrigidbodyset_rbDominanceGroup=__vite__wasmModule.rawrigidbodyset_rbDominanceGroup,rawrigidbodyset_rbSetDominanceGroup=__vite__wasmModule.rawrigidbodyset_rbSetDominanceGroup,rawrigidbodyset_rbEnableCcd=__vite__wasmModule.rawrigidbodyset_rbEnableCcd,rawrigidbodyset_rbSetSoftCcdPrediction=__vite__wasmModule.rawrigidbodyset_rbSetSoftCcdPrediction,rawrigidbodyset_rbMass=__vite__wasmModule.rawrigidbodyset_rbMass,rawrigidbodyset_rbInvMass=__vite__wasmModule.rawrigidbodyset_rbInvMass,rawrigidbodyset_rbEffectiveInvMass=__vite__wasmModule.rawrigidbodyset_rbEffectiveInvMass,rawrigidbodyset_rbLocalCom=__vite__wasmModule.rawrigidbodyset_rbLocalCom,rawrigidbodyset_rbWorldCom=__vite__wasmModule.rawrigidbodyset_rbWorldCom,rawrigidbodyset_rbInvPrincipalInertiaSqrt=__vite__wasmModule.rawrigidbodyset_rbInvPrincipalInertiaSqrt,rawrigidbodyset_rbPrincipalInertiaLocalFrame=__vite__wasmModule.rawrigidbodyset_rbPrincipalInertiaLocalFrame,rawrigidbodyset_rbPrincipalInertia=__vite__wasmModule.rawrigidbodyset_rbPrincipalInertia,rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt=__vite__wasmModule.rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt,rawrigidbodyset_rbEffectiveAngularInertia=__vite__wasmModule.rawrigidbodyset_rbEffectiveAngularInertia,rawrigidbodyset_rbWakeUp=__vite__wasmModule.rawrigidbodyset_rbWakeUp,rawrigidbodyset_rbIsCcdEnabled=__vite__wasmModule.rawrigidbodyset_rbIsCcdEnabled,rawrigidbodyset_rbSoftCcdPrediction=__vite__wasmModule.rawrigidbodyset_rbSoftCcdPrediction,rawrigidbodyset_rbNumColliders=__vite__wasmModule.rawrigidbodyset_rbNumColliders,rawrigidbodyset_rbCollider=__vite__wasmModule.rawrigidbodyset_rbCollider,rawrigidbodyset_rbBodyType=__vite__wasmModule.rawrigidbodyset_rbBodyType,rawrigidbodyset_rbSetBodyType=__vite__wasmModule.rawrigidbodyset_rbSetBodyType,rawrigidbodyset_rbIsFixed=__vite__wasmModule.rawrigidbodyset_rbIsFixed,rawrigidbodyset_rbIsKinematic=__vite__wasmModule.rawrigidbodyset_rbIsKinematic,rawrigidbodyset_rbIsDynamic=__vite__wasmModule.rawrigidbodyset_rbIsDynamic,rawrigidbodyset_rbLinearDamping=__vite__wasmModule.rawrigidbodyset_rbLinearDamping,rawrigidbodyset_rbAngularDamping=__vite__wasmModule.rawrigidbodyset_rbAngularDamping,rawrigidbodyset_rbSetLinearDamping=__vite__wasmModule.rawrigidbodyset_rbSetLinearDamping,rawrigidbodyset_rbSetAngularDamping=__vite__wasmModule.rawrigidbodyset_rbSetAngularDamping,rawrigidbodyset_rbSetEnabled=__vite__wasmModule.rawrigidbodyset_rbSetEnabled,rawrigidbodyset_rbIsEnabled=__vite__wasmModule.rawrigidbodyset_rbIsEnabled,rawrigidbodyset_rbGravityScale=__vite__wasmModule.rawrigidbodyset_rbGravityScale,rawrigidbodyset_rbSetGravityScale=__vite__wasmModule.rawrigidbodyset_rbSetGravityScale,rawrigidbodyset_rbResetForces=__vite__wasmModule.rawrigidbodyset_rbResetForces,rawrigidbodyset_rbResetTorques=__vite__wasmModule.rawrigidbodyset_rbResetTorques,rawrigidbodyset_rbAddForce=__vite__wasmModule.rawrigidbodyset_rbAddForce,rawrigidbodyset_rbApplyImpulse=__vite__wasmModule.rawrigidbodyset_rbApplyImpulse,rawrigidbodyset_rbAddTorque=__vite__wasmModule.rawrigidbodyset_rbAddTorque,rawrigidbodyset_rbApplyTorqueImpulse=__vite__wasmModule.rawrigidbodyset_rbApplyTorqueImpulse,rawrigidbodyset_rbAddForceAtPoint=__vite__wasmModule.rawrigidbodyset_rbAddForceAtPoint,rawrigidbodyset_rbApplyImpulseAtPoint=__vite__wasmModule.rawrigidbodyset_rbApplyImpulseAtPoint,rawrigidbodyset_rbAdditionalSolverIterations=__vite__wasmModule.rawrigidbodyset_rbAdditionalSolverIterations,rawrigidbodyset_rbSetAdditionalSolverIterations=__vite__wasmModule.rawrigidbodyset_rbSetAdditionalSolverIterations,rawrigidbodyset_rbUserData=__vite__wasmModule.rawrigidbodyset_rbUserData,rawrigidbodyset_rbSetUserData=__vite__wasmModule.rawrigidbodyset_rbSetUserData,rawrigidbodyset_rbUserForce=__vite__wasmModule.rawrigidbodyset_rbUserForce,rawrigidbodyset_rbUserTorque=__vite__wasmModule.rawrigidbodyset_rbUserTorque,__wbg_rawrigidbodyset_free=__vite__wasmModule.__wbg_rawrigidbodyset_free,rawrigidbodyset_new=__vite__wasmModule.rawrigidbodyset_new,rawrigidbodyset_createRigidBody=__vite__wasmModule.rawrigidbodyset_createRigidBody,rawrigidbodyset_remove=__vite__wasmModule.rawrigidbodyset_remove,rawrigidbodyset_contains=__vite__wasmModule.rawrigidbodyset_contains,rawrigidbodyset_forEachRigidBodyHandle=__vite__wasmModule.rawrigidbodyset_forEachRigidBodyHandle,rawrigidbodyset_propagateModifiedBodyPositionsToColliders=__vite__wasmModule.rawrigidbodyset_propagateModifiedBodyPositionsToColliders,__wbg_rawbroadphase_free=__vite__wasmModule.__wbg_rawbroadphase_free,rawbroadphase_new=__vite__wasmModule.rawbroadphase_new,rawcolliderset_coTranslation=__vite__wasmModule.rawcolliderset_coTranslation,rawcolliderset_coRotation=__vite__wasmModule.rawcolliderset_coRotation,rawcolliderset_coSetTranslation=__vite__wasmModule.rawcolliderset_coSetTranslation,rawcolliderset_coSetTranslationWrtParent=__vite__wasmModule.rawcolliderset_coSetTranslationWrtParent,rawcolliderset_coSetRotation=__vite__wasmModule.rawcolliderset_coSetRotation,rawcolliderset_coSetRotationWrtParent=__vite__wasmModule.rawcolliderset_coSetRotationWrtParent,rawcolliderset_coIsSensor=__vite__wasmModule.rawcolliderset_coIsSensor,rawcolliderset_coShapeType=__vite__wasmModule.rawcolliderset_coShapeType,rawcolliderset_coHalfspaceNormal=__vite__wasmModule.rawcolliderset_coHalfspaceNormal,rawcolliderset_coHalfExtents=__vite__wasmModule.rawcolliderset_coHalfExtents,rawcolliderset_coSetHalfExtents=__vite__wasmModule.rawcolliderset_coSetHalfExtents,rawcolliderset_coRadius=__vite__wasmModule.rawcolliderset_coRadius,rawcolliderset_coSetRadius=__vite__wasmModule.rawcolliderset_coSetRadius,rawcolliderset_coHalfHeight=__vite__wasmModule.rawcolliderset_coHalfHeight,rawcolliderset_coSetHalfHeight=__vite__wasmModule.rawcolliderset_coSetHalfHeight,rawcolliderset_coRoundRadius=__vite__wasmModule.rawcolliderset_coRoundRadius,rawcolliderset_coSetRoundRadius=__vite__wasmModule.rawcolliderset_coSetRoundRadius,rawcolliderset_coVertices=__vite__wasmModule.rawcolliderset_coVertices,rawcolliderset_coIndices=__vite__wasmModule.rawcolliderset_coIndices,rawcolliderset_coTriMeshFlags=__vite__wasmModule.rawcolliderset_coTriMeshFlags,rawcolliderset_coHeightFieldFlags=__vite__wasmModule.rawcolliderset_coHeightFieldFlags,rawcolliderset_coHeightfieldHeights=__vite__wasmModule.rawcolliderset_coHeightfieldHeights,rawcolliderset_coHeightfieldScale=__vite__wasmModule.rawcolliderset_coHeightfieldScale,rawcolliderset_coHeightfieldNRows=__vite__wasmModule.rawcolliderset_coHeightfieldNRows,rawcolliderset_coHeightfieldNCols=__vite__wasmModule.rawcolliderset_coHeightfieldNCols,rawcolliderset_coParent=__vite__wasmModule.rawcolliderset_coParent,rawcolliderset_coSetEnabled=__vite__wasmModule.rawcolliderset_coSetEnabled,rawcolliderset_coIsEnabled=__vite__wasmModule.rawcolliderset_coIsEnabled,rawcolliderset_coSetContactSkin=__vite__wasmModule.rawcolliderset_coSetContactSkin,rawcolliderset_coContactSkin=__vite__wasmModule.rawcolliderset_coContactSkin,rawcolliderset_coFriction=__vite__wasmModule.rawcolliderset_coFriction,rawcolliderset_coRestitution=__vite__wasmModule.rawcolliderset_coRestitution,rawcolliderset_coDensity=__vite__wasmModule.rawcolliderset_coDensity,rawcolliderset_coMass=__vite__wasmModule.rawcolliderset_coMass,rawcolliderset_coVolume=__vite__wasmModule.rawcolliderset_coVolume,rawcolliderset_coCollisionGroups=__vite__wasmModule.rawcolliderset_coCollisionGroups,rawcolliderset_coSolverGroups=__vite__wasmModule.rawcolliderset_coSolverGroups,rawcolliderset_coActiveHooks=__vite__wasmModule.rawcolliderset_coActiveHooks,rawcolliderset_coActiveCollisionTypes=__vite__wasmModule.rawcolliderset_coActiveCollisionTypes,rawcolliderset_coActiveEvents=__vite__wasmModule.rawcolliderset_coActiveEvents,rawcolliderset_coContactForceEventThreshold=__vite__wasmModule.rawcolliderset_coContactForceEventThreshold,rawcolliderset_coContainsPoint=__vite__wasmModule.rawcolliderset_coContainsPoint,rawcolliderset_coCastShape=__vite__wasmModule.rawcolliderset_coCastShape,rawcolliderset_coCastCollider=__vite__wasmModule.rawcolliderset_coCastCollider,rawcolliderset_coIntersectsShape=__vite__wasmModule.rawcolliderset_coIntersectsShape,rawcolliderset_coContactShape=__vite__wasmModule.rawcolliderset_coContactShape,rawcolliderset_coContactCollider=__vite__wasmModule.rawcolliderset_coContactCollider,rawcolliderset_coProjectPoint=__vite__wasmModule.rawcolliderset_coProjectPoint,rawcolliderset_coIntersectsRay=__vite__wasmModule.rawcolliderset_coIntersectsRay,rawcolliderset_coCastRay=__vite__wasmModule.rawcolliderset_coCastRay,rawcolliderset_coCastRayAndGetNormal=__vite__wasmModule.rawcolliderset_coCastRayAndGetNormal,rawcolliderset_coSetSensor=__vite__wasmModule.rawcolliderset_coSetSensor,rawcolliderset_coSetRestitution=__vite__wasmModule.rawcolliderset_coSetRestitution,rawcolliderset_coSetFriction=__vite__wasmModule.rawcolliderset_coSetFriction,rawcolliderset_coFrictionCombineRule=__vite__wasmModule.rawcolliderset_coFrictionCombineRule,rawcolliderset_coSetFrictionCombineRule=__vite__wasmModule.rawcolliderset_coSetFrictionCombineRule,rawcolliderset_coRestitutionCombineRule=__vite__wasmModule.rawcolliderset_coRestitutionCombineRule,rawcolliderset_coSetRestitutionCombineRule=__vite__wasmModule.rawcolliderset_coSetRestitutionCombineRule,rawcolliderset_coSetCollisionGroups=__vite__wasmModule.rawcolliderset_coSetCollisionGroups,rawcolliderset_coSetSolverGroups=__vite__wasmModule.rawcolliderset_coSetSolverGroups,rawcolliderset_coSetActiveHooks=__vite__wasmModule.rawcolliderset_coSetActiveHooks,rawcolliderset_coSetActiveEvents=__vite__wasmModule.rawcolliderset_coSetActiveEvents,rawcolliderset_coSetActiveCollisionTypes=__vite__wasmModule.rawcolliderset_coSetActiveCollisionTypes,rawcolliderset_coSetShape=__vite__wasmModule.rawcolliderset_coSetShape,rawcolliderset_coSetContactForceEventThreshold=__vite__wasmModule.rawcolliderset_coSetContactForceEventThreshold,rawcolliderset_coSetDensity=__vite__wasmModule.rawcolliderset_coSetDensity,rawcolliderset_coSetMass=__vite__wasmModule.rawcolliderset_coSetMass,rawcolliderset_coSetMassProperties=__vite__wasmModule.rawcolliderset_coSetMassProperties,__wbg_rawcolliderset_free=__vite__wasmModule.__wbg_rawcolliderset_free,rawcolliderset_new=__vite__wasmModule.rawcolliderset_new,rawcolliderset_len=__vite__wasmModule.rawcolliderset_len,rawcolliderset_contains=__vite__wasmModule.rawcolliderset_contains,rawcolliderset_createCollider=__vite__wasmModule.rawcolliderset_createCollider,rawcolliderset_remove=__vite__wasmModule.rawcolliderset_remove,rawcolliderset_forEachColliderHandle=__vite__wasmModule.rawcolliderset_forEachColliderHandle,__wbg_rawshapecontact_free=__vite__wasmModule.__wbg_rawshapecontact_free,__wbg_rawnarrowphase_free=__vite__wasmModule.__wbg_rawnarrowphase_free,rawnarrowphase_new=__vite__wasmModule.rawnarrowphase_new,rawnarrowphase_contact_pairs_with=__vite__wasmModule.rawnarrowphase_contact_pairs_with,rawnarrowphase_contact_pair=__vite__wasmModule.rawnarrowphase_contact_pair,rawnarrowphase_intersection_pairs_with=__vite__wasmModule.rawnarrowphase_intersection_pairs_with,rawnarrowphase_intersection_pair=__vite__wasmModule.rawnarrowphase_intersection_pair,__wbg_rawcontactmanifold_free=__vite__wasmModule.__wbg_rawcontactmanifold_free,rawcontactpair_collider1=__vite__wasmModule.rawcontactpair_collider1,rawcontactpair_collider2=__vite__wasmModule.rawcontactpair_collider2,rawcontactpair_numContactManifolds=__vite__wasmModule.rawcontactpair_numContactManifolds,rawcontactpair_contactManifold=__vite__wasmModule.rawcontactpair_contactManifold,rawcontactmanifold_normal=__vite__wasmModule.rawcontactmanifold_normal,rawcontactmanifold_local_n1=__vite__wasmModule.rawcontactmanifold_local_n1,rawcontactmanifold_local_n2=__vite__wasmModule.rawcontactmanifold_local_n2,rawcontactmanifold_subshape1=__vite__wasmModule.rawcontactmanifold_subshape1,rawcontactmanifold_subshape2=__vite__wasmModule.rawcontactmanifold_subshape2,rawcontactmanifold_num_contacts=__vite__wasmModule.rawcontactmanifold_num_contacts,rawcontactmanifold_contact_local_p1=__vite__wasmModule.rawcontactmanifold_contact_local_p1,rawcontactmanifold_contact_local_p2=__vite__wasmModule.rawcontactmanifold_contact_local_p2,rawcontactmanifold_contact_dist=__vite__wasmModule.rawcontactmanifold_contact_dist,rawcontactmanifold_contact_fid1=__vite__wasmModule.rawcontactmanifold_contact_fid1,rawcontactmanifold_contact_fid2=__vite__wasmModule.rawcontactmanifold_contact_fid2,rawcontactmanifold_contact_impulse=__vite__wasmModule.rawcontactmanifold_contact_impulse,rawcontactmanifold_contact_tangent_impulse_x=__vite__wasmModule.rawcontactmanifold_contact_tangent_impulse_x,rawcontactmanifold_contact_tangent_impulse_y=__vite__wasmModule.rawcontactmanifold_contact_tangent_impulse_y,rawcontactmanifold_num_solver_contacts=__vite__wasmModule.rawcontactmanifold_num_solver_contacts,rawcontactmanifold_solver_contact_point=__vite__wasmModule.rawcontactmanifold_solver_contact_point,rawcontactmanifold_solver_contact_dist=__vite__wasmModule.rawcontactmanifold_solver_contact_dist,rawcontactmanifold_solver_contact_friction=__vite__wasmModule.rawcontactmanifold_solver_contact_friction,rawcontactmanifold_solver_contact_restitution=__vite__wasmModule.rawcontactmanifold_solver_contact_restitution,rawcontactmanifold_solver_contact_tangent_velocity=__vite__wasmModule.rawcontactmanifold_solver_contact_tangent_velocity,__wbg_rawpointprojection_free=__vite__wasmModule.__wbg_rawpointprojection_free,rawpointprojection_point=__vite__wasmModule.rawpointprojection_point,rawpointprojection_isInside=__vite__wasmModule.rawpointprojection_isInside,__wbg_rawpointcolliderprojection_free=__vite__wasmModule.__wbg_rawpointcolliderprojection_free,rawpointcolliderprojection_colliderHandle=__vite__wasmModule.rawpointcolliderprojection_colliderHandle,rawpointcolliderprojection_point=__vite__wasmModule.rawpointcolliderprojection_point,rawpointcolliderprojection_isInside=__vite__wasmModule.rawpointcolliderprojection_isInside,rawpointcolliderprojection_featureType=__vite__wasmModule.rawpointcolliderprojection_featureType,rawpointcolliderprojection_featureId=__vite__wasmModule.rawpointcolliderprojection_featureId,__wbg_rawrayintersection_free=__vite__wasmModule.__wbg_rawrayintersection_free,__wbg_rawraycolliderhit_free=__vite__wasmModule.__wbg_rawraycolliderhit_free,__wbg_rawshape_free=__vite__wasmModule.__wbg_rawshape_free,rawshape_cuboid=__vite__wasmModule.rawshape_cuboid,rawshape_roundCuboid=__vite__wasmModule.rawshape_roundCuboid,rawshape_ball=__vite__wasmModule.rawshape_ball,rawshape_halfspace=__vite__wasmModule.rawshape_halfspace,rawshape_capsule=__vite__wasmModule.rawshape_capsule,rawshape_cylinder=__vite__wasmModule.rawshape_cylinder,rawshape_roundCylinder=__vite__wasmModule.rawshape_roundCylinder,rawshape_cone=__vite__wasmModule.rawshape_cone,rawshape_roundCone=__vite__wasmModule.rawshape_roundCone,rawshape_polyline=__vite__wasmModule.rawshape_polyline,rawshape_trimesh=__vite__wasmModule.rawshape_trimesh,rawshape_heightfield=__vite__wasmModule.rawshape_heightfield,rawshape_segment=__vite__wasmModule.rawshape_segment,rawshape_triangle=__vite__wasmModule.rawshape_triangle,rawshape_roundTriangle=__vite__wasmModule.rawshape_roundTriangle,rawshape_convexHull=__vite__wasmModule.rawshape_convexHull,rawshape_roundConvexHull=__vite__wasmModule.rawshape_roundConvexHull,rawshape_convexMesh=__vite__wasmModule.rawshape_convexMesh,rawshape_roundConvexMesh=__vite__wasmModule.rawshape_roundConvexMesh,rawshape_castShape=__vite__wasmModule.rawshape_castShape,rawshape_intersectsShape=__vite__wasmModule.rawshape_intersectsShape,rawshape_contactShape=__vite__wasmModule.rawshape_contactShape,rawshape_containsPoint=__vite__wasmModule.rawshape_containsPoint,rawshape_projectPoint=__vite__wasmModule.rawshape_projectPoint,rawshape_intersectsRay=__vite__wasmModule.rawshape_intersectsRay,rawshape_castRay=__vite__wasmModule.rawshape_castRay,rawshape_castRayAndGetNormal=__vite__wasmModule.rawshape_castRayAndGetNormal,__wbg_rawshapecasthit_free=__vite__wasmModule.__wbg_rawshapecasthit_free,rawshapecasthit_witness1=__vite__wasmModule.rawshapecasthit_witness1,rawshapecasthit_normal1=__vite__wasmModule.rawshapecasthit_normal1,rawshapecasthit_normal2=__vite__wasmModule.rawshapecasthit_normal2,__wbg_rawcollidershapecasthit_free=__vite__wasmModule.__wbg_rawcollidershapecasthit_free,rawcollidershapecasthit_time_of_impact=__vite__wasmModule.rawcollidershapecasthit_time_of_impact,rawcollidershapecasthit_witness1=__vite__wasmModule.rawcollidershapecasthit_witness1,rawcollidershapecasthit_witness2=__vite__wasmModule.rawcollidershapecasthit_witness2,rawrotation_new=__vite__wasmModule.rawrotation_new,rawrotation_identity=__vite__wasmModule.rawrotation_identity,rawrotation_x=__vite__wasmModule.rawrotation_x,rawrotation_w=__vite__wasmModule.rawrotation_w,rawvector_zero=__vite__wasmModule.rawvector_zero,rawvector_new=__vite__wasmModule.rawvector_new,rawvector_set_x=__vite__wasmModule.rawvector_set_x,rawvector_set_z=__vite__wasmModule.rawvector_set_z,rawvector_xyz=__vite__wasmModule.rawvector_xyz,rawvector_yxz=__vite__wasmModule.rawvector_yxz,rawvector_zxy=__vite__wasmModule.rawvector_zxy,rawvector_xzy=__vite__wasmModule.rawvector_xzy,rawvector_yzx=__vite__wasmModule.rawvector_yzx,rawvector_zyx=__vite__wasmModule.rawvector_zyx,rawsdpmatrix3_elements=__vite__wasmModule.rawsdpmatrix3_elements,__wbg_rawdebugrenderpipeline_free=__vite__wasmModule.__wbg_rawdebugrenderpipeline_free,rawdebugrenderpipeline_new=__vite__wasmModule.rawdebugrenderpipeline_new,rawdebugrenderpipeline_vertices=__vite__wasmModule.rawdebugrenderpipeline_vertices,rawdebugrenderpipeline_colors=__vite__wasmModule.rawdebugrenderpipeline_colors,rawdebugrenderpipeline_render=__vite__wasmModule.rawdebugrenderpipeline_render,__wbg_raweventqueue_free=__vite__wasmModule.__wbg_raweventqueue_free,__wbg_rawcontactforceevent_free=__vite__wasmModule.__wbg_rawcontactforceevent_free,rawcontactforceevent_collider2=__vite__wasmModule.rawcontactforceevent_collider2,rawcontactforceevent_total_force=__vite__wasmModule.rawcontactforceevent_total_force,rawcontactforceevent_total_force_magnitude=__vite__wasmModule.rawcontactforceevent_total_force_magnitude,rawcontactforceevent_max_force_direction=__vite__wasmModule.rawcontactforceevent_max_force_direction,rawcontactforceevent_max_force_magnitude=__vite__wasmModule.rawcontactforceevent_max_force_magnitude,raweventqueue_new=__vite__wasmModule.raweventqueue_new,raweventqueue_drainCollisionEvents=__vite__wasmModule.raweventqueue_drainCollisionEvents,raweventqueue_drainContactForceEvents=__vite__wasmModule.raweventqueue_drainContactForceEvents,raweventqueue_clear=__vite__wasmModule.raweventqueue_clear,__wbg_rawphysicspipeline_free=__vite__wasmModule.__wbg_rawphysicspipeline_free,rawphysicspipeline_new=__vite__wasmModule.rawphysicspipeline_new,rawphysicspipeline_step=__vite__wasmModule.rawphysicspipeline_step,rawphysicspipeline_stepWithEvents=__vite__wasmModule.rawphysicspipeline_stepWithEvents,rawquerypipeline_new=__vite__wasmModule.rawquerypipeline_new,rawquerypipeline_update=__vite__wasmModule.rawquerypipeline_update,rawquerypipeline_castRay=__vite__wasmModule.rawquerypipeline_castRay,rawquerypipeline_castRayAndGetNormal=__vite__wasmModule.rawquerypipeline_castRayAndGetNormal,rawquerypipeline_intersectionsWithRay=__vite__wasmModule.rawquerypipeline_intersectionsWithRay,rawquerypipeline_intersectionWithShape=__vite__wasmModule.rawquerypipeline_intersectionWithShape,rawquerypipeline_projectPoint=__vite__wasmModule.rawquerypipeline_projectPoint,rawquerypipeline_projectPointAndGetFeature=__vite__wasmModule.rawquerypipeline_projectPointAndGetFeature,rawquerypipeline_intersectionsWithPoint=__vite__wasmModule.rawquerypipeline_intersectionsWithPoint,rawquerypipeline_castShape=__vite__wasmModule.rawquerypipeline_castShape,rawquerypipeline_intersectionsWithShape=__vite__wasmModule.rawquerypipeline_intersectionsWithShape,rawquerypipeline_collidersWithAabbIntersectingAabb=__vite__wasmModule.rawquerypipeline_collidersWithAabbIntersectingAabb,__wbg_rawdeserializedworld_free=__vite__wasmModule.__wbg_rawdeserializedworld_free,rawdeserializedworld_takeGravity=__vite__wasmModule.rawdeserializedworld_takeGravity,rawdeserializedworld_takeIntegrationParameters=__vite__wasmModule.rawdeserializedworld_takeIntegrationParameters,rawdeserializedworld_takeIslandManager=__vite__wasmModule.rawdeserializedworld_takeIslandManager,rawdeserializedworld_takeBroadPhase=__vite__wasmModule.rawdeserializedworld_takeBroadPhase,rawdeserializedworld_takeNarrowPhase=__vite__wasmModule.rawdeserializedworld_takeNarrowPhase,rawdeserializedworld_takeBodies=__vite__wasmModule.rawdeserializedworld_takeBodies,rawdeserializedworld_takeColliders=__vite__wasmModule.rawdeserializedworld_takeColliders,rawdeserializedworld_takeImpulseJoints=__vite__wasmModule.rawdeserializedworld_takeImpulseJoints,rawdeserializedworld_takeMultibodyJoints=__vite__wasmModule.rawdeserializedworld_takeMultibodyJoints,rawserializationpipeline_new=__vite__wasmModule.rawserializationpipeline_new,rawserializationpipeline_serializeAll=__vite__wasmModule.rawserializationpipeline_serializeAll,rawserializationpipeline_deserializeAll=__vite__wasmModule.rawserializationpipeline_deserializeAll,rawkinematiccharactercontroller_offset=__vite__wasmModule.rawkinematiccharactercontroller_offset,rawintegrationparameters_normalizedAllowedLinearError=__vite__wasmModule.rawintegrationparameters_normalizedAllowedLinearError,rawintegrationparameters_numAdditionalFrictionIterations=__vite__wasmModule.rawintegrationparameters_numAdditionalFrictionIterations,rawintegrationparameters_numInternalPgsIterations=__vite__wasmModule.rawintegrationparameters_numInternalPgsIterations,rawintegrationparameters_minIslandSize=__vite__wasmModule.rawintegrationparameters_minIslandSize,rawrigidbodyset_len=__vite__wasmModule.rawrigidbodyset_len,rawshapecontact_distance=__vite__wasmModule.rawshapecontact_distance,rawrayintersection_featureType=__vite__wasmModule.rawrayintersection_featureType,rawraycolliderintersection_colliderHandle=__vite__wasmModule.rawraycolliderintersection_colliderHandle,rawrayintersection_time_of_impact=__vite__wasmModule.rawrayintersection_time_of_impact,rawraycolliderintersection_featureType=__vite__wasmModule.rawraycolliderintersection_featureType,rawraycolliderhit_colliderHandle=__vite__wasmModule.rawraycolliderhit_colliderHandle,rawraycolliderintersection_time_of_impact=__vite__wasmModule.rawraycolliderintersection_time_of_impact,rawcollidershapecasthit_colliderHandle=__vite__wasmModule.rawcollidershapecasthit_colliderHandle,rawraycolliderhit_timeOfImpact=__vite__wasmModule.rawraycolliderhit_timeOfImpact,rawshapecasthit_time_of_impact=__vite__wasmModule.rawshapecasthit_time_of_impact,rawrotation_y=__vite__wasmModule.rawrotation_y,rawrotation_z=__vite__wasmModule.rawrotation_z,rawvector_x=__vite__wasmModule.rawvector_x,rawvector_y=__vite__wasmModule.rawvector_y,rawvector_z=__vite__wasmModule.rawvector_z,rawcontactforceevent_collider1=__vite__wasmModule.rawcontactforceevent_collider1,rawintegrationparameters_normalizedPredictionDistance=__vite__wasmModule.rawintegrationparameters_normalizedPredictionDistance,rawrayintersection_featureId=__vite__wasmModule.rawrayintersection_featureId,rawraycolliderintersection_featureId=__vite__wasmModule.rawraycolliderintersection_featureId,rawcolliderset_isHandleValid=__vite__wasmModule.rawcolliderset_isHandleValid,rawintegrationparameters_set_numAdditionalFrictionIterations=__vite__wasmModule.rawintegrationparameters_set_numAdditionalFrictionIterations,rawintegrationparameters_set_numInternalPgsIterations=__vite__wasmModule.rawintegrationparameters_set_numInternalPgsIterations,rawvector_set_y=__vite__wasmModule.rawvector_set_y,__wbg_rawcontactpair_free=__vite__wasmModule.__wbg_rawcontactpair_free,__wbg_rawraycolliderintersection_free=__vite__wasmModule.__wbg_rawraycolliderintersection_free,__wbg_rawrotation_free=__vite__wasmModule.__wbg_rawrotation_free,__wbg_rawvector_free=__vite__wasmModule.__wbg_rawvector_free,__wbg_rawsdpmatrix3_free=__vite__wasmModule.__wbg_rawsdpmatrix3_free,__wbg_rawserializationpipeline_free=__vite__wasmModule.__wbg_rawserializationpipeline_free,__wbg_rawquerypipeline_free=__vite__wasmModule.__wbg_rawquerypipeline_free,rawkinematiccharactercontroller_up=__vite__wasmModule.rawkinematiccharactercontroller_up,rawshapecontact_normal2=__vite__wasmModule.rawshapecontact_normal2,rawshapecontact_point1=__vite__wasmModule.rawshapecontact_point1,rawshapecontact_point2=__vite__wasmModule.rawshapecontact_point2,rawrayintersection_normal=__vite__wasmModule.rawrayintersection_normal,rawraycolliderintersection_normal=__vite__wasmModule.rawraycolliderintersection_normal,rawshapecontact_normal1=__vite__wasmModule.rawshapecontact_normal1,rawcollidershapecasthit_normal1=__vite__wasmModule.rawcollidershapecasthit_normal1,rawcollidershapecasthit_normal2=__vite__wasmModule.rawcollidershapecasthit_normal2,rawshapecasthit_witness2=__vite__wasmModule.rawshapecasthit_witness2,__wbindgen_add_to_stack_pointer=__vite__wasmModule.__wbindgen_add_to_stack_pointer,__wbindgen_free=__vite__wasmModule.__wbindgen_free,__wbindgen_malloc=__vite__wasmModule.__wbindgen_malloc,__wbindgen_exn_store=__vite__wasmModule.__wbindgen_exn_store,wasm=Object.freeze(Object.defineProperty({__proto__:null,__wbg_rawbroadphase_free,__wbg_rawccdsolver_free,__wbg_rawcharactercollision_free,__wbg_rawcolliderset_free,__wbg_rawcollidershapecasthit_free,__wbg_rawcontactforceevent_free,__wbg_rawcontactmanifold_free,__wbg_rawcontactpair_free,__wbg_rawdebugrenderpipeline_free,__wbg_rawdeserializedworld_free,__wbg_rawdynamicraycastvehiclecontroller_free,__wbg_raweventqueue_free,__wbg_rawgenericjoint_free,__wbg_rawimpulsejointset_free,__wbg_rawintegrationparameters_free,__wbg_rawislandmanager_free,__wbg_rawkinematiccharactercontroller_free,__wbg_rawmultibodyjointset_free,__wbg_rawnarrowphase_free,__wbg_rawphysicspipeline_free,__wbg_rawpointcolliderprojection_free,__wbg_rawpointprojection_free,__wbg_rawquerypipeline_free,__wbg_rawraycolliderhit_free,__wbg_rawraycolliderintersection_free,__wbg_rawrayintersection_free,__wbg_rawrigidbodyset_free,__wbg_rawrotation_free,__wbg_rawsdpmatrix3_free,__wbg_rawserializationpipeline_free,__wbg_rawshape_free,__wbg_rawshapecasthit_free,__wbg_rawshapecontact_free,__wbg_rawvector_free,__wbindgen_add_to_stack_pointer,__wbindgen_exn_store,__wbindgen_free,__wbindgen_malloc,memory,rawbroadphase_new,rawccdsolver_new,rawcharactercollision_handle,rawcharactercollision_new,rawcharactercollision_toi,rawcharactercollision_translationDeltaApplied,rawcharactercollision_translationDeltaRemaining,rawcharactercollision_worldNormal1,rawcharactercollision_worldNormal2,rawcharactercollision_worldWitness1,rawcharactercollision_worldWitness2,rawcolliderset_coActiveCollisionTypes,rawcolliderset_coActiveEvents,rawcolliderset_coActiveHooks,rawcolliderset_coCastCollider,rawcolliderset_coCastRay,rawcolliderset_coCastRayAndGetNormal,rawcolliderset_coCastShape,rawcolliderset_coCollisionGroups,rawcolliderset_coContactCollider,rawcolliderset_coContactForceEventThreshold,rawcolliderset_coContactShape,rawcolliderset_coContactSkin,rawcolliderset_coContainsPoint,rawcolliderset_coDensity,rawcolliderset_coFriction,rawcolliderset_coFrictionCombineRule,rawcolliderset_coHalfExtents,rawcolliderset_coHalfHeight,rawcolliderset_coHalfspaceNormal,rawcolliderset_coHeightFieldFlags,rawcolliderset_coHeightfieldHeights,rawcolliderset_coHeightfieldNCols,rawcolliderset_coHeightfieldNRows,rawcolliderset_coHeightfieldScale,rawcolliderset_coIndices,rawcolliderset_coIntersectsRay,rawcolliderset_coIntersectsShape,rawcolliderset_coIsEnabled,rawcolliderset_coIsSensor,rawcolliderset_coMass,rawcolliderset_coParent,rawcolliderset_coProjectPoint,rawcolliderset_coRadius,rawcolliderset_coRestitution,rawcolliderset_coRestitutionCombineRule,rawcolliderset_coRotation,rawcolliderset_coRoundRadius,rawcolliderset_coSetActiveCollisionTypes,rawcolliderset_coSetActiveEvents,rawcolliderset_coSetActiveHooks,rawcolliderset_coSetCollisionGroups,rawcolliderset_coSetContactForceEventThreshold,rawcolliderset_coSetContactSkin,rawcolliderset_coSetDensity,rawcolliderset_coSetEnabled,rawcolliderset_coSetFriction,rawcolliderset_coSetFrictionCombineRule,rawcolliderset_coSetHalfExtents,rawcolliderset_coSetHalfHeight,rawcolliderset_coSetMass,rawcolliderset_coSetMassProperties,rawcolliderset_coSetRadius,rawcolliderset_coSetRestitution,rawcolliderset_coSetRestitutionCombineRule,rawcolliderset_coSetRotation,rawcolliderset_coSetRotationWrtParent,rawcolliderset_coSetRoundRadius,rawcolliderset_coSetSensor,rawcolliderset_coSetShape,rawcolliderset_coSetSolverGroups,rawcolliderset_coSetTranslation,rawcolliderset_coSetTranslationWrtParent,rawcolliderset_coShapeType,rawcolliderset_coSolverGroups,rawcolliderset_coTranslation,rawcolliderset_coTriMeshFlags,rawcolliderset_coVertices,rawcolliderset_coVolume,rawcolliderset_contains,rawcolliderset_createCollider,rawcolliderset_forEachColliderHandle,rawcolliderset_isHandleValid,rawcolliderset_len,rawcolliderset_new,rawcolliderset_remove,rawcollidershapecasthit_colliderHandle,rawcollidershapecasthit_normal1,rawcollidershapecasthit_normal2,rawcollidershapecasthit_time_of_impact,rawcollidershapecasthit_witness1,rawcollidershapecasthit_witness2,rawcontactforceevent_collider1,rawcontactforceevent_collider2,rawcontactforceevent_max_force_direction,rawcontactforceevent_max_force_magnitude,rawcontactforceevent_total_force,rawcontactforceevent_total_force_magnitude,rawcontactmanifold_contact_dist,rawcontactmanifold_contact_fid1,rawcontactmanifold_contact_fid2,rawcontactmanifold_contact_impulse,rawcontactmanifold_contact_local_p1,rawcontactmanifold_contact_local_p2,rawcontactmanifold_contact_tangent_impulse_x,rawcontactmanifold_contact_tangent_impulse_y,rawcontactmanifold_local_n1,rawcontactmanifold_local_n2,rawcontactmanifold_normal,rawcontactmanifold_num_contacts,rawcontactmanifold_num_solver_contacts,rawcontactmanifold_solver_contact_dist,rawcontactmanifold_solver_contact_friction,rawcontactmanifold_solver_contact_point,rawcontactmanifold_solver_contact_restitution,rawcontactmanifold_solver_contact_tangent_velocity,rawcontactmanifold_subshape1,rawcontactmanifold_subshape2,rawcontactpair_collider1,rawcontactpair_collider2,rawcontactpair_contactManifold,rawcontactpair_numContactManifolds,rawdebugrenderpipeline_colors,rawdebugrenderpipeline_new,rawdebugrenderpipeline_render,rawdebugrenderpipeline_vertices,rawdeserializedworld_takeBodies,rawdeserializedworld_takeBroadPhase,rawdeserializedworld_takeColliders,rawdeserializedworld_takeGravity,rawdeserializedworld_takeImpulseJoints,rawdeserializedworld_takeIntegrationParameters,rawdeserializedworld_takeIslandManager,rawdeserializedworld_takeMultibodyJoints,rawdeserializedworld_takeNarrowPhase,rawdynamicraycastvehiclecontroller_add_wheel,rawdynamicraycastvehiclecontroller_chassis,rawdynamicraycastvehiclecontroller_current_vehicle_speed,rawdynamicraycastvehiclecontroller_index_forward_axis,rawdynamicraycastvehiclecontroller_index_up_axis,rawdynamicraycastvehiclecontroller_new,rawdynamicraycastvehiclecontroller_num_wheels,rawdynamicraycastvehiclecontroller_set_index_forward_axis,rawdynamicraycastvehiclecontroller_set_index_up_axis,rawdynamicraycastvehiclecontroller_set_wheel_axle_cs,rawdynamicraycastvehiclecontroller_set_wheel_brake,rawdynamicraycastvehiclecontroller_set_wheel_chassis_connection_point_cs,rawdynamicraycastvehiclecontroller_set_wheel_direction_cs,rawdynamicraycastvehiclecontroller_set_wheel_engine_force,rawdynamicraycastvehiclecontroller_set_wheel_friction_slip,rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_force,rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_travel,rawdynamicraycastvehiclecontroller_set_wheel_radius,rawdynamicraycastvehiclecontroller_set_wheel_side_friction_stiffness,rawdynamicraycastvehiclecontroller_set_wheel_steering,rawdynamicraycastvehiclecontroller_set_wheel_suspension_compression,rawdynamicraycastvehiclecontroller_set_wheel_suspension_relaxation,rawdynamicraycastvehiclecontroller_set_wheel_suspension_rest_length,rawdynamicraycastvehiclecontroller_set_wheel_suspension_stiffness,rawdynamicraycastvehiclecontroller_update_vehicle,rawdynamicraycastvehiclecontroller_wheel_axle_cs,rawdynamicraycastvehiclecontroller_wheel_brake,rawdynamicraycastvehiclecontroller_wheel_chassis_connection_point_cs,rawdynamicraycastvehiclecontroller_wheel_contact_normal_ws,rawdynamicraycastvehiclecontroller_wheel_contact_point_ws,rawdynamicraycastvehiclecontroller_wheel_direction_cs,rawdynamicraycastvehiclecontroller_wheel_engine_force,rawdynamicraycastvehiclecontroller_wheel_forward_impulse,rawdynamicraycastvehiclecontroller_wheel_friction_slip,rawdynamicraycastvehiclecontroller_wheel_ground_object,rawdynamicraycastvehiclecontroller_wheel_hard_point_ws,rawdynamicraycastvehiclecontroller_wheel_is_in_contact,rawdynamicraycastvehiclecontroller_wheel_max_suspension_force,rawdynamicraycastvehiclecontroller_wheel_max_suspension_travel,rawdynamicraycastvehiclecontroller_wheel_radius,rawdynamicraycastvehiclecontroller_wheel_rotation,rawdynamicraycastvehiclecontroller_wheel_side_friction_stiffness,rawdynamicraycastvehiclecontroller_wheel_side_impulse,rawdynamicraycastvehiclecontroller_wheel_steering,rawdynamicraycastvehiclecontroller_wheel_suspension_compression,rawdynamicraycastvehiclecontroller_wheel_suspension_force,rawdynamicraycastvehiclecontroller_wheel_suspension_length,rawdynamicraycastvehiclecontroller_wheel_suspension_relaxation,rawdynamicraycastvehiclecontroller_wheel_suspension_rest_length,rawdynamicraycastvehiclecontroller_wheel_suspension_stiffness,raweventqueue_clear,raweventqueue_drainCollisionEvents,raweventqueue_drainContactForceEvents,raweventqueue_new,rawgenericjoint_fixed,rawgenericjoint_generic,rawgenericjoint_prismatic,rawgenericjoint_revolute,rawgenericjoint_rope,rawgenericjoint_spherical,rawgenericjoint_spring,rawimpulsejointset_contains,rawimpulsejointset_createJoint,rawimpulsejointset_forEachJointAttachedToRigidBody,rawimpulsejointset_forEachJointHandle,rawimpulsejointset_jointAnchor1,rawimpulsejointset_jointAnchor2,rawimpulsejointset_jointBodyHandle1,rawimpulsejointset_jointBodyHandle2,rawimpulsejointset_jointConfigureMotor,rawimpulsejointset_jointConfigureMotorModel,rawimpulsejointset_jointConfigureMotorPosition,rawimpulsejointset_jointConfigureMotorVelocity,rawimpulsejointset_jointContactsEnabled,rawimpulsejointset_jointFrameX1,rawimpulsejointset_jointFrameX2,rawimpulsejointset_jointLimitsEnabled,rawimpulsejointset_jointLimitsMax,rawimpulsejointset_jointLimitsMin,rawimpulsejointset_jointSetAnchor1,rawimpulsejointset_jointSetAnchor2,rawimpulsejointset_jointSetContactsEnabled,rawimpulsejointset_jointSetLimits,rawimpulsejointset_jointType,rawimpulsejointset_len,rawimpulsejointset_new,rawimpulsejointset_remove,rawintegrationparameters_contact_erp,rawintegrationparameters_dt,rawintegrationparameters_lengthUnit,rawintegrationparameters_maxCcdSubsteps,rawintegrationparameters_minIslandSize,rawintegrationparameters_new,rawintegrationparameters_normalizedAllowedLinearError,rawintegrationparameters_normalizedPredictionDistance,rawintegrationparameters_numAdditionalFrictionIterations,rawintegrationparameters_numInternalPgsIterations,rawintegrationparameters_numSolverIterations,rawintegrationparameters_set_contact_natural_frequency,rawintegrationparameters_set_dt,rawintegrationparameters_set_lengthUnit,rawintegrationparameters_set_maxCcdSubsteps,rawintegrationparameters_set_minIslandSize,rawintegrationparameters_set_normalizedAllowedLinearError,rawintegrationparameters_set_normalizedPredictionDistance,rawintegrationparameters_set_numAdditionalFrictionIterations,rawintegrationparameters_set_numInternalPgsIterations,rawintegrationparameters_set_numSolverIterations,rawintegrationparameters_switchToSmallStepsPgsSolver,rawintegrationparameters_switchToSmallStepsPgsSolverWithoutWarmstart,rawintegrationparameters_switchToStandardPgsSolver,rawislandmanager_forEachActiveRigidBodyHandle,rawislandmanager_new,rawkinematiccharactercontroller_autostepEnabled,rawkinematiccharactercontroller_autostepIncludesDynamicBodies,rawkinematiccharactercontroller_autostepMaxHeight,rawkinematiccharactercontroller_autostepMinWidth,rawkinematiccharactercontroller_computeColliderMovement,rawkinematiccharactercontroller_computedCollision,rawkinematiccharactercontroller_computedGrounded,rawkinematiccharactercontroller_computedMovement,rawkinematiccharactercontroller_disableAutostep,rawkinematiccharactercontroller_disableSnapToGround,rawkinematiccharactercontroller_enableAutostep,rawkinematiccharactercontroller_enableSnapToGround,rawkinematiccharactercontroller_maxSlopeClimbAngle,rawkinematiccharactercontroller_minSlopeSlideAngle,rawkinematiccharactercontroller_new,rawkinematiccharactercontroller_normalNudgeFactor,rawkinematiccharactercontroller_numComputedCollisions,rawkinematiccharactercontroller_offset,rawkinematiccharactercontroller_setMaxSlopeClimbAngle,rawkinematiccharactercontroller_setMinSlopeSlideAngle,rawkinematiccharactercontroller_setNormalNudgeFactor,rawkinematiccharactercontroller_setOffset,rawkinematiccharactercontroller_setSlideEnabled,rawkinematiccharactercontroller_setUp,rawkinematiccharactercontroller_slideEnabled,rawkinematiccharactercontroller_snapToGroundDistance,rawkinematiccharactercontroller_snapToGroundEnabled,rawkinematiccharactercontroller_up,rawmultibodyjointset_contains,rawmultibodyjointset_createJoint,rawmultibodyjointset_forEachJointAttachedToRigidBody,rawmultibodyjointset_forEachJointHandle,rawmultibodyjointset_jointAnchor1,rawmultibodyjointset_jointAnchor2,rawmultibodyjointset_jointContactsEnabled,rawmultibodyjointset_jointFrameX1,rawmultibodyjointset_jointFrameX2,rawmultibodyjointset_jointLimitsEnabled,rawmultibodyjointset_jointLimitsMax,rawmultibodyjointset_jointLimitsMin,rawmultibodyjointset_jointSetContactsEnabled,rawmultibodyjointset_jointType,rawmultibodyjointset_new,rawmultibodyjointset_remove,rawnarrowphase_contact_pair,rawnarrowphase_contact_pairs_with,rawnarrowphase_intersection_pair,rawnarrowphase_intersection_pairs_with,rawnarrowphase_new,rawphysicspipeline_new,rawphysicspipeline_step,rawphysicspipeline_stepWithEvents,rawpointcolliderprojection_colliderHandle,rawpointcolliderprojection_featureId,rawpointcolliderprojection_featureType,rawpointcolliderprojection_isInside,rawpointcolliderprojection_point,rawpointprojection_isInside,rawpointprojection_point,rawquerypipeline_castRay,rawquerypipeline_castRayAndGetNormal,rawquerypipeline_castShape,rawquerypipeline_collidersWithAabbIntersectingAabb,rawquerypipeline_intersectionWithShape,rawquerypipeline_intersectionsWithPoint,rawquerypipeline_intersectionsWithRay,rawquerypipeline_intersectionsWithShape,rawquerypipeline_new,rawquerypipeline_projectPoint,rawquerypipeline_projectPointAndGetFeature,rawquerypipeline_update,rawraycolliderhit_colliderHandle,rawraycolliderhit_timeOfImpact,rawraycolliderintersection_colliderHandle,rawraycolliderintersection_featureId,rawraycolliderintersection_featureType,rawraycolliderintersection_normal,rawraycolliderintersection_time_of_impact,rawrayintersection_featureId,rawrayintersection_featureType,rawrayintersection_normal,rawrayintersection_time_of_impact,rawrigidbodyset_contains,rawrigidbodyset_createRigidBody,rawrigidbodyset_forEachRigidBodyHandle,rawrigidbodyset_len,rawrigidbodyset_new,rawrigidbodyset_propagateModifiedBodyPositionsToColliders,rawrigidbodyset_rbAddForce,rawrigidbodyset_rbAddForceAtPoint,rawrigidbodyset_rbAddTorque,rawrigidbodyset_rbAdditionalSolverIterations,rawrigidbodyset_rbAngularDamping,rawrigidbodyset_rbAngvel,rawrigidbodyset_rbApplyImpulse,rawrigidbodyset_rbApplyImpulseAtPoint,rawrigidbodyset_rbApplyTorqueImpulse,rawrigidbodyset_rbBodyType,rawrigidbodyset_rbCollider,rawrigidbodyset_rbDominanceGroup,rawrigidbodyset_rbEffectiveAngularInertia,rawrigidbodyset_rbEffectiveInvMass,rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt,rawrigidbodyset_rbEnableCcd,rawrigidbodyset_rbGravityScale,rawrigidbodyset_rbInvMass,rawrigidbodyset_rbInvPrincipalInertiaSqrt,rawrigidbodyset_rbIsCcdEnabled,rawrigidbodyset_rbIsDynamic,rawrigidbodyset_rbIsEnabled,rawrigidbodyset_rbIsFixed,rawrigidbodyset_rbIsKinematic,rawrigidbodyset_rbIsMoving,rawrigidbodyset_rbIsSleeping,rawrigidbodyset_rbLinearDamping,rawrigidbodyset_rbLinvel,rawrigidbodyset_rbLocalCom,rawrigidbodyset_rbLockRotations,rawrigidbodyset_rbLockTranslations,rawrigidbodyset_rbMass,rawrigidbodyset_rbNextRotation,rawrigidbodyset_rbNextTranslation,rawrigidbodyset_rbNumColliders,rawrigidbodyset_rbPrincipalInertia,rawrigidbodyset_rbPrincipalInertiaLocalFrame,rawrigidbodyset_rbRecomputeMassPropertiesFromColliders,rawrigidbodyset_rbResetForces,rawrigidbodyset_rbResetTorques,rawrigidbodyset_rbRotation,rawrigidbodyset_rbSetAdditionalMass,rawrigidbodyset_rbSetAdditionalMassProperties,rawrigidbodyset_rbSetAdditionalSolverIterations,rawrigidbodyset_rbSetAngularDamping,rawrigidbodyset_rbSetAngvel,rawrigidbodyset_rbSetBodyType,rawrigidbodyset_rbSetDominanceGroup,rawrigidbodyset_rbSetEnabled,rawrigidbodyset_rbSetEnabledRotations,rawrigidbodyset_rbSetEnabledTranslations,rawrigidbodyset_rbSetGravityScale,rawrigidbodyset_rbSetLinearDamping,rawrigidbodyset_rbSetLinvel,rawrigidbodyset_rbSetNextKinematicRotation,rawrigidbodyset_rbSetNextKinematicTranslation,rawrigidbodyset_rbSetRotation,rawrigidbodyset_rbSetSoftCcdPrediction,rawrigidbodyset_rbSetTranslation,rawrigidbodyset_rbSetUserData,rawrigidbodyset_rbSleep,rawrigidbodyset_rbSoftCcdPrediction,rawrigidbodyset_rbTranslation,rawrigidbodyset_rbUserData,rawrigidbodyset_rbUserForce,rawrigidbodyset_rbUserTorque,rawrigidbodyset_rbWakeUp,rawrigidbodyset_rbWorldCom,rawrigidbodyset_remove,rawrotation_identity,rawrotation_new,rawrotation_w,rawrotation_x,rawrotation_y,rawrotation_z,rawsdpmatrix3_elements,rawserializationpipeline_deserializeAll,rawserializationpipeline_new,rawserializationpipeline_serializeAll,rawshape_ball,rawshape_capsule,rawshape_castRay,rawshape_castRayAndGetNormal,rawshape_castShape,rawshape_cone,rawshape_contactShape,rawshape_containsPoint,rawshape_convexHull,rawshape_convexMesh,rawshape_cuboid,rawshape_cylinder,rawshape_halfspace,rawshape_heightfield,rawshape_intersectsRay,rawshape_intersectsShape,rawshape_polyline,rawshape_projectPoint,rawshape_roundCone,rawshape_roundConvexHull,rawshape_roundConvexMesh,rawshape_roundCuboid,rawshape_roundCylinder,rawshape_roundTriangle,rawshape_segment,rawshape_triangle,rawshape_trimesh,rawshapecasthit_normal1,rawshapecasthit_normal2,rawshapecasthit_time_of_impact,rawshapecasthit_witness1,rawshapecasthit_witness2,rawshapecontact_distance,rawshapecontact_normal1,rawshapecontact_normal2,rawshapecontact_point1,rawshapecontact_point2,rawvector_new,rawvector_set_x,rawvector_set_y,rawvector_set_z,rawvector_x,rawvector_xyz,rawvector_xzy,rawvector_y,rawvector_yxz,rawvector_yzx,rawvector_z,rawvector_zero,rawvector_zxy,rawvector_zyx,version:version$1},Symbol.toStringTag,{value:"Module"}));__wbg_set_wasm(wasm);class Vector3{constructor(er,tr,rr){this.x=er,this.y=tr,this.z=rr}}class VectorOps{static new(er,tr,rr){return new Vector3(er,tr,rr)}static intoRaw(er){return new RawVector(er.x,er.y,er.z)}static zeros(){return VectorOps.new(0,0,0)}static fromRaw(er){if(!er)return null;let tr=VectorOps.new(er.x,er.y,er.z);return er.free(),tr}static copy(er,tr){er.x=tr.x,er.y=tr.y,er.z=tr.z}}class Quaternion{constructor(er,tr,rr,nr){this.x=er,this.y=tr,this.z=rr,this.w=nr}}class RotationOps{static identity(){return new Quaternion(0,0,0,1)}static fromRaw(er){if(!er)return null;let tr=new Quaternion(er.x,er.y,er.z,er.w);return er.free(),tr}static intoRaw(er){return new RawRotation(er.x,er.y,er.z,er.w)}static copy(er,tr){er.x=tr.x,er.y=tr.y,er.z=tr.z,er.w=tr.w}}class SdpMatrix3{constructor(er){this.elements=er}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class SdpMatrix3Ops{static fromRaw(er){const tr=new SdpMatrix3(er.elements());return er.free(),tr}}var RigidBodyType;(function(ir){ir[ir.Dynamic=0]="Dynamic",ir[ir.Fixed=1]="Fixed",ir[ir.KinematicPositionBased=2]="KinematicPositionBased",ir[ir.KinematicVelocityBased=3]="KinematicVelocityBased"})(RigidBodyType||(RigidBodyType={}));class RigidBody{constructor(er,tr,rr){this.rawSet=er,this.colliderSet=tr,this.handle=rr}finalizeDeserialization(er){this.colliderSet=er}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(er,tr){return this.rawSet.rbLockTranslations(this.handle,er,tr)}lockRotations(er,tr){return this.rawSet.rbLockRotations(this.handle,er,tr)}setEnabledTranslations(er,tr,rr,nr){return this.rawSet.rbSetEnabledTranslations(this.handle,er,tr,rr,nr)}restrictTranslations(er,tr,rr,nr){this.setEnabledTranslations(er,tr,rr,nr)}setEnabledRotations(er,tr,rr,nr){return this.rawSet.rbSetEnabledRotations(this.handle,er,tr,rr,nr)}restrictRotations(er,tr,rr,nr){this.setEnabledRotations(er,tr,rr,nr)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(er){this.rawSet.rbSetDominanceGroup(this.handle,er)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(er){this.rawSet.rbSetAdditionalSolverIterations(this.handle,er)}enableCcd(er){this.rawSet.rbEnableCcd(this.handle,er)}setSoftCcdPrediction(er){this.rawSet.rbSetSoftCcdPrediction(this.handle,er)}softCcdPrediction(){return this.rawSet.rbSoftCcdPrediction(this.handle)}translation(){let er=this.rawSet.rbTranslation(this.handle);return VectorOps.fromRaw(er)}rotation(){let er=this.rawSet.rbRotation(this.handle);return RotationOps.fromRaw(er)}nextTranslation(){let er=this.rawSet.rbNextTranslation(this.handle);return VectorOps.fromRaw(er)}nextRotation(){let er=this.rawSet.rbNextRotation(this.handle);return RotationOps.fromRaw(er)}setTranslation(er,tr){this.rawSet.rbSetTranslation(this.handle,er.x,er.y,er.z,tr)}setLinvel(er,tr){let rr=VectorOps.intoRaw(er);this.rawSet.rbSetLinvel(this.handle,rr,tr),rr.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(er,tr){this.rawSet.rbSetGravityScale(this.handle,er,tr)}setRotation(er,tr){this.rawSet.rbSetRotation(this.handle,er.x,er.y,er.z,er.w,tr)}setAngvel(er,tr){let rr=VectorOps.intoRaw(er);this.rawSet.rbSetAngvel(this.handle,rr,tr),rr.free()}setNextKinematicTranslation(er){this.rawSet.rbSetNextKinematicTranslation(this.handle,er.x,er.y,er.z)}setNextKinematicRotation(er){this.rawSet.rbSetNextKinematicRotation(this.handle,er.x,er.y,er.z,er.w)}linvel(){return VectorOps.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return VectorOps.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return VectorOps.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return VectorOps.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return VectorOps.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return VectorOps.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return VectorOps.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return RotationOps.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return SdpMatrix3Ops.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return SdpMatrix3Ops.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(er){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,er))}setEnabled(er){this.rawSet.rbSetEnabled(this.handle,er)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(er,tr){return this.rawSet.rbSetBodyType(this.handle,er,tr)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(er){this.rawSet.rbSetLinearDamping(this.handle,er)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(er,tr){this.rawSet.rbSetAdditionalMass(this.handle,er,tr)}setAdditionalMassProperties(er,tr,rr,nr,sr){let ar=VectorOps.intoRaw(tr),or=VectorOps.intoRaw(rr),lr=RotationOps.intoRaw(nr);this.rawSet.rbSetAdditionalMassProperties(this.handle,er,ar,or,lr,sr),ar.free(),or.free(),lr.free()}setAngularDamping(er){this.rawSet.rbSetAngularDamping(this.handle,er)}resetForces(er){this.rawSet.rbResetForces(this.handle,er)}resetTorques(er){this.rawSet.rbResetTorques(this.handle,er)}addForce(er,tr){const rr=VectorOps.intoRaw(er);this.rawSet.rbAddForce(this.handle,rr,tr),rr.free()}applyImpulse(er,tr){const rr=VectorOps.intoRaw(er);this.rawSet.rbApplyImpulse(this.handle,rr,tr),rr.free()}addTorque(er,tr){const rr=VectorOps.intoRaw(er);this.rawSet.rbAddTorque(this.handle,rr,tr),rr.free()}applyTorqueImpulse(er,tr){const rr=VectorOps.intoRaw(er);this.rawSet.rbApplyTorqueImpulse(this.handle,rr,tr),rr.free()}addForceAtPoint(er,tr,rr){const nr=VectorOps.intoRaw(er),sr=VectorOps.intoRaw(tr);this.rawSet.rbAddForceAtPoint(this.handle,nr,sr,rr),nr.free(),sr.free()}applyImpulseAtPoint(er,tr,rr){const nr=VectorOps.intoRaw(er),sr=VectorOps.intoRaw(tr);this.rawSet.rbApplyImpulseAtPoint(this.handle,nr,sr,rr),nr.free(),sr.free()}userForce(){return VectorOps.fromRaw(this.rawSet.rbUserForce(this.handle))}userTorque(){return VectorOps.fromRaw(this.rawSet.rbUserTorque(this.handle))}}class RigidBodyDesc{constructor(er){this.enabled=!0,this.status=er,this.translation=VectorOps.zeros(),this.rotation=RotationOps.identity(),this.gravityScale=1,this.linvel=VectorOps.zeros(),this.mass=0,this.massOnly=!1,this.centerOfMass=VectorOps.zeros(),this.translationsEnabledX=!0,this.translationsEnabledY=!0,this.angvel=VectorOps.zeros(),this.principalAngularInertia=VectorOps.zeros(),this.angularInertiaLocalFrame=RotationOps.identity(),this.translationsEnabledZ=!0,this.rotationsEnabledX=!0,this.rotationsEnabledY=!0,this.rotationsEnabledZ=!0,this.linearDamping=0,this.angularDamping=0,this.canSleep=!0,this.sleeping=!1,this.ccdEnabled=!1,this.softCcdPrediction=0,this.dominanceGroup=0,this.additionalSolverIterations=0}static dynamic(){return new RigidBodyDesc(RigidBodyType.Dynamic)}static kinematicPositionBased(){return new RigidBodyDesc(RigidBodyType.KinematicPositionBased)}static kinematicVelocityBased(){return new RigidBodyDesc(RigidBodyType.KinematicVelocityBased)}static fixed(){return new RigidBodyDesc(RigidBodyType.Fixed)}static newDynamic(){return new RigidBodyDesc(RigidBodyType.Dynamic)}static newKinematicPositionBased(){return new RigidBodyDesc(RigidBodyType.KinematicPositionBased)}static newKinematicVelocityBased(){return new RigidBodyDesc(RigidBodyType.KinematicVelocityBased)}static newStatic(){return new RigidBodyDesc(RigidBodyType.Fixed)}setDominanceGroup(er){return this.dominanceGroup=er,this}setAdditionalSolverIterations(er){return this.additionalSolverIterations=er,this}setEnabled(er){return this.enabled=er,this}setTranslation(er,tr,rr){if(typeof er!="number"||typeof tr!="number"||typeof rr!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:er,y:tr,z:rr},this}setRotation(er){return RotationOps.copy(this.rotation,er),this}setGravityScale(er){return this.gravityScale=er,this}setAdditionalMass(er){return this.mass=er,this.massOnly=!0,this}setLinvel(er,tr,rr){if(typeof er!="number"||typeof tr!="number"||typeof rr!="number")throw TypeError("The linvel components must be numbers.");return this.linvel={x:er,y:tr,z:rr},this}setAngvel(er){return VectorOps.copy(this.angvel,er),this}setAdditionalMassProperties(er,tr,rr,nr){return this.mass=er,VectorOps.copy(this.centerOfMass,tr),VectorOps.copy(this.principalAngularInertia,rr),RotationOps.copy(this.angularInertiaLocalFrame,nr),this.massOnly=!1,this}enabledTranslations(er,tr,rr){return this.translationsEnabledX=er,this.translationsEnabledY=tr,this.translationsEnabledZ=rr,this}restrictTranslations(er,tr,rr){return this.enabledTranslations(er,tr,rr)}lockTranslations(){return this.enabledTranslations(!1,!1,!1)}enabledRotations(er,tr,rr){return this.rotationsEnabledX=er,this.rotationsEnabledY=tr,this.rotationsEnabledZ=rr,this}restrictRotations(er,tr,rr){return this.enabledRotations(er,tr,rr)}lockRotations(){return this.restrictRotations(!1,!1,!1)}setLinearDamping(er){return this.linearDamping=er,this}setAngularDamping(er){return this.angularDamping=er,this}setCanSleep(er){return this.canSleep=er,this}setSleeping(er){return this.sleeping=er,this}setCcdEnabled(er){return this.ccdEnabled=er,this}setSoftCcdPrediction(er){return this.softCcdPrediction=er,this}setUserData(er){return this.userData=er,this}}class Coarena{constructor(){this.fconv=new Float64Array(1),this.uconv=new Uint32Array(this.fconv.buffer),this.data=new Array,this.size=0}set(er,tr){let rr=this.index(er);for(;this.data.length<=rr;)this.data.push(null);this.data[rr]==null&&(this.size+=1),this.data[rr]=tr}len(){return this.size}delete(er){let tr=this.index(er);tr<this.data.length&&(this.data[tr]!=null&&(this.size-=1),this.data[tr]=null)}clear(){this.data=new Array}get(er){let tr=this.index(er);return tr<this.data.length?this.data[tr]:null}forEach(er){for(const tr of this.data)tr!=null&&er(tr)}getAll(){return this.data.filter(er=>er!=null)}index(er){return this.fconv[0]=er,this.uconv[0]}}class RigidBodySet{constructor(er){this.raw=er||new RawRigidBodySet,this.map=new Coarena,er&&er.forEachRigidBodyHandle(tr=>{this.map.set(tr,new RigidBody(er,null,tr))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(er){this.map.forEach(tr=>tr.finalizeDeserialization(er))}createRigidBody(er,tr){let rr=VectorOps.intoRaw(tr.translation),nr=RotationOps.intoRaw(tr.rotation),sr=VectorOps.intoRaw(tr.linvel),ar=VectorOps.intoRaw(tr.centerOfMass),or=VectorOps.intoRaw(tr.angvel),lr=VectorOps.intoRaw(tr.principalAngularInertia),cr=RotationOps.intoRaw(tr.angularInertiaLocalFrame),hr=this.raw.createRigidBody(tr.enabled,rr,nr,tr.gravityScale,tr.mass,tr.massOnly,ar,sr,or,lr,cr,tr.translationsEnabledX,tr.translationsEnabledY,tr.translationsEnabledZ,tr.rotationsEnabledX,tr.rotationsEnabledY,tr.rotationsEnabledZ,tr.linearDamping,tr.angularDamping,tr.status,tr.canSleep,tr.sleeping,tr.softCcdPrediction,tr.ccdEnabled,tr.dominanceGroup,tr.additionalSolverIterations);rr.free(),nr.free(),sr.free(),ar.free(),or.free(),lr.free(),cr.free();const fr=new RigidBody(this.raw,er,hr);return fr.userData=tr.userData,this.map.set(hr,fr),fr}remove(er,tr,rr,nr,sr){for(let ar=0;ar<this.raw.rbNumColliders(er);ar+=1)rr.unmap(this.raw.rbCollider(er,ar));nr.forEachJointHandleAttachedToRigidBody(er,ar=>nr.unmap(ar)),sr.forEachJointHandleAttachedToRigidBody(er,ar=>sr.unmap(ar)),this.raw.remove(er,tr.raw,rr.raw,nr.raw,sr.raw),this.map.delete(er)}len(){return this.map.len()}contains(er){return this.get(er)!=null}get(er){return this.map.get(er)}forEach(er){this.map.forEach(er)}forEachActiveRigidBody(er,tr){er.forEachActiveRigidBodyHandle(rr=>{tr(this.get(rr))})}getAll(){return this.map.getAll()}}class IntegrationParameters{constructor(er){this.raw=er||new RawIntegrationParameters}free(){this.raw&&this.raw.free(),this.raw=void 0}get dt(){return this.raw.dt}get contact_erp(){return this.raw.contact_erp}get lengthUnit(){return this.raw.lengthUnit}get normalizedAllowedLinearError(){return this.raw.normalizedAllowedLinearError}get normalizedPredictionDistance(){return this.raw.normalizedPredictionDistance}get numSolverIterations(){return this.raw.numSolverIterations}get numAdditionalFrictionIterations(){return this.raw.numAdditionalFrictionIterations}get numInternalPgsIterations(){return this.raw.numInternalPgsIterations}get minIslandSize(){return this.raw.minIslandSize}get maxCcdSubsteps(){return this.raw.maxCcdSubsteps}set dt(er){this.raw.dt=er}set contact_natural_frequency(er){this.raw.contact_natural_frequency=er}set lengthUnit(er){this.raw.lengthUnit=er}set normalizedAllowedLinearError(er){this.raw.normalizedAllowedLinearError=er}set normalizedPredictionDistance(er){this.raw.normalizedPredictionDistance=er}set numSolverIterations(er){this.raw.numSolverIterations=er}set numAdditionalFrictionIterations(er){this.raw.numAdditionalFrictionIterations=er}set numInternalPgsIterations(er){this.raw.numInternalPgsIterations=er}set minIslandSize(er){this.raw.minIslandSize=er}set maxCcdSubsteps(er){this.raw.maxCcdSubsteps=er}switchToStandardPgsSolver(){this.raw.switchToStandardPgsSolver()}switchToSmallStepsPgsSolver(){this.raw.switchToSmallStepsPgsSolver()}switchToSmallStepsPgsSolverWithoutWarmstart(){this.raw.switchToSmallStepsPgsSolverWithoutWarmstart()}}var JointType;(function(ir){ir[ir.Revolute=0]="Revolute",ir[ir.Fixed=1]="Fixed",ir[ir.Prismatic=2]="Prismatic",ir[ir.Rope=3]="Rope",ir[ir.Spring=4]="Spring",ir[ir.Spherical=5]="Spherical",ir[ir.Generic=6]="Generic"})(JointType||(JointType={}));var MotorModel;(function(ir){ir[ir.AccelerationBased=0]="AccelerationBased",ir[ir.ForceBased=1]="ForceBased"})(MotorModel||(MotorModel={}));var JointAxesMask;(function(ir){ir[ir.LinX=1]="LinX",ir[ir.LinY=2]="LinY",ir[ir.LinZ=4]="LinZ",ir[ir.AngX=8]="AngX",ir[ir.AngY=16]="AngY",ir[ir.AngZ=32]="AngZ"})(JointAxesMask||(JointAxesMask={}));class ImpulseJoint{constructor(er,tr,rr){this.rawSet=er,this.bodySet=tr,this.handle=rr}static newTyped(er,tr,rr){switch(er.jointType(rr)){case RawJointType.Revolute:return new RevoluteImpulseJoint(er,tr,rr);case RawJointType.Prismatic:return new PrismaticImpulseJoint(er,tr,rr);case RawJointType.Fixed:return new FixedImpulseJoint(er,tr,rr);case RawJointType.Spring:return new SpringImpulseJoint(er,tr,rr);case RawJointType.Rope:return new RopeImpulseJoint(er,tr,rr);case RawJointType.Spherical:return new SphericalImpulseJoint(er,tr,rr);case RawJointType.Generic:return new GenericImpulseJoint(er,tr,rr);default:return new ImpulseJoint(er,tr,rr)}}finalizeDeserialization(er){this.bodySet=er}isValid(){return this.rawSet.contains(this.handle)}body1(){return this.bodySet.get(this.rawSet.jointBodyHandle1(this.handle))}body2(){return this.bodySet.get(this.rawSet.jointBodyHandle2(this.handle))}type(){return this.rawSet.jointType(this.handle)}frameX1(){return RotationOps.fromRaw(this.rawSet.jointFrameX1(this.handle))}frameX2(){return RotationOps.fromRaw(this.rawSet.jointFrameX2(this.handle))}anchor1(){return VectorOps.fromRaw(this.rawSet.jointAnchor1(this.handle))}anchor2(){return VectorOps.fromRaw(this.rawSet.jointAnchor2(this.handle))}setAnchor1(er){const tr=VectorOps.intoRaw(er);this.rawSet.jointSetAnchor1(this.handle,tr),tr.free()}setAnchor2(er){const tr=VectorOps.intoRaw(er);this.rawSet.jointSetAnchor2(this.handle,tr),tr.free()}setContactsEnabled(er){this.rawSet.jointSetContactsEnabled(this.handle,er)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class UnitImpulseJoint extends ImpulseJoint{limitsEnabled(){return this.rawSet.jointLimitsEnabled(this.handle,this.rawAxis())}limitsMin(){return this.rawSet.jointLimitsMin(this.handle,this.rawAxis())}limitsMax(){return this.rawSet.jointLimitsMax(this.handle,this.rawAxis())}setLimits(er,tr){this.rawSet.jointSetLimits(this.handle,this.rawAxis(),er,tr)}configureMotorModel(er){this.rawSet.jointConfigureMotorModel(this.handle,this.rawAxis(),er)}configureMotorVelocity(er,tr){this.rawSet.jointConfigureMotorVelocity(this.handle,this.rawAxis(),er,tr)}configureMotorPosition(er,tr,rr){this.rawSet.jointConfigureMotorPosition(this.handle,this.rawAxis(),er,tr,rr)}configureMotor(er,tr,rr,nr){this.rawSet.jointConfigureMotor(this.handle,this.rawAxis(),er,tr,rr,nr)}}class FixedImpulseJoint extends ImpulseJoint{}class RopeImpulseJoint extends ImpulseJoint{}class SpringImpulseJoint extends ImpulseJoint{}class PrismaticImpulseJoint extends UnitImpulseJoint{rawAxis(){return RawJointAxis.LinX}}class RevoluteImpulseJoint extends UnitImpulseJoint{rawAxis(){return RawJointAxis.AngX}}class GenericImpulseJoint extends ImpulseJoint{}class SphericalImpulseJoint extends ImpulseJoint{}class JointData{constructor(){}static fixed(er,tr,rr,nr){let sr=new JointData;return sr.anchor1=er,sr.anchor2=rr,sr.frame1=tr,sr.frame2=nr,sr.jointType=JointType.Fixed,sr}static spring(er,tr,rr,nr,sr){let ar=new JointData;return ar.anchor1=nr,ar.anchor2=sr,ar.length=er,ar.stiffness=tr,ar.damping=rr,ar.jointType=JointType.Spring,ar}static rope(er,tr,rr){let nr=new JointData;return nr.anchor1=tr,nr.anchor2=rr,nr.length=er,nr.jointType=JointType.Rope,nr}static generic(er,tr,rr,nr){let sr=new JointData;return sr.anchor1=er,sr.anchor2=tr,sr.axis=rr,sr.axesMask=nr,sr.jointType=JointType.Generic,sr}static spherical(er,tr){let rr=new JointData;return rr.anchor1=er,rr.anchor2=tr,rr.jointType=JointType.Spherical,rr}static prismatic(er,tr,rr){let nr=new JointData;return nr.anchor1=er,nr.anchor2=tr,nr.axis=rr,nr.jointType=JointType.Prismatic,nr}static revolute(er,tr,rr){let nr=new JointData;return nr.anchor1=er,nr.anchor2=tr,nr.axis=rr,nr.jointType=JointType.Revolute,nr}intoRaw(){let er=VectorOps.intoRaw(this.anchor1),tr=VectorOps.intoRaw(this.anchor2),rr,nr,sr=!1,ar=0,or=0;switch(this.jointType){case JointType.Fixed:let lr=RotationOps.intoRaw(this.frame1),cr=RotationOps.intoRaw(this.frame2);nr=RawGenericJoint.fixed(er,lr,tr,cr),lr.free(),cr.free();break;case JointType.Spring:nr=RawGenericJoint.spring(this.length,this.stiffness,this.damping,er,tr);break;case JointType.Rope:nr=RawGenericJoint.rope(this.length,er,tr);break;case JointType.Prismatic:rr=VectorOps.intoRaw(this.axis),this.limitsEnabled&&(sr=!0,ar=this.limits[0],or=this.limits[1]),nr=RawGenericJoint.prismatic(er,tr,rr,sr,ar,or),rr.free();break;case JointType.Generic:rr=VectorOps.intoRaw(this.axis);let hr=this.axesMask;nr=RawGenericJoint.generic(er,tr,rr,hr);break;case JointType.Spherical:nr=RawGenericJoint.spherical(er,tr);break;case JointType.Revolute:rr=VectorOps.intoRaw(this.axis),nr=RawGenericJoint.revolute(er,tr,rr),rr.free();break}return er.free(),tr.free(),nr}}class ImpulseJointSet{constructor(er){this.raw=er||new RawImpulseJointSet,this.map=new Coarena,er&&er.forEachJointHandle(tr=>{this.map.set(tr,ImpulseJoint.newTyped(er,null,tr))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(er){this.map.forEach(tr=>tr.finalizeDeserialization(er))}createJoint(er,tr,rr,nr,sr){const ar=tr.intoRaw(),or=this.raw.createJoint(ar,rr,nr,sr);ar.free();let lr=ImpulseJoint.newTyped(this.raw,er,or);return this.map.set(or,lr),lr}remove(er,tr){this.raw.remove(er,tr),this.unmap(er)}forEachJointHandleAttachedToRigidBody(er,tr){this.raw.forEachJointAttachedToRigidBody(er,tr)}unmap(er){this.map.delete(er)}len(){return this.map.len()}contains(er){return this.get(er)!=null}get(er){return this.map.get(er)}forEach(er){this.map.forEach(er)}getAll(){return this.map.getAll()}}class MultibodyJoint{constructor(er,tr){this.rawSet=er,this.handle=tr}static newTyped(er,tr){switch(er.jointType(tr)){case RawJointType.Revolute:return new RevoluteMultibodyJoint(er,tr);case RawJointType.Prismatic:return new PrismaticMultibodyJoint(er,tr);case RawJointType.Fixed:return new FixedMultibodyJoint(er,tr);case RawJointType.Spherical:return new SphericalMultibodyJoint(er,tr);default:return new MultibodyJoint(er,tr)}}isValid(){return this.rawSet.contains(this.handle)}setContactsEnabled(er){this.rawSet.jointSetContactsEnabled(this.handle,er)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class UnitMultibodyJoint extends MultibodyJoint{}class FixedMultibodyJoint extends MultibodyJoint{}class PrismaticMultibodyJoint extends UnitMultibodyJoint{rawAxis(){return RawJointAxis.LinX}}class RevoluteMultibodyJoint extends UnitMultibodyJoint{rawAxis(){return RawJointAxis.AngX}}class SphericalMultibodyJoint extends MultibodyJoint{}class MultibodyJointSet{constructor(er){this.raw=er||new RawMultibodyJointSet,this.map=new Coarena,er&&er.forEachJointHandle(tr=>{this.map.set(tr,MultibodyJoint.newTyped(this.raw,tr))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}createJoint(er,tr,rr,nr){const sr=er.intoRaw(),ar=this.raw.createJoint(sr,tr,rr,nr);sr.free();let or=MultibodyJoint.newTyped(this.raw,ar);return this.map.set(ar,or),or}remove(er,tr){this.raw.remove(er,tr),this.map.delete(er)}unmap(er){this.map.delete(er)}len(){return this.map.len()}contains(er){return this.get(er)!=null}get(er){return this.map.get(er)}forEach(er){this.map.forEach(er)}forEachJointHandleAttachedToRigidBody(er,tr){this.raw.forEachJointAttachedToRigidBody(er,tr)}getAll(){return this.map.getAll()}}var CoefficientCombineRule;(function(ir){ir[ir.Average=0]="Average",ir[ir.Min=1]="Min",ir[ir.Multiply=2]="Multiply",ir[ir.Max=3]="Max"})(CoefficientCombineRule||(CoefficientCombineRule={}));class CCDSolver{constructor(er){this.raw=er||new RawCCDSolver}free(){this.raw&&this.raw.free(),this.raw=void 0}}class IslandManager{constructor(er){this.raw=er||new RawIslandManager}free(){this.raw&&this.raw.free(),this.raw=void 0}forEachActiveRigidBodyHandle(er){this.raw.forEachActiveRigidBodyHandle(er)}}class BroadPhase{constructor(er){this.raw=er||new RawBroadPhase}free(){this.raw&&this.raw.free(),this.raw=void 0}}class NarrowPhase{constructor(er){this.raw=er||new RawNarrowPhase,this.tempManifold=new TempContactManifold(null)}free(){this.raw&&this.raw.free(),this.raw=void 0}contactPairsWith(er,tr){this.raw.contact_pairs_with(er,tr)}intersectionPairsWith(er,tr){this.raw.intersection_pairs_with(er,tr)}contactPair(er,tr,rr){const nr=this.raw.contact_pair(er,tr);if(nr){const sr=nr.collider1()!=er;let ar;for(ar=0;ar<nr.numContactManifolds();++ar)this.tempManifold.raw=nr.contactManifold(ar),this.tempManifold.raw&&rr(this.tempManifold,sr),this.tempManifold.free();nr.free()}}intersectionPair(er,tr){return this.raw.intersection_pair(er,tr)}}class TempContactManifold{constructor(er){this.raw=er}free(){this.raw&&this.raw.free(),this.raw=void 0}normal(){return VectorOps.fromRaw(this.raw.normal())}localNormal1(){return VectorOps.fromRaw(this.raw.local_n1())}localNormal2(){return VectorOps.fromRaw(this.raw.local_n2())}subshape1(){return this.raw.subshape1()}subshape2(){return this.raw.subshape2()}numContacts(){return this.raw.num_contacts()}localContactPoint1(er){return VectorOps.fromRaw(this.raw.contact_local_p1(er))}localContactPoint2(er){return VectorOps.fromRaw(this.raw.contact_local_p2(er))}contactDist(er){return this.raw.contact_dist(er)}contactFid1(er){return this.raw.contact_fid1(er)}contactFid2(er){return this.raw.contact_fid2(er)}contactImpulse(er){return this.raw.contact_impulse(er)}contactTangentImpulseX(er){return this.raw.contact_tangent_impulse_x(er)}contactTangentImpulseY(er){return this.raw.contact_tangent_impulse_y(er)}numSolverContacts(){return this.raw.num_solver_contacts()}solverContactPoint(er){return VectorOps.fromRaw(this.raw.solver_contact_point(er))}solverContactDist(er){return this.raw.solver_contact_dist(er)}solverContactFriction(er){return this.raw.solver_contact_friction(er)}solverContactRestitution(er){return this.raw.solver_contact_restitution(er)}solverContactTangentVelocity(er){return VectorOps.fromRaw(this.raw.solver_contact_tangent_velocity(er))}}class ShapeContact{constructor(er,tr,rr,nr,sr){this.distance=er,this.point1=tr,this.point2=rr,this.normal1=nr,this.normal2=sr}static fromRaw(er){if(!er)return null;const tr=new ShapeContact(er.distance(),VectorOps.fromRaw(er.point1()),VectorOps.fromRaw(er.point2()),VectorOps.fromRaw(er.normal1()),VectorOps.fromRaw(er.normal2()));return er.free(),tr}}var FeatureType;(function(ir){ir[ir.Vertex=0]="Vertex",ir[ir.Edge=1]="Edge",ir[ir.Face=2]="Face",ir[ir.Unknown=3]="Unknown"})(FeatureType||(FeatureType={}));class PointProjection{constructor(er,tr){this.point=er,this.isInside=tr}static fromRaw(er){if(!er)return null;const tr=new PointProjection(VectorOps.fromRaw(er.point()),er.isInside());return er.free(),tr}}class PointColliderProjection{constructor(er,tr,rr,nr,sr){this.featureType=FeatureType.Unknown,this.featureId=void 0,this.collider=er,this.point=tr,this.isInside=rr,sr!==void 0&&(this.featureId=sr),nr!==void 0&&(this.featureType=nr)}static fromRaw(er,tr){if(!tr)return null;const rr=new PointColliderProjection(er.get(tr.colliderHandle()),VectorOps.fromRaw(tr.point()),tr.isInside(),tr.featureType(),tr.featureId());return tr.free(),rr}}class Ray{constructor(er,tr){this.origin=er,this.dir=tr}pointAt(er){return{x:this.origin.x+this.dir.x*er,y:this.origin.y+this.dir.y*er,z:this.origin.z+this.dir.z*er}}}class RayIntersection{constructor(er,tr,rr,nr){this.featureType=FeatureType.Unknown,this.featureId=void 0,this.timeOfImpact=er,this.normal=tr,nr!==void 0&&(this.featureId=nr),rr!==void 0&&(this.featureType=rr)}static fromRaw(er){if(!er)return null;const tr=new RayIntersection(er.time_of_impact(),VectorOps.fromRaw(er.normal()),er.featureType(),er.featureId());return er.free(),tr}}class RayColliderIntersection{constructor(er,tr,rr,nr,sr){this.featureType=FeatureType.Unknown,this.featureId=void 0,this.collider=er,this.timeOfImpact=tr,this.normal=rr,sr!==void 0&&(this.featureId=sr),nr!==void 0&&(this.featureType=nr)}static fromRaw(er,tr){if(!tr)return null;const rr=new RayColliderIntersection(er.get(tr.colliderHandle()),tr.time_of_impact(),VectorOps.fromRaw(tr.normal()),tr.featureType(),tr.featureId());return tr.free(),rr}}class RayColliderHit{constructor(er,tr){this.collider=er,this.timeOfImpact=tr}static fromRaw(er,tr){if(!tr)return null;const rr=new RayColliderHit(er.get(tr.colliderHandle()),tr.timeOfImpact());return tr.free(),rr}}class ShapeCastHit{constructor(er,tr,rr,nr,sr){this.time_of_impact=er,this.witness1=tr,this.witness2=rr,this.normal1=nr,this.normal2=sr}static fromRaw(er,tr){if(!tr)return null;const rr=new ShapeCastHit(tr.time_of_impact(),VectorOps.fromRaw(tr.witness1()),VectorOps.fromRaw(tr.witness2()),VectorOps.fromRaw(tr.normal1()),VectorOps.fromRaw(tr.normal2()));return tr.free(),rr}}class ColliderShapeCastHit extends ShapeCastHit{constructor(er,tr,rr,nr,sr,ar){super(tr,rr,nr,sr,ar),this.collider=er}static fromRaw(er,tr){if(!tr)return null;const rr=new ColliderShapeCastHit(er.get(tr.colliderHandle()),tr.time_of_impact(),VectorOps.fromRaw(tr.witness1()),VectorOps.fromRaw(tr.witness2()),VectorOps.fromRaw(tr.normal1()),VectorOps.fromRaw(tr.normal2()));return tr.free(),rr}}class Shape{static fromRaw(er,tr){const rr=er.coShapeType(tr);let nr,sr,ar,or,lr,cr,hr;switch(rr){case RawShapeType.Ball:return new Ball(er.coRadius(tr));case RawShapeType.Cuboid:return nr=er.coHalfExtents(tr),new Cuboid(nr.x,nr.y,nr.z);case RawShapeType.RoundCuboid:return nr=er.coHalfExtents(tr),sr=er.coRoundRadius(tr),new RoundCuboid(nr.x,nr.y,nr.z,sr);case RawShapeType.Capsule:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),new Capsule$1(lr,cr);case RawShapeType.Segment:return ar=er.coVertices(tr),new Segment(VectorOps.new(ar[0],ar[1],ar[2]),VectorOps.new(ar[3],ar[4],ar[5]));case RawShapeType.Polyline:return ar=er.coVertices(tr),or=er.coIndices(tr),new Polyline(ar,or);case RawShapeType.Triangle:return ar=er.coVertices(tr),new Triangle$1(VectorOps.new(ar[0],ar[1],ar[2]),VectorOps.new(ar[3],ar[4],ar[5]),VectorOps.new(ar[6],ar[7],ar[8]));case RawShapeType.RoundTriangle:return ar=er.coVertices(tr),sr=er.coRoundRadius(tr),new RoundTriangle(VectorOps.new(ar[0],ar[1],ar[2]),VectorOps.new(ar[3],ar[4],ar[5]),VectorOps.new(ar[6],ar[7],ar[8]),sr);case RawShapeType.HalfSpace:return hr=VectorOps.fromRaw(er.coHalfspaceNormal(tr)),new HalfSpace(hr);case RawShapeType.TriMesh:ar=er.coVertices(tr),or=er.coIndices(tr);const fr=er.coTriMeshFlags(tr);return new TriMesh(ar,or,fr);case RawShapeType.HeightField:const ur=er.coHeightfieldScale(tr),pr=er.coHeightfieldHeights(tr),gr=er.coHeightfieldNRows(tr),_r=er.coHeightfieldNCols(tr),mr=er.coHeightFieldFlags(tr);return new Heightfield(gr,_r,pr,ur,mr);case RawShapeType.ConvexPolyhedron:return ar=er.coVertices(tr),or=er.coIndices(tr),new ConvexPolyhedron(ar,or);case RawShapeType.RoundConvexPolyhedron:return ar=er.coVertices(tr),or=er.coIndices(tr),sr=er.coRoundRadius(tr),new RoundConvexPolyhedron(ar,or,sr);case RawShapeType.Cylinder:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),new Cylinder(lr,cr);case RawShapeType.RoundCylinder:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),sr=er.coRoundRadius(tr),new RoundCylinder(lr,cr,sr);case RawShapeType.Cone:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),new Cone(lr,cr);case RawShapeType.RoundCone:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),sr=er.coRoundRadius(tr),new RoundCone(lr,cr,sr);default:throw new Error("unknown shape type: "+rr)}}castShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr){let fr=VectorOps.intoRaw(er),ur=RotationOps.intoRaw(tr),pr=VectorOps.intoRaw(rr),gr=VectorOps.intoRaw(sr),_r=RotationOps.intoRaw(ar),mr=VectorOps.intoRaw(or),dr=this.intoRaw(),vr=nr.intoRaw(),Ar=ShapeCastHit.fromRaw(null,dr.castShape(fr,ur,pr,vr,gr,_r,mr,lr,cr,hr));return fr.free(),ur.free(),pr.free(),gr.free(),_r.free(),mr.free(),dr.free(),vr.free(),Ar}intersectsShape(er,tr,rr,nr,sr){let ar=VectorOps.intoRaw(er),or=RotationOps.intoRaw(tr),lr=VectorOps.intoRaw(nr),cr=RotationOps.intoRaw(sr),hr=this.intoRaw(),fr=rr.intoRaw(),ur=hr.intersectsShape(ar,or,fr,lr,cr);return ar.free(),or.free(),lr.free(),cr.free(),hr.free(),fr.free(),ur}contactShape(er,tr,rr,nr,sr,ar){let or=VectorOps.intoRaw(er),lr=RotationOps.intoRaw(tr),cr=VectorOps.intoRaw(nr),hr=RotationOps.intoRaw(sr),fr=this.intoRaw(),ur=rr.intoRaw(),pr=ShapeContact.fromRaw(fr.contactShape(or,lr,ur,cr,hr,ar));return or.free(),lr.free(),cr.free(),hr.free(),fr.free(),ur.free(),pr}containsPoint(er,tr,rr){let nr=VectorOps.intoRaw(er),sr=RotationOps.intoRaw(tr),ar=VectorOps.intoRaw(rr),or=this.intoRaw(),lr=or.containsPoint(nr,sr,ar);return nr.free(),sr.free(),ar.free(),or.free(),lr}projectPoint(er,tr,rr,nr){let sr=VectorOps.intoRaw(er),ar=RotationOps.intoRaw(tr),or=VectorOps.intoRaw(rr),lr=this.intoRaw(),cr=PointProjection.fromRaw(lr.projectPoint(sr,ar,or,nr));return sr.free(),ar.free(),or.free(),lr.free(),cr}intersectsRay(er,tr,rr,nr){let sr=VectorOps.intoRaw(tr),ar=RotationOps.intoRaw(rr),or=VectorOps.intoRaw(er.origin),lr=VectorOps.intoRaw(er.dir),cr=this.intoRaw(),hr=cr.intersectsRay(sr,ar,or,lr,nr);return sr.free(),ar.free(),or.free(),lr.free(),cr.free(),hr}castRay(er,tr,rr,nr,sr){let ar=VectorOps.intoRaw(tr),or=RotationOps.intoRaw(rr),lr=VectorOps.intoRaw(er.origin),cr=VectorOps.intoRaw(er.dir),hr=this.intoRaw(),fr=hr.castRay(ar,or,lr,cr,nr,sr);return ar.free(),or.free(),lr.free(),cr.free(),hr.free(),fr}castRayAndGetNormal(er,tr,rr,nr,sr){let ar=VectorOps.intoRaw(tr),or=RotationOps.intoRaw(rr),lr=VectorOps.intoRaw(er.origin),cr=VectorOps.intoRaw(er.dir),hr=this.intoRaw(),fr=RayIntersection.fromRaw(hr.castRayAndGetNormal(ar,or,lr,cr,nr,sr));return ar.free(),or.free(),lr.free(),cr.free(),hr.free(),fr}}var ShapeType;(function(ir){ir[ir.Ball=0]="Ball",ir[ir.Cuboid=1]="Cuboid",ir[ir.Capsule=2]="Capsule",ir[ir.Segment=3]="Segment",ir[ir.Polyline=4]="Polyline",ir[ir.Triangle=5]="Triangle",ir[ir.TriMesh=6]="TriMesh",ir[ir.HeightField=7]="HeightField",ir[ir.ConvexPolyhedron=9]="ConvexPolyhedron",ir[ir.Cylinder=10]="Cylinder",ir[ir.Cone=11]="Cone",ir[ir.RoundCuboid=12]="RoundCuboid",ir[ir.RoundTriangle=13]="RoundTriangle",ir[ir.RoundCylinder=14]="RoundCylinder",ir[ir.RoundCone=15]="RoundCone",ir[ir.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",ir[ir.HalfSpace=17]="HalfSpace"})(ShapeType||(ShapeType={}));var HeightFieldFlags;(function(ir){ir[ir.FIX_INTERNAL_EDGES=1]="FIX_INTERNAL_EDGES"})(HeightFieldFlags||(HeightFieldFlags={}));var TriMeshFlags;(function(ir){ir[ir.DELETE_BAD_TOPOLOGY_TRIANGLES=4]="DELETE_BAD_TOPOLOGY_TRIANGLES",ir[ir.ORIENTED=8]="ORIENTED",ir[ir.MERGE_DUPLICATE_VERTICES=16]="MERGE_DUPLICATE_VERTICES",ir[ir.DELETE_DEGENERATE_TRIANGLES=32]="DELETE_DEGENERATE_TRIANGLES",ir[ir.DELETE_DUPLICATE_TRIANGLES=64]="DELETE_DUPLICATE_TRIANGLES",ir[ir.FIX_INTERNAL_EDGES=152]="FIX_INTERNAL_EDGES"})(TriMeshFlags||(TriMeshFlags={}));class Ball extends Shape{constructor(er){super(),this.type=ShapeType.Ball,this.radius=er}intoRaw(){return RawShape.ball(this.radius)}}class HalfSpace extends Shape{constructor(er){super(),this.type=ShapeType.HalfSpace,this.normal=er}intoRaw(){let er=VectorOps.intoRaw(this.normal),tr=RawShape.halfspace(er);return er.free(),tr}}class Cuboid extends Shape{constructor(er,tr,rr){super(),this.type=ShapeType.Cuboid,this.halfExtents=VectorOps.new(er,tr,rr)}intoRaw(){return RawShape.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class RoundCuboid extends Shape{constructor(er,tr,rr,nr){super(),this.type=ShapeType.RoundCuboid,this.halfExtents=VectorOps.new(er,tr,rr),this.borderRadius=nr}intoRaw(){return RawShape.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}let Capsule$1=class extends Shape{constructor(er,tr){super(),this.type=ShapeType.Capsule,this.halfHeight=er,this.radius=tr}intoRaw(){return RawShape.capsule(this.halfHeight,this.radius)}};class Segment extends Shape{constructor(er,tr){super(),this.type=ShapeType.Segment,this.a=er,this.b=tr}intoRaw(){let er=VectorOps.intoRaw(this.a),tr=VectorOps.intoRaw(this.b),rr=RawShape.segment(er,tr);return er.free(),tr.free(),rr}}let Triangle$1=class extends Shape{constructor(er,tr,rr){super(),this.type=ShapeType.Triangle,this.a=er,this.b=tr,this.c=rr}intoRaw(){let er=VectorOps.intoRaw(this.a),tr=VectorOps.intoRaw(this.b),rr=VectorOps.intoRaw(this.c),nr=RawShape.triangle(er,tr,rr);return er.free(),tr.free(),rr.free(),nr}};class RoundTriangle extends Shape{constructor(er,tr,rr,nr){super(),this.type=ShapeType.RoundTriangle,this.a=er,this.b=tr,this.c=rr,this.borderRadius=nr}intoRaw(){let er=VectorOps.intoRaw(this.a),tr=VectorOps.intoRaw(this.b),rr=VectorOps.intoRaw(this.c),nr=RawShape.roundTriangle(er,tr,rr,this.borderRadius);return er.free(),tr.free(),rr.free(),nr}}class Polyline extends Shape{constructor(er,tr){super(),this.type=ShapeType.Polyline,this.vertices=er,this.indices=tr??new Uint32Array(0)}intoRaw(){return RawShape.polyline(this.vertices,this.indices)}}class TriMesh extends Shape{constructor(er,tr,rr){super(),this.type=ShapeType.TriMesh,this.vertices=er,this.indices=tr,this.flags=rr}intoRaw(){return RawShape.trimesh(this.vertices,this.indices,this.flags)}}class ConvexPolyhedron extends Shape{constructor(er,tr){super(),this.type=ShapeType.ConvexPolyhedron,this.vertices=er,this.indices=tr}intoRaw(){return this.indices?RawShape.convexMesh(this.vertices,this.indices):RawShape.convexHull(this.vertices)}}class RoundConvexPolyhedron extends Shape{constructor(er,tr,rr){super(),this.type=ShapeType.RoundConvexPolyhedron,this.vertices=er,this.indices=tr,this.borderRadius=rr}intoRaw(){return this.indices?RawShape.roundConvexMesh(this.vertices,this.indices,this.borderRadius):RawShape.roundConvexHull(this.vertices,this.borderRadius)}}class Heightfield extends Shape{constructor(er,tr,rr,nr,sr){super(),this.type=ShapeType.HeightField,this.nrows=er,this.ncols=tr,this.heights=rr,this.scale=nr,this.flags=sr}intoRaw(){let er=VectorOps.intoRaw(this.scale),tr=RawShape.heightfield(this.nrows,this.ncols,this.heights,er,this.flags);return er.free(),tr}}class Cylinder extends Shape{constructor(er,tr){super(),this.type=ShapeType.Cylinder,this.halfHeight=er,this.radius=tr}intoRaw(){return RawShape.cylinder(this.halfHeight,this.radius)}}class RoundCylinder extends Shape{constructor(er,tr,rr){super(),this.type=ShapeType.RoundCylinder,this.borderRadius=rr,this.halfHeight=er,this.radius=tr}intoRaw(){return RawShape.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class Cone extends Shape{constructor(er,tr){super(),this.type=ShapeType.Cone,this.halfHeight=er,this.radius=tr}intoRaw(){return RawShape.cone(this.halfHeight,this.radius)}}class RoundCone extends Shape{constructor(er,tr,rr){super(),this.type=ShapeType.RoundCone,this.halfHeight=er,this.radius=tr,this.borderRadius=rr}intoRaw(){return RawShape.roundCone(this.halfHeight,this.radius,this.borderRadius)}}class PhysicsPipeline{constructor(er){this.raw=er||new RawPhysicsPipeline}free(){this.raw&&this.raw.free(),this.raw=void 0}step(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur){let pr=VectorOps.intoRaw(er);fr?this.raw.stepWithEvents(pr,tr.raw,rr.raw,nr.raw,sr.raw,ar.raw,or.raw,lr.raw,cr.raw,hr.raw,fr.raw,ur,ur?ur.filterContactPair:null,ur?ur.filterIntersectionPair:null):this.raw.step(pr,tr.raw,rr.raw,nr.raw,sr.raw,ar.raw,or.raw,lr.raw,cr.raw,hr.raw),pr.free()}}var QueryFilterFlags;(function(ir){ir[ir.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",ir[ir.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",ir[ir.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",ir[ir.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",ir[ir.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",ir[ir.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",ir[ir.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",ir[ir.ONLY_FIXED=6]="ONLY_FIXED"})(QueryFilterFlags||(QueryFilterFlags={}));class QueryPipeline{constructor(er){this.raw=er||new RawQueryPipeline}free(){this.raw&&this.raw.free(),this.raw=void 0}update(er){this.raw.update(er.raw)}castRay(er,tr,rr,nr,sr,ar,or,lr,cr,hr){let fr=VectorOps.intoRaw(rr.origin),ur=VectorOps.intoRaw(rr.dir),pr=RayColliderHit.fromRaw(tr,this.raw.castRay(er.raw,tr.raw,fr,ur,nr,sr,ar,or,lr,cr,hr));return fr.free(),ur.free(),pr}castRayAndGetNormal(er,tr,rr,nr,sr,ar,or,lr,cr,hr){let fr=VectorOps.intoRaw(rr.origin),ur=VectorOps.intoRaw(rr.dir),pr=RayColliderIntersection.fromRaw(tr,this.raw.castRayAndGetNormal(er.raw,tr.raw,fr,ur,nr,sr,ar,or,lr,cr,hr));return fr.free(),ur.free(),pr}intersectionsWithRay(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr){let ur=VectorOps.intoRaw(rr.origin),pr=VectorOps.intoRaw(rr.dir),gr=_r=>ar(RayColliderIntersection.fromRaw(tr,_r));this.raw.intersectionsWithRay(er.raw,tr.raw,ur,pr,nr,sr,gr,or,lr,cr,hr,fr),ur.free(),pr.free()}intersectionWithShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr){let fr=VectorOps.intoRaw(rr),ur=RotationOps.intoRaw(nr),pr=sr.intoRaw(),gr=this.raw.intersectionWithShape(er.raw,tr.raw,fr,ur,pr,ar,or,lr,cr,hr);return fr.free(),ur.free(),pr.free(),gr}projectPoint(er,tr,rr,nr,sr,ar,or,lr,cr){let hr=VectorOps.intoRaw(rr),fr=PointColliderProjection.fromRaw(tr,this.raw.projectPoint(er.raw,tr.raw,hr,nr,sr,ar,or,lr,cr));return hr.free(),fr}projectPointAndGetFeature(er,tr,rr,nr,sr,ar,or,lr){let cr=VectorOps.intoRaw(rr),hr=PointColliderProjection.fromRaw(tr,this.raw.projectPointAndGetFeature(er.raw,tr.raw,cr,nr,sr,ar,or,lr));return cr.free(),hr}intersectionsWithPoint(er,tr,rr,nr,sr,ar,or,lr,cr){let hr=VectorOps.intoRaw(rr);this.raw.intersectionsWithPoint(er.raw,tr.raw,hr,nr,sr,ar,or,lr,cr),hr.free()}castShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr){let _r=VectorOps.intoRaw(rr),mr=RotationOps.intoRaw(nr),dr=VectorOps.intoRaw(sr),vr=ar.intoRaw(),Ar=ColliderShapeCastHit.fromRaw(tr,this.raw.castShape(er.raw,tr.raw,_r,mr,dr,vr,or,lr,cr,hr,fr,ur,pr,gr));return _r.free(),mr.free(),dr.free(),vr.free(),Ar}intersectionsWithShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr){let ur=VectorOps.intoRaw(rr),pr=RotationOps.intoRaw(nr),gr=sr.intoRaw();this.raw.intersectionsWithShape(er.raw,tr.raw,ur,pr,gr,ar,or,lr,cr,hr,fr),ur.free(),pr.free(),gr.free()}collidersWithAabbIntersectingAabb(er,tr,rr){let nr=VectorOps.intoRaw(er),sr=VectorOps.intoRaw(tr);this.raw.collidersWithAabbIntersectingAabb(nr,sr,rr),nr.free(),sr.free()}}class SerializationPipeline{constructor(er){this.raw=er||new RawSerializationPipeline}free(){this.raw&&this.raw.free(),this.raw=void 0}serializeAll(er,tr,rr,nr,sr,ar,or,lr,cr){let hr=VectorOps.intoRaw(er);const fr=this.raw.serializeAll(hr,tr.raw,rr.raw,nr.raw,sr.raw,ar.raw,or.raw,lr.raw,cr.raw);return hr.free(),fr}deserializeAll(er){return World.fromRaw(this.raw.deserializeAll(er))}}class DebugRenderBuffers{constructor(er,tr){this.vertices=er,this.colors=tr}}class DebugRenderPipeline{constructor(er){this.raw=er||new RawDebugRenderPipeline}free(){this.raw&&this.raw.free(),this.raw=void 0,this.vertices=void 0,this.colors=void 0}render(er,tr,rr,nr,sr){this.raw.render(er.raw,tr.raw,rr.raw,nr.raw,sr.raw),this.vertices=this.raw.vertices(),this.colors=this.raw.colors()}}class CharacterCollision{}class KinematicCharacterController{constructor(er,tr,rr,nr,sr){this.params=tr,this.bodies=rr,this.colliders=nr,this.queries=sr,this.raw=new RawKinematicCharacterController(er),this.rawCharacterCollision=new RawCharacterCollision,this._applyImpulsesToDynamicBodies=!1,this._characterMass=null}free(){this.raw&&(this.raw.free(),this.rawCharacterCollision.free()),this.raw=void 0,this.rawCharacterCollision=void 0}up(){return this.raw.up()}setUp(er){let tr=VectorOps.intoRaw(er);return this.raw.setUp(tr)}applyImpulsesToDynamicBodies(){return this._applyImpulsesToDynamicBodies}setApplyImpulsesToDynamicBodies(er){this._applyImpulsesToDynamicBodies=er}characterMass(){return this._characterMass}setCharacterMass(er){this._characterMass=er}offset(){return this.raw.offset()}setOffset(er){this.raw.setOffset(er)}normalNudgeFactor(){return this.raw.normalNudgeFactor()}setNormalNudgeFactor(er){this.raw.setNormalNudgeFactor(er)}slideEnabled(){return this.raw.slideEnabled()}setSlideEnabled(er){this.raw.setSlideEnabled(er)}autostepMaxHeight(){return this.raw.autostepMaxHeight()}autostepMinWidth(){return this.raw.autostepMinWidth()}autostepIncludesDynamicBodies(){return this.raw.autostepIncludesDynamicBodies()}autostepEnabled(){return this.raw.autostepEnabled()}enableAutostep(er,tr,rr){this.raw.enableAutostep(er,tr,rr)}disableAutostep(){return this.raw.disableAutostep()}maxSlopeClimbAngle(){return this.raw.maxSlopeClimbAngle()}setMaxSlopeClimbAngle(er){this.raw.setMaxSlopeClimbAngle(er)}minSlopeSlideAngle(){return this.raw.minSlopeSlideAngle()}setMinSlopeSlideAngle(er){this.raw.setMinSlopeSlideAngle(er)}snapToGroundDistance(){return this.raw.snapToGroundDistance()}enableSnapToGround(er){this.raw.enableSnapToGround(er)}disableSnapToGround(){this.raw.disableSnapToGround()}snapToGroundEnabled(){return this.raw.snapToGroundEnabled()}computeColliderMovement(er,tr,rr,nr,sr){let ar=VectorOps.intoRaw(tr);this.raw.computeColliderMovement(this.params.dt,this.bodies.raw,this.colliders.raw,this.queries.raw,er.handle,ar,this._applyImpulsesToDynamicBodies,this._characterMass,rr,nr,this.colliders.castClosure(sr)),ar.free()}computedMovement(){return VectorOps.fromRaw(this.raw.computedMovement())}computedGrounded(){return this.raw.computedGrounded()}numComputedCollisions(){return this.raw.numComputedCollisions()}computedCollision(er,tr){if(this.raw.computedCollision(er,this.rawCharacterCollision)){let rr=this.rawCharacterCollision;return tr=tr??new CharacterCollision,tr.translationDeltaApplied=VectorOps.fromRaw(rr.translationDeltaApplied()),tr.translationDeltaRemaining=VectorOps.fromRaw(rr.translationDeltaRemaining()),tr.toi=rr.toi(),tr.witness1=VectorOps.fromRaw(rr.worldWitness1()),tr.witness2=VectorOps.fromRaw(rr.worldWitness2()),tr.normal1=VectorOps.fromRaw(rr.worldNormal1()),tr.normal2=VectorOps.fromRaw(rr.worldNormal2()),tr.collider=this.colliders.get(rr.handle()),tr}else return null}}class DynamicRayCastVehicleController{constructor(er,tr,rr,nr){this.raw=new RawDynamicRayCastVehicleController(er.handle),this.bodies=tr,this.colliders=rr,this.queries=nr,this._chassis=er}free(){this.raw&&this.raw.free(),this.raw=void 0}updateVehicle(er,tr,rr,nr){this.raw.update_vehicle(er,this.bodies.raw,this.colliders.raw,this.queries.raw,tr,rr,this.colliders.castClosure(nr))}currentVehicleSpeed(){return this.raw.current_vehicle_speed()}chassis(){return this._chassis}get indexUpAxis(){return this.raw.index_up_axis()}set indexUpAxis(er){this.raw.set_index_up_axis(er)}get indexForwardAxis(){return this.raw.index_forward_axis()}set setIndexForwardAxis(er){this.raw.set_index_forward_axis(er)}addWheel(er,tr,rr,nr,sr){let ar=VectorOps.intoRaw(er),or=VectorOps.intoRaw(tr),lr=VectorOps.intoRaw(rr);this.raw.add_wheel(ar,or,lr,nr,sr),ar.free(),or.free(),lr.free()}numWheels(){return this.raw.num_wheels()}wheelChassisConnectionPointCs(er){return VectorOps.fromRaw(this.raw.wheel_chassis_connection_point_cs(er))}setWheelChassisConnectionPointCs(er,tr){let rr=VectorOps.intoRaw(tr);this.raw.set_wheel_chassis_connection_point_cs(er,rr),rr.free()}wheelSuspensionRestLength(er){return this.raw.wheel_suspension_rest_length(er)}setWheelSuspensionRestLength(er,tr){this.raw.set_wheel_suspension_rest_length(er,tr)}wheelMaxSuspensionTravel(er){return this.raw.wheel_max_suspension_travel(er)}setWheelMaxSuspensionTravel(er,tr){this.raw.set_wheel_max_suspension_travel(er,tr)}wheelRadius(er){return this.raw.wheel_radius(er)}setWheelRadius(er,tr){this.raw.set_wheel_radius(er,tr)}wheelSuspensionStiffness(er){return this.raw.wheel_suspension_stiffness(er)}setWheelSuspensionStiffness(er,tr){this.raw.set_wheel_suspension_stiffness(er,tr)}wheelSuspensionCompression(er){return this.raw.wheel_suspension_compression(er)}setWheelSuspensionCompression(er,tr){this.raw.set_wheel_suspension_compression(er,tr)}wheelSuspensionRelaxation(er){return this.raw.wheel_suspension_relaxation(er)}setWheelSuspensionRelaxation(er,tr){this.raw.set_wheel_suspension_relaxation(er,tr)}wheelMaxSuspensionForce(er){return this.raw.wheel_max_suspension_force(er)}setWheelMaxSuspensionForce(er,tr){this.raw.set_wheel_max_suspension_force(er,tr)}wheelBrake(er){return this.raw.wheel_brake(er)}setWheelBrake(er,tr){this.raw.set_wheel_brake(er,tr)}wheelSteering(er){return this.raw.wheel_steering(er)}setWheelSteering(er,tr){this.raw.set_wheel_steering(er,tr)}wheelEngineForce(er){return this.raw.wheel_engine_force(er)}setWheelEngineForce(er,tr){this.raw.set_wheel_engine_force(er,tr)}wheelDirectionCs(er){return VectorOps.fromRaw(this.raw.wheel_direction_cs(er))}setWheelDirectionCs(er,tr){let rr=VectorOps.intoRaw(tr);this.raw.set_wheel_direction_cs(er,rr),rr.free()}wheelAxleCs(er){return VectorOps.fromRaw(this.raw.wheel_axle_cs(er))}setWheelAxleCs(er,tr){let rr=VectorOps.intoRaw(tr);this.raw.set_wheel_axle_cs(er,rr),rr.free()}wheelFrictionSlip(er){return this.raw.wheel_friction_slip(er)}setWheelFrictionSlip(er,tr){this.raw.set_wheel_friction_slip(er,tr)}wheelSideFrictionStiffness(er){return this.raw.wheel_side_friction_stiffness(er)}setWheelSideFrictionStiffness(er,tr){this.raw.set_wheel_side_friction_stiffness(er,tr)}wheelRotation(er){return this.raw.wheel_rotation(er)}wheelForwardImpulse(er){return this.raw.wheel_forward_impulse(er)}wheelSideImpulse(er){return this.raw.wheel_side_impulse(er)}wheelSuspensionForce(er){return this.raw.wheel_suspension_force(er)}wheelContactNormal(er){return VectorOps.fromRaw(this.raw.wheel_contact_normal_ws(er))}wheelContactPoint(er){return VectorOps.fromRaw(this.raw.wheel_contact_point_ws(er))}wheelSuspensionLength(er){return this.raw.wheel_suspension_length(er)}wheelHardPoint(er){return VectorOps.fromRaw(this.raw.wheel_hard_point_ws(er))}wheelIsInContact(er){return this.raw.wheel_is_in_contact(er)}wheelGroundObject(er){return this.colliders.get(this.raw.wheel_ground_object(er))}}class World{constructor(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur,pr,gr){this.gravity=er,this.integrationParameters=new IntegrationParameters(tr),this.islands=new IslandManager(rr),this.broadPhase=new BroadPhase(nr),this.narrowPhase=new NarrowPhase(sr),this.bodies=new RigidBodySet(ar),this.colliders=new ColliderSet(or),this.impulseJoints=new ImpulseJointSet(lr),this.multibodyJoints=new MultibodyJointSet(cr),this.ccdSolver=new CCDSolver(hr),this.queryPipeline=new QueryPipeline(fr),this.physicsPipeline=new PhysicsPipeline(ur),this.serializationPipeline=new SerializationPipeline(pr),this.debugRenderPipeline=new DebugRenderPipeline(gr),this.characterControllers=new Set,this.vehicleControllers=new Set,this.impulseJoints.finalizeDeserialization(this.bodies),this.bodies.finalizeDeserialization(this.colliders),this.colliders.finalizeDeserialization(this.bodies)}free(){this.integrationParameters.free(),this.islands.free(),this.broadPhase.free(),this.narrowPhase.free(),this.bodies.free(),this.colliders.free(),this.impulseJoints.free(),this.multibodyJoints.free(),this.ccdSolver.free(),this.queryPipeline.free(),this.physicsPipeline.free(),this.serializationPipeline.free(),this.debugRenderPipeline.free(),this.characterControllers.forEach(er=>er.free()),this.vehicleControllers.forEach(er=>er.free()),this.integrationParameters=void 0,this.islands=void 0,this.broadPhase=void 0,this.narrowPhase=void 0,this.bodies=void 0,this.colliders=void 0,this.ccdSolver=void 0,this.impulseJoints=void 0,this.multibodyJoints=void 0,this.queryPipeline=void 0,this.physicsPipeline=void 0,this.serializationPipeline=void 0,this.debugRenderPipeline=void 0,this.characterControllers=void 0,this.vehicleControllers=void 0}static fromRaw(er){return er?new World(VectorOps.fromRaw(er.takeGravity()),er.takeIntegrationParameters(),er.takeIslandManager(),er.takeBroadPhase(),er.takeNarrowPhase(),er.takeBodies(),er.takeColliders(),er.takeImpulseJoints(),er.takeMultibodyJoints()):null}takeSnapshot(){return this.serializationPipeline.serializeAll(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints)}static restoreSnapshot(er){return new SerializationPipeline().deserializeAll(er)}debugRender(){return this.debugRenderPipeline.render(this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.narrowPhase),new DebugRenderBuffers(this.debugRenderPipeline.vertices,this.debugRenderPipeline.colors)}step(er,tr){this.physicsPipeline.step(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.ccdSolver,er,tr),this.queryPipeline.update(this.colliders)}propagateModifiedBodyPositionsToColliders(){this.bodies.raw.propagateModifiedBodyPositionsToColliders(this.colliders.raw)}updateSceneQueries(){this.propagateModifiedBodyPositionsToColliders(),this.queryPipeline.update(this.colliders)}get timestep(){return this.integrationParameters.dt}set timestep(er){this.integrationParameters.dt=er}get lengthUnit(){return this.integrationParameters.lengthUnit}set lengthUnit(er){this.integrationParameters.lengthUnit=er}get numSolverIterations(){return this.integrationParameters.numSolverIterations}set numSolverIterations(er){this.integrationParameters.numSolverIterations=er}get numAdditionalFrictionIterations(){return this.integrationParameters.numAdditionalFrictionIterations}set numAdditionalFrictionIterations(er){this.integrationParameters.numAdditionalFrictionIterations=er}get numInternalPgsIterations(){return this.integrationParameters.numInternalPgsIterations}set numInternalPgsIterations(er){this.integrationParameters.numInternalPgsIterations=er}switchToStandardPgsSolver(){this.integrationParameters.switchToStandardPgsSolver()}switchToSmallStepsPgsSolver(){this.integrationParameters.switchToSmallStepsPgsSolver()}switchToSmallStepsPgsSolverWithoutWarmstart(){this.integrationParameters.switchToSmallStepsPgsSolverWithoutWarmstart()}createRigidBody(er){return this.bodies.createRigidBody(this.colliders,er)}createCharacterController(er){let tr=new KinematicCharacterController(er,this.integrationParameters,this.bodies,this.colliders,this.queryPipeline);return this.characterControllers.add(tr),tr}removeCharacterController(er){this.characterControllers.delete(er),er.free()}createVehicleController(er){let tr=new DynamicRayCastVehicleController(er,this.bodies,this.colliders,this.queryPipeline);return this.vehicleControllers.add(tr),tr}removeVehicleController(er){this.vehicleControllers.delete(er),er.free()}createCollider(er,tr){let rr=tr?tr.handle:void 0;return this.colliders.createCollider(this.bodies,er,rr)}createImpulseJoint(er,tr,rr,nr){return this.impulseJoints.createJoint(this.bodies,er,tr.handle,rr.handle,nr)}createMultibodyJoint(er,tr,rr,nr){return this.multibodyJoints.createJoint(er,tr.handle,rr.handle,nr)}getRigidBody(er){return this.bodies.get(er)}getCollider(er){return this.colliders.get(er)}getImpulseJoint(er){return this.impulseJoints.get(er)}getMultibodyJoint(er){return this.multibodyJoints.get(er)}removeRigidBody(er){this.bodies&&this.bodies.remove(er.handle,this.islands,this.colliders,this.impulseJoints,this.multibodyJoints)}removeCollider(er,tr){this.colliders&&this.colliders.remove(er.handle,this.islands,this.bodies,tr)}removeImpulseJoint(er,tr){this.impulseJoints&&this.impulseJoints.remove(er.handle,tr)}removeMultibodyJoint(er,tr){this.impulseJoints&&this.multibodyJoints.remove(er.handle,tr)}forEachCollider(er){this.colliders.forEach(er)}forEachRigidBody(er){this.bodies.forEach(er)}forEachActiveRigidBody(er){this.bodies.forEachActiveRigidBody(this.islands,er)}castRay(er,tr,rr,nr,sr,ar,or,lr){return this.queryPipeline.castRay(this.bodies,this.colliders,er,tr,rr,nr,sr,ar?ar.handle:null,or?or.handle:null,this.colliders.castClosure(lr))}castRayAndGetNormal(er,tr,rr,nr,sr,ar,or,lr){return this.queryPipeline.castRayAndGetNormal(this.bodies,this.colliders,er,tr,rr,nr,sr,ar?ar.handle:null,or?or.handle:null,this.colliders.castClosure(lr))}intersectionsWithRay(er,tr,rr,nr,sr,ar,or,lr,cr){this.queryPipeline.intersectionsWithRay(this.bodies,this.colliders,er,tr,rr,nr,sr,ar,or?or.handle:null,lr?lr.handle:null,this.colliders.castClosure(cr))}intersectionWithShape(er,tr,rr,nr,sr,ar,or,lr){let cr=this.queryPipeline.intersectionWithShape(this.bodies,this.colliders,er,tr,rr,nr,sr,ar?ar.handle:null,or?or.handle:null,this.colliders.castClosure(lr));return cr!=null?this.colliders.get(cr):null}projectPoint(er,tr,rr,nr,sr,ar,or){return this.queryPipeline.projectPoint(this.bodies,this.colliders,er,tr,rr,nr,sr?sr.handle:null,ar?ar.handle:null,this.colliders.castClosure(or))}projectPointAndGetFeature(er,tr,rr,nr,sr,ar){return this.queryPipeline.projectPointAndGetFeature(this.bodies,this.colliders,er,tr,rr,nr?nr.handle:null,sr?sr.handle:null,this.colliders.castClosure(ar))}intersectionsWithPoint(er,tr,rr,nr,sr,ar,or){this.queryPipeline.intersectionsWithPoint(this.bodies,this.colliders,er,this.colliders.castClosure(tr),rr,nr,sr?sr.handle:null,ar?ar.handle:null,this.colliders.castClosure(or))}castShape(er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur){return this.queryPipeline.castShape(this.bodies,this.colliders,er,tr,rr,nr,sr,ar,or,lr,cr,hr?hr.handle:null,fr?fr.handle:null,this.colliders.castClosure(ur))}intersectionsWithShape(er,tr,rr,nr,sr,ar,or,lr,cr){this.queryPipeline.intersectionsWithShape(this.bodies,this.colliders,er,tr,rr,this.colliders.castClosure(nr),sr,ar,or?or.handle:null,lr?lr.handle:null,this.colliders.castClosure(cr))}collidersWithAabbIntersectingAabb(er,tr,rr){this.queryPipeline.collidersWithAabbIntersectingAabb(er,tr,this.colliders.castClosure(rr))}contactPairsWith(er,tr){this.narrowPhase.contactPairsWith(er.handle,this.colliders.castClosure(tr))}intersectionPairsWith(er,tr){this.narrowPhase.intersectionPairsWith(er.handle,this.colliders.castClosure(tr))}contactPair(er,tr,rr){this.narrowPhase.contactPair(er.handle,tr.handle,rr)}intersectionPair(er,tr){return this.narrowPhase.intersectionPair(er.handle,tr.handle)}}var ActiveEvents;(function(ir){ir[ir.NONE=0]="NONE",ir[ir.COLLISION_EVENTS=1]="COLLISION_EVENTS",ir[ir.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(ActiveEvents||(ActiveEvents={}));class TempContactForceEvent{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return VectorOps.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return VectorOps.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class EventQueue{constructor(er,tr){this.raw=tr||new RawEventQueue(er)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(er){this.raw.drainCollisionEvents(er)}drainContactForceEvents(er){let tr=new TempContactForceEvent;this.raw.drainContactForceEvents(rr=>{tr.raw=rr,er(tr),tr.free()})}clear(){this.raw.clear()}}var ActiveHooks;(function(ir){ir[ir.NONE=0]="NONE",ir[ir.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",ir[ir.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(ActiveHooks||(ActiveHooks={}));var SolverFlags;(function(ir){ir[ir.EMPTY=0]="EMPTY",ir[ir.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"})(SolverFlags||(SolverFlags={}));var ActiveCollisionTypes;(function(ir){ir[ir.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",ir[ir.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",ir[ir.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",ir[ir.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",ir[ir.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",ir[ir.FIXED_FIXED=32]="FIXED_FIXED",ir[ir.DEFAULT=15]="DEFAULT",ir[ir.ALL=60943]="ALL"})(ActiveCollisionTypes||(ActiveCollisionTypes={}));class Collider{constructor(er,tr,rr,nr){this.colliderSet=er,this.handle=tr,this._parent=rr,this._shape=nr}finalizeDeserialization(er){this.handle!=null&&(this._parent=er.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=Shape.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return VectorOps.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return RotationOps.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(er){this.colliderSet.raw.coSetSensor(this.handle,er)}setShape(er){let tr=er.intoRaw();this.colliderSet.raw.coSetShape(this.handle,tr),tr.free(),this._shape=er}setEnabled(er){this.colliderSet.raw.coSetEnabled(this.handle,er)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(er){this.colliderSet.raw.coSetRestitution(this.handle,er)}setFriction(er){this.colliderSet.raw.coSetFriction(this.handle,er)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(er){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,er)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(er){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,er)}setCollisionGroups(er){this.colliderSet.raw.coSetCollisionGroups(this.handle,er)}setSolverGroups(er){this.colliderSet.raw.coSetSolverGroups(this.handle,er)}contactSkin(){return this.colliderSet.raw.coContactSkin(this.handle)}setContactSkin(er){return this.colliderSet.raw.coSetContactSkin(this.handle,er)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(er){this.colliderSet.raw.coSetActiveHooks(this.handle,er)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(er){this.colliderSet.raw.coSetActiveEvents(this.handle,er)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(er){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,er)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(er){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,er)}setDensity(er){this.colliderSet.raw.coSetDensity(this.handle,er)}setMass(er){this.colliderSet.raw.coSetMass(this.handle,er)}setMassProperties(er,tr,rr,nr){let sr=VectorOps.intoRaw(tr),ar=VectorOps.intoRaw(rr),or=RotationOps.intoRaw(nr);this.colliderSet.raw.coSetMassProperties(this.handle,er,sr,ar,or),sr.free(),ar.free(),or.free()}setTranslation(er){this.colliderSet.raw.coSetTranslation(this.handle,er.x,er.y,er.z)}setTranslationWrtParent(er){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,er.x,er.y,er.z)}setRotation(er){this.colliderSet.raw.coSetRotation(this.handle,er.x,er.y,er.z,er.w)}setRotationWrtParent(er){this.colliderSet.raw.coSetRotationWrtParent(this.handle,er.x,er.y,er.z,er.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return VectorOps.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(er){const tr=VectorOps.intoRaw(er);this.colliderSet.raw.coSetHalfExtents(this.handle,tr)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(er){this.colliderSet.raw.coSetRadius(this.handle,er)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(er){this.colliderSet.raw.coSetRoundRadius(this.handle,er)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(er){this.colliderSet.raw.coSetHalfHeight(this.handle,er)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let er=this.colliderSet.raw.coHeightfieldScale(this.handle);return VectorOps.fromRaw(er)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(er){let tr=VectorOps.intoRaw(er),rr=this.colliderSet.raw.coContainsPoint(this.handle,tr);return tr.free(),rr}projectPoint(er,tr){let rr=VectorOps.intoRaw(er),nr=PointProjection.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,rr,tr));return rr.free(),nr}intersectsRay(er,tr){let rr=VectorOps.intoRaw(er.origin),nr=VectorOps.intoRaw(er.dir),sr=this.colliderSet.raw.coIntersectsRay(this.handle,rr,nr,tr);return rr.free(),nr.free(),sr}castShape(er,tr,rr,nr,sr,ar,or,lr){let cr=VectorOps.intoRaw(er),hr=VectorOps.intoRaw(rr),fr=RotationOps.intoRaw(nr),ur=VectorOps.intoRaw(sr),pr=tr.intoRaw(),gr=ShapeCastHit.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,cr,pr,hr,fr,ur,ar,or,lr));return cr.free(),hr.free(),fr.free(),ur.free(),pr.free(),gr}castCollider(er,tr,rr,nr,sr,ar){let or=VectorOps.intoRaw(er),lr=VectorOps.intoRaw(rr),cr=ColliderShapeCastHit.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,or,tr.handle,lr,nr,sr,ar));return or.free(),lr.free(),cr}intersectsShape(er,tr,rr){let nr=VectorOps.intoRaw(tr),sr=RotationOps.intoRaw(rr),ar=er.intoRaw(),or=this.colliderSet.raw.coIntersectsShape(this.handle,ar,nr,sr);return nr.free(),sr.free(),ar.free(),or}contactShape(er,tr,rr,nr){let sr=VectorOps.intoRaw(tr),ar=RotationOps.intoRaw(rr),or=er.intoRaw(),lr=ShapeContact.fromRaw(this.colliderSet.raw.coContactShape(this.handle,or,sr,ar,nr));return sr.free(),ar.free(),or.free(),lr}contactCollider(er,tr){return ShapeContact.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,er.handle,tr))}castRay(er,tr,rr){let nr=VectorOps.intoRaw(er.origin),sr=VectorOps.intoRaw(er.dir),ar=this.colliderSet.raw.coCastRay(this.handle,nr,sr,tr,rr);return nr.free(),sr.free(),ar}castRayAndGetNormal(er,tr,rr){let nr=VectorOps.intoRaw(er.origin),sr=VectorOps.intoRaw(er.dir),ar=RayIntersection.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,nr,sr,tr,rr));return nr.free(),sr.free(),ar}}var MassPropsMode;(function(ir){ir[ir.Density=0]="Density",ir[ir.Mass=1]="Mass",ir[ir.MassProps=2]="MassProps"})(MassPropsMode||(MassPropsMode={}));class ColliderDesc{constructor(er){this.enabled=!0,this.shape=er,this.massPropsMode=MassPropsMode.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=RotationOps.identity(),this.translation=VectorOps.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=CoefficientCombineRule.Average,this.restitutionCombineRule=CoefficientCombineRule.Average,this.activeCollisionTypes=ActiveCollisionTypes.DEFAULT,this.activeEvents=ActiveEvents.NONE,this.activeHooks=ActiveHooks.NONE,this.mass=0,this.centerOfMass=VectorOps.zeros(),this.contactForceEventThreshold=0,this.contactSkin=0,this.principalAngularInertia=VectorOps.zeros(),this.angularInertiaLocalFrame=RotationOps.identity()}static ball(er){const tr=new Ball(er);return new ColliderDesc(tr)}static capsule(er,tr){const rr=new Capsule$1(er,tr);return new ColliderDesc(rr)}static segment(er,tr){const rr=new Segment(er,tr);return new ColliderDesc(rr)}static triangle(er,tr,rr){const nr=new Triangle$1(er,tr,rr);return new ColliderDesc(nr)}static roundTriangle(er,tr,rr,nr){const sr=new RoundTriangle(er,tr,rr,nr);return new ColliderDesc(sr)}static polyline(er,tr){const rr=new Polyline(er,tr);return new ColliderDesc(rr)}static trimesh(er,tr,rr){const nr=new TriMesh(er,tr,rr);return new ColliderDesc(nr)}static cuboid(er,tr,rr){const nr=new Cuboid(er,tr,rr);return new ColliderDesc(nr)}static roundCuboid(er,tr,rr,nr){const sr=new RoundCuboid(er,tr,rr,nr);return new ColliderDesc(sr)}static heightfield(er,tr,rr,nr,sr){const ar=new Heightfield(er,tr,rr,nr,sr);return new ColliderDesc(ar)}static cylinder(er,tr){const rr=new Cylinder(er,tr);return new ColliderDesc(rr)}static roundCylinder(er,tr,rr){const nr=new RoundCylinder(er,tr,rr);return new ColliderDesc(nr)}static cone(er,tr){const rr=new Cone(er,tr);return new ColliderDesc(rr)}static roundCone(er,tr,rr){const nr=new RoundCone(er,tr,rr);return new ColliderDesc(nr)}static convexHull(er){const tr=new ConvexPolyhedron(er,null);return new ColliderDesc(tr)}static convexMesh(er,tr){const rr=new ConvexPolyhedron(er,tr);return new ColliderDesc(rr)}static roundConvexHull(er,tr){const rr=new RoundConvexPolyhedron(er,null,tr);return new ColliderDesc(rr)}static roundConvexMesh(er,tr,rr){const nr=new RoundConvexPolyhedron(er,tr,rr);return new ColliderDesc(nr)}setTranslation(er,tr,rr){if(typeof er!="number"||typeof tr!="number"||typeof rr!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:er,y:tr,z:rr},this}setRotation(er){return RotationOps.copy(this.rotation,er),this}setSensor(er){return this.isSensor=er,this}setEnabled(er){return this.enabled=er,this}setContactSkin(er){return this.contactSkin=er,this}setDensity(er){return this.massPropsMode=MassPropsMode.Density,this.density=er,this}setMass(er){return this.massPropsMode=MassPropsMode.Mass,this.mass=er,this}setMassProperties(er,tr,rr,nr){return this.massPropsMode=MassPropsMode.MassProps,this.mass=er,VectorOps.copy(this.centerOfMass,tr),VectorOps.copy(this.principalAngularInertia,rr),RotationOps.copy(this.angularInertiaLocalFrame,nr),this}setRestitution(er){return this.restitution=er,this}setFriction(er){return this.friction=er,this}setFrictionCombineRule(er){return this.frictionCombineRule=er,this}setRestitutionCombineRule(er){return this.restitutionCombineRule=er,this}setCollisionGroups(er){return this.collisionGroups=er,this}setSolverGroups(er){return this.solverGroups=er,this}setActiveHooks(er){return this.activeHooks=er,this}setActiveEvents(er){return this.activeEvents=er,this}setActiveCollisionTypes(er){return this.activeCollisionTypes=er,this}setContactForceEventThreshold(er){return this.contactForceEventThreshold=er,this}}class ColliderSet{constructor(er){this.raw=er||new RawColliderSet,this.map=new Coarena,er&&er.forEachColliderHandle(tr=>{this.map.set(tr,new Collider(this,tr,null))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}castClosure(er){return tr=>{if(er)return er(this.get(tr))}}finalizeDeserialization(er){this.map.forEach(tr=>tr.finalizeDeserialization(er))}createCollider(er,tr,rr){let nr=rr!=null&&rr!=null;if(nr&&isNaN(rr))throw Error("Cannot create a collider with a parent rigid-body handle that is not a number.");let sr=tr.shape.intoRaw(),ar=VectorOps.intoRaw(tr.translation),or=RotationOps.intoRaw(tr.rotation),lr=VectorOps.intoRaw(tr.centerOfMass),cr=VectorOps.intoRaw(tr.principalAngularInertia),hr=RotationOps.intoRaw(tr.angularInertiaLocalFrame),fr=this.raw.createCollider(tr.enabled,sr,ar,or,tr.massPropsMode,tr.mass,lr,cr,hr,tr.density,tr.friction,tr.restitution,tr.frictionCombineRule,tr.restitutionCombineRule,tr.isSensor,tr.collisionGroups,tr.solverGroups,tr.activeCollisionTypes,tr.activeHooks,tr.activeEvents,tr.contactForceEventThreshold,tr.contactSkin,nr,nr?rr:0,er.raw);sr.free(),ar.free(),or.free(),lr.free(),cr.free(),hr.free();let ur=nr?er.get(rr):null,pr=new Collider(this,fr,ur,tr.shape);return this.map.set(fr,pr),pr}remove(er,tr,rr,nr){this.raw.remove(er,tr.raw,rr.raw,nr),this.unmap(er)}unmap(er){this.map.delete(er)}get(er){return this.map.get(er)}len(){return this.map.len()}contains(er){return this.get(er)!=null}forEach(er){this.map.forEach(er)}getAll(){return this.map.getAll()}}function version(){return version$2()}const RAPIER$1=Object.freeze(Object.defineProperty({__proto__:null,get ActiveCollisionTypes(){return ActiveCollisionTypes},get ActiveEvents(){return ActiveEvents},get ActiveHooks(){return ActiveHooks},Ball,BroadPhase,CCDSolver,Capsule:Capsule$1,CharacterCollision,get CoefficientCombineRule(){return CoefficientCombineRule},Collider,ColliderDesc,ColliderSet,ColliderShapeCastHit,Cone,ConvexPolyhedron,Cuboid,Cylinder,DebugRenderBuffers,DebugRenderPipeline,DynamicRayCastVehicleController,EventQueue,get FeatureType(){return FeatureType},FixedImpulseJoint,FixedMultibodyJoint,GenericImpulseJoint,HalfSpace,get HeightFieldFlags(){return HeightFieldFlags},Heightfield,ImpulseJoint,ImpulseJointSet,IntegrationParameters,IslandManager,get JointAxesMask(){return JointAxesMask},JointData,get JointType(){return JointType},KinematicCharacterController,get MassPropsMode(){return MassPropsMode},get MotorModel(){return MotorModel},MultibodyJoint,MultibodyJointSet,NarrowPhase,PhysicsPipeline,PointColliderProjection,PointProjection,Polyline,PrismaticImpulseJoint,PrismaticMultibodyJoint,Quaternion,get QueryFilterFlags(){return QueryFilterFlags},QueryPipeline,Ray,RayColliderHit,RayColliderIntersection,RayIntersection,RevoluteImpulseJoint,RevoluteMultibodyJoint,RigidBody,RigidBodyDesc,RigidBodySet,get RigidBodyType(){return RigidBodyType},RopeImpulseJoint,RotationOps,RoundCone,RoundConvexPolyhedron,RoundCuboid,RoundCylinder,RoundTriangle,SdpMatrix3,SdpMatrix3Ops,Segment,SerializationPipeline,Shape,ShapeCastHit,ShapeContact,get ShapeType(){return ShapeType},get SolverFlags(){return SolverFlags},SphericalImpulseJoint,SphericalMultibodyJoint,SpringImpulseJoint,TempContactForceEvent,TempContactManifold,TriMesh,get TriMeshFlags(){return TriMeshFlags},Triangle:Triangle$1,UnitImpulseJoint,UnitMultibodyJoint,Vector3,VectorOps,World,version},Symbol.toStringTag,{value:"Module"}));class AnimationClipCreator{static CreateRotationAnimation(er,tr="x"){const rr=[0,er],nr=[0,360],sr=".rotation["+tr+"]",ar=new NumberKeyframeTrack(sr,rr,nr);return new AnimationClip(null,er,[ar])}static CreateScaleAxisAnimation(er,tr="x"){const rr=[0,er],nr=[0,1],sr=".scale["+tr+"]",ar=new NumberKeyframeTrack(sr,rr,nr);return new AnimationClip(null,er,[ar])}static CreateShakeAnimation(er,tr){const rr=[],nr=[],sr=new Vector3$1;for(let lr=0;lr<er*10;lr++)rr.push(lr/10),sr.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).multiply(tr).toArray(nr,nr.length);const ar=".position",or=new VectorKeyframeTrack(ar,rr,nr);return new AnimationClip(null,er,[or])}static CreatePulsationAnimation(er,tr){const rr=[],nr=[],sr=new Vector3$1;for(let lr=0;lr<er*10;lr++){rr.push(lr/10);const cr=Math.random()*tr;sr.set(cr,cr,cr).toArray(nr,nr.length)}const ar=".scale",or=new VectorKeyframeTrack(ar,rr,nr);return new AnimationClip(null,er,[or])}static CreateVisibilityAnimation(er){const tr=[0,er/2,er],rr=[!0,!1,!0],nr=".visible",sr=new BooleanKeyframeTrack(nr,tr,rr);return new AnimationClip(null,er,[sr])}static CreateMaterialColorAnimation(er,tr){const rr=[],nr=[],sr=tr.length>1?er/(tr.length-1):0;for(let lr=0;lr<tr.length;lr++){rr.push(lr*sr);const cr=tr[lr];nr.push(cr.r,cr.g,cr.b)}const ar=".material.color",or=new ColorKeyframeTrack(ar,rr,nr);return new AnimationClip(null,er,[or])}}const _q$1=new Quaternion$1,_targetPos=new Vector3$1,_targetVec=new Vector3$1,_effectorPos=new Vector3$1,_effectorVec=new Vector3$1,_linkPos=new Vector3$1,_invLinkQ=new Quaternion$1,_linkScale=new Vector3$1,_axis$1=new Vector3$1,_vector$4=new Vector3$1,_matrix$4=new Matrix4;class CCDIKSolver{constructor(er,tr=[]){this.mesh=er,this.iks=tr,this._valid()}update(){const er=this.iks;for(let tr=0,rr=er.length;tr<rr;tr++)this.updateOne(er[tr]);return this}updateOne(er){const tr=this.mesh.skeleton.bones,rr=Math,nr=tr[er.effector],sr=tr[er.target];_targetPos.setFromMatrixPosition(sr.matrixWorld);const ar=er.links,or=er.iteration!==void 0?er.iteration:1;for(let lr=0;lr<or;lr++){let cr=!1;for(let hr=0,fr=ar.length;hr<fr;hr++){const ur=tr[ar[hr].index];if(ar[hr].enabled===!1)break;const pr=ar[hr].limitation,gr=ar[hr].rotationMin,_r=ar[hr].rotationMax;ur.matrixWorld.decompose(_linkPos,_invLinkQ,_linkScale),_invLinkQ.invert(),_effectorPos.setFromMatrixPosition(nr.matrixWorld),_effectorVec.subVectors(_effectorPos,_linkPos),_effectorVec.applyQuaternion(_invLinkQ),_effectorVec.normalize(),_targetVec.subVectors(_targetPos,_linkPos),_targetVec.applyQuaternion(_invLinkQ),_targetVec.normalize();let mr=_targetVec.dot(_effectorVec);if(mr>1?mr=1:mr<-1&&(mr=-1),mr=rr.acos(mr),!(mr<1e-5)){if(er.minAngle!==void 0&&mr<er.minAngle&&(mr=er.minAngle),er.maxAngle!==void 0&&mr>er.maxAngle&&(mr=er.maxAngle),_axis$1.crossVectors(_effectorVec,_targetVec),_axis$1.normalize(),_q$1.setFromAxisAngle(_axis$1,mr),ur.quaternion.multiply(_q$1),pr!==void 0){let dr=ur.quaternion.w;dr>1&&(dr=1);const vr=rr.sqrt(1-dr*dr);ur.quaternion.set(pr.x*vr,pr.y*vr,pr.z*vr,dr)}gr!==void 0&&ur.rotation.setFromVector3(_vector$4.setFromEuler(ur.rotation).max(gr)),_r!==void 0&&ur.rotation.setFromVector3(_vector$4.setFromEuler(ur.rotation).min(_r)),ur.updateMatrixWorld(!0),cr=!0}}if(!cr)break}return this}createHelper(er){return new CCDIKHelper(this.mesh,this.iks,er)}_valid(){const er=this.iks,tr=this.mesh.skeleton.bones;for(let rr=0,nr=er.length;rr<nr;rr++){const sr=er[rr],ar=tr[sr.effector],or=sr.links;let lr,cr;lr=ar;for(let hr=0,fr=or.length;hr<fr;hr++)cr=tr[or[hr].index],lr.parent!==cr&&console.warn("THREE.CCDIKSolver: bone "+lr.name+" is not the child of bone "+cr.name),lr=cr}}}function getPosition(ir,er){return _vector$4.setFromMatrixPosition(ir.matrixWorld).applyMatrix4(er)}function setPositionOfBoneToAttributeArray(ir,er,tr,rr){const nr=getPosition(tr,rr);ir[er*3+0]=nr.x,ir[er*3+1]=nr.y,ir[er*3+2]=nr.z}class CCDIKHelper extends Object3D{constructor(er,tr=[],rr=.25){super(),this.root=er,this.iks=tr,this.matrix.copy(er.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new SphereGeometry(rr,16,8),this.targetSphereMaterial=new MeshBasicMaterial({color:new Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new MeshBasicMaterial({color:new Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new MeshBasicMaterial({color:new Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new LineBasicMaterial({color:new Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}updateMatrixWorld(er){const tr=this.root;if(this.visible){let rr=0;const nr=this.iks,sr=tr.skeleton.bones;_matrix$4.copy(tr.matrixWorld).invert();for(let ar=0,or=nr.length;ar<or;ar++){const lr=nr[ar],cr=sr[lr.target],hr=sr[lr.effector],fr=this.children[rr++],ur=this.children[rr++];fr.position.copy(getPosition(cr,_matrix$4)),ur.position.copy(getPosition(hr,_matrix$4));for(let _r=0,mr=lr.links.length;_r<mr;_r++){const dr=lr.links[_r],vr=sr[dr.index];this.children[rr++].position.copy(getPosition(vr,_matrix$4))}const pr=this.children[rr++],gr=pr.geometry.attributes.position.array;setPositionOfBoneToAttributeArray(gr,0,cr,_matrix$4),setPositionOfBoneToAttributeArray(gr,1,hr,_matrix$4);for(let _r=0,mr=lr.links.length;_r<mr;_r++){const dr=lr.links[_r],vr=sr[dr.index];setPositionOfBoneToAttributeArray(gr,_r+2,vr,_matrix$4)}pr.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(tr.matrixWorld),super.updateMatrixWorld(er)}dispose(){this.sphereGeometry.dispose(),this.targetSphereMaterial.dispose(),this.effectorSphereMaterial.dispose(),this.linkSphereMaterial.dispose(),this.lineMaterial.dispose();const er=this.children;for(let tr=0;tr<er.length;tr++){const rr=er[tr];rr.isLine&&rr.geometry.dispose()}}_init(){const er=this,tr=this.iks;function rr(lr){const cr=new BufferGeometry,hr=new Float32Array((2+lr.links.length)*3);return cr.setAttribute("position",new BufferAttribute(hr,3)),cr}function nr(){return new Mesh(er.sphereGeometry,er.targetSphereMaterial)}function sr(){return new Mesh(er.sphereGeometry,er.effectorSphereMaterial)}function ar(){return new Mesh(er.sphereGeometry,er.linkSphereMaterial)}function or(lr){return new Line(rr(lr),er.lineMaterial)}for(let lr=0,cr=tr.length;lr<cr;lr++){const hr=tr[lr];this.add(nr()),this.add(sr());for(let fr=0,ur=hr.links.length;fr<ur;fr++)this.add(ar());this.add(or(hr))}}}class WebGL{static isWebGL2Available(){try{const er=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&er.getContext("webgl2"))}catch{return!1}}static isColorSpaceAvailable(er){try{const tr=document.createElement("canvas"),rr=window.WebGL2RenderingContext&&tr.getContext("webgl2");return rr.drawingBufferColorSpace=er,rr.drawingBufferColorSpace===er}catch{return!1}}static getWebGL2ErrorMessage(){return this.getErrorMessage(2)}static getErrorMessage(er){const tr={1:"WebGL",2:"WebGL 2"},rr={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext};let nr='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';const sr=document.createElement("div");return sr.id="webglmessage",sr.style.fontFamily="monospace",sr.style.fontSize="13px",sr.style.fontWeight="normal",sr.style.textAlign="center",sr.style.background="#fff",sr.style.color="#000",sr.style.padding="1.5em",sr.style.width="400px",sr.style.margin="5em auto 0",rr[er]?nr=nr.replace("$0","graphics card"):nr=nr.replace("$0","browser"),nr=nr.replace("$1",tr[er]),sr.innerHTML=nr,sr}static isWebGLAvailable(){console.warn("isWebGLAvailable() has been deprecated and will be removed in r178. Use isWebGL2Available() instead.");try{const er=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(er.getContext("webgl")||er.getContext("experimental-webgl")))}catch{return!1}}static getWebGLErrorMessage(){return console.warn("getWebGLErrorMessage() has been deprecated and will be removed in r178. Use getWebGL2ErrorMessage() instead."),this.getErrorMessage(1)}}const STATE$1={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},INPUT={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},_center$2={x:0,y:0},_transformation={camera:new Matrix4,gizmos:new Matrix4},_changeEvent$5={type:"change"},_startEvent$2={type:"start"},_endEvent$2={type:"end"},_raycaster$2=new Raycaster,_offset$1=new Vector3$1,_gizmoMatrixStateTemp=new Matrix4,_cameraMatrixStateTemp=new Matrix4,_scalePointTemp=new Vector3$1,_EPS$3=1e-6;class ArcballControls extends Controls{constructor(er,tr=null,rr=null){super(er,tr),this.scene=rr,this.target=new Vector3$1,this._currentTarget=new Vector3$1,this.radiusFactor=.67,this.mouseActions=[],this._mouseOp=null,this._v2_1=new Vector2,this._v3_1=new Vector3$1,this._v3_2=new Vector3$1,this._m4_1=new Matrix4,this._m4_2=new Matrix4,this._quat=new Quaternion$1,this._translationMatrix=new Matrix4,this._rotationMatrix=new Matrix4,this._scaleMatrix=new Matrix4,this._rotationAxis=new Vector3$1,this._cameraMatrixState=new Matrix4,this._cameraProjectionState=new Matrix4,this._fovState=1,this._upState=new Vector3$1,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new Matrix4,this._up0=new Vector3$1,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new Matrix4,this._gizmoMatrixState0=new Matrix4,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=INPUT.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._downStart=0,this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new Vector3$1,this._startCursorPosition=new Vector3$1,this._grid=null,this._gridPosition=new Vector3$1,this._gizmos=new Group,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new Vector3$1,this._cursorPosCurr=new Vector3$1,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.rotateSpeed=1,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.enableGizmos=!0,this.enableFocus=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this._tbRadius=1,this._state=STATE$1.IDLE,this.setCamera(er),this.scene!=null&&this.scene.add(this._gizmos),this.initializeMouseActions(),this._onContextMenu=onContextMenu$5.bind(this),this._onWheel=onWheel.bind(this),this._onPointerUp=onPointerUp$5.bind(this),this._onPointerMove=onPointerMove$6.bind(this),this._onPointerDown=onPointerDown$6.bind(this),this._onPointerCancel=onPointerCancel$3.bind(this),this._onWindowResize=onWindowResize.bind(this),tr!==null&&this.connect()}connect(){this.domElement.style.touchAction="none",this._devPxRatio=window.devicePixelRatio,this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onWheel),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),window.addEventListener("resize",this._onWindowResize)}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),window.removeEventListener("resize",this._onWindowResize)}onSinglePanStart(er,tr){if(this.enabled)switch(this.dispatchEvent(_startEvent$2),this.setCenter(er.clientX,er.clientY),tr){case"PAN":if(!this.enablePan)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)),this.updateTbState(STATE$1.PAN,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement)),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(_changeEvent$5));break;case"ROTATE":if(!this.enableRotate)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.updateTbState(STATE$1.ROTATE,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.object,_center$2.x,_center$2.y,this.domElement,this._tbRadius)),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr),this.dispatchEvent(_changeEvent$5);break;case"FOV":if(!this.object.isPerspectiveCamera||!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)),this.updateTbState(STATE$1.FOV,!0),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break;case"ZOOM":if(!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)),this.updateTbState(STATE$1.SCALE,!0),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break}}onSinglePanMove(er,tr){if(this.enabled){const rr=tr!=this._state;switch(this.setCenter(er.clientX,er.clientY),tr){case STATE$1.PAN:this.enablePan&&(rr?(this.dispatchEvent(_endEvent$2),this.dispatchEvent(_startEvent$2),this.updateTbState(tr,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement)),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)):(this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))));break;case STATE$1.ROTATE:if(this.enableRotate)if(rr)this.dispatchEvent(_endEvent$2),this.dispatchEvent(_startEvent$2),this.updateTbState(tr,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.object,_center$2.x,_center$2.y,this.domElement,this._tbRadius)),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0);else{this._currentCursorPosition.copy(this.unprojectOnTbSurface(this.object,_center$2.x,_center$2.y,this.domElement,this._tbRadius));const nr=this._startCursorPosition.distanceTo(this._currentCursorPosition),sr=this._startCursorPosition.angleTo(this._currentCursorPosition),ar=Math.max(nr/this._tbRadius,sr)*this.rotateSpeed;this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),ar)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=ar,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case STATE$1.SCALE:if(this.enableZoom)if(rr)this.dispatchEvent(_endEvent$2),this.dispatchEvent(_startEvent$2),this.updateTbState(tr,!0),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5);const sr=this._currentCursorPosition.y-this._startCursorPosition.y;let ar=1;sr<0?ar=1/Math.pow(this.scaleFactor,-sr*8):sr>0&&(ar=Math.pow(this.scaleFactor,sr*8)),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this.applyTransformMatrix(this.scale(ar,this._v3_1))}break;case STATE$1.FOV:if(this.enableZoom&&this.object.isPerspectiveCamera)if(rr)this.dispatchEvent(_endEvent$2),this.dispatchEvent(_startEvent$2),this.updateTbState(tr,!0),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5);const sr=this._currentCursorPosition.y-this._startCursorPosition.y;let ar=1;sr<0?ar=1/Math.pow(this.scaleFactor,-sr*8):sr>0&&(ar=Math.pow(this.scaleFactor,sr*8)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const or=this._v3_1.distanceTo(this._gizmos.position);let lr=or/ar;lr=MathUtils.clamp(lr,this.minDistance,this.maxDistance);const cr=or*Math.tan(MathUtils.DEG2RAD*this._fovState*.5);let hr=MathUtils.RAD2DEG*(Math.atan(cr/lr)*2);hr=MathUtils.clamp(hr,this.minFov,this.maxFov);const fr=cr/Math.tan(MathUtils.DEG2RAD*(hr/2));ar=or/fr,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(hr),this.applyTransformMatrix(this.scale(ar,this._v3_2,!1)),_offset$1.copy(this._gizmos.position).sub(this.object.position).normalize().multiplyScalar(fr/or),this._m4_1.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z)}break}this.dispatchEvent(_changeEvent$5)}}onSinglePanEnd(){if(this._state==STATE$1.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const tr=Math.abs((this._wPrev+this._wCurr)/2),rr=this;this._animationId=window.requestAnimationFrame(function(nr){rr.updateTbState(STATE$1.ANIMATION_ROTATE,!0);const sr=rr.calculateRotationAxis(rr._cursorPosPrev,rr._cursorPosCurr);rr.onRotationAnim(nr,sr,Math.min(tr,rr.wMax))})}else this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5);else this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)}else(this._state==STATE$1.PAN||this._state==STATE$1.IDLE)&&(this.updateTbState(STATE$1.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5));this.dispatchEvent(_endEvent$2)}onDoubleTap(er){if(this.enabled&&this.enablePan&&this.enableFocus&&this.scene!=null){this.dispatchEvent(_startEvent$2),this.setCenter(er.clientX,er.clientY);const tr=this.unprojectOnObj(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement),this.object);if(tr!=null&&this.enableAnimations){const rr=this;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(nr){rr.updateTbState(STATE$1.ANIMATION_FOCUS,!0),rr.onFocusAnim(nr,tr,rr._cameraMatrixState,rr._gizmoMatrixState)})}else tr!=null&&!this.enableAnimations&&(this.updateTbState(STATE$1.FOCUS,!0),this.focus(tr,this.scaleFactor),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5))}this.dispatchEvent(_endEvent$2)}onDoublePanStart(){this.enabled&&this.enablePan&&(this.dispatchEvent(_startEvent$2),this.updateTbState(STATE$1.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement,!0)),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1))}onDoublePanMove(){this.enabled&&this.enablePan&&(this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=STATE$1.PAN&&(this.updateTbState(STATE$1.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition)),this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement,!0)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(_changeEvent$5))}onDoublePanEnd(){this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_endEvent$2)}onRotateStart(){this.enabled&&this.enableRotate&&(this.dispatchEvent(_startEvent$2),this.updateTbState(STATE$1.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,this.object.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}onRotateMove(){if(this.enabled&&this.enableRotate){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let er;this._state!=STATE$1.ZROTATE&&(this.updateTbState(STATE$1.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),er=this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._v3_2)):er=new Vector3$1().setFromMatrixPosition(this._gizmoMatrixState);const tr=MathUtils.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);this.applyTransformMatrix(this.zRotate(er,tr)),this.dispatchEvent(_changeEvent$5)}}onRotateEnd(){this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_endEvent$2)}onPinchStart(){this.enabled&&this.enableZoom&&(this.dispatchEvent(_startEvent$2),this.updateTbState(STATE$1.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}onPinchMove(){if(this.enabled&&this.enableZoom){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const er=12;this._state!=STATE$1.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(STATE$1.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),er*this._devPxRatio);const tr=this._currentFingerDistance/this._startFingerDistance;let rr;this.enablePan?this.object.isOrthographicCamera?rr=this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._gizmos.position):this.object.isPerspectiveCamera&&(rr=this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement).applyQuaternion(this.object.quaternion).add(this._gizmos.position)):rr=this._gizmos.position,this.applyTransformMatrix(this.scale(tr,rr)),this.dispatchEvent(_changeEvent$5)}}onPinchEnd(){this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_endEvent$2)}onTriplePanStart(){if(this.enabled&&this.enableZoom){this.dispatchEvent(_startEvent$2),this.updateTbState(STATE$1.SCALE,!0);let er=0,tr=0;const rr=this._touchCurrent.length;for(let nr=0;nr<rr;nr++)er+=this._touchCurrent[nr].clientX,tr+=this._touchCurrent[nr].clientY;this.setCenter(er/rr,tr/rr),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition)}}onTriplePanMove(){if(this.enabled&&this.enableZoom){let er=0,tr=0;const rr=this._touchCurrent.length;for(let ur=0;ur<rr;ur++)er+=this._touchCurrent[ur].clientX,tr+=this._touchCurrent[ur].clientY;this.setCenter(er/rr,tr/rr);const nr=8;this._currentCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5);const sr=this._currentCursorPosition.y-this._startCursorPosition.y;let ar=1;sr<0?ar=1/Math.pow(this.scaleFactor,-sr*nr):sr>0&&(ar=Math.pow(this.scaleFactor,sr*nr)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const or=this._v3_1.distanceTo(this._gizmos.position);let lr=or/ar;lr=MathUtils.clamp(lr,this.minDistance,this.maxDistance);const cr=or*Math.tan(MathUtils.DEG2RAD*this._fovState*.5);let hr=MathUtils.RAD2DEG*(Math.atan(cr/lr)*2);hr=MathUtils.clamp(hr,this.minFov,this.maxFov);const fr=cr/Math.tan(MathUtils.DEG2RAD*(hr/2));ar=or/fr,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(hr),this.applyTransformMatrix(this.scale(ar,this._v3_2,!1)),_offset$1.copy(this._gizmos.position).sub(this.object.position).normalize().multiplyScalar(fr/or),this._m4_1.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z),this.dispatchEvent(_changeEvent$5)}}onTriplePanEnd(){this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_endEvent$2)}setCenter(er,tr){_center$2.x=er,_center$2.y=tr}initializeMouseActions(){this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}compareMouseAction(er,tr){return er.operation==tr.operation?er.mouse==tr.mouse&&er.key==tr.key:!1}setMouseAction(er,tr,rr=null){const nr=["PAN","ROTATE","ZOOM","FOV"],sr=[0,1,2,"WHEEL"],ar=["CTRL","SHIFT",null];let or;if(!nr.includes(er)||!sr.includes(tr)||!ar.includes(rr)||tr=="WHEEL"&&er!="ZOOM"&&er!="FOV")return!1;switch(er){case"PAN":or=STATE$1.PAN;break;case"ROTATE":or=STATE$1.ROTATE;break;case"ZOOM":or=STATE$1.SCALE;break;case"FOV":or=STATE$1.FOV;break}const lr={operation:er,mouse:tr,key:rr,state:or};for(let cr=0;cr<this.mouseActions.length;cr++)if(this.mouseActions[cr].mouse==lr.mouse&&this.mouseActions[cr].key==lr.key)return this.mouseActions.splice(cr,1,lr),!0;return this.mouseActions.push(lr),!0}unsetMouseAction(er,tr=null){for(let rr=0;rr<this.mouseActions.length;rr++)if(this.mouseActions[rr].mouse==er&&this.mouseActions[rr].key==tr)return this.mouseActions.splice(rr,1),!0;return!1}getOpFromAction(er,tr){let rr;for(let nr=0;nr<this.mouseActions.length;nr++)if(rr=this.mouseActions[nr],rr.mouse==er&&rr.key==tr)return rr.operation;if(tr!=null){for(let nr=0;nr<this.mouseActions.length;nr++)if(rr=this.mouseActions[nr],rr.mouse==er&&rr.key==null)return rr.operation}return null}getOpStateFromAction(er,tr){let rr;for(let nr=0;nr<this.mouseActions.length;nr++)if(rr=this.mouseActions[nr],rr.mouse==er&&rr.key==tr)return rr.state;if(tr!=null){for(let nr=0;nr<this.mouseActions.length;nr++)if(rr=this.mouseActions[nr],rr.mouse==er&&rr.key==null)return rr.state}return null}getAngle(er,tr){return Math.atan2(tr.clientY-er.clientY,tr.clientX-er.clientX)*180/Math.PI}updateTouchEvent(er){for(let tr=0;tr<this._touchCurrent.length;tr++)if(this._touchCurrent[tr].pointerId==er.pointerId){this._touchCurrent.splice(tr,1,er);break}}applyTransformMatrix(er){if(er.camera!=null&&(this._m4_1.copy(this._cameraMatrixState).premultiply(er.camera),this._m4_1.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.updateMatrix(),(this._state==STATE$1.ROTATE||this._state==STATE$1.ZROTATE||this._state==STATE$1.ANIMATION_ROTATE)&&this.object.up.copy(this._upState).applyQuaternion(this.object.quaternion)),er.gizmos!=null&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(er.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),this._state==STATE$1.SCALE||this._state==STATE$1.FOCUS||this._state==STATE$1.ANIMATION_FOCUS)if(this._tbRadius=this.calculateTbRadius(this.object),this.adjustNearFar){const tr=this.object.position.distanceTo(this._gizmos.position),rr=new Box3;rr.setFromObject(this._gizmos);const nr=new Sphere;rr.getBoundingSphere(nr);const sr=Math.max(this._nearPos0,nr.radius+nr.center.length()),ar=tr-this._initialNear,or=Math.min(sr,ar);this.object.near=tr-or;const lr=Math.min(this._farPos0,-nr.radius+nr.center.length()),cr=tr-this._initialFar,hr=Math.min(lr,cr);this.object.far=tr-hr,this.object.updateProjectionMatrix()}else{let tr=!1;this.object.near!=this._initialNear&&(this.object.near=this._initialNear,tr=!0),this.object.far!=this._initialFar&&(this.object.far=this._initialFar,tr=!0),tr&&this.object.updateProjectionMatrix()}}calculateAngularSpeed(er,tr,rr,nr){const sr=tr-er,ar=(nr-rr)/1e3;return ar==0?0:sr/ar}calculatePointersDistance(er,tr){return Math.sqrt(Math.pow(tr.clientX-er.clientX,2)+Math.pow(tr.clientY-er.clientY,2))}calculateRotationAxis(er,tr){return this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(er,tr).applyQuaternion(this._quat),this._rotationAxis.normalize().clone()}calculateTbRadius(er){const tr=er.position.distanceTo(this._gizmos.position);if(er.type=="PerspectiveCamera"){const rr=MathUtils.DEG2RAD*er.fov*.5,nr=Math.atan(er.aspect*Math.tan(rr));return Math.tan(Math.min(rr,nr))*tr*this.radiusFactor}else if(er.type=="OrthographicCamera")return Math.min(er.top,er.right)*this.radiusFactor}focus(er,tr,rr=1){_offset$1.copy(er).sub(this._gizmos.position).multiplyScalar(rr),this._translationMatrix.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z),_gizmoMatrixStateTemp.copy(this._gizmoMatrixState),this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),_cameraMatrixStateTemp.copy(this._cameraMatrixState),this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.enableZoom&&this.applyTransformMatrix(this.scale(tr,this._gizmos.position)),this._gizmoMatrixState.copy(_gizmoMatrixStateTemp),this._cameraMatrixState.copy(_cameraMatrixStateTemp)}drawGrid(){if(this.scene!=null){let rr,nr,sr,ar;if(this.object.isOrthographicCamera){const or=this.object.right-this.object.left,lr=this.object.bottom-this.object.top;sr=Math.max(or,lr),ar=sr/20,rr=sr/this.object.zoom*3,nr=rr/ar*this.object.zoom}else if(this.object.isPerspectiveCamera){const or=this.object.position.distanceTo(this._gizmos.position),lr=MathUtils.DEG2RAD*this.object.fov*.5,cr=Math.atan(this.object.aspect*Math.tan(lr));sr=Math.tan(Math.max(lr,cr))*or*2,ar=sr/20,rr=sr*3,nr=rr/ar}this._grid==null&&(this._grid=new GridHelper(rr,nr,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.object.quaternion),this._grid.rotateX(Math.PI*.5),this.scene.add(this._grid))}}dispose(){this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this.disconnect(),this.scene!==null&&this.scene.remove(this._gizmos),this.disposeGrid()}disposeGrid(){this._grid!=null&&this.scene!=null&&(this.scene.remove(this._grid),this._grid=null)}easeOutCubic(er){return 1-Math.pow(1-er,3)}activateGizmos(er){const tr=this._gizmos.children[0],rr=this._gizmos.children[1],nr=this._gizmos.children[2];er?(tr.material.setValues({opacity:1}),rr.material.setValues({opacity:1}),nr.material.setValues({opacity:1})):(tr.material.setValues({opacity:.6}),rr.material.setValues({opacity:.6}),nr.material.setValues({opacity:.6}))}getCursorNDC(er,tr,rr){const nr=rr.getBoundingClientRect();return this._v2_1.setX((er-nr.left)/nr.width*2-1),this._v2_1.setY((nr.bottom-tr)/nr.height*2-1),this._v2_1.clone()}getCursorPosition(er,tr,rr){return this._v2_1.copy(this.getCursorNDC(er,tr,rr)),this._v2_1.x*=(this.object.right-this.object.left)*.5,this._v2_1.y*=(this.object.top-this.object.bottom)*.5,this._v2_1.clone()}setCamera(er){er.lookAt(this.target),er.updateMatrix(),er.type=="PerspectiveCamera"&&(this._fov0=er.fov,this._fovState=er.fov),this._cameraMatrixState0.copy(er.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(er.projectionMatrix),this._zoom0=er.zoom,this._zoomState=this._zoom0,this._initialNear=er.near,this._nearPos0=er.position.distanceTo(this.target)-er.near,this._nearPos=this._initialNear,this._initialFar=er.far,this._farPos0=er.position.distanceTo(this.target)-er.far,this._farPos=this._initialFar,this._up0.copy(er.up),this._upState.copy(er.up),this.object=er,this.object.updateProjectionMatrix(),this._tbRadius=this.calculateTbRadius(er),this.makeGizmos(this.target,this._tbRadius)}setGizmosVisible(er){this._gizmos.visible=er,this.dispatchEvent(_changeEvent$5)}setTbRadius(er){this.radiusFactor=er,this._tbRadius=this.calculateTbRadius(this.object);const rr=new EllipseCurve(0,0,this._tbRadius,this._tbRadius).getPoints(this._curvePts),nr=new BufferGeometry().setFromPoints(rr);for(const sr in this._gizmos.children)this._gizmos.children[sr].geometry=nr;this.dispatchEvent(_changeEvent$5)}makeGizmos(er,tr){const nr=new EllipseCurve(0,0,tr,tr).getPoints(this._curvePts),sr=new BufferGeometry().setFromPoints(nr),ar=new LineBasicMaterial({color:16744576,fog:!1,transparent:!0,opacity:.6}),or=new LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),lr=new LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),cr=new Line(sr,ar),hr=new Line(sr,or),fr=new Line(sr,lr),ur=Math.PI*.5;if(cr.rotation.x=ur,hr.rotation.y=ur,this._gizmoMatrixState0.identity().setPosition(er),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.object.zoom!==1){const pr=1/this.object.zoom;this._scaleMatrix.makeScale(pr,pr,pr),this._translationMatrix.makeTranslation(-er.x,-er.y,-er.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(er.x,er.y,er.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.traverse(function(pr){pr.isLine&&(pr.geometry.dispose(),pr.material.dispose())}),this._gizmos.clear(),this._gizmos.add(cr),this._gizmos.add(hr),this._gizmos.add(fr)}onFocusAnim(er,tr,rr,nr){if(this._timeStart==-1&&(this._timeStart=er),this._state==STATE$1.ANIMATION_FOCUS){const ar=(er-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(nr),ar>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(tr,this.scaleFactor),this._timeStart=-1,this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5);else{const or=this.easeOutCubic(ar),lr=1-or+this.scaleFactor*or;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(tr,lr,or),this.dispatchEvent(_changeEvent$5);const cr=this;this._animationId=window.requestAnimationFrame(function(hr){cr.onFocusAnim(hr,tr,rr,nr.clone())})}}else this._animationId=-1,this._timeStart=-1}onRotationAnim(er,tr,rr){if(this._timeStart==-1&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=er),this._state==STATE$1.ANIMATION_ROTATE){const nr=(er-this._timeStart)/1e3;if(rr+-this.dampingFactor*nr>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(nr,2)+rr*nr+0,this.applyTransformMatrix(this.rotate(tr,this._angleCurrent)),this.dispatchEvent(_changeEvent$5);const ar=this;this._animationId=window.requestAnimationFrame(function(or){ar.onRotationAnim(or,tr,rr)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)}else this._animationId=-1,this._timeStart=-1,this._state!=STATE$1.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5))}pan(er,tr,rr=!1){const nr=er.clone().sub(tr);if(this.object.isOrthographicCamera)nr.multiplyScalar(1/this.object.zoom);else if(this.object.isPerspectiveCamera&&rr){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const sr=this._v3_1.distanceTo(this._v3_2)/this.object.position.distanceTo(this._gizmos.position);nr.multiplyScalar(1/sr)}return this._v3_1.set(nr.x,nr.y,0).applyQuaternion(this.object.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1),_transformation}reset(){this.object.zoom=this._zoom0,this.object.isPerspectiveCamera&&(this.object.fov=this._fov0),this.object.near=this._nearPos,this.object.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.up.copy(this._up0),this.object.updateMatrix(),this.object.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.object),this.makeGizmos(this._gizmos.position,this._tbRadius),this.object.lookAt(this._gizmos.position),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5)}rotate(er,tr){const rr=this._gizmos.position;return this._translationMatrix.makeTranslation(-rr.x,-rr.y,-rr.z),this._rotationMatrix.makeRotationAxis(er,-tr),this._m4_1.makeTranslation(rr.x,rr.y,rr.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),_transformation}copyState(){let er;this.object.isOrthographicCamera?er=JSON.stringify({arcballState:{cameraFar:this.object.far,cameraMatrix:this.object.matrix,cameraNear:this.object.near,cameraUp:this.object.up,cameraZoom:this.object.zoom,gizmoMatrix:this._gizmos.matrix}}):this.object.isPerspectiveCamera&&(er=JSON.stringify({arcballState:{cameraFar:this.object.far,cameraFov:this.object.fov,cameraMatrix:this.object.matrix,cameraNear:this.object.near,cameraUp:this.object.up,cameraZoom:this.object.zoom,gizmoMatrix:this._gizmos.matrix}})),navigator.clipboard.writeText(er)}pasteState(){const er=this;navigator.clipboard.readText().then(function(rr){er.setStateFromJSON(rr)})}saveState(){this._cameraMatrixState0.copy(this.object.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.object.near,this._farPos=this.object.far,this._zoom0=this.object.zoom,this._up0.copy(this.object.up),this.object.isPerspectiveCamera&&(this._fov0=this.object.fov)}scale(er,tr,rr=!0){_scalePointTemp.copy(tr);let nr=1/er;if(this.object.isOrthographicCamera){this.object.zoom=this._zoomState,this.object.zoom*=er,this.object.zoom>this.maxZoom?(this.object.zoom=this.maxZoom,nr=this._zoomState/this.maxZoom):this.object.zoom<this.minZoom&&(this.object.zoom=this.minZoom,nr=this._zoomState/this.minZoom),this.object.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(nr,nr,nr),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),_scalePointTemp.sub(this._v3_1);const sr=_scalePointTemp.clone().multiplyScalar(nr);return _scalePointTemp.sub(sr),this._m4_1.makeTranslation(_scalePointTemp.x,_scalePointTemp.y,_scalePointTemp.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),_transformation}else if(this.object.isPerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let sr=this._v3_1.distanceTo(_scalePointTemp),ar=sr-sr*nr;const or=sr-ar;if(or<this.minDistance?(nr=this.minDistance/sr,ar=sr-sr*nr):or>this.maxDistance&&(nr=this.maxDistance/sr,ar=sr-sr*nr),_offset$1.copy(_scalePointTemp).sub(this._v3_1).normalize().multiplyScalar(ar),this._m4_1.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z),rr){const lr=this._v3_2;sr=lr.distanceTo(_scalePointTemp),ar=sr-sr*nr,_offset$1.copy(_scalePointTemp).sub(this._v3_2).normalize().multiplyScalar(ar),this._translationMatrix.makeTranslation(lr.x,lr.y,lr.z),this._scaleMatrix.makeScale(nr,nr,nr),this._m4_2.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-lr.x,-lr.y,-lr.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return _transformation}}setFov(er){this.object.isPerspectiveCamera&&(this.object.fov=MathUtils.clamp(er,this.minFov,this.maxFov),this.object.updateProjectionMatrix())}setTransformationMatrices(er=null,tr=null){er!=null?_transformation.camera!=null?_transformation.camera.copy(er):_transformation.camera=er.clone():_transformation.camera=null,tr!=null?_transformation.gizmos!=null?_transformation.gizmos.copy(tr):_transformation.gizmos=tr.clone():_transformation.gizmos=null}zRotate(er,tr){return this._rotationMatrix.makeRotationAxis(this._rotationAxis,tr),this._translationMatrix.makeTranslation(-er.x,-er.y,-er.z),this._m4_1.makeTranslation(er.x,er.y,er.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(er),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,tr),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),_transformation}getRaycaster(){return _raycaster$2}unprojectOnObj(er,tr){const rr=this.getRaycaster();rr.near=tr.near,rr.far=tr.far,rr.setFromCamera(er,tr);const nr=rr.intersectObjects(this.scene.children,!0);for(let sr=0;sr<nr.length;sr++)if(nr[sr].object.uuid!=this._gizmos.uuid&&nr[sr].face!=null)return nr[sr].point.clone();return null}unprojectOnTbSurface(er,tr,rr,nr,sr){if(er.type=="OrthographicCamera"){this._v2_1.copy(this.getCursorPosition(tr,rr,nr)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const ar=Math.pow(this._v2_1.x,2),or=Math.pow(this._v2_1.y,2),lr=Math.pow(this._tbRadius,2);return ar+or<=lr*.5?this._v3_1.setZ(Math.sqrt(lr-(ar+or))):this._v3_1.setZ(lr*.5/Math.sqrt(ar+or)),this._v3_1}else if(er.type=="PerspectiveCamera"){this._v2_1.copy(this.getCursorNDC(tr,rr,nr)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(er.projectionMatrixInverse);const ar=this._v3_1.clone().normalize(),or=er.position.distanceTo(this._gizmos.position),lr=Math.pow(sr,2),cr=this._v3_1.z,hr=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(hr==0)return ar.set(this._v3_1.x,this._v3_1.y,sr),ar;const fr=cr/hr,ur=or;let pr=Math.pow(fr,2)+1,gr=2*fr*ur,_r=Math.pow(ur,2)-lr,mr=Math.pow(gr,2)-4*pr*_r;if(mr>=0&&(this._v2_1.setX((-gr-Math.sqrt(mr))/(2*pr)),this._v2_1.setY(fr*this._v2_1.x+ur),MathUtils.RAD2DEG*this._v2_1.angle()>=45)){const Ar=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(or-this._v2_1.y,2));return ar.multiplyScalar(Ar),ar.z+=or,ar}pr=fr,gr=ur,_r=-lr*.5,mr=Math.pow(gr,2)-4*pr*_r,this._v2_1.setX((-gr-Math.sqrt(mr))/(2*pr)),this._v2_1.setY(fr*this._v2_1.x+ur);const dr=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(or-this._v2_1.y,2));return ar.multiplyScalar(dr),ar.z+=or,ar}}unprojectOnTbPlane(er,tr,rr,nr,sr=!1){if(er.type=="OrthographicCamera")return this._v2_1.copy(this.getCursorPosition(tr,rr,nr)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(er.type=="PerspectiveCamera"){this._v2_1.copy(this.getCursorNDC(tr,rr,nr)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(er.projectionMatrixInverse);const ar=this._v3_1.clone().normalize(),or=this._v3_1.z,lr=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let cr;if(sr?cr=this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):cr=er.position.distanceTo(this._gizmos.position),lr==0)return ar.set(0,0,0),ar;const hr=or/lr,fr=cr,ur=-fr/hr,pr=Math.sqrt(Math.pow(fr,2)+Math.pow(ur,2));return ar.multiplyScalar(pr),ar.z=0,ar}}updateMatrixState(){this._cameraMatrixState.copy(this.object.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.object.isOrthographicCamera?(this._cameraProjectionState.copy(this.object.projectionMatrix),this.object.updateProjectionMatrix(),this._zoomState=this.object.zoom):this.object.isPerspectiveCamera&&(this._fovState=this.object.fov)}updateTbState(er,tr){this._state=er,tr&&this.updateMatrixState()}update(){if(this.target.equals(this._currentTarget)===!1&&(this._gizmos.position.copy(this.target),this._tbRadius=this.calculateTbRadius(this.object),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)),this.object.isOrthographicCamera){if(this.object.zoom>this.maxZoom||this.object.zoom<this.minZoom){const er=MathUtils.clamp(this.object.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.scale(er/this.object.zoom,this._gizmos.position,!0))}}else if(this.object.isPerspectiveCamera){const er=this.object.position.distanceTo(this._gizmos.position);if(er>this.maxDistance+_EPS$3||er<this.minDistance-_EPS$3){const rr=MathUtils.clamp(er,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.scale(rr/er,this._gizmos.position)),this.updateMatrixState()}(this.object.fov<this.minFov||this.object.fov>this.maxFov)&&(this.object.fov=MathUtils.clamp(this.object.fov,this.minFov,this.maxFov),this.object.updateProjectionMatrix());const tr=this._tbRadius;if(this._tbRadius=this.calculateTbRadius(this.object),tr<this._tbRadius-_EPS$3||tr>this._tbRadius+_EPS$3){const rr=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,nr=this._tbRadius/rr,ar=new EllipseCurve(0,0,nr,nr).getPoints(this._curvePts),or=new BufferGeometry().setFromPoints(ar);for(const lr in this._gizmos.children)this._gizmos.children[lr].geometry=or}}this.object.lookAt(this._gizmos.position)}setStateFromJSON(er){const tr=JSON.parse(er);if(tr.arcballState!=null){this._cameraMatrixState.fromArray(tr.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.up.copy(tr.arcballState.cameraUp),this.object.near=tr.arcballState.cameraNear,this.object.far=tr.arcballState.cameraFar,this.object.zoom=tr.arcballState.cameraZoom,this.object.isPerspectiveCamera&&(this.object.fov=tr.arcballState.cameraFov),this._gizmoMatrixState.fromArray(tr.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.object.updateMatrix(),this.object.updateProjectionMatrix(),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.object);const rr=new Matrix4().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(rr),this.object.lookAt(this._gizmos.position),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5)}}}function onWindowResize(){const ir=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;this._tbRadius=this.calculateTbRadius(this.object);const er=this._tbRadius/ir,rr=new EllipseCurve(0,0,er,er).getPoints(this._curvePts),nr=new BufferGeometry().setFromPoints(rr);for(const sr in this._gizmos.children)this._gizmos.children[sr].geometry=nr;this.dispatchEvent(_changeEvent$5)}function onContextMenu$5(ir){if(this.enabled){for(let er=0;er<this.mouseActions.length;er++)if(this.mouseActions[er].mouse==2){ir.preventDefault();break}}}function onPointerCancel$3(){this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=INPUT.NONE}function onPointerDown$6(ir){if(ir.button==0&&ir.isPrimary?(this._downValid=!0,this._downEvents.push(ir),this._downStart=performance.now()):this._downValid=!1,ir.pointerType=="touch"&&this._input!=INPUT.CURSOR)switch(this._touchStart.push(ir),this._touchCurrent.push(ir),this._input){case INPUT.NONE:this._input=INPUT.ONE_FINGER,this.onSinglePanStart(ir,"ROTATE"),window.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp);break;case INPUT.ONE_FINGER:case INPUT.ONE_FINGER_SWITCHED:this._input=INPUT.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case INPUT.TWO_FINGER:this._input=INPUT.MULT_FINGER,this.onTriplePanStart(ir);break}else if(ir.pointerType!="touch"&&this._input==INPUT.NONE){let er=null;ir.ctrlKey||ir.metaKey?er="CTRL":ir.shiftKey&&(er="SHIFT"),this._mouseOp=this.getOpFromAction(ir.button,er),this._mouseOp!=null&&(window.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp),this._input=INPUT.CURSOR,this._button=ir.button,this.onSinglePanStart(ir,this._mouseOp))}}function onPointerMove$6(ir){if(ir.pointerType=="touch"&&this._input!=INPUT.CURSOR)switch(this._input){case INPUT.ONE_FINGER:this.updateTouchEvent(ir),this.onSinglePanMove(ir,STATE$1.ROTATE);break;case INPUT.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],ir)*this._devPxRatio>=this._switchSensibility){this._input=INPUT.ONE_FINGER,this.updateTouchEvent(ir),this.onSinglePanStart(ir,"ROTATE");break}break;case INPUT.TWO_FINGER:this.updateTouchEvent(ir),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case INPUT.MULT_FINGER:this.updateTouchEvent(ir),this.onTriplePanMove(ir);break}else if(ir.pointerType!="touch"&&this._input==INPUT.CURSOR){let er=null;ir.ctrlKey||ir.metaKey?er="CTRL":ir.shiftKey&&(er="SHIFT");const tr=this.getOpStateFromAction(this._button,er);tr!=null&&this.onSinglePanMove(ir,tr)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],ir)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}function onPointerUp$5(ir){if(ir.pointerType=="touch"&&this._input!=INPUT.CURSOR){const er=this._touchCurrent.length;for(let tr=0;tr<er;tr++)if(this._touchCurrent[tr].pointerId==ir.pointerId){this._touchCurrent.splice(tr,1),this._touchStart.splice(tr,1);break}switch(this._input){case INPUT.ONE_FINGER:case INPUT.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=INPUT.NONE,this.onSinglePanEnd();break;case INPUT.TWO_FINGER:this.onDoublePanEnd(ir),this.onPinchEnd(ir),this.onRotateEnd(ir),this._input=INPUT.ONE_FINGER_SWITCHED;break;case INPUT.MULT_FINGER:this._touchCurrent.length==0&&(window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=INPUT.NONE,this.onTriplePanEnd());break}}else ir.pointerType!="touch"&&this._input==INPUT.CURSOR&&(window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=INPUT.NONE,this.onSinglePanEnd(),this._button=-1);if(ir.isPrimary)if(this._downValid)if(ir.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(this._nclicks==0)this._nclicks=1,this._clickStart=performance.now();else{const tr=ir.timeStamp-this._clickStart,rr=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;tr<=this._maxInterval&&rr<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(ir)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}function onWheel(ir){if(this.enabled&&this.enableZoom){let er=null;ir.ctrlKey||ir.metaKey?er="CTRL":ir.shiftKey&&(er="SHIFT");const tr=this.getOpFromAction("WHEEL",er);if(tr!=null){ir.preventDefault(),this.dispatchEvent(_startEvent$2);const rr=125;let nr=ir.deltaY/rr,sr=1;switch(nr>0?sr=1/this.scaleFactor:nr<0&&(sr=this.scaleFactor),tr){case"ZOOM":if(this.updateTbState(STATE$1.SCALE,!0),nr>0?sr=1/Math.pow(this.scaleFactor,nr):nr<0&&(sr=Math.pow(this.scaleFactor,-nr)),this.cursorZoom&&this.enablePan){let ar;this.object.isOrthographicCamera?ar=this.unprojectOnTbPlane(this.object,ir.clientX,ir.clientY,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._gizmos.position):this.object.isPerspectiveCamera&&(ar=this.unprojectOnTbPlane(this.object,ir.clientX,ir.clientY,this.domElement).applyQuaternion(this.object.quaternion).add(this._gizmos.position)),this.applyTransformMatrix(this.scale(sr,ar))}else this.applyTransformMatrix(this.scale(sr,this._gizmos.position));this._grid!=null&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5),this.dispatchEvent(_endEvent$2);break;case"FOV":if(this.object.isPerspectiveCamera){this.updateTbState(STATE$1.FOV,!0),ir.deltaX!=0&&(nr=ir.deltaX/rr,sr=1,nr>0?sr=1/Math.pow(this.scaleFactor,nr):nr<0&&(sr=Math.pow(this.scaleFactor,-nr))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const ar=this._v3_1.distanceTo(this._gizmos.position);let or=ar/sr;or=MathUtils.clamp(or,this.minDistance,this.maxDistance);const lr=ar*Math.tan(MathUtils.DEG2RAD*this.object.fov*.5);let cr=MathUtils.RAD2DEG*(Math.atan(lr/or)*2);cr>this.maxFov?cr=this.maxFov:cr<this.minFov&&(cr=this.minFov);const hr=lr/Math.tan(MathUtils.DEG2RAD*(cr/2));sr=ar/hr,this.setFov(cr),this.applyTransformMatrix(this.scale(sr,this._gizmos.position,!1))}this._grid!=null&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5),this.dispatchEvent(_endEvent$2);break}}}}const _plane$3=new Plane,_pointer$1=new Vector2,_offset=new Vector3$1,_diff=new Vector2,_previousPointer=new Vector2,_intersection=new Vector3$1,_worldPosition=new Vector3$1,_inverseMatrix=new Matrix4,_up$1=new Vector3$1,_right=new Vector3$1;let _selected=null,_hovered=null;const _intersections=[],STATE={NONE:-1,PAN:0,ROTATE:1};class DragControls extends Controls{constructor(er,tr,rr=null){super(tr,rr),this.objects=er,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new Raycaster,this.mouseButtons={LEFT:MOUSE.PAN,MIDDLE:MOUSE.PAN,RIGHT:MOUSE.ROTATE},this.touches={ONE:TOUCH.PAN},this._onPointerMove=onPointerMove$5.bind(this),this._onPointerDown=onPointerDown$5.bind(this),this._onPointerCancel=onPointerCancel$2.bind(this),this._onContextMenu=onContextMenu$4.bind(this),rr!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(er){const tr=this.domElement.getBoundingClientRect();_pointer$1.x=(er.clientX-tr.left)/tr.width*2-1,_pointer$1.y=-(er.clientY-tr.top)/tr.height*2+1}_updateState(er){let tr;if(er.pointerType==="touch")tr=this.touches.ONE;else switch(er.button){case 0:tr=this.mouseButtons.LEFT;break;case 1:tr=this.mouseButtons.MIDDLE;break;case 2:tr=this.mouseButtons.RIGHT;break;default:tr=null}switch(tr){case MOUSE.PAN:case TOUCH.PAN:this.state=STATE.PAN;break;case MOUSE.ROTATE:case TOUCH.ROTATE:this.state=STATE.ROTATE;break;default:this.state=STATE.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(er){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=er}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(er){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function onPointerMove$5(ir){const er=this.object,tr=this.domElement,rr=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(ir),rr.setFromCamera(_pointer$1,er),_selected)this.state===STATE.PAN?rr.ray.intersectPlane(_plane$3,_intersection)&&_selected.position.copy(_intersection.sub(_offset).applyMatrix4(_inverseMatrix)):this.state===STATE.ROTATE&&(_diff.subVectors(_pointer$1,_previousPointer).multiplyScalar(this.rotateSpeed),_selected.rotateOnWorldAxis(_up$1,_diff.x),_selected.rotateOnWorldAxis(_right.normalize(),-_diff.y)),this.dispatchEvent({type:"drag",object:_selected}),_previousPointer.copy(_pointer$1);else if(ir.pointerType==="mouse"||ir.pointerType==="pen")if(_intersections.length=0,rr.setFromCamera(_pointer$1,er),rr.intersectObjects(this.objects,this.recursive,_intersections),_intersections.length>0){const nr=_intersections[0].object;_plane$3.setFromNormalAndCoplanarPoint(er.getWorldDirection(_plane$3.normal),_worldPosition.setFromMatrixPosition(nr.matrixWorld)),_hovered!==nr&&_hovered!==null&&(this.dispatchEvent({type:"hoveroff",object:_hovered}),tr.style.cursor="auto",_hovered=null),_hovered!==nr&&(this.dispatchEvent({type:"hoveron",object:nr}),tr.style.cursor="pointer",_hovered=nr)}else _hovered!==null&&(this.dispatchEvent({type:"hoveroff",object:_hovered}),tr.style.cursor="auto",_hovered=null);_previousPointer.copy(_pointer$1)}}function onPointerDown$5(ir){const er=this.object,tr=this.domElement,rr=this.raycaster;this.enabled!==!1&&(this._updatePointer(ir),this._updateState(ir),_intersections.length=0,rr.setFromCamera(_pointer$1,er),rr.intersectObjects(this.objects,this.recursive,_intersections),_intersections.length>0&&(this.transformGroup===!0?_selected=findGroup(_intersections[0].object):_selected=_intersections[0].object,_plane$3.setFromNormalAndCoplanarPoint(er.getWorldDirection(_plane$3.normal),_worldPosition.setFromMatrixPosition(_selected.matrixWorld)),rr.ray.intersectPlane(_plane$3,_intersection)&&(this.state===STATE.PAN?(_inverseMatrix.copy(_selected.parent.matrixWorld).invert(),_offset.copy(_intersection).sub(_worldPosition.setFromMatrixPosition(_selected.matrixWorld))):this.state===STATE.ROTATE&&(_up$1.set(0,1,0).applyQuaternion(er.quaternion).normalize(),_right.set(1,0,0).applyQuaternion(er.quaternion).normalize())),tr.style.cursor="move",this.dispatchEvent({type:"dragstart",object:_selected})),_previousPointer.copy(_pointer$1))}function onPointerCancel$2(){this.enabled!==!1&&(_selected&&(this.dispatchEvent({type:"dragend",object:_selected}),_selected=null),this.domElement.style.cursor=_hovered?"pointer":"auto",this.state=STATE.NONE)}function onContextMenu$4(ir){this.enabled!==!1&&ir.preventDefault()}function findGroup(ir,er=null){return ir.isGroup&&(er=ir),ir.parent===null?er:findGroup(ir.parent,er)}const _lookDirection=new Vector3$1,_spherical=new Spherical,_target=new Vector3$1,_targetPosition=new Vector3$1;class FirstPersonControls extends Controls{constructor(er,tr=null){super(er,tr),this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this._autoSpeedFactor=0,this._pointerX=0,this._pointerY=0,this._moveForward=!1,this._moveBackward=!1,this._moveLeft=!1,this._moveRight=!1,this._viewHalfX=0,this._viewHalfY=0,this._lat=0,this._lon=0,this._onPointerMove=onPointerMove$4.bind(this),this._onPointerDown=onPointerDown$4.bind(this),this._onPointerUp=onPointerUp$4.bind(this),this._onContextMenu=onContextMenu$3.bind(this),this._onKeyDown=onKeyDown$3.bind(this),this._onKeyUp=onKeyUp$2.bind(this),tr!==null&&(this.connect(),this.handleResize()),this._setOrientation()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerMove),this.domElement.removeEventListener("pointermove",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}handleResize(){this.domElement===document?(this._viewHalfX=window.innerWidth/2,this._viewHalfY=window.innerHeight/2):(this._viewHalfX=this.domElement.offsetWidth/2,this._viewHalfY=this.domElement.offsetHeight/2)}lookAt(er,tr,rr){return er.isVector3?_target.copy(er):_target.set(er,tr,rr),this.object.lookAt(_target),this._setOrientation(),this}update(er){if(this.enabled===!1)return;if(this.heightSpeed){const cr=MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this._autoSpeedFactor=er*(cr*this.heightCoef)}else this._autoSpeedFactor=0;const tr=er*this.movementSpeed;(this._moveForward||this.autoForward&&!this._moveBackward)&&this.object.translateZ(-(tr+this._autoSpeedFactor)),this._moveBackward&&this.object.translateZ(tr),this._moveLeft&&this.object.translateX(-tr),this._moveRight&&this.object.translateX(tr),this._moveUp&&this.object.translateY(tr),this._moveDown&&this.object.translateY(-tr);let rr=er*this.lookSpeed;this.activeLook||(rr=0);let nr=1;this.constrainVertical&&(nr=Math.PI/(this.verticalMax-this.verticalMin)),this._lon-=this._pointerX*rr,this.lookVertical&&(this._lat-=this._pointerY*rr*nr),this._lat=Math.max(-85,Math.min(85,this._lat));let sr=MathUtils.degToRad(90-this._lat);const ar=MathUtils.degToRad(this._lon);this.constrainVertical&&(sr=MathUtils.mapLinear(sr,0,Math.PI,this.verticalMin,this.verticalMax));const or=this.object.position;_targetPosition.setFromSphericalCoords(1,sr,ar).add(or),this.object.lookAt(_targetPosition)}_setOrientation(){const er=this.object.quaternion;_lookDirection.set(0,0,-1).applyQuaternion(er),_spherical.setFromVector3(_lookDirection),this._lat=90-MathUtils.radToDeg(_spherical.phi),this._lon=MathUtils.radToDeg(_spherical.theta)}}function onPointerDown$4(ir){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(ir.button){case 0:this._moveForward=!0;break;case 2:this._moveBackward=!0;break}this.mouseDragOn=!0}function onPointerUp$4(ir){if(this.activeLook)switch(ir.button){case 0:this._moveForward=!1;break;case 2:this._moveBackward=!1;break}this.mouseDragOn=!1}function onPointerMove$4(ir){this.domElement===document?(this._pointerX=ir.pageX-this._viewHalfX,this._pointerY=ir.pageY-this._viewHalfY):(this._pointerX=ir.pageX-this.domElement.offsetLeft-this._viewHalfX,this._pointerY=ir.pageY-this.domElement.offsetTop-this._viewHalfY)}function onKeyDown$3(ir){switch(ir.code){case"ArrowUp":case"KeyW":this._moveForward=!0;break;case"ArrowLeft":case"KeyA":this._moveLeft=!0;break;case"ArrowDown":case"KeyS":this._moveBackward=!0;break;case"ArrowRight":case"KeyD":this._moveRight=!0;break;case"KeyR":this._moveUp=!0;break;case"KeyF":this._moveDown=!0;break}}function onKeyUp$2(ir){switch(ir.code){case"ArrowUp":case"KeyW":this._moveForward=!1;break;case"ArrowLeft":case"KeyA":this._moveLeft=!1;break;case"ArrowDown":case"KeyS":this._moveBackward=!1;break;case"ArrowRight":case"KeyD":this._moveRight=!1;break;case"KeyR":this._moveUp=!1;break;case"KeyF":this._moveDown=!1;break}}function onContextMenu$3(ir){this.enabled!==!1&&ir.preventDefault()}const _changeEvent$4={type:"change"},_EPS$2=1e-6,_tmpQuaternion=new Quaternion$1;class FlyControls extends Controls{constructor(er,tr=null){super(er,tr),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new Vector3$1(0,0,0),this._rotationVector=new Vector3$1(0,0,0),this._lastQuaternion=new Quaternion$1,this._lastPosition=new Vector3$1,this._status=0,this._onKeyDown=onKeyDown$2.bind(this),this._onKeyUp=onKeyUp$1.bind(this),this._onPointerMove=onPointerMove$3.bind(this),this._onPointerDown=onPointerDown$3.bind(this),this._onPointerUp=onPointerUp$3.bind(this),this._onPointerCancel=onPointerCancel$1.bind(this),this._onContextMenu=onContextMenu$2.bind(this),tr!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(er){if(this.enabled===!1)return;const tr=this.object,rr=er*this.movementSpeed,nr=er*this.rollSpeed;tr.translateX(this._moveVector.x*rr),tr.translateY(this._moveVector.y*rr),tr.translateZ(this._moveVector.z*rr),_tmpQuaternion.set(this._rotationVector.x*nr,this._rotationVector.y*nr,this._rotationVector.z*nr,1).normalize(),tr.quaternion.multiply(_tmpQuaternion),(this._lastPosition.distanceToSquared(tr.position)>_EPS$2||8*(1-this._lastQuaternion.dot(tr.quaternion))>_EPS$2)&&(this.dispatchEvent(_changeEvent$4),this._lastQuaternion.copy(tr.quaternion),this._lastPosition.copy(tr.position))}_updateMovementVector(){const er=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-er+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function onKeyDown$2(ir){if(!(ir.altKey||this.enabled===!1)){switch(ir.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function onKeyUp$1(ir){if(this.enabled!==!1){switch(ir.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function onPointerDown$3(ir){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(ir.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function onPointerMove$3(ir){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const er=this._getContainerDimensions(),tr=er.size[0]/2,rr=er.size[1]/2;this._moveState.yawLeft=-(ir.pageX-er.offset[0]-tr)/tr,this._moveState.pitchDown=(ir.pageY-er.offset[1]-rr)/rr,this._updateRotationVector()}}function onPointerUp$3(ir){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(ir.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function onPointerCancel$1(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function onContextMenu$2(ir){this.enabled!==!1&&ir.preventDefault()}const _changeEvent$3={type:"change"},_startEvent$1={type:"start"},_endEvent$1={type:"end"},_ray$2=new Ray$1,_plane$2=new Plane,_TILT_LIMIT=Math.cos(70*MathUtils.DEG2RAD),_v=new Vector3$1,_twoPI=2*Math.PI,_STATE$1={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},_EPS$1=1e-6;class OrbitControls extends Controls{constructor(er,tr=null){super(er,tr),this.state=_STATE$1.NONE,this.enabled=!0,this.target=new Vector3$1,this.cursor=new Vector3$1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Vector3$1,this._lastQuaternion=new Quaternion$1,this._lastTargetPosition=new Vector3$1,this._quat=new Quaternion$1().setFromUnitVectors(er.up,new Vector3$1(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Spherical,this._sphericalDelta=new Spherical,this._scale=1,this._panOffset=new Vector3$1,this._rotateStart=new Vector2,this._rotateEnd=new Vector2,this._rotateDelta=new Vector2,this._panStart=new Vector2,this._panEnd=new Vector2,this._panDelta=new Vector2,this._dollyStart=new Vector2,this._dollyEnd=new Vector2,this._dollyDelta=new Vector2,this._dollyDirection=new Vector3$1,this._mouse=new Vector2,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=onPointerMove$2.bind(this),this._onPointerDown=onPointerDown$2.bind(this),this._onPointerUp=onPointerUp$2.bind(this),this._onContextMenu=onContextMenu$1.bind(this),this._onMouseWheel=onMouseWheel$1.bind(this),this._onKeyDown=onKeyDown$1.bind(this),this._onTouchStart=onTouchStart$1.bind(this),this._onTouchMove=onTouchMove$1.bind(this),this._onMouseDown=onMouseDown$1.bind(this),this._onMouseMove=onMouseMove$2.bind(this),this._interceptControlDown=interceptControlDown.bind(this),this._interceptControlUp=interceptControlUp.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(er){er.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=er}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(_changeEvent$3),this.update(),this.state=_STATE$1.NONE}update(er=null){const tr=this.object.position;_v.copy(tr).sub(this.target),_v.applyQuaternion(this._quat),this._spherical.setFromVector3(_v),this.autoRotate&&this.state===_STATE$1.NONE&&this._rotateLeft(this._getAutoRotationAngle(er)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let rr=this.minAzimuthAngle,nr=this.maxAzimuthAngle;isFinite(rr)&&isFinite(nr)&&(rr<-Math.PI?rr+=_twoPI:rr>Math.PI&&(rr-=_twoPI),nr<-Math.PI?nr+=_twoPI:nr>Math.PI&&(nr-=_twoPI),rr<=nr?this._spherical.theta=Math.max(rr,Math.min(nr,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(rr+nr)/2?Math.max(rr,this._spherical.theta):Math.min(nr,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let sr=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const ar=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),sr=ar!=this._spherical.radius}if(_v.setFromSpherical(this._spherical),_v.applyQuaternion(this._quatInverse),tr.copy(this.target).add(_v),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let ar=null;if(this.object.isPerspectiveCamera){const or=_v.length();ar=this._clampDistance(or*this._scale);const lr=or-ar;this.object.position.addScaledVector(this._dollyDirection,lr),this.object.updateMatrixWorld(),sr=!!lr}else if(this.object.isOrthographicCamera){const or=new Vector3$1(this._mouse.x,this._mouse.y,0);or.unproject(this.object);const lr=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),sr=lr!==this.object.zoom;const cr=new Vector3$1(this._mouse.x,this._mouse.y,0);cr.unproject(this.object),this.object.position.sub(cr).add(or),this.object.updateMatrixWorld(),ar=_v.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;ar!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(ar).add(this.object.position):(_ray$2.origin.copy(this.object.position),_ray$2.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(_ray$2.direction))<_TILT_LIMIT?this.object.lookAt(this.target):(_plane$2.setFromNormalAndCoplanarPoint(this.object.up,this.target),_ray$2.intersectPlane(_plane$2,this.target))))}else if(this.object.isOrthographicCamera){const ar=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),ar!==this.object.zoom&&(this.object.updateProjectionMatrix(),sr=!0)}return this._scale=1,this._performCursorZoom=!1,sr||this._lastPosition.distanceToSquared(this.object.position)>_EPS$1||8*(1-this._lastQuaternion.dot(this.object.quaternion))>_EPS$1||this._lastTargetPosition.distanceToSquared(this.target)>_EPS$1?(this.dispatchEvent(_changeEvent$3),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(er){return er!==null?_twoPI/60*this.autoRotateSpeed*er:_twoPI/60/60*this.autoRotateSpeed}_getZoomScale(er){const tr=Math.abs(er*.01);return Math.pow(.95,this.zoomSpeed*tr)}_rotateLeft(er){this._sphericalDelta.theta-=er}_rotateUp(er){this._sphericalDelta.phi-=er}_panLeft(er,tr){_v.setFromMatrixColumn(tr,0),_v.multiplyScalar(-er),this._panOffset.add(_v)}_panUp(er,tr){this.screenSpacePanning===!0?_v.setFromMatrixColumn(tr,1):(_v.setFromMatrixColumn(tr,0),_v.crossVectors(this.object.up,_v)),_v.multiplyScalar(er),this._panOffset.add(_v)}_pan(er,tr){const rr=this.domElement;if(this.object.isPerspectiveCamera){const nr=this.object.position;_v.copy(nr).sub(this.target);let sr=_v.length();sr*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*er*sr/rr.clientHeight,this.object.matrix),this._panUp(2*tr*sr/rr.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(er*(this.object.right-this.object.left)/this.object.zoom/rr.clientWidth,this.object.matrix),this._panUp(tr*(this.object.top-this.object.bottom)/this.object.zoom/rr.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(er){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=er:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(er){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=er:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(er,tr){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const rr=this.domElement.getBoundingClientRect(),nr=er-rr.left,sr=tr-rr.top,ar=rr.width,or=rr.height;this._mouse.x=nr/ar*2-1,this._mouse.y=-(sr/or)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(er){return Math.max(this.minDistance,Math.min(this.maxDistance,er))}_handleMouseDownRotate(er){this._rotateStart.set(er.clientX,er.clientY)}_handleMouseDownDolly(er){this._updateZoomParameters(er.clientX,er.clientX),this._dollyStart.set(er.clientX,er.clientY)}_handleMouseDownPan(er){this._panStart.set(er.clientX,er.clientY)}_handleMouseMoveRotate(er){this._rotateEnd.set(er.clientX,er.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const tr=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/tr.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/tr.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(er){this._dollyEnd.set(er.clientX,er.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(er){this._panEnd.set(er.clientX,er.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(er){this._updateZoomParameters(er.clientX,er.clientY),er.deltaY<0?this._dollyIn(this._getZoomScale(er.deltaY)):er.deltaY>0&&this._dollyOut(this._getZoomScale(er.deltaY)),this.update()}_handleKeyDown(er){let tr=!1;switch(er.code){case this.keys.UP:er.ctrlKey||er.metaKey||er.shiftKey?this.enableRotate&&this._rotateUp(_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),tr=!0;break;case this.keys.BOTTOM:er.ctrlKey||er.metaKey||er.shiftKey?this.enableRotate&&this._rotateUp(-_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),tr=!0;break;case this.keys.LEFT:er.ctrlKey||er.metaKey||er.shiftKey?this.enableRotate&&this._rotateLeft(_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),tr=!0;break;case this.keys.RIGHT:er.ctrlKey||er.metaKey||er.shiftKey?this.enableRotate&&this._rotateLeft(-_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),tr=!0;break}tr&&(er.preventDefault(),this.update())}_handleTouchStartRotate(er){if(this._pointers.length===1)this._rotateStart.set(er.pageX,er.pageY);else{const tr=this._getSecondPointerPosition(er),rr=.5*(er.pageX+tr.x),nr=.5*(er.pageY+tr.y);this._rotateStart.set(rr,nr)}}_handleTouchStartPan(er){if(this._pointers.length===1)this._panStart.set(er.pageX,er.pageY);else{const tr=this._getSecondPointerPosition(er),rr=.5*(er.pageX+tr.x),nr=.5*(er.pageY+tr.y);this._panStart.set(rr,nr)}}_handleTouchStartDolly(er){const tr=this._getSecondPointerPosition(er),rr=er.pageX-tr.x,nr=er.pageY-tr.y,sr=Math.sqrt(rr*rr+nr*nr);this._dollyStart.set(0,sr)}_handleTouchStartDollyPan(er){this.enableZoom&&this._handleTouchStartDolly(er),this.enablePan&&this._handleTouchStartPan(er)}_handleTouchStartDollyRotate(er){this.enableZoom&&this._handleTouchStartDolly(er),this.enableRotate&&this._handleTouchStartRotate(er)}_handleTouchMoveRotate(er){if(this._pointers.length==1)this._rotateEnd.set(er.pageX,er.pageY);else{const rr=this._getSecondPointerPosition(er),nr=.5*(er.pageX+rr.x),sr=.5*(er.pageY+rr.y);this._rotateEnd.set(nr,sr)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const tr=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/tr.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/tr.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(er){if(this._pointers.length===1)this._panEnd.set(er.pageX,er.pageY);else{const tr=this._getSecondPointerPosition(er),rr=.5*(er.pageX+tr.x),nr=.5*(er.pageY+tr.y);this._panEnd.set(rr,nr)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(er){const tr=this._getSecondPointerPosition(er),rr=er.pageX-tr.x,nr=er.pageY-tr.y,sr=Math.sqrt(rr*rr+nr*nr);this._dollyEnd.set(0,sr),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const ar=(er.pageX+tr.x)*.5,or=(er.pageY+tr.y)*.5;this._updateZoomParameters(ar,or)}_handleTouchMoveDollyPan(er){this.enableZoom&&this._handleTouchMoveDolly(er),this.enablePan&&this._handleTouchMovePan(er)}_handleTouchMoveDollyRotate(er){this.enableZoom&&this._handleTouchMoveDolly(er),this.enableRotate&&this._handleTouchMoveRotate(er)}_addPointer(er){this._pointers.push(er.pointerId)}_removePointer(er){delete this._pointerPositions[er.pointerId];for(let tr=0;tr<this._pointers.length;tr++)if(this._pointers[tr]==er.pointerId){this._pointers.splice(tr,1);return}}_isTrackingPointer(er){for(let tr=0;tr<this._pointers.length;tr++)if(this._pointers[tr]==er.pointerId)return!0;return!1}_trackPointer(er){let tr=this._pointerPositions[er.pointerId];tr===void 0&&(tr=new Vector2,this._pointerPositions[er.pointerId]=tr),tr.set(er.pageX,er.pageY)}_getSecondPointerPosition(er){const tr=er.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[tr]}_customWheelEvent(er){const tr=er.deltaMode,rr={clientX:er.clientX,clientY:er.clientY,deltaY:er.deltaY};switch(tr){case 1:rr.deltaY*=16;break;case 2:rr.deltaY*=100;break}return er.ctrlKey&&!this._controlActive&&(rr.deltaY*=10),rr}}function onPointerDown$2(ir){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(ir.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(ir)&&(this._addPointer(ir),ir.pointerType==="touch"?this._onTouchStart(ir):this._onMouseDown(ir)))}function onPointerMove$2(ir){this.enabled!==!1&&(ir.pointerType==="touch"?this._onTouchMove(ir):this._onMouseMove(ir))}function onPointerUp$2(ir){switch(this._removePointer(ir),this._pointers.length){case 0:this.domElement.releasePointerCapture(ir.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(_endEvent$1),this.state=_STATE$1.NONE;break;case 1:const er=this._pointers[0],tr=this._pointerPositions[er];this._onTouchStart({pointerId:er,pageX:tr.x,pageY:tr.y});break}}function onMouseDown$1(ir){let er;switch(ir.button){case 0:er=this.mouseButtons.LEFT;break;case 1:er=this.mouseButtons.MIDDLE;break;case 2:er=this.mouseButtons.RIGHT;break;default:er=-1}switch(er){case MOUSE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(ir),this.state=_STATE$1.DOLLY;break;case MOUSE.ROTATE:if(ir.ctrlKey||ir.metaKey||ir.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(ir),this.state=_STATE$1.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(ir),this.state=_STATE$1.ROTATE}break;case MOUSE.PAN:if(ir.ctrlKey||ir.metaKey||ir.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(ir),this.state=_STATE$1.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(ir),this.state=_STATE$1.PAN}break;default:this.state=_STATE$1.NONE}this.state!==_STATE$1.NONE&&this.dispatchEvent(_startEvent$1)}function onMouseMove$2(ir){switch(this.state){case _STATE$1.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(ir);break;case _STATE$1.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(ir);break;case _STATE$1.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(ir);break}}function onMouseWheel$1(ir){this.enabled===!1||this.enableZoom===!1||this.state!==_STATE$1.NONE||(ir.preventDefault(),this.dispatchEvent(_startEvent$1),this._handleMouseWheel(this._customWheelEvent(ir)),this.dispatchEvent(_endEvent$1))}function onKeyDown$1(ir){this.enabled!==!1&&this._handleKeyDown(ir)}function onTouchStart$1(ir){switch(this._trackPointer(ir),this._pointers.length){case 1:switch(this.touches.ONE){case TOUCH.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(ir),this.state=_STATE$1.TOUCH_ROTATE;break;case TOUCH.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(ir),this.state=_STATE$1.TOUCH_PAN;break;default:this.state=_STATE$1.NONE}break;case 2:switch(this.touches.TWO){case TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(ir),this.state=_STATE$1.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(ir),this.state=_STATE$1.TOUCH_DOLLY_ROTATE;break;default:this.state=_STATE$1.NONE}break;default:this.state=_STATE$1.NONE}this.state!==_STATE$1.NONE&&this.dispatchEvent(_startEvent$1)}function onTouchMove$1(ir){switch(this._trackPointer(ir),this.state){case _STATE$1.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(ir),this.update();break;case _STATE$1.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(ir),this.update();break;case _STATE$1.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(ir),this.update();break;case _STATE$1.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(ir),this.update();break;default:this.state=_STATE$1.NONE}}function onContextMenu$1(ir){this.enabled!==!1&&ir.preventDefault()}function interceptControlDown(ir){ir.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function interceptControlUp(ir){ir.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class MapControls extends OrbitControls{constructor(er,tr){super(er,tr),this.screenSpacePanning=!1,this.mouseButtons={LEFT:MOUSE.PAN,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.ROTATE},this.touches={ONE:TOUCH.PAN,TWO:TOUCH.DOLLY_ROTATE}}}const _euler=new Euler(0,0,0,"YXZ"),_vector$3=new Vector3$1,_changeEvent$2={type:"change"},_lockEvent={type:"lock"},_unlockEvent={type:"unlock"},_PI_2=Math.PI/2;class PointerLockControls extends Controls{constructor(er,tr=null){super(er,tr),this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=onMouseMove$1.bind(this),this._onPointerlockChange=onPointerlockChange.bind(this),this._onPointerlockError=onPointerlockError.bind(this),this.domElement!==null&&this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return console.warn("THREE.PointerLockControls: getObject() has been deprecated. Use controls.object instead."),this.object}getDirection(er){return er.set(0,0,-1).applyQuaternion(this.object.quaternion)}moveForward(er){if(this.enabled===!1)return;const tr=this.object;_vector$3.setFromMatrixColumn(tr.matrix,0),_vector$3.crossVectors(tr.up,_vector$3),tr.position.addScaledVector(_vector$3,er)}moveRight(er){if(this.enabled===!1)return;const tr=this.object;_vector$3.setFromMatrixColumn(tr.matrix,0),tr.position.addScaledVector(_vector$3,er)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function onMouseMove$1(ir){if(this.enabled===!1||this.isLocked===!1)return;const er=this.object;_euler.setFromQuaternion(er.quaternion),_euler.y-=ir.movementX*.002*this.pointerSpeed,_euler.x-=ir.movementY*.002*this.pointerSpeed,_euler.x=Math.max(_PI_2-this.maxPolarAngle,Math.min(_PI_2-this.minPolarAngle,_euler.x)),er.quaternion.setFromEuler(_euler),this.dispatchEvent(_changeEvent$2)}function onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(_lockEvent),this.isLocked=!0):(this.dispatchEvent(_unlockEvent),this.isLocked=!1)}function onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}const _changeEvent$1={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_EPS=1e-6,_STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},_v2$4=new Vector2,_mouseChange=new Vector2,_objectUp=new Vector3$1,_pan=new Vector3$1,_axis=new Vector3$1,_quaternion$2=new Quaternion$1,_eyeDirection=new Vector3$1,_objectUpDirection=new Vector3$1,_objectSidewaysDirection=new Vector3$1,_moveDirection=new Vector3$1;class TrackballControls extends Controls{constructor(er,tr=null){super(er,tr),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.state=_STATE.NONE,this.keyState=_STATE.NONE,this.target=new Vector3$1,this._lastPosition=new Vector3$1,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new Vector3$1,this._movePrev=new Vector2,this._moveCurr=new Vector2,this._lastAxis=new Vector3$1,this._zoomStart=new Vector2,this._zoomEnd=new Vector2,this._panStart=new Vector2,this._panEnd=new Vector2,this._pointers=[],this._pointerPositions={},this._onPointerMove=onPointerMove$1.bind(this),this._onPointerDown=onPointerDown$1.bind(this),this._onPointerUp=onPointerUp$1.bind(this),this._onPointerCancel=onPointerCancel.bind(this),this._onContextMenu=onContextMenu.bind(this),this._onMouseWheel=onMouseWheel.bind(this),this._onKeyDown=onKeyDown.bind(this),this._onKeyUp=onKeyUp.bind(this),this._onTouchStart=onTouchStart.bind(this),this._onTouchMove=onTouchMove.bind(this),this._onTouchEnd=onTouchEnd.bind(this),this._onMouseDown=onMouseDown.bind(this),this._onMouseMove=onMouseMove.bind(this),this._onMouseUp=onMouseUp.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,tr!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const er=this.domElement.getBoundingClientRect(),tr=this.domElement.ownerDocument.documentElement;this.screen.left=er.left+window.pageXOffset-tr.clientLeft,this.screen.top=er.top+window.pageYOffset-tr.clientTop,this.screen.width=er.width,this.screen.height=er.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>_EPS&&(this.dispatchEvent(_changeEvent$1),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>_EPS||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(_changeEvent$1),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=_STATE.NONE,this.keyState=_STATE.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(_changeEvent$1),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(_mouseChange.copy(this._panEnd).sub(this._panStart),_mouseChange.lengthSq()){if(this.object.isOrthographicCamera){const er=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,tr=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;_mouseChange.x*=er,_mouseChange.y*=tr}_mouseChange.multiplyScalar(this._eye.length()*this.panSpeed),_pan.copy(this._eye).cross(this.object.up).setLength(_mouseChange.x),_pan.add(_objectUp.copy(this.object.up).setLength(_mouseChange.y)),this.object.position.add(_pan),this.target.add(_pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(_mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){_moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let er=_moveDirection.length();er?(this._eye.copy(this.object.position).sub(this.target),_eyeDirection.copy(this._eye).normalize(),_objectUpDirection.copy(this.object.up).normalize(),_objectSidewaysDirection.crossVectors(_objectUpDirection,_eyeDirection).normalize(),_objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),_objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),_moveDirection.copy(_objectUpDirection.add(_objectSidewaysDirection)),_axis.crossVectors(_moveDirection,this._eye).normalize(),er*=this.rotateSpeed,_quaternion$2.setFromAxisAngle(_axis,er),this._eye.applyQuaternion(_quaternion$2),this.object.up.applyQuaternion(_quaternion$2),this._lastAxis.copy(_axis),this._lastAngle=er):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),_quaternion$2.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(_quaternion$2),this.object.up.applyQuaternion(_quaternion$2)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let er;this.state===_STATE.TOUCH_ZOOM_PAN?(er=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(er):this.object.isOrthographicCamera?(this.object.zoom=MathUtils.clamp(this.object.zoom/er,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(er=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,er!==1&&er>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(er):this.object.isOrthographicCamera?(this.object.zoom=MathUtils.clamp(this.object.zoom/er,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(er,tr){return _v2$4.set((er-this.screen.left)/this.screen.width,(tr-this.screen.top)/this.screen.height),_v2$4}_getMouseOnCircle(er,tr){return _v2$4.set((er-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-tr))/this.screen.width),_v2$4}_addPointer(er){this._pointers.push(er)}_removePointer(er){delete this._pointerPositions[er.pointerId];for(let tr=0;tr<this._pointers.length;tr++)if(this._pointers[tr].pointerId==er.pointerId){this._pointers.splice(tr,1);return}}_trackPointer(er){let tr=this._pointerPositions[er.pointerId];tr===void 0&&(tr=new Vector2,this._pointerPositions[er.pointerId]=tr),tr.set(er.pageX,er.pageY)}_getSecondPointerPosition(er){const tr=er.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[tr.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function onPointerDown$1(ir){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(ir.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(ir),ir.pointerType==="touch"?this._onTouchStart(ir):this._onMouseDown(ir))}function onPointerMove$1(ir){this.enabled!==!1&&(ir.pointerType==="touch"?this._onTouchMove(ir):this._onMouseMove(ir))}function onPointerUp$1(ir){this.enabled!==!1&&(ir.pointerType==="touch"?this._onTouchEnd(ir):this._onMouseUp(),this._removePointer(ir),this._pointers.length===0&&(this.domElement.releasePointerCapture(ir.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function onPointerCancel(ir){this._removePointer(ir)}function onKeyUp(){this.enabled!==!1&&(this.keyState=_STATE.NONE,window.addEventListener("keydown",this._onKeyDown))}function onKeyDown(ir){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===_STATE.NONE&&(ir.code===this.keys[_STATE.ROTATE]&&!this.noRotate?this.keyState=_STATE.ROTATE:ir.code===this.keys[_STATE.ZOOM]&&!this.noZoom?this.keyState=_STATE.ZOOM:ir.code===this.keys[_STATE.PAN]&&!this.noPan&&(this.keyState=_STATE.PAN)))}function onMouseDown(ir){let er;switch(ir.button){case 0:er=this.mouseButtons.LEFT;break;case 1:er=this.mouseButtons.MIDDLE;break;case 2:er=this.mouseButtons.RIGHT;break;default:er=-1}switch(er){case MOUSE.DOLLY:this.state=_STATE.ZOOM;break;case MOUSE.ROTATE:this.state=_STATE.ROTATE;break;case MOUSE.PAN:this.state=_STATE.PAN;break;default:this.state=_STATE.NONE}const tr=this.keyState!==_STATE.NONE?this.keyState:this.state;tr===_STATE.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(ir.pageX,ir.pageY)),this._movePrev.copy(this._moveCurr)):tr===_STATE.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(ir.pageX,ir.pageY)),this._zoomEnd.copy(this._zoomStart)):tr===_STATE.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(ir.pageX,ir.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(_startEvent)}function onMouseMove(ir){const er=this.keyState!==_STATE.NONE?this.keyState:this.state;er===_STATE.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(ir.pageX,ir.pageY))):er===_STATE.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(ir.pageX,ir.pageY)):er===_STATE.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(ir.pageX,ir.pageY))}function onMouseUp(){this.state=_STATE.NONE,this.dispatchEvent(_endEvent)}function onMouseWheel(ir){if(this.enabled!==!1&&this.noZoom!==!0){switch(ir.preventDefault(),ir.deltaMode){case 2:this._zoomStart.y-=ir.deltaY*.025;break;case 1:this._zoomStart.y-=ir.deltaY*.01;break;default:this._zoomStart.y-=ir.deltaY*25e-5;break}this.dispatchEvent(_startEvent),this.dispatchEvent(_endEvent)}}function onContextMenu(ir){this.enabled!==!1&&ir.preventDefault()}function onTouchStart(ir){switch(this._trackPointer(ir),this._pointers.length){case 1:this.state=_STATE.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=_STATE.TOUCH_ZOOM_PAN;const er=this._pointers[0].pageX-this._pointers[1].pageX,tr=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(er*er+tr*tr);const rr=(this._pointers[0].pageX+this._pointers[1].pageX)/2,nr=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(rr,nr)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(_startEvent)}function onTouchMove(ir){switch(this._trackPointer(ir),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(ir.pageX,ir.pageY));break;default:const er=this._getSecondPointerPosition(ir),tr=ir.pageX-er.x,rr=ir.pageY-er.y;this._touchZoomDistanceEnd=Math.sqrt(tr*tr+rr*rr);const nr=(ir.pageX+er.x)/2,sr=(ir.pageY+er.y)/2;this._panEnd.copy(this._getMouseOnScreen(nr,sr));break}}function onTouchEnd(ir){switch(this._pointers.length){case 0:this.state=_STATE.NONE;break;case 1:this.state=_STATE.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(ir.pageX,ir.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=_STATE.TOUCH_ZOOM_PAN;for(let er=0;er<this._pointers.length;er++)if(this._pointers[er].pointerId!==ir.pointerId){const tr=this._pointerPositions[this._pointers[er].pointerId];this._moveCurr.copy(this._getMouseOnCircle(tr.x,tr.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(_endEvent)}const _raycaster$1=new Raycaster,_tempVector=new Vector3$1,_tempVector2=new Vector3$1,_tempQuaternion=new Quaternion$1,_unit={X:new Vector3$1(1,0,0),Y:new Vector3$1(0,1,0),Z:new Vector3$1(0,0,1)},_changeEvent={type:"change"},_mouseDownEvent={type:"mouseDown",mode:null},_mouseUpEvent={type:"mouseUp",mode:null},_objectChangeEvent={type:"objectChange"};class TransformControls extends Controls{constructor(er,tr=null){super(void 0,tr);const rr=new TransformControlsRoot(this);this._root=rr;const nr=new TransformControlsGizmo;this._gizmo=nr,rr.add(nr);const sr=new TransformControlsPlane;this._plane=sr,rr.add(sr);const ar=this;function or(Ar,yr){let wr=yr;Object.defineProperty(ar,Ar,{get:function(){return wr!==void 0?wr:yr},set:function(br){wr!==br&&(wr=br,sr[Ar]=br,nr[Ar]=br,ar.dispatchEvent({type:Ar+"-changed",value:br}),ar.dispatchEvent(_changeEvent))}}),ar[Ar]=yr,sr[Ar]=yr,nr[Ar]=yr}or("camera",er),or("object",void 0),or("enabled",!0),or("axis",null),or("mode","translate"),or("translationSnap",null),or("rotationSnap",null),or("scaleSnap",null),or("space","world"),or("size",1),or("dragging",!1),or("showX",!0),or("showY",!0),or("showZ",!0),or("minX",-1/0),or("maxX",1/0),or("minY",-1/0),or("maxY",1/0),or("minZ",-1/0),or("maxZ",1/0);const lr=new Vector3$1,cr=new Vector3$1,hr=new Quaternion$1,fr=new Quaternion$1,ur=new Vector3$1,pr=new Quaternion$1,gr=new Vector3$1,_r=new Vector3$1,mr=new Vector3$1,dr=0,vr=new Vector3$1;or("worldPosition",lr),or("worldPositionStart",cr),or("worldQuaternion",hr),or("worldQuaternionStart",fr),or("cameraPosition",ur),or("cameraQuaternion",pr),or("pointStart",gr),or("pointEnd",_r),or("rotationAxis",mr),or("rotationAngle",dr),or("eye",vr),this._offset=new Vector3$1,this._startNorm=new Vector3$1,this._endNorm=new Vector3$1,this._cameraScale=new Vector3$1,this._parentPosition=new Vector3$1,this._parentQuaternion=new Quaternion$1,this._parentQuaternionInv=new Quaternion$1,this._parentScale=new Vector3$1,this._worldScaleStart=new Vector3$1,this._worldQuaternionInv=new Quaternion$1,this._worldScale=new Vector3$1,this._positionStart=new Vector3$1,this._quaternionStart=new Quaternion$1,this._scaleStart=new Vector3$1,this._getPointer=getPointer.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerHover=onPointerHover.bind(this),this._onPointerMove=onPointerMove.bind(this),this._onPointerUp=onPointerUp.bind(this),tr!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(er){if(this.object===void 0||this.dragging===!0)return;er!==null&&_raycaster$1.setFromCamera(er,this.camera);const tr=intersectObjectWithRay(this._gizmo.picker[this.mode],_raycaster$1);tr?this.axis=tr.object.name:this.axis=null}pointerDown(er){if(!(this.object===void 0||this.dragging===!0||er!=null&&er.button!==0)&&this.axis!==null){er!==null&&_raycaster$1.setFromCamera(er,this.camera);const tr=intersectObjectWithRay(this._plane,_raycaster$1,!0);tr&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(tr.point).sub(this.worldPositionStart)),this.dragging=!0,_mouseDownEvent.mode=this.mode,this.dispatchEvent(_mouseDownEvent)}}pointerMove(er){const tr=this.axis,rr=this.mode,nr=this.object;let sr=this.space;if(rr==="scale"?sr="local":(tr==="E"||tr==="XYZE"||tr==="XYZ")&&(sr="world"),nr===void 0||tr===null||this.dragging===!1||er!==null&&er.button!==-1)return;er!==null&&_raycaster$1.setFromCamera(er,this.camera);const ar=intersectObjectWithRay(this._plane,_raycaster$1,!0);if(ar){if(this.pointEnd.copy(ar.point).sub(this.worldPositionStart),rr==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),sr==="local"&&tr!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),tr.indexOf("X")===-1&&(this._offset.x=0),tr.indexOf("Y")===-1&&(this._offset.y=0),tr.indexOf("Z")===-1&&(this._offset.z=0),sr==="local"&&tr!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),nr.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(sr==="local"&&(nr.position.applyQuaternion(_tempQuaternion.copy(this._quaternionStart).invert()),tr.search("X")!==-1&&(nr.position.x=Math.round(nr.position.x/this.translationSnap)*this.translationSnap),tr.search("Y")!==-1&&(nr.position.y=Math.round(nr.position.y/this.translationSnap)*this.translationSnap),tr.search("Z")!==-1&&(nr.position.z=Math.round(nr.position.z/this.translationSnap)*this.translationSnap),nr.position.applyQuaternion(this._quaternionStart)),sr==="world"&&(nr.parent&&nr.position.add(_tempVector.setFromMatrixPosition(nr.parent.matrixWorld)),tr.search("X")!==-1&&(nr.position.x=Math.round(nr.position.x/this.translationSnap)*this.translationSnap),tr.search("Y")!==-1&&(nr.position.y=Math.round(nr.position.y/this.translationSnap)*this.translationSnap),tr.search("Z")!==-1&&(nr.position.z=Math.round(nr.position.z/this.translationSnap)*this.translationSnap),nr.parent&&nr.position.sub(_tempVector.setFromMatrixPosition(nr.parent.matrixWorld)))),nr.position.x=Math.max(this.minX,Math.min(this.maxX,nr.position.x)),nr.position.y=Math.max(this.minY,Math.min(this.maxY,nr.position.y)),nr.position.z=Math.max(this.minZ,Math.min(this.maxZ,nr.position.z));else if(rr==="scale"){if(tr.search("XYZ")!==-1){let or=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(or*=-1),_tempVector2.set(or,or,or)}else _tempVector.copy(this.pointStart),_tempVector2.copy(this.pointEnd),_tempVector.applyQuaternion(this._worldQuaternionInv),_tempVector2.applyQuaternion(this._worldQuaternionInv),_tempVector2.divide(_tempVector),tr.search("X")===-1&&(_tempVector2.x=1),tr.search("Y")===-1&&(_tempVector2.y=1),tr.search("Z")===-1&&(_tempVector2.z=1);nr.scale.copy(this._scaleStart).multiply(_tempVector2),this.scaleSnap&&(tr.search("X")!==-1&&(nr.scale.x=Math.round(nr.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),tr.search("Y")!==-1&&(nr.scale.y=Math.round(nr.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),tr.search("Z")!==-1&&(nr.scale.z=Math.round(nr.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(rr==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const or=20/this.worldPosition.distanceTo(_tempVector.setFromMatrixPosition(this.camera.matrixWorld));let lr=!1;tr==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_tempVector.copy(this.rotationAxis).cross(this.eye))*or):(tr==="X"||tr==="Y"||tr==="Z")&&(this.rotationAxis.copy(_unit[tr]),_tempVector.copy(_unit[tr]),sr==="local"&&_tempVector.applyQuaternion(this.worldQuaternion),_tempVector.cross(this.eye),_tempVector.length()===0?lr=!0:this.rotationAngle=this._offset.dot(_tempVector.normalize())*or),(tr==="E"||lr)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),sr==="local"&&tr!=="E"&&tr!=="XYZE"?(nr.quaternion.copy(this._quaternionStart),nr.quaternion.multiply(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),nr.quaternion.copy(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),nr.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(_changeEvent),this.dispatchEvent(_objectChangeEvent)}}pointerUp(er){er!==null&&er.button!==0||(this.dragging&&this.axis!==null&&(_mouseUpEvent.mode=this.mode,this.dispatchEvent(_mouseUpEvent)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(er){return this.object=er,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(_changeEvent),this.dispatchEvent(_objectChangeEvent),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _raycaster$1}getMode(){return this.mode}setMode(er){this.mode=er}setTranslationSnap(er){this.translationSnap=er}setRotationSnap(er){this.rotationSnap=er}setScaleSnap(er){this.scaleSnap=er}setSize(er){this.size=er}setSpace(er){this.space=er}}function getPointer(ir){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:ir.button};{const er=this.domElement.getBoundingClientRect();return{x:(ir.clientX-er.left)/er.width*2-1,y:-(ir.clientY-er.top)/er.height*2+1,button:ir.button}}}function onPointerHover(ir){if(this.enabled)switch(ir.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(ir));break}}function onPointerDown(ir){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(ir.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(ir)),this.pointerDown(this._getPointer(ir)))}function onPointerMove(ir){this.enabled&&this.pointerMove(this._getPointer(ir))}function onPointerUp(ir){this.enabled&&(this.domElement.releasePointerCapture(ir.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(ir)))}function intersectObjectWithRay(ir,er,tr){const rr=er.intersectObject(ir,!0);for(let nr=0;nr<rr.length;nr++)if(rr[nr].object.visible||tr)return rr[nr];return!1}const _tempEuler=new Euler,_alignVector=new Vector3$1(0,1,0),_zeroVector=new Vector3$1(0,0,0),_lookAtMatrix=new Matrix4,_tempQuaternion2=new Quaternion$1,_identityQuaternion=new Quaternion$1,_dirVector=new Vector3$1,_tempMatrix=new Matrix4,_unitX=new Vector3$1(1,0,0),_unitY=new Vector3$1(0,1,0),_unitZ=new Vector3$1(0,0,1),_v1$5=new Vector3$1,_v2$3=new Vector3$1,_v3=new Vector3$1;class TransformControlsRoot extends Object3D{constructor(er){super(),this.isTransformControlsRoot=!0,this.controls=er,this.visible=!1}updateMatrixWorld(er){const tr=this.controls;tr.object!==void 0&&(tr.object.updateMatrixWorld(),tr.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):tr.object.parent.matrixWorld.decompose(tr._parentPosition,tr._parentQuaternion,tr._parentScale),tr.object.matrixWorld.decompose(tr.worldPosition,tr.worldQuaternion,tr._worldScale),tr._parentQuaternionInv.copy(tr._parentQuaternion).invert(),tr._worldQuaternionInv.copy(tr.worldQuaternion).invert()),tr.camera.updateMatrixWorld(),tr.camera.matrixWorld.decompose(tr.cameraPosition,tr.cameraQuaternion,tr._cameraScale),tr.camera.isOrthographicCamera?tr.camera.getWorldDirection(tr.eye).negate():tr.eye.copy(tr.cameraPosition).sub(tr.worldPosition).normalize(),super.updateMatrixWorld(er)}dispose(){this.traverse(function(er){er.geometry&&er.geometry.dispose(),er.material&&er.material.dispose()})}}class TransformControlsGizmo extends Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const er=new MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),tr=new LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),rr=er.clone();rr.opacity=.15;const nr=tr.clone();nr.opacity=.5;const sr=er.clone();sr.color.setHex(16711680);const ar=er.clone();ar.color.setHex(65280);const or=er.clone();or.color.setHex(255);const lr=er.clone();lr.color.setHex(16711680),lr.opacity=.5;const cr=er.clone();cr.color.setHex(65280),cr.opacity=.5;const hr=er.clone();hr.color.setHex(255),hr.opacity=.5;const fr=er.clone();fr.opacity=.25;const ur=er.clone();ur.color.setHex(16776960),ur.opacity=.25,er.clone().color.setHex(16776960);const gr=er.clone();gr.color.setHex(7895160);const _r=new CylinderGeometry(0,.04,.1,12);_r.translate(0,.05,0);const mr=new BoxGeometry(.08,.08,.08);mr.translate(0,.04,0);const dr=new BufferGeometry;dr.setAttribute("position",new Float32BufferAttribute([0,0,0,1,0,0],3));const vr=new CylinderGeometry(.0075,.0075,.5,3);vr.translate(0,.25,0);function Ar(Ur,Br){const Or=new TorusGeometry(Ur,.0075,3,64,Br*Math.PI*2);return Or.rotateY(Math.PI/2),Or.rotateX(Math.PI/2),Or}function yr(){const Ur=new BufferGeometry;return Ur.setAttribute("position",new Float32BufferAttribute([0,0,0,1,1,1],3)),Ur}const wr={X:[[new Mesh(_r,sr),[.5,0,0],[0,0,-Math.PI/2]],[new Mesh(_r,sr),[-.5,0,0],[0,0,Math.PI/2]],[new Mesh(vr,sr),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(_r,ar),[0,.5,0]],[new Mesh(_r,ar),[0,-.5,0],[Math.PI,0,0]],[new Mesh(vr,ar)]],Z:[[new Mesh(_r,or),[0,0,.5],[Math.PI/2,0,0]],[new Mesh(_r,or),[0,0,-.5],[-Math.PI/2,0,0]],[new Mesh(vr,or),null,[Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronGeometry(.1,0),fr.clone()),[0,0,0]]],XY:[[new Mesh(new BoxGeometry(.15,.15,.01),hr.clone()),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.15,.15,.01),lr.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.15,.15,.01),cr.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},br={X:[[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[.3,0,0],[0,0,-Math.PI/2]],[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[0,.3,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[0,0,.3],[Math.PI/2,0,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronGeometry(.2,0),rr)]],XY:[[new Mesh(new BoxGeometry(.2,.2,.01),rr),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.2,.2,.01),rr),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.2,.2,.01),rr),[.15,0,.15],[-Math.PI/2,0,0]]]},Sr={START:[[new Mesh(new OctahedronGeometry(.01,2),nr),null,null,null,"helper"]],END:[[new Mesh(new OctahedronGeometry(.01,2),nr),null,null,null,"helper"]],DELTA:[[new Line(yr(),nr),null,null,null,"helper"]],X:[[new Line(dr,nr.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(dr,nr.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(dr,nr.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},xr={XYZE:[[new Mesh(Ar(.5,1),gr),null,[0,Math.PI/2,0]]],X:[[new Mesh(Ar(.5,.5),sr)]],Y:[[new Mesh(Ar(.5,.5),ar),null,[0,0,-Math.PI/2]]],Z:[[new Mesh(Ar(.5,.5),or),null,[0,Math.PI/2,0]]],E:[[new Mesh(Ar(.75,1),ur),null,[0,Math.PI/2,0]]]},Cr={AXIS:[[new Line(dr,nr.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Ir={XYZE:[[new Mesh(new SphereGeometry(.25,10,8),rr)]],X:[[new Mesh(new TorusGeometry(.5,.1,4,24),rr),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Mesh(new TorusGeometry(.5,.1,4,24),rr),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Mesh(new TorusGeometry(.5,.1,4,24),rr),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Mesh(new TorusGeometry(.75,.1,2,24),rr)]]},Rr={X:[[new Mesh(mr,sr),[.5,0,0],[0,0,-Math.PI/2]],[new Mesh(vr,sr),[0,0,0],[0,0,-Math.PI/2]],[new Mesh(mr,sr),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(mr,ar),[0,.5,0]],[new Mesh(vr,ar)],[new Mesh(mr,ar),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Mesh(mr,or),[0,0,.5],[Math.PI/2,0,0]],[new Mesh(vr,or),[0,0,0],[Math.PI/2,0,0]],[new Mesh(mr,or),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Mesh(new BoxGeometry(.15,.15,.01),hr),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.15,.15,.01),lr),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.15,.15,.01),cr),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new BoxGeometry(.1,.1,.1),fr.clone())]]},Pr={X:[[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[.3,0,0],[0,0,-Math.PI/2]],[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[0,.3,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[0,0,.3],[Math.PI/2,0,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),rr),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Mesh(new BoxGeometry(.2,.2,.01),rr),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.2,.2,.01),rr),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.2,.2,.01),rr),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new BoxGeometry(.2,.2,.2),rr),[0,0,0]]]},Fr={X:[[new Line(dr,nr.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(dr,nr.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(dr,nr.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Nr(Ur){const Br=new Object3D;for(const Or in Ur)for(let Dr=Ur[Or].length;Dr--;){const Wr=Ur[Or][Dr][0].clone(),$r=Ur[Or][Dr][1],Yr=Ur[Or][Dr][2],Qi=Ur[Or][Dr][3],rs=Ur[Or][Dr][4];Wr.name=Or,Wr.tag=rs,$r&&Wr.position.set($r[0],$r[1],$r[2]),Yr&&Wr.rotation.set(Yr[0],Yr[1],Yr[2]),Qi&&Wr.scale.set(Qi[0],Qi[1],Qi[2]),Wr.updateMatrix();const Kr=Wr.geometry.clone();Kr.applyMatrix4(Wr.matrix),Wr.geometry=Kr,Wr.renderOrder=1/0,Wr.position.set(0,0,0),Wr.rotation.set(0,0,0),Wr.scale.set(1,1,1),Br.add(Wr)}return Br}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Nr(wr)),this.add(this.gizmo.rotate=Nr(xr)),this.add(this.gizmo.scale=Nr(Rr)),this.add(this.picker.translate=Nr(br)),this.add(this.picker.rotate=Nr(Ir)),this.add(this.picker.scale=Nr(Pr)),this.add(this.helper.translate=Nr(Sr)),this.add(this.helper.rotate=Nr(Cr)),this.add(this.helper.scale=Nr(Fr)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(er){const rr=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:_identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let nr=[];nr=nr.concat(this.picker[this.mode].children),nr=nr.concat(this.gizmo[this.mode].children),nr=nr.concat(this.helper[this.mode].children);for(let sr=0;sr<nr.length;sr++){const ar=nr[sr];ar.visible=!0,ar.rotation.set(0,0,0),ar.position.copy(this.worldPosition);let or;if(this.camera.isOrthographicCamera?or=(this.camera.top-this.camera.bottom)/this.camera.zoom:or=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),ar.scale.set(1,1,1).multiplyScalar(or*this.size/4),ar.tag==="helper"){ar.visible=!1,ar.name==="AXIS"?(ar.visible=!!this.axis,this.axis==="X"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,0)),ar.quaternion.copy(rr).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitX).applyQuaternion(rr).dot(this.eye))>.9&&(ar.visible=!1)),this.axis==="Y"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,Math.PI/2)),ar.quaternion.copy(rr).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitY).applyQuaternion(rr).dot(this.eye))>.9&&(ar.visible=!1)),this.axis==="Z"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),ar.quaternion.copy(rr).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitZ).applyQuaternion(rr).dot(this.eye))>.9&&(ar.visible=!1)),this.axis==="XYZE"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),_alignVector.copy(this.rotationAxis),ar.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(_zeroVector,_alignVector,_unitY)),ar.quaternion.multiply(_tempQuaternion),ar.visible=this.dragging),this.axis==="E"&&(ar.visible=!1)):ar.name==="START"?(ar.position.copy(this.worldPositionStart),ar.visible=this.dragging):ar.name==="END"?(ar.position.copy(this.worldPosition),ar.visible=this.dragging):ar.name==="DELTA"?(ar.position.copy(this.worldPositionStart),ar.quaternion.copy(this.worldQuaternionStart),_tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),ar.scale.copy(_tempVector),ar.visible=this.dragging):(ar.quaternion.copy(rr),this.dragging?ar.position.copy(this.worldPositionStart):ar.position.copy(this.worldPosition),this.axis&&(ar.visible=this.axis.search(ar.name)!==-1));continue}ar.quaternion.copy(rr),this.mode==="translate"||this.mode==="scale"?(ar.name==="X"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(rr).dot(this.eye))>.99&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="Y"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(rr).dot(this.eye))>.99&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="Z"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(rr).dot(this.eye))>.99&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="XY"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(rr).dot(this.eye))<.2&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="YZ"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(rr).dot(this.eye))<.2&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="XZ"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(rr).dot(this.eye))<.2&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1)):this.mode==="rotate"&&(_tempQuaternion2.copy(rr),_alignVector.copy(this.eye).applyQuaternion(_tempQuaternion.copy(rr).invert()),ar.name.search("E")!==-1&&ar.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(this.eye,_zeroVector,_unitY)),ar.name==="X"&&(_tempQuaternion.setFromAxisAngle(_unitX,Math.atan2(-_alignVector.y,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),ar.quaternion.copy(_tempQuaternion)),ar.name==="Y"&&(_tempQuaternion.setFromAxisAngle(_unitY,Math.atan2(_alignVector.x,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),ar.quaternion.copy(_tempQuaternion)),ar.name==="Z"&&(_tempQuaternion.setFromAxisAngle(_unitZ,Math.atan2(_alignVector.y,_alignVector.x)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),ar.quaternion.copy(_tempQuaternion))),ar.visible=ar.visible&&(ar.name.indexOf("X")===-1||this.showX),ar.visible=ar.visible&&(ar.name.indexOf("Y")===-1||this.showY),ar.visible=ar.visible&&(ar.name.indexOf("Z")===-1||this.showZ),ar.visible=ar.visible&&(ar.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),ar.material._color=ar.material._color||ar.material.color.clone(),ar.material._opacity=ar.material._opacity||ar.material.opacity,ar.material.color.copy(ar.material._color),ar.material.opacity=ar.material._opacity,this.enabled&&this.axis&&(ar.name===this.axis||this.axis.split("").some(function(lr){return ar.name===lr}))&&(ar.material.color.setHex(16776960),ar.material.opacity=1)}super.updateMatrixWorld(er)}}class TransformControlsPlane extends Mesh{constructor(){super(new PlaneGeometry(1e5,1e5,2,2),new MeshBasicMaterial({visible:!1,wireframe:!0,side:DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(er){let tr=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(tr="local"),_v1$5.copy(_unitX).applyQuaternion(tr==="local"?this.worldQuaternion:_identityQuaternion),_v2$3.copy(_unitY).applyQuaternion(tr==="local"?this.worldQuaternion:_identityQuaternion),_v3.copy(_unitZ).applyQuaternion(tr==="local"?this.worldQuaternion:_identityQuaternion),_alignVector.copy(_v2$3),this.mode){case"translate":case"scale":switch(this.axis){case"X":_alignVector.copy(this.eye).cross(_v1$5),_dirVector.copy(_v1$5).cross(_alignVector);break;case"Y":_alignVector.copy(this.eye).cross(_v2$3),_dirVector.copy(_v2$3).cross(_alignVector);break;case"Z":_alignVector.copy(this.eye).cross(_v3),_dirVector.copy(_v3).cross(_alignVector);break;case"XY":_dirVector.copy(_v3);break;case"YZ":_dirVector.copy(_v1$5);break;case"XZ":_alignVector.copy(_v3),_dirVector.copy(_v2$3);break;case"XYZ":case"E":_dirVector.set(0,0,0);break}break;case"rotate":default:_dirVector.set(0,0,0)}_dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(_tempMatrix.lookAt(_tempVector.set(0,0,0),_dirVector,_alignVector),this.quaternion.setFromRotationMatrix(_tempMatrix)),super.updateMatrixWorld(er)}}const inverseProjectionMatrix=new Matrix4;class CSMFrustum{constructor(er){er=er||{},this.zNear=er.webGL===!0?-1:0,this.vertices={near:[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1],far:[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1]},er.projectionMatrix!==void 0&&this.setFromProjectionMatrix(er.projectionMatrix,er.maxFar||1e4)}setFromProjectionMatrix(er,tr){const rr=this.zNear,nr=er.elements[2*4+3]===0;return inverseProjectionMatrix.copy(er).invert(),this.vertices.near[0].set(1,1,rr),this.vertices.near[1].set(1,-1,rr),this.vertices.near[2].set(-1,-1,rr),this.vertices.near[3].set(-1,1,rr),this.vertices.near.forEach(function(sr){sr.applyMatrix4(inverseProjectionMatrix)}),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach(function(sr){sr.applyMatrix4(inverseProjectionMatrix);const ar=Math.abs(sr.z);nr?sr.z*=Math.min(tr/ar,1):sr.multiplyScalar(Math.min(tr/ar,1))}),this.vertices}split(er,tr){for(;er.length>tr.length;)tr.push(new CSMFrustum);tr.length=er.length;for(let rr=0;rr<er.length;rr++){const nr=tr[rr];if(rr===0)for(let sr=0;sr<4;sr++)nr.vertices.near[sr].copy(this.vertices.near[sr]);else for(let sr=0;sr<4;sr++)nr.vertices.near[sr].lerpVectors(this.vertices.near[sr],this.vertices.far[sr],er[rr-1]);if(rr===er.length-1)for(let sr=0;sr<4;sr++)nr.vertices.far[sr].copy(this.vertices.far[sr]);else for(let sr=0;sr<4;sr++)nr.vertices.far[sr].lerpVectors(this.vertices.near[sr],this.vertices.far[sr],er[rr])}}toSpace(er,tr){for(let rr=0;rr<4;rr++)tr.vertices.near[rr].copy(this.vertices.near[rr]).applyMatrix4(er),tr.vertices.far[rr].copy(this.vertices.far[rr]).applyMatrix4(er)}}const CSMShader={lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

vec3 geometryClearcoatNormal = vec3( 0.0 );

#ifdef USE_CLEARCOAT

	geometryClearcoatNormal = clearcoatNormal;

#endif

#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		// Iridescence F0 approximation
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometryPosition, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
 	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;

	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometryPosition, directLight );

  		// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;

		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	float linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )
		vec2 cascade;
		float cascadeCenter;
		float closestEdge;
		float margin;
		float csmx;
		float csmy;

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
				// NOTE: Depth gets larger away from the camera.
				// cascade.x is closer, cascade.y is further
				cascade = CSM_cascades[ i ];
				cascadeCenter = ( cascade.x + cascade.y ) / 2.0;
				closestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;
				margin = 0.25 * pow( closestEdge, 2.0 );
				csmx = cascade.x - margin / 2.0;
				csmy = cascade.y + margin / 2.0;
				if( linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {

					float dist = min( linearDepth - csmx, csmy - linearDepth );
					float ratio = clamp( dist / margin, 0.0, 1.0 );

					vec3 prevColor = directLight.color;
					directionalLightShadow = directionalLightShadows[ i ];
					directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

					bool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;
					directLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );

					ReflectedLight prevLight = reflectedLight;
					RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

					bool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;
					float blendRatio = shouldBlend ? ratio : 1.0;

					reflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );
					reflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );
					reflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );
					reflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );

				}
			#endif

		}
		#pragma unroll_loop_end
	#elif defined (USE_SHADOWMAP)

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )

				directionalLightShadow = directionalLightShadows[ i ];
				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

			#endif

		}
		#pragma unroll_loop_end

	#elif ( NUM_DIR_LIGHT_SHADOWS > 0 )
		// note: no loop here - all CSM lights are in fact one light only
		getDirectionalLightInfo( directionalLights[0], directLight );
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	#endif

	#if ( NUM_DIR_LIGHTS > NUM_DIR_LIGHT_SHADOWS)
		// compute the lights not casting shadows (if any)

		#pragma unroll_loop_start
		for ( int i = NUM_DIR_LIGHT_SHADOWS; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];

			getDirectionalLightInfo( directionalLight, directLight );

			RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

		}
		#pragma unroll_loop_end

	#endif

#endif


#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	#if defined( USE_LIGHT_PROBES )

		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );

	#endif

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`,lights_pars_begin:`
#if defined( USE_CSM ) && defined( CSM_CASCADES )
uniform vec2 CSM_cascades[CSM_CASCADES];
uniform float cameraNear;
uniform float shadowFar;
#endif
	`+ShaderChunk.lights_pars_begin},_cameraToLightMatrix=new Matrix4,_lightSpaceFrustum=new CSMFrustum({webGL:!0}),_center$1=new Vector3$1,_bbox=new Box3,_uniformArray=[],_logArray=[],_lightOrientationMatrix=new Matrix4,_lightOrientationMatrixInverse=new Matrix4,_up=new Vector3$1(0,1,0);class CSM{constructor(er){this.camera=er.camera,this.parent=er.parent,this.cascades=er.cascades||3,this.maxFar=er.maxFar||1e5,this.mode=er.mode||"practical",this.shadowMapSize=er.shadowMapSize||2048,this.shadowBias=er.shadowBias||1e-6,this.lightDirection=er.lightDirection||new Vector3$1(1,-1,1).normalize(),this.lightIntensity=er.lightIntensity||3,this.lightNear=er.lightNear||1,this.lightFar=er.lightFar||2e3,this.lightMargin=er.lightMargin||200,this.customSplitsCallback=er.customSplitsCallback,this.fade=!1,this.mainFrustum=new CSMFrustum({webGL:!0}),this.frustums=[],this.breaks=[],this.lights=[],this.shaders=new Map,this.createLights(),this.updateFrustums(),this.injectInclude()}createLights(){for(let er=0;er<this.cascades;er++){const tr=new DirectionalLight(16777215,this.lightIntensity);tr.castShadow=!0,tr.shadow.mapSize.width=this.shadowMapSize,tr.shadow.mapSize.height=this.shadowMapSize,tr.shadow.camera.near=this.lightNear,tr.shadow.camera.far=this.lightFar,tr.shadow.bias=this.shadowBias,this.parent.add(tr),this.parent.add(tr.target),this.lights.push(tr)}}initCascades(){const er=this.camera;er.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(er.projectionMatrix,this.maxFar),this.mainFrustum.split(this.breaks,this.frustums)}updateShadowBounds(){const er=this.frustums;for(let tr=0;tr<er.length;tr++){const nr=this.lights[tr].shadow.camera,sr=this.frustums[tr],ar=sr.vertices.near,or=sr.vertices.far,lr=or[0];let cr;lr.distanceTo(or[2])>lr.distanceTo(ar[2])?cr=or[2]:cr=ar[2];let hr=lr.distanceTo(cr);if(this.fade){const fr=this.camera,ur=Math.max(fr.far,this.maxFar),pr=sr.vertices.far[0].z/(ur-fr.near),gr=.25*Math.pow(pr,2)*(ur-fr.near);hr+=gr}nr.left=-hr/2,nr.right=hr/2,nr.top=hr/2,nr.bottom=-hr/2,nr.updateProjectionMatrix()}}getBreaks(){const er=this.camera,tr=Math.min(er.far,this.maxFar);switch(this.breaks.length=0,this.mode){case"uniform":rr(this.cascades,er.near,tr,this.breaks);break;case"logarithmic":nr(this.cascades,er.near,tr,this.breaks);break;case"practical":sr(this.cascades,er.near,tr,.5,this.breaks);break;case"custom":this.customSplitsCallback===void 0&&console.error("CSM: Custom split scheme callback not defined."),this.customSplitsCallback(this.cascades,er.near,tr,this.breaks);break}function rr(ar,or,lr,cr){for(let hr=1;hr<ar;hr++)cr.push((or+(lr-or)*hr/ar)/lr);cr.push(1)}function nr(ar,or,lr,cr){for(let hr=1;hr<ar;hr++)cr.push(or*(lr/or)**(hr/ar)/lr);cr.push(1)}function sr(ar,or,lr,cr,hr){_uniformArray.length=0,_logArray.length=0,nr(ar,or,lr,_logArray),rr(ar,or,lr,_uniformArray);for(let fr=1;fr<ar;fr++)hr.push(MathUtils.lerp(_uniformArray[fr-1],_logArray[fr-1],cr));hr.push(1)}}update(){const er=this.camera,tr=this.frustums;_lightOrientationMatrix.lookAt(new Vector3$1,this.lightDirection,_up),_lightOrientationMatrixInverse.copy(_lightOrientationMatrix).invert();for(let rr=0;rr<tr.length;rr++){const nr=this.lights[rr],sr=nr.shadow.camera,ar=(sr.right-sr.left)/this.shadowMapSize,or=(sr.top-sr.bottom)/this.shadowMapSize;_cameraToLightMatrix.multiplyMatrices(_lightOrientationMatrixInverse,er.matrixWorld),tr[rr].toSpace(_cameraToLightMatrix,_lightSpaceFrustum);const lr=_lightSpaceFrustum.vertices.near,cr=_lightSpaceFrustum.vertices.far;_bbox.makeEmpty();for(let hr=0;hr<4;hr++)_bbox.expandByPoint(lr[hr]),_bbox.expandByPoint(cr[hr]);_bbox.getCenter(_center$1),_center$1.z=_bbox.max.z+this.lightMargin,_center$1.x=Math.floor(_center$1.x/ar)*ar,_center$1.y=Math.floor(_center$1.y/or)*or,_center$1.applyMatrix4(_lightOrientationMatrix),nr.position.copy(_center$1),nr.target.position.copy(_center$1),nr.target.position.x+=this.lightDirection.x,nr.target.position.y+=this.lightDirection.y,nr.target.position.z+=this.lightDirection.z}}injectInclude(){ShaderChunk.lights_fragment_begin=CSMShader.lights_fragment_begin,ShaderChunk.lights_pars_begin=CSMShader.lights_pars_begin}setupMaterial(er){er.defines=er.defines||{},er.defines.USE_CSM=1,er.defines.CSM_CASCADES=this.cascades,this.fade&&(er.defines.CSM_FADE="");const tr=[],rr=this,nr=this.shaders;er.onBeforeCompile=function(sr){const ar=Math.min(rr.camera.far,rr.maxFar);rr.getExtendedBreaks(tr),sr.uniforms.CSM_cascades={value:tr},sr.uniforms.cameraNear={value:rr.camera.near},sr.uniforms.shadowFar={value:ar},nr.set(er,sr)},nr.set(er,null)}updateUniforms(){const er=Math.min(this.camera.far,this.maxFar);this.shaders.forEach(function(rr,nr){if(rr!==null){const sr=rr.uniforms;this.getExtendedBreaks(sr.CSM_cascades.value),sr.cameraNear.value=this.camera.near,sr.shadowFar.value=er}!this.fade&&"CSM_FADE"in nr.defines?(delete nr.defines.CSM_FADE,nr.needsUpdate=!0):this.fade&&!("CSM_FADE"in nr.defines)&&(nr.defines.CSM_FADE="",nr.needsUpdate=!0)},this)}getExtendedBreaks(er){for(;er.length<this.breaks.length;)er.push(new Vector2);er.length=this.breaks.length;for(let tr=0;tr<this.cascades;tr++){const rr=this.breaks[tr],nr=this.breaks[tr-1]||0;er[tr].x=nr,er[tr].y=rr}}updateFrustums(){this.getBreaks(),this.initCascades(),this.updateShadowBounds(),this.updateUniforms()}remove(){for(let er=0;er<this.lights.length;er++)this.parent.remove(this.lights[er].target),this.parent.remove(this.lights[er])}dispose(){const er=this.shaders;er.forEach(function(tr,rr){delete rr.onBeforeCompile,delete rr.defines.USE_CSM,delete rr.defines.CSM_CASCADES,delete rr.defines.CSM_FADE,tr!==null&&(delete tr.uniforms.CSM_cascades,delete tr.uniforms.cameraNear,delete tr.uniforms.shadowFar),rr.needsUpdate=!0}),er.clear()}}class CSMHelper extends Group{constructor(er){super(),this.csm=er,this.displayFrustum=!0,this.displayPlanes=!0,this.displayShadowBounds=!0;const tr=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),rr=new Float32Array(24),nr=new BufferGeometry;nr.setIndex(new BufferAttribute(tr,1)),nr.setAttribute("position",new BufferAttribute(rr,3,!1));const sr=new LineSegments(nr,new LineBasicMaterial);this.add(sr),this.frustumLines=sr,this.cascadeLines=[],this.cascadePlanes=[],this.shadowLines=[]}updateVisibility(){const er=this.displayFrustum,tr=this.displayPlanes,rr=this.displayShadowBounds,nr=this.frustumLines,sr=this.cascadeLines,ar=this.cascadePlanes,or=this.shadowLines;for(let lr=0,cr=sr.length;lr<cr;lr++){const hr=sr[lr],fr=ar[lr],ur=or[lr];hr.visible=er,fr.visible=er&&tr,ur.visible=rr}nr.visible=er}update(){const er=this.csm,tr=er.camera,rr=er.cascades,nr=er.mainFrustum,sr=er.frustums,ar=er.lights,lr=this.frustumLines.geometry.getAttribute("position"),cr=this.cascadeLines,hr=this.cascadePlanes,fr=this.shadowLines;if(tr===null)return;for(this.position.copy(tr.position),this.quaternion.copy(tr.quaternion),this.scale.copy(tr.scale),this.updateMatrixWorld(!0);cr.length>rr;)this.remove(cr.pop()),this.remove(hr.pop()),this.remove(fr.pop());for(;cr.length<rr;){const gr=new Box3Helper(new Box3,16777215),_r=new MeshBasicMaterial({transparent:!0,opacity:.1,depthWrite:!1,side:DoubleSide}),mr=new Mesh(new PlaneGeometry,_r),dr=new Group,vr=new Box3Helper(new Box3,16776960);dr.add(vr),this.add(gr),this.add(mr),this.add(dr),cr.push(gr),hr.push(mr),fr.push(dr)}for(let gr=0;gr<rr;gr++){const _r=sr[gr],dr=ar[gr].shadow.camera,vr=_r.vertices.far,Ar=cr[gr],yr=hr[gr],wr=fr[gr],br=wr.children[0];Ar.box.min.copy(vr[2]),Ar.box.max.copy(vr[0]),Ar.box.max.z+=1e-4,yr.position.addVectors(vr[0],vr[2]),yr.position.multiplyScalar(.5),yr.scale.subVectors(vr[0],vr[2]),yr.scale.z=1e-4,this.remove(wr),wr.position.copy(dr.position),wr.quaternion.copy(dr.quaternion),wr.scale.copy(dr.scale),wr.updateMatrixWorld(!0),this.attach(wr),br.box.min.set(dr.bottom,dr.left,-dr.far),br.box.max.set(dr.top,dr.right,-dr.near)}const ur=nr.vertices.near,pr=nr.vertices.far;lr.setXYZ(0,pr[0].x,pr[0].y,pr[0].z),lr.setXYZ(1,pr[3].x,pr[3].y,pr[3].z),lr.setXYZ(2,pr[2].x,pr[2].y,pr[2].z),lr.setXYZ(3,pr[1].x,pr[1].y,pr[1].z),lr.setXYZ(4,ur[0].x,ur[0].y,ur[0].z),lr.setXYZ(5,ur[3].x,ur[3].y,ur[3].z),lr.setXYZ(6,ur[2].x,ur[2].y,ur[2].z),lr.setXYZ(7,ur[1].x,ur[1].y,ur[1].z),lr.needsUpdate=!0}dispose(){const er=this.frustumLines,tr=this.cascadeLines,rr=this.cascadePlanes,nr=this.shadowLines;er.geometry.dispose(),er.material.dispose();const sr=this.csm.cascades;for(let ar=0;ar<sr;ar++){const or=tr[ar],lr=rr[ar],hr=nr[ar].children[0];or.dispose(),lr.geometry.dispose(),lr.material.dispose(),hr.dispose()}}}class GrannyKnot extends Curve{getPoint(er,tr=new Vector3$1){const rr=tr;er=2*Math.PI*er;const nr=-.22*Math.cos(er)-1.28*Math.sin(er)-.44*Math.cos(3*er)-.78*Math.sin(3*er),sr=-.1*Math.cos(2*er)-.27*Math.sin(2*er)+.38*Math.cos(4*er)+.46*Math.sin(4*er),ar=.7*Math.cos(3*er)-.4*Math.sin(3*er);return rr.set(nr,sr,ar).multiplyScalar(20)}}class HeartCurve extends Curve{constructor(er=5){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr;er*=2*Math.PI;const nr=16*Math.pow(Math.sin(er),3),sr=13*Math.cos(er)-5*Math.cos(2*er)-2*Math.cos(3*er)-Math.cos(4*er);return rr.set(nr,sr,0).multiplyScalar(this.scale)}}class VivianiCurve extends Curve{constructor(er=70){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr;er=er*4*Math.PI;const nr=this.scale/2,sr=nr*(1+Math.cos(er)),ar=nr*Math.sin(er),or=2*nr*Math.sin(er/2);return rr.set(sr,ar,or)}}class KnotCurve extends Curve{getPoint(er,tr=new Vector3$1){const rr=tr;er*=2*Math.PI;const nr=10,sr=50,ar=sr*Math.sin(er),or=Math.cos(er)*(nr+sr*Math.cos(er)),lr=Math.sin(er)*(nr+sr*Math.cos(er));return rr.set(ar,or,lr)}}class HelixCurve extends Curve{getPoint(er,tr=new Vector3$1){const rr=tr,nr=30,sr=150,ar=2*Math.PI*er*sr/30,or=Math.cos(ar)*nr,lr=Math.sin(ar)*nr,cr=sr*er;return rr.set(or,lr,cr)}}class TrefoilKnot extends Curve{constructor(er=10){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr;er*=Math.PI*2;const nr=(2+Math.cos(3*er))*Math.cos(2*er),sr=(2+Math.cos(3*er))*Math.sin(2*er),ar=Math.sin(3*er);return rr.set(nr,sr,ar).multiplyScalar(this.scale)}}class TorusKnot extends Curve{constructor(er=10){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr,nr=3,sr=4;er*=Math.PI*2;const ar=(2+Math.cos(sr*er))*Math.cos(nr*er),or=(2+Math.cos(sr*er))*Math.sin(nr*er),lr=Math.sin(sr*er);return rr.set(ar,or,lr).multiplyScalar(this.scale)}}class CinquefoilKnot extends Curve{constructor(er=10){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr,nr=2,sr=5;er*=Math.PI*2;const ar=(2+Math.cos(sr*er))*Math.cos(nr*er),or=(2+Math.cos(sr*er))*Math.sin(nr*er),lr=Math.sin(sr*er);return rr.set(ar,or,lr).multiplyScalar(this.scale)}}class TrefoilPolynomialKnot extends Curve{constructor(er=10){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr;er=er*4-2;const nr=Math.pow(er,3)-3*er,sr=Math.pow(er,4)-4*er*er,ar=1/5*Math.pow(er,5)-2*er;return rr.set(nr,sr,ar).multiplyScalar(this.scale)}}function scaleTo(ir,er,tr){const rr=er-ir;return tr*rr+ir}class FigureEightPolynomialKnot extends Curve{constructor(er=1){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr;er=scaleTo(-4,4,er);const nr=2/5*er*(er*er-7)*(er*er-10),sr=Math.pow(er,4)-13*er*er,ar=1/10*er*(er*er-4)*(er*er-9)*(er*er-12);return rr.set(nr,sr,ar).multiplyScalar(this.scale)}}class DecoratedTorusKnot4a extends Curve{constructor(er=40){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr;er*=Math.PI*2;const nr=Math.cos(2*er)*(1+.6*(Math.cos(5*er)+.75*Math.cos(10*er))),sr=Math.sin(2*er)*(1+.6*(Math.cos(5*er)+.75*Math.cos(10*er))),ar=.35*Math.sin(5*er);return rr.set(nr,sr,ar).multiplyScalar(this.scale)}}class DecoratedTorusKnot4b extends Curve{constructor(er=40){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr,nr=er*Math.PI*2,sr=Math.cos(2*nr)*(1+.45*Math.cos(3*nr)+.4*Math.cos(9*nr)),ar=Math.sin(2*nr)*(1+.45*Math.cos(3*nr)+.4*Math.cos(9*nr)),or=.2*Math.sin(9*nr);return rr.set(sr,ar,or).multiplyScalar(this.scale)}}class DecoratedTorusKnot5a extends Curve{constructor(er=40){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr,nr=er*Math.PI*2,sr=Math.cos(3*nr)*(1+.3*Math.cos(5*nr)+.5*Math.cos(10*nr)),ar=Math.sin(3*nr)*(1+.3*Math.cos(5*nr)+.5*Math.cos(10*nr)),or=.2*Math.sin(20*nr);return rr.set(sr,ar,or).multiplyScalar(this.scale)}}class DecoratedTorusKnot5c extends Curve{constructor(er=40){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const rr=tr,nr=er*Math.PI*2,sr=Math.cos(4*nr)*(1+.5*(Math.cos(5*nr)+.4*Math.cos(20*nr))),ar=Math.sin(4*nr)*(1+.5*(Math.cos(5*nr)+.4*Math.cos(20*nr))),or=.35*Math.sin(15*nr);return rr.set(sr,ar,or).multiplyScalar(this.scale)}}const CurveExtras=Object.freeze(Object.defineProperty({__proto__:null,CinquefoilKnot,DecoratedTorusKnot4a,DecoratedTorusKnot4b,DecoratedTorusKnot5a,DecoratedTorusKnot5c,FigureEightPolynomialKnot,GrannyKnot,HeartCurve,HelixCurve,KnotCurve,TorusKnot,TrefoilKnot,TrefoilPolynomialKnot,VivianiCurve},Symbol.toStringTag,{value:"Module"}));function findSpan(ir,er,tr){const rr=tr.length-ir-1;if(er>=tr[rr])return rr-1;if(er<=tr[ir])return ir;let nr=ir,sr=rr,ar=Math.floor((nr+sr)/2);for(;er<tr[ar]||er>=tr[ar+1];)er<tr[ar]?sr=ar:nr=ar,ar=Math.floor((nr+sr)/2);return ar}function calcBasisFunctions(ir,er,tr,rr){const nr=[],sr=[],ar=[];nr[0]=1;for(let or=1;or<=tr;++or){sr[or]=er-rr[ir+1-or],ar[or]=rr[ir+or]-er;let lr=0;for(let cr=0;cr<or;++cr){const hr=ar[cr+1],fr=sr[or-cr],ur=nr[cr]/(hr+fr);nr[cr]=lr+hr*ur,lr=fr*ur}nr[or]=lr}return nr}function calcBSplinePoint(ir,er,tr,rr){const nr=findSpan(ir,rr,er),sr=calcBasisFunctions(nr,rr,ir,er),ar=new Vector4(0,0,0,0);for(let or=0;or<=ir;++or){const lr=tr[nr-ir+or],cr=sr[or],hr=lr.w*cr;ar.x+=lr.x*hr,ar.y+=lr.y*hr,ar.z+=lr.z*hr,ar.w+=lr.w*cr}return ar}function calcBasisFunctionDerivatives(ir,er,tr,rr,nr){const sr=[];for(let fr=0;fr<=tr;++fr)sr[fr]=0;const ar=[];for(let fr=0;fr<=rr;++fr)ar[fr]=sr.slice(0);const or=[];for(let fr=0;fr<=tr;++fr)or[fr]=sr.slice(0);or[0][0]=1;const lr=sr.slice(0),cr=sr.slice(0);for(let fr=1;fr<=tr;++fr){lr[fr]=er-nr[ir+1-fr],cr[fr]=nr[ir+fr]-er;let ur=0;for(let pr=0;pr<fr;++pr){const gr=cr[pr+1],_r=lr[fr-pr];or[fr][pr]=gr+_r;const mr=or[pr][fr-1]/or[fr][pr];or[pr][fr]=ur+gr*mr,ur=_r*mr}or[fr][fr]=ur}for(let fr=0;fr<=tr;++fr)ar[0][fr]=or[fr][tr];for(let fr=0;fr<=tr;++fr){let ur=0,pr=1;const gr=[];for(let _r=0;_r<=tr;++_r)gr[_r]=sr.slice(0);gr[0][0]=1;for(let _r=1;_r<=rr;++_r){let mr=0;const dr=fr-_r,vr=tr-_r;fr>=_r&&(gr[pr][0]=gr[ur][0]/or[vr+1][dr],mr=gr[pr][0]*or[dr][vr]);const Ar=dr>=-1?1:-dr,yr=fr-1<=vr?_r-1:tr-fr;for(let br=Ar;br<=yr;++br)gr[pr][br]=(gr[ur][br]-gr[ur][br-1])/or[vr+1][dr+br],mr+=gr[pr][br]*or[dr+br][vr];fr<=vr&&(gr[pr][_r]=-gr[ur][_r-1]/or[vr+1][fr],mr+=gr[pr][_r]*or[fr][vr]),ar[_r][fr]=mr;const wr=ur;ur=pr,pr=wr}}let hr=tr;for(let fr=1;fr<=rr;++fr){for(let ur=0;ur<=tr;++ur)ar[fr][ur]*=hr;hr*=tr-fr}return ar}function calcBSplineDerivatives(ir,er,tr,rr,nr){const sr=nr<ir?nr:ir,ar=[],or=findSpan(ir,rr,er),lr=calcBasisFunctionDerivatives(or,rr,ir,sr,er),cr=[];for(let hr=0;hr<tr.length;++hr){const fr=tr[hr].clone(),ur=fr.w;fr.x*=ur,fr.y*=ur,fr.z*=ur,cr[hr]=fr}for(let hr=0;hr<=sr;++hr){const fr=cr[or-ir].clone().multiplyScalar(lr[hr][0]);for(let ur=1;ur<=ir;++ur)fr.add(cr[or-ir+ur].clone().multiplyScalar(lr[hr][ur]));ar[hr]=fr}for(let hr=sr+1;hr<=nr+1;++hr)ar[hr]=new Vector4(0,0,0);return ar}function calcKoverI(ir,er){let tr=1;for(let nr=2;nr<=ir;++nr)tr*=nr;let rr=1;for(let nr=2;nr<=er;++nr)rr*=nr;for(let nr=2;nr<=ir-er;++nr)rr*=nr;return tr/rr}function calcRationalCurveDerivatives(ir){const er=ir.length,tr=[],rr=[];for(let sr=0;sr<er;++sr){const ar=ir[sr];tr[sr]=new Vector3$1(ar.x,ar.y,ar.z),rr[sr]=ar.w}const nr=[];for(let sr=0;sr<er;++sr){const ar=tr[sr].clone();for(let or=1;or<=sr;++or)ar.sub(nr[sr-or].clone().multiplyScalar(calcKoverI(sr,or)*rr[or]));nr[sr]=ar.divideScalar(rr[0])}return nr}function calcNURBSDerivatives(ir,er,tr,rr,nr){const sr=calcBSplineDerivatives(ir,er,tr,rr,nr);return calcRationalCurveDerivatives(sr)}function calcSurfacePoint(ir,er,tr,rr,nr,sr,ar,or){const lr=findSpan(ir,sr,tr),cr=findSpan(er,ar,rr),hr=calcBasisFunctions(lr,sr,ir,tr),fr=calcBasisFunctions(cr,ar,er,rr),ur=[];for(let gr=0;gr<=er;++gr){ur[gr]=new Vector4(0,0,0,0);for(let _r=0;_r<=ir;++_r){const mr=nr[lr-ir+_r][cr-er+gr].clone(),dr=mr.w;mr.x*=dr,mr.y*=dr,mr.z*=dr,ur[gr].add(mr.multiplyScalar(hr[_r]))}}const pr=new Vector4(0,0,0,0);for(let gr=0;gr<=er;++gr)pr.add(ur[gr].multiplyScalar(fr[gr]));pr.divideScalar(pr.w),or.set(pr.x,pr.y,pr.z)}function calcVolumePoint(ir,er,tr,rr,nr,sr,ar,or,lr,cr,hr){const fr=findSpan(ir,or,rr),ur=findSpan(er,lr,nr),pr=findSpan(tr,cr,sr),gr=calcBasisFunctions(fr,or,ir,rr),_r=calcBasisFunctions(ur,lr,er,nr),mr=calcBasisFunctions(pr,cr,tr,sr),dr=[];for(let Ar=0;Ar<=tr;++Ar){dr[Ar]=[];for(let yr=0;yr<=er;++yr){dr[Ar][yr]=new Vector4(0,0,0,0);for(let wr=0;wr<=ir;++wr){const br=ar[fr-ir+wr][ur-er+yr][pr-tr+Ar].clone(),Sr=br.w;br.x*=Sr,br.y*=Sr,br.z*=Sr,dr[Ar][yr].add(br.multiplyScalar(gr[wr]))}}}const vr=new Vector4(0,0,0,0);for(let Ar=0;Ar<=tr;++Ar)for(let yr=0;yr<=er;++yr)vr.add(dr[Ar][yr].multiplyScalar(mr[Ar]).multiplyScalar(_r[yr]));vr.divideScalar(vr.w),hr.set(vr.x,vr.y,vr.z)}const NURBSUtils$1=Object.freeze(Object.defineProperty({__proto__:null,calcBSplineDerivatives,calcBSplinePoint,calcBasisFunctionDerivatives,calcBasisFunctions,calcKoverI,calcNURBSDerivatives,calcRationalCurveDerivatives,calcSurfacePoint,calcVolumePoint,findSpan},Symbol.toStringTag,{value:"Module"}));class NURBSCurve extends Curve{constructor(er,tr,rr,nr,sr){super();const ar=tr?tr.length-1:0,or=rr?rr.length:0;this.degree=er,this.knots=tr,this.controlPoints=[],this.startKnot=nr||0,this.endKnot=sr||ar;for(let lr=0;lr<or;++lr){const cr=rr[lr];this.controlPoints[lr]=new Vector4(cr.x,cr.y,cr.z,cr.w)}}getPoint(er,tr=new Vector3$1){const rr=tr,nr=this.knots[this.startKnot]+er*(this.knots[this.endKnot]-this.knots[this.startKnot]),sr=calcBSplinePoint(this.degree,this.knots,this.controlPoints,nr);return sr.w!==1&&sr.divideScalar(sr.w),rr.set(sr.x,sr.y,sr.z)}getTangent(er,tr=new Vector3$1){const rr=tr,nr=this.knots[0]+er*(this.knots[this.knots.length-1]-this.knots[0]),sr=calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,nr,1);return rr.copy(sr[1]).normalize(),rr}toJSON(){const er=super.toJSON();return er.degree=this.degree,er.knots=[...this.knots],er.controlPoints=this.controlPoints.map(tr=>tr.toArray()),er.startKnot=this.startKnot,er.endKnot=this.endKnot,er}fromJSON(er){return super.fromJSON(er),this.degree=er.degree,this.knots=[...er.knots],this.controlPoints=er.controlPoints.map(tr=>new Vector4(tr[0],tr[1],tr[2],tr[3])),this.startKnot=er.startKnot,this.endKnot=er.endKnot,this}}class NURBSSurface{constructor(er,tr,rr,nr,sr){this.degree1=er,this.degree2=tr,this.knots1=rr,this.knots2=nr,this.controlPoints=[];const ar=rr.length-er-1,or=nr.length-tr-1;for(let lr=0;lr<ar;++lr){this.controlPoints[lr]=[];for(let cr=0;cr<or;++cr){const hr=sr[lr][cr];this.controlPoints[lr][cr]=new Vector4(hr.x,hr.y,hr.z,hr.w)}}}getPoint(er,tr,rr){const nr=this.knots1[0]+er*(this.knots1[this.knots1.length-1]-this.knots1[0]),sr=this.knots2[0]+tr*(this.knots2[this.knots2.length-1]-this.knots2[0]);calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,nr,sr,rr)}}class NURBSVolume{constructor(er,tr,rr,nr,sr,ar,or){this.degree1=er,this.degree2=tr,this.degree3=rr,this.knots1=nr,this.knots2=sr,this.knots3=ar,this.controlPoints=[];const lr=nr.length-er-1,cr=sr.length-tr-1,hr=ar.length-rr-1;for(let fr=0;fr<lr;++fr){this.controlPoints[fr]=[];for(let ur=0;ur<cr;++ur){this.controlPoints[fr][ur]=[];for(let pr=0;pr<hr;++pr){const gr=or[fr][ur][pr];this.controlPoints[fr][ur][pr]=new Vector4(gr.x,gr.y,gr.z,gr.w)}}}}getPoint(er,tr,rr,nr){const sr=this.knots1[0]+er*(this.knots1[this.knots1.length-1]-this.knots1[0]),ar=this.knots2[0]+tr*(this.knots2[this.knots2.length-1]-this.knots2[0]),or=this.knots3[0]+rr*(this.knots3[this.knots3.length-1]-this.knots3[0]);calcVolumePoint(this.degree1,this.degree2,this.degree3,this.knots1,this.knots2,this.knots3,this.controlPoints,sr,ar,or,nr)}}class Pass{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const _camera=new OrthographicCamera(-1,1,1,-1,0,1);class FullscreenTriangleGeometry extends BufferGeometry{constructor(){super(),this.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2))}}const _geometry=new FullscreenTriangleGeometry;class FullScreenQuad{constructor(er){this._mesh=new Mesh(_geometry,er)}dispose(){this._mesh.geometry.dispose()}render(er){er.render(this._mesh,_camera)}get material(){return this._mesh.material}set material(er){this._mesh.material=er}}class AnaglyphEffect{constructor(er,tr=512,rr=512){this.colorMatrixLeft=new Matrix3().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=new Matrix3().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);const nr=new StereoCamera,sr={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat},ar=new WebGLRenderTarget(tr,rr,sr),or=new WebGLRenderTarget(tr,rr,sr),lr=new ShaderMaterial({uniforms:{mapLeft:{value:ar.texture},mapRight:{value:or.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","void main() {","	vec2 uv = vUv;","	vec4 colorL = texture2D( mapLeft, uv );","	vec4 colorR = texture2D( mapRight, uv );","	vec3 color = clamp(","			colorMatrixLeft * colorL.rgb +","			colorMatrixRight * colorR.rgb, 0., 1. );","	gl_FragColor = vec4(","			color.r, color.g, color.b,","			max( colorL.a, colorR.a ) );","	#include <tonemapping_fragment>","	#include <colorspace_fragment>","}"].join(`
`)}),cr=new FullScreenQuad(lr);this.setSize=function(hr,fr){er.setSize(hr,fr);const ur=er.getPixelRatio();ar.setSize(hr*ur,fr*ur),or.setSize(hr*ur,fr*ur)},this.render=function(hr,fr){const ur=er.getRenderTarget();hr.matrixWorldAutoUpdate===!0&&hr.updateMatrixWorld(),fr.parent===null&&fr.matrixWorldAutoUpdate===!0&&fr.updateMatrixWorld(),nr.update(fr),er.setRenderTarget(ar),er.clear(),er.render(hr,nr.cameraL),er.setRenderTarget(or),er.clear(),er.render(hr,nr.cameraR),er.setRenderTarget(null),cr.render(er),er.setRenderTarget(ur)},this.dispose=function(){ar.dispose(),or.dispose(),lr.dispose(),cr.dispose()}}}class AsciiEffect{constructor(er,tr=" .:-=+*#%@",rr={}){const nr=rr.resolution||.15,sr=rr.scale||1,ar=rr.color||!1,or=rr.alpha||!1,lr=rr.block||!1,cr=rr.invert||!1,hr=rr.strResolution||"low";let fr,ur;const pr=document.createElement("div");pr.style.cursor="default";const gr=document.createElement("table");pr.appendChild(gr);let _r,mr,dr;this.setSize=function(Nr,Ur){fr=Nr,ur=Ur,er.setSize(Nr,Ur),vr()},this.render=function(Nr,Ur){er.render(Nr,Ur),Fr(gr)},this.domElement=pr;function vr(){_r=Math.floor(fr*nr),mr=Math.floor(ur*nr),Sr.width=_r,Sr.height=mr,dr=er.domElement,dr.style.backgroundColor&&(gr.rows[0].cells[0].style.backgroundColor=dr.style.backgroundColor,gr.rows[0].cells[0].style.color=dr.style.color),gr.cellSpacing=0,gr.cellPadding=0;const Nr=gr.style;Nr.whiteSpace="pre",Nr.margin="0px",Nr.padding="0px",Nr.letterSpacing=Pr+"px",Nr.fontFamily=wr,Nr.fontSize=Ir+"px",Nr.lineHeight=Rr+"px",Nr.textAlign="left",Nr.textDecoration="none"}const Ar=" .,:;i1tfLCG08@".split(""),yr=" CGO08@".split(""),wr="courier new, monospace",br=er.domElement,Sr=document.createElement("canvas");if(!Sr.getContext)return;const xr=Sr.getContext("2d");if(!xr.getImageData)return;let Cr=ar?yr:Ar;tr&&(Cr=tr);const Ir=2/nr*sr,Rr=2/nr*sr;let Pr=0;if(hr=="low")switch(sr){case 1:Pr=-1;break;case 2:case 3:Pr=-2.1;break;case 4:Pr=-3.1;break;case 5:Pr=-4.15;break}if(hr=="medium")switch(sr){case 1:Pr=0;break;case 2:Pr=-1;break;case 3:Pr=-1.04;break;case 4:case 5:Pr=-2.1;break}if(hr=="high")switch(sr){case 1:case 2:Pr=0;break;case 3:case 4:case 5:Pr=-1;break}function Fr(Nr){xr.clearRect(0,0,_r,mr),xr.drawImage(br,0,0,_r,mr);const Ur=xr.getImageData(0,0,_r,mr).data;let Br="";for(let Or=0;Or<mr;Or+=2){for(let Dr=0;Dr<_r;Dr++){const Wr=(Or*_r+Dr)*4,$r=Ur[Wr],Yr=Ur[Wr+1],Qi=Ur[Wr+2],rs=Ur[Wr+3];let Kr,Qr;Qr=(.3*$r+.59*Yr+.11*Qi)/255,rs==0&&(Qr=1),Kr=Math.floor((1-Qr)*(Cr.length-1)),cr&&(Kr=Cr.length-Kr-1);let Vr=Cr[Kr];(Vr===void 0||Vr==" ")&&(Vr="&nbsp;"),ar?Br+="<span style='color:rgb("+$r+","+Yr+","+Qi+");"+(lr?"background-color:rgb("+$r+","+Yr+","+Qi+");":"")+(or?"opacity:"+rs/255+";":"")+"'>"+Vr+"</span>":Br+=Vr}Br+="<br/>"}Nr.innerHTML=`<tr><td style="display:block;width:${fr}px;height:${ur}px;overflow:hidden">${Br}</td></tr>`}}}class OutlineEffect{constructor(er,tr={}){this.enabled=!0;const rr=tr.defaultThickness!==void 0?tr.defaultThickness:.003,nr=new Color().fromArray(tr.defaultColor!==void 0?tr.defaultColor:[0,0,0]),sr=tr.defaultAlpha!==void 0?tr.defaultAlpha:1,ar=tr.defaultKeepAlive!==void 0?tr.defaultKeepAlive:!1,or={},lr=60,cr={},hr={},fr={outlineThickness:{value:rr},outlineColor:{value:nr},outlineAlpha:{value:sr}},ur=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","	float thickness = outlineThickness;","	const float ratio = 1.0;","	vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","	vec4 norm = normalize( pos - pos2 );","	return pos + norm * thickness * pos.w * ratio;","}","void main() {","	#include <uv_vertex>","	#include <beginnormal_vertex>","	#include <morphnormal_vertex>","	#include <skinbase_vertex>","	#include <skinnormal_vertex>","	#include <begin_vertex>","	#include <morphtarget_vertex>","	#include <skinning_vertex>","	#include <displacementmap_vertex>","	#include <project_vertex>","	vec3 outlineNormal = - objectNormal;","	gl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","	#include <logdepthbuf_vertex>","	#include <clipping_planes_vertex>","	#include <fog_vertex>","}"].join(`
`),pr=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","	#include <clipping_planes_fragment>","	#include <logdepthbuf_fragment>","	gl_FragColor = vec4( outlineColor, outlineAlpha );","	#include <tonemapping_fragment>","	#include <colorspace_fragment>","	#include <fog_fragment>","	#include <premultiplied_alpha_fragment>","}"].join(`
`);function gr(){return new ShaderMaterial({type:"OutlineEffect",uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.displacementmap,fr]),vertexShader:ur,fragmentShader:pr,side:BackSide})}function _r(xr){let Cr=or[xr.uuid];return Cr===void 0&&(Cr={material:gr(),used:!0,keepAlive:ar,count:0},or[xr.uuid]=Cr),Cr.used=!0,Cr.material}function mr(xr){const Cr=_r(xr);return cr[Cr.uuid]=xr,br(Cr,xr),Cr}function dr(xr){const Cr=xr.geometry,Ir=Cr!==void 0&&Cr.attributes.normal!==void 0;return xr.isMesh===!0&&xr.material!==void 0&&Ir===!0}function vr(xr){if(dr(xr)!==!1){if(Array.isArray(xr.material))for(let Cr=0,Ir=xr.material.length;Cr<Ir;Cr++)xr.material[Cr]=mr(xr.material[Cr]);else xr.material=mr(xr.material);hr[xr.uuid]=xr.onBeforeRender,xr.onBeforeRender=yr}}function Ar(xr){if(dr(xr)!==!1){if(Array.isArray(xr.material))for(let Cr=0,Ir=xr.material.length;Cr<Ir;Cr++)xr.material[Cr]=cr[xr.material[Cr].uuid];else xr.material=cr[xr.material.uuid];xr.onBeforeRender=hr[xr.uuid]}}function yr(xr,Cr,Ir,Rr,Pr){const Fr=cr[Pr.uuid];Fr!==void 0&&wr(Pr,Fr)}function wr(xr,Cr){const Ir=Cr.userData.outlineParameters;xr.uniforms.outlineAlpha.value=Cr.opacity,Ir!==void 0&&(Ir.thickness!==void 0&&(xr.uniforms.outlineThickness.value=Ir.thickness),Ir.color!==void 0&&xr.uniforms.outlineColor.value.fromArray(Ir.color),Ir.alpha!==void 0&&(xr.uniforms.outlineAlpha.value=Ir.alpha)),Cr.displacementMap&&(xr.uniforms.displacementMap.value=Cr.displacementMap,xr.uniforms.displacementScale.value=Cr.displacementScale,xr.uniforms.displacementBias.value=Cr.displacementBias)}function br(xr,Cr){if(xr.name==="invisible")return;const Ir=Cr.userData.outlineParameters;xr.fog=Cr.fog,xr.toneMapped=Cr.toneMapped,xr.premultipliedAlpha=Cr.premultipliedAlpha,xr.displacementMap=Cr.displacementMap,Ir!==void 0?(Cr.visible===!1?xr.visible=!1:xr.visible=Ir.visible!==void 0?Ir.visible:!0,xr.transparent=Ir.alpha!==void 0&&Ir.alpha<1?!0:Cr.transparent,Ir.keepAlive!==void 0&&(or[Cr.uuid].keepAlive=Ir.keepAlive)):(xr.transparent=Cr.transparent,xr.visible=Cr.visible),(Cr.wireframe===!0||Cr.depthTest===!1)&&(xr.visible=!1),Cr.clippingPlanes&&(xr.clipping=!0,xr.clippingPlanes=Cr.clippingPlanes,xr.clipIntersection=Cr.clipIntersection,xr.clipShadows=Cr.clipShadows),xr.version=Cr.version}function Sr(){let xr;xr=Object.keys(cr);for(let Cr=0,Ir=xr.length;Cr<Ir;Cr++)cr[xr[Cr]]=void 0;xr=Object.keys(hr);for(let Cr=0,Ir=xr.length;Cr<Ir;Cr++)hr[xr[Cr]]=void 0;xr=Object.keys(or);for(let Cr=0,Ir=xr.length;Cr<Ir;Cr++){const Rr=xr[Cr];or[Rr].used===!1?(or[Rr].count++,or[Rr].keepAlive===!1&&or[Rr].count>lr&&delete or[Rr]):(or[Rr].used=!1,or[Rr].count=0)}}this.render=function(xr,Cr){if(this.enabled===!1){er.render(xr,Cr);return}const Ir=er.autoClear;er.autoClear=this.autoClear,er.render(xr,Cr),er.autoClear=Ir,this.renderOutline(xr,Cr)},this.renderOutline=function(xr,Cr){const Ir=er.autoClear,Rr=xr.matrixWorldAutoUpdate,Pr=xr.background,Fr=er.shadowMap.enabled;xr.matrixWorldAutoUpdate=!1,xr.background=null,er.autoClear=!1,er.shadowMap.enabled=!1,xr.traverse(vr),er.render(xr,Cr),xr.traverse(Ar),Sr(),xr.matrixWorldAutoUpdate=Rr,xr.background=Pr,er.autoClear=Ir,er.shadowMap.enabled=Fr},this.autoClear=er.autoClear,this.domElement=er.domElement,this.shadowMap=er.shadowMap,this.clear=function(xr,Cr,Ir){er.clear(xr,Cr,Ir)},this.getPixelRatio=function(){return er.getPixelRatio()},this.setPixelRatio=function(xr){er.setPixelRatio(xr)},this.getSize=function(xr){return er.getSize(xr)},this.setSize=function(xr,Cr,Ir){er.setSize(xr,Cr,Ir)},this.setViewport=function(xr,Cr,Ir,Rr){er.setViewport(xr,Cr,Ir,Rr)},this.setScissor=function(xr,Cr,Ir,Rr){er.setScissor(xr,Cr,Ir,Rr)},this.setScissorTest=function(xr){er.setScissorTest(xr)},this.setRenderTarget=function(xr){er.setRenderTarget(xr)}}}class ParallaxBarrierEffect{constructor(er){const tr=new StereoCamera,rr={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat},nr=new WebGLRenderTarget(512,512,rr),sr=new WebGLRenderTarget(512,512,rr),ar=new ShaderMaterial({uniforms:{mapLeft:{value:nr.texture},mapRight:{value:sr.texture}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","	vec2 uv = vUv;","	if ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","		gl_FragColor = texture2D( mapLeft, uv );","	} else {","		gl_FragColor = texture2D( mapRight, uv );","	}","	#include <tonemapping_fragment>","	#include <colorspace_fragment>","}"].join(`
`)}),or=new FullScreenQuad(ar);this.setSize=function(lr,cr){er.setSize(lr,cr);const hr=er.getPixelRatio();nr.setSize(lr*hr,cr*hr),sr.setSize(lr*hr,cr*hr)},this.render=function(lr,cr){const hr=er.getRenderTarget();lr.matrixWorldAutoUpdate===!0&&lr.updateMatrixWorld(),cr.parent===null&&cr.matrixWorldAutoUpdate===!0&&cr.updateMatrixWorld(),tr.update(cr),er.setRenderTarget(nr),er.clear(),er.render(lr,tr.cameraL),er.setRenderTarget(sr),er.clear(),er.render(lr,tr.cameraR),er.setRenderTarget(null),or.render(er),er.setRenderTarget(hr)},this.dispose=function(){nr.dispose(),sr.dispose(),ar.dispose(),or.dispose()}}}class PeppersGhostEffect{constructor(er){const tr=this;tr.cameraDistance=15,tr.reflectFromAbove=!1;let rr,nr,sr;const ar=new PerspectiveCamera,or=new PerspectiveCamera,lr=new PerspectiveCamera,cr=new PerspectiveCamera,hr=new Vector3$1,fr=new Quaternion$1,ur=new Vector3$1;er.autoClear=!1,this.setSize=function(pr,gr){rr=pr/2,pr<gr?(nr=pr/3,sr=pr/3):(nr=gr/3,sr=gr/3),er.setSize(pr,gr)},this.render=function(pr,gr){pr.matrixWorldAutoUpdate===!0&&pr.updateMatrixWorld(),gr.parent===null&&gr.matrixWorldAutoUpdate===!0&&gr.updateMatrixWorld(),gr.matrixWorld.decompose(hr,fr,ur),ar.position.copy(hr),ar.quaternion.copy(fr),ar.translateZ(tr.cameraDistance),ar.lookAt(pr.position),or.position.copy(hr),or.quaternion.copy(fr),or.translateZ(-tr.cameraDistance),or.lookAt(pr.position),or.rotation.z+=180*(Math.PI/180),lr.position.copy(hr),lr.quaternion.copy(fr),lr.translateX(-tr.cameraDistance),lr.lookAt(pr.position),lr.rotation.x+=90*(Math.PI/180),cr.position.copy(hr),cr.quaternion.copy(fr),cr.translateX(tr.cameraDistance),cr.lookAt(pr.position),cr.rotation.x+=90*(Math.PI/180),er.clear(),er.setScissorTest(!0),er.setScissor(rr-nr/2,sr*2,nr,sr),er.setViewport(rr-nr/2,sr*2,nr,sr),tr.reflectFromAbove?er.render(pr,or):er.render(pr,ar),er.setScissor(rr-nr/2,0,nr,sr),er.setViewport(rr-nr/2,0,nr,sr),tr.reflectFromAbove?er.render(pr,ar):er.render(pr,or),er.setScissor(rr-nr/2-nr,sr,nr,sr),er.setViewport(rr-nr/2-nr,sr,nr,sr),tr.reflectFromAbove?er.render(pr,cr):er.render(pr,lr),er.setScissor(rr+nr/2,sr,nr,sr),er.setViewport(rr+nr/2,sr,nr,sr),tr.reflectFromAbove?er.render(pr,lr):er.render(pr,cr),er.setScissorTest(!1)}}}class StereoEffect{constructor(er){const tr=new StereoCamera;tr.aspect=.5;const rr=new Vector2;this.setEyeSeparation=function(nr){tr.eyeSep=nr},this.setSize=function(nr,sr){er.setSize(nr,sr)},this.render=function(nr,sr){nr.matrixWorldAutoUpdate===!0&&nr.updateMatrixWorld(),sr.parent===null&&sr.matrixWorldAutoUpdate===!0&&sr.updateMatrixWorld(),tr.update(sr);const ar=er.autoClear;er.getSize(rr),er.autoClear=!1,er.clear(),er.setScissorTest(!0),er.setScissor(0,0,rr.width/2,rr.height),er.setViewport(0,0,rr.width/2,rr.height),er.render(nr,tr.cameraL),er.setScissor(rr.width/2,0,rr.width/2,rr.height),er.setViewport(rr.width/2,0,rr.width/2,rr.height),er.render(nr,tr.cameraR),er.setScissorTest(!1),er.autoClear=ar}}}class DebugEnvironment extends Scene{constructor(){super();const er=new BoxGeometry;er.deleteAttribute("uv");const tr=new MeshStandardMaterial({metalness:0,side:BackSide}),rr=new Mesh(er,tr);rr.scale.setScalar(10),this.add(rr);const nr=new PointLight(16777215,50,0,2);this.add(nr);const sr=new MeshLambertMaterial({color:16711680,emissive:16777215,emissiveIntensity:10}),ar=new Mesh(er,sr);ar.position.set(-5,2,0),ar.scale.set(.1,1,1),this.add(ar);const or=new MeshLambertMaterial({color:65280,emissive:16777215,emissiveIntensity:10}),lr=new Mesh(er,or);lr.position.set(0,5,0),lr.scale.set(1,.1,1),this.add(lr);const cr=new MeshLambertMaterial({color:255,emissive:16777215,emissiveIntensity:10}),hr=new Mesh(er,cr);hr.position.set(2,1,5),hr.scale.set(1.5,2,.1),this.add(hr)}}class RoomEnvironment extends Scene{constructor(){super();const er=new BoxGeometry;er.deleteAttribute("uv");const tr=new MeshStandardMaterial({side:BackSide}),rr=new MeshStandardMaterial,nr=new PointLight(16777215,900,28,2);nr.position.set(.418,16.199,.3),this.add(nr);const sr=new Mesh(er,tr);sr.position.set(-.757,13.219,.717),sr.scale.set(31.713,28.305,28.591),this.add(sr);const ar=new Mesh(er,rr);ar.position.set(-10.906,2.009,1.846),ar.rotation.set(0,-.195,0),ar.scale.set(2.328,7.905,4.651),this.add(ar);const or=new Mesh(er,rr);or.position.set(-5.607,-.754,-.758),or.rotation.set(0,.994,0),or.scale.set(1.97,1.534,3.955),this.add(or);const lr=new Mesh(er,rr);lr.position.set(6.167,.857,7.803),lr.rotation.set(0,.561,0),lr.scale.set(3.927,6.285,3.687),this.add(lr);const cr=new Mesh(er,rr);cr.position.set(-2.017,.018,6.124),cr.rotation.set(0,.333,0),cr.scale.set(2.002,4.566,2.064),this.add(cr);const hr=new Mesh(er,rr);hr.position.set(2.291,-.756,-2.621),hr.rotation.set(0,-.286,0),hr.scale.set(1.546,1.552,1.496),this.add(hr);const fr=new Mesh(er,rr);fr.position.set(-2.193,-.369,-5.547),fr.rotation.set(0,.516,0),fr.scale.set(3.875,3.487,2.986),this.add(fr);const ur=new Mesh(er,createAreaLightMaterial(50));ur.position.set(-16.116,14.37,8.208),ur.scale.set(.1,2.428,2.739),this.add(ur);const pr=new Mesh(er,createAreaLightMaterial(50));pr.position.set(-16.109,18.021,-8.207),pr.scale.set(.1,2.425,2.751),this.add(pr);const gr=new Mesh(er,createAreaLightMaterial(17));gr.position.set(14.904,12.198,-1.832),gr.scale.set(.15,4.265,6.331),this.add(gr);const _r=new Mesh(er,createAreaLightMaterial(43));_r.position.set(-.462,8.89,14.52),_r.scale.set(4.38,5.441,.088),this.add(_r);const mr=new Mesh(er,createAreaLightMaterial(20));mr.position.set(3.235,11.486,-12.541),mr.scale.set(2.5,2,.1),this.add(mr);const dr=new Mesh(er,createAreaLightMaterial(100));dr.position.set(0,20,0),dr.scale.set(1,.1,1),this.add(dr)}dispose(){const er=new Set;this.traverse(tr=>{tr.isMesh&&(er.add(tr.geometry),er.add(tr.material))});for(const tr of er)tr.dispose()}}function createAreaLightMaterial(ir){const er=new MeshBasicMaterial;return er.color.setScalar(ir),er}class DRACOExporter{parse(er,tr={}){if(tr=Object.assign({decodeSpeed:5,encodeSpeed:5,encoderMethod:DRACOExporter.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1},tr),DracoEncoderModule===void 0)throw new Error("THREE.DRACOExporter: required the draco_encoder to work.");const rr=er.geometry,nr=DracoEncoderModule(),sr=new nr.Encoder;let ar,or;if(er.isMesh===!0){ar=new nr.MeshBuilder,or=new nr.Mesh;const pr=rr.getAttribute("position");ar.AddFloatAttributeToMesh(or,nr.POSITION,pr.count,pr.itemSize,pr.array);const gr=rr.getIndex();if(gr!==null)ar.AddFacesToMesh(or,gr.count/3,gr.array);else{const _r=new(pr.count>65535?Uint32Array:Uint16Array)(pr.count);for(let mr=0;mr<_r.length;mr++)_r[mr]=mr;ar.AddFacesToMesh(or,pr.count,_r)}if(tr.exportNormals===!0){const _r=rr.getAttribute("normal");_r!==void 0&&ar.AddFloatAttributeToMesh(or,nr.NORMAL,_r.count,_r.itemSize,_r.array)}if(tr.exportUvs===!0){const _r=rr.getAttribute("uv");_r!==void 0&&ar.AddFloatAttributeToMesh(or,nr.TEX_COORD,_r.count,_r.itemSize,_r.array)}if(tr.exportColor===!0){const _r=rr.getAttribute("color");if(_r!==void 0){const mr=createVertexColorSRGBArray(_r);ar.AddFloatAttributeToMesh(or,nr.COLOR,_r.count,_r.itemSize,mr)}}}else if(er.isPoints===!0){ar=new nr.PointCloudBuilder,or=new nr.PointCloud;const pr=rr.getAttribute("position");if(ar.AddFloatAttribute(or,nr.POSITION,pr.count,pr.itemSize,pr.array),tr.exportColor===!0){const gr=rr.getAttribute("color");if(gr!==void 0){const _r=createVertexColorSRGBArray(gr);ar.AddFloatAttribute(or,nr.COLOR,gr.count,gr.itemSize,_r)}}}else throw new Error("DRACOExporter: Unsupported object type.");const lr=new nr.DracoInt8Array,cr=tr.encodeSpeed!==void 0?tr.encodeSpeed:5,hr=tr.decodeSpeed!==void 0?tr.decodeSpeed:5;if(sr.SetSpeedOptions(cr,hr),tr.encoderMethod!==void 0&&sr.SetEncodingMethod(tr.encoderMethod),tr.quantization!==void 0)for(let pr=0;pr<5;pr++)tr.quantization[pr]!==void 0&&sr.SetAttributeQuantization(pr,tr.quantization[pr]);let fr;if(er.isMesh===!0?fr=sr.EncodeMeshToDracoBuffer(or,lr):fr=sr.EncodePointCloudToDracoBuffer(or,!0,lr),nr.destroy(or),fr===0)throw new Error("THREE.DRACOExporter: Draco encoding failed.");const ur=new Int8Array(new ArrayBuffer(fr));for(let pr=0;pr<fr;pr++)ur[pr]=lr.GetValue(pr);return nr.destroy(lr),nr.destroy(sr),nr.destroy(ar),ur}}function createVertexColorSRGBArray(ir){const er=new Color,tr=ir.count,rr=ir.itemSize,nr=new Float32Array(tr*rr);for(let sr=0,ar=tr;sr<ar;sr++)er.fromBufferAttribute(ir,sr),ColorManagement.fromWorkingColorSpace(er,SRGBColorSpace),nr[sr*rr]=er.r,nr[sr*rr+1]=er.g,nr[sr*rr+2]=er.b,rr===4&&(nr[sr*rr+3]=ir.getW(sr));return nr}DRACOExporter.MESH_EDGEBREAKER_ENCODING=1;DRACOExporter.MESH_SEQUENTIAL_ENCODING=0;DRACOExporter.POINT_CLOUD=0;DRACOExporter.TRIANGULAR_MESH=1;DRACOExporter.INVALID=-1;DRACOExporter.POSITION=0;DRACOExporter.NORMAL=1;DRACOExporter.COLOR=2;DRACOExporter.TEX_COORD=3;DRACOExporter.GENERIC=4;/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var ch2={},wk=function(ir,er,tr,rr,nr){var sr=new Worker(ch2[er]||(ch2[er]=URL.createObjectURL(new Blob([ir+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return sr.onmessage=function(ar){var or=ar.data,lr=or.$e$;if(lr){var cr=new Error(lr[0]);cr.code=lr[1],cr.stack=lr[2],nr(cr,null)}else nr(null,or)},sr.postMessage(tr,rr),sr},u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(ir,er){for(var tr=new u16(31),rr=0;rr<31;++rr)tr[rr]=er+=1<<ir[rr-1];for(var nr=new i32(tr[30]),rr=1;rr<30;++rr)for(var sr=tr[rr];sr<tr[rr+1];++sr)nr[sr]=sr-tr[rr]<<5|rr;return{b:tr,r:nr}},_a$1=freb(fleb,2),fl=_a$1.b,revfl=_a$1.r;fl[28]=258,revfl[258]=28;var _b$1=freb(fdeb,0),fd=_b$1.b,revfd=_b$1.r,rev=new u16(32768);for(var i$1=0;i$1<32768;++i$1){var x$1=(i$1&43690)>>1|(i$1&21845)<<1;x$1=(x$1&52428)>>2|(x$1&13107)<<2,x$1=(x$1&61680)>>4|(x$1&3855)<<4,rev[i$1]=((x$1&65280)>>8|(x$1&255)<<8)>>1}var hMap=function(ir,er,tr){for(var rr=ir.length,nr=0,sr=new u16(er);nr<rr;++nr)ir[nr]&&++sr[ir[nr]-1];var ar=new u16(er);for(nr=1;nr<er;++nr)ar[nr]=ar[nr-1]+sr[nr-1]<<1;var or;if(tr){or=new u16(1<<er);var lr=15-er;for(nr=0;nr<rr;++nr)if(ir[nr])for(var cr=nr<<4|ir[nr],hr=er-ir[nr],fr=ar[ir[nr]-1]++<<hr,ur=fr|(1<<hr)-1;fr<=ur;++fr)or[rev[fr]>>lr]=cr}else for(or=new u16(rr),nr=0;nr<rr;++nr)ir[nr]&&(or[nr]=rev[ar[ir[nr]-1]++]>>15-ir[nr]);return or},flt=new u8(288);for(var i$1=0;i$1<144;++i$1)flt[i$1]=8;for(var i$1=144;i$1<256;++i$1)flt[i$1]=9;for(var i$1=256;i$1<280;++i$1)flt[i$1]=7;for(var i$1=280;i$1<288;++i$1)flt[i$1]=8;var fdt=new u8(32);for(var i$1=0;i$1<32;++i$1)fdt[i$1]=5;var flm=hMap(flt,9,0),flrm=hMap(flt,9,1),fdm=hMap(fdt,5,0),fdrm=hMap(fdt,5,1),max=function(ir){for(var er=ir[0],tr=1;tr<ir.length;++tr)ir[tr]>er&&(er=ir[tr]);return er},bits=function(ir,er,tr){var rr=er/8|0;return(ir[rr]|ir[rr+1]<<8)>>(er&7)&tr},bits16=function(ir,er){var tr=er/8|0;return(ir[tr]|ir[tr+1]<<8|ir[tr+2]<<16)>>(er&7)},shft=function(ir){return(ir+7)/8|0},slc=function(ir,er,tr){return(er==null||er<0)&&(er=0),(tr==null||tr>ir.length)&&(tr=ir.length),new u8(ir.subarray(er,tr))},FlateErrorCode={UnexpectedEOF:0,InvalidBlockType:1,InvalidLengthLiteral:2,InvalidDistance:3,StreamFinished:4,NoStreamHandler:5,InvalidHeader:6,NoCallback:7,InvalidUTF8:8,ExtraFieldTooLong:9,InvalidDate:10,FilenameTooLong:11,StreamFinishing:12,InvalidZipData:13,UnknownCompressionMethod:14},ec=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],err=function(ir,er,tr){var rr=new Error(er||ec[ir]);if(rr.code=ir,Error.captureStackTrace&&Error.captureStackTrace(rr,err),!tr)throw rr;return rr},inflt=function(ir,er,tr,rr){var nr=ir.length,sr=rr?rr.length:0;if(!nr||er.f&&!er.l)return tr||new u8(0);var ar=!tr,or=ar||er.i!=2,lr=er.i;ar&&(tr=new u8(nr*3));var cr=function(Zi){var Yi=tr.length;if(Zi>Yi){var qi=new u8(Math.max(Yi*2,Zi));qi.set(tr),tr=qi}},hr=er.f||0,fr=er.p||0,ur=er.b||0,pr=er.l,gr=er.d,_r=er.m,mr=er.n,dr=nr*8;do{if(!pr){hr=bits(ir,fr,1);var vr=bits(ir,fr+1,3);if(fr+=3,vr)if(vr==1)pr=flrm,gr=fdrm,_r=9,mr=5;else if(vr==2){var br=bits(ir,fr,31)+257,Sr=bits(ir,fr+10,15)+4,xr=br+bits(ir,fr+5,31)+1;fr+=14;for(var Cr=new u8(xr),Ir=new u8(19),Rr=0;Rr<Sr;++Rr)Ir[clim[Rr]]=bits(ir,fr+Rr*3,7);fr+=Sr*3;for(var Pr=max(Ir),Fr=(1<<Pr)-1,Nr=hMap(Ir,Pr,1),Rr=0;Rr<xr;){var Ur=Nr[bits(ir,fr,Fr)];fr+=Ur&15;var Ar=Ur>>4;if(Ar<16)Cr[Rr++]=Ar;else{var Br=0,Or=0;for(Ar==16?(Or=3+bits(ir,fr,3),fr+=2,Br=Cr[Rr-1]):Ar==17?(Or=3+bits(ir,fr,7),fr+=3):Ar==18&&(Or=11+bits(ir,fr,127),fr+=7);Or--;)Cr[Rr++]=Br}}var Dr=Cr.subarray(0,br),Wr=Cr.subarray(br);_r=max(Dr),mr=max(Wr),pr=hMap(Dr,_r,1),gr=hMap(Wr,mr,1)}else err(1);else{var Ar=shft(fr)+4,yr=ir[Ar-4]|ir[Ar-3]<<8,wr=Ar+yr;if(wr>nr){lr&&err(0);break}or&&cr(ur+yr),tr.set(ir.subarray(Ar,wr),ur),er.b=ur+=yr,er.p=fr=wr*8,er.f=hr;continue}if(fr>dr){lr&&err(0);break}}or&&cr(ur+131072);for(var $r=(1<<_r)-1,Yr=(1<<mr)-1,Qi=fr;;Qi=fr){var Br=pr[bits16(ir,fr)&$r],rs=Br>>4;if(fr+=Br&15,fr>dr){lr&&err(0);break}if(Br||err(2),rs<256)tr[ur++]=rs;else if(rs==256){Qi=fr,pr=null;break}else{var Kr=rs-254;if(rs>264){var Rr=rs-257,Qr=fleb[Rr];Kr=bits(ir,fr,(1<<Qr)-1)+fl[Rr],fr+=Qr}var Vr=gr[bits16(ir,fr)&Yr],Gr=Vr>>4;Vr||err(3),fr+=Vr&15;var Wr=fd[Gr];if(Gr>3){var Qr=fdeb[Gr];Wr+=bits16(ir,fr)&(1<<Qr)-1,fr+=Qr}if(fr>dr){lr&&err(0);break}or&&cr(ur+131072);var qr=ur+Kr;if(ur<Wr){var ji=sr-Wr,Zr=Math.min(Wr,qr);for(ji+ur<0&&err(3);ur<Zr;++ur)tr[ur]=rr[ji+ur]}for(;ur<qr;++ur)tr[ur]=tr[ur-Wr]}}er.l=pr,er.p=Qi,er.b=ur,er.f=hr,pr&&(hr=1,er.m=_r,er.d=gr,er.n=mr)}while(!hr);return ur!=tr.length&&ar?slc(tr,0,ur):tr.subarray(0,ur)},wbits=function(ir,er,tr){tr<<=er&7;var rr=er/8|0;ir[rr]|=tr,ir[rr+1]|=tr>>8},wbits16=function(ir,er,tr){tr<<=er&7;var rr=er/8|0;ir[rr]|=tr,ir[rr+1]|=tr>>8,ir[rr+2]|=tr>>16},hTree=function(ir,er){for(var tr=[],rr=0;rr<ir.length;++rr)ir[rr]&&tr.push({s:rr,f:ir[rr]});var nr=tr.length,sr=tr.slice();if(!nr)return{t:et$2,l:0};if(nr==1){var ar=new u8(tr[0].s+1);return ar[tr[0].s]=1,{t:ar,l:1}}tr.sort(function(wr,br){return wr.f-br.f}),tr.push({s:-1,f:25001});var or=tr[0],lr=tr[1],cr=0,hr=1,fr=2;for(tr[0]={s:-1,f:or.f+lr.f,l:or,r:lr};hr!=nr-1;)or=tr[tr[cr].f<tr[fr].f?cr++:fr++],lr=tr[cr!=hr&&tr[cr].f<tr[fr].f?cr++:fr++],tr[hr++]={s:-1,f:or.f+lr.f,l:or,r:lr};for(var ur=sr[0].s,rr=1;rr<nr;++rr)sr[rr].s>ur&&(ur=sr[rr].s);var pr=new u16(ur+1),gr=ln$1(tr[hr-1],pr,0);if(gr>er){var rr=0,_r=0,mr=gr-er,dr=1<<mr;for(sr.sort(function(br,Sr){return pr[Sr.s]-pr[br.s]||br.f-Sr.f});rr<nr;++rr){var vr=sr[rr].s;if(pr[vr]>er)_r+=dr-(1<<gr-pr[vr]),pr[vr]=er;else break}for(_r>>=mr;_r>0;){var Ar=sr[rr].s;pr[Ar]<er?_r-=1<<er-pr[Ar]++-1:++rr}for(;rr>=0&&_r;--rr){var yr=sr[rr].s;pr[yr]==er&&(--pr[yr],++_r)}gr=er}return{t:new u8(pr),l:gr}},ln$1=function(ir,er,tr){return ir.s==-1?Math.max(ln$1(ir.l,er,tr+1),ln$1(ir.r,er,tr+1)):er[ir.s]=tr},lc=function(ir){for(var er=ir.length;er&&!ir[--er];);for(var tr=new u16(++er),rr=0,nr=ir[0],sr=1,ar=function(lr){tr[rr++]=lr},or=1;or<=er;++or)if(ir[or]==nr&&or!=er)++sr;else{if(!nr&&sr>2){for(;sr>138;sr-=138)ar(32754);sr>2&&(ar(sr>10?sr-11<<5|28690:sr-3<<5|12305),sr=0)}else if(sr>3){for(ar(nr),--sr;sr>6;sr-=6)ar(8304);sr>2&&(ar(sr-3<<5|8208),sr=0)}for(;sr--;)ar(nr);sr=1,nr=ir[or]}return{c:tr.subarray(0,rr),n:er}},clen=function(ir,er){for(var tr=0,rr=0;rr<er.length;++rr)tr+=ir[rr]*er[rr];return tr},wfblk=function(ir,er,tr){var rr=tr.length,nr=shft(er+2);ir[nr]=rr&255,ir[nr+1]=rr>>8,ir[nr+2]=ir[nr]^255,ir[nr+3]=ir[nr+1]^255;for(var sr=0;sr<rr;++sr)ir[nr+sr+4]=tr[sr];return(nr+4+rr)*8},wblk=function(ir,er,tr,rr,nr,sr,ar,or,lr,cr,hr){wbits(er,hr++,tr),++nr[256];for(var fr=hTree(nr,15),ur=fr.t,pr=fr.l,gr=hTree(sr,15),_r=gr.t,mr=gr.l,dr=lc(ur),vr=dr.c,Ar=dr.n,yr=lc(_r),wr=yr.c,br=yr.n,Sr=new u16(19),xr=0;xr<vr.length;++xr)++Sr[vr[xr]&31];for(var xr=0;xr<wr.length;++xr)++Sr[wr[xr]&31];for(var Cr=hTree(Sr,7),Ir=Cr.t,Rr=Cr.l,Pr=19;Pr>4&&!Ir[clim[Pr-1]];--Pr);var Fr=cr+5<<3,Nr=clen(nr,flt)+clen(sr,fdt)+ar,Ur=clen(nr,ur)+clen(sr,_r)+ar+14+3*Pr+clen(Sr,Ir)+2*Sr[16]+3*Sr[17]+7*Sr[18];if(lr>=0&&Fr<=Nr&&Fr<=Ur)return wfblk(er,hr,ir.subarray(lr,lr+cr));var Br,Or,Dr,Wr;if(wbits(er,hr,1+(Ur<Nr)),hr+=2,Ur<Nr){Br=hMap(ur,pr,0),Or=ur,Dr=hMap(_r,mr,0),Wr=_r;var $r=hMap(Ir,Rr,0);wbits(er,hr,Ar-257),wbits(er,hr+5,br-1),wbits(er,hr+10,Pr-4),hr+=14;for(var xr=0;xr<Pr;++xr)wbits(er,hr+3*xr,Ir[clim[xr]]);hr+=3*Pr;for(var Yr=[vr,wr],Qi=0;Qi<2;++Qi)for(var rs=Yr[Qi],xr=0;xr<rs.length;++xr){var Kr=rs[xr]&31;wbits(er,hr,$r[Kr]),hr+=Ir[Kr],Kr>15&&(wbits(er,hr,rs[xr]>>5&127),hr+=rs[xr]>>12)}}else Br=flm,Or=flt,Dr=fdm,Wr=fdt;for(var xr=0;xr<or;++xr){var Qr=rr[xr];if(Qr>255){var Kr=Qr>>18&31;wbits16(er,hr,Br[Kr+257]),hr+=Or[Kr+257],Kr>7&&(wbits(er,hr,Qr>>23&31),hr+=fleb[Kr]);var Vr=Qr&31;wbits16(er,hr,Dr[Vr]),hr+=Wr[Vr],Vr>3&&(wbits16(er,hr,Qr>>5&8191),hr+=fdeb[Vr])}else wbits16(er,hr,Br[Qr]),hr+=Or[Qr]}return wbits16(er,hr,Br[256]),hr+Or[256]},deo=new i32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et$2=new u8(0),dflt=function(ir,er,tr,rr,nr,sr){var ar=sr.z||ir.length,or=new u8(rr+ar+5*(1+Math.ceil(ar/7e3))+nr),lr=or.subarray(rr,or.length-nr),cr=sr.l,hr=(sr.r||0)&7;if(er){hr&&(lr[0]=sr.r>>3);for(var fr=deo[er-1],ur=fr>>13,pr=fr&8191,gr=(1<<tr)-1,_r=sr.p||new u16(32768),mr=sr.h||new u16(gr+1),dr=Math.ceil(tr/3),vr=2*dr,Ar=function(Xr){return(ir[Xr]^ir[Xr+1]<<dr^ir[Xr+2]<<vr)&gr},yr=new i32(25e3),wr=new u16(288),br=new u16(32),Sr=0,xr=0,Cr=sr.i||0,Ir=0,Rr=sr.w||0,Pr=0;Cr+2<ar;++Cr){var Fr=Ar(Cr),Nr=Cr&32767,Ur=mr[Fr];if(_r[Nr]=Ur,mr[Fr]=Nr,Rr<=Cr){var Br=ar-Cr;if((Sr>7e3||Ir>24576)&&(Br>423||!cr)){hr=wblk(ir,lr,0,yr,wr,br,xr,Ir,Pr,Cr-Pr,hr),Ir=Sr=xr=0,Pr=Cr;for(var Or=0;Or<286;++Or)wr[Or]=0;for(var Or=0;Or<30;++Or)br[Or]=0}var Dr=2,Wr=0,$r=pr,Yr=Nr-Ur&32767;if(Br>2&&Fr==Ar(Cr-Yr))for(var Qi=Math.min(ur,Br)-1,rs=Math.min(32767,Cr),Kr=Math.min(258,Br);Yr<=rs&&--$r&&Nr!=Ur;){if(ir[Cr+Dr]==ir[Cr+Dr-Yr]){for(var Qr=0;Qr<Kr&&ir[Cr+Qr]==ir[Cr+Qr-Yr];++Qr);if(Qr>Dr){if(Dr=Qr,Wr=Yr,Qr>Qi)break;for(var Vr=Math.min(Yr,Qr-2),Gr=0,Or=0;Or<Vr;++Or){var qr=Cr-Yr+Or&32767,ji=_r[qr],Zr=qr-ji&32767;Zr>Gr&&(Gr=Zr,Ur=qr)}}}Nr=Ur,Ur=_r[Nr],Yr+=Nr-Ur&32767}if(Wr){yr[Ir++]=268435456|revfl[Dr]<<18|revfd[Wr];var Zi=revfl[Dr]&31,Yi=revfd[Wr]&31;xr+=fleb[Zi]+fdeb[Yi],++wr[257+Zi],++br[Yi],Rr=Cr+Dr,++Sr}else yr[Ir++]=ir[Cr],++wr[ir[Cr]]}}for(Cr=Math.max(Cr,Rr);Cr<ar;++Cr)yr[Ir++]=ir[Cr],++wr[ir[Cr]];hr=wblk(ir,lr,cr,yr,wr,br,xr,Ir,Pr,Cr-Pr,hr),cr||(sr.r=hr&7|lr[hr/8|0]<<3,hr-=7,sr.h=mr,sr.p=_r,sr.i=Cr,sr.w=Rr)}else{for(var Cr=sr.w||0;Cr<ar+cr;Cr+=65535){var qi=Cr+65535;qi>=ar&&(lr[hr/8|0]=cr,qi=ar),hr=wfblk(lr,hr+1,ir.subarray(Cr,qi))}sr.i=ar}return slc(or,0,rr+shft(hr)+nr)},crct=function(){for(var ir=new Int32Array(256),er=0;er<256;++er){for(var tr=er,rr=9;--rr;)tr=(tr&1&&-306674912)^tr>>>1;ir[er]=tr}return ir}(),crc=function(){var ir=-1;return{p:function(er){for(var tr=ir,rr=0;rr<er.length;++rr)tr=crct[tr&255^er[rr]]^tr>>>8;ir=tr},d:function(){return~ir}}},adler=function(){var ir=1,er=0;return{p:function(tr){for(var rr=ir,nr=er,sr=tr.length|0,ar=0;ar!=sr;){for(var or=Math.min(ar+2655,sr);ar<or;++ar)nr+=rr+=tr[ar];rr=(rr&65535)+15*(rr>>16),nr=(nr&65535)+15*(nr>>16)}ir=rr,er=nr},d:function(){return ir%=65521,er%=65521,(ir&255)<<24|(ir&65280)<<8|(er&255)<<8|er>>8}}},dopt=function(ir,er,tr,rr,nr){if(!nr&&(nr={l:1},er.dictionary)){var sr=er.dictionary.subarray(-32768),ar=new u8(sr.length+ir.length);ar.set(sr),ar.set(ir,sr.length),ir=ar,nr.w=sr.length}return dflt(ir,er.level==null?6:er.level,er.mem==null?nr.l?Math.ceil(Math.max(8,Math.min(13,Math.log(ir.length)))*1.5):20:12+er.mem,tr,rr,nr)},mrg=function(ir,er){var tr={};for(var rr in ir)tr[rr]=ir[rr];for(var rr in er)tr[rr]=er[rr];return tr},wcln=function(ir,er,tr){for(var rr=ir(),nr=ir.toString(),sr=nr.slice(nr.indexOf("[")+1,nr.lastIndexOf("]")).replace(/\s+/g,"").split(","),ar=0;ar<rr.length;++ar){var or=rr[ar],lr=sr[ar];if(typeof or=="function"){er+=";"+lr+"=";var cr=or.toString();if(or.prototype)if(cr.indexOf("[native code]")!=-1){var hr=cr.indexOf(" ",8)+1;er+=cr.slice(hr,cr.indexOf("(",hr))}else{er+=cr;for(var fr in or.prototype)er+=";"+lr+".prototype."+fr+"="+or.prototype[fr].toString()}else er+=cr}else tr[lr]=or}return er},ch=[],cbfs=function(ir){var er=[];for(var tr in ir)ir[tr].buffer&&er.push((ir[tr]=new ir[tr].constructor(ir[tr])).buffer);return er},wrkr=function(ir,er,tr,rr){if(!ch[tr]){for(var nr="",sr={},ar=ir.length-1,or=0;or<ar;++or)nr=wcln(ir[or],nr,sr);ch[tr]={c:wcln(ir[ar],nr,sr),e:sr}}var lr=mrg({},ch[tr].e);return wk(ch[tr].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+er.toString()+"}",tr,lr,cbfs(lr),rr)},bInflt=function(){return[u8,u16,i32,fleb,fdeb,clim,fl,fd,flrm,fdrm,rev,ec,hMap,max,bits,bits16,shft,slc,err,inflt,inflateSync,pbf,gopt]},bDflt=function(){return[u8,u16,i32,fleb,fdeb,clim,revfl,revfd,flm,flt,fdm,fdt,rev,deo,et$2,hMap,wbits,wbits16,hTree,ln$1,lc,clen,wfblk,wblk,shft,slc,dflt,dopt,deflateSync,pbf]},gze=function(){return[gzh,gzhl,wbytes,crc,crct]},guze=function(){return[gzs,gzl]},zle=function(){return[zlh,wbytes,adler]},zule=function(){return[zls]},pbf=function(ir){return postMessage(ir,[ir.buffer])},gopt=function(ir){return ir&&{out:ir.size&&new u8(ir.size),dictionary:ir.dictionary}},cbify=function(ir,er,tr,rr,nr,sr){var ar=wrkr(tr,rr,nr,function(or,lr){ar.terminate(),sr(or,lr)});return ar.postMessage([ir,er],er.consume?[ir.buffer]:[]),function(){ar.terminate()}},astrm=function(ir){return ir.ondata=function(er,tr){return postMessage([er,tr],[er.buffer])},function(er){er.data.length?(ir.push(er.data[0],er.data[1]),postMessage([er.data[0].length])):ir.flush()}},astrmify=function(ir,er,tr,rr,nr,sr,ar){var or,lr=wrkr(ir,rr,nr,function(cr,hr){cr?(lr.terminate(),er.ondata.call(er,cr)):Array.isArray(hr)?hr.length==1?(er.queuedSize-=hr[0],er.ondrain&&er.ondrain(hr[0])):(hr[1]&&lr.terminate(),er.ondata.call(er,cr,hr[0],hr[1])):ar(hr)});lr.postMessage(tr),er.queuedSize=0,er.push=function(cr,hr){er.ondata||err(5),or&&er.ondata(err(4,0,1),null,!!hr),er.queuedSize+=cr.length,lr.postMessage([cr,or=hr],[cr.buffer])},er.terminate=function(){lr.terminate()},sr&&(er.flush=function(){lr.postMessage([])})},b2=function(ir,er){return ir[er]|ir[er+1]<<8},b4=function(ir,er){return(ir[er]|ir[er+1]<<8|ir[er+2]<<16|ir[er+3]<<24)>>>0},b8=function(ir,er){return b4(ir,er)+b4(ir,er+4)*4294967296},wbytes=function(ir,er,tr){for(;tr;++er)ir[er]=tr,tr>>>=8},gzh=function(ir,er){var tr=er.filename;if(ir[0]=31,ir[1]=139,ir[2]=8,ir[8]=er.level<2?4:er.level==9?2:0,ir[9]=3,er.mtime!=0&&wbytes(ir,4,Math.floor(new Date(er.mtime||Date.now())/1e3)),tr){ir[3]=8;for(var rr=0;rr<=tr.length;++rr)ir[rr+10]=tr.charCodeAt(rr)}},gzs=function(ir){(ir[0]!=31||ir[1]!=139||ir[2]!=8)&&err(6,"invalid gzip data");var er=ir[3],tr=10;er&4&&(tr+=(ir[10]|ir[11]<<8)+2);for(var rr=(er>>3&1)+(er>>4&1);rr>0;rr-=!ir[tr++]);return tr+(er&2)},gzl=function(ir){var er=ir.length;return(ir[er-4]|ir[er-3]<<8|ir[er-2]<<16|ir[er-1]<<24)>>>0},gzhl=function(ir){return 10+(ir.filename?ir.filename.length+1:0)},zlh=function(ir,er){var tr=er.level,rr=tr==0?0:tr<6?1:tr==9?3:2;if(ir[0]=120,ir[1]=rr<<6|(er.dictionary&&32),ir[1]|=31-(ir[0]<<8|ir[1])%31,er.dictionary){var nr=adler();nr.p(er.dictionary),wbytes(ir,2,nr.d())}},zls=function(ir,er){return((ir[0]&15)!=8||ir[0]>>4>7||(ir[0]<<8|ir[1])%31)&&err(6,"invalid zlib data"),(ir[1]>>5&1)==+!er&&err(6,"invalid zlib data: "+(ir[1]&32?"need":"unexpected")+" dictionary"),(ir[1]>>3&4)+2};function StrmOpt(ir,er){return typeof ir=="function"&&(er=ir,ir={}),this.ondata=er,ir}var Deflate=function(){function ir(er,tr){if(typeof er=="function"&&(tr=er,er={}),this.ondata=tr,this.o=er||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new u8(98304),this.o.dictionary){var rr=this.o.dictionary.subarray(-32768);this.b.set(rr,32768-rr.length),this.s.i=32768-rr.length}}return ir.prototype.p=function(er,tr){this.ondata(dopt(er,this.o,0,0,this.s),tr)},ir.prototype.push=function(er,tr){this.ondata||err(5),this.s.l&&err(4);var rr=er.length+this.s.z;if(rr>this.b.length){if(rr>2*this.b.length-32768){var nr=new u8(rr&-32768);nr.set(this.b.subarray(0,this.s.z)),this.b=nr}var sr=this.b.length-this.s.z;this.b.set(er.subarray(0,sr),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(er.subarray(sr),32768),this.s.z=er.length-sr+32768,this.s.i=32766,this.s.w=32768}else this.b.set(er,this.s.z),this.s.z+=er.length;this.s.l=tr&1,(this.s.z>this.s.w+8191||tr)&&(this.p(this.b,tr||!1),this.s.w=this.s.i,this.s.i-=2)},ir.prototype.flush=function(){this.ondata||err(5),this.s.l&&err(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},ir}(),AsyncDeflate=function(){function ir(er,tr){astrmify([bDflt,function(){return[astrm,Deflate]}],this,StrmOpt.call(this,er,tr),function(rr){var nr=new Deflate(rr.data);onmessage=astrm(nr)},6,1)}return ir}();function deflate(ir,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(ir,er,[bDflt],function(rr){return pbf(deflateSync(rr.data[0],rr.data[1]))},0,tr)}function deflateSync(ir,er){return dopt(ir,er||{},0,0)}var Inflate=function(){function ir(er,tr){typeof er=="function"&&(tr=er,er={}),this.ondata=tr;var rr=er&&er.dictionary&&er.dictionary.subarray(-32768);this.s={i:0,b:rr?rr.length:0},this.o=new u8(32768),this.p=new u8(0),rr&&this.o.set(rr)}return ir.prototype.e=function(er){if(this.ondata||err(5),this.d&&err(4),!this.p.length)this.p=er;else if(er.length){var tr=new u8(this.p.length+er.length);tr.set(this.p),tr.set(er,this.p.length),this.p=tr}},ir.prototype.c=function(er){this.s.i=+(this.d=er||!1);var tr=this.s.b,rr=inflt(this.p,this.s,this.o);this.ondata(slc(rr,tr,this.s.b),this.d),this.o=slc(rr,this.s.b-32768),this.s.b=this.o.length,this.p=slc(this.p,this.s.p/8|0),this.s.p&=7},ir.prototype.push=function(er,tr){this.e(er),this.c(tr)},ir}(),AsyncInflate=function(){function ir(er,tr){astrmify([bInflt,function(){return[astrm,Inflate]}],this,StrmOpt.call(this,er,tr),function(rr){var nr=new Inflate(rr.data);onmessage=astrm(nr)},7,0)}return ir}();function inflate(ir,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(ir,er,[bInflt],function(rr){return pbf(inflateSync(rr.data[0],gopt(rr.data[1])))},1,tr)}function inflateSync(ir,er){return inflt(ir,{i:2},er&&er.out,er&&er.dictionary)}var Gzip=function(){function ir(er,tr){this.c=crc(),this.l=0,this.v=1,Deflate.call(this,er,tr)}return ir.prototype.push=function(er,tr){this.c.p(er),this.l+=er.length,Deflate.prototype.push.call(this,er,tr)},ir.prototype.p=function(er,tr){var rr=dopt(er,this.o,this.v&&gzhl(this.o),tr&&8,this.s);this.v&&(gzh(rr,this.o),this.v=0),tr&&(wbytes(rr,rr.length-8,this.c.d()),wbytes(rr,rr.length-4,this.l)),this.ondata(rr,tr)},ir.prototype.flush=function(){Deflate.prototype.flush.call(this)},ir}(),AsyncGzip=function(){function ir(er,tr){astrmify([bDflt,gze,function(){return[astrm,Deflate,Gzip]}],this,StrmOpt.call(this,er,tr),function(rr){var nr=new Gzip(rr.data);onmessage=astrm(nr)},8,1)}return ir}();function gzip(ir,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(ir,er,[bDflt,gze,function(){return[gzipSync]}],function(rr){return pbf(gzipSync(rr.data[0],rr.data[1]))},2,tr)}function gzipSync(ir,er){er||(er={});var tr=crc(),rr=ir.length;tr.p(ir);var nr=dopt(ir,er,gzhl(er),8),sr=nr.length;return gzh(nr,er),wbytes(nr,sr-8,tr.d()),wbytes(nr,sr-4,rr),nr}var Gunzip=function(){function ir(er,tr){this.v=1,this.r=0,Inflate.call(this,er,tr)}return ir.prototype.push=function(er,tr){if(Inflate.prototype.e.call(this,er),this.r+=er.length,this.v){var rr=this.p.subarray(this.v-1),nr=rr.length>3?gzs(rr):4;if(nr>rr.length){if(!tr)return}else this.v>1&&this.onmember&&this.onmember(this.r-rr.length);this.p=rr.subarray(nr),this.v=0}Inflate.prototype.c.call(this,tr),this.s.f&&!this.s.l&&!tr&&(this.v=shft(this.s.p)+9,this.s={i:0},this.o=new u8(0),this.push(new u8(0),tr))},ir}(),AsyncGunzip=function(){function ir(er,tr){var rr=this;astrmify([bInflt,guze,function(){return[astrm,Inflate,Gunzip]}],this,StrmOpt.call(this,er,tr),function(nr){var sr=new Gunzip(nr.data);sr.onmember=function(ar){return postMessage(ar)},onmessage=astrm(sr)},9,0,function(nr){return rr.onmember&&rr.onmember(nr)})}return ir}();function gunzip(ir,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(ir,er,[bInflt,guze,function(){return[gunzipSync]}],function(rr){return pbf(gunzipSync(rr.data[0],rr.data[1]))},3,tr)}function gunzipSync(ir,er){var tr=gzs(ir);return tr+8>ir.length&&err(6,"invalid gzip data"),inflt(ir.subarray(tr,-8),{i:2},er&&er.out||new u8(gzl(ir)),er&&er.dictionary)}var Zlib=function(){function ir(er,tr){this.c=adler(),this.v=1,Deflate.call(this,er,tr)}return ir.prototype.push=function(er,tr){this.c.p(er),Deflate.prototype.push.call(this,er,tr)},ir.prototype.p=function(er,tr){var rr=dopt(er,this.o,this.v&&(this.o.dictionary?6:2),tr&&4,this.s);this.v&&(zlh(rr,this.o),this.v=0),tr&&wbytes(rr,rr.length-4,this.c.d()),this.ondata(rr,tr)},ir.prototype.flush=function(){Deflate.prototype.flush.call(this)},ir}(),AsyncZlib=function(){function ir(er,tr){astrmify([bDflt,zle,function(){return[astrm,Deflate,Zlib]}],this,StrmOpt.call(this,er,tr),function(rr){var nr=new Zlib(rr.data);onmessage=astrm(nr)},10,1)}return ir}();function zlib(ir,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(ir,er,[bDflt,zle,function(){return[zlibSync]}],function(rr){return pbf(zlibSync(rr.data[0],rr.data[1]))},4,tr)}function zlibSync(ir,er){er||(er={});var tr=adler();tr.p(ir);var rr=dopt(ir,er,er.dictionary?6:2,4);return zlh(rr,er),wbytes(rr,rr.length-4,tr.d()),rr}var Unzlib=function(){function ir(er,tr){Inflate.call(this,er,tr),this.v=er&&er.dictionary?2:1}return ir.prototype.push=function(er,tr){if(Inflate.prototype.e.call(this,er),this.v){if(this.p.length<6&&!tr)return;this.p=this.p.subarray(zls(this.p,this.v-1)),this.v=0}tr&&(this.p.length<4&&err(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),Inflate.prototype.c.call(this,tr)},ir}(),AsyncUnzlib=function(){function ir(er,tr){astrmify([bInflt,zule,function(){return[astrm,Inflate,Unzlib]}],this,StrmOpt.call(this,er,tr),function(rr){var nr=new Unzlib(rr.data);onmessage=astrm(nr)},11,0)}return ir}();function unzlib(ir,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(ir,er,[bInflt,zule,function(){return[unzlibSync]}],function(rr){return pbf(unzlibSync(rr.data[0],gopt(rr.data[1])))},5,tr)}function unzlibSync(ir,er){return inflt(ir.subarray(zls(ir,er&&er.dictionary),-4),{i:2},er&&er.out,er&&er.dictionary)}var Decompress=function(){function ir(er,tr){this.o=StrmOpt.call(this,er,tr)||{},this.G=Gunzip,this.I=Inflate,this.Z=Unzlib}return ir.prototype.i=function(){var er=this;this.s.ondata=function(tr,rr){er.ondata(tr,rr)}},ir.prototype.push=function(er,tr){if(this.ondata||err(5),this.s)this.s.push(er,tr);else{if(this.p&&this.p.length){var rr=new u8(this.p.length+er.length);rr.set(this.p),rr.set(er,this.p.length)}else this.p=er;this.p.length>2&&(this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(this.o):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(this.o):new this.Z(this.o),this.i(),this.s.push(this.p,tr),this.p=null)}},ir}(),AsyncDecompress=function(){function ir(er,tr){Decompress.call(this,er,tr),this.queuedSize=0,this.G=AsyncGunzip,this.I=AsyncInflate,this.Z=AsyncUnzlib}return ir.prototype.i=function(){var er=this;this.s.ondata=function(tr,rr,nr){er.ondata(tr,rr,nr)},this.s.ondrain=function(tr){er.queuedSize-=tr,er.ondrain&&er.ondrain(tr)}},ir.prototype.push=function(er,tr){this.queuedSize+=er.length,Decompress.prototype.push.call(this,er,tr)},ir}();function decompress$1(ir,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),ir[0]==31&&ir[1]==139&&ir[2]==8?gunzip(ir,er,tr):(ir[0]&15)!=8||ir[0]>>4>7||(ir[0]<<8|ir[1])%31?inflate(ir,er,tr):unzlib(ir,er,tr)}function decompressSync(ir,er){return ir[0]==31&&ir[1]==139&&ir[2]==8?gunzipSync(ir,er):(ir[0]&15)!=8||ir[0]>>4>7||(ir[0]<<8|ir[1])%31?inflateSync(ir,er):unzlibSync(ir,er)}var fltn=function(ir,er,tr,rr){for(var nr in ir){var sr=ir[nr],ar=er+nr,or=rr;Array.isArray(sr)&&(or=mrg(rr,sr[1]),sr=sr[0]),sr instanceof u8?tr[ar]=[sr,or]:(tr[ar+="/"]=[new u8(0),or],fltn(sr,ar,tr,rr))}},te$1=typeof TextEncoder<"u"&&new TextEncoder,td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et$2,{stream:!0}),tds=1}catch{}var dutf8=function(ir){for(var er="",tr=0;;){var rr=ir[tr++],nr=(rr>127)+(rr>223)+(rr>239);if(tr+nr>ir.length)return{s:er,r:slc(ir,tr-1)};nr?nr==3?(rr=((rr&15)<<18|(ir[tr++]&63)<<12|(ir[tr++]&63)<<6|ir[tr++]&63)-65536,er+=String.fromCharCode(55296|rr>>10,56320|rr&1023)):nr&1?er+=String.fromCharCode((rr&31)<<6|ir[tr++]&63):er+=String.fromCharCode((rr&15)<<12|(ir[tr++]&63)<<6|ir[tr++]&63):er+=String.fromCharCode(rr)}},DecodeUTF8=function(){function ir(er){this.ondata=er,tds?this.t=new TextDecoder:this.p=et$2}return ir.prototype.push=function(er,tr){if(this.ondata||err(5),tr=!!tr,this.t){this.ondata(this.t.decode(er,{stream:!0}),tr),tr&&(this.t.decode().length&&err(8),this.t=null);return}this.p||err(4);var rr=new u8(this.p.length+er.length);rr.set(this.p),rr.set(er,this.p.length);var nr=dutf8(rr),sr=nr.s,ar=nr.r;tr?(ar.length&&err(8),this.p=null):this.p=ar,this.ondata(sr,tr)},ir}(),EncodeUTF8=function(){function ir(er){this.ondata=er}return ir.prototype.push=function(er,tr){this.ondata||err(5),this.d&&err(4),this.ondata(strToU8(er),this.d=tr||!1)},ir}();function strToU8(ir,er){if(er){for(var tr=new u8(ir.length),rr=0;rr<ir.length;++rr)tr[rr]=ir.charCodeAt(rr);return tr}if(te$1)return te$1.encode(ir);for(var nr=ir.length,sr=new u8(ir.length+(ir.length>>1)),ar=0,or=function(hr){sr[ar++]=hr},rr=0;rr<nr;++rr){if(ar+5>sr.length){var lr=new u8(ar+8+(nr-rr<<1));lr.set(sr),sr=lr}var cr=ir.charCodeAt(rr);cr<128||er?or(cr):cr<2048?(or(192|cr>>6),or(128|cr&63)):cr>55295&&cr<57344?(cr=65536+(cr&1047552)|ir.charCodeAt(++rr)&1023,or(240|cr>>18),or(128|cr>>12&63),or(128|cr>>6&63),or(128|cr&63)):(or(224|cr>>12),or(128|cr>>6&63),or(128|cr&63))}return slc(sr,0,ar)}function strFromU8(ir,er){if(er){for(var tr="",rr=0;rr<ir.length;rr+=16384)tr+=String.fromCharCode.apply(null,ir.subarray(rr,rr+16384));return tr}else{if(td)return td.decode(ir);var nr=dutf8(ir),sr=nr.s,tr=nr.r;return tr.length&&err(8),sr}}var dbf=function(ir){return ir==1?3:ir<6?2:ir==9?1:0},slzh=function(ir,er){return er+30+b2(ir,er+26)+b2(ir,er+28)},zh=function(ir,er,tr){var rr=b2(ir,er+28),nr=strFromU8(ir.subarray(er+46,er+46+rr),!(b2(ir,er+8)&2048)),sr=er+46+rr,ar=b4(ir,er+20),or=tr&&ar==4294967295?z64e(ir,sr):[ar,b4(ir,er+24),b4(ir,er+42)],lr=or[0],cr=or[1],hr=or[2];return[b2(ir,er+10),lr,cr,nr,sr+b2(ir,er+30)+b2(ir,er+32),hr]},z64e=function(ir,er){for(;b2(ir,er)!=1;er+=4+b2(ir,er+2));return[b8(ir,er+12),b8(ir,er+4),b8(ir,er+20)]},exfl=function(ir){var er=0;if(ir)for(var tr in ir){var rr=ir[tr].length;rr>65535&&err(9),er+=rr+4}return er},wzh=function(ir,er,tr,rr,nr,sr,ar,or){var lr=rr.length,cr=tr.extra,hr=or&&or.length,fr=exfl(cr);wbytes(ir,er,ar!=null?33639248:67324752),er+=4,ar!=null&&(ir[er++]=20,ir[er++]=tr.os),ir[er]=20,er+=2,ir[er++]=tr.flag<<1|(sr<0&&8),ir[er++]=nr&&8,ir[er++]=tr.compression&255,ir[er++]=tr.compression>>8;var ur=new Date(tr.mtime==null?Date.now():tr.mtime),pr=ur.getFullYear()-1980;if((pr<0||pr>119)&&err(10),wbytes(ir,er,pr<<25|ur.getMonth()+1<<21|ur.getDate()<<16|ur.getHours()<<11|ur.getMinutes()<<5|ur.getSeconds()>>1),er+=4,sr!=-1&&(wbytes(ir,er,tr.crc),wbytes(ir,er+4,sr<0?-sr-2:sr),wbytes(ir,er+8,tr.size)),wbytes(ir,er+12,lr),wbytes(ir,er+14,fr),er+=16,ar!=null&&(wbytes(ir,er,hr),wbytes(ir,er+6,tr.attrs),wbytes(ir,er+10,ar),er+=14),ir.set(rr,er),er+=lr,fr)for(var gr in cr){var _r=cr[gr],mr=_r.length;wbytes(ir,er,+gr),wbytes(ir,er+2,mr),ir.set(_r,er+4),er+=4+mr}return hr&&(ir.set(or,er),er+=hr),er},wzf=function(ir,er,tr,rr,nr){wbytes(ir,er,101010256),wbytes(ir,er+8,tr),wbytes(ir,er+10,tr),wbytes(ir,er+12,rr),wbytes(ir,er+16,nr)},ZipPassThrough=function(){function ir(er){this.filename=er,this.c=crc(),this.size=0,this.compression=0}return ir.prototype.process=function(er,tr){this.ondata(null,er,tr)},ir.prototype.push=function(er,tr){this.ondata||err(5),this.c.p(er),this.size+=er.length,tr&&(this.crc=this.c.d()),this.process(er,tr||!1)},ir}(),ZipDeflate=function(){function ir(er,tr){var rr=this;tr||(tr={}),ZipPassThrough.call(this,er),this.d=new Deflate(tr,function(nr,sr){rr.ondata(null,nr,sr)}),this.compression=8,this.flag=dbf(tr.level)}return ir.prototype.process=function(er,tr){try{this.d.push(er,tr)}catch(rr){this.ondata(rr,null,tr)}},ir.prototype.push=function(er,tr){ZipPassThrough.prototype.push.call(this,er,tr)},ir}(),AsyncZipDeflate=function(){function ir(er,tr){var rr=this;tr||(tr={}),ZipPassThrough.call(this,er),this.d=new AsyncDeflate(tr,function(nr,sr,ar){rr.ondata(nr,sr,ar)}),this.compression=8,this.flag=dbf(tr.level),this.terminate=this.d.terminate}return ir.prototype.process=function(er,tr){this.d.push(er,tr)},ir.prototype.push=function(er,tr){ZipPassThrough.prototype.push.call(this,er,tr)},ir}(),Zip=function(){function ir(er){this.ondata=er,this.u=[],this.d=1}return ir.prototype.add=function(er){var tr=this;if(this.ondata||err(5),this.d&2)this.ondata(err(4+(this.d&1)*8,0,1),null,!1);else{var rr=strToU8(er.filename),nr=rr.length,sr=er.comment,ar=sr&&strToU8(sr),or=nr!=er.filename.length||ar&&sr.length!=ar.length,lr=nr+exfl(er.extra)+30;nr>65535&&this.ondata(err(11,0,1),null,!1);var cr=new u8(lr);wzh(cr,0,er,rr,or,-1);var hr=[cr],fr=function(){for(var mr=0,dr=hr;mr<dr.length;mr++){var vr=dr[mr];tr.ondata(null,vr,!1)}hr=[]},ur=this.d;this.d=0;var pr=this.u.length,gr=mrg(er,{f:rr,u:or,o:ar,t:function(){er.terminate&&er.terminate()},r:function(){if(fr(),ur){var mr=tr.u[pr+1];mr?mr.r():tr.d=1}ur=1}}),_r=0;er.ondata=function(mr,dr,vr){if(mr)tr.ondata(mr,dr,vr),tr.terminate();else if(_r+=dr.length,hr.push(dr),vr){var Ar=new u8(16);wbytes(Ar,0,134695760),wbytes(Ar,4,er.crc),wbytes(Ar,8,_r),wbytes(Ar,12,er.size),hr.push(Ar),gr.c=_r,gr.b=lr+_r+16,gr.crc=er.crc,gr.size=er.size,ur&&gr.r(),ur=1}else ur&&fr()},this.u.push(gr)}},ir.prototype.end=function(){var er=this;if(this.d&2){this.ondata(err(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){er.d&1&&(er.u.splice(-1,1),er.e())},t:function(){}}),this.d=3},ir.prototype.e=function(){for(var er=0,tr=0,rr=0,nr=0,sr=this.u;nr<sr.length;nr++){var ar=sr[nr];rr+=46+ar.f.length+exfl(ar.extra)+(ar.o?ar.o.length:0)}for(var or=new u8(rr+22),lr=0,cr=this.u;lr<cr.length;lr++){var ar=cr[lr];wzh(or,er,ar,ar.f,ar.u,-ar.c-2,tr,ar.o),er+=46+ar.f.length+exfl(ar.extra)+(ar.o?ar.o.length:0),tr+=ar.b}wzf(or,er,this.u.length,rr,tr),this.ondata(null,or,!0),this.d=2},ir.prototype.terminate=function(){for(var er=0,tr=this.u;er<tr.length;er++){var rr=tr[er];rr.t()}this.d=2},ir}();function zip(ir,er,tr){tr||(tr=er,er={}),typeof tr!="function"&&err(7);var rr={};fltn(ir,"",rr,er);var nr=Object.keys(rr),sr=nr.length,ar=0,or=0,lr=sr,cr=new Array(sr),hr=[],fr=function(){for(var mr=0;mr<hr.length;++mr)hr[mr]()},ur=function(mr,dr){mt$2(function(){tr(mr,dr)})};mt$2(function(){ur=tr});var pr=function(){var mr=new u8(or+22),dr=ar,vr=or-ar;or=0;for(var Ar=0;Ar<lr;++Ar){var yr=cr[Ar];try{var wr=yr.c.length;wzh(mr,or,yr,yr.f,yr.u,wr);var br=30+yr.f.length+exfl(yr.extra),Sr=or+br;mr.set(yr.c,Sr),wzh(mr,ar,yr,yr.f,yr.u,wr,or,yr.m),ar+=16+br+(yr.m?yr.m.length:0),or=Sr+wr}catch(xr){return ur(xr,null)}}wzf(mr,ar,cr.length,vr,dr),ur(null,mr)};sr||pr();for(var gr=function(mr){var dr=nr[mr],vr=rr[dr],Ar=vr[0],yr=vr[1],wr=crc(),br=Ar.length;wr.p(Ar);var Sr=strToU8(dr),xr=Sr.length,Cr=yr.comment,Ir=Cr&&strToU8(Cr),Rr=Ir&&Ir.length,Pr=exfl(yr.extra),Fr=yr.level==0?0:8,Nr=function(Ur,Br){if(Ur)fr(),ur(Ur,null);else{var Or=Br.length;cr[mr]=mrg(yr,{size:br,crc:wr.d(),c:Br,f:Sr,m:Ir,u:xr!=dr.length||Ir&&Cr.length!=Rr,compression:Fr}),ar+=30+xr+Pr+Or,or+=76+2*(xr+Pr)+(Rr||0)+Or,--sr||pr()}};if(xr>65535&&Nr(err(11,0,1),null),!Fr)Nr(null,Ar);else if(br<16e4)try{Nr(null,deflateSync(Ar,yr))}catch(Ur){Nr(Ur,null)}else hr.push(deflate(Ar,yr,Nr))},_r=0;_r<lr;++_r)gr(_r);return fr}function zipSync(ir,er){er||(er={});var tr={},rr=[];fltn(ir,"",tr,er);var nr=0,sr=0;for(var ar in tr){var or=tr[ar],lr=or[0],cr=or[1],hr=cr.level==0?0:8,fr=strToU8(ar),ur=fr.length,pr=cr.comment,gr=pr&&strToU8(pr),_r=gr&&gr.length,mr=exfl(cr.extra);ur>65535&&err(11);var dr=hr?deflateSync(lr,cr):lr,vr=dr.length,Ar=crc();Ar.p(lr),rr.push(mrg(cr,{size:lr.length,crc:Ar.d(),c:dr,f:fr,m:gr,u:ur!=ar.length||gr&&pr.length!=_r,o:nr,compression:hr})),nr+=30+ur+mr+vr,sr+=76+2*(ur+mr)+(_r||0)+vr}for(var yr=new u8(sr+22),wr=nr,br=sr-nr,Sr=0;Sr<rr.length;++Sr){var fr=rr[Sr];wzh(yr,fr.o,fr,fr.f,fr.u,fr.c.length);var xr=30+fr.f.length+exfl(fr.extra);yr.set(fr.c,fr.o+xr),wzh(yr,nr,fr,fr.f,fr.u,fr.c.length,fr.o,fr.m),nr+=16+xr+(fr.m?fr.m.length:0)}return wzf(yr,nr,rr.length,br,wr),yr}var UnzipPassThrough=function(){function ir(){}return ir.prototype.push=function(er,tr){this.ondata(null,er,tr)},ir.compression=0,ir}(),UnzipInflate=function(){function ir(){var er=this;this.i=new Inflate(function(tr,rr){er.ondata(null,tr,rr)})}return ir.prototype.push=function(er,tr){try{this.i.push(er,tr)}catch(rr){this.ondata(rr,null,tr)}},ir.compression=8,ir}(),AsyncUnzipInflate=function(){function ir(er,tr){var rr=this;tr<32e4?this.i=new Inflate(function(nr,sr){rr.ondata(null,nr,sr)}):(this.i=new AsyncInflate(function(nr,sr,ar){rr.ondata(nr,sr,ar)}),this.terminate=this.i.terminate)}return ir.prototype.push=function(er,tr){this.i.terminate&&(er=slc(er,0)),this.i.push(er,tr)},ir.compression=8,ir}(),Unzip=function(){function ir(er){this.onfile=er,this.k=[],this.o={0:UnzipPassThrough},this.p=et$2}return ir.prototype.push=function(er,tr){var rr=this;if(this.onfile||err(5),this.p||err(4),this.c>0){var nr=Math.min(this.c,er.length),sr=er.subarray(0,nr);if(this.c-=nr,this.d?this.d.push(sr,!this.c):this.k[0].push(sr),er=er.subarray(nr),er.length)return this.push(er,tr)}else{var ar=0,or=0,lr=void 0,cr=void 0;this.p.length?er.length?(cr=new u8(this.p.length+er.length),cr.set(this.p),cr.set(er,this.p.length)):cr=this.p:cr=er;for(var hr=cr.length,fr=this.c,ur=fr&&this.d,pr=function(){var dr,vr=b4(cr,or);if(vr==67324752){ar=1,lr=or,gr.d=null,gr.c=0;var Ar=b2(cr,or+6),yr=b2(cr,or+8),wr=Ar&2048,br=Ar&8,Sr=b2(cr,or+26),xr=b2(cr,or+28);if(hr>or+30+Sr+xr){var Cr=[];gr.k.unshift(Cr),ar=2;var Ir=b4(cr,or+18),Rr=b4(cr,or+22),Pr=strFromU8(cr.subarray(or+30,or+=30+Sr),!wr);Ir==4294967295?(dr=br?[-2]:z64e(cr,or),Ir=dr[0],Rr=dr[1]):br&&(Ir=-1),or+=xr,gr.c=Ir;var Fr,Nr={name:Pr,compression:yr,start:function(){if(Nr.ondata||err(5),!Ir)Nr.ondata(null,et$2,!0);else{var Ur=rr.o[yr];Ur||Nr.ondata(err(14,"unknown compression type "+yr,1),null,!1),Fr=Ir<0?new Ur(Pr):new Ur(Pr,Ir,Rr),Fr.ondata=function(Wr,$r,Yr){Nr.ondata(Wr,$r,Yr)};for(var Br=0,Or=Cr;Br<Or.length;Br++){var Dr=Or[Br];Fr.push(Dr,!1)}rr.k[0]==Cr&&rr.c?rr.d=Fr:Fr.push(et$2,!0)}},terminate:function(){Fr&&Fr.terminate&&Fr.terminate()}};Ir>=0&&(Nr.size=Ir,Nr.originalSize=Rr),gr.onfile(Nr)}return"break"}else if(fr){if(vr==134695760)return lr=or+=12+(fr==-2&&8),ar=3,gr.c=0,"break";if(vr==33639248)return lr=or-=4,ar=3,gr.c=0,"break"}},gr=this;or<hr-4;++or){var _r=pr();if(_r==="break")break}if(this.p=et$2,fr<0){var mr=ar?cr.subarray(0,lr-12-(fr==-2&&8)-(b4(cr,lr-16)==134695760&&4)):cr.subarray(0,or);ur?ur.push(mr,!!ar):this.k[+(ar==2)].push(mr)}if(ar&2)return this.push(cr.subarray(or),tr);this.p=cr.subarray(or)}tr&&(this.c&&err(13),this.p=null)},ir.prototype.register=function(er){this.o[er.compression]=er},ir}(),mt$2=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(ir){ir()};function unzip(ir,er,tr){tr||(tr=er,er={}),typeof tr!="function"&&err(7);var rr=[],nr=function(){for(var mr=0;mr<rr.length;++mr)rr[mr]()},sr={},ar=function(mr,dr){mt$2(function(){tr(mr,dr)})};mt$2(function(){ar=tr});for(var or=ir.length-22;b4(ir,or)!=101010256;--or)if(!or||ir.length-or>65558)return ar(err(13,0,1),null),nr;var lr=b2(ir,or+8);if(lr){var cr=lr,hr=b4(ir,or+16),fr=hr==4294967295||cr==65535;if(fr){var ur=b4(ir,or-12);fr=b4(ir,ur)==101075792,fr&&(cr=lr=b4(ir,ur+32),hr=b4(ir,ur+48))}for(var pr=er&&er.filter,gr=function(mr){var dr=zh(ir,hr,fr),vr=dr[0],Ar=dr[1],yr=dr[2],wr=dr[3],br=dr[4],Sr=dr[5],xr=slzh(ir,Sr);hr=br;var Cr=function(Rr,Pr){Rr?(nr(),ar(Rr,null)):(Pr&&(sr[wr]=Pr),--lr||ar(null,sr))};if(!pr||pr({name:wr,size:Ar,originalSize:yr,compression:vr}))if(!vr)Cr(null,slc(ir,xr,xr+Ar));else if(vr==8){var Ir=ir.subarray(xr,xr+Ar);if(yr<524288||Ar>.8*yr)try{Cr(null,inflateSync(Ir,{out:new u8(yr)}))}catch(Rr){Cr(Rr,null)}else rr.push(inflate(Ir,{size:yr},Cr))}else Cr(err(14,"unknown compression type "+vr,1),null);else Cr(null,null)},_r=0;_r<cr;++_r)gr(_r)}else ar(null,{});return nr}function unzipSync(ir,er){for(var tr={},rr=ir.length-22;b4(ir,rr)!=101010256;--rr)(!rr||ir.length-rr>65558)&&err(13);var nr=b2(ir,rr+8);if(!nr)return{};var sr=b4(ir,rr+16),ar=sr==4294967295||nr==65535;if(ar){var or=b4(ir,rr-12);ar=b4(ir,or)==101075792,ar&&(nr=b4(ir,or+32),sr=b4(ir,or+48))}for(var lr=er&&er.filter,cr=0;cr<nr;++cr){var hr=zh(ir,sr,ar),fr=hr[0],ur=hr[1],pr=hr[2],gr=hr[3],_r=hr[4],mr=hr[5],dr=slzh(ir,mr);sr=_r,(!lr||lr({name:gr,size:ur,originalSize:pr,compression:fr}))&&(fr?fr==8?tr[gr]=inflateSync(ir.subarray(dr,dr+ur),{out:new u8(pr)}):err(14,"unknown compression type "+fr):tr[gr]=slc(ir,dr,dr+ur))}return tr}const textEncoder=new TextEncoder,NO_COMPRESSION=0,ZIPS_COMPRESSION=2,ZIP_COMPRESSION=3;class EXRExporter{async parse(er,tr,rr){if(!er||!(er.isWebGLRenderer||er.isWebGPURenderer||er.isDataTexture))throw Error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer or DataTexture.");if(er.isWebGLRenderer||er.isWebGPURenderer){const nr=er,sr=tr,ar=rr;supportedRTT(sr);const or=buildInfoRTT(sr,ar),lr=await getPixelData(nr,sr,or),cr=reorganizeDataBuffer(lr,or),hr=compressData(cr,or);return fillData(hr,or)}else if(er.isDataTexture){const nr=er,sr=tr;supportedDT(nr);const ar=buildInfoDT(nr,sr),or=nr.image.data,lr=reorganizeDataBuffer(or,ar),cr=compressData(lr,ar);return fillData(cr,ar)}}}function supportedRTT(ir){if(!ir||!ir.isRenderTarget)throw Error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget.");if(ir.isWebGLCubeRenderTarget||ir.isWebGL3DRenderTarget||ir.isWebGLArrayRenderTarget)throw Error("EXRExporter.parse: Unsupported render target type, expected instance of WebGLRenderTarget.");if(ir.texture.type!==FloatType&&ir.texture.type!==HalfFloatType)throw Error("EXRExporter.parse: Unsupported WebGLRenderTarget texture type.");if(ir.texture.format!==RGBAFormat)throw Error("EXRExporter.parse: Unsupported WebGLRenderTarget texture format, expected RGBAFormat.")}function supportedDT(ir){if(ir.type!==FloatType&&ir.type!==HalfFloatType)throw Error("EXRExporter.parse: Unsupported DataTexture texture type.");if(ir.format!==RGBAFormat)throw Error("EXRExporter.parse: Unsupported DataTexture texture format, expected RGBAFormat.");if(!ir.image.data)throw Error("EXRExporter.parse: Invalid DataTexture image data.");if(ir.type===FloatType&&ir.image.data.constructor.name!=="Float32Array")throw Error("EXRExporter.parse: DataTexture image data doesn't match type, expected 'Float32Array'.");if(ir.type===HalfFloatType&&ir.image.data.constructor.name!=="Uint16Array")throw Error("EXRExporter.parse: DataTexture image data doesn't match type, expected 'Uint16Array'.")}function buildInfoRTT(ir,er={}){const tr={0:1,2:1,3:16},rr=ir.width,nr=ir.height,sr=ir.texture.type,ar=ir.texture.format,or=er.compression!==void 0?er.compression:ZIP_COMPRESSION,lr=er.type!==void 0?er.type:HalfFloatType,cr=lr===FloatType?2:1,hr=tr[or];return{width:rr,height:nr,type:sr,format:ar,compression:or,blockLines:hr,dataType:cr,dataSize:2*cr,numBlocks:Math.ceil(nr/hr),numInputChannels:4,numOutputChannels:4}}function buildInfoDT(ir,er={}){const tr={0:1,2:1,3:16},rr=ir.image.width,nr=ir.image.height,sr=ir.type,ar=ir.format,or=er.compression!==void 0?er.compression:ZIP_COMPRESSION,lr=er.type!==void 0?er.type:HalfFloatType,cr=lr===FloatType?2:1,hr=tr[or];return{width:rr,height:nr,type:sr,format:ar,compression:or,blockLines:hr,dataType:cr,dataSize:2*cr,numBlocks:Math.ceil(nr/hr),numInputChannels:4,numOutputChannels:4}}async function getPixelData(ir,er,tr){let rr;return ir.isWebGLRenderer?(tr.type===FloatType?rr=new Float32Array(tr.width*tr.height*tr.numInputChannels):rr=new Uint16Array(tr.width*tr.height*tr.numInputChannels),await ir.readRenderTargetPixelsAsync(er,0,0,tr.width,tr.height,rr)):rr=await ir.readRenderTargetPixelsAsync(er,0,0,tr.width,tr.height),rr}function reorganizeDataBuffer(ir,er){const tr=er.width,rr=er.height,nr={r:0,g:0,b:0,a:0},sr={value:0},ar=er.numOutputChannels==4?1:0,or=er.type==FloatType?getFloat32:getFloat16,lr=er.dataType==1?setFloat16:setFloat32,cr=new Uint8Array(er.width*er.height*er.numOutputChannels*er.dataSize),hr=new DataView(cr.buffer);for(let fr=0;fr<rr;++fr)for(let ur=0;ur<tr;++ur){const pr=fr*tr*4+ur*4,gr=or(ir,pr),_r=or(ir,pr+1),mr=or(ir,pr+2),dr=or(ir,pr+3),vr=(rr-fr-1)*tr*(3+ar)*er.dataSize;decodeLinear(nr,gr,_r,mr,dr),sr.value=vr+ur*er.dataSize,lr(hr,nr.a,sr),sr.value=vr+ar*tr*er.dataSize+ur*er.dataSize,lr(hr,nr.b,sr),sr.value=vr+(1+ar)*tr*er.dataSize+ur*er.dataSize,lr(hr,nr.g,sr),sr.value=vr+(2+ar)*tr*er.dataSize+ur*er.dataSize,lr(hr,nr.r,sr)}return cr}function compressData(ir,er){let tr,rr,nr=0;const sr={data:new Array,totalSize:0},ar=er.width*er.numOutputChannels*er.blockLines*er.dataSize;switch(er.compression){case 0:tr=compressNONE;break;case 2:case 3:tr=compressZIP;break}er.compression!==0&&(rr=new Uint8Array(ar));for(let or=0;or<er.numBlocks;++or){const lr=ir.subarray(ar*or,ar*(or+1)),cr=tr(lr,rr);nr+=cr.length,sr.data.push({dataChunk:cr,size:cr.length})}return sr.totalSize=nr,sr}function compressNONE(ir){return ir}function compressZIP(ir,er){let tr=0,rr=Math.floor((ir.length+1)/2),nr=0;const sr=ir.length-1;for(;!(nr>sr||(er[tr++]=ir[nr++],nr>sr));)er[rr++]=ir[nr++];let ar=er[0];for(let lr=1;lr<er.length;lr++){const cr=er[lr]-ar+384;ar=er[lr],er[lr]=cr}return zlibSync(er)}function fillHeader(ir,er,tr){const rr={value:0},nr=new DataView(ir.buffer);setUint32(nr,20000630,rr),setUint32(nr,2,rr),setString(nr,"compression",rr),setString(nr,"compression",rr),setUint32(nr,1,rr),setUint8(nr,tr.compression,rr),setString(nr,"screenWindowCenter",rr),setString(nr,"v2f",rr),setUint32(nr,8,rr),setUint32(nr,0,rr),setUint32(nr,0,rr),setString(nr,"screenWindowWidth",rr),setString(nr,"float",rr),setUint32(nr,4,rr),setFloat32(nr,1,rr),setString(nr,"pixelAspectRatio",rr),setString(nr,"float",rr),setUint32(nr,4,rr),setFloat32(nr,1,rr),setString(nr,"lineOrder",rr),setString(nr,"lineOrder",rr),setUint32(nr,1,rr),setUint8(nr,0,rr),setString(nr,"dataWindow",rr),setString(nr,"box2i",rr),setUint32(nr,16,rr),setUint32(nr,0,rr),setUint32(nr,0,rr),setUint32(nr,tr.width-1,rr),setUint32(nr,tr.height-1,rr),setString(nr,"displayWindow",rr),setString(nr,"box2i",rr),setUint32(nr,16,rr),setUint32(nr,0,rr),setUint32(nr,0,rr),setUint32(nr,tr.width-1,rr),setUint32(nr,tr.height-1,rr),setString(nr,"channels",rr),setString(nr,"chlist",rr),setUint32(nr,tr.numOutputChannels*18+1,rr),setString(nr,"A",rr),setUint32(nr,tr.dataType,rr),rr.value+=4,setUint32(nr,1,rr),setUint32(nr,1,rr),setString(nr,"B",rr),setUint32(nr,tr.dataType,rr),rr.value+=4,setUint32(nr,1,rr),setUint32(nr,1,rr),setString(nr,"G",rr),setUint32(nr,tr.dataType,rr),rr.value+=4,setUint32(nr,1,rr),setUint32(nr,1,rr),setString(nr,"R",rr),setUint32(nr,tr.dataType,rr),rr.value+=4,setUint32(nr,1,rr),setUint32(nr,1,rr),setUint8(nr,0,rr),setUint8(nr,0,rr);let sr=rr.value+tr.numBlocks*8;for(let ar=0;ar<er.data.length;++ar)setUint64(nr,sr,rr),sr+=er.data[ar].size+8}function fillData(ir,er){const tr=er.numBlocks*8,rr=259+18*er.numOutputChannels,nr={value:rr+tr},sr=new Uint8Array(rr+tr+ir.totalSize+er.numBlocks*8),ar=new DataView(sr.buffer);fillHeader(sr,ir,er);for(let or=0;or<ir.data.length;++or){const lr=ir.data[or].dataChunk,cr=ir.data[or].size;setUint32(ar,or*er.blockLines,nr),setUint32(ar,cr,nr),sr.set(lr,nr.value),nr.value+=cr}return sr}function decodeLinear(ir,er,tr,rr,nr){ir.r=er,ir.g=tr,ir.b=rr,ir.a=nr}function setUint8(ir,er,tr){ir.setUint8(tr.value,er),tr.value+=1}function setUint32(ir,er,tr){ir.setUint32(tr.value,er,!0),tr.value+=4}function setFloat16(ir,er,tr){ir.setUint16(tr.value,DataUtils.toHalfFloat(er),!0),tr.value+=2}function setFloat32(ir,er,tr){ir.setFloat32(tr.value,er,!0),tr.value+=4}function setUint64(ir,er,tr){ir.setBigUint64(tr.value,BigInt(er),!0),tr.value+=8}function setString(ir,er,tr){const rr=textEncoder.encode(er+"\0");for(let nr=0;nr<rr.length;++nr)setUint8(ir,rr[nr],tr)}function decodeFloat16(ir){const er=(ir&31744)>>10,tr=ir&1023;return(ir>>15?-1:1)*(er?er===31?tr?NaN:1/0:Math.pow(2,er-15)*(1+tr/1024):6103515625e-14*(tr/1024))}function getFloat16(ir,er){return decodeFloat16(ir[er])}function getFloat32(ir,er){return ir[er]}const KHR_mesh_quantization_ExtraAttrTypes={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class GLTFExporter{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register(function(er){return new GLTFLightExtension(er)}),this.register(function(er){return new GLTFMaterialsUnlitExtension$1(er)}),this.register(function(er){return new GLTFMaterialsTransmissionExtension$1(er)}),this.register(function(er){return new GLTFMaterialsVolumeExtension$1(er)}),this.register(function(er){return new GLTFMaterialsIorExtension$1(er)}),this.register(function(er){return new GLTFMaterialsSpecularExtension$1(er)}),this.register(function(er){return new GLTFMaterialsClearcoatExtension$1(er)}),this.register(function(er){return new GLTFMaterialsDispersionExtension$1(er)}),this.register(function(er){return new GLTFMaterialsIridescenceExtension$1(er)}),this.register(function(er){return new GLTFMaterialsSheenExtension$1(er)}),this.register(function(er){return new GLTFMaterialsAnisotropyExtension$1(er)}),this.register(function(er){return new GLTFMaterialsEmissiveStrengthExtension$1(er)}),this.register(function(er){return new GLTFMaterialsBumpExtension$1(er)}),this.register(function(er){return new GLTFMeshGpuInstancing$1(er)})}register(er){return this.pluginCallbacks.indexOf(er)===-1&&this.pluginCallbacks.push(er),this}unregister(er){return this.pluginCallbacks.indexOf(er)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(er),1),this}setTextureUtils(er){return this.textureUtils=er,this}parse(er,tr,rr,nr){const sr=new GLTFWriter,ar=[];for(let or=0,lr=this.pluginCallbacks.length;or<lr;or++)ar.push(this.pluginCallbacks[or](sr));sr.setPlugins(ar),sr.setTextureUtils(this.textureUtils),sr.writeAsync(er,tr,nr).catch(rr)}parseAsync(er,tr){const rr=this;return new Promise(function(nr,sr){rr.parse(er,nr,sr,tr)})}}const WEBGL_CONSTANTS$1={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},KHR_MESH_QUANTIZATION="KHR_mesh_quantization",THREE_TO_WEBGL={};THREE_TO_WEBGL[NearestFilter]=WEBGL_CONSTANTS$1.NEAREST;THREE_TO_WEBGL[NearestMipmapNearestFilter]=WEBGL_CONSTANTS$1.NEAREST_MIPMAP_NEAREST;THREE_TO_WEBGL[NearestMipmapLinearFilter]=WEBGL_CONSTANTS$1.NEAREST_MIPMAP_LINEAR;THREE_TO_WEBGL[LinearFilter]=WEBGL_CONSTANTS$1.LINEAR;THREE_TO_WEBGL[LinearMipmapNearestFilter]=WEBGL_CONSTANTS$1.LINEAR_MIPMAP_NEAREST;THREE_TO_WEBGL[LinearMipmapLinearFilter]=WEBGL_CONSTANTS$1.LINEAR_MIPMAP_LINEAR;THREE_TO_WEBGL[ClampToEdgeWrapping]=WEBGL_CONSTANTS$1.CLAMP_TO_EDGE;THREE_TO_WEBGL[RepeatWrapping]=WEBGL_CONSTANTS$1.REPEAT;THREE_TO_WEBGL[MirroredRepeatWrapping]=WEBGL_CONSTANTS$1.MIRRORED_REPEAT;const PATH_PROPERTIES$1={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},DEFAULT_SPECULAR_COLOR=new Color,GLB_HEADER_BYTES=12,GLB_HEADER_MAGIC=1179937895,GLB_VERSION=2,GLB_CHUNK_PREFIX_BYTES=8,GLB_CHUNK_TYPE_JSON=1313821514,GLB_CHUNK_TYPE_BIN=5130562;function equalArray(ir,er){return ir.length===er.length&&ir.every(function(tr,rr){return tr===er[rr]})}function stringToArrayBuffer(ir){return new TextEncoder().encode(ir).buffer}function isIdentityMatrix(ir){return equalArray(ir.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function getMinMax(ir,er,tr){const rr={min:new Array(ir.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(ir.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let nr=er;nr<er+tr;nr++)for(let sr=0;sr<ir.itemSize;sr++){let ar;ir.itemSize>4?ar=ir.array[nr*ir.itemSize+sr]:(sr===0?ar=ir.getX(nr):sr===1?ar=ir.getY(nr):sr===2?ar=ir.getZ(nr):sr===3&&(ar=ir.getW(nr)),ir.normalized===!0&&(ar=MathUtils.normalize(ar,ir.array))),rr.min[sr]=Math.min(rr.min[sr],ar),rr.max[sr]=Math.max(rr.max[sr],ar)}return rr}function getPaddedBufferSize(ir){return Math.ceil(ir/4)*4}function getPaddedArrayBuffer(ir,er=0){const tr=getPaddedBufferSize(ir.byteLength);if(tr!==ir.byteLength){const rr=new Uint8Array(tr);if(rr.set(new Uint8Array(ir)),er!==0)for(let nr=ir.byteLength;nr<tr;nr++)rr[nr]=er;return rr.buffer}return ir}function getCanvas(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function getToBlobPromise(ir,er){if(ir.toBlob!==void 0)return new Promise(rr=>ir.toBlob(rr,er));let tr;return er==="image/jpeg"?tr=.92:er==="image/webp"&&(tr=.8),ir.convertToBlob({type:er,quality:tr})}class GLTFWriter{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+REVISION}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(er){this.plugins=er}setTextureUtils(er){this.textureUtils=er}async writeAsync(er,tr,rr={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},rr),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(er),await Promise.all(this.pending);const nr=this,sr=nr.buffers,ar=nr.json;rr=nr.options;const or=nr.extensionsUsed,lr=nr.extensionsRequired,cr=new Blob(sr,{type:"application/octet-stream"}),hr=Object.keys(or),fr=Object.keys(lr);if(hr.length>0&&(ar.extensionsUsed=hr),fr.length>0&&(ar.extensionsRequired=fr),ar.buffers&&ar.buffers.length>0&&(ar.buffers[0].byteLength=cr.size),rr.binary===!0){const ur=new FileReader;ur.readAsArrayBuffer(cr),ur.onloadend=function(){const pr=getPaddedArrayBuffer(ur.result),gr=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES));gr.setUint32(0,pr.byteLength,!0),gr.setUint32(4,GLB_CHUNK_TYPE_BIN,!0);const _r=getPaddedArrayBuffer(stringToArrayBuffer(JSON.stringify(ar)),32),mr=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES));mr.setUint32(0,_r.byteLength,!0),mr.setUint32(4,GLB_CHUNK_TYPE_JSON,!0);const dr=new ArrayBuffer(GLB_HEADER_BYTES),vr=new DataView(dr);vr.setUint32(0,GLB_HEADER_MAGIC,!0),vr.setUint32(4,GLB_VERSION,!0);const Ar=GLB_HEADER_BYTES+mr.byteLength+_r.byteLength+gr.byteLength+pr.byteLength;vr.setUint32(8,Ar,!0);const yr=new Blob([dr,mr,_r,gr,pr],{type:"application/octet-stream"}),wr=new FileReader;wr.readAsArrayBuffer(yr),wr.onloadend=function(){tr(wr.result)}}}else if(ar.buffers&&ar.buffers.length>0){const ur=new FileReader;ur.readAsDataURL(cr),ur.onloadend=function(){const pr=ur.result;ar.buffers[0].uri=pr,tr(ar)}}else tr(ar)}serializeUserData(er,tr){if(Object.keys(er.userData).length===0)return;const rr=this.options,nr=this.extensionsUsed;try{const sr=JSON.parse(JSON.stringify(er.userData));if(rr.includeCustomExtensions&&sr.gltfExtensions){tr.extensions===void 0&&(tr.extensions={});for(const ar in sr.gltfExtensions)tr.extensions[ar]=sr.gltfExtensions[ar],nr[ar]=!0;delete sr.gltfExtensions}Object.keys(sr).length>0&&(tr.extras=sr)}catch(sr){console.warn("THREE.GLTFExporter: userData of '"+er.name+"' won't be serialized because of JSON.stringify error - "+sr.message)}}getUID(er,tr=!1){if(this.uids.has(er)===!1){const nr=new Map;nr.set(!0,this.uid++),nr.set(!1,this.uid++),this.uids.set(er,nr)}return this.uids.get(er).get(tr)}isNormalizedNormalAttribute(er){if(this.cache.attributesNormalized.has(er))return!1;const rr=new Vector3$1;for(let nr=0,sr=er.count;nr<sr;nr++)if(Math.abs(rr.fromBufferAttribute(er,nr).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(er){const tr=this.cache;if(tr.attributesNormalized.has(er))return tr.attributesNormalized.get(er);const rr=er.clone(),nr=new Vector3$1;for(let sr=0,ar=rr.count;sr<ar;sr++)nr.fromBufferAttribute(rr,sr),nr.x===0&&nr.y===0&&nr.z===0?nr.setX(1):nr.normalize(),rr.setXYZ(sr,nr.x,nr.y,nr.z);return tr.attributesNormalized.set(er,rr),rr}applyTextureTransform(er,tr){let rr=!1;const nr={};(tr.offset.x!==0||tr.offset.y!==0)&&(nr.offset=tr.offset.toArray(),rr=!0),tr.rotation!==0&&(nr.rotation=tr.rotation,rr=!0),(tr.repeat.x!==1||tr.repeat.y!==1)&&(nr.scale=tr.repeat.toArray(),rr=!0),rr&&(er.extensions=er.extensions||{},er.extensions.KHR_texture_transform=nr,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(er,tr){if(er===tr)return er;function rr(pr){return pr.colorSpace===SRGBColorSpace?function(_r){return _r<.04045?_r*.0773993808:Math.pow(_r*.9478672986+.0521327014,2.4)}:function(_r){return _r}}er instanceof CompressedTexture&&(er=await this.decompressTextureAsync(er)),tr instanceof CompressedTexture&&(tr=await this.decompressTextureAsync(tr));const nr=er?er.image:null,sr=tr?tr.image:null,ar=Math.max(nr?nr.width:0,sr?sr.width:0),or=Math.max(nr?nr.height:0,sr?sr.height:0),lr=getCanvas();lr.width=ar,lr.height=or;const cr=lr.getContext("2d",{willReadFrequently:!0});cr.fillStyle="#00ffff",cr.fillRect(0,0,ar,or);const hr=cr.getImageData(0,0,ar,or);if(nr){cr.drawImage(nr,0,0,ar,or);const pr=rr(er),gr=cr.getImageData(0,0,ar,or).data;for(let _r=2;_r<gr.length;_r+=4)hr.data[_r]=pr(gr[_r]/256)*256}if(sr){cr.drawImage(sr,0,0,ar,or);const pr=rr(tr),gr=cr.getImageData(0,0,ar,or).data;for(let _r=1;_r<gr.length;_r+=4)hr.data[_r]=pr(gr[_r]/256)*256}cr.putImageData(hr,0,0);const ur=(er||tr).clone();return ur.source=new Source(lr),ur.colorSpace=NoColorSpace,ur.channel=(er||tr).channel,er&&tr&&er.channel!==tr.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),ur}async decompressTextureAsync(er,tr=1/0){if(this.textureUtils===null)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(er,tr)}processBuffer(er){const tr=this.json,rr=this.buffers;return tr.buffers||(tr.buffers=[{byteLength:0}]),rr.push(er),0}processBufferView(er,tr,rr,nr,sr){const ar=this.json;ar.bufferViews||(ar.bufferViews=[]);let or;switch(tr){case WEBGL_CONSTANTS$1.BYTE:case WEBGL_CONSTANTS$1.UNSIGNED_BYTE:or=1;break;case WEBGL_CONSTANTS$1.SHORT:case WEBGL_CONSTANTS$1.UNSIGNED_SHORT:or=2;break;default:or=4}let lr=er.itemSize*or;sr===WEBGL_CONSTANTS$1.ARRAY_BUFFER&&(lr=Math.ceil(lr/4)*4);const cr=getPaddedBufferSize(nr*lr),hr=new DataView(new ArrayBuffer(cr));let fr=0;for(let gr=rr;gr<rr+nr;gr++){for(let _r=0;_r<er.itemSize;_r++){let mr;er.itemSize>4?mr=er.array[gr*er.itemSize+_r]:(_r===0?mr=er.getX(gr):_r===1?mr=er.getY(gr):_r===2?mr=er.getZ(gr):_r===3&&(mr=er.getW(gr)),er.normalized===!0&&(mr=MathUtils.normalize(mr,er.array))),tr===WEBGL_CONSTANTS$1.FLOAT?hr.setFloat32(fr,mr,!0):tr===WEBGL_CONSTANTS$1.INT?hr.setInt32(fr,mr,!0):tr===WEBGL_CONSTANTS$1.UNSIGNED_INT?hr.setUint32(fr,mr,!0):tr===WEBGL_CONSTANTS$1.SHORT?hr.setInt16(fr,mr,!0):tr===WEBGL_CONSTANTS$1.UNSIGNED_SHORT?hr.setUint16(fr,mr,!0):tr===WEBGL_CONSTANTS$1.BYTE?hr.setInt8(fr,mr):tr===WEBGL_CONSTANTS$1.UNSIGNED_BYTE&&hr.setUint8(fr,mr),fr+=or}fr%lr!==0&&(fr+=lr-fr%lr)}const ur={buffer:this.processBuffer(hr.buffer),byteOffset:this.byteOffset,byteLength:cr};return sr!==void 0&&(ur.target=sr),sr===WEBGL_CONSTANTS$1.ARRAY_BUFFER&&(ur.byteStride=lr),this.byteOffset+=cr,ar.bufferViews.push(ur),{id:ar.bufferViews.length-1,byteLength:0}}processBufferViewImage(er){const tr=this,rr=tr.json;return rr.bufferViews||(rr.bufferViews=[]),new Promise(function(nr){const sr=new FileReader;sr.readAsArrayBuffer(er),sr.onloadend=function(){const ar=getPaddedArrayBuffer(sr.result),or={buffer:tr.processBuffer(ar),byteOffset:tr.byteOffset,byteLength:ar.byteLength};tr.byteOffset+=ar.byteLength,nr(rr.bufferViews.push(or)-1)}})}processAccessor(er,tr,rr,nr){const sr=this.json,ar={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let or;if(er.array.constructor===Float32Array)or=WEBGL_CONSTANTS$1.FLOAT;else if(er.array.constructor===Int32Array)or=WEBGL_CONSTANTS$1.INT;else if(er.array.constructor===Uint32Array)or=WEBGL_CONSTANTS$1.UNSIGNED_INT;else if(er.array.constructor===Int16Array)or=WEBGL_CONSTANTS$1.SHORT;else if(er.array.constructor===Uint16Array)or=WEBGL_CONSTANTS$1.UNSIGNED_SHORT;else if(er.array.constructor===Int8Array)or=WEBGL_CONSTANTS$1.BYTE;else if(er.array.constructor===Uint8Array)or=WEBGL_CONSTANTS$1.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+er.array.constructor.name);if(rr===void 0&&(rr=0),(nr===void 0||nr===1/0)&&(nr=er.count),nr===0)return null;const lr=getMinMax(er,rr,nr);let cr;tr!==void 0&&(cr=er===tr.index?WEBGL_CONSTANTS$1.ELEMENT_ARRAY_BUFFER:WEBGL_CONSTANTS$1.ARRAY_BUFFER);const hr=this.processBufferView(er,or,rr,nr,cr),fr={bufferView:hr.id,byteOffset:hr.byteOffset,componentType:or,count:nr,max:lr.max,min:lr.min,type:ar[er.itemSize]};return er.normalized===!0&&(fr.normalized=!0),sr.accessors||(sr.accessors=[]),sr.accessors.push(fr)-1}processImage(er,tr,rr,nr="image/png"){if(er!==null){const sr=this,ar=sr.cache,or=sr.json,lr=sr.options,cr=sr.pending;ar.images.has(er)||ar.images.set(er,{});const hr=ar.images.get(er),fr=nr+":flipY/"+rr.toString();if(hr[fr]!==void 0)return hr[fr];or.images||(or.images=[]);const ur={mimeType:nr},pr=getCanvas();pr.width=Math.min(er.width,lr.maxTextureSize),pr.height=Math.min(er.height,lr.maxTextureSize);const gr=pr.getContext("2d",{willReadFrequently:!0});if(rr===!0&&(gr.translate(0,pr.height),gr.scale(1,-1)),er.data!==void 0){tr!==RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported.",tr),(er.width>lr.maxTextureSize||er.height>lr.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",er);const mr=new Uint8ClampedArray(er.height*er.width*4);for(let dr=0;dr<mr.length;dr+=4)mr[dr+0]=er.data[dr+0],mr[dr+1]=er.data[dr+1],mr[dr+2]=er.data[dr+2],mr[dr+3]=er.data[dr+3];gr.putImageData(new ImageData(mr,er.width,er.height),0,0)}else if(typeof HTMLImageElement<"u"&&er instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&er instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&er instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&er instanceof OffscreenCanvas)gr.drawImage(er,0,0,pr.width,pr.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");lr.binary===!0?cr.push(getToBlobPromise(pr,nr).then(mr=>sr.processBufferViewImage(mr)).then(mr=>{ur.bufferView=mr})):pr.toDataURL!==void 0?ur.uri=pr.toDataURL(nr):cr.push(getToBlobPromise(pr,nr).then(mr=>new FileReader().readAsDataURL(mr)).then(mr=>{ur.uri=mr}));const _r=or.images.push(ur)-1;return hr[fr]=_r,_r}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(er){const tr=this.json;tr.samplers||(tr.samplers=[]);const rr={magFilter:THREE_TO_WEBGL[er.magFilter],minFilter:THREE_TO_WEBGL[er.minFilter],wrapS:THREE_TO_WEBGL[er.wrapS],wrapT:THREE_TO_WEBGL[er.wrapT]};return tr.samplers.push(rr)-1}async processTextureAsync(er){const rr=this.options,nr=this.cache,sr=this.json;if(nr.textures.has(er))return nr.textures.get(er);sr.textures||(sr.textures=[]),er instanceof CompressedTexture&&(er=await this.decompressTextureAsync(er,rr.maxTextureSize));let ar=er.userData.mimeType;ar==="image/webp"&&(ar="image/png");const or={sampler:this.processSampler(er),source:this.processImage(er.image,er.format,er.flipY,ar)};er.name&&(or.name=er.name),await this._invokeAllAsync(async function(cr){cr.writeTexture&&await cr.writeTexture(er,or)});const lr=sr.textures.push(or)-1;return nr.textures.set(er,lr),lr}async processMaterialAsync(er){const tr=this.cache,rr=this.json;if(tr.materials.has(er))return tr.materials.get(er);if(er.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;rr.materials||(rr.materials=[]);const nr={pbrMetallicRoughness:{}};er.isMeshStandardMaterial!==!0&&er.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const sr=er.color.toArray().concat([er.opacity]);if(equalArray(sr,[1,1,1,1])||(nr.pbrMetallicRoughness.baseColorFactor=sr),er.isMeshStandardMaterial?(nr.pbrMetallicRoughness.metallicFactor=er.metalness,nr.pbrMetallicRoughness.roughnessFactor=er.roughness):(nr.pbrMetallicRoughness.metallicFactor=0,nr.pbrMetallicRoughness.roughnessFactor=1),er.metalnessMap||er.roughnessMap){const or=await this.buildMetalRoughTextureAsync(er.metalnessMap,er.roughnessMap),lr={index:await this.processTextureAsync(or),texCoord:or.channel};this.applyTextureTransform(lr,or),nr.pbrMetallicRoughness.metallicRoughnessTexture=lr}if(er.map){const or={index:await this.processTextureAsync(er.map),texCoord:er.map.channel};this.applyTextureTransform(or,er.map),nr.pbrMetallicRoughness.baseColorTexture=or}if(er.emissive){const or=er.emissive;if(Math.max(or.r,or.g,or.b)>0&&(nr.emissiveFactor=er.emissive.toArray()),er.emissiveMap){const cr={index:await this.processTextureAsync(er.emissiveMap),texCoord:er.emissiveMap.channel};this.applyTextureTransform(cr,er.emissiveMap),nr.emissiveTexture=cr}}if(er.normalMap){const or={index:await this.processTextureAsync(er.normalMap),texCoord:er.normalMap.channel};er.normalScale&&er.normalScale.x!==1&&(or.scale=er.normalScale.x),this.applyTextureTransform(or,er.normalMap),nr.normalTexture=or}if(er.aoMap){const or={index:await this.processTextureAsync(er.aoMap),texCoord:er.aoMap.channel};er.aoMapIntensity!==1&&(or.strength=er.aoMapIntensity),this.applyTextureTransform(or,er.aoMap),nr.occlusionTexture=or}er.transparent?nr.alphaMode="BLEND":er.alphaTest>0&&(nr.alphaMode="MASK",nr.alphaCutoff=er.alphaTest),er.side===DoubleSide&&(nr.doubleSided=!0),er.name!==""&&(nr.name=er.name),this.serializeUserData(er,nr),await this._invokeAllAsync(async function(or){or.writeMaterialAsync&&await or.writeMaterialAsync(er,nr)});const ar=rr.materials.push(nr)-1;return tr.materials.set(er,ar),ar}async processMeshAsync(er){const tr=this.cache,rr=this.json,nr=[er.geometry.uuid];if(Array.isArray(er.material))for(let yr=0,wr=er.material.length;yr<wr;yr++)nr.push(er.material[yr].uuid);else nr.push(er.material.uuid);const sr=nr.join(":");if(tr.meshes.has(sr))return tr.meshes.get(sr);const ar=er.geometry;let or;er.isLineSegments?or=WEBGL_CONSTANTS$1.LINES:er.isLineLoop?or=WEBGL_CONSTANTS$1.LINE_LOOP:er.isLine?or=WEBGL_CONSTANTS$1.LINE_STRIP:er.isPoints?or=WEBGL_CONSTANTS$1.POINTS:or=er.material.wireframe?WEBGL_CONSTANTS$1.LINES:WEBGL_CONSTANTS$1.TRIANGLES;const lr={},cr={},hr=[],fr=[],ur={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},pr=ar.getAttribute("normal");pr!==void 0&&!this.isNormalizedNormalAttribute(pr)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),ar.setAttribute("normal",this.createNormalizedNormalAttribute(pr)));let gr=null;for(let yr in ar.attributes){if(yr.slice(0,5)==="morph")continue;const wr=ar.attributes[yr];if(yr=ur[yr]||yr.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(yr)||(yr="_"+yr),tr.attributes.has(this.getUID(wr))){cr[yr]=tr.attributes.get(this.getUID(wr));continue}gr=null;const Sr=wr.array;yr==="JOINTS_0"&&!(Sr instanceof Uint16Array)&&!(Sr instanceof Uint8Array)?(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),gr=new BufferAttribute(new Uint16Array(Sr),wr.itemSize,wr.normalized)):(Sr instanceof Uint32Array||Sr instanceof Int32Array)&&!yr.startsWith("_")&&(console.warn(`GLTFExporter: Attribute "${yr}" converted to type FLOAT.`),gr=GLTFExporter.Utils.toFloat32BufferAttribute(wr));const xr=this.processAccessor(gr||wr,ar);xr!==null&&(yr.startsWith("_")||this.detectMeshQuantization(yr,wr),cr[yr]=xr,tr.attributes.set(this.getUID(wr),xr))}if(pr!==void 0&&ar.setAttribute("normal",pr),Object.keys(cr).length===0)return null;if(er.morphTargetInfluences!==void 0&&er.morphTargetInfluences.length>0){const yr=[],wr=[],br={};if(er.morphTargetDictionary!==void 0)for(const Sr in er.morphTargetDictionary)br[er.morphTargetDictionary[Sr]]=Sr;for(let Sr=0;Sr<er.morphTargetInfluences.length;++Sr){const xr={};let Cr=!1;for(const Ir in ar.morphAttributes){if(Ir!=="position"&&Ir!=="normal"){Cr||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Cr=!0);continue}const Rr=ar.morphAttributes[Ir][Sr],Pr=Ir.toUpperCase(),Fr=ar.attributes[Ir];if(tr.attributes.has(this.getUID(Rr,!0))){xr[Pr]=tr.attributes.get(this.getUID(Rr,!0));continue}const Nr=Rr.clone();if(!ar.morphTargetsRelative)for(let Ur=0,Br=Rr.count;Ur<Br;Ur++)for(let Or=0;Or<Rr.itemSize;Or++)Or===0&&Nr.setX(Ur,Rr.getX(Ur)-Fr.getX(Ur)),Or===1&&Nr.setY(Ur,Rr.getY(Ur)-Fr.getY(Ur)),Or===2&&Nr.setZ(Ur,Rr.getZ(Ur)-Fr.getZ(Ur)),Or===3&&Nr.setW(Ur,Rr.getW(Ur)-Fr.getW(Ur));xr[Pr]=this.processAccessor(Nr,ar),tr.attributes.set(this.getUID(Fr,!0),xr[Pr])}fr.push(xr),yr.push(er.morphTargetInfluences[Sr]),er.morphTargetDictionary!==void 0&&wr.push(br[Sr])}lr.weights=yr,wr.length>0&&(lr.extras={},lr.extras.targetNames=wr)}const _r=Array.isArray(er.material);if(_r&&ar.groups.length===0)return null;let mr=!1;if(_r&&ar.index===null){const yr=[];for(let wr=0,br=ar.attributes.position.count;wr<br;wr++)yr[wr]=wr;ar.setIndex(yr),mr=!0}const dr=_r?er.material:[er.material],vr=_r?ar.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let yr=0,wr=vr.length;yr<wr;yr++){const br={mode:or,attributes:cr};if(this.serializeUserData(ar,br),fr.length>0&&(br.targets=fr),ar.index!==null){let xr=this.getUID(ar.index);(vr[yr].start!==void 0||vr[yr].count!==void 0)&&(xr+=":"+vr[yr].start+":"+vr[yr].count),tr.attributes.has(xr)?br.indices=tr.attributes.get(xr):(br.indices=this.processAccessor(ar.index,ar,vr[yr].start,vr[yr].count),tr.attributes.set(xr,br.indices)),br.indices===null&&delete br.indices}const Sr=await this.processMaterialAsync(dr[vr[yr].materialIndex]);Sr!==null&&(br.material=Sr),hr.push(br)}mr===!0&&ar.setIndex(null),lr.primitives=hr,rr.meshes||(rr.meshes=[]),await this._invokeAllAsync(function(yr){yr.writeMesh&&yr.writeMesh(er,lr)});const Ar=rr.meshes.push(lr)-1;return tr.meshes.set(sr,Ar),Ar}detectMeshQuantization(er,tr){if(this.extensionsUsed[KHR_MESH_QUANTIZATION])return;let rr;switch(tr.array.constructor){case Int8Array:rr="byte";break;case Uint8Array:rr="unsigned byte";break;case Int16Array:rr="short";break;case Uint16Array:rr="unsigned short";break;default:return}tr.normalized&&(rr+=" normalized");const nr=er.split("_",1)[0];KHR_mesh_quantization_ExtraAttrTypes[nr]&&KHR_mesh_quantization_ExtraAttrTypes[nr].includes(rr)&&(this.extensionsUsed[KHR_MESH_QUANTIZATION]=!0,this.extensionsRequired[KHR_MESH_QUANTIZATION]=!0)}processCamera(er){const tr=this.json;tr.cameras||(tr.cameras=[]);const rr=er.isOrthographicCamera,nr={type:rr?"orthographic":"perspective"};return rr?nr.orthographic={xmag:er.right*2,ymag:er.top*2,zfar:er.far<=0?.001:er.far,znear:er.near<0?0:er.near}:nr.perspective={aspectRatio:er.aspect,yfov:MathUtils.degToRad(er.fov),zfar:er.far<=0?.001:er.far,znear:er.near<0?0:er.near},er.name!==""&&(nr.name=er.type),tr.cameras.push(nr)-1}processAnimation(er,tr){const rr=this.json,nr=this.nodeMap;rr.animations||(rr.animations=[]),er=GLTFExporter.Utils.mergeMorphTargetTracks(er.clone(),tr);const sr=er.tracks,ar=[],or=[];for(let lr=0;lr<sr.length;++lr){const cr=sr[lr],hr=PropertyBinding.parseTrackName(cr.name);let fr=PropertyBinding.findNode(tr,hr.nodeName);const ur=PATH_PROPERTIES$1[hr.propertyName];if(hr.objectName==="bones"&&(fr.isSkinnedMesh===!0?fr=fr.skeleton.getBoneByName(hr.objectIndex):fr=void 0),!fr||!ur){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',cr.name);continue}const pr=1;let gr=cr.values.length/cr.times.length;ur===PATH_PROPERTIES$1.morphTargetInfluences&&(gr/=fr.morphTargetInfluences.length);let _r;cr.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(_r="CUBICSPLINE",gr/=3):cr.getInterpolation()===InterpolateDiscrete?_r="STEP":_r="LINEAR",or.push({input:this.processAccessor(new BufferAttribute(cr.times,pr)),output:this.processAccessor(new BufferAttribute(cr.values,gr)),interpolation:_r}),ar.push({sampler:or.length-1,target:{node:nr.get(fr),path:ur}})}return rr.animations.push({name:er.name||"clip_"+rr.animations.length,samplers:or,channels:ar}),rr.animations.length-1}processSkin(er){const tr=this.json,rr=this.nodeMap,nr=tr.nodes[rr.get(er)],sr=er.skeleton;if(sr===void 0)return null;const ar=er.skeleton.bones[0];if(ar===void 0)return null;const or=[],lr=new Float32Array(sr.bones.length*16),cr=new Matrix4;for(let fr=0;fr<sr.bones.length;++fr)or.push(rr.get(sr.bones[fr])),cr.copy(sr.boneInverses[fr]),cr.multiply(er.bindMatrix).toArray(lr,fr*16);return tr.skins===void 0&&(tr.skins=[]),tr.skins.push({inverseBindMatrices:this.processAccessor(new BufferAttribute(lr,16)),joints:or,skeleton:rr.get(ar)}),nr.skin=tr.skins.length-1}async processNodeAsync(er){const tr=this.json,rr=this.options,nr=this.nodeMap;tr.nodes||(tr.nodes=[]);const sr={};if(rr.trs){const or=er.quaternion.toArray(),lr=er.position.toArray(),cr=er.scale.toArray();equalArray(or,[0,0,0,1])||(sr.rotation=or),equalArray(lr,[0,0,0])||(sr.translation=lr),equalArray(cr,[1,1,1])||(sr.scale=cr)}else er.matrixAutoUpdate&&er.updateMatrix(),isIdentityMatrix(er.matrix)===!1&&(sr.matrix=er.matrix.elements);if(er.name!==""&&(sr.name=String(er.name)),this.serializeUserData(er,sr),er.isMesh||er.isLine||er.isPoints){const or=await this.processMeshAsync(er);or!==null&&(sr.mesh=or)}else er.isCamera&&(sr.camera=this.processCamera(er));if(er.isSkinnedMesh&&this.skins.push(er),er.children.length>0){const or=[];for(let lr=0,cr=er.children.length;lr<cr;lr++){const hr=er.children[lr];if(hr.visible||rr.onlyVisible===!1){const fr=await this.processNodeAsync(hr);fr!==null&&or.push(fr)}}or.length>0&&(sr.children=or)}await this._invokeAllAsync(function(or){or.writeNode&&or.writeNode(er,sr)});const ar=tr.nodes.push(sr)-1;return nr.set(er,ar),ar}async processSceneAsync(er){const tr=this.json,rr=this.options;tr.scenes||(tr.scenes=[],tr.scene=0);const nr={};er.name!==""&&(nr.name=er.name),tr.scenes.push(nr);const sr=[];for(let ar=0,or=er.children.length;ar<or;ar++){const lr=er.children[ar];if(lr.visible||rr.onlyVisible===!1){const cr=await this.processNodeAsync(lr);cr!==null&&sr.push(cr)}}sr.length>0&&(nr.nodes=sr),this.serializeUserData(er,nr)}async processObjectsAsync(er){const tr=new Scene;tr.name="AuxScene";for(let rr=0;rr<er.length;rr++)tr.children.push(er[rr]);await this.processSceneAsync(tr)}async processInputAsync(er){const tr=this.options;er=er instanceof Array?er:[er],await this._invokeAllAsync(function(nr){nr.beforeParse&&nr.beforeParse(er)});const rr=[];for(let nr=0;nr<er.length;nr++)er[nr]instanceof Scene?await this.processSceneAsync(er[nr]):rr.push(er[nr]);rr.length>0&&await this.processObjectsAsync(rr);for(let nr=0;nr<this.skins.length;++nr)this.processSkin(this.skins[nr]);for(let nr=0;nr<tr.animations.length;++nr)this.processAnimation(tr.animations[nr],er[0]);await this._invokeAllAsync(function(nr){nr.afterParse&&nr.afterParse(er)})}async _invokeAllAsync(er){for(let tr=0,rr=this.plugins.length;tr<rr;tr++)await er(this.plugins[tr])}}class GLTFLightExtension{constructor(er){this.writer=er,this.name="KHR_lights_punctual"}writeNode(er,tr){if(!er.isLight)return;if(!er.isDirectionalLight&&!er.isPointLight&&!er.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",er);return}const rr=this.writer,nr=rr.json,sr=rr.extensionsUsed,ar={};er.name&&(ar.name=er.name),ar.color=er.color.toArray(),ar.intensity=er.intensity,er.isDirectionalLight?ar.type="directional":er.isPointLight?(ar.type="point",er.distance>0&&(ar.range=er.distance)):er.isSpotLight&&(ar.type="spot",er.distance>0&&(ar.range=er.distance),ar.spot={},ar.spot.innerConeAngle=(1-er.penumbra)*er.angle,ar.spot.outerConeAngle=er.angle),er.decay!==void 0&&er.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),er.target&&(er.target.parent!==er||er.target.position.x!==0||er.target.position.y!==0||er.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),sr[this.name]||(nr.extensions=nr.extensions||{},nr.extensions[this.name]={lights:[]},sr[this.name]=!0);const or=nr.extensions[this.name].lights;or.push(ar),tr.extensions=tr.extensions||{},tr.extensions[this.name]={light:or.length-1}}}let GLTFMaterialsUnlitExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_unlit"}async writeMaterialAsync(er,tr){if(!er.isMeshBasicMaterial)return;const nr=this.writer.extensionsUsed;tr.extensions=tr.extensions||{},tr.extensions[this.name]={},nr[this.name]=!0,tr.pbrMetallicRoughness.metallicFactor=0,tr.pbrMetallicRoughness.roughnessFactor=.9}},GLTFMaterialsClearcoatExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.clearcoat===0)return;const rr=this.writer,nr=rr.extensionsUsed,sr={};if(sr.clearcoatFactor=er.clearcoat,er.clearcoatMap){const ar={index:await rr.processTextureAsync(er.clearcoatMap),texCoord:er.clearcoatMap.channel};rr.applyTextureTransform(ar,er.clearcoatMap),sr.clearcoatTexture=ar}if(sr.clearcoatRoughnessFactor=er.clearcoatRoughness,er.clearcoatRoughnessMap){const ar={index:await rr.processTextureAsync(er.clearcoatRoughnessMap),texCoord:er.clearcoatRoughnessMap.channel};rr.applyTextureTransform(ar,er.clearcoatRoughnessMap),sr.clearcoatRoughnessTexture=ar}if(er.clearcoatNormalMap){const ar={index:await rr.processTextureAsync(er.clearcoatNormalMap),texCoord:er.clearcoatNormalMap.channel};er.clearcoatNormalScale.x!==1&&(ar.scale=er.clearcoatNormalScale.x),rr.applyTextureTransform(ar,er.clearcoatNormalMap),sr.clearcoatNormalTexture=ar}tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsDispersionExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_dispersion"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.dispersion===0)return;const nr=this.writer.extensionsUsed,sr={};sr.dispersion=er.dispersion,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsIridescenceExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_iridescence"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.iridescence===0)return;const rr=this.writer,nr=rr.extensionsUsed,sr={};if(sr.iridescenceFactor=er.iridescence,er.iridescenceMap){const ar={index:await rr.processTextureAsync(er.iridescenceMap),texCoord:er.iridescenceMap.channel};rr.applyTextureTransform(ar,er.iridescenceMap),sr.iridescenceTexture=ar}if(sr.iridescenceIor=er.iridescenceIOR,sr.iridescenceThicknessMinimum=er.iridescenceThicknessRange[0],sr.iridescenceThicknessMaximum=er.iridescenceThicknessRange[1],er.iridescenceThicknessMap){const ar={index:await rr.processTextureAsync(er.iridescenceThicknessMap),texCoord:er.iridescenceThicknessMap.channel};rr.applyTextureTransform(ar,er.iridescenceThicknessMap),sr.iridescenceThicknessTexture=ar}tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsTransmissionExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_transmission"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.transmission===0)return;const rr=this.writer,nr=rr.extensionsUsed,sr={};if(sr.transmissionFactor=er.transmission,er.transmissionMap){const ar={index:await rr.processTextureAsync(er.transmissionMap),texCoord:er.transmissionMap.channel};rr.applyTextureTransform(ar,er.transmissionMap),sr.transmissionTexture=ar}tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsVolumeExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_volume"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.transmission===0)return;const rr=this.writer,nr=rr.extensionsUsed,sr={};if(sr.thicknessFactor=er.thickness,er.thicknessMap){const ar={index:await rr.processTextureAsync(er.thicknessMap),texCoord:er.thicknessMap.channel};rr.applyTextureTransform(ar,er.thicknessMap),sr.thicknessTexture=ar}er.attenuationDistance!==1/0&&(sr.attenuationDistance=er.attenuationDistance),sr.attenuationColor=er.attenuationColor.toArray(),tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsIorExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_ior"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.ior===1.5)return;const nr=this.writer.extensionsUsed,sr={};sr.ior=er.ior,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsSpecularExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_specular"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.specularIntensity===1&&er.specularColor.equals(DEFAULT_SPECULAR_COLOR)&&!er.specularIntensityMap&&!er.specularColorMap)return;const rr=this.writer,nr=rr.extensionsUsed,sr={};if(er.specularIntensityMap){const ar={index:await rr.processTextureAsync(er.specularIntensityMap),texCoord:er.specularIntensityMap.channel};rr.applyTextureTransform(ar,er.specularIntensityMap),sr.specularTexture=ar}if(er.specularColorMap){const ar={index:await rr.processTextureAsync(er.specularColorMap),texCoord:er.specularColorMap.channel};rr.applyTextureTransform(ar,er.specularColorMap),sr.specularColorTexture=ar}sr.specularFactor=er.specularIntensity,sr.specularColorFactor=er.specularColor.toArray(),tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsSheenExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_sheen"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.sheen==0)return;const rr=this.writer,nr=rr.extensionsUsed,sr={};if(er.sheenRoughnessMap){const ar={index:await rr.processTextureAsync(er.sheenRoughnessMap),texCoord:er.sheenRoughnessMap.channel};rr.applyTextureTransform(ar,er.sheenRoughnessMap),sr.sheenRoughnessTexture=ar}if(er.sheenColorMap){const ar={index:await rr.processTextureAsync(er.sheenColorMap),texCoord:er.sheenColorMap.channel};rr.applyTextureTransform(ar,er.sheenColorMap),sr.sheenColorTexture=ar}sr.sheenRoughnessFactor=er.sheenRoughness,sr.sheenColorFactor=er.sheenColor.toArray(),tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsAnisotropyExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.anisotropy==0)return;const rr=this.writer,nr=rr.extensionsUsed,sr={};if(er.anisotropyMap){const ar={index:await rr.processTextureAsync(er.anisotropyMap)};rr.applyTextureTransform(ar,er.anisotropyMap),sr.anisotropyTexture=ar}sr.anisotropyStrength=er.anisotropy,sr.anisotropyRotation=er.anisotropyRotation,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsEmissiveStrengthExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(er,tr){if(!er.isMeshStandardMaterial||er.emissiveIntensity===1)return;const nr=this.writer.extensionsUsed,sr={};sr.emissiveStrength=er.emissiveIntensity,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsBumpExtension$1=class{constructor(er){this.writer=er,this.name="EXT_materials_bump"}async writeMaterialAsync(er,tr){if(!er.isMeshStandardMaterial||er.bumpScale===1&&!er.bumpMap)return;const rr=this.writer,nr=rr.extensionsUsed,sr={};if(er.bumpMap){const ar={index:await rr.processTextureAsync(er.bumpMap),texCoord:er.bumpMap.channel};rr.applyTextureTransform(ar,er.bumpMap),sr.bumpTexture=ar}sr.bumpFactor=er.bumpScale,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMeshGpuInstancing$1=class{constructor(er){this.writer=er,this.name="EXT_mesh_gpu_instancing"}writeNode(er,tr){if(!er.isInstancedMesh)return;const rr=this.writer,nr=er,sr=new Float32Array(nr.count*3),ar=new Float32Array(nr.count*4),or=new Float32Array(nr.count*3),lr=new Matrix4,cr=new Vector3$1,hr=new Quaternion$1,fr=new Vector3$1;for(let pr=0;pr<nr.count;pr++)nr.getMatrixAt(pr,lr),lr.decompose(cr,hr,fr),cr.toArray(sr,pr*3),hr.toArray(ar,pr*4),fr.toArray(or,pr*3);const ur={TRANSLATION:rr.processAccessor(new BufferAttribute(sr,3)),ROTATION:rr.processAccessor(new BufferAttribute(ar,4)),SCALE:rr.processAccessor(new BufferAttribute(or,3))};nr.instanceColor&&(ur._COLOR_0=rr.processAccessor(nr.instanceColor)),tr.extensions=tr.extensions||{},tr.extensions[this.name]={attributes:ur},rr.extensionsUsed[this.name]=!0,rr.extensionsRequired[this.name]=!0}};GLTFExporter.Utils={insertKeyframe:function(ir,er){const rr=ir.getValueSize(),nr=new ir.TimeBufferType(ir.times.length+1),sr=new ir.ValueBufferType(ir.values.length+rr),ar=ir.createInterpolant(new ir.ValueBufferType(rr));let or;if(ir.times.length===0){nr[0]=er;for(let lr=0;lr<rr;lr++)sr[lr]=0;or=0}else if(er<ir.times[0]){if(Math.abs(ir.times[0]-er)<.001)return 0;nr[0]=er,nr.set(ir.times,1),sr.set(ar.evaluate(er),0),sr.set(ir.values,rr),or=0}else if(er>ir.times[ir.times.length-1]){if(Math.abs(ir.times[ir.times.length-1]-er)<.001)return ir.times.length-1;nr[nr.length-1]=er,nr.set(ir.times,0),sr.set(ir.values,0),sr.set(ar.evaluate(er),ir.values.length),or=nr.length-1}else for(let lr=0;lr<ir.times.length;lr++){if(Math.abs(ir.times[lr]-er)<.001)return lr;if(ir.times[lr]<er&&ir.times[lr+1]>er){nr.set(ir.times.slice(0,lr+1),0),nr[lr+1]=er,nr.set(ir.times.slice(lr+1),lr+2),sr.set(ir.values.slice(0,(lr+1)*rr),0),sr.set(ar.evaluate(er),(lr+1)*rr),sr.set(ir.values.slice((lr+1)*rr),(lr+2)*rr),or=lr+1;break}}return ir.times=nr,ir.values=sr,or},mergeMorphTargetTracks:function(ir,er){const tr=[],rr={},nr=ir.tracks;for(let sr=0;sr<nr.length;++sr){let ar=nr[sr];const or=PropertyBinding.parseTrackName(ar.name),lr=PropertyBinding.findNode(er,or.nodeName);if(or.propertyName!=="morphTargetInfluences"||or.propertyIndex===void 0){tr.push(ar);continue}if(ar.createInterpolant!==ar.InterpolantFactoryMethodDiscrete&&ar.createInterpolant!==ar.InterpolantFactoryMethodLinear){if(ar.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),ar=ar.clone(),ar.setInterpolation(InterpolateLinear)}const cr=lr.morphTargetInfluences.length,hr=lr.morphTargetDictionary[or.propertyIndex];if(hr===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+or.propertyIndex);let fr;if(rr[lr.uuid]===void 0){fr=ar.clone();const pr=new fr.ValueBufferType(cr*fr.times.length);for(let gr=0;gr<fr.times.length;gr++)pr[gr*cr+hr]=fr.values[gr];fr.name=(or.nodeName||"")+".morphTargetInfluences",fr.values=pr,rr[lr.uuid]=fr,tr.push(fr);continue}const ur=ar.createInterpolant(new ar.ValueBufferType(1));fr=rr[lr.uuid];for(let pr=0;pr<fr.times.length;pr++)fr.values[pr*cr+hr]=ur.evaluate(fr.times[pr]);for(let pr=0;pr<ar.times.length;pr++){const gr=this.insertKeyframe(fr,ar.times[pr]);fr.values[gr*cr+hr]=ar.values[pr]}}return ir.tracks=tr,ir},toFloat32BufferAttribute:function(ir){const er=new BufferAttribute(new Float32Array(ir.count*ir.itemSize),ir.itemSize,!1);if(!ir.normalized&&!ir.isInterleavedBufferAttribute)return er.array.set(ir.array),er;for(let tr=0,rr=ir.count;tr<rr;tr++)for(let nr=0;nr<ir.itemSize;nr++)er.setComponent(tr,nr,ir.getComponent(tr,nr));return er}};const t$1=0,e=1,n=2,i=3,s=0,a$1=0,r=2,o=0,l=1,f=160,h=161,U=162,c$1=163,_=166,p=0,g$1=1,y=0,x=1,u=2,b$1=3,d=4,w=5,m=6,D=7,B$1=8,L=9,v=10,A$1=11,k$1=12,V=13,I$1=14,S=15,F=16,O=17,E=18,T=0,C$1=1,M=2,P=3,z=4,W=5,H=6,N=7,K=8,X=9,R$2=10,Y=11,j=0,q=1,G=2,J=13,Q$1=14,Z=15,$=128,tt=64,et$1=32,nt=16,it=0,st=1,at=2,rt=3,ot=4,lt=5,ft$1=6,ht=7,Ut=8,ct=9,_t=10,pt=13,gt=14,yt$1=15,xt$1=16,ut=17,bt=20,dt=21,wt=22,mt$1=23,Dt=24,Bt=27,Lt$1=28,vt$1=29,At=30,kt=31,Vt=34,It=35,St=36,Ft=37,Ot=38,Et=41,Tt$1=42,Ct=43,Mt=44,Pt=45,zt=48,Wt=49,Ht=50,Nt=58,Kt=59,Xt=62,Rt=63,Yt$1=64,jt=65,qt=68,Gt$1=69,Jt=70,Qt=71,Zt=74,$t=75,te=76,ee=77,ne$1=78,ie=81,se=82,ae=83,re=84,oe=85,le=88,fe=89,he=90,Ue$1=91,ce$1=92,_e=95,pe=96,ge=97,ye=98,xe=99,ue=100,be=101,de=102,we=103,me=104,De=105,Be=106,Le=107,ve=108,Ae=109,ke=110,Ve=111,Ie=112,Se=113,Fe=114,Oe=115,Ee=116,Te=117,Ce=118,Me=119,Pe=120,ze=121,We=122,He=123,Ne=124,Ke=125,Xe$1=126,Re=127,Ye=128,je=129,qe=130,Ge=131,Je=132,Qe=133,Ze=134,$e$1=135,tn=136,en=137,nn=138,sn=139,an=140,rn=141,on=142,ln=143,fn=144,hn=145,Un=146,cn=147,_n=148,pn$1=149,gn=150,yn=151,xn=152,un=153,bn=154,dn=155,wn=156,mn=157,Dn=158,Bn=159,Ln=160,vn=161,An=162,kn=163,Vn=164,In=165,Sn=166,Fn=167,On=168,En=169,Tn=170,Cn=171,Mn=172,Pn=173,zn=174,Wn=175,Hn=176,Nn=177,Kn=178,Xn=179,Rn=180,Yn=181,jn=182,qn=183,Gn=184,Jn=1000156007,Qn=1000156008,Zn=1000156009,$n=1000156010,ti=1000156011,ei=1000156017,ni=1000156018,ii=1000156019,si=1000156020,ai=1000156021,ri=1000054e3,oi=1000054001,li=1000054002,fi=1000054003,hi=1000054004,Ui$1=1000054005,ci=1000054006,_i=1000054007,pi$1=1000066e3,gi=1000066001,yi=1000066002,xi=1000066003,ui=1000066004,bi=1000066005,di=1000066006,wi=1000066007,mi$1=1000066008,Di=1000066009,Bi=1000066010,Li=1000066011,vi=1000066012,Ai=1000066013,ki=100034e4,Vi=1000340001;class Ii{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Si{constructor(er,tr,rr,nr){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(er.buffer,er.byteOffset+tr,rr),this._littleEndian=nr,this._offset=0}_nextUint8(){const er=this._dataView.getUint8(this._offset);return this._offset+=1,er}_nextUint16(){const er=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,er}_nextUint32(){const er=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,er}_nextUint64(){const er=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,er}_nextInt32(){const er=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,er}_nextUint8Array(er){const tr=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,er);return this._offset+=er,tr}_skip(er){return this._offset+=er,this}_scan(er,tr){tr===void 0&&(tr=0);const rr=this._offset;let nr=0;for(;this._dataView.getUint8(this._offset)!==tr&&nr<er;)nr++,this._offset++;return nr<er&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+rr,nr)}}const Fi=new Uint8Array([0]),Oi=[171,75,84,88,32,50,48,187,13,10,26,10];function Ei(ir){return new TextEncoder().encode(ir)}function Ti(ir){return new TextDecoder().decode(ir)}function Ci(ir){let er=0;for(const nr of ir)er+=nr.byteLength;const tr=new Uint8Array(er);let rr=0;for(const nr of ir)tr.set(new Uint8Array(nr),rr),rr+=nr.byteLength;return tr}function Mi(ir,er){return er===void 0&&(er=4),Math.ceil(ir/er)*er-ir}function Pi(ir){const er=new Uint8Array(ir.buffer,ir.byteOffset,Oi.length);if(er[0]!==Oi[0]||er[1]!==Oi[1]||er[2]!==Oi[2]||er[3]!==Oi[3]||er[4]!==Oi[4]||er[5]!==Oi[5]||er[6]!==Oi[6]||er[7]!==Oi[7]||er[8]!==Oi[8]||er[9]!==Oi[9]||er[10]!==Oi[10]||er[11]!==Oi[11])throw new Error("Missing KTX 2.0 identifier.");const tr=new Ii,rr=17*Uint32Array.BYTES_PER_ELEMENT,nr=new Si(ir,Oi.length,rr,!0);tr.vkFormat=nr._nextUint32(),tr.typeSize=nr._nextUint32(),tr.pixelWidth=nr._nextUint32(),tr.pixelHeight=nr._nextUint32(),tr.pixelDepth=nr._nextUint32(),tr.layerCount=nr._nextUint32(),tr.faceCount=nr._nextUint32();const sr=nr._nextUint32();tr.supercompressionScheme=nr._nextUint32();const ar=nr._nextUint32(),or=nr._nextUint32(),lr=nr._nextUint32(),cr=nr._nextUint32(),hr=nr._nextUint64(),fr=nr._nextUint64(),ur=new Si(ir,Oi.length+rr,3*sr*8,!0);for(let Or=0;Or<sr;Or++)tr.levels.push({levelData:new Uint8Array(ir.buffer,ir.byteOffset+ur._nextUint64(),ur._nextUint64()),uncompressedByteLength:ur._nextUint64()});const pr=new Si(ir,ar,or,!0),gr={vendorId:pr._skip(4)._nextUint16(),descriptorType:pr._nextUint16(),versionNumber:pr._nextUint16(),descriptorBlockSize:pr._nextUint16(),colorModel:pr._nextUint8(),colorPrimaries:pr._nextUint8(),transferFunction:pr._nextUint8(),flags:pr._nextUint8(),texelBlockDimension:[pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8()],bytesPlane:[pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8()],samples:[]},_r=(gr.descriptorBlockSize/4-6)/4;for(let Or=0;Or<_r;Or++){const Dr={bitOffset:pr._nextUint16(),bitLength:pr._nextUint8(),channelType:pr._nextUint8(),samplePosition:[pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Dr.channelType?(Dr.sampleLower=pr._nextInt32(),Dr.sampleUpper=pr._nextInt32()):(Dr.sampleLower=pr._nextUint32(),Dr.sampleUpper=pr._nextUint32()),gr.samples[Or]=Dr}tr.dataFormatDescriptor.length=0,tr.dataFormatDescriptor.push(gr);const mr=new Si(ir,lr,cr,!0);for(;mr._offset<cr;){const Or=mr._nextUint32(),Dr=mr._scan(Or),Wr=Ti(Dr);if(tr.keyValue[Wr]=mr._nextUint8Array(Or-Dr.byteLength-1),Wr.match(/^ktx/i)){const $r=Ti(tr.keyValue[Wr]);tr.keyValue[Wr]=$r.substring(0,$r.lastIndexOf("\0"))}mr._skip(Or%4?4-Or%4:0)}if(fr<=0)return tr;const dr=new Si(ir,hr,fr,!0),vr=dr._nextUint16(),Ar=dr._nextUint16(),yr=dr._nextUint32(),wr=dr._nextUint32(),br=dr._nextUint32(),Sr=dr._nextUint32(),xr=[];for(let Or=0;Or<sr;Or++)xr.push({imageFlags:dr._nextUint32(),rgbSliceByteOffset:dr._nextUint32(),rgbSliceByteLength:dr._nextUint32(),alphaSliceByteOffset:dr._nextUint32(),alphaSliceByteLength:dr._nextUint32()});const Cr=hr+dr._offset,Ir=Cr+yr,Rr=Ir+wr,Pr=Rr+br,Fr=new Uint8Array(ir.buffer,ir.byteOffset+Cr,yr),Nr=new Uint8Array(ir.buffer,ir.byteOffset+Ir,wr),Ur=new Uint8Array(ir.buffer,ir.byteOffset+Rr,br),Br=new Uint8Array(ir.buffer,ir.byteOffset+Pr,Sr);return tr.globalData={endpointCount:vr,selectorCount:Ar,imageDescs:xr,endpointsData:Fr,selectorsData:Nr,tablesData:Ur,extendedData:Br},tr}const zi$1={keepWriter:!1};function Wi(ir,er){er===void 0&&(er={}),er={...zi$1,...er};let tr=new ArrayBuffer(0);if(ir.globalData){const yr=new ArrayBuffer(20+5*ir.globalData.imageDescs.length*4),wr=new DataView(yr);wr.setUint16(0,ir.globalData.endpointCount,!0),wr.setUint16(2,ir.globalData.selectorCount,!0),wr.setUint32(4,ir.globalData.endpointsData.byteLength,!0),wr.setUint32(8,ir.globalData.selectorsData.byteLength,!0),wr.setUint32(12,ir.globalData.tablesData.byteLength,!0),wr.setUint32(16,ir.globalData.extendedData.byteLength,!0);for(let br=0;br<ir.globalData.imageDescs.length;br++){const Sr=ir.globalData.imageDescs[br];wr.setUint32(20+5*br*4+0,Sr.imageFlags,!0),wr.setUint32(20+5*br*4+4,Sr.rgbSliceByteOffset,!0),wr.setUint32(20+5*br*4+8,Sr.rgbSliceByteLength,!0),wr.setUint32(20+5*br*4+12,Sr.alphaSliceByteOffset,!0),wr.setUint32(20+5*br*4+16,Sr.alphaSliceByteLength,!0)}tr=Ci([yr,ir.globalData.endpointsData,ir.globalData.selectorsData,ir.globalData.tablesData,ir.globalData.extendedData])}const rr=[];let nr=ir.keyValue;er.keepWriter||(nr={...ir.keyValue,KTXwriter:"KTX-Parse v0.7.1"});for(const yr in nr){const wr=nr[yr],br=Ei(yr),Sr=typeof wr=="string"?Ci([Ei(wr),Fi]):wr,xr=br.byteLength+1+Sr.byteLength,Cr=Mi(xr,4);rr.push(Ci([new Uint32Array([xr]),br,Fi,Sr,new Uint8Array(Cr).fill(0)]))}const sr=Ci(rr);if(ir.dataFormatDescriptor.length!==1||ir.dataFormatDescriptor[0].descriptorType!==0)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");const ar=ir.dataFormatDescriptor[0],or=new ArrayBuffer(28+16*ar.samples.length),lr=new DataView(or),cr=24+16*ar.samples.length;if(lr.setUint32(0,or.byteLength,!0),lr.setUint16(4,ar.vendorId,!0),lr.setUint16(6,ar.descriptorType,!0),lr.setUint16(8,ar.versionNumber,!0),lr.setUint16(10,cr,!0),lr.setUint8(12,ar.colorModel),lr.setUint8(13,ar.colorPrimaries),lr.setUint8(14,ar.transferFunction),lr.setUint8(15,ar.flags),!Array.isArray(ar.texelBlockDimension))throw new Error("texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.");lr.setUint8(16,ar.texelBlockDimension[0]),lr.setUint8(17,ar.texelBlockDimension[1]),lr.setUint8(18,ar.texelBlockDimension[2]),lr.setUint8(19,ar.texelBlockDimension[3]);for(let yr=0;yr<8;yr++)lr.setUint8(20+yr,ar.bytesPlane[yr]);for(let yr=0;yr<ar.samples.length;yr++){const wr=ar.samples[yr],br=28+16*yr;if(wr.channelID)throw new Error("channelID has been renamed to channelType.");lr.setUint16(br+0,wr.bitOffset,!0),lr.setUint8(br+2,wr.bitLength),lr.setUint8(br+3,wr.channelType),lr.setUint8(br+4,wr.samplePosition[0]),lr.setUint8(br+5,wr.samplePosition[1]),lr.setUint8(br+6,wr.samplePosition[2]),lr.setUint8(br+7,wr.samplePosition[3]),64&wr.channelType?(lr.setInt32(br+8,wr.sampleLower,!0),lr.setInt32(br+12,wr.sampleUpper,!0)):(lr.setUint32(br+8,wr.sampleLower,!0),lr.setUint32(br+12,wr.sampleUpper,!0))}const hr=Oi.length+68+3*ir.levels.length*8,fr=hr+or.byteLength;let ur=tr.byteLength>0?fr+sr.byteLength:0;ur%8&&(ur+=8-ur%8);const pr=[],gr=new DataView(new ArrayBuffer(3*ir.levels.length*8)),_r=new Uint32Array(ir.levels.length);let mr=0;ir.supercompressionScheme===0&&(mr=function(yr,wr){const br=Math.max(yr,4),Sr=Math.min(yr,4);let xr=br;for(;xr%Sr!=0;)xr+=br;return xr}(function(yr){return yr.levels[0].levelData.byteLength/function(wr,br){let Sr=1;const xr=[wr.pixelWidth,wr.pixelHeight,wr.pixelDepth],Cr=function(Ir){const[Rr,Pr,Fr]=Ir.dataFormatDescriptor[0].texelBlockDimension;return[Rr+1,Pr+1,Fr+1]}(wr);for(let Ir=0;Ir<3;Ir++)if(xr[Ir]>0){const Rr=Math.ceil(Math.floor(xr[Ir]*Math.pow(2,-0))/Cr[Ir]);Sr*=Math.max(1,Rr)}return wr.layerCount>0&&(Sr*=wr.layerCount),wr.faceCount>0&&(Sr*=wr.faceCount),Sr}(yr)}(ir)));let dr=(ur||fr+sr.byteLength)+tr.byteLength;for(let yr=ir.levels.length-1;yr>=0;yr--){if(dr%mr){const br=Mi(dr,mr);pr.push(new Uint8Array(br)),dr+=br}const wr=ir.levels[yr];pr.push(wr.levelData),_r[yr]=dr,dr+=wr.levelData.byteLength}for(let yr=0;yr<ir.levels.length;yr++){const wr=ir.levels[yr];gr.setBigUint64(24*yr+0,BigInt(_r[yr]),!0),gr.setBigUint64(24*yr+8,BigInt(wr.levelData.byteLength),!0),gr.setBigUint64(24*yr+16,BigInt(wr.uncompressedByteLength),!0)}const vr=new ArrayBuffer(68),Ar=new DataView(vr);return Ar.setUint32(0,ir.vkFormat,!0),Ar.setUint32(4,ir.typeSize,!0),Ar.setUint32(8,ir.pixelWidth,!0),Ar.setUint32(12,ir.pixelHeight,!0),Ar.setUint32(16,ir.pixelDepth,!0),Ar.setUint32(20,ir.layerCount,!0),Ar.setUint32(24,ir.faceCount,!0),Ar.setUint32(28,ir.levels.length,!0),Ar.setUint32(32,ir.supercompressionScheme,!0),Ar.setUint32(36,hr,!0),Ar.setUint32(40,or.byteLength,!0),Ar.setUint32(44,fr,!0),Ar.setUint32(48,sr.byteLength,!0),Ar.setBigUint64(52,BigInt(tr.byteLength>0?ur:0),!0),Ar.setBigUint64(60,BigInt(tr.byteLength),!0),new Uint8Array(Ci([new Uint8Array(Oi).buffer,vr,gr.buffer,or,sr,ur>0?new ArrayBuffer(ur-(fr+sr.byteLength)):new ArrayBuffer(0),tr,...pr]))}const VK_FORMAT_MAP={[RGBAFormat]:{[FloatType]:{[NoColorSpace]:Ae,[LinearSRGBColorSpace]:Ae},[HalfFloatType]:{[NoColorSpace]:ge,[LinearSRGBColorSpace]:ge},[UnsignedByteType]:{[NoColorSpace]:Ft,[LinearSRGBColorSpace]:Ft,[SRGBColorSpace]:Ct}},[RGFormat]:{[FloatType]:{[NoColorSpace]:we,[LinearSRGBColorSpace]:we},[HalfFloatType]:{[NoColorSpace]:ae,[LinearSRGBColorSpace]:ae},[UnsignedByteType]:{[NoColorSpace]:xt$1,[LinearSRGBColorSpace]:xt$1,[SRGBColorSpace]:wt}},[RedFormat]:{[FloatType]:{[NoColorSpace]:ue,[LinearSRGBColorSpace]:ue},[HalfFloatType]:{[NoColorSpace]:te,[LinearSRGBColorSpace]:te},[UnsignedByteType]:{[NoColorSpace]:ct,[LinearSRGBColorSpace]:ct,[SRGBColorSpace]:yt$1}}},KHR_DF_CHANNEL_MAP=[j,q,G,Z],KHR_DF_CHANNEL_SAMPLE_LOWER_UPPER={[FloatType]:[3212836864,1065353216],[HalfFloatType]:[3212836864,1065353216],[UnsignedByteType]:[0,255]},ERROR_INPUT="THREE.KTX2Exporter: Supported inputs are DataTexture, Data3DTexture, or WebGLRenderer and WebGLRenderTarget.",ERROR_FORMAT="THREE.KTX2Exporter: Supported formats are RGBAFormat, RGFormat, or RedFormat.",ERROR_TYPE='THREE.KTX2Exporter: Supported types are FloatType, HalfFloatType, or UnsignedByteType."',ERROR_COLOR_SPACE="THREE.KTX2Exporter: Supported color spaces are SRGBColorSpace (UnsignedByteType only), LinearSRGBColorSpace, or NoColorSpace.";class KTX2Exporter{async parse(er,tr){let rr;if(er.isDataTexture||er.isData3DTexture)rr=er;else if((er.isWebGLRenderer||er.isWebGPURenderer)&&tr.isRenderTarget)rr=await toDataTexture(er,tr);else throw new Error(ERROR_INPUT);if(VK_FORMAT_MAP[rr.format]===void 0)throw new Error(ERROR_FORMAT);if(VK_FORMAT_MAP[rr.format][rr.type]===void 0)throw new Error(ERROR_TYPE);if(VK_FORMAT_MAP[rr.format][rr.type][rr.colorSpace]===void 0)throw new Error(ERROR_COLOR_SPACE);const nr=rr.image.data,sr=getChannelCount(rr),ar=new Ii;ar.vkFormat=VK_FORMAT_MAP[rr.format][rr.type][rr.colorSpace],ar.typeSize=nr.BYTES_PER_ELEMENT,ar.pixelWidth=rr.image.width,ar.pixelHeight=rr.image.height,rr.isData3DTexture&&(ar.pixelDepth=rr.image.depth);const or=ar.dataFormatDescriptor[0];or.colorModel=l,or.colorPrimaries=rr.colorSpace===NoColorSpace?T:C$1,or.transferFunction=ColorManagement.getTransfer(rr.colorSpace)===SRGBTransfer?u:x,or.texelBlockDimension=[0,0,0,0],or.bytesPlane=[ar.typeSize*sr,0,0,0,0,0,0,0];for(let lr=0;lr<sr;++lr){let cr=KHR_DF_CHANNEL_MAP[lr];cr===Z&&or.transferFunction!==x&&(cr|=nt),(rr.type===FloatType||rr.type===HalfFloatType)&&(cr|=$,cr|=tt),or.samples.push({channelType:cr,bitOffset:lr*nr.BYTES_PER_ELEMENT*8,bitLength:nr.BYTES_PER_ELEMENT*8-1,samplePosition:[0,0,0,0],sampleLower:KHR_DF_CHANNEL_SAMPLE_LOWER_UPPER[rr.type][0],sampleUpper:KHR_DF_CHANNEL_SAMPLE_LOWER_UPPER[rr.type][1]})}return ar.levels=[{levelData:new Uint8Array(nr.buffer,nr.byteOffset,nr.byteLength),uncompressedByteLength:nr.byteLength}],ar.keyValue.KTXwriter=`three.js ${REVISION}`,Wi(ar,{keepWriter:!0})}}async function toDataTexture(ir,er){const tr=getChannelCount(er.texture);let rr;if(ir.isWebGLRenderer){if(er.texture.type===FloatType)rr=new Float32Array(er.width*er.height*tr);else if(er.texture.type===HalfFloatType)rr=new Uint16Array(er.width*er.height*tr);else if(er.texture.type===UnsignedByteType)rr=new Uint8Array(er.width*er.height*tr);else throw new Error(ERROR_TYPE);await ir.readRenderTargetPixelsAsync(er,0,0,er.width,er.height,rr)}else rr=await ir.readRenderTargetPixelsAsync(er,0,0,er.width,er.height);const nr=new DataTexture(rr,er.width,er.height,er.texture.format,er.texture.type);return nr.colorSpace=er.texture.colorSpace,nr}function getChannelCount(ir){switch(ir.format){case RGBAFormat:return 4;case RGFormat:case RGIntegerFormat:return 2;case RedFormat:case RedIntegerFormat:return 1;default:throw new Error(ERROR_FORMAT)}}class OBJExporter{parse(er){let tr="",rr=0,nr=0,sr=0;const ar=new Vector3$1,or=new Color,lr=new Vector3$1,cr=new Vector2,hr=[];function fr(gr){let _r=0,mr=0,dr=0;const vr=gr.geometry,Ar=new Matrix3,yr=vr.getAttribute("position"),wr=vr.getAttribute("normal"),br=vr.getAttribute("uv"),Sr=vr.getIndex();if(tr+="o "+gr.name+`
`,gr.material&&gr.material.name&&(tr+="usemtl "+gr.material.name+`
`),yr!==void 0)for(let xr=0,Cr=yr.count;xr<Cr;xr++,_r++)ar.fromBufferAttribute(yr,xr),ar.applyMatrix4(gr.matrixWorld),tr+="v "+ar.x+" "+ar.y+" "+ar.z+`
`;if(br!==void 0)for(let xr=0,Cr=br.count;xr<Cr;xr++,dr++)cr.fromBufferAttribute(br,xr),tr+="vt "+cr.x+" "+cr.y+`
`;if(wr!==void 0){Ar.getNormalMatrix(gr.matrixWorld);for(let xr=0,Cr=wr.count;xr<Cr;xr++,mr++)lr.fromBufferAttribute(wr,xr),lr.applyMatrix3(Ar).normalize(),tr+="vn "+lr.x+" "+lr.y+" "+lr.z+`
`}if(Sr!==null)for(let xr=0,Cr=Sr.count;xr<Cr;xr+=3){for(let Ir=0;Ir<3;Ir++){const Rr=Sr.getX(xr+Ir)+1;hr[Ir]=rr+Rr+(wr||br?"/"+(br?nr+Rr:"")+(wr?"/"+(sr+Rr):""):"")}tr+="f "+hr.join(" ")+`
`}else for(let xr=0,Cr=yr.count;xr<Cr;xr+=3){for(let Ir=0;Ir<3;Ir++){const Rr=xr+Ir+1;hr[Ir]=rr+Rr+(wr||br?"/"+(br?nr+Rr:"")+(wr?"/"+(sr+Rr):""):"")}tr+="f "+hr.join(" ")+`
`}rr+=_r,nr+=dr,sr+=mr}function ur(gr){let _r=0;const mr=gr.geometry,dr=gr.type,vr=mr.getAttribute("position");if(tr+="o "+gr.name+`
`,vr!==void 0)for(let Ar=0,yr=vr.count;Ar<yr;Ar++,_r++)ar.fromBufferAttribute(vr,Ar),ar.applyMatrix4(gr.matrixWorld),tr+="v "+ar.x+" "+ar.y+" "+ar.z+`
`;if(dr==="Line"){tr+="l ";for(let Ar=1,yr=vr.count;Ar<=yr;Ar++)tr+=rr+Ar+" ";tr+=`
`}if(dr==="LineSegments")for(let Ar=1,yr=Ar+1,wr=vr.count;Ar<wr;Ar+=2,yr=Ar+1)tr+="l "+(rr+Ar)+" "+(rr+yr)+`
`;rr+=_r}function pr(gr){let _r=0;const mr=gr.geometry,dr=mr.getAttribute("position"),vr=mr.getAttribute("color");if(tr+="o "+gr.name+`
`,dr!==void 0){for(let Ar=0,yr=dr.count;Ar<yr;Ar++,_r++)ar.fromBufferAttribute(dr,Ar),ar.applyMatrix4(gr.matrixWorld),tr+="v "+ar.x+" "+ar.y+" "+ar.z,vr!==void 0&&(or.fromBufferAttribute(vr,Ar),ColorManagement.fromWorkingColorSpace(or,SRGBColorSpace),tr+=" "+or.r+" "+or.g+" "+or.b),tr+=`
`;tr+="p ";for(let Ar=1,yr=dr.count;Ar<=yr;Ar++)tr+=rr+Ar+" ";tr+=`
`}rr+=_r}return er.traverse(function(gr){gr.isMesh===!0&&fr(gr),gr.isLine===!0&&ur(gr),gr.isPoints===!0&&pr(gr)}),tr}}class PLYExporter{parse(er,tr,rr={}){function nr(Ar){er.traverse(function(yr){if(yr.isMesh===!0||yr.isPoints){const wr=yr,br=wr.geometry;br.hasAttribute("position")===!0&&Ar(wr,br)}})}rr=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},rr);const ar=rr.excludeAttributes;let or=!0,lr=!1,cr=!1,hr=!1,fr=0,ur=0;er.traverse(function(Ar){if(Ar.isMesh===!0){const wr=Ar.geometry,br=wr.getAttribute("position"),Sr=wr.getAttribute("normal"),xr=wr.getAttribute("uv"),Cr=wr.getAttribute("color"),Ir=wr.getIndex();if(br===void 0)return;fr+=br.count,ur+=Ir?Ir.count/3:br.count/3,Sr!==void 0&&(lr=!0),xr!==void 0&&(hr=!0),Cr!==void 0&&(cr=!0)}else if(Ar.isPoints){const wr=Ar.geometry,br=wr.getAttribute("position"),Sr=wr.getAttribute("normal"),xr=wr.getAttribute("color");fr+=br.count,Sr!==void 0&&(lr=!0),xr!==void 0&&(cr=!0),or=!1}});const pr=new Color;if(or=or&&ar.indexOf("index")===-1,lr=lr&&ar.indexOf("normal")===-1,cr=cr&&ar.indexOf("color")===-1,hr=hr&&ar.indexOf("uv")===-1,or&&ur!==Math.floor(ur))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;const gr=4;let _r=`ply
format ${rr.binary?rr.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0
element vertex ${fr}
property float x
property float y
property float z
`;lr===!0&&(_r+=`property float nx
property float ny
property float nz
`),hr===!0&&(_r+=`property float s
property float t
`),cr===!0&&(_r+=`property uchar red
property uchar green
property uchar blue
`),or===!0&&(_r+=`element face ${ur}
property list uchar int vertex_index
`),_r+=`end_header
`;const mr=new Vector3$1,dr=new Matrix3;let vr=null;if(rr.binary===!0){const Ar=new TextEncoder().encode(_r),yr=fr*(4*3+(lr?4*3:0)+(cr?3:0)+(hr?4*2:0)),wr=or?ur*(gr*3+1):0,br=new DataView(new ArrayBuffer(Ar.length+yr+wr));new Uint8Array(br.buffer).set(Ar,0);let Sr=Ar.length,xr=Ar.length+yr,Cr=0;nr(function(Ir,Rr){const Pr=Rr.getAttribute("position"),Fr=Rr.getAttribute("normal"),Nr=Rr.getAttribute("uv"),Ur=Rr.getAttribute("color"),Br=Rr.getIndex();dr.getNormalMatrix(Ir.matrixWorld);for(let Or=0,Dr=Pr.count;Or<Dr;Or++)mr.fromBufferAttribute(Pr,Or),mr.applyMatrix4(Ir.matrixWorld),br.setFloat32(Sr,mr.x,rr.littleEndian),Sr+=4,br.setFloat32(Sr,mr.y,rr.littleEndian),Sr+=4,br.setFloat32(Sr,mr.z,rr.littleEndian),Sr+=4,lr===!0&&(Fr!=null?(mr.fromBufferAttribute(Fr,Or),mr.applyMatrix3(dr).normalize(),br.setFloat32(Sr,mr.x,rr.littleEndian),Sr+=4,br.setFloat32(Sr,mr.y,rr.littleEndian),Sr+=4,br.setFloat32(Sr,mr.z,rr.littleEndian),Sr+=4):(br.setFloat32(Sr,0,rr.littleEndian),Sr+=4,br.setFloat32(Sr,0,rr.littleEndian),Sr+=4,br.setFloat32(Sr,0,rr.littleEndian),Sr+=4)),hr===!0&&(Nr!=null?(br.setFloat32(Sr,Nr.getX(Or),rr.littleEndian),Sr+=4,br.setFloat32(Sr,Nr.getY(Or),rr.littleEndian),Sr+=4):(br.setFloat32(Sr,0,rr.littleEndian),Sr+=4,br.setFloat32(Sr,0,rr.littleEndian),Sr+=4)),cr===!0&&(Ur!=null?(pr.fromBufferAttribute(Ur,Or),ColorManagement.fromWorkingColorSpace(pr,SRGBColorSpace),br.setUint8(Sr,Math.floor(pr.r*255)),Sr+=1,br.setUint8(Sr,Math.floor(pr.g*255)),Sr+=1,br.setUint8(Sr,Math.floor(pr.b*255)),Sr+=1):(br.setUint8(Sr,255),Sr+=1,br.setUint8(Sr,255),Sr+=1,br.setUint8(Sr,255),Sr+=1));if(or===!0)if(Br!==null)for(let Or=0,Dr=Br.count;Or<Dr;Or+=3)br.setUint8(xr,3),xr+=1,br.setUint32(xr,Br.getX(Or+0)+Cr,rr.littleEndian),xr+=gr,br.setUint32(xr,Br.getX(Or+1)+Cr,rr.littleEndian),xr+=gr,br.setUint32(xr,Br.getX(Or+2)+Cr,rr.littleEndian),xr+=gr;else for(let Or=0,Dr=Pr.count;Or<Dr;Or+=3)br.setUint8(xr,3),xr+=1,br.setUint32(xr,Cr+Or,rr.littleEndian),xr+=gr,br.setUint32(xr,Cr+Or+1,rr.littleEndian),xr+=gr,br.setUint32(xr,Cr+Or+2,rr.littleEndian),xr+=gr;Cr+=Pr.count}),vr=br.buffer}else{let Ar=0,yr="",wr="";nr(function(br,Sr){const xr=Sr.getAttribute("position"),Cr=Sr.getAttribute("normal"),Ir=Sr.getAttribute("uv"),Rr=Sr.getAttribute("color"),Pr=Sr.getIndex();dr.getNormalMatrix(br.matrixWorld);for(let Fr=0,Nr=xr.count;Fr<Nr;Fr++){mr.fromBufferAttribute(xr,Fr),mr.applyMatrix4(br.matrixWorld);let Ur=mr.x+" "+mr.y+" "+mr.z;lr===!0&&(Cr!=null?(mr.fromBufferAttribute(Cr,Fr),mr.applyMatrix3(dr).normalize(),Ur+=" "+mr.x+" "+mr.y+" "+mr.z):Ur+=" 0 0 0"),hr===!0&&(Ir!=null?Ur+=" "+Ir.getX(Fr)+" "+Ir.getY(Fr):Ur+=" 0 0"),cr===!0&&(Rr!=null?(pr.fromBufferAttribute(Rr,Fr),ColorManagement.fromWorkingColorSpace(pr,SRGBColorSpace),Ur+=" "+Math.floor(pr.r*255)+" "+Math.floor(pr.g*255)+" "+Math.floor(pr.b*255)):Ur+=" 255 255 255"),yr+=Ur+`
`}if(or===!0){if(Pr!==null)for(let Fr=0,Nr=Pr.count;Fr<Nr;Fr+=3)wr+=`3 ${Pr.getX(Fr+0)+Ar}`,wr+=` ${Pr.getX(Fr+1)+Ar}`,wr+=` ${Pr.getX(Fr+2)+Ar}
`;else for(let Fr=0,Nr=xr.count;Fr<Nr;Fr+=3)wr+=`3 ${Ar+Fr} ${Ar+Fr+1} ${Ar+Fr+2}
`;ur+=Pr?Pr.count/3:xr.count/3}Ar+=xr.count}),vr=`${_r}${yr}${or?`${wr}
`:`
`}`}return typeof tr=="function"&&requestAnimationFrame(()=>tr(vr)),vr}}class STLExporter{parse(er,tr={}){tr=Object.assign({binary:!1},tr);const rr=tr.binary,nr=[];let sr=0;er.traverse(function(dr){if(dr.isMesh){const vr=dr.geometry,Ar=vr.index,yr=vr.getAttribute("position");sr+=Ar!==null?Ar.count/3:yr.count/3,nr.push({object3d:dr,geometry:vr})}});let ar,or=80;if(rr===!0){const dr=sr*2+sr*3*4*4+80+4,vr=new ArrayBuffer(dr);ar=new DataView(vr),ar.setUint32(or,sr,!0),or+=4}else ar="",ar+=`solid exported
`;const lr=new Vector3$1,cr=new Vector3$1,hr=new Vector3$1,fr=new Vector3$1,ur=new Vector3$1,pr=new Vector3$1;for(let dr=0,vr=nr.length;dr<vr;dr++){const Ar=nr[dr].object3d,yr=nr[dr].geometry,wr=yr.index,br=yr.getAttribute("position");if(wr!==null)for(let Sr=0;Sr<wr.count;Sr+=3){const xr=wr.getX(Sr+0),Cr=wr.getX(Sr+1),Ir=wr.getX(Sr+2);gr(xr,Cr,Ir,br,Ar)}else for(let Sr=0;Sr<br.count;Sr+=3){const xr=Sr+0,Cr=Sr+1,Ir=Sr+2;gr(xr,Cr,Ir,br,Ar)}}return rr===!1&&(ar+=`endsolid exported
`),ar;function gr(dr,vr,Ar,yr,wr){lr.fromBufferAttribute(yr,dr),cr.fromBufferAttribute(yr,vr),hr.fromBufferAttribute(yr,Ar),wr.isSkinnedMesh===!0&&(wr.applyBoneTransform(dr,lr),wr.applyBoneTransform(vr,cr),wr.applyBoneTransform(Ar,hr)),lr.applyMatrix4(wr.matrixWorld),cr.applyMatrix4(wr.matrixWorld),hr.applyMatrix4(wr.matrixWorld),_r(lr,cr,hr),mr(lr),mr(cr),mr(hr),rr===!0?(ar.setUint16(or,0,!0),or+=2):(ar+=`		endloop
`,ar+=`	endfacet
`)}function _r(dr,vr,Ar){fr.subVectors(Ar,vr),ur.subVectors(dr,vr),fr.cross(ur).normalize(),pr.copy(fr).normalize(),rr===!0?(ar.setFloat32(or,pr.x,!0),or+=4,ar.setFloat32(or,pr.y,!0),or+=4,ar.setFloat32(or,pr.z,!0),or+=4):(ar+="	facet normal "+pr.x+" "+pr.y+" "+pr.z+`
`,ar+=`		outer loop
`)}function mr(dr){rr===!0?(ar.setFloat32(or,dr.x,!0),or+=4,ar.setFloat32(or,dr.y,!0),or+=4,ar.setFloat32(or,dr.z,!0),or+=4):ar+="			vertex "+dr.x+" "+dr.y+" "+dr.z+`
`}}}class USDZExporter{constructor(){this.textureUtils=null}setTextureUtils(er){this.textureUtils=er}parse(er,tr,rr,nr){this.parseAsync(er,nr).then(tr).catch(rr)}async parseAsync(er,tr={}){tr=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},includeAnchoringProperties:!0,quickLookCompatible:!1,maxTextureSize:1024},tr);const rr={},nr="model.usda";rr[nr]=null;let sr=buildHeader();sr+=buildSceneStart(tr);const ar={},or={};er.traverseVisible(cr=>{if(cr.isMesh){const hr=cr.geometry,fr=cr.material;if(fr.isMeshStandardMaterial){const ur="geometries/Geometry_"+hr.id+".usda";if(!(ur in rr)){const pr=buildMeshObject(hr);rr[ur]=buildUSDFileAsString(pr)}fr.uuid in ar||(ar[fr.uuid]=fr),sr+=buildXform(cr,hr,fr)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",cr)}else cr.isCamera&&(sr+=buildCamera(cr))}),sr+=buildSceneEnd(),sr+=buildMaterials(ar,or,tr.quickLookCompatible),rr[nr]=strToU8(sr),sr=null;for(const cr in or){let hr=or[cr];if(hr.isCompressedTexture===!0){if(this.textureUtils===null)throw new Error("THREE.USDZExporter: setTextureUtils() must be called to process compressed textures.");hr=await this.textureUtils.decompress(hr)}const fr=imageToCanvas(hr.image,hr.flipY,tr.maxTextureSize),ur=await new Promise(pr=>fr.toBlob(pr,"image/png",1));rr[`textures/Texture_${cr}.png`]=new Uint8Array(await ur.arrayBuffer())}let lr=0;for(const cr in rr){const hr=rr[cr],fr=34+cr.length;lr+=fr;const ur=lr&63;if(ur!==4){const pr=64-ur,gr=new Uint8Array(pr);rr[cr]=[hr,{extra:{12345:gr}}]}lr=hr.length}return zipSync(rr,{level:0})}}function imageToCanvas(ir,er,tr){if(typeof HTMLImageElement<"u"&&ir instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ir instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&ir instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&ir instanceof ImageBitmap){const rr=tr/Math.max(ir.width,ir.height),nr=document.createElement("canvas");nr.width=ir.width*Math.min(1,rr),nr.height=ir.height*Math.min(1,rr);const sr=nr.getContext("2d");return er===!0&&(sr.translate(0,nr.height),sr.scale(1,-1)),sr.drawImage(ir,0,0,nr.width,nr.height),nr}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const PRECISION=7;function buildHeader(){return`#usda 1.0
(
	customLayerData = {
		string creator = "Three.js USDZExporter"
	}
	defaultPrim = "Root"
	metersPerUnit = 1
	upAxis = "Y"
)

`}function buildSceneStart(ir){return`def Xform "Root"
{
	def Scope "Scenes" (
		kind = "sceneLibrary"
	)
	{
		def Xform "Scene" (
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)
		{${ir.includeAnchoringProperties===!0?`
		token preliminary:anchoring:type = "${ir.ar.anchoring.type}"
		token preliminary:planeAnchoring:alignment = "${ir.ar.planeAnchoring.alignment}"
	`:""}
`}function buildSceneEnd(){return`
		}
	}
}

`}function buildUSDFileAsString(ir){let er=buildHeader();return er+=ir,strToU8(er)}function buildXform(ir,er,tr){const rr="Object_"+ir.id,nr=buildMatrix(ir.matrixWorld);return ir.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",ir),`def Xform "${rr}" (
	prepend references = @./geometries/Geometry_${er.id}.usda@</Geometry>
	prepend apiSchemas = ["MaterialBindingAPI"]
)
{
	matrix4d xformOp:transform = ${nr}
	uniform token[] xformOpOrder = ["xformOp:transform"]

	rel material:binding = </Materials/Material_${tr.id}>
}

`}function buildMatrix(ir){const er=ir.elements;return`( ${buildMatrixRow(er,0)}, ${buildMatrixRow(er,4)}, ${buildMatrixRow(er,8)}, ${buildMatrixRow(er,12)} )`}function buildMatrixRow(ir,er){return`(${ir[er+0]}, ${ir[er+1]}, ${ir[er+2]}, ${ir[er+3]})`}function buildMeshObject(ir){return`
def "Geometry"
{
${buildMesh(ir)}
}
`}function buildMesh(ir){const er="Geometry",tr=ir.attributes,rr=tr.position.count;return`
	def Mesh "${er}"
	{
		int[] faceVertexCounts = [${buildMeshVertexCount(ir)}]
		int[] faceVertexIndices = [${buildMeshVertexIndices(ir)}]
		normal3f[] normals = [${buildVector3Array(tr.normal,rr)}] (
			interpolation = "vertex"
		)
		point3f[] points = [${buildVector3Array(tr.position,rr)}]
${buildPrimvars(tr)}
		uniform token subdivisionScheme = "none"
	}
`}function buildMeshVertexCount(ir){const er=ir.index!==null?ir.index.count:ir.attributes.position.count;return Array(er/3).fill(3).join(", ")}function buildMeshVertexIndices(ir){const er=ir.index,tr=[];if(er!==null)for(let rr=0;rr<er.count;rr++)tr.push(er.getX(rr));else{const rr=ir.attributes.position.count;for(let nr=0;nr<rr;nr++)tr.push(nr)}return tr.join(", ")}function buildVector3Array(ir,er){if(ir===void 0)return console.warn("USDZExporter: Normals missing."),Array(er).fill("(0, 0, 0)").join(", ");const tr=[];for(let rr=0;rr<ir.count;rr++){const nr=ir.getX(rr),sr=ir.getY(rr),ar=ir.getZ(rr);tr.push(`(${nr.toPrecision(PRECISION)}, ${sr.toPrecision(PRECISION)}, ${ar.toPrecision(PRECISION)})`)}return tr.join(", ")}function buildVector2Array(ir){const er=[];for(let tr=0;tr<ir.count;tr++){const rr=ir.getX(tr),nr=ir.getY(tr);er.push(`(${rr.toPrecision(PRECISION)}, ${1-nr.toPrecision(PRECISION)})`)}return er.join(", ")}function buildPrimvars(ir){let er="";for(let rr=0;rr<4;rr++){const nr=rr>0?rr:"",sr=ir["uv"+nr];sr!==void 0&&(er+=`
		texCoord2f[] primvars:st${nr} = [${buildVector2Array(sr)}] (
			interpolation = "vertex"
		)`)}const tr=ir.color;if(tr!==void 0){const rr=tr.count;er+=`
	color3f[] primvars:displayColor = [${buildVector3Array(tr,rr)}] (
		interpolation = "vertex"
		)`}return er}function buildMaterials(ir,er,tr=!1){const rr=[];for(const nr in ir){const sr=ir[nr];rr.push(buildMaterial(sr,er,tr))}return`def "Materials"
{
${rr.join("")}
}

`}function buildMaterial(ir,er,tr=!1){const rr="			",nr=[],sr=[];function ar(or,lr,cr){const hr=or.source.id+"_"+or.flipY;er[hr]=or;const fr=or.channel>0?"st"+or.channel:"st",ur={1e3:"repeat",1001:"clamp",1002:"mirror"},pr=or.repeat.clone(),gr=or.offset.clone(),_r=or.rotation,mr=Math.sin(_r),dr=Math.cos(_r);return gr.y=1-gr.y-pr.y,tr?(gr.x=gr.x/pr.x,gr.y=gr.y/pr.y,gr.x+=mr/pr.x,gr.y+=dr-1):(gr.x+=mr*pr.x,gr.y+=(1-dr)*pr.y),`
		def Shader "PrimvarReader_${lr}"
		{
			uniform token info:id = "UsdPrimvarReader_float2"
			float2 inputs:fallback = (0.0, 0.0)
			token inputs:varname = "${fr}"
			float2 outputs:result
		}

		def Shader "Transform2d_${lr}"
		{
			uniform token info:id = "UsdTransform2d"
			token inputs:in.connect = </Materials/Material_${ir.id}/PrimvarReader_${lr}.outputs:result>
			float inputs:rotation = ${(_r*(180/Math.PI)).toFixed(PRECISION)}
			float2 inputs:scale = ${buildVector2(pr)}
			float2 inputs:translation = ${buildVector2(gr)}
			float2 outputs:result
		}

		def Shader "Texture_${or.id}_${lr}"
		{
			uniform token info:id = "UsdUVTexture"
			asset inputs:file = @textures/Texture_${hr}.png@
			float2 inputs:st.connect = </Materials/Material_${ir.id}/Transform2d_${lr}.outputs:result>
			${cr!==void 0?"float4 inputs:scale = "+buildColor4(cr):""}
			token inputs:sourceColorSpace = "${or.colorSpace===NoColorSpace?"raw":"sRGB"}"
			token inputs:wrapS = "${ur[or.wrapS]}"
			token inputs:wrapT = "${ur[or.wrapT]}"
			float outputs:r
			float outputs:g
			float outputs:b
			float3 outputs:rgb
			${ir.transparent||ir.alphaTest>0?"float outputs:a":""}
		}`}return ir.side===DoubleSide&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",ir),ir.map!==null?(nr.push(`${rr}color3f inputs:diffuseColor.connect = </Materials/Material_${ir.id}/Texture_${ir.map.id}_diffuse.outputs:rgb>`),ir.transparent?nr.push(`${rr}float inputs:opacity.connect = </Materials/Material_${ir.id}/Texture_${ir.map.id}_diffuse.outputs:a>`):ir.alphaTest>0&&(nr.push(`${rr}float inputs:opacity.connect = </Materials/Material_${ir.id}/Texture_${ir.map.id}_diffuse.outputs:a>`),nr.push(`${rr}float inputs:opacityThreshold = ${ir.alphaTest}`)),sr.push(ar(ir.map,"diffuse",ir.color))):nr.push(`${rr}color3f inputs:diffuseColor = ${buildColor(ir.color)}`),ir.emissiveMap!==null?(nr.push(`${rr}color3f inputs:emissiveColor.connect = </Materials/Material_${ir.id}/Texture_${ir.emissiveMap.id}_emissive.outputs:rgb>`),sr.push(ar(ir.emissiveMap,"emissive",new Color(ir.emissive.r*ir.emissiveIntensity,ir.emissive.g*ir.emissiveIntensity,ir.emissive.b*ir.emissiveIntensity)))):ir.emissive.getHex()>0&&nr.push(`${rr}color3f inputs:emissiveColor = ${buildColor(ir.emissive)}`),ir.normalMap!==null&&(nr.push(`${rr}normal3f inputs:normal.connect = </Materials/Material_${ir.id}/Texture_${ir.normalMap.id}_normal.outputs:rgb>`),sr.push(ar(ir.normalMap,"normal"))),ir.aoMap!==null&&(nr.push(`${rr}float inputs:occlusion.connect = </Materials/Material_${ir.id}/Texture_${ir.aoMap.id}_occlusion.outputs:r>`),sr.push(ar(ir.aoMap,"occlusion",new Color(ir.aoMapIntensity,ir.aoMapIntensity,ir.aoMapIntensity)))),ir.roughnessMap!==null?(nr.push(`${rr}float inputs:roughness.connect = </Materials/Material_${ir.id}/Texture_${ir.roughnessMap.id}_roughness.outputs:g>`),sr.push(ar(ir.roughnessMap,"roughness",new Color(ir.roughness,ir.roughness,ir.roughness)))):nr.push(`${rr}float inputs:roughness = ${ir.roughness}`),ir.metalnessMap!==null?(nr.push(`${rr}float inputs:metallic.connect = </Materials/Material_${ir.id}/Texture_${ir.metalnessMap.id}_metallic.outputs:b>`),sr.push(ar(ir.metalnessMap,"metallic",new Color(ir.metalness,ir.metalness,ir.metalness)))):nr.push(`${rr}float inputs:metallic = ${ir.metalness}`),ir.alphaMap!==null?(nr.push(`${rr}float inputs:opacity.connect = </Materials/Material_${ir.id}/Texture_${ir.alphaMap.id}_opacity.outputs:r>`),nr.push(`${rr}float inputs:opacityThreshold = 0.0001`),sr.push(ar(ir.alphaMap,"opacity"))):nr.push(`${rr}float inputs:opacity = ${ir.opacity}`),ir.isMeshPhysicalMaterial&&(ir.clearcoatMap!==null?(nr.push(`${rr}float inputs:clearcoat.connect = </Materials/Material_${ir.id}/Texture_${ir.clearcoatMap.id}_clearcoat.outputs:r>`),sr.push(ar(ir.clearcoatMap,"clearcoat",new Color(ir.clearcoat,ir.clearcoat,ir.clearcoat)))):nr.push(`${rr}float inputs:clearcoat = ${ir.clearcoat}`),ir.clearcoatRoughnessMap!==null?(nr.push(`${rr}float inputs:clearcoatRoughness.connect = </Materials/Material_${ir.id}/Texture_${ir.clearcoatRoughnessMap.id}_clearcoatRoughness.outputs:g>`),sr.push(ar(ir.clearcoatRoughnessMap,"clearcoatRoughness",new Color(ir.clearcoatRoughness,ir.clearcoatRoughness,ir.clearcoatRoughness)))):nr.push(`${rr}float inputs:clearcoatRoughness = ${ir.clearcoatRoughness}`),nr.push(`${rr}float inputs:ior = ${ir.ior}`)),`
	def Material "Material_${ir.id}"
	{
		def Shader "PreviewSurface"
		{
			uniform token info:id = "UsdPreviewSurface"
${nr.join(`
`)}
			int inputs:useSpecularWorkflow = 0
			token outputs:surface
		}

		token outputs:surface.connect = </Materials/Material_${ir.id}/PreviewSurface.outputs:surface>

${sr.join(`
`)}

	}
`}function buildColor(ir){return`(${ir.r}, ${ir.g}, ${ir.b})`}function buildColor4(ir){return`(${ir.r}, ${ir.g}, ${ir.b}, 1.0)`}function buildVector2(ir){return`(${ir.x}, ${ir.y})`}function buildCamera(ir){const er=ir.name?ir.name:"Camera_"+ir.id,tr=buildMatrix(ir.matrixWorld);return ir.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",ir),ir.isOrthographicCamera?`def Camera "${er}"
		{
			matrix4d xformOp:transform = ${tr}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${ir.near.toPrecision(PRECISION)}, ${ir.far.toPrecision(PRECISION)})
			float horizontalAperture = ${((Math.abs(ir.left)+Math.abs(ir.right))*10).toPrecision(PRECISION)}
			float verticalAperture = ${((Math.abs(ir.top)+Math.abs(ir.bottom))*10).toPrecision(PRECISION)}
			token projection = "orthographic"
		}
	
	`:`def Camera "${er}"
		{
			matrix4d xformOp:transform = ${tr}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${ir.near.toPrecision(PRECISION)}, ${ir.far.toPrecision(PRECISION)})
			float focalLength = ${ir.getFocalLength().toPrecision(PRECISION)}
			float focusDistance = ${ir.focus.toPrecision(PRECISION)}
			float horizontalAperture = ${ir.getFilmWidth().toPrecision(PRECISION)}
			token projection = "perspective"
			float verticalAperture = ${ir.getFilmHeight().toPrecision(PRECISION)}
		}
	
	`}class BoxLineGeometry extends BufferGeometry{constructor(er=1,tr=1,rr=1,nr=1,sr=1,ar=1){super(),nr=Math.floor(nr),sr=Math.floor(sr),ar=Math.floor(ar);const or=er/2,lr=tr/2,cr=rr/2,hr=er/nr,fr=tr/sr,ur=rr/ar,pr=[];let gr=-or,_r=-lr,mr=-cr;for(let dr=0;dr<=nr;dr++)pr.push(gr,-lr,-cr,gr,lr,-cr),pr.push(gr,lr,-cr,gr,lr,cr),pr.push(gr,lr,cr,gr,-lr,cr),pr.push(gr,-lr,cr,gr,-lr,-cr),gr+=hr;for(let dr=0;dr<=sr;dr++)pr.push(-or,_r,-cr,or,_r,-cr),pr.push(or,_r,-cr,or,_r,cr),pr.push(or,_r,cr,-or,_r,cr),pr.push(-or,_r,cr,-or,_r,-cr),_r+=fr;for(let dr=0;dr<=ar;dr++)pr.push(-or,-lr,mr,-or,lr,mr),pr.push(-or,lr,mr,or,lr,mr),pr.push(or,lr,mr,or,-lr,mr),pr.push(or,-lr,mr,-or,-lr,mr),mr+=ur;this.setAttribute("position",new Float32BufferAttribute(pr,3))}}const Visible=0,Deleted=1,_v1$4=new Vector3$1,_line3=new Line3,_plane$1=new Plane,_closestPoint$1=new Vector3$1,_triangle=new Triangle$2;class ConvexHull{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new VertexList,this.unassigned=new VertexList,this.vertices=[]}setFromPoints(er){if(er.length>=4){this.makeEmpty();for(let tr=0,rr=er.length;tr<rr;tr++)this.vertices.push(new VertexNode(er[tr]));this.compute()}return this}setFromObject(er){const tr=[];return er.updateMatrixWorld(!0),er.traverse(function(rr){const nr=rr.geometry;if(nr!==void 0){const sr=nr.attributes.position;if(sr!==void 0)for(let ar=0,or=sr.count;ar<or;ar++){const lr=new Vector3$1;lr.fromBufferAttribute(sr,ar).applyMatrix4(rr.matrixWorld),tr.push(lr)}}}),this.setFromPoints(tr)}containsPoint(er){const tr=this.faces;for(let rr=0,nr=tr.length;rr<nr;rr++)if(tr[rr].distanceToPoint(er)>this.tolerance)return!1;return!0}intersectRay(er,tr){const rr=this.faces;let nr=-1/0,sr=1/0;for(let ar=0,or=rr.length;ar<or;ar++){const lr=rr[ar],cr=lr.distanceToPoint(er.origin),hr=lr.normal.dot(er.direction);if(cr>0&&hr>=0)return null;const fr=hr!==0?-cr/hr:0;if(!(fr<=0)&&(hr>0?sr=Math.min(fr,sr):nr=Math.max(fr,nr),nr>sr))return null}return nr!==-1/0?er.at(nr,tr):er.at(sr,tr),tr}intersectsRay(er){return this.intersectRay(er,_v1$4)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(er,tr){return er.face=tr,tr.outside===null?this.assigned.append(er):this.assigned.insertBefore(tr.outside,er),tr.outside=er,this}removeVertexFromFace(er,tr){return er===tr.outside&&(er.next!==null&&er.next.face===tr?tr.outside=er.next:tr.outside=null),this.assigned.remove(er),this}removeAllVerticesFromFace(er){if(er.outside!==null){const tr=er.outside;let rr=er.outside;for(;rr.next!==null&&rr.next.face===er;)rr=rr.next;return this.assigned.removeSubList(tr,rr),tr.prev=rr.next=null,er.outside=null,tr}}deleteFaceVertices(er,tr){const rr=this.removeAllVerticesFromFace(er);if(rr!==void 0)if(tr===void 0)this.unassigned.appendChain(rr);else{let nr=rr;do{const sr=nr.next;tr.distanceToPoint(nr.point)>this.tolerance?this.addVertexToFace(nr,tr):this.unassigned.append(nr),nr=sr}while(nr!==null)}return this}resolveUnassignedPoints(er){if(this.unassigned.isEmpty()===!1){let tr=this.unassigned.first();do{const rr=tr.next;let nr=this.tolerance,sr=null;for(let ar=0;ar<er.length;ar++){const or=er[ar];if(or.mark===Visible){const lr=or.distanceToPoint(tr.point);if(lr>nr&&(nr=lr,sr=or),nr>1e3*this.tolerance)break}}sr!==null&&this.addVertexToFace(tr,sr),tr=rr}while(tr!==null)}return this}computeExtremes(){const er=new Vector3$1,tr=new Vector3$1,rr=[],nr=[];for(let sr=0;sr<3;sr++)rr[sr]=nr[sr]=this.vertices[0];er.copy(this.vertices[0].point),tr.copy(this.vertices[0].point);for(let sr=0,ar=this.vertices.length;sr<ar;sr++){const or=this.vertices[sr],lr=or.point;for(let cr=0;cr<3;cr++)lr.getComponent(cr)<er.getComponent(cr)&&(er.setComponent(cr,lr.getComponent(cr)),rr[cr]=or);for(let cr=0;cr<3;cr++)lr.getComponent(cr)>tr.getComponent(cr)&&(tr.setComponent(cr,lr.getComponent(cr)),nr[cr]=or)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(er.x),Math.abs(tr.x))+Math.max(Math.abs(er.y),Math.abs(tr.y))+Math.max(Math.abs(er.z),Math.abs(tr.z))),{min:rr,max:nr}}computeInitialHull(){const er=this.vertices,tr=this.computeExtremes(),rr=tr.min,nr=tr.max;let sr=0,ar=0;for(let ur=0;ur<3;ur++){const pr=nr[ur].point.getComponent(ur)-rr[ur].point.getComponent(ur);pr>sr&&(sr=pr,ar=ur)}const or=rr[ar],lr=nr[ar];let cr,hr;sr=0,_line3.set(or.point,lr.point);for(let ur=0,pr=this.vertices.length;ur<pr;ur++){const gr=er[ur];if(gr!==or&&gr!==lr){_line3.closestPointToPoint(gr.point,!0,_closestPoint$1);const _r=_closestPoint$1.distanceToSquared(gr.point);_r>sr&&(sr=_r,cr=gr)}}sr=-1,_plane$1.setFromCoplanarPoints(or.point,lr.point,cr.point);for(let ur=0,pr=this.vertices.length;ur<pr;ur++){const gr=er[ur];if(gr!==or&&gr!==lr&&gr!==cr){const _r=Math.abs(_plane$1.distanceToPoint(gr.point));_r>sr&&(sr=_r,hr=gr)}}const fr=[];if(_plane$1.distanceToPoint(hr.point)<0){fr.push(Face$1.create(or,lr,cr),Face$1.create(hr,lr,or),Face$1.create(hr,cr,lr),Face$1.create(hr,or,cr));for(let ur=0;ur<3;ur++){const pr=(ur+1)%3;fr[ur+1].getEdge(2).setTwin(fr[0].getEdge(pr)),fr[ur+1].getEdge(1).setTwin(fr[pr+1].getEdge(0))}}else{fr.push(Face$1.create(or,cr,lr),Face$1.create(hr,or,lr),Face$1.create(hr,lr,cr),Face$1.create(hr,cr,or));for(let ur=0;ur<3;ur++){const pr=(ur+1)%3;fr[ur+1].getEdge(2).setTwin(fr[0].getEdge((3-ur)%3)),fr[ur+1].getEdge(0).setTwin(fr[pr+1].getEdge(1))}}for(let ur=0;ur<4;ur++)this.faces.push(fr[ur]);for(let ur=0,pr=er.length;ur<pr;ur++){const gr=er[ur];if(gr!==or&&gr!==lr&&gr!==cr&&gr!==hr){sr=this.tolerance;let _r=null;for(let mr=0;mr<4;mr++){const dr=this.faces[mr].distanceToPoint(gr.point);dr>sr&&(sr=dr,_r=this.faces[mr])}_r!==null&&this.addVertexToFace(gr,_r)}}return this}reindexFaces(){const er=[];for(let tr=0;tr<this.faces.length;tr++){const rr=this.faces[tr];rr.mark===Visible&&er.push(rr)}return this.faces=er,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let er,tr=0;const rr=this.assigned.first().face;let nr=rr.outside;do{const sr=rr.distanceToPoint(nr.point);sr>tr&&(tr=sr,er=nr),nr=nr.next}while(nr!==null&&nr.face===rr);return er}}computeHorizon(er,tr,rr,nr){this.deleteFaceVertices(rr),rr.mark=Deleted;let sr;tr===null?sr=tr=rr.getEdge(0):sr=tr.next;do{const ar=sr.twin,or=ar.face;or.mark===Visible&&(or.distanceToPoint(er)>this.tolerance?this.computeHorizon(er,ar,or,nr):nr.push(sr)),sr=sr.next}while(sr!==tr);return this}addAdjoiningFace(er,tr){const rr=Face$1.create(er,tr.tail(),tr.head());return this.faces.push(rr),rr.getEdge(-1).setTwin(tr.twin),rr.getEdge(0)}addNewFaces(er,tr){this.newFaces=[];let rr=null,nr=null;for(let sr=0;sr<tr.length;sr++){const ar=tr[sr],or=this.addAdjoiningFace(er,ar);rr===null?rr=or:or.next.setTwin(nr),this.newFaces.push(or.face),nr=or}return rr.next.setTwin(nr),this}addVertexToHull(er){const tr=[];return this.unassigned.clear(),this.removeVertexFromFace(er,er.face),this.computeHorizon(er.point,null,er.face,tr),this.addNewFaces(er,tr),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let er;for(this.computeInitialHull();(er=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(er);return this.reindexFaces(),this.cleanup(),this}}let Face$1=class ho{constructor(){this.normal=new Vector3$1,this.midpoint=new Vector3$1,this.area=0,this.constant=0,this.outside=null,this.mark=Visible,this.edge=null}static create(er,tr,rr){const nr=new ho,sr=new HalfEdge(er,nr),ar=new HalfEdge(tr,nr),or=new HalfEdge(rr,nr);return sr.next=or.prev=ar,ar.next=sr.prev=or,or.next=ar.prev=sr,nr.edge=sr,nr.compute()}getEdge(er){let tr=this.edge;for(;er>0;)tr=tr.next,er--;for(;er<0;)tr=tr.prev,er++;return tr}compute(){const er=this.edge.tail(),tr=this.edge.head(),rr=this.edge.next.head();return _triangle.set(er.point,tr.point,rr.point),_triangle.getNormal(this.normal),_triangle.getMidpoint(this.midpoint),this.area=_triangle.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(er){return this.normal.dot(er)-this.constant}};class HalfEdge{constructor(er,tr){this.vertex=er,this.prev=null,this.next=null,this.twin=null,this.face=tr}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const er=this.head(),tr=this.tail();return tr!==null?tr.point.distanceTo(er.point):-1}lengthSquared(){const er=this.head(),tr=this.tail();return tr!==null?tr.point.distanceToSquared(er.point):-1}setTwin(er){return this.twin=er,er.twin=this,this}}class VertexNode{constructor(er){this.point=er,this.prev=null,this.next=null,this.face=null}}class VertexList{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(er,tr){return tr.prev=er.prev,tr.next=er,tr.prev===null?this.head=tr:tr.prev.next=tr,er.prev=tr,this}insertAfter(er,tr){return tr.prev=er,tr.next=er.next,tr.next===null?this.tail=tr:tr.next.prev=tr,er.next=tr,this}append(er){return this.head===null?this.head=er:this.tail.next=er,er.prev=this.tail,er.next=null,this.tail=er,this}appendChain(er){for(this.head===null?this.head=er:this.tail.next=er,er.prev=this.tail;er.next!==null;)er=er.next;return this.tail=er,this}remove(er){return er.prev===null?this.head=er.next:er.prev.next=er.next,er.next===null?this.tail=er.prev:er.next.prev=er.prev,this}removeSubList(er,tr){return er.prev===null?this.head=tr.next:er.prev.next=tr.next,tr.next===null?this.tail=er.prev:tr.next.prev=er.prev,this}isEmpty(){return this.head===null}}class ConvexGeometry extends BufferGeometry{constructor(er=[]){super();const tr=[],rr=[],sr=new ConvexHull().setFromPoints(er).faces;for(let ar=0;ar<sr.length;ar++){const or=sr[ar];let lr=or.edge;do{const cr=lr.head().point;tr.push(cr.x,cr.y,cr.z),rr.push(or.normal.x,or.normal.y,or.normal.z),lr=lr.next}while(lr!==or.edge)}this.setAttribute("position",new Float32BufferAttribute(tr,3)),this.setAttribute("normal",new Float32BufferAttribute(rr,3))}}class DecalGeometry extends BufferGeometry{constructor(er=new Mesh,tr=new Vector3$1,rr=new Euler,nr=new Vector3$1(1,1,1)){super();const sr=[],ar=[],or=[],lr=new Vector3$1,cr=new Matrix3().getNormalMatrix(er.matrixWorld),hr=new Matrix4;hr.makeRotationFromEuler(rr),hr.setPosition(tr);const fr=new Matrix4;fr.copy(hr).invert(),ur(),this.setAttribute("position",new Float32BufferAttribute(sr,3)),this.setAttribute("uv",new Float32BufferAttribute(or,2)),ar.length>0&&this.setAttribute("normal",new Float32BufferAttribute(ar,3));function ur(){let mr=[];const dr=new Vector3$1,vr=new Vector3$1,Ar=er.geometry,yr=Ar.attributes.position,wr=Ar.attributes.normal;if(Ar.index!==null){const br=Ar.index;for(let Sr=0;Sr<br.count;Sr++)dr.fromBufferAttribute(yr,br.getX(Sr)),wr?(vr.fromBufferAttribute(wr,br.getX(Sr)),pr(mr,dr,vr)):pr(mr,dr)}else{if(yr===void 0)return;for(let br=0;br<yr.count;br++)dr.fromBufferAttribute(yr,br),wr?(vr.fromBufferAttribute(wr,br),pr(mr,dr,vr)):pr(mr,dr)}mr=gr(mr,lr.set(1,0,0)),mr=gr(mr,lr.set(-1,0,0)),mr=gr(mr,lr.set(0,1,0)),mr=gr(mr,lr.set(0,-1,0)),mr=gr(mr,lr.set(0,0,1)),mr=gr(mr,lr.set(0,0,-1));for(let br=0;br<mr.length;br++){const Sr=mr[br];or.push(.5+Sr.position.x/nr.x,.5+Sr.position.y/nr.y),Sr.position.applyMatrix4(hr),sr.push(Sr.position.x,Sr.position.y,Sr.position.z),Sr.normal!==null&&ar.push(Sr.normal.x,Sr.normal.y,Sr.normal.z)}}function pr(mr,dr,vr=null){dr.applyMatrix4(er.matrixWorld),dr.applyMatrix4(fr),vr?(vr.applyNormalMatrix(cr),mr.push(new DecalVertex(dr.clone(),vr.clone()))):mr.push(new DecalVertex(dr.clone()))}function gr(mr,dr){const vr=[],Ar=.5*Math.abs(nr.dot(dr));for(let yr=0;yr<mr.length;yr+=3){let wr=0,br,Sr,xr,Cr;const Ir=mr[yr+0].position.dot(dr)-Ar,Rr=mr[yr+1].position.dot(dr)-Ar,Pr=mr[yr+2].position.dot(dr)-Ar,Fr=Ir>0,Nr=Rr>0,Ur=Pr>0;switch(wr=(Fr?1:0)+(Nr?1:0)+(Ur?1:0),wr){case 0:{vr.push(mr[yr]),vr.push(mr[yr+1]),vr.push(mr[yr+2]);break}case 1:{if(Fr&&(br=mr[yr+1],Sr=mr[yr+2],xr=_r(mr[yr],br,dr,Ar),Cr=_r(mr[yr],Sr,dr,Ar)),Nr){br=mr[yr],Sr=mr[yr+2],xr=_r(mr[yr+1],br,dr,Ar),Cr=_r(mr[yr+1],Sr,dr,Ar),vr.push(xr),vr.push(Sr.clone()),vr.push(br.clone()),vr.push(Sr.clone()),vr.push(xr.clone()),vr.push(Cr);break}Ur&&(br=mr[yr],Sr=mr[yr+1],xr=_r(mr[yr+2],br,dr,Ar),Cr=_r(mr[yr+2],Sr,dr,Ar)),vr.push(br.clone()),vr.push(Sr.clone()),vr.push(xr),vr.push(Cr),vr.push(xr.clone()),vr.push(Sr.clone());break}case 2:{Fr||(br=mr[yr].clone(),Sr=_r(br,mr[yr+1],dr,Ar),xr=_r(br,mr[yr+2],dr,Ar),vr.push(br),vr.push(Sr),vr.push(xr)),Nr||(br=mr[yr+1].clone(),Sr=_r(br,mr[yr+2],dr,Ar),xr=_r(br,mr[yr],dr,Ar),vr.push(br),vr.push(Sr),vr.push(xr)),Ur||(br=mr[yr+2].clone(),Sr=_r(br,mr[yr],dr,Ar),xr=_r(br,mr[yr+1],dr,Ar),vr.push(br),vr.push(Sr),vr.push(xr));break}case 3:break}}return vr}function _r(mr,dr,vr,Ar){const yr=mr.position.dot(vr)-Ar,wr=dr.position.dot(vr)-Ar,br=yr/(yr-wr),Sr=new Vector3$1(mr.position.x+br*(dr.position.x-mr.position.x),mr.position.y+br*(dr.position.y-mr.position.y),mr.position.z+br*(dr.position.z-mr.position.z));let xr=null;return mr.normal!==null&&dr.normal!==null&&(xr=new Vector3$1(mr.normal.x+br*(dr.normal.x-mr.normal.x),mr.normal.y+br*(dr.normal.y-mr.normal.y),mr.normal.z+br*(dr.normal.z-mr.normal.z))),new DecalVertex(Sr,xr)}}}class DecalVertex{constructor(er,tr=null){this.position=er,this.normal=tr}clone(){const er=this.position.clone(),tr=this.normal!==null?this.normal.clone():null;return new this.constructor(er,tr)}}class ParametricGeometry extends BufferGeometry{constructor(er=(nr,sr,ar)=>ar.set(nr,sr,Math.cos(nr)*Math.sin(sr)),tr=8,rr=8){super(),this.type="ParametricGeometry",this.parameters={func:er,slices:tr,stacks:rr};const nr=[],sr=[],ar=[],or=[],lr=1e-5,cr=new Vector3$1,hr=new Vector3$1,fr=new Vector3$1,ur=new Vector3$1,pr=new Vector3$1,gr=tr+1;for(let _r=0;_r<=rr;_r++){const mr=_r/rr;for(let dr=0;dr<=tr;dr++){const vr=dr/tr;er(vr,mr,hr),sr.push(hr.x,hr.y,hr.z),vr-lr>=0?(er(vr-lr,mr,fr),ur.subVectors(hr,fr)):(er(vr+lr,mr,fr),ur.subVectors(fr,hr)),mr-lr>=0?(er(vr,mr-lr,fr),pr.subVectors(hr,fr)):(er(vr,mr+lr,fr),pr.subVectors(fr,hr)),cr.crossVectors(ur,pr).normalize(),ar.push(cr.x,cr.y,cr.z),or.push(vr,mr)}}for(let _r=0;_r<rr;_r++)for(let mr=0;mr<tr;mr++){const dr=_r*gr+mr,vr=_r*gr+mr+1,Ar=(_r+1)*gr+mr+1,yr=(_r+1)*gr+mr;nr.push(dr,vr,yr),nr.push(vr,Ar,yr)}this.setIndex(nr),this.setAttribute("position",new Float32BufferAttribute(sr,3)),this.setAttribute("normal",new Float32BufferAttribute(ar,3)),this.setAttribute("uv",new Float32BufferAttribute(or,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}}const ParametricGeometries={klein:function(ir,er,tr){er*=Math.PI,ir*=2*Math.PI,er=er*2;let rr,nr;er<Math.PI?(rr=3*Math.cos(er)*(1+Math.sin(er))+2*(1-Math.cos(er)/2)*Math.cos(er)*Math.cos(ir),nr=-8*Math.sin(er)-2*(1-Math.cos(er)/2)*Math.sin(er)*Math.cos(ir)):(rr=3*Math.cos(er)*(1+Math.sin(er))+2*(1-Math.cos(er)/2)*Math.cos(ir+Math.PI),nr=-8*Math.sin(er));const sr=-2*(1-Math.cos(er)/2)*Math.sin(ir);tr.set(rr,sr,nr)},plane:function(ir,er){return function(tr,rr,nr){const sr=tr*ir,ar=0,or=rr*er;nr.set(sr,ar,or)}},mobius:function(ir,er,tr){ir=ir-.5;const rr=2*Math.PI*er,nr=2,sr=Math.cos(rr)*(nr+ir*Math.cos(rr/2)),ar=Math.sin(rr)*(nr+ir*Math.cos(rr/2)),or=ir*Math.sin(rr/2);tr.set(sr,ar,or)},mobius3d:function(ir,er,tr){ir*=Math.PI,er*=2*Math.PI,ir=ir*2;const rr=ir/2,nr=2.25,sr=.125,ar=.65;let or=sr*Math.cos(er)*Math.cos(rr)-ar*Math.sin(er)*Math.sin(rr);const lr=sr*Math.cos(er)*Math.sin(rr)+ar*Math.sin(er)*Math.cos(rr),cr=(nr+or)*Math.sin(ir);or=(nr+or)*Math.cos(ir),tr.set(or,cr,lr)}};ParametricGeometries.TubeGeometry=class extends ParametricGeometry{constructor(er,tr=64,rr=1,nr=8,sr=!1){const ar=tr+1,or=er.computeFrenetFrames(tr,sr),lr=or.tangents,cr=or.normals,hr=or.binormals,fr=new Vector3$1;function ur(pr,gr,_r){gr*=2*Math.PI;const mr=Math.floor(pr*(ar-1));er.getPointAt(pr,fr);const dr=cr[mr],vr=hr[mr],Ar=-rr*Math.cos(gr),yr=rr*Math.sin(gr);fr.x+=Ar*dr.x+yr*vr.x,fr.y+=Ar*dr.y+yr*vr.y,fr.z+=Ar*dr.z+yr*vr.z,_r.copy(fr)}super(ur,tr,nr),this.tangents=lr,this.normals=cr,this.binormals=hr,this.path=er,this.segments=tr,this.radius=rr,this.segmentsRadius=nr,this.closed=sr}};ParametricGeometries.TorusKnotGeometry=class extends ParametricGeometries.TubeGeometry{constructor(er=200,tr=40,rr=64,nr=8,sr=2,ar=3){class or extends Curve{getPoint(ur,pr=new Vector3$1){const gr=pr;ur*=Math.PI*2;const _r=.5,mr=(1+_r*Math.cos(ar*ur))*Math.cos(sr*ur),dr=(1+_r*Math.cos(ar*ur))*Math.sin(sr*ur),vr=_r*Math.sin(ar*ur);return gr.set(mr,dr,vr).multiplyScalar(er)}}const lr=rr,cr=nr,hr=new or;super(hr,lr,tr,cr,!0,!1),this.radius=er,this.tube=tr,this.segmentsT=rr,this.segmentsR=nr,this.p=sr,this.q=ar}};ParametricGeometries.SphereGeometry=class extends ParametricGeometry{constructor(er,tr,rr){function nr(sr,ar,or){sr*=Math.PI,ar*=2*Math.PI;const lr=er*Math.sin(sr)*Math.cos(ar),cr=er*Math.sin(sr)*Math.sin(ar),hr=er*Math.cos(sr);or.set(lr,cr,hr)}super(nr,tr,rr)}};ParametricGeometries.PlaneGeometry=class extends ParametricGeometry{constructor(er,tr,rr,nr){function sr(ar,or,lr){const cr=ar*er,hr=0,fr=or*tr;lr.set(cr,hr,fr)}super(sr,rr,nr)}};const _tempNormal=new Vector3$1;function getUv(ir,er,tr,rr,nr,sr){const ar=2*Math.PI*nr/4,or=Math.max(sr-2*nr,0),lr=Math.PI/4;_tempNormal.copy(er),_tempNormal[rr]=0,_tempNormal.normalize();const cr=.5*ar/(ar+or),hr=1-_tempNormal.angleTo(ir)/lr;return Math.sign(_tempNormal[tr])===1?hr*cr:or/(ar+or)+cr+cr*(1-hr)}class RoundedBoxGeometry extends BoxGeometry{constructor(er=1,tr=1,rr=1,nr=2,sr=.1){if(nr=nr*2+1,sr=Math.min(er/2,tr/2,rr/2,sr),super(1,1,1,nr,nr,nr),nr===1)return;const ar=this.toNonIndexed();this.index=null,this.attributes.position=ar.attributes.position,this.attributes.normal=ar.attributes.normal,this.attributes.uv=ar.attributes.uv;const or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1(er,tr,rr).divideScalar(2).subScalar(sr),hr=this.attributes.position.array,fr=this.attributes.normal.array,ur=this.attributes.uv.array,pr=hr.length/6,gr=new Vector3$1,_r=.5/nr;for(let mr=0,dr=0;mr<hr.length;mr+=3,dr+=2)switch(or.fromArray(hr,mr),lr.copy(or),lr.x-=Math.sign(lr.x)*_r,lr.y-=Math.sign(lr.y)*_r,lr.z-=Math.sign(lr.z)*_r,lr.normalize(),hr[mr+0]=cr.x*Math.sign(or.x)+lr.x*sr,hr[mr+1]=cr.y*Math.sign(or.y)+lr.y*sr,hr[mr+2]=cr.z*Math.sign(or.z)+lr.z*sr,fr[mr+0]=lr.x,fr[mr+1]=lr.y,fr[mr+2]=lr.z,Math.floor(mr/pr)){case 0:gr.set(1,0,0),ur[dr+0]=getUv(gr,lr,"z","y",sr,rr),ur[dr+1]=1-getUv(gr,lr,"y","z",sr,tr);break;case 1:gr.set(-1,0,0),ur[dr+0]=1-getUv(gr,lr,"z","y",sr,rr),ur[dr+1]=1-getUv(gr,lr,"y","z",sr,tr);break;case 2:gr.set(0,1,0),ur[dr+0]=1-getUv(gr,lr,"x","z",sr,er),ur[dr+1]=getUv(gr,lr,"z","x",sr,rr);break;case 3:gr.set(0,-1,0),ur[dr+0]=1-getUv(gr,lr,"x","z",sr,er),ur[dr+1]=1-getUv(gr,lr,"z","x",sr,rr);break;case 4:gr.set(0,0,1),ur[dr+0]=1-getUv(gr,lr,"x","y",sr,er),ur[dr+1]=1-getUv(gr,lr,"y","x",sr,tr);break;case 5:gr.set(0,0,-1),ur[dr+0]=getUv(gr,lr,"x","y",sr,er),ur[dr+1]=1-getUv(gr,lr,"y","x",sr,tr);break}}}class TeapotGeometry extends BufferGeometry{constructor(er=50,tr=10,rr=!0,nr=!0,sr=!0,ar=!0,or=!0){const lr=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],cr=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];super(),tr=Math.max(2,Math.floor(tr));const hr=1.3,ur=3.15*(or?1:hr)/2,pr=er/ur;let gr=rr?(8*tr-4)*tr:0;gr+=nr?(16*tr-4)*tr:0,gr+=sr?40*tr*tr:0;const _r=new Uint32Array(gr*3);let mr=rr?4:0;mr+=nr?8:0,mr+=sr?20:0,mr*=(tr+1)*(tr+1);const dr=new Float32Array(mr*3),vr=new Float32Array(mr*3),Ar=new Float32Array(mr*2),yr=new Matrix4;yr.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);const wr=[],br=[],Sr=[],xr=[],Cr=[],Ir=[],Rr=[],Pr=[],Fr=[],Nr=new Vector3$1;let Ur,Br,Or,Dr,Wr=0,$r=0;const Yr=new Vector3$1,Qi=new Matrix4,rs=new Matrix4,Kr=new Vector4,Qr=new Vector4,Vr=new Vector4,Gr=new Vector4,qr=new Vector3$1,ji=new Vector3$1,Zr=yr.clone();Zr.transpose();const Zi=(ms,Ki,Ni)=>!(dr[ms*3]===dr[Ki*3]&&dr[ms*3+1]===dr[Ki*3+1]&&dr[ms*3+2]===dr[Ki*3+2]||dr[ms*3]===dr[Ni*3]&&dr[ms*3+1]===dr[Ni*3+1]&&dr[ms*3+2]===dr[Ni*3+2]||dr[Ki*3]===dr[Ni*3]&&dr[Ki*3+1]===dr[Ni*3+1]&&dr[Ki*3+2]===dr[Ni*3+2]);for(let ms=0;ms<3;ms++)Ir[ms]=new Matrix4;const Yi=sr?0:20,qi=rr?32:28,Xr=tr+1;let ns=0,os=0,us=0,is=0,Ji=0;for(let ms=Yi;ms<qi;ms++)if(nr||ms<20||ms>=28){for(let Ki=0;Ki<3;Ki++){for(let Ni=0;Ni<4;Ni++)for(let Ri=0;Ri<4;Ri++)wr[Ri*4+Ni]=cr[lr[ms*16+Ni*4+Ri]*3+Ki],ar&&ms>=20&&ms<28&&Ki!==2&&(wr[Ri*4+Ni]*=1.077),!or&&Ki===2&&(wr[Ri*4+Ni]*=hr);Qi.set(wr[0],wr[1],wr[2],wr[3],wr[4],wr[5],wr[6],wr[7],wr[8],wr[9],wr[10],wr[11],wr[12],wr[13],wr[14],wr[15]),rs.multiplyMatrices(Qi,yr),Ir[Ki].multiplyMatrices(Zr,rs)}for(let Ki=0;Ki<=tr;Ki++){const Ni=Ki/tr;for(let Ri=0;Ri<=tr;Ri++){const Jr=Ri/tr;for(Dr=4,Br=Or=1;Dr--;)br[Dr]=Br,Sr[Dr]=Or,Br*=Ni,Or*=Jr,Dr===3?(xr[Dr]=Cr[Dr]=0,Wr=$r=1):(xr[Dr]=Wr*(3-Dr),Cr[Dr]=$r*(3-Dr),Wr*=Ni,$r*=Jr);Kr.fromArray(br),Qr.fromArray(Sr),Vr.fromArray(xr),Gr.fromArray(Cr);for(let Xi=0;Xi<3;Xi++)Ur=Kr.clone(),Ur.applyMatrix4(Ir[Xi]),Rr[Xi]=Ur.dot(Qr),Ur=Vr.clone(),Ur.applyMatrix4(Ir[Xi]),Pr[Xi]=Ur.dot(Qr),Ur=Kr.clone(),Ur.applyMatrix4(Ir[Xi]),Fr[Xi]=Ur.dot(Gr);qr.fromArray(Pr),ji.fromArray(Fr),Nr.crossVectors(ji,qr),Nr.normalize(),Rr[0]===0&&Rr[1]===0?Yr.set(0,Rr[2]>ur?1:-1,0):Yr.set(Nr.x,Nr.z,-Nr.y),dr[os++]=pr*Rr[0],dr[os++]=pr*(Rr[2]-ur),dr[os++]=-pr*Rr[1],vr[us++]=Yr.x,vr[us++]=Yr.y,vr[us++]=Yr.z,Ar[is++]=1-Jr,Ar[is++]=1-Ni}}for(let Ki=0;Ki<tr;Ki++)for(let Ni=0;Ni<tr;Ni++){const Ri=ns*Xr*Xr+Ki*Xr+Ni,Jr=Ri+1,Xi=Jr+Xr,ss=Ri+Xr;Zi(Ri,Jr,Xi)&&(_r[Ji++]=Ri,_r[Ji++]=Jr,_r[Ji++]=Xi),Zi(Ri,Xi,ss)&&(_r[Ji++]=Ri,_r[Ji++]=Xi,_r[Ji++]=ss)}ns++}this.setIndex(new BufferAttribute(_r,1)),this.setAttribute("position",new BufferAttribute(dr,3)),this.setAttribute("normal",new BufferAttribute(vr,3)),this.setAttribute("uv",new BufferAttribute(Ar,2)),this.computeBoundingSphere()}}class TextGeometry extends ExtrudeGeometry{constructor(er,tr={}){const rr=tr.font;if(rr===void 0)super();else{const nr=rr.generateShapes(er,tr.size);tr.depth===void 0&&(tr.depth=50),tr.bevelThickness===void 0&&(tr.bevelThickness=10),tr.bevelSize===void 0&&(tr.bevelSize=8),tr.bevelEnabled===void 0&&(tr.bevelEnabled=!1),super(nr,tr)}this.type="TextGeometry"}}class LightProbeHelper extends Mesh{constructor(er,tr=1){const rr=new ShaderMaterial({type:"LightProbeHelperMaterial",uniforms:{sh:{value:er.sh.coefficients},intensity:{value:er.intensity}},vertexShader:`

				varying vec3 vNormal;

				void main() {

					vNormal = normalize( normalMatrix * normal );

					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}

			`,fragmentShader:`

				#define RECIPROCAL_PI 0.318309886

				vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {

					// matrix is assumed to be orthogonal

					return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );

				}

				// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf,
				vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {

					// normal is assumed to have unit length,

					float x = normal.x, y = normal.y, z = normal.z;

					// band 0,
					vec3 result = shCoefficients[ 0 ] * 0.886227;

					// band 1,
					result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
					result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
					result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;

					// band 2,
					result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
					result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
					result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
					result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
					result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
					return result;

				}

				uniform vec3 sh[ 9 ]; // sh coefficients

				uniform float intensity; // light probe intensity

				varying vec3 vNormal;

				void main() {

					vec3 normal = normalize( vNormal );

					vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

					vec3 irradiance = shGetIrradianceAt( worldNormal, sh );

					vec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;

					gl_FragColor = linearToOutputTexel( vec4( outgoingLight, 1.0 ) );

				}

			`}),nr=new SphereGeometry(1,32,16);super(nr,rr),this.lightProbe=er,this.size=tr,this.type="LightProbeHelper",this.onBeforeRender()}dispose(){this.geometry.dispose(),this.material.dispose()}onBeforeRender(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity}}class OctreeHelper extends LineSegments{constructor(er,tr=16776960){super(new BufferGeometry,new LineBasicMaterial({color:tr,toneMapped:!1})),this.octree=er,this.color=tr,this.type="OctreeHelper",this.update()}update(){const er=[];function tr(rr){for(let nr=0;nr<rr.length;nr++){const sr=rr[nr].box.min,ar=rr[nr].box.max;er.push(ar.x,ar.y,ar.z),er.push(sr.x,ar.y,ar.z),er.push(sr.x,ar.y,ar.z),er.push(sr.x,sr.y,ar.z),er.push(sr.x,sr.y,ar.z),er.push(ar.x,sr.y,ar.z),er.push(ar.x,sr.y,ar.z),er.push(ar.x,ar.y,ar.z),er.push(ar.x,ar.y,sr.z),er.push(sr.x,ar.y,sr.z),er.push(sr.x,ar.y,sr.z),er.push(sr.x,sr.y,sr.z),er.push(sr.x,sr.y,sr.z),er.push(ar.x,sr.y,sr.z),er.push(ar.x,sr.y,sr.z),er.push(ar.x,ar.y,sr.z),er.push(ar.x,ar.y,ar.z),er.push(ar.x,ar.y,sr.z),er.push(sr.x,ar.y,ar.z),er.push(sr.x,ar.y,sr.z),er.push(sr.x,sr.y,ar.z),er.push(sr.x,sr.y,sr.z),er.push(ar.x,sr.y,ar.z),er.push(ar.x,sr.y,sr.z),tr(rr[nr].subTrees)}}tr(this.octree.subTrees),this.geometry.dispose(),this.geometry=new BufferGeometry,this.geometry.setAttribute("position",new Float32BufferAttribute(er,3))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PositionalAudioHelper extends Line{constructor(er,tr=1,rr=16,nr=2){const sr=new BufferGeometry,ar=rr+nr*2,or=new Float32Array((ar*3+3)*3);sr.setAttribute("position",new BufferAttribute(or,3));const lr=new LineBasicMaterial({color:65280}),cr=new LineBasicMaterial({color:16776960});super(sr,[cr,lr]),this.audio=er,this.range=tr,this.divisionsInnerAngle=rr,this.divisionsOuterAngle=nr,this.type="PositionalAudioHelper",this.update()}update(){const er=this.audio,tr=this.range,rr=this.divisionsInnerAngle,nr=this.divisionsOuterAngle,sr=MathUtils.degToRad(er.panner.coneInnerAngle),ar=MathUtils.degToRad(er.panner.coneOuterAngle),or=sr/2,lr=ar/2;let cr=0,hr=0,fr,ur;const pr=this.geometry,gr=pr.attributes.position;pr.clearGroups();function _r(mr,dr,vr,Ar){const yr=(dr-mr)/vr;for(gr.setXYZ(cr,0,0,0),hr++,fr=mr;fr<dr;fr+=yr)ur=cr+hr,gr.setXYZ(ur,Math.sin(fr)*tr,0,Math.cos(fr)*tr),gr.setXYZ(ur+1,Math.sin(Math.min(fr+yr,dr))*tr,0,Math.cos(Math.min(fr+yr,dr))*tr),gr.setXYZ(ur+2,0,0,0),hr+=3;pr.addGroup(cr,hr,Ar),cr+=hr,hr=0}_r(-lr,-or,nr,0),_r(-or,or,rr,1),_r(or,lr,nr,0),gr.needsUpdate=!0,sr===ar&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}class RectAreaLightHelper extends Line{constructor(er,tr){const rr=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],nr=new BufferGeometry;nr.setAttribute("position",new Float32BufferAttribute(rr,3)),nr.computeBoundingSphere();const sr=new LineBasicMaterial({fog:!1});super(nr,sr),this.light=er,this.color=tr,this.type="RectAreaLightHelper";const ar=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],or=new BufferGeometry;or.setAttribute("position",new Float32BufferAttribute(ar,3)),or.computeBoundingSphere(),this.add(new Mesh(or,new MeshBasicMaterial({side:BackSide,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const er=this.material.color,tr=Math.max(er.r,er.g,er.b);tr>1&&er.multiplyScalar(1/tr),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}function computeMikkTSpaceTangents(ir,er,tr=!0){if(!er||!er.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!ir.hasAttribute("position")||!ir.hasAttribute("normal")||!ir.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function rr(ar){if(ar.normalized||ar.isInterleavedBufferAttribute){const or=new Float32Array(ar.count*ar.itemSize);for(let lr=0,cr=0;lr<ar.count;lr++)or[cr++]=ar.getX(lr),or[cr++]=ar.getY(lr),ar.itemSize>2&&(or[cr++]=ar.getZ(lr));return or}return ar.array instanceof Float32Array?ar.array:new Float32Array(ar.array)}const nr=ir.index?ir.toNonIndexed():ir,sr=er.generateTangents(rr(nr.attributes.position),rr(nr.attributes.normal),rr(nr.attributes.uv));if(tr)for(let ar=3;ar<sr.length;ar+=4)sr[ar]*=-1;return nr.setAttribute("tangent",new BufferAttribute(sr,4)),ir!==nr&&ir.copy(nr),ir}function mergeGeometries(ir,er=!1){const tr=ir[0].index!==null,rr=new Set(Object.keys(ir[0].attributes)),nr=new Set(Object.keys(ir[0].morphAttributes)),sr={},ar={},or=ir[0].morphTargetsRelative,lr=new BufferGeometry;let cr=0;for(let hr=0;hr<ir.length;++hr){const fr=ir[hr];let ur=0;if(tr!==(fr.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+hr+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const pr in fr.attributes){if(!rr.has(pr))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+hr+'. All geometries must have compatible attributes; make sure "'+pr+'" attribute exists among all geometries, or in none of them.'),null;sr[pr]===void 0&&(sr[pr]=[]),sr[pr].push(fr.attributes[pr]),ur++}if(ur!==rr.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+hr+". Make sure all geometries have the same number of attributes."),null;if(or!==fr.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+hr+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const pr in fr.morphAttributes){if(!nr.has(pr))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+hr+".  .morphAttributes must be consistent throughout all geometries."),null;ar[pr]===void 0&&(ar[pr]=[]),ar[pr].push(fr.morphAttributes[pr])}if(er){let pr;if(tr)pr=fr.index.count;else if(fr.attributes.position!==void 0)pr=fr.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+hr+". The geometry must have either an index or a position attribute"),null;lr.addGroup(cr,pr,hr),cr+=pr}}if(tr){let hr=0;const fr=[];for(let ur=0;ur<ir.length;++ur){const pr=ir[ur].index;for(let gr=0;gr<pr.count;++gr)fr.push(pr.getX(gr)+hr);hr+=ir[ur].attributes.position.count}lr.setIndex(fr)}for(const hr in sr){const fr=mergeAttributes(sr[hr]);if(!fr)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+hr+" attribute."),null;lr.setAttribute(hr,fr)}for(const hr in ar){const fr=ar[hr][0].length;if(fr===0)break;lr.morphAttributes=lr.morphAttributes||{},lr.morphAttributes[hr]=[];for(let ur=0;ur<fr;++ur){const pr=[];for(let _r=0;_r<ar[hr].length;++_r)pr.push(ar[hr][_r][ur]);const gr=mergeAttributes(pr);if(!gr)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+hr+" morphAttribute."),null;lr.morphAttributes[hr].push(gr)}}return lr}function mergeAttributes(ir){let er,tr,rr,nr=-1,sr=0;for(let cr=0;cr<ir.length;++cr){const hr=ir[cr];if(er===void 0&&(er=hr.array.constructor),er!==hr.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(tr===void 0&&(tr=hr.itemSize),tr!==hr.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(rr===void 0&&(rr=hr.normalized),rr!==hr.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(nr===-1&&(nr=hr.gpuType),nr!==hr.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;sr+=hr.count*tr}const ar=new er(sr),or=new BufferAttribute(ar,tr,rr);let lr=0;for(let cr=0;cr<ir.length;++cr){const hr=ir[cr];if(hr.isInterleavedBufferAttribute){const fr=lr/tr;for(let ur=0,pr=hr.count;ur<pr;ur++)for(let gr=0;gr<tr;gr++){const _r=hr.getComponent(ur,gr);or.setComponent(ur+fr,gr,_r)}}else ar.set(hr.array,lr);lr+=hr.count*tr}return nr!==void 0&&(or.gpuType=nr),or}function deepCloneAttribute(ir){return ir.isInstancedInterleavedBufferAttribute||ir.isInterleavedBufferAttribute?deinterleaveAttribute(ir):ir.isInstancedBufferAttribute?new InstancedBufferAttribute().copy(ir):new BufferAttribute().copy(ir)}function interleaveAttributes(ir){let er,tr=0,rr=0;for(let cr=0,hr=ir.length;cr<hr;++cr){const fr=ir[cr];if(er===void 0&&(er=fr.array.constructor),er!==fr.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;tr+=fr.array.length,rr+=fr.itemSize}const nr=new InterleavedBuffer(new er(tr),rr);let sr=0;const ar=[],or=["getX","getY","getZ","getW"],lr=["setX","setY","setZ","setW"];for(let cr=0,hr=ir.length;cr<hr;cr++){const fr=ir[cr],ur=fr.itemSize,pr=fr.count,gr=new InterleavedBufferAttribute(nr,ur,sr,fr.normalized);ar.push(gr),sr+=ur;for(let _r=0;_r<pr;_r++)for(let mr=0;mr<ur;mr++)gr[lr[mr]](_r,fr[or[mr]](_r))}return ar}function deinterleaveAttribute(ir){const er=ir.data.array.constructor,tr=ir.count,rr=ir.itemSize,nr=ir.normalized,sr=new er(tr*rr);let ar;ir.isInstancedInterleavedBufferAttribute?ar=new InstancedBufferAttribute(sr,rr,nr,ir.meshPerAttribute):ar=new BufferAttribute(sr,rr,nr);for(let or=0;or<tr;or++)ar.setX(or,ir.getX(or)),rr>=2&&ar.setY(or,ir.getY(or)),rr>=3&&ar.setZ(or,ir.getZ(or)),rr>=4&&ar.setW(or,ir.getW(or));return ar}function deinterleaveGeometry(ir){const er=ir.attributes,tr=ir.morphTargets,rr=new Map;for(const nr in er){const sr=er[nr];sr.isInterleavedBufferAttribute&&(rr.has(sr)||rr.set(sr,deinterleaveAttribute(sr)),er[nr]=rr.get(sr))}for(const nr in tr){const sr=tr[nr];sr.isInterleavedBufferAttribute&&(rr.has(sr)||rr.set(sr,deinterleaveAttribute(sr)),tr[nr]=rr.get(sr))}}function estimateBytesUsed(ir){let er=0;for(const rr in ir.attributes){const nr=ir.getAttribute(rr);er+=nr.count*nr.itemSize*nr.array.BYTES_PER_ELEMENT}const tr=ir.getIndex();return er+=tr?tr.count*tr.itemSize*tr.array.BYTES_PER_ELEMENT:0,er}function mergeVertices(ir,er=1e-4){er=Math.max(er,Number.EPSILON);const tr={},rr=ir.getIndex(),nr=ir.getAttribute("position"),sr=rr?rr.count:nr.count;let ar=0;const or=Object.keys(ir.attributes),lr={},cr={},hr=[],fr=["getX","getY","getZ","getW"],ur=["setX","setY","setZ","setW"];for(let vr=0,Ar=or.length;vr<Ar;vr++){const yr=or[vr],wr=ir.attributes[yr];lr[yr]=new wr.constructor(new wr.array.constructor(wr.count*wr.itemSize),wr.itemSize,wr.normalized);const br=ir.morphAttributes[yr];br&&(cr[yr]||(cr[yr]=[]),br.forEach((Sr,xr)=>{const Cr=new Sr.array.constructor(Sr.count*Sr.itemSize);cr[yr][xr]=new Sr.constructor(Cr,Sr.itemSize,Sr.normalized)}))}const pr=er*.5,gr=Math.log10(1/er),_r=Math.pow(10,gr),mr=pr*_r;for(let vr=0;vr<sr;vr++){const Ar=rr?rr.getX(vr):vr;let yr="";for(let wr=0,br=or.length;wr<br;wr++){const Sr=or[wr],xr=ir.getAttribute(Sr),Cr=xr.itemSize;for(let Ir=0;Ir<Cr;Ir++)yr+=`${~~(xr[fr[Ir]](Ar)*_r+mr)},`}if(yr in tr)hr.push(tr[yr]);else{for(let wr=0,br=or.length;wr<br;wr++){const Sr=or[wr],xr=ir.getAttribute(Sr),Cr=ir.morphAttributes[Sr],Ir=xr.itemSize,Rr=lr[Sr],Pr=cr[Sr];for(let Fr=0;Fr<Ir;Fr++){const Nr=fr[Fr],Ur=ur[Fr];if(Rr[Ur](ar,xr[Nr](Ar)),Cr)for(let Br=0,Or=Cr.length;Br<Or;Br++)Pr[Br][Ur](ar,Cr[Br][Nr](Ar))}}tr[yr]=ar,hr.push(ar),ar++}}const dr=ir.clone();for(const vr in ir.attributes){const Ar=lr[vr];if(dr.setAttribute(vr,new Ar.constructor(Ar.array.slice(0,ar*Ar.itemSize),Ar.itemSize,Ar.normalized)),vr in cr)for(let yr=0;yr<cr[vr].length;yr++){const wr=cr[vr][yr];dr.morphAttributes[vr][yr]=new wr.constructor(wr.array.slice(0,ar*wr.itemSize),wr.itemSize,wr.normalized)}}return dr.setIndex(hr),dr}function toTrianglesDrawMode(ir,er){if(er===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),ir;if(er===TriangleFanDrawMode||er===TriangleStripDrawMode){let tr=ir.getIndex();if(tr===null){const ar=[],or=ir.getAttribute("position");if(or!==void 0){for(let lr=0;lr<or.count;lr++)ar.push(lr);ir.setIndex(ar),tr=ir.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),ir}const rr=tr.count-2,nr=[];if(er===TriangleFanDrawMode)for(let ar=1;ar<=rr;ar++)nr.push(tr.getX(0)),nr.push(tr.getX(ar)),nr.push(tr.getX(ar+1));else for(let ar=0;ar<rr;ar++)ar%2===0?(nr.push(tr.getX(ar)),nr.push(tr.getX(ar+1)),nr.push(tr.getX(ar+2))):(nr.push(tr.getX(ar+2)),nr.push(tr.getX(ar+1)),nr.push(tr.getX(ar)));nr.length/3!==rr&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const sr=ir.clone();return sr.setIndex(nr),sr.clearGroups(),sr}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",er),ir}function computeMorphedAttributes(ir){const er=new Vector3$1,tr=new Vector3$1,rr=new Vector3$1,nr=new Vector3$1,sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1;function hr(Wr,$r,Yr,Qi,rs,Kr,Qr,Vr){er.fromBufferAttribute($r,rs),tr.fromBufferAttribute($r,Kr),rr.fromBufferAttribute($r,Qr);const Gr=Wr.morphTargetInfluences;if(Yr&&Gr){or.set(0,0,0),lr.set(0,0,0),cr.set(0,0,0);for(let qr=0,ji=Yr.length;qr<ji;qr++){const Zr=Gr[qr],Zi=Yr[qr];Zr!==0&&(nr.fromBufferAttribute(Zi,rs),sr.fromBufferAttribute(Zi,Kr),ar.fromBufferAttribute(Zi,Qr),Qi?(or.addScaledVector(nr,Zr),lr.addScaledVector(sr,Zr),cr.addScaledVector(ar,Zr)):(or.addScaledVector(nr.sub(er),Zr),lr.addScaledVector(sr.sub(tr),Zr),cr.addScaledVector(ar.sub(rr),Zr)))}er.add(or),tr.add(lr),rr.add(cr)}Wr.isSkinnedMesh&&(Wr.applyBoneTransform(rs,er),Wr.applyBoneTransform(Kr,tr),Wr.applyBoneTransform(Qr,rr)),Vr[rs*3+0]=er.x,Vr[rs*3+1]=er.y,Vr[rs*3+2]=er.z,Vr[Kr*3+0]=tr.x,Vr[Kr*3+1]=tr.y,Vr[Kr*3+2]=tr.z,Vr[Qr*3+0]=rr.x,Vr[Qr*3+1]=rr.y,Vr[Qr*3+2]=rr.z}const fr=ir.geometry,ur=ir.material;let pr,gr,_r;const mr=fr.index,dr=fr.attributes.position,vr=fr.morphAttributes.position,Ar=fr.morphTargetsRelative,yr=fr.attributes.normal,wr=fr.morphAttributes.position,br=fr.groups,Sr=fr.drawRange;let xr,Cr,Ir,Rr,Pr,Fr,Nr;const Ur=new Float32Array(dr.count*dr.itemSize),Br=new Float32Array(yr.count*yr.itemSize);if(mr!==null)if(Array.isArray(ur))for(xr=0,Ir=br.length;xr<Ir;xr++)for(Pr=br[xr],Fr=Math.max(Pr.start,Sr.start),Nr=Math.min(Pr.start+Pr.count,Sr.start+Sr.count),Cr=Fr,Rr=Nr;Cr<Rr;Cr+=3)pr=mr.getX(Cr),gr=mr.getX(Cr+1),_r=mr.getX(Cr+2),hr(ir,dr,vr,Ar,pr,gr,_r,Ur),hr(ir,yr,wr,Ar,pr,gr,_r,Br);else for(Fr=Math.max(0,Sr.start),Nr=Math.min(mr.count,Sr.start+Sr.count),xr=Fr,Ir=Nr;xr<Ir;xr+=3)pr=mr.getX(xr),gr=mr.getX(xr+1),_r=mr.getX(xr+2),hr(ir,dr,vr,Ar,pr,gr,_r,Ur),hr(ir,yr,wr,Ar,pr,gr,_r,Br);else if(Array.isArray(ur))for(xr=0,Ir=br.length;xr<Ir;xr++)for(Pr=br[xr],Fr=Math.max(Pr.start,Sr.start),Nr=Math.min(Pr.start+Pr.count,Sr.start+Sr.count),Cr=Fr,Rr=Nr;Cr<Rr;Cr+=3)pr=Cr,gr=Cr+1,_r=Cr+2,hr(ir,dr,vr,Ar,pr,gr,_r,Ur),hr(ir,yr,wr,Ar,pr,gr,_r,Br);else for(Fr=Math.max(0,Sr.start),Nr=Math.min(dr.count,Sr.start+Sr.count),xr=Fr,Ir=Nr;xr<Ir;xr+=3)pr=xr,gr=xr+1,_r=xr+2,hr(ir,dr,vr,Ar,pr,gr,_r,Ur),hr(ir,yr,wr,Ar,pr,gr,_r,Br);const Or=new Float32BufferAttribute(Ur,3),Dr=new Float32BufferAttribute(Br,3);return{positionAttribute:dr,normalAttribute:yr,morphedPositionAttribute:Or,morphedNormalAttribute:Dr}}function mergeGroups(ir){if(ir.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),ir;let er=ir.groups;if(er=er.sort((ar,or)=>ar.materialIndex!==or.materialIndex?ar.materialIndex-or.materialIndex:ar.start-or.start),ir.getIndex()===null){const ar=ir.getAttribute("position"),or=[];for(let lr=0;lr<ar.count;lr+=3)or.push(lr,lr+1,lr+2);ir.setIndex(or)}const tr=ir.getIndex(),rr=[];for(let ar=0;ar<er.length;ar++){const or=er[ar],lr=or.start,cr=lr+or.count;for(let hr=lr;hr<cr;hr++)rr.push(tr.getX(hr))}ir.dispose(),ir.setIndex(rr);let nr=0;for(let ar=0;ar<er.length;ar++){const or=er[ar];or.start=nr,nr+=or.count}let sr=er[0];ir.groups=[sr];for(let ar=1;ar<er.length;ar++){const or=er[ar];sr.materialIndex===or.materialIndex?sr.count+=or.count:(sr=or,ir.groups.push(sr))}return ir}function toCreasedNormals(ir,er=Math.PI/3){const tr=Math.cos(er),rr=(1+1e-10)*100,nr=[new Vector3$1,new Vector3$1,new Vector3$1],sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=new Vector3$1;function cr(_r){const mr=~~(_r.x*rr),dr=~~(_r.y*rr),vr=~~(_r.z*rr);return`${mr},${dr},${vr}`}const hr=ir.index?ir.toNonIndexed():ir,fr=hr.attributes.position,ur={};for(let _r=0,mr=fr.count/3;_r<mr;_r++){const dr=3*_r,vr=nr[0].fromBufferAttribute(fr,dr+0),Ar=nr[1].fromBufferAttribute(fr,dr+1),yr=nr[2].fromBufferAttribute(fr,dr+2);sr.subVectors(yr,Ar),ar.subVectors(vr,Ar);const wr=new Vector3$1().crossVectors(sr,ar).normalize();for(let br=0;br<3;br++){const Sr=nr[br],xr=cr(Sr);xr in ur||(ur[xr]=[]),ur[xr].push(wr)}}const pr=new Float32Array(fr.count*3),gr=new BufferAttribute(pr,3,!1);for(let _r=0,mr=fr.count/3;_r<mr;_r++){const dr=3*_r,vr=nr[0].fromBufferAttribute(fr,dr+0),Ar=nr[1].fromBufferAttribute(fr,dr+1),yr=nr[2].fromBufferAttribute(fr,dr+2);sr.subVectors(yr,Ar),ar.subVectors(vr,Ar),or.crossVectors(sr,ar).normalize();for(let wr=0;wr<3;wr++){const br=nr[wr],Sr=cr(br),xr=ur[Sr];lr.set(0,0,0);for(let Cr=0,Ir=xr.length;Cr<Ir;Cr++){const Rr=xr[Cr];or.dot(Rr)>tr&&lr.add(Rr)}lr.normalize(),gr.setXYZ(dr+wr,lr.x,lr.y,lr.z)}}return hr.setAttribute("normal",gr),hr}const BufferGeometryUtils$1=Object.freeze(Object.defineProperty({__proto__:null,computeMikkTSpaceTangents,computeMorphedAttributes,deepCloneAttribute,deinterleaveAttribute,deinterleaveGeometry,estimateBytesUsed,interleaveAttributes,mergeAttributes,mergeGeometries,mergeGroups,mergeVertices,toCreasedNormals,toTrianglesDrawMode},Symbol.toStringTag,{value:"Module"}));class TextureHelper extends Mesh{constructor(er,tr=1,rr=1,nr=1){const sr=new ShaderMaterial({type:"TextureHelperMaterial",side:DoubleSide,transparent:!0,uniforms:{map:{value:er},alpha:{value:getAlpha(er)}},vertexShader:["attribute vec3 uvw;","varying vec3 vUvw;","void main() {","	vUvw = uvw;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["precision highp float;","precision highp sampler2DArray;","precision highp sampler3D;","uniform {samplerType} map;","uniform float alpha;","varying vec3 vUvw;","vec4 textureHelper( in sampler2D map ) { return texture( map, vUvw.xy ); }","vec4 textureHelper( in sampler2DArray map ) { return texture( map, vUvw ); }","vec4 textureHelper( in sampler3D map ) { return texture( map, vUvw ); }","vec4 textureHelper( in samplerCube map ) { return texture( map, vUvw ); }","void main() {","	gl_FragColor = linearToOutputTexel( vec4( textureHelper( map ).xyz, alpha ) );","}"].join(`
`).replace("{samplerType}",getSamplerType(er))}),ar=er.isCubeTexture?createCubeGeometry(tr,rr,nr):createSliceGeometry(er,tr,rr,nr);super(ar,sr),this.texture=er,this.type="TextureHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}function getSamplerType(ir){return ir.isCubeTexture?"samplerCube":ir.isDataArrayTexture||ir.isCompressedArrayTexture?"sampler2DArray":ir.isData3DTexture||ir.isCompressed3DTexture?"sampler3D":"sampler2D"}function getImageCount(ir){return ir.isCubeTexture?6:ir.isDataArrayTexture||ir.isCompressedArrayTexture||ir.isData3DTexture||ir.isCompressed3DTexture?ir.image.depth:1}function getAlpha(ir){return ir.isCubeTexture?1:ir.isDataArrayTexture||ir.isCompressedArrayTexture||ir.isData3DTexture||ir.isCompressed3DTexture?Math.max(1/ir.image.depth,.25):1}function createCubeGeometry(ir,er,tr){const rr=new BoxGeometry(ir,er,tr),nr=rr.attributes.position,sr=rr.attributes.uv,ar=new BufferAttribute(new Float32Array(sr.count*3),3),or=new Vector3$1;for(let lr=0,cr=sr.count;lr<cr;++lr){or.fromBufferAttribute(nr,lr).normalize();const hr=or.x,fr=or.y,ur=or.z;ar.setXYZ(lr,hr,fr,ur)}return rr.deleteAttribute("uv"),rr.setAttribute("uvw",ar),rr}function createSliceGeometry(ir,er,tr,rr){const nr=getImageCount(ir),sr=[];for(let ar=0;ar<nr;++ar){const or=new PlaneGeometry(er,tr);nr>1&&or.translate(0,0,rr*(ar/(nr-1)-.5));const lr=or.attributes.uv,cr=new BufferAttribute(new Float32Array(lr.count*3),3);for(let hr=0,fr=lr.count;hr<fr;++hr){const ur=lr.getX(hr),pr=ir.flipY?lr.getY(hr):1-lr.getY(hr),gr=nr===1?1:ir.isDataArrayTexture||ir.isCompressedArrayTexture?ar:ar/(nr-1);cr.setXYZ(hr,ur,pr,gr)}or.deleteAttribute("uv"),or.setAttribute("uvw",cr),sr.push(or)}return mergeGeometries(sr)}const _v1$3=new Vector3$1,_v2$2=new Vector3$1,_normalMatrix=new Matrix3;class VertexNormalsHelper extends LineSegments{constructor(er,tr=1,rr=16711680){const nr=new BufferGeometry,sr=er.geometry.attributes.normal.count,ar=new Float32BufferAttribute(sr*2*3,3);nr.setAttribute("position",ar),super(nr,new LineBasicMaterial({color:rr,toneMapped:!1})),this.object=er,this.size=tr,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.isVertexNormalsHelper=!0,this.update()}update(){this.object.updateMatrixWorld(!0),_normalMatrix.getNormalMatrix(this.object.matrixWorld);const er=this.object.matrixWorld,tr=this.geometry.attributes.position,rr=this.object.geometry;if(rr){const nr=rr.attributes.position,sr=rr.attributes.normal;let ar=0;for(let or=0,lr=nr.count;or<lr;or++)_v1$3.fromBufferAttribute(nr,or).applyMatrix4(er),_v2$2.fromBufferAttribute(sr,or),_v2$2.applyMatrix3(_normalMatrix).normalize().multiplyScalar(this.size).add(_v1$3),tr.setXYZ(ar,_v1$3.x,_v1$3.y,_v1$3.z),ar=ar+1,tr.setXYZ(ar,_v2$2.x,_v2$2.y,_v2$2.z),ar=ar+1}tr.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1$2=new Vector3$1,_v2$1=new Vector3$1;class VertexTangentsHelper extends LineSegments{constructor(er,tr=1,rr=65535){const nr=new BufferGeometry,sr=er.geometry.attributes.tangent.count,ar=new Float32BufferAttribute(sr*2*3,3);nr.setAttribute("position",ar),super(nr,new LineBasicMaterial({color:rr,toneMapped:!1})),this.object=er,this.size=tr,this.type="VertexTangentsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0);const er=this.object.matrixWorld,tr=this.geometry.attributes.position,rr=this.object.geometry,nr=rr.attributes.position,sr=rr.attributes.tangent;let ar=0;for(let or=0,lr=nr.count;or<lr;or++)_v1$2.fromBufferAttribute(nr,or).applyMatrix4(er),_v2$1.fromBufferAttribute(sr,or),_v2$1.transformDirection(er).multiplyScalar(this.size).add(_v1$2),tr.setXYZ(ar,_v1$2.x,_v1$2.y,_v1$2.z),ar=ar+1,tr.setXYZ(ar,_v2$1.x,_v2$1.y,_v2$1.z),ar=ar+1;tr.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}class ViewHelper extends Object3D{constructor(er,tr){super(),this.isViewHelper=!0,this.animating=!1,this.center=new Vector3$1;const rr=new Color("#ff4466"),nr=new Color("#88ff44"),sr=new Color("#4488ff"),ar=new Color("#000000"),or={},lr=[],cr=new Raycaster,hr=new Vector2,fr=new Object3D,ur=new OrthographicCamera(-2,2,2,-2,0,4);ur.position.set(0,0,2);const pr=new CylinderGeometry(.04,.04,.8,5).rotateZ(-Math.PI/2).translate(.4,0,0),gr=new Mesh(pr,Yr(rr)),_r=new Mesh(pr,Yr(nr)),mr=new Mesh(pr,Yr(sr));_r.rotation.z=Math.PI/2,mr.rotation.y=-Math.PI/2,this.add(gr),this.add(mr),this.add(_r);const dr=Qi(rr),vr=Qi(nr),Ar=Qi(sr),yr=Qi(ar),wr=new Sprite(dr),br=new Sprite(vr),Sr=new Sprite(Ar),xr=new Sprite(yr),Cr=new Sprite(yr),Ir=new Sprite(yr);wr.position.x=1,br.position.y=1,Sr.position.z=1,xr.position.x=-1,Cr.position.y=-1,Ir.position.z=-1,xr.material.opacity=.2,Cr.material.opacity=.2,Ir.material.opacity=.2,wr.userData.type="posX",br.userData.type="posY",Sr.userData.type="posZ",xr.userData.type="negX",Cr.userData.type="negY",Ir.userData.type="negZ",this.add(wr),this.add(br),this.add(Sr),this.add(xr),this.add(Cr),this.add(Ir),lr.push(wr),lr.push(br),lr.push(Sr),lr.push(xr),lr.push(Cr),lr.push(Ir);const Rr=new Vector3$1,Pr=128,Fr=2*Math.PI;this.render=function(Kr){this.quaternion.copy(er.quaternion).invert(),this.updateMatrixWorld(),Rr.set(0,0,1),Rr.applyQuaternion(er.quaternion);const Qr=tr.offsetWidth-Pr;Kr.clearDepth(),Kr.getViewport(Dr),Kr.setViewport(Qr,0,Pr,Pr),Kr.render(this,ur),Kr.setViewport(Dr.x,Dr.y,Dr.z,Dr.w)};const Nr=new Vector3$1,Ur=new Quaternion$1,Br=new Quaternion$1,Or=new Quaternion$1,Dr=new Vector4;let Wr=0;this.handleClick=function(Kr){if(this.animating===!0)return!1;const Qr=tr.getBoundingClientRect(),Vr=Qr.left+(tr.offsetWidth-Pr),Gr=Qr.top+(tr.offsetHeight-Pr);hr.x=(Kr.clientX-Vr)/(Qr.right-Vr)*2-1,hr.y=-((Kr.clientY-Gr)/(Qr.bottom-Gr))*2+1,cr.setFromCamera(hr,ur);const qr=cr.intersectObjects(lr);if(qr.length>0){const Zr=qr[0].object;return $r(Zr,this.center),this.animating=!0,!0}else return!1},this.setLabels=function(Kr,Qr,Vr){or.labelX=Kr,or.labelY=Qr,or.labelZ=Vr,rs()},this.setLabelStyle=function(Kr,Qr,Vr){or.font=Kr,or.color=Qr,or.radius=Vr,rs()},this.update=function(Kr){const Qr=Kr*Fr;Br.rotateTowards(Or,Qr),er.position.set(0,0,1).applyQuaternion(Br).multiplyScalar(Wr).add(this.center),er.quaternion.rotateTowards(Ur,Qr),Br.angleTo(Or)===0&&(this.animating=!1)},this.dispose=function(){pr.dispose(),gr.material.dispose(),_r.material.dispose(),mr.material.dispose(),wr.material.map.dispose(),br.material.map.dispose(),Sr.material.map.dispose(),xr.material.map.dispose(),Cr.material.map.dispose(),Ir.material.map.dispose(),wr.material.dispose(),br.material.dispose(),Sr.material.dispose(),xr.material.dispose(),Cr.material.dispose(),Ir.material.dispose()};function $r(Kr,Qr){switch(Kr.userData.type){case"posX":Nr.set(1,0,0),Ur.setFromEuler(new Euler(0,Math.PI*.5,0));break;case"posY":Nr.set(0,1,0),Ur.setFromEuler(new Euler(-Math.PI*.5,0,0));break;case"posZ":Nr.set(0,0,1),Ur.setFromEuler(new Euler);break;case"negX":Nr.set(-1,0,0),Ur.setFromEuler(new Euler(0,-Math.PI*.5,0));break;case"negY":Nr.set(0,-1,0),Ur.setFromEuler(new Euler(Math.PI*.5,0,0));break;case"negZ":Nr.set(0,0,-1),Ur.setFromEuler(new Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}Wr=er.position.distanceTo(Qr),Nr.multiplyScalar(Wr).add(Qr),fr.position.copy(Qr),fr.lookAt(er.position),Br.copy(fr.quaternion),fr.lookAt(Nr),Or.copy(fr.quaternion)}function Yr(Kr){return new MeshBasicMaterial({color:Kr,toneMapped:!1})}function Qi(Kr,Qr){const{font:Vr="24px Arial",color:Gr="#000000",radius:qr=14}=or,ji=document.createElement("canvas");ji.width=64,ji.height=64;const Zr=ji.getContext("2d");Zr.beginPath(),Zr.arc(32,32,qr,0,2*Math.PI),Zr.closePath(),Zr.fillStyle=Kr.getStyle(),Zr.fill(),Qr&&(Zr.font=Vr,Zr.textAlign="center",Zr.fillStyle=Gr,Zr.fillText(Qr,32,41));const Zi=new CanvasTexture(ji);return Zi.colorSpace=SRGBColorSpace,new SpriteMaterial({map:Zi,toneMapped:!1})}function rs(){wr.material.map.dispose(),br.material.map.dispose(),Sr.material.map.dispose(),wr.material.dispose(),br.material.dispose(),Sr.material.dispose(),wr.material=Qi(rr,or.labelX),br.material=Qi(nr,or.labelY),Sr.material=Qi(sr,or.labelZ)}}}class HTMLMesh extends Mesh{constructor(er){const tr=new HTMLTexture(er),rr=new PlaneGeometry(tr.image.width*.001,tr.image.height*.001),nr=new MeshBasicMaterial({map:tr,toneMapped:!1,transparent:!0});super(rr,nr);function sr(ar){nr.map.dispatchDOMEvent(ar)}this.addEventListener("mousedown",sr),this.addEventListener("mousemove",sr),this.addEventListener("mouseup",sr),this.addEventListener("click",sr),this.dispose=function(){rr.dispose(),nr.dispose(),nr.map.dispose(),canvases.delete(er),this.removeEventListener("mousedown",sr),this.removeEventListener("mousemove",sr),this.removeEventListener("mouseup",sr),this.removeEventListener("click",sr)}}}class HTMLTexture extends CanvasTexture{constructor(er){super(html2canvas(er)),this.dom=er,this.anisotropy=16,this.colorSpace=SRGBColorSpace,this.minFilter=LinearFilter,this.magFilter=LinearFilter,this.generateMipmaps=!1;const tr=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),rr={attributes:!0,childList:!0,subtree:!0,characterData:!0};tr.observe(er,rr),this.observer=tr}dispatchDOMEvent(er){er.data&&htmlevent(this.dom,er.type,er.data.x,er.data.y)}update(){this.image=html2canvas(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const canvases=new WeakMap;function html2canvas(ir){const er=document.createRange(),tr=new Color;function rr(ur){const pr=[];let gr=!1;function _r(){if(gr&&(gr=!1,ur.restore()),pr.length===0)return;let mr=-1/0,dr=-1/0,vr=1/0,Ar=1/0;for(let yr=0;yr<pr.length;yr++){const wr=pr[yr];mr=Math.max(mr,wr.x),dr=Math.max(dr,wr.y),vr=Math.min(vr,wr.x+wr.width),Ar=Math.min(Ar,wr.y+wr.height)}ur.save(),ur.beginPath(),ur.rect(mr,dr,vr-mr,Ar-dr),ur.clip(),gr=!0}return{add:function(mr){pr.push(mr),_r()},remove:function(){pr.pop(),_r()}}}function nr(ur,pr,gr,_r){_r!==""&&(ur.textTransform==="uppercase"&&(_r=_r.toUpperCase()),hr.font=ur.fontWeight+" "+ur.fontSize+" "+ur.fontFamily,hr.textBaseline="top",hr.fillStyle=ur.color,hr.fillText(_r,pr,gr+parseFloat(ur.fontSize)*.1))}function sr(ur,pr,gr,_r,mr){gr<2*mr&&(mr=gr/2),_r<2*mr&&(mr=_r/2),hr.beginPath(),hr.moveTo(ur+mr,pr),hr.arcTo(ur+gr,pr,ur+gr,pr+_r,mr),hr.arcTo(ur+gr,pr+_r,ur,pr+_r,mr),hr.arcTo(ur,pr+_r,ur,pr,mr),hr.arcTo(ur,pr,ur+gr,pr,mr),hr.closePath()}function ar(ur,pr,gr,_r,mr,dr){const vr=ur[pr+"Width"],Ar=ur[pr+"Style"],yr=ur[pr+"Color"];vr!=="0px"&&Ar!=="none"&&yr!=="transparent"&&yr!=="rgba(0, 0, 0, 0)"&&(hr.strokeStyle=yr,hr.lineWidth=parseFloat(vr),hr.beginPath(),hr.moveTo(gr,_r),hr.lineTo(gr+mr,_r+dr),hr.stroke())}function or(ur,pr){if(ur.nodeType===Node.COMMENT_NODE||ur.nodeName==="SCRIPT"||ur.style&&ur.style.display==="none")return;let gr=0,_r=0,mr=0,dr=0;if(ur.nodeType===Node.TEXT_NODE){er.selectNode(ur);const Ar=er.getBoundingClientRect();gr=Ar.left-lr.left-.5,_r=Ar.top-lr.top-.5,mr=Ar.width,dr=Ar.height,nr(pr,gr,_r,ur.nodeValue.trim())}else if(ur instanceof HTMLCanvasElement){const Ar=ur.getBoundingClientRect();gr=Ar.left-lr.left-.5,_r=Ar.top-lr.top-.5,hr.save();const yr=window.devicePixelRatio;hr.scale(1/yr,1/yr),hr.drawImage(ur,gr,_r),hr.restore()}else if(ur instanceof HTMLImageElement){const Ar=ur.getBoundingClientRect();gr=Ar.left-lr.left-.5,_r=Ar.top-lr.top-.5,mr=Ar.width,dr=Ar.height,hr.drawImage(ur,gr,_r,mr,dr)}else{const Ar=ur.getBoundingClientRect();gr=Ar.left-lr.left-.5,_r=Ar.top-lr.top-.5,mr=Ar.width,dr=Ar.height,pr=window.getComputedStyle(ur),sr(gr,_r,mr,dr,parseFloat(pr.borderRadius));const yr=pr.backgroundColor;yr!=="transparent"&&yr!=="rgba(0, 0, 0, 0)"&&(hr.fillStyle=yr,hr.fill());const wr=["borderTop","borderLeft","borderBottom","borderRight"];let br=!0,Sr=null;for(const xr of wr){if(Sr!==null&&(br=pr[xr+"Width"]===pr[Sr+"Width"]&&pr[xr+"Color"]===pr[Sr+"Color"]&&pr[xr+"Style"]===pr[Sr+"Style"]),br===!1)break;Sr=xr}if(br===!0){const xr=parseFloat(pr.borderTopWidth);pr.borderTopWidth!=="0px"&&pr.borderTopStyle!=="none"&&pr.borderTopColor!=="transparent"&&pr.borderTopColor!=="rgba(0, 0, 0, 0)"&&(hr.strokeStyle=pr.borderTopColor,hr.lineWidth=xr,hr.stroke())}else ar(pr,"borderTop",gr,_r,mr,0),ar(pr,"borderLeft",gr,_r,0,dr),ar(pr,"borderBottom",gr,_r+dr,mr,0),ar(pr,"borderRight",gr+mr,_r,0,dr);if(ur instanceof HTMLInputElement){let xr=pr.accentColor;(xr===void 0||xr==="auto")&&(xr=pr.color),tr.set(xr);const Ir=Math.sqrt(.299*tr.r**2+.587*tr.g**2+.114*tr.b**2)<.5?"white":"#111111";if(ur.type==="radio"&&(sr(gr,_r,mr,dr,dr),hr.fillStyle="white",hr.strokeStyle=xr,hr.lineWidth=1,hr.fill(),hr.stroke(),ur.checked&&(sr(gr+2,_r+2,mr-4,dr-4,dr),hr.fillStyle=xr,hr.strokeStyle=Ir,hr.lineWidth=2,hr.fill(),hr.stroke())),ur.type==="checkbox"&&(sr(gr,_r,mr,dr,2),hr.fillStyle=ur.checked?xr:"white",hr.strokeStyle=ur.checked?Ir:xr,hr.lineWidth=1,hr.stroke(),hr.fill(),ur.checked)){const Rr=hr.textAlign;hr.textAlign="center";const Pr={color:Ir,fontFamily:pr.fontFamily,fontSize:dr+"px",fontWeight:"bold"};nr(Pr,gr+mr/2,_r,""),hr.textAlign=Rr}if(ur.type==="range"){const[Rr,Pr,Fr]=["min","max","value"].map(Ur=>parseFloat(ur[Ur])),Nr=(Fr-Rr)/(Pr-Rr)*(mr-dr);sr(gr,_r+dr/4,mr,dr/2,dr/4),hr.fillStyle=Ir,hr.strokeStyle=xr,hr.lineWidth=1,hr.fill(),hr.stroke(),sr(gr,_r+dr/4,Nr+dr/2,dr/2,dr/4),hr.fillStyle=xr,hr.fill(),sr(gr+Nr,_r,dr,dr,dr/2),hr.fillStyle=xr,hr.fill()}(ur.type==="color"||ur.type==="text"||ur.type==="number")&&(fr.add({x:gr,y:_r,width:mr,height:dr}),nr(pr,gr+parseInt(pr.paddingLeft),_r+parseInt(pr.paddingTop),ur.value),fr.remove())}}const vr=pr.overflow==="auto"||pr.overflow==="hidden";vr&&fr.add({x:gr,y:_r,width:mr,height:dr});for(let Ar=0;Ar<ur.childNodes.length;Ar++)or(ur.childNodes[Ar],pr);vr&&fr.remove()}const lr=ir.getBoundingClientRect();let cr=canvases.get(ir);cr===void 0&&(cr=document.createElement("canvas"),cr.width=lr.width,cr.height=lr.height,canvases.set(ir,cr));const hr=cr.getContext("2d"),fr=new rr(hr);return hr.clearRect(0,0,cr.width,cr.height),or(ir),cr}function htmlevent(ir,er,tr,rr){const nr={clientX:tr*ir.offsetWidth+ir.offsetLeft,clientY:rr*ir.offsetHeight+ir.offsetTop,view:ir.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(er,nr));const sr=ir.getBoundingClientRect();tr=tr*sr.width+sr.left,rr=rr*sr.height+sr.top;function ar(or){if(or.nodeType!==Node.TEXT_NODE&&or.nodeType!==Node.COMMENT_NODE){const lr=or.getBoundingClientRect();if(tr>lr.left&&tr<lr.right&&rr>lr.top&&rr<lr.bottom&&(or.dispatchEvent(new MouseEvent(er,nr)),or instanceof HTMLInputElement&&or.type==="range"&&(er==="mousedown"||er==="click"))){const[cr,hr]=["min","max"].map(gr=>parseFloat(or[gr])),fr=lr.width,pr=(tr-lr.x)/fr;or.value=cr+(hr-cr)*pr,or.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let cr=0;cr<or.childNodes.length;cr++)ar(or.childNodes[cr])}}ar(ir)}const _pointer=new Vector2,_event={type:"",data:_pointer},_events={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"},_raycaster=new Raycaster;class InteractiveGroup extends Group{constructor(){super(),this.raycaster=new Raycaster,this.element=null,this.camera=null,this.controllers=[],this._onPointerEvent=this.onPointerEvent.bind(this),this._onXRControllerEvent=this.onXRControllerEvent.bind(this)}onPointerEvent(er){er.stopPropagation();const tr=this.element.getBoundingClientRect();_pointer.x=(er.clientX-tr.left)/tr.width*2-1,_pointer.y=-(er.clientY-tr.top)/tr.height*2+1,this.raycaster.setFromCamera(_pointer,this.camera);const rr=this.raycaster.intersectObjects(this.children,!1);if(rr.length>0){const nr=rr[0],sr=nr.object,ar=nr.uv;_event.type=er.type,_event.data.set(ar.x,1-ar.y),sr.dispatchEvent(_event)}}onXRControllerEvent(er){const tr=er.target;_raycaster.setFromXRController(tr);const rr=_raycaster.intersectObjects(this.children,!1);if(rr.length>0){const nr=rr[0],sr=nr.object,ar=nr.uv;_event.type=_events[er.type],_event.data.set(ar.x,1-ar.y),sr.dispatchEvent(_event)}}listenToPointerEvents(er,tr){this.camera=tr,this.element=er.domElement,this.element.addEventListener("pointerdown",this._onPointerEvent),this.element.addEventListener("pointerup",this._onPointerEvent),this.element.addEventListener("pointermove",this._onPointerEvent),this.element.addEventListener("mousedown",this._onPointerEvent),this.element.addEventListener("mouseup",this._onPointerEvent),this.element.addEventListener("mousemove",this._onPointerEvent),this.element.addEventListener("click",this._onPointerEvent)}disconnectionPointerEvents(){this.element!==null&&(this.element.removeEventListener("pointerdown",this._onPointerEvent),this.element.removeEventListener("pointerup",this._onPointerEvent),this.element.removeEventListener("pointermove",this._onPointerEvent),this.element.removeEventListener("mousedown",this._onPointerEvent),this.element.removeEventListener("mouseup",this._onPointerEvent),this.element.removeEventListener("mousemove",this._onPointerEvent),this.element.removeEventListener("click",this._onPointerEvent))}listenToXRControllerEvents(er){this.controllers.push(er),er.addEventListener("move",this._onXRControllerEvent),er.addEventListener("select",this._onXRControllerEvent),er.addEventListener("selectstart",this._onXRControllerEvent),er.addEventListener("selectend",this._onXRControllerEvent)}disconnectXrControllerEvents(){for(const er of this.controllers)er.removeEventListener("move",this._onXRControllerEvent),er.removeEventListener("select",this._onXRControllerEvent),er.removeEventListener("selectstart",this._onXRControllerEvent),er.removeEventListener("selectend",this._onXRControllerEvent)}disconnect(){this.disconnectionPointerEvents(),this.disconnectXrControllerEvents(),this.camera=null,this.element=null,this.controllers=[]}}const _frustum=new Frustum,_center=new Vector3$1,_tmpPoint=new Vector3$1,_vecNear=new Vector3$1,_vecTopLeft=new Vector3$1,_vecTopRight=new Vector3$1,_vecDownRight=new Vector3$1,_vecDownLeft=new Vector3$1,_vecFarTopLeft=new Vector3$1,_vecFarTopRight=new Vector3$1,_vecFarDownRight=new Vector3$1,_vecFarDownLeft=new Vector3$1,_vectemp1=new Vector3$1,_vectemp2=new Vector3$1,_vectemp3=new Vector3$1,_matrix$3=new Matrix4,_quaternion$1=new Quaternion$1,_scale$2=new Vector3$1;class SelectionBox{constructor(er,tr,rr=Number.MAX_VALUE){this.camera=er,this.scene=tr,this.startPoint=new Vector3$1,this.endPoint=new Vector3$1,this.collection=[],this.instances={},this.deep=rr}select(er,tr){return this.startPoint=er||this.startPoint,this.endPoint=tr||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(_frustum,this.scene),this.collection}updateFrustum(er,tr){if(er=er||this.startPoint,tr=tr||this.endPoint,er.x===tr.x&&(tr.x+=Number.EPSILON),er.y===tr.y&&(tr.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){_tmpPoint.copy(er),_tmpPoint.x=Math.min(er.x,tr.x),_tmpPoint.y=Math.max(er.y,tr.y),tr.x=Math.max(er.x,tr.x),tr.y=Math.min(er.y,tr.y),_vecNear.setFromMatrixPosition(this.camera.matrixWorld),_vecTopLeft.copy(_tmpPoint),_vecTopRight.set(tr.x,_tmpPoint.y,0),_vecDownRight.copy(tr),_vecDownLeft.set(_tmpPoint.x,tr.y,0),_vecTopLeft.unproject(this.camera),_vecTopRight.unproject(this.camera),_vecDownRight.unproject(this.camera),_vecDownLeft.unproject(this.camera),_vectemp1.copy(_vecTopLeft).sub(_vecNear),_vectemp2.copy(_vecTopRight).sub(_vecNear),_vectemp3.copy(_vecDownRight).sub(_vecNear),_vectemp1.normalize(),_vectemp2.normalize(),_vectemp3.normalize(),_vectemp1.multiplyScalar(this.deep),_vectemp2.multiplyScalar(this.deep),_vectemp3.multiplyScalar(this.deep),_vectemp1.add(_vecNear),_vectemp2.add(_vecNear),_vectemp3.add(_vecNear);const rr=_frustum.planes;rr[0].setFromCoplanarPoints(_vecNear,_vecTopLeft,_vecTopRight),rr[1].setFromCoplanarPoints(_vecNear,_vecTopRight,_vecDownRight),rr[2].setFromCoplanarPoints(_vecDownRight,_vecDownLeft,_vecNear),rr[3].setFromCoplanarPoints(_vecDownLeft,_vecTopLeft,_vecNear),rr[4].setFromCoplanarPoints(_vecTopRight,_vecDownRight,_vecDownLeft),rr[5].setFromCoplanarPoints(_vectemp3,_vectemp2,_vectemp1),rr[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const rr=Math.min(er.x,tr.x),nr=Math.max(er.y,tr.y),sr=Math.max(er.x,tr.x),ar=Math.min(er.y,tr.y);_vecTopLeft.set(rr,nr,-1),_vecTopRight.set(sr,nr,-1),_vecDownRight.set(sr,ar,-1),_vecDownLeft.set(rr,ar,-1),_vecFarTopLeft.set(rr,nr,1),_vecFarTopRight.set(sr,nr,1),_vecFarDownRight.set(sr,ar,1),_vecFarDownLeft.set(rr,ar,1),_vecTopLeft.unproject(this.camera),_vecTopRight.unproject(this.camera),_vecDownRight.unproject(this.camera),_vecDownLeft.unproject(this.camera),_vecFarTopLeft.unproject(this.camera),_vecFarTopRight.unproject(this.camera),_vecFarDownRight.unproject(this.camera),_vecFarDownLeft.unproject(this.camera);const or=_frustum.planes;or[0].setFromCoplanarPoints(_vecTopLeft,_vecFarTopLeft,_vecFarTopRight),or[1].setFromCoplanarPoints(_vecTopRight,_vecFarTopRight,_vecFarDownRight),or[2].setFromCoplanarPoints(_vecFarDownRight,_vecFarDownLeft,_vecDownLeft),or[3].setFromCoplanarPoints(_vecFarDownLeft,_vecFarTopLeft,_vecTopLeft),or[4].setFromCoplanarPoints(_vecTopRight,_vecDownRight,_vecDownLeft),or[5].setFromCoplanarPoints(_vecFarDownRight,_vecFarTopRight,_vecFarTopLeft),or[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(er,tr){if(tr.isMesh||tr.isLine||tr.isPoints)if(tr.isInstancedMesh){this.instances[tr.uuid]=[];for(let rr=0;rr<tr.count;rr++)tr.getMatrixAt(rr,_matrix$3),_matrix$3.decompose(_center,_quaternion$1,_scale$2),_center.applyMatrix4(tr.matrixWorld),er.containsPoint(_center)&&this.instances[tr.uuid].push(rr)}else tr.geometry.boundingSphere===null&&tr.geometry.computeBoundingSphere(),_center.copy(tr.geometry.boundingSphere.center),_center.applyMatrix4(tr.matrixWorld),er.containsPoint(_center)&&this.collection.push(tr);if(tr.children.length>0)for(let rr=0;rr<tr.children.length;rr++)this.searchChildInFrustum(er,tr.children[rr])}}class SelectionHelper{constructor(er,tr){this.element=document.createElement("div"),this.element.classList.add(tr),this.element.style.pointerEvents="none",this.renderer=er,this.startPoint=new Vector2,this.pointTopLeft=new Vector2,this.pointBottomRight=new Vector2,this.isDown=!1,this.enabled=!0,this.onPointerDown=function(rr){this.enabled!==!1&&(this.isDown=!0,this.onSelectStart(rr))}.bind(this),this.onPointerMove=function(rr){this.enabled!==!1&&this.isDown&&this.onSelectMove(rr)}.bind(this),this.onPointerUp=function(){this.enabled!==!1&&(this.isDown=!1,this.onSelectOver())}.bind(this),this.renderer.domElement.addEventListener("pointerdown",this.onPointerDown),this.renderer.domElement.addEventListener("pointermove",this.onPointerMove),this.renderer.domElement.addEventListener("pointerup",this.onPointerUp)}dispose(){this.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown),this.renderer.domElement.removeEventListener("pointermove",this.onPointerMove),this.renderer.domElement.removeEventListener("pointerup",this.onPointerUp)}onSelectStart(er){this.element.style.display="none",this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=er.clientX+"px",this.element.style.top=er.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=er.clientX,this.startPoint.y=er.clientY}onSelectMove(er){this.element.style.display="block",this.pointBottomRight.x=Math.max(this.startPoint.x,er.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,er.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,er.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,er.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"}onSelectOver(){this.element.parentElement.removeChild(this.element)}}class LightProbeGenerator{static fromCubeTexture(er){let tr=0;const rr=new Vector3$1,nr=new Vector3$1,sr=new Color,ar=[0,0,0,0,0,0,0,0,0],or=new SphericalHarmonics3,lr=or.coefficients;for(let hr=0;hr<6;hr++){const fr=er.image[hr],ur=fr.width,pr=fr.height,gr=document.createElement("canvas");gr.width=ur,gr.height=pr;const _r=gr.getContext("2d");_r.drawImage(fr,0,0,ur,pr);const mr=_r.getImageData(0,0,ur,pr),dr=mr.data,vr=mr.width,Ar=2/vr;for(let yr=0,wr=dr.length;yr<wr;yr+=4){sr.setRGB(dr[yr]/255,dr[yr+1]/255,dr[yr+2]/255),convertColorToLinear(sr,er.colorSpace);const br=yr/4,Sr=-1+(br%vr+.5)*Ar,xr=1-(Math.floor(br/vr)+.5)*Ar;switch(hr){case 0:rr.set(-1,xr,-Sr);break;case 1:rr.set(1,xr,Sr);break;case 2:rr.set(-Sr,1,-xr);break;case 3:rr.set(-Sr,-1,xr);break;case 4:rr.set(-Sr,xr,1);break;case 5:rr.set(Sr,xr,-1);break}const Cr=rr.lengthSq(),Ir=4/(Math.sqrt(Cr)*Cr);tr+=Ir,nr.copy(rr).normalize(),SphericalHarmonics3.getBasisAt(nr,ar);for(let Rr=0;Rr<9;Rr++)lr[Rr].x+=ar[Rr]*sr.r*Ir,lr[Rr].y+=ar[Rr]*sr.g*Ir,lr[Rr].z+=ar[Rr]*sr.b*Ir}}const cr=4*Math.PI/tr;for(let hr=0;hr<9;hr++)lr[hr].x*=cr,lr[hr].y*=cr,lr[hr].z*=cr;return new LightProbe(or)}static async fromCubeRenderTarget(er,tr){const rr=er.coordinateSystem===WebGLCoordinateSystem?-1:1;let nr=0;const sr=new Vector3$1,ar=new Vector3$1,or=new Color,lr=[0,0,0,0,0,0,0,0,0],cr=new SphericalHarmonics3,hr=cr.coefficients,fr=tr.texture.type,ur=tr.width;let pr;er.isWebGLRenderer&&(fr===HalfFloatType?pr=new Uint16Array(ur*ur*4):pr=new Uint8Array(ur*ur*4));for(let _r=0;_r<6;_r++){er.isWebGLRenderer?await er.readRenderTargetPixelsAsync(tr,0,0,ur,ur,pr,_r):pr=await er.readRenderTargetPixelsAsync(tr,0,0,ur,ur,0,_r);const mr=2/ur;for(let dr=0,vr=pr.length;dr<vr;dr+=4){let Ar,yr,wr;fr===HalfFloatType?(Ar=DataUtils.fromHalfFloat(pr[dr]),yr=DataUtils.fromHalfFloat(pr[dr+1]),wr=DataUtils.fromHalfFloat(pr[dr+2])):(Ar=pr[dr]/255,yr=pr[dr+1]/255,wr=pr[dr+2]/255),or.setRGB(Ar,yr,wr),convertColorToLinear(or,tr.texture.colorSpace);const br=dr/4,Sr=(1-(br%ur+.5)*mr)*rr,xr=1-(Math.floor(br/ur)+.5)*mr;switch(_r){case 0:sr.set(-1*rr,xr,Sr*rr);break;case 1:sr.set(1*rr,xr,-Sr*rr);break;case 2:sr.set(Sr,1,-xr);break;case 3:sr.set(Sr,-1,xr);break;case 4:sr.set(Sr,xr,1);break;case 5:sr.set(-Sr,xr,-1);break}const Cr=sr.lengthSq(),Ir=4/(Math.sqrt(Cr)*Cr);nr+=Ir,ar.copy(sr).normalize(),SphericalHarmonics3.getBasisAt(ar,lr);for(let Rr=0;Rr<9;Rr++)hr[Rr].x+=lr[Rr]*or.r*Ir,hr[Rr].y+=lr[Rr]*or.g*Ir,hr[Rr].z+=lr[Rr]*or.b*Ir}}const gr=4*Math.PI/nr;for(let _r=0;_r<9;_r++)hr[_r].x*=gr,hr[_r].y*=gr,hr[_r].z*=gr;return new LightProbe(cr)}}function convertColorToLinear(ir,er){switch(er){case SRGBColorSpace:ir.convertSRGBToLinear();break;case LinearSRGBColorSpace:case NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.");break}return ir}class RectAreaLightTexturesLib{static init(){const er=[1,0,0,2e-5,1,0,0,503905e-9,1,0,0,.00201562,1,0,0,.00453516,1,0,0,.00806253,1,0,0,.0125978,1,0,0,.018141,1,0,0,.0246924,1,0,0,.0322525,1,0,0,.0408213,1,0,0,.0503999,1,0,0,.0609894,1,0,0,.0725906,1,0,0,.0852058,1,0,0,.0988363,1,0,0,.113484,1,0,0,.129153,1,0,0,.145839,1,0,0,.163548,1,0,0,.182266,1,0,0,.201942,1,0,0,.222314,1,0,0,.241906,1,0,0,.262314,1,0,0,.285754,1,0,0,.310159,1,0,0,.335426,1,0,0,.361341,1,0,0,.387445,1,0,0,.412784,1,0,0,.438197,1,0,0,.466966,1,0,0,.49559,1,0,0,.523448,1,0,0,.549938,1,0,0,.57979,1,0,0,.608746,1,0,0,.636185,1,0,0,.664748,1,0,0,.69313,1,0,0,.71966,1,0,0,.747662,1,0,0,.774023,1,0,0,.799775,1,0,0,.825274,1,0,0,.849156,1,0,0,.873248,1,0,0,.89532,1,0,0,.917565,1,0,0,.937863,1,0,0,.958139,1,0,0,.976563,1,0,0,.994658,1,0,0,1.0112,1,0,0,1.02712,1,0,0,1.04189,1,0,0,1.05568,1,0,0,1.06877,1,0,0,1.08058,1,0,0,1.09194,1,0,0,1.10191,1,0,0,1.11161,1,0,0,1.1199,1,0,0,1.12813,.999547,-448815e-12,.0224417,199902e-10,.999495,-113079e-10,.0224406,503651e-9,.999496,-452317e-10,.0224406,.00201461,.999496,-101772e-9,.0224406,.00453287,.999495,-180928e-9,.0224406,.00805845,.999497,-282702e-9,.0224406,.0125914,.999496,-407096e-9,.0224406,.0181319,.999498,-554114e-9,.0224406,.02468,.999499,-723768e-9,.0224406,.0322363,.999495,-916058e-9,.0224405,.0408009,.999499,-.00113101,.0224408,.050375,.999494,-.00136863,.0224405,.0609586,.999489,-.00162896,.0224401,.0725537,.999489,-.00191201,.0224414,.0851619,.999498,-.00221787,.0224413,.0987867,.999492,-.00254642,.0224409,.113426,.999507,-.00289779,.0224417,.129088,.999494,-.0032716,.0224386,.145767,.999546,-.0036673,.0224424,.163472,.999543,-.00408166,.0224387,.182182,.999499,-.00450056,.0224338,.201843,.999503,-.00483661,.0224203,.222198,.999546,-.00452928,.022315,.241714,.999508,-.00587403,.0224329,.262184,.999509,-.00638806,.0224271,.285609,.999501,-.00691028,.0224166,.309998,.999539,-.00741979,.0223989,.335262,.999454,-.00786282,.0223675,.361154,.999529,-.00811928,.0222828,.387224,.999503,-.00799941,.0221063,.41252,.999561,-.00952753,.0223057,.438006,.999557,-.0099134,.0222065,.466735,.999541,-.0100935,.0220402,.495332,.999562,-.00996821,.0218067,.523197,.999556,-.0105031,.0217096,.550223,.999561,-.0114191,.0217215,.579498,.999588,-.0111818,.0213357,.608416,.999633,-.0107725,.0208689,.635965,.999527,-.0121671,.0210149,.664476,.999508,-.0116005,.020431,.692786,.999568,-.0115604,.0199791,.719709,.999671,-.0121117,.0197415,.74737,.999688,-.0110769,.0188846,.773692,.99962,-.0122368,.0188452,.799534,.999823,-.0110325,.0178001,.825046,.999599,-.0114923,.0174221,.849075,.999619,-.0105923,.0164345,.872999,.999613,-.0105988,.0158227,.895371,.99964,-.00979861,.0148131,.917364,.99977,-.00967238,.0140721,.938002,.999726,-.00869175,.0129543,.957917,.99973,-.00866872,.0122329,.976557,.999773,-.00731956,.0108958,.994459,.999811,-.00756027,.0102715,1.01118,.999862,-.00583732,.00878781,1.02701,.999835,-.00631438,.00827529,1.04186,.999871,-.00450785,.00674583,1.05569,.999867,-.00486079,.00621041,1.06861,.999939,-.00322072,.00478301,1.08064,.999918,-.00318199,.00406395,1.09181,1.00003,-.00193348,.00280682,1.10207,.999928,-.00153729,.00198741,1.11152,.999933,-623666e-9,917714e-9,1.12009,1,-102387e-11,907581e-12,1.12813,.997866,-896716e-12,.0448334,199584e-10,.997987,-225945e-10,.0448389,502891e-9,.997987,-903781e-10,.0448388,.00201156,.997985,-203351e-9,.0448388,.00452602,.997986,-361514e-9,.0448388,.00804629,.997987,-56487e-8,.0448389,.0125724,.997988,-813423e-9,.0448389,.0181045,.997984,-.00110718,.0448387,.0246427,.997985,-.00144616,.0448388,.0321875,.997987,-.00183038,.044839,.0407392,.997983,-.00225987,.0448387,.0502986,.997991,-.00273467,.0448389,.0608667,.997984,-.00325481,.0448384,.0724444,.998002,-.00382043,.044839,.0850348,.997997,-.00443145,.0448396,.0986372,.998007,-.00508796,.0448397,.113255,.998008,-.00578985,.04484,.128891,.998003,-.00653683,.0448384,.145548,.997983,-.00732713,.0448358,.163221,.997985,-.00815454,.0448358,.181899,.998005,-.00898985,.0448286,.201533,.998026,-.00964404,.0447934,.221821,.998055,-.00922677,.044611,.241282,.99804,-.0117361,.0448245,.261791,.998048,-.0127628,.0448159,.285181,.998088,-.0138055,.0447996,.30954,.998058,-.0148206,.0447669,.334751,.998099,-.0156998,.044697,.36061,.998116,-.0161976,.0445122,.386603,.998195,-.015945,.0441711,.411844,.998168,-.0183947,.0444255,.43773,.998184,-.0197913,.0443809,.466009,.998251,-.0201426,.0440689,.494574,.998305,-.0198847,.0435632,.522405,.998273,-.0210577,.043414,.549967,.998254,-.0227901,.0433943,.578655,.998349,-.0223108,.0426529,.60758,.99843,-.0223088,.042,.635524,.998373,-.0241141,.0418987,.663621,.998425,-.0231446,.0408118,.691906,.998504,-.0233684,.0400565,.719339,.998443,-.0241652,.0394634,.74643,.99848,-.0228715,.0380002,.773086,.998569,-.023519,.0372322,.798988,.998619,-.0223108,.0356468,.824249,.998594,-.0223105,.034523,.848808,.998622,-.0213426,.0328887,.87227,.998669,-.0207912,.0314374,.895157,.998705,-.0198416,.0296925,.916769,.998786,-.0189168,.0279634,.937773,.998888,-.0178811,.0261597,.957431,.99906,-.0166845,.0242159,.976495,.999038,-.0155464,.0222638,.994169,.999237,-.0141349,.0201967,1.01112,.999378,-.0129324,.0181744,1.02692,.999433,-.0113192,.0159898,1.04174,.999439,-.0101244,.0140385,1.05559,.999614,-.00837456,.0117826,1.06852,.999722,-.00721769,.00983745,1.08069,.999817,-.00554067,.00769002,1.09176,.99983,-.00426961,.005782,1.10211,.999964,-.00273904,.00374503,1.11152,1.00001,-.00136739,.00187176,1.12031,.999946,393227e-10,-28919e-9,1.12804,.995847,-13435e-10,.0671785,19916e-9,.995464,-338387e-10,.0671527,501622e-9,.99547,-135355e-9,.0671531,.00200649,.995471,-30455e-8,.0671532,.00451461,.99547,-541423e-9,.0671531,.008026,.995471,-84598e-8,.0671531,.0125407,.99547,-.00121823,.0671531,.0180589,.99547,-.00165817,.0671531,.0245806,.995463,-.00216583,.0671526,.0321062,.995468,-.00274127,.0671527,.0406366,.995474,-.00338447,.0671534,.0501717,.995473,-.00409554,.0671533,.0607131,.995478,-.00487451,.0671531,.0722618,.995476,-.00572148,.0671532,.0848191,.995477,-.00663658,.0671539,.0983882,.995498,-.00761986,.0671541,.112972,.995509,-.00867094,.0671542,.128568,.995509,-.00978951,.0671531,.145183,.995503,-.0109725,.0671491,.162808,.995501,-.012211,.0671465,.181441,.99553,-.0134565,.0671371,.201015,.99555,-.014391,.0670831,.221206,.99558,-.014351,.0668883,.240813,.995577,-.0173997,.0671055,.261257,.995602,-.0191111,.0671178,.284467,.995623,-.0206705,.0670946,.308765,.995658,-.022184,.0670472,.333905,.995705,-.0234832,.0669417,.359677,.995719,-.0241933,.0666714,.385554,.995786,-.0243539,.066266,.410951,.995887,-.0271866,.0664367,.437163,.995944,-.0296012,.0664931,.464842,.996004,-.0301045,.0660105,.49332,.996128,-.0298311,.0652694,.521131,.996253,-.0316426,.0650739,.549167,.996244,-.0339043,.0649433,.57737,.996309,-.033329,.0638926,.606073,.996417,-.0338935,.0630849,.634527,.996372,-.0353104,.0625083,.66256,.996542,-.0348942,.0611986,.690516,.996568,-.0351614,.060069,.718317,.996711,-.0354317,.0588522,.74528,.996671,-.0349513,.0571902,.772061,.996865,-.0345622,.0555321,.798089,.996802,-.0342566,.0537816,.823178,.996992,-.0330862,.0516095,.847949,.996944,-.0324666,.0495537,.871431,.997146,-.0309544,.0470302,.894357,.997189,-.0299372,.0446043,.916142,.997471,-.0281389,.0418812,.937193,.997515,-.0268702,.0391823,.957,.997812,-.0247166,.0361338,.975936,.998027,-.0233525,.0333945,.99391,.998233,-.0209839,.0301917,1.01075,.998481,-.0194309,.027271,1.02669,.998859,-.0169728,.0240162,1.04173,.99894,-.0152322,.0210517,1.05551,.999132,-.0127497,.0178632,1.06856,.999369,-.0108282,.014787,1.08054,.999549,-.00845886,.0116185,1.09185,.999805,-.0063937,.00867209,1.10207,.99985,-.00414582,.00566823,1.1117,.999912,-.00207443,.00277562,1.12022,1.00001,870226e-10,-53766e-9,1.12832,.991943,-178672e-11,.0893382,198384e-10,.991952,-450183e-10,.089339,499849e-9,.991956,-180074e-9,.0893394,.0019994,.991955,-405167e-9,.0893393,.00449867,.991953,-720298e-9,.0893391,.00799764,.991955,-.00112548,.0893393,.0124964,.991957,-.0016207,.0893395,.0179951,.991958,-.00220601,.0893396,.0244939,.991947,-.00288137,.0893385,.0319929,.991962,-.00364693,.0893399,.0404933,.991965,-.00450264,.0893399,.049995,.99198,-.00544862,.0893411,.0604995,.99197,-.00648491,.0893397,.0720074,.991976,-.00761164,.089341,.0845207,.99198,-.00882891,.0893405,.0980413,.991982,-.0101367,.0893396,.112571,.992008,-.011535,.0893415,.128115,.992026,-.0130228,.0893414,.144672,.992064,-.0145966,.0893418,.162241,.992041,-.0162421,.0893359,.180801,.992086,-.0178888,.0893214,.200302,.992157,-.0190368,.0892401,.220332,.992181,-.0195584,.0890525,.240144,.992175,-.0227257,.0892153,.260728,.99221,-.0254195,.089304,.283473,.99222,-.0274883,.0892703,.307673,.992317,-.0294905,.0892027,.332729,.992374,-.0311861,.0890577,.358387,.992505,-.0320656,.0886994,.384102,.992568,-.0329715,.0883198,.409767,.992675,-.036006,.0883602,.436145,.992746,-.0392897,.0884591,.463217,.992873,-.0399337,.0878287,.491557,.992934,-.040231,.0870108,.519516,.993091,-.0422013,.0865857,.547741,.993259,-.0443503,.0861937,.575792,.993455,-.0446368,.0851187,.604233,.993497,-.0454299,.0840576,.632925,.993694,-.0463296,.0829671,.660985,.993718,-.0470619,.0817185,.688714,.993973,-.0468838,.0800294,.716743,.994207,-.046705,.0781286,.74377,.994168,-.0469698,.0763337,.77042,.9945,-.0456816,.0738184,.796659,.994356,-.0455518,.0715545,.821868,.994747,-.0439488,.0686085,.846572,.994937,-.0430056,.065869,.870435,.995142,-.0413414,.0626446,.893272,.995451,-.0396521,.05929,.915376,.995445,-.0378453,.0558503,.936196,.995967,-.0355219,.0520949,.956376,.996094,-.0335146,.048377,.975327,.996622,-.030682,.0442575,.993471,.996938,-.0285504,.0404693,1.01052,.997383,-.0253399,.0360903,1.02637,.997714,-.0231651,.0322176,1.04139,.998249,-.0198138,.0278433,1.05542,.998596,-.0174337,.0238759,1.06846,.998946,-.0141349,.0195944,1.08056,.99928,-.0115603,.0156279,1.09181,.999507,-.00839065,.0114607,1.10213,.999697,-.005666,.00763325,1.11169,.999869,-.00269902,.00364946,1.12042,1.00001,623836e-10,-319288e-10,1.12832,.987221,-222675e-11,.111332,197456e-10,.98739,-561116e-10,.111351,497563e-9,.987448,-224453e-9,.111357,.00199031,.987441,-505019e-9,.111357,.0044782,.987442,-897816e-9,.111357,.00796129,.987442,-.00140284,.111357,.0124396,.987444,-.00202012,.111357,.0179132,.987442,-.00274964,.111357,.0243824,.987446,-.00359147,.111357,.0318474,.987435,-.00454562,.111356,.0403086,.987461,-.00561225,.111358,.0497678,.987458,-.00679125,.111358,.0602239,.987443,-.0080828,.111356,.0716792,.987476,-.0094872,.111358,.0841364,.98749,-.0110044,.111361,.097597,.987508,-.0126344,.111362,.112062,.987494,-.0143767,.111357,.127533,.987526,-.0162307,.111359,.144015,.987558,-.0181912,.111361,.161502,.987602,-.0202393,.111355,.179979,.987692,-.022273,.111346,.199386,.987702,-.0235306,.111215,.219183,.987789,-.0247628,.111061,.239202,.987776,-.0280668,.111171,.259957,.987856,-.0316751,.111327,.282198,.987912,-.0342468,.111282,.306294,.988,-.0367205,.111198,.331219,.988055,-.0387766,.110994,.356708,.988241,-.0397722,.110547,.382234,.988399,-.0416076,.110198,.408227,.988539,-.0448192,.110137,.434662,.988661,-.0483793,.110143,.461442,.988967,-.0495895,.109453,.489318,.989073,-.0506797,.108628,.517516,.989274,-.0526953,.108003,.545844,.989528,-.054578,.107255,.573823,.989709,-.0561503,.106294,.601944,.989991,-.056866,.104896,.630855,.990392,-.0572914,.103336,.658925,.990374,-.0586224,.10189,.686661,.990747,-.0584764,.099783,.714548,.991041,-.0582662,.0974309,.74186,.991236,-.0584118,.0951678,.768422,.991585,-.0573055,.0921581,.794817,.991984,-.0564241,.0891167,.820336,.9921,-.0553608,.085805,.84493,.992749,-.0533816,.0820354,.868961,.99288,-.0518661,.0782181,.891931,.993511,-.0492492,.0738935,.914186,.993617,-.0471956,.0696402,.93532,.99411,-.044216,.0649659,.95543,.994595,-.0416654,.0603177,.974685,.994976,-.0384314,.0553493,.992807,.995579,-.0353491,.0503942,1.00996,.996069,-.0319787,.0452123,1.02606,.996718,-.028472,.0400112,1.04114,.997173,-.0250789,.0349456,1.05517,.997818,-.0213326,.029653,1.0683,.998318,-.0178509,.024549,1.0805,.998853,-.0141118,.0194197,1.09177,.999218,-.0105914,.0143869,1.1022,.999594,-.00693474,.00943517,1.11175,.99975,-.00340478,.00464051,1.12056,1.00001,109172e-9,-112821e-9,1.12853,.983383,-266524e-11,.133358,196534e-10,.981942,-671009e-10,.133162,494804e-9,.981946,-268405e-9,.133163,.00197923,.981944,-603912e-9,.133163,.00445326,.981941,-.00107362,.133162,.00791693,.981946,-.00167755,.133163,.0123703,.981944,-.00241569,.133162,.0178135,.981945,-.00328807,.133163,.0242466,.981945,-.00429472,.133162,.03167,.981955,-.00543573,.133164,.0400846,.981951,-.00671105,.133163,.0494901,.981968,-.00812092,.133165,.0598886,.981979,-.00966541,.133166,.0712811,.981996,-.0113446,.133168,.083669,.982014,-.0131585,.133169,.0970533,.982011,-.0151073,.133167,.111438,.982062,-.0171906,.133172,.126826,.9821,-.0194067,.133175,.143215,.982149,-.0217502,.133176,.160609,.982163,-.0241945,.133173,.178981,.982247,-.0265907,.133148,.198249,.982291,-.027916,.132974,.217795,.982396,-.0299663,.132868,.238042,.982456,-.0334544,.132934,.258901,.982499,-.0378636,.133137,.280639,.982617,-.0409274,.133085,.304604,.98274,-.0438523,.132985,.329376,.982944,-.0462288,.132728,.354697,.98308,-.0475995,.132228,.380102,.983391,-.0501901,.131924,.406256,.983514,-.0535899,.131737,.432735,.98373,-.0571858,.131567,.459359,.984056,-.0592353,.130932,.486637,.984234,-.0610488,.130092,.51509,.984748,-.0630758,.12923,.543461,.985073,-.0647398,.128174,.571376,.985195,-.0671941,.127133,.599414,.985734,-.0681345,.125576,.628134,.986241,-.0686089,.123639,.656399,.986356,-.0698511,.121834,.684258,.986894,-.0700931,.119454,.711818,.987382,-.0698321,.116718,.739511,.988109,-.0693975,.113699,.766267,.988363,-.0689584,.110454,.792456,.989112,-.0672353,.106602,.81813,.989241,-.0662034,.10267,.842889,.990333,-.0638938,.0981381,.867204,.990591,-.0618534,.0935388,.89038,.991106,-.0593117,.088553,.912576,.991919,-.0562676,.0832187,.934118,.992111,-.0534085,.0778302,.954254,.992997,-.0495459,.0720453,.973722,.993317,-.0463707,.0663458,.991949,.994133,-.0421245,.0601883,1.00936,.994705,-.0384977,.0542501,1.02559,.995495,-.0340956,.0479862,1.04083,.996206,-.030105,.041887,1.05497,.996971,-.0256095,.0355355,1.06824,.997796,-.0213932,.0293655,1.08056,.998272,-.0169612,.0232926,1.09182,.998857,-.0126756,.0172786,1.10219,.99939,-.00832486,.0113156,1.11192,.999752,-.00410826,.00557892,1.12075,1,150957e-9,-119101e-9,1.12885,.975169,-309397e-11,.154669,195073e-10,.975439,-779608e-10,.154712,491534e-9,.975464,-311847e-9,.154716,.00196617,.975464,-701656e-9,.154716,.00442387,.975462,-.0012474,.154715,.0078647,.975461,-.00194906,.154715,.0122886,.975464,-.00280667,.154715,.0176959,.975468,-.00382025,.154716,.0240867,.975471,-.00498985,.154716,.0314612,.975472,-.00631541,.154717,.0398199,.975486,-.00779719,.154718,.0491639,.975489,-.00943505,.154718,.0594932,.975509,-.0112295,.154721,.0708113,.97554,-.0131802,.154724,.0831176,.975557,-.0152876,.154726,.096415,.975585,-.0175512,.154728,.110705,.975605,-.0199713,.154729,.125992,.975645,-.0225447,.154729,.142272,.975711,-.0252649,.154735,.159549,.975788,-.0280986,.154736,.177805,.975872,-.0308232,.154704,.196911,.975968,-.0324841,.154525,.216324,.976063,-.0351281,.154432,.236628,.976157,-.0388618,.15446,.257539,.976204,-.0437704,.154665,.278975,.976358,-.047514,.154652,.302606,.976571,-.0508638,.154535,.327204,.976725,-.0534995,.154221,.352276,.977013,-.0555547,.153737,.377696,.977294,-.0586728,.153403,.403855,.977602,-.0622715,.15312,.430333,.977932,-.0658166,.152755,.456855,.978241,-.0689877,.152233,.483668,.978602,-.0712805,.15132,.512097,.979234,-.0732775,.150235,.540455,.97977,-.075163,.148978,.568486,.979995,-.0778026,.147755,.596524,.98078,-.0791854,.146019,.624825,.981628,-.0799666,.143906,.653403,.982067,-.0808532,.141561,.681445,.98271,-.0816024,.139025,.708918,.983734,-.0812511,.135764,.736594,.98431,-.0806201,.132152,.763576,.985071,-.0801605,.12846,.789797,.98618,-.0784208,.124084,.815804,.986886,-.0766643,.1193,.840869,.987485,-.0747744,.114236,.864952,.988431,-.0716701,.108654,.888431,.988886,-.0691609,.102994,.910963,.990024,-.0654048,.0967278,.932629,.990401,-.0619765,.090384,.95313,.991093,-.0579296,.0837885,.972587,.992018,-.0536576,.0770171,.991184,.992536,-.0493719,.0701486,1.00863,.993421,-.0444813,.062953,1.02494,.993928,-.040008,.0560455,1.04017,.994994,-.0347982,.04856,1.05463,.995866,-.0301017,.0416152,1.06807,.996916,-.0248225,.0342597,1.08039,.997766,-.0199229,.0271668,1.09177,.998479,-.0147422,.0201387,1.10235,.99921,-.00980173,.0131944,1.11206,.999652,-.0047426,.00640712,1.12104,.999998,891673e-10,-10379e-8,1.12906,.967868,-351885e-11,.175947,193569e-10,.968001,-886733e-10,.175972,487782e-9,.96801,-354697e-9,.175973,.00195115,.968012,-798063e-9,.175974,.00439006,.968011,-.00141879,.175973,.00780461,.968011,-.00221686,.175973,.0121948,.968016,-.00319231,.175974,.0175607,.968019,-.00434515,.175974,.0239027,.968018,-.00567538,.175974,.0312208,.968033,-.00718308,.175977,.0395158,.968049,-.00886836,.175979,.0487885,.968047,-.0107312,.175978,.0590394,.968072,-.0127719,.175981,.0702705,.968108,-.0149905,.175986,.0824836,.968112,-.0173866,.175985,.0956783,.968173,-.0199611,.175993,.109862,.96827,-.0227128,.176008,.125033,.968292,-.025639,.17601,.141193,.968339,-.0287299,.176007,.158336,.968389,-.0319399,.176001,.176441,.968501,-.034941,.175962,.195359,.968646,-.0370812,.175793,.214686,.968789,-.0402329,.175708,.234973,.96886,-.0442601,.1757,.255871,.969013,-.049398,.175876,.277238,.969242,-.0539932,.17594,.300326,.969419,-.0577299,.175781,.324702,.969763,-.0605643,.175432,.349527,.970093,-.0634488,.174992,.374976,.970361,-.0670589,.174611,.401097,.970825,-.0708246,.174226,.427496,.971214,-.0742871,.173684,.453858,.971622,-.0782608,.173186,.480637,.972175,-.0813151,.172288,.508655,.972944,-.0832678,.170979,.536973,.973595,-.0855964,.169573,.565138,.974345,-.0882163,.168152,.593222,.975233,-.0901671,.166314,.621201,.976239,-.0912111,.163931,.649919,.977289,-.0916959,.161106,.678011,.978076,-.0927061,.158272,.705717,.979533,-.0925562,.15475,.733228,.980335,-.0918159,.150638,.760454,.981808,-.0908508,.146201,.786918,.983061,-.0896172,.141386,.812953,.984148,-.0871588,.135837,.838281,.985047,-.0850624,.130135,.862594,.986219,-.0818541,.123882,.88633,.987043,-.0784523,.117126,.908952,.988107,-.0749601,.110341,.930744,.988955,-.0703548,.102885,.951728,.989426,-.0662798,.0954167,.971166,.990421,-.0610834,.0876331,.989984,.991032,-.0562936,.0797785,1.00765,.992041,-.0508154,.0718166,1.02434,.992794,-.0454045,.0637125,1.03976,.993691,-.0398194,.0555338,1.05418,.994778,-.0341482,.0473388,1.06772,.995915,-.028428,.0391016,1.08028,.997109,-.022642,.0309953,1.09185,.998095,-.0168738,.0230288,1.10247,.998985,-.0111274,.0150722,1.11229,.999581,-.00543881,.00740605,1.12131,1.00003,162239e-9,-105549e-9,1.12946,.959505,-393734e-11,.196876,191893e-10,.959599,-992157e-10,.196895,483544e-9,.959641,-396868e-9,.196903,.0019342,.959599,-892948e-9,.196895,.00435193,.959603,-.00158747,.196896,.0077368,.959604,-.00248042,.196896,.0120888,.959605,-.00357184,.196896,.0174082,.959605,-.00486169,.196896,.0236949,.959613,-.00635008,.196897,.0309497,.959619,-.00803696,.196898,.0391725,.959636,-.00992255,.196901,.0483649,.959634,-.0120067,.1969,.0585266,.959675,-.0142898,.196906,.0696609,.959712,-.0167717,.196911,.0817678,.959752,-.0194524,.196918,.0948494,.959807,-.0223321,.196925,.10891,.959828,-.0254091,.196924,.123947,.959906,-.0286815,.196934,.139968,.960005,-.0321371,.196944,.156968,.960071,-.0357114,.196936,.17491,.960237,-.0389064,.196882,.193597,.960367,-.041623,.196731,.21285,.960562,-.0452655,.196654,.233075,.960735,-.0496207,.196643,.253941,.960913,-.0549379,.196774,.275278,.961121,-.0603414,.196893,.297733,.96139,-.0644244,.196717,.321877,.961818,-.067556,.196314,.346476,.962175,-.0712709,.195917,.371907,.96255,-.0752848,.1955,.397916,.963164,-.0792073,.195026,.424229,.963782,-.0828225,.194424,.450637,.964306,-.0873119,.193831,.477288,.964923,-.0911051,.192973,.504716,.966048,-.093251,.19151,.533053,.967024,-.0958983,.190013,.561366,.968038,-.09835,.188253,.589464,.969152,-.100754,.186257,.617433,.970557,-.102239,.183775,.645801,.972104,-.102767,.180645,.674278,.973203,-.103492,.177242,.702004,.975123,-.103793,.17345,.729529,.97641,-.102839,.168886,.756712,.978313,-.101687,.163892,.783801,.980036,-.100314,.158439,.809671,.981339,-.097836,.152211,.835402,.982794,-.0950006,.145679,.860081,.984123,-.0920994,.138949,.883757,.984918,-.0878641,.131283,.90685,.985999,-.083939,.123464,.928786,.987151,-.0791234,.115324,.94983,.987827,-.0739332,.106854,.96962,.988806,-.0688088,.0982691,.98861,.989588,-.0628962,.0893456,1.00667,.990438,-.0573146,.0805392,1.02344,.991506,-.0509433,.0713725,1.03933,.992492,-.0448724,.0623732,1.05378,.993663,-.0383497,.0530838,1.06747,.994956,-.0319593,.0439512,1.08007,.99634,-.025401,.0347803,1.09182,.99761,-.0189687,.0257954,1.1025,.99863,-.0124441,.0169893,1.11247,.99947,-.00614003,.00829498,1.12151,1.00008,216624e-9,-146107e-9,1.12993,.950129,-434955e-11,.217413,190081e-10,.950264,-10957e-8,.217444,47884e-8,.9503,-438299e-9,.217451,.00191543,.950246,-986124e-9,.21744,.00430951,.950246,-.00175311,.21744,.00766137,.950245,-.00273923,.21744,.011971,.950253,-.00394453,.217441,.0172385,.950258,-.00536897,.217442,.0234641,.950267,-.00701262,.217444,.030648,.950277,-.00887551,.217446,.038791,.950284,-.0109576,.217446,.0478931,.950312,-.0132591,.217451,.0579568,.950334,-.01578,.217454,.0689821,.950378,-.0185204,.217462,.0809714,.950417,-.0214803,.217467,.0939265,.950488,-.0246594,.217479,.10785,.950534,-.0280565,.217483,.122743,.950633,-.0316685,.217498,.138611,.950698,-.0354787,.217499,.155442,.950844,-.0394003,.217507,.173208,.950999,-.0426812,.217419,.191605,.951221,-.0461302,.217317,.21084,.951412,-.0502131,.217238,.230945,.951623,-.0549183,.21722,.251745,.951867,-.0604493,.217306,.273001,.952069,-.0665189,.217466,.294874,.952459,-.0709179,.217266,.318732,.952996,-.0746112,.216891,.34318,.953425,-.0789252,.216503,.36849,.953885,-.0833293,.216042,.394373,.954617,-.087371,.215469,.420505,.955429,-.0914054,.214802,.446907,.956068,-.0961671,.214146,.473522,.957094,-.10048,.213286,.50052,.958372,-.103248,.211796,.528715,.959654,-.106033,.21016,.557065,.961305,-.108384,.208149,.585286,.962785,-.111122,.206024,.613334,.964848,-.112981,.203442,.641334,.966498,-.113717,.19996,.669955,.968678,-.114121,.196105,.698094,.970489,-.114524,.191906,.725643,.972903,-.113792,.186963,.752856,.974701,-.112406,.181343,.780013,.976718,-.110685,.175185,.806268,.978905,-.108468,.168535,.832073,.980267,-.105061,.161106,.857149,.981967,-.101675,.153387,.881145,.983063,-.0974492,.145199,.904255,.984432,-.0925815,.136527,.926686,.985734,-.0877983,.127584,.947901,.986228,-.081884,.118125,.968111,.98719,-.0761208,.108594,.98719,.988228,-.0698196,.0989996,1.00559,.989046,-.0632739,.0890074,1.02246,.990242,-.056522,.0790832,1.03841,.991252,-.0495272,.0689182,1.05347,.992542,-.0425373,.0588592,1.06724,.994096,-.0353198,.0486833,1.08009,.995593,-.028235,.0385977,1.09177,.99711,-.0209511,.0286457,1.10274,.998263,-.0139289,.0188497,1.11262,.999254,-.0067359,.009208,1.12191,.999967,141846e-9,-657764e-10,1.13024,.935608,-474692e-11,.236466,187817e-10,.93996,-11971e-8,.237568,473646e-9,.939959,-478845e-9,.237567,.0018946,.939954,-.0010774,.237566,.00426284,.939956,-.00191538,.237566,.00757842,.939954,-.00299277,.237566,.0118413,.93996,-.00430961,.237567,.0170518,.939969,-.00586589,.237569,.02321,.939982,-.00766166,.237572,.0303164,.939987,-.00969686,.237572,.0383711,.939997,-.0119715,.237574,.0473751,.940031,-.0144858,.237581,.0573298,.940073,-.0172399,.237589,.0682366,.94012,-.0202335,.237598,.080097,.940162,-.0234663,.237604,.0929116,.940237,-.0269387,.237615,.106686,.940328,-.0306489,.237632,.121421,.940419,-.0345917,.237645,.137115,.940522,-.0387481,.237654,.153766,.940702,-.0429906,.237661,.17133,.940871,-.0465089,.237561,.189502,.941103,-.050531,.23748,.208616,.941369,-.0550657,.237423,.228595,.941641,-.0601337,.237399,.249287,.941903,-.0658804,.237443,.270467,.942224,-.0722674,.237597,.292024,.942633,-.0771788,.237419,.315272,.943172,-.0815623,.237068,.339579,.943691,-.0863973,.236682,.364717,.944382,-.0911536,.236213,.390435,.945392,-.0952967,.235562,.416425,.946185,-.0998948,.234832,.442772,.947212,-.104796,.234114,.469347,.948778,-.10928,.233222,.496162,.950149,-.113081,.231845,.523978,.951989,-.115893,.230005,.552295,.953921,-.11846,.227862,.580569,.955624,-.12115,.225439,.608698,.958234,-.123373,.222635,.636696,.960593,-.124519,.219093,.665208,.963201,-.124736,.214749,.693557,.965642,-.125012,.210059,.721334,.968765,-.124661,.204935,.748613,.971753,-.122996,.198661,.776224,.973751,-.120998,.191823,.802461,.976709,-.118583,.184359,.828399,.977956,-.115102,.176437,.853693,.979672,-.111077,.167681,.877962,.981816,-.10688,.158872,.901564,.98238,-.101469,.149398,.924057,.983964,-.0960013,.139436,.945751,.984933,-.0899626,.12943,.966272,.985694,-.0832973,.11894,.985741,.986822,-.0767082,.108349,1.00407,.987725,-.0693614,.0976026,1.02154,.98877,-.06211,.086652,1.03757,.990129,-.0544143,.0756182,1.05296,.991337,-.046744,.0645753,1.06683,.992978,-.0387931,.0534683,1.0798,.994676,-.030973,.0424137,1.09181,.99645,-.0230311,.0314035,1.10286,.997967,-.0152065,.0206869,1.11291,.99922,-.00744837,.010155,1.12237,1.00002,240209e-9,-752767e-10,1.13089,.922948,-515351e-11,.255626,186069e-10,.928785,-129623e-9,.257244,468009e-9,.928761,-51849e-8,.257237,.00187202,.928751,-.0011666,.257235,.00421204,.928751,-.00207395,.257234,.0074881,.928754,-.00324055,.257235,.0117002,.92876,-.00466639,.257236,.0168486,.928763,-.00635149,.257237,.0229334,.928774,-.00829584,.257239,.029955,.928791,-.0104995,.257243,.0379139,.928804,-.0129623,.257245,.0468108,.928847,-.0156846,.257255,.0566473,.92889,-.0186661,.257263,.0674246,.928924,-.0219067,.257268,.0791433,.928989,-.0254066,.257282,.0918076,.92909,-.0291651,.257301,.105419,.92918,-.0331801,.257316,.119978,.92929,-.0374469,.257332,.135491,.929453,-.041939,.257357,.151948,.929586,-.0464612,.257347,.169275,.929858,-.0503426,.257269,.187257,.930125,-.0548409,.257199,.206204,.930403,-.0598063,.257149,.22601,.930726,-.0652437,.257122,.246561,.931098,-.0712376,.257153,.267618,.931396,-.0777506,.257237,.288993,.931947,-.0832374,.257124,.311527,.932579,-.0883955,.25683,.335697,.933194,-.0937037,.256444,.360634,.934013,-.0987292,.255939,.386126,.935307,-.103215,.255282,.412018,.936374,-.108234,.254538,.438292,.93776,-.113234,.253728,.464805,.939599,-.118013,.25275,.491464,.941036,-.122661,.251404,.518751,.94337,-.125477,.249435,.547133,.945318,-.128374,.247113,.575456,.947995,-.130996,.244441,.60372,.950818,-.133438,.241352,.63174,.954378,-.135004,.237849,.659971,.957151,-.135313,.233188,.688478,.960743,-.13521,.228001,.716767,.964352,-.135007,.222249,.744349,.967273,-.133523,.21542,.771786,.969767,-.131155,.208039,.798639,.973195,-.128492,.200076,.824774,.975557,-.125094,.191451,.850222,.977692,-.120578,.18184,.874761,.98026,-.115882,.172102,.898497,.981394,-.110372,.161859,.921636,.982386,-.10415,.15108,.943467,.983783,-.0978128,.140407,.964045,.98422,-.0906171,.129058,.98398,.985447,-.0832921,.117614,1.00276,.986682,-.0754412,.10585,1.02047,.987326,-.0673885,.0940943,1.03678,.988707,-.0592565,.0822093,1.05218,.990185,-.050717,.070192,1.06652,.991866,-.0423486,.0582081,1.07965,.993897,-.0336118,.0460985,1.09188,.995841,-.0252178,.0342737,1.10307,.997605,-.0164893,.0224829,1.11324,.999037,-.00817112,.0110647,1.12262,1.00003,291686e-9,-168673e-9,1.13139,.915304,-552675e-11,.275999,183285e-10,.91668,-139285e-9,.276414,461914e-9,.916664,-55713e-8,.276409,.00184763,.916653,-.00125354,.276406,.00415715,.916651,-.00222851,.276405,.00739053,.916655,-.00348205,.276406,.0115478,.916653,-.00501414,.276405,.0166291,.916667,-.00682478,.276409,.0226346,.91668,-.00891398,.276412,.0295648,.91669,-.0112817,.276413,.0374199,.916727,-.013928,.276422,.0462016,.916759,-.0168528,.276429,.0559101,.916793,-.0200558,.276436,.0665466,.916849,-.0235373,.276448,.0781139,.916964,-.0272973,.276474,.0906156,.917047,-.0313344,.276491,.104051,.917152,-.0356465,.276511,.118424,.917286,-.0402271,.276533,.133736,.917469,-.0450408,.276564,.149978,.917686,-.0497872,.276563,.167057,.917953,-.0540937,.276493,.184846,.918228,-.0590709,.276437,.203614,.918572,-.0644277,.276398,.223212,.918918,-.0702326,.276362,.243584,.919356,-.076484,.276383,.264465,.919842,-.0830808,.276434,.285701,.920451,-.0892972,.276407,.307559,.921113,-.095016,.276128,.331501,.921881,-.100771,.275754,.356207,.923027,-.106029,.275254,.381477,.924364,-.111029,.274595,.40722,.925818,-.116345,.273841,.433385,.92746,-.121424,.272913,.459848,.929167,-.12657,.271837,.486493,.931426,-.131581,.270575,.513432,.934001,-.135038,.268512,.541502,.936296,-.138039,.266135,.569658,.939985,-.140687,.263271,.598375,.943516,-.143247,.260058,.626563,.94782,-.145135,.256138,.654711,.951023,-.145733,.251154,.683285,.955338,-.145554,.245562,.711831,.959629,-.145008,.239265,.739573,.963123,-.144003,.232064,.767027,.966742,-.141289,.224036,.794359,.969991,-.138247,.215305,.820361,.973403,-.134786,.206051,.846548,.975317,-.129966,.195914,.871541,.977647,-.12471,.185184,.895313,.980137,-.119086,.174161,.918398,.981031,-.112297,.162792,.940679,.982037,-.105372,.150952,.961991,.983164,-.097821,.138921,.981913,.983757,-.0897245,.126611,1.00109,.985036,-.0815974,.114228,1.01902,.986289,-.0727725,.101389,1.03604,.987329,-.0639323,.0886476,1.05149,.989193,-.0548109,.0756837,1.06619,.990716,-.045687,.0627581,1.07948,.992769,-.0364315,.0498337,1.09172,.99524,-.0271761,.0370305,1.1033,.997154,-.0179609,.0243959,1.11353,.998845,-.00878063,.0119567,1.12319,1.00002,259038e-9,-108146e-9,1.13177,.903945,-591681e-11,.295126,181226e-10,.903668,-148672e-9,.295037,455367e-9,.903677,-594683e-9,.29504,.00182145,.903673,-.00133805,.295039,.00409831,.903666,-.00237872,.295036,.00728584,.903668,-.00371676,.295037,.0113842,.903679,-.00535212,.29504,.0163936,.903684,-.00728479,.295041,.0223141,.903698,-.00951473,.295044,.0291462,.903718,-.0120419,.295049,.0368904,.903754,-.0148664,.295058,.0455477,.903801,-.017988,.29507,.0551194,.903851,-.0214064,.295082,.0656058,.903921,-.0251219,.295097,.0770109,.904002,-.0291337,.295116,.0893354,.904111,-.033441,.29514,.102583,.904246,-.0380415,.295169,.116755,.904408,-.0429258,.295202,.131853,.904637,-.0480468,.295245,.147869,.904821,-.0529208,.295214,.164658,.905163,-.0577748,.295185,.182274,.905469,-.0631763,.295143,.200828,.905851,-.068917,.295112,.2202,.906322,-.0750861,.295104,.240372,.906761,-.0815855,.295086,.261082,.90735,-.0882138,.295095,.282123,.908087,-.095082,.295139,.303563,.908826,-.101488,.29492,.327028,.909832,-.107577,.294577,.351464,.911393,-.113033,.294115,.376497,.912804,-.118629,.293446,.402115,.914081,-.124232,.292581,.428111,.91637,-.129399,.29166,.454442,.91814,-.134892,.290422,.481024,.921179,-.140069,.289194,.507924,.924544,-.144431,.287421,.535557,.927995,-.147498,.284867,.563984,.931556,-.150197,.281722,.5923,.935777,-.152711,.278207,.620832,.940869,-.154836,.274148,.649069,.945994,-.155912,.269057,.677746,.949634,-.155641,.262799,.706293,.955032,-.154809,.256097,.734278,.95917,-.153678,.248618,.761751,.962931,-.151253,.239794,.789032,.966045,-.147625,.230281,.815422,.96971,-.143964,.220382,.841787,.972747,-.139464,.209846,.867446,.975545,-.133459,.198189,.892004,.978381,-.127424,.186362,.915458,.979935,-.120506,.173964,.937948,.980948,-.11282,.161429,.959732,.982234,-.104941,.148557,.980118,.982767,-.0962905,.135508,.999463,.983544,-.0873625,.122338,1.01756,.984965,-.0783447,.108669,1.03492,.986233,-.0684798,.0949911,1.05087,.987796,-.0590867,.0811386,1.0656,.989885,-.0489145,.0673099,1.0794,.991821,-.0391,.0535665,1.09174,.99448,-.029087,.0397529,1.10341,.996769,-.019114,.0261463,1.11383,.998641,-.00947007,.0128731,1.1237,.999978,446316e-9,-169093e-9,1.13253,.888362,-627064e-11,.312578,178215e-10,.889988,-157791e-9,.313148,448451e-9,.889825,-631076e-9,.313092,.00179356,.88984,-.00141994,.313097,.00403554,.889828,-.0025243,.313092,.00717429,.889831,-.00394421,.313093,.0112099,.889831,-.00567962,.313093,.0161425,.889844,-.00773051,.313096,.0219724,.889858,-.0100968,.3131,.0286999,.889882,-.0127786,.313106,.0363256,.889918,-.0157757,.313116,.0448509,.889967,-.0190878,.313129,.0542758,.89003,-.022715,.313145,.0646032,.890108,-.0266566,.313165,.0758339,.890218,-.0309131,.313193,.0879729,.890351,-.0354819,.313226,.101019,.89051,-.0403613,.313263,.114979,.890672,-.0455385,.313294,.129848,.890882,-.0509444,.313333,.145616,.891189,-.0559657,.313324,.162122,.891457,-.0613123,.313281,.179524,.891856,-.0671488,.313281,.197855,.892312,-.0732732,.313268,.216991,.892819,-.0797865,.313263,.236924,.893369,-.0865269,.313247,.257433,.894045,-.0931592,.313205,.278215,.894884,-.100532,.313276,.299467,.895832,-.107716,.313205,.322276,.897043,-.114099,.312873,.34642,.898515,-.119941,.312331,.371187,.900191,-.126044,.311731,.396656,.90188,-.131808,.310859,.422488,.904359,-.137289,.309857,.448744,.906923,-.142991,.308714,.475239,.910634,-.148253,.307465,.501983,.914502,-.153332,.305774,.529254,.919046,-.156646,.303156,.557709,.923194,-.159612,.299928,.586267,.928858,-.162027,.296245,.614925,.934464,-.164203,.291832,.643187,.939824,-.165602,.286565,.671601,.944582,-.165383,.280073,.700213,.949257,-.164439,.272891,.728432,.954389,-.162953,.264771,.756082,.958595,-.161007,.255927,.78369,.962138,-.157243,.245769,.810769,.966979,-.152872,.235127,.836999,.969566,-.148209,.22347,.862684,.972372,-.142211,.211147,.887847,.975916,-.135458,.198606,.911843,.978026,-.128398,.185498,.934795,.979686,-.120313,.17171,.956787,.980748,-.11166,.158159,.978046,.981622,-.103035,.144399,.997693,.982356,-.0930328,.13001,1.01642,.983308,-.0834627,.115778,1.03366,.985037,-.0732249,.101327,1.05014,.986493,-.0628145,.086554,1.06507,.988484,-.0526556,.0720413,1.07907,.991051,-.0415744,.0571151,1.09189,.993523,-.0314275,.0426643,1.10369,.99628,-.0203603,.0279325,1.11423,.998344,-.0102446,.0138182,1.12421,.999997,42612e-8,-193628e-9,1.1333,.871555,-660007e-11,.329176,174749e-10,.875255,-166579e-9,.330571,441051e-9,.875644,-666394e-9,.330718,.00176441,.875159,-.00149903,.330536,.00396899,.87516,-.00266493,.330536,.007056,.875158,-.00416393,.330535,.0110251,.87516,-.00599598,.330535,.0158764,.875163,-.00816108,.330536,.0216101,.875174,-.0106591,.330538,.0282266,.875199,-.0134899,.330545,.0357266,.875257,-.0166538,.330563,.0441117,.875304,-.0201501,.330575,.0533821,.875373,-.0239785,.330595,.0635395,.875464,-.0281389,.330619,.0745872,.875565,-.0326301,.330645,.0865255,.875691,-.0374516,.330676,.0993599,.875897,-.0425993,.330733,.113093,.876091,-.0480576,.330776,.127722,.876353,-.0537216,.330826,.143227,.876649,-.0589807,.330809,.159462,.877034,-.0647865,.330819,.176642,.877443,-.0709789,.330817,.194702,.877956,-.0774782,.330832,.213577,.878499,-.0843175,.330822,.233246,.879144,-.0912714,.330804,.253512,.879982,-.0980824,.330766,.274137,.88097,-.105823,.330864,.295209,.882051,-.113671,.330896,.317226,.883397,-.120303,.330545,.341068,.884987,-.12667,.330068,.365613,.886789,-.133118,.329418,.390807,.889311,-.139024,.328683,.416494,.891995,-.144971,.327729,.442618,.895106,-.150747,.326521,.469131,.899527,-.156283,.325229,.495921,.90504,-.161707,.32378,.523162,.909875,-.165661,.32122,.55092,.91561,-.168755,.317942,.579928,.921225,-.171193,.313983,.608539,.927308,-.17319,.309636,.636854,.933077,-.174819,.304262,.66523,.938766,-.175002,.297563,.693609,.943667,-.173946,.289613,.722157,.949033,-.172221,.281227,.750021,.953765,-.169869,.271545,.777466,.95804,-.166578,.261034,.804853,.962302,-.161761,.249434,.831569,.966544,-.156636,.237484,.857779,.969372,-.150784,.224395,.883051,.972486,-.143672,.210786,.907864,.975853,-.135772,.196556,.931223,.977975,-.127942,.182307,.954061,.979122,-.118347,.167607,.97531,.980719,-.109112,.152739,.995666,.981223,-.0991789,.137932,1.01475,.98216,-.0883553,.122692,1.03253,.983379,-.0780825,.107493,1.04917,.985434,-.0665646,.0917791,1.06464,.987332,-.0557714,.0764949,1.07896,.990004,-.0442805,.060721,1.09199,.992975,-.0331676,.0452284,1.10393,.995811,-.0219547,.0297934,1.11476,.9982,-.0107613,.0146415,1.12484,1.00002,248678e-9,-14555e-8,1.13413,.859519,-693595e-11,.347264,171673e-10,.859843,-17503e-8,.347394,433219e-9,.859656,-700076e-9,.347319,.00173277,.859671,-.00157517,.347325,.00389875,.859669,-.00280028,.347324,.00693112,.85967,-.0043754,.347324,.01083,.859665,-.00630049,.347321,.0155954,.859685,-.0085755,.347328,.0212278,.859694,-.0112003,.347329,.0277273,.859718,-.0141747,.347336,.0350946,.85976,-.0174988,.347348,.0433314,.85982,-.0211722,.347366,.0524384,.859892,-.0251941,.347387,.0624168,.860006,-.0295649,.347422,.0732708,.860122,-.0342825,.347453,.0849999,.860282,-.0393462,.347499,.0976102,.860482,-.0447513,.347554,.111104,.860719,-.0504775,.347614,.125479,.860998,-.0563577,.347666,.140703,.861322,-.0619473,.347662,.156681,.861724,-.0681277,.347684,.173597,.862198,-.0746567,.347709,.191371,.862733,-.0815234,.347727,.209976,.863371,-.0886643,.347744,.229351,.86414,-.0957908,.347734,.24934,.865138,-.102912,.34772,.269797,.866182,-.110924,.3478,.290654,.867436,-.119223,.347911,.312074,.869087,-.126197,.347649,.335438,.870859,-.133145,.347222,.359732,.872997,-.139869,.346645,.38467,.875939,-.146089,.345935,.41019,.879012,-.152334,.345012,.436218,.883353,-.15821,.343924,.462641,.888362,-.164097,.342636,.489449,.895026,-.169528,.341351,.516629,.900753,-.174408,.339115,.544109,.906814,-.17751,.335809,.572857,.912855,-.180101,.331597,.601554,.919438,-.182116,.32698,.630198,.925962,-.183494,.321449,.658404,.931734,-.184159,.314595,.686625,.93762,-.18304,.306462,.71531,.943858,-.181323,.297514,.744272,.948662,-.178683,.287447,.771462,.953299,-.175379,.276166,.798593,.957346,-.170395,.263758,.8256,.962565,-.165042,.251019,.852575,.966075,-.158655,.237011,.878316,.969048,-.151707,.222518,.90329,.972423,-.143271,.207848,.927745,.975833,-.134824,.192463,.950859,.977629,-.125444,.1768,.972947,.978995,-.114949,.161033,.993263,.980533,-.104936,.145523,1.01337,.980745,-.0935577,.129799,1.03128,.981814,-.0822956,.113486,1.04825,.983943,-.0710082,.0972925,1.06405,.986141,-.0587931,.0808138,1.0785,.988878,-.0472755,.0644915,1.09204,.992132,-.0349128,.0478128,1.10413,.9953,-.0232407,.031621,1.11527,.998117,-.0112713,.0154935,1.12551,1.00003,339743e-9,-195763e-9,1.13504,.845441,-729126e-11,.364305,169208e-10,.843588,-183164e-9,.363506,425067e-9,.843412,-73253e-8,.36343,.00169999,.843401,-.00164818,.363426,.00382495,.843399,-.00293008,.363425,.00679993,.843401,-.00457822,.363425,.010625,.843394,-.00659249,.363421,.0153002,.843398,-.00897282,.363421,.0208258,.843415,-.0117191,.363426,.0272024,.843438,-.0148312,.363432,.0344305,.843483,-.018309,.363447,.0425116,.84356,-.0221521,.363472,.0514471,.843646,-.0263597,.363499,.061238,.843743,-.0309315,.363527,.0718873,.84388,-.0358658,.363569,.0833969,.844079,-.0411624,.363631,.0957742,.844279,-.0468128,.363688,.109015,.844549,-.0527923,.363761,.123124,.844858,-.0588204,.363817,.138044,.84522,-.0647573,.36383,.153755,.845669,-.0713181,.363879,.170394,.846155,-.0781697,.363908,.187861,.846789,-.0853913,.363969,.206176,.847502,-.0928086,.363999,.225244,.8484,-.10005,.363997,.244926,.849461,-.107615,.364008,.265188,.850562,-.115814,.364055,.28587,.851962,-.124334,.364179,.306926,.854326,-.131995,.364233,.329605,.856295,-.139338,.363856,.35359,.858857,-.146346,.363347,.37831,.862428,-.152994,.362807,.403722,.866203,-.159463,.361963,.429537,.871629,-.165623,.36112,.456,.877365,-.171649,.359917,.482773,.883744,-.177151,.35848,.509705,.890693,-.182381,.356523,.537215,.897278,-.186076,.3533,.565493,.903958,-.188602,.349095,.594293,.910908,-.190755,.344215,.623165,.918117,-.192063,.338606,.651573,.924644,-.192758,.331544,.679869,.931054,-.192238,.323163,.708668,.937303,-.190035,.313529,.737201,.943387,-.187162,.303152,.764977,.948494,-.183876,.29146,.792683,.952546,-.178901,.277917,.819228,.958077,-.173173,.264753,.846559,.962462,-.16645,.25002,.872962,.966569,-.159452,.234873,.898729,.969108,-.15074,.218752,.923126,.973072,-.141523,.202673,.947278,.975452,-.132075,.186326,.969938,.977784,-.121257,.169396,.991325,.97899,-.110182,.153044,1.01123,.979777,-.0989634,.136485,1.0299,.980865,-.0865894,.119343,1.04727,.982432,-.0746115,.102452,1.06341,.984935,-.0621822,.0852423,1.07834,.987776,-.0495694,.0678546,1.092,.99103,-.0372386,.0506917,1.1043,.99474,-.0244353,.0333316,1.11576,.997768,-.0121448,.0164348,1.12617,1.00003,31774e-8,-169504e-9,1.13598,.825551,-756799e-11,.378425,165099e-10,.82664,-190922e-9,.378923,416504e-9,.826323,-763495e-9,.378779,.0016656,.826359,-.00171789,.378795,.00374768,.82636,-.00305402,.378795,.00666259,.826368,-.00477185,.378798,.0104104,.826364,-.00687131,.378795,.0149912,.826368,-.00935232,.378795,.0204054,.826376,-.0122146,.378797,.0266532,.826399,-.0154581,.378803,.0337355,.82646,-.0190825,.378824,.0416537,.826525,-.0230873,.378846,.0504091,.826614,-.0274719,.378876,.0600032,.82674,-.0322355,.378917,.0704393,.826888,-.0373766,.378964,.0817195,.827078,-.0428936,.379024,.0938492,.827318,-.0487778,.379099,.106828,.82764,-.0549935,.379199,.120659,.827926,-.0611058,.379227,.13526,.828325,-.0675054,.379275,.150713,.828801,-.0743455,.379332,.167034,.8294,-.0815523,.379415,.184209,.830094,-.0890779,.379495,.202203,.8309,-.096736,.379555,.220945,.831943,-.104135,.379577,.240306,.833037,-.112106,.379604,.260317,.834278,-.120554,.379668,.2808,.836192,-.129128,.3799,.301654,.838671,-.137541,.380109,.323502,.840939,-.14523,.379809,.347176,.844575,-.15248,.379593,.371706,.848379,-.159607,.37909,.39688,.853616,-.166267,.378617,.422702,.858921,-.172698,.377746,.448919,.865324,-.178823,.376749,.475661,.872207,-.184542,.375363,.502599,.880018,-.189836,.373657,.529914,.88694,-.194294,.370673,.557683,.894779,-.197022,.36662,.586848,.902242,-.199108,.36138,.615831,.909914,-.200398,.355434,.644478,.917088,-.20094,.348173,.672905,.923888,-.200671,.339482,.701327,.930495,-.198773,.32956,.730101,.937247,-.195394,.318363,.758383,.943108,-.191956,.306323,.786539,.948296,-.187227,.292576,.813637,.953472,-.181165,.278234,.840793,.958485,-.174119,.263054,.867712,.962714,-.166564,.246756,.893635,.966185,-.158181,.229945,.919028,.970146,-.148275,.212633,.943413,.973491,-.138157,.195229,.966627,.975741,-.127574,.178048,.988817,.977238,-.11554,.160312,1.00924,.978411,-.10364,.142857,1.02845,.979811,-.0913122,.125317,1.04648,.98116,-.0782558,.107627,1.06284,.983543,-.0655957,.0895862,1.07798,.986789,-.0520411,.0713756,1.092,.990292,-.0389727,.053228,1.10484,.994187,-.025808,.0351945,1.11642,.997499,-.0126071,.0173198,1.12703,.999999,275604e-9,-148602e-9,1.13674,.81075,-78735e-10,.394456,161829e-10,.808692,-198293e-9,.393453,407564e-9,.80846,-792877e-9,.39334,.00162965,.808595,-.00178416,.393407,.00366711,.808597,-.00317182,.393408,.00651934,.808598,-.00495589,.393408,.0101866,.808591,-.00713627,.393403,.0146689,.808592,-.00971285,.393402,.0199667,.80861,-.0126855,.393407,.0260803,.808633,-.0160538,.393413,.0330107,.80868,-.0198175,.393429,.0407589,.808748,-.0239758,.393453,.0493264,.808854,-.0285286,.39349,.0587161,.808992,-.0334748,.39354,.0689304,.809141,-.0388116,.393588,.0799707,.809352,-.0445375,.39366,.0918432,.809608,-.0506427,.393742,.104549,.809915,-.0570708,.393834,.118085,.810253,-.0633526,.393885,.132377,.810687,-.0700966,.393953,.147537,.811233,-.0772274,.394047,.163543,.811865,-.0847629,.394148,.180394,.812648,-.0925663,.394265,.198051,.813583,-.100416,.394363,.216443,.814683,-.108119,.394402,.235502,.815948,-.11644,.394489,.255242,.817278,-.125036,.394542,.275441,.819605,-.133655,.39486,.296094,.822256,-.142682,.395248,.317309,.825349,-.150756,.395241,.340516,.829605,-.158392,.395285,.364819,.83391,-.165801,.394922,.389736,.839808,-.172677,.394691,.415409,.845708,-.179448,.394006,.441546,.853025,-.185746,.393279,.46832,.859666,-.191684,.391655,.495302,.86789,-.197146,.390068,.52262,.875845,-.201904,.38727,.550336,.882634,-.205023,.382688,.578825,.891076,-.207098,.377543,.608103,.900589,-.208474,.371752,.63723,.90791,-.209068,.364016,.665769,.915971,-.208655,.355593,.694428,.923455,-.20729,.345439,.723224,.931514,-.203821,.334099,.751925,.937885,-.19986,.321069,.780249,.943136,-.194993,.306571,.8077,.948818,-.189132,.291556,.83497,.954433,-.181617,.275745,.86188,.959078,-.173595,.258695,.888562,.962705,-.164855,.240825,.914008,.966753,-.155129,.22268,.939145,.970704,-.144241,.204542,.963393,.973367,-.133188,.185927,.985983,.975984,-.121146,.167743,1.00704,.976994,-.108366,.149218,1.02715,.978485,-.0956746,.13131,1.0455,.980074,-.0820733,.112513,1.06221,.98225,-.0684061,.0938323,1.07782,.98553,-.0549503,.0749508,1.09199,.989529,-.0407857,.055848,1.10508,.993536,-.0271978,.0368581,1.11684,.997247,-.0132716,.0181845,1.12789,1,431817e-9,-198809e-9,1.13792,.785886,-812608e-11,.405036,157669e-10,.790388,-205278e-9,.407355,398297e-9,.790145,-820824e-9,.407231,.00159263,.790135,-.00184681,.407226,.00358336,.790119,-.00328316,.407218,.00637039,.790126,-.00512988,.40722,.0099539,.79013,-.00738684,.407221,.0143339,.790135,-.0100538,.407221,.0195107,.790134,-.0131306,.407217,.0254848,.79016,-.0166169,.407224,.0322572,.790197,-.020512,.407236,.0398284,.790273,-.0248157,.407263,.0482014,.790381,-.029527,.407304,.0573777,.790521,-.0346446,.407355,.0673602,.790704,-.0401665,.40742,.0781522,.790925,-.0460896,.407499,.0897582,.791195,-.0524017,.407589,.10218,.791522,-.0590121,.407691,.11541,.791878,-.0654876,.407748,.12939,.792361,-.0725207,.407849,.144237,.792942,-.0799844,.407963,.159924,.79362,-.0877896,.408087,.176425,.794529,-.0958451,.408259,.193733,.795521,-.103827,.408362,.211756,.796778,-.111937,.408482,.230524,.798027,-.120521,.408547,.249967,.799813,-.129242,.408721,.269926,.802387,-.138048,.409148,.290338,.805279,-.147301,.409641,.311193,.809251,-.155895,.410154,.333611,.813733,-.163942,.410297,.357615,.819081,-.171666,.410373,.382339,.825427,-.178905,.410348,.407828,.83172,-.185812,.409486,.434034,.83877,-.192318,.408776,.460493,.845817,-.198249,.407176,.487346,.854664,-.204034,.405719,.514832,.863495,-.208908,.403282,.542401,.871883,-.212765,.399293,.570683,.88065,-.214911,.393803,.599947,.89004,-.216214,.387536,.62932,.898476,-.216745,.379846,.658319,.906738,-.216387,.370625,.687138,.914844,-.215053,.360139,.71601,.923877,-.212007,.348849,.745124,.931925,-.207481,.335639,.773366,.938054,-.202418,.320798,.801636,.943895,-.196507,.304772,.829055,.949468,-.189009,.288033,.856097,.955152,-.180539,.270532,.88301,.959403,-.171437,.251639,.909296,.963309,-.161661,.232563,.934868,.967399,-.150425,.213231,.959662,.972009,-.138659,.194247,.98302,.97433,-.126595,.174718,1.00517,.975823,-.113205,.155518,1.02566,.976371,-.0996096,.136709,1.04418,.978705,-.0860754,.117571,1.06146,.981477,-.0714438,.0980046,1.07777,.984263,-.0572304,.0782181,1.09214,.988423,-.0428875,.0584052,1.10553,.993,-.0282442,.038522,1.11758,.99704,-.0140183,.0190148,1.12864,.999913,369494e-9,-145203e-9,1.13901,.777662,-84153e-10,.423844,154403e-10,.770458,-211714e-9,.419915,38845e-8,.770716,-846888e-9,.420055,.00155386,.770982,-.00190567,.420202,.00349653,.770981,-.00338782,.420201,.00621606,.77098,-.00529338,.4202,.00971274,.770983,-.00762223,.4202,.0139867,.770985,-.0103741,.420198,.0190381,.770996,-.0135489,.4202,.0248677,.771029,-.0171461,.420212,.0314764,.771052,-.0211647,.420215,.0388648,.771131,-.0256048,.420245,.047036,.771235,-.0304647,.420284,.0559911,.771383,-.0357436,.420341,.0657346,.771591,-.0414392,.420423,.0762694,.771819,-.0475462,.420506,.0875984,.772123,-.0540506,.420617,.099727,.772464,-.060797,.42072,.112637,.772855,-.0675393,.420799,.126313,.773317,-.0748323,.420893,.140824,.773981,-.0825681,.421058,.15617,.774746,-.0906307,.421226,.172322,.77566,-.0988982,.421397,.189253,.776837,-.106994,.421569,.206912,.778097,-.115528,.421704,.225359,.779588,-.124317,.421849,.24447,.781574,-.133139,.422097,.264156,.784451,-.142179,.422615,.284318,.787682,-.15165,.423269,.304902,.792433,-.160771,.424396,.3265,.797359,-.169166,.424772,.35014,.803986,-.177149,.425475,.374768,.809504,-.184745,.424996,.399928,.815885,-.19173,.424247,.425796,.823513,-.198525,.423515,.452287,.832549,-.204709,.422787,.479321,.841653,-.210447,.421187,.506718,.850401,-.215501,.418519,.53432,.859854,-.219752,.414715,.56242,.869364,-.222305,.409462,.591558,.878837,-.223744,.402926,.621074,.888636,-.224065,.395043,.650538,.898132,-.223742,.38564,.679538,.907181,-.222308,.375378,.708674,.915621,-.219837,.363212,.737714,.9239,-.215233,.349313,.767014,.931644,-.209592,.334162,.795133,.938887,-.203644,.317943,.823228,.945282,-.196349,.300581,.850822,.950758,-.18742,.282195,.877594,.956146,-.177879,.262481,.904564,.960355,-.167643,.242487,.930741,.965256,-.156671,.222668,.955868,.968029,-.144123,.201907,.979869,.97251,-.131305,.18202,1.00291,.974925,-.118335,.161909,1.02392,.975402,-.103714,.142129,1.0433,.976987,-.089415,.122447,1.06089,.979677,-.0748858,.102248,1.07713,.983184,-.0596086,.0814851,1.09218,.987466,-.0447671,.0609484,1.10585,.992348,-.0295217,.0401835,1.11829,.996674,-.0143917,.0198163,1.12966,1.00003,321364e-9,-149983e-9,1.1402,.757901,-869074e-11,.436176,151011e-10,.751195,-217848e-9,.432317,378533e-9,.751178,-871373e-9,.432307,.0015141,.751195,-.00196061,.432317,.0034068,.751198,-.00348552,.432318,.00605659,.751195,-.00544599,.432315,.00946353,.751207,-.00784203,.43232,.013628,.751213,-.0106732,.43232,.0185499,.751221,-.0139393,.432319,.0242302,.751244,-.0176398,.432325,.0306694,.7513,-.0217743,.432348,.0378698,.751358,-.0263412,.432367,.0458321,.751458,-.0313396,.432404,.0545587,.751608,-.0367682,.432464,.0640543,.7518,-.0426246,.43254,.0743222,.752065,-.0489031,.432645,.0853668,.752376,-.0555828,.432762,.0971911,.752715,-.0623861,.432859,.109768,.753137,-.069415,.432958,.123126,.753676,-.0770039,.433099,.137308,.754345,-.084971,.433272,.15229,.755235,-.0932681,.433504,.168075,.756186,-.10171,.433693,.184625,.757363,-.110019,.433857,.201897,.75884,-.11887,.434102,.220014,.760467,-.127881,.434306,.238778,.762969,-.136766,.434751,.258172,.765823,-.14612,.43529,.278062,.769676,-.15566,.436236,.298437,.774909,-.165177,.437754,.319532,.77994,-.17402,.438343,.342505,.785757,-.182201,.438609,.366693,.792487,-.190104,.438762,.391668,.80038,-.197438,.438795,.417494,.808494,-.204365,.438226,.443933,.817695,-.210714,.437283,.470929,.828111,-.216651,.436087,.498569,.837901,-.221804,.433717,.526165,.847813,-.226318,.430133,.554155,.858314,-.229297,.425213,.582822,.868891,-.230999,.418576,.612847,.878941,-.231155,.410405,.642445,.888809,-.230935,.400544,.672024,.898089,-.229343,.389613,.701366,.908081,-.226886,.377197,.730763,.916819,-.222676,.363397,.759642,.924968,-.216835,.347437,.788775,.932906,-.210245,.32995,.817135,.940025,-.202992,.312262,.844912,.946101,-.19436,.293313,.872164,.952835,-.184125,.273638,.899443,.957347,-.173657,.252385,.926389,.961434,-.162204,.231038,.951947,.965522,-.14979,.209834,.976751,.969412,-.136307,.188821,1.00022,.973902,-.122527,.168013,1.02229,.974045,-.108213,.147634,1.04199,.975775,-.0927397,.12705,1.06019,.978383,-.0778212,.106309,1.07711,.98211,-.0621216,.0849279,1.09245,.986517,-.0463847,.0633519,1.10651,.991696,-.0309353,.0419698,1.11903,.996349,-.0150914,.0206272,1.13073,1.00003,442449e-9,-231396e-9,1.14146,.727498,-885074e-11,.441528,145832e-10,.730897,-223525e-9,.443589,368298e-9,.730796,-893996e-9,.443528,.00147303,.730805,-.00201149,.443533,.00331433,.730814,-.00357596,.443538,.00589222,.730815,-.00558734,.443538,.00920678,.730822,-.00804544,.44354,.0132582,.730836,-.0109501,.443545,.0180468,.730848,-.0143008,.443546,.0235732,.730871,-.0180969,.443552,.0298382,.730915,-.022338,.443567,.0368438,.730982,-.0270225,.443591,.044591,.731076,-.0321491,.443627,.0530831,.731245,-.0377166,.443699,.0623243,.73144,-.0437216,.443777,.0723181,.7317,-.0501576,.443881,.0830691,.732034,-.0569942,.444014,.0945809,.732388,-.0638756,.444113,.106825,.732853,-.071203,.444247,.119859,.733473,-.0790076,.444442,.13369,.734195,-.0871937,.444645,.148304,.735069,-.095696,.444877,.163702,.736169,-.10426,.445133,.179861,.73747,-.112853,.44537,.196778,.738991,-.12199,.445651,.214496,.740865,-.131153,.445958,.232913,.743637,-.140245,.446548,.251977,.746797,-.149722,.447246,.271551,.751517,-.159341,.448656,.291774,.756156,-.169106,.449866,.312455,.761519,-.178436,.450919,.334552,.768295,-.186904,.451776,.358491,.776613,-.195117,.452832,.383446,.783966,-.202695,.45249,.408945,.793542,-.20985,.452587,.435364,.803192,-.216403,.451852,.462336,.813892,-.22251,.450708,.48987,.824968,-.227676,.4486,.517697,.835859,-.232443,.445156,.545975,.846825,-.235775,.440351,.574483,.858085,-.237897,.433641,.604246,.868825,-.238074,.425354,.634101,.879638,-.237661,.415383,.664201,.889966,-.236186,.404136,.693918,.899479,-.233599,.390917,.723481,.908769,-.229737,.376352,.75258,.917966,-.223836,.360372,.781764,.926304,-.217067,.342551,.811139,.934626,-.209309,.324238,.839585,.941841,-.20071,.304484,.867044,.94789,-.190602,.283607,.894579,.954196,-.179253,.262205,.921743,.958383,-.167646,.239847,.948026,.963119,-.155073,.218078,.973296,.966941,-.141426,.195899,.998135,.970836,-.126849,.174121,1.02021,.973301,-.112296,.153052,1.04085,.97448,-.0964965,.131733,1.05946,.977045,-.080489,.10997,1.07693,.980751,-.064844,.0881657,1.09254,.985475,-.0481938,.0657987,1.10697,.991089,-.0319185,.0435215,1.12004,.996122,-.0158088,.0214779,1.13173,1.00001,372455e-9,-200295e-9,1.14291,.708622,-907597e-11,.45304,141962e-10,.711162,-228911e-9,.454662,358052e-9,.709812,-914446e-9,.453797,.00143034,.709865,-.00205819,.453834,.00321935,.709864,-.00365894,.453833,.00572331,.709855,-.00571692,.453826,.00894278,.709862,-.00823201,.453828,.012878,.709875,-.011204,.453832,.0175295,.709896,-.0146323,.453839,.0228978,.709925,-.0185163,.453847,.0289839,.709974,-.0228551,.453866,.0357894,.710045,-.0276473,.453892,.0433161,.710133,-.032891,.453924,.0515665,.710292,-.0385851,.453992,.0605458,.710485,-.0447254,.45407,.0702574,.710769,-.0513051,.454192,.0807077,.711106,-.0582733,.454329,.091896,.711516,-.0652866,.45446,.103814,.712071,-.0728426,.454653,.116508,.712676,-.0808307,.45484,.129968,.713476,-.0892216,.455096,.144206,.714377,-.0979047,.455346,.159212,.715579,-.106531,.455647,.174973,.716977,-.115492,.455961,.191504,.71862,-.124821,.456315,.208835,.72084,-.134079,.4568,.226869,.723786,-.143427,.457521,.245582,.727464,-.153061,.458475,.264957,.732771,-.162768,.460239,.284948,.736515,-.172627,.460899,.30522,.743519,-.182487,.463225,.326717,.750041,-.191295,.464027,.350113,.758589,-.199746,.465227,.374782,.767703,-.207584,.465877,.400226,.777484,-.214973,.465996,.426442,.788792,-.221796,.466019,.453688,.800194,-.228038,.465083,.481246,.811234,-.233346,.462506,.509086,.822859,-.238073,.459257,.537338,.835082,-.241764,.454863,.566108,.846332,-.244241,.448163,.595126,.858355,-.244736,.439709,.625574,.87034,-.244278,.429837,.65617,.881027,-.24255,.418002,.686029,.891007,-.239912,.404325,.716039,.900874,-.236133,.389222,.745518,.911072,-.230672,.373269,.775026,.920359,-.22356,.355083,.804521,.928604,-.215591,.335533,.834045,.937175,-.206503,.315278,.861612,.942825,-.196684,.293653,.889131,.949805,-.185116,.271503,.916853,.955535,-.172703,.248821,.943541,.959843,-.159978,.225591,.970132,.964393,-.146375,.202719,.994709,.968008,-.131269,.179928,1.0186,.971013,-.11569,.158007,1.03928,.973334,-.1003,.13624,1.05887,.975775,-.0833352,.1138,1.07652,.979579,-.0668981,.0913141,1.09297,.984323,-.0500902,.0683051,1.10734,.990351,-.0332377,.0451771,1.12084,.995823,-.0161491,.0221705,1.13296,1.0001,234083e-9,-108712e-9,1.14441,.683895,-924677e-11,.46015,137429e-10,.68833,-233383e-9,.463134,346865e-9,.688368,-933547e-9,.463159,.00138748,.688367,-.00210049,.463159,.00312187,.688369,-.00373415,.463159,.00555004,.688377,-.00583449,.463163,.00867216,.688386,-.00840128,.463166,.0124884,.688398,-.0114343,.463169,.0169993,.688418,-.0149329,.463175,.0222054,.688453,-.0188964,.463188,.028108,.688515,-.0233239,.463214,.0347085,.68857,-.0282136,.463231,.0420091,.688679,-.033564,.463276,.0500132,.688854,-.0393733,.463356,.0587255,.689038,-.0456354,.46343,.0681476,.689321,-.0523433,.463553,.0782897,.689662,-.059412,.463693,.0891501,.690188,-.0665736,.4639,.100735,.690755,-.0743106,.464107,.113074,.691405,-.0824722,.464329,.126161,.692198,-.0910484,.464585,.140007,.693196,-.0998778,.464893,.154612,.69454,-.108651,.465285,.169984,.695921,-.117855,.465596,.186106,.697749,-.12734,.466056,.203034,.700375,-.136714,.466771,.220703,.703395,-.146386,.467579,.239062,.707904,-.156096,.469067,.258188,.711673,-.165904,.469851,.277759,.717489,-.175812,.471815,.297935,.724051,-.185931,.47389,.318916,.731965,-.195238,.47587,.341591,.741151,-.204021,.477523,.366062,.751416,-.212113,.478881,.391396,.761848,-.21979,.479226,.417599,.771886,-.2267,.478495,.444401,.783998,-.232991,.477622,.472084,.796523,-.238645,.475833,.500193,.808851,-.243396,.472568,.52865,.821191,-.247226,.467857,.557362,.834261,-.250102,.461871,.586768,.846762,-.251056,.453543,.617085,.859867,-.250604,.443494,.647659,.871948,-.248783,.431711,.678119,.882967,-.245855,.417911,.708399,.892826,-.242168,.401993,.738256,.90332,-.237062,.385371,.767999,.913633,-.22997,.366837,.798191,.922774,-.221687,.346372,.827756,.931371,-.212345,.325682,.856425,.938929,-.20206,.303665,.884299,.944821,-.190981,.280786,.912023,.951792,-.178065,.2573,.939669,.957712,-.164634,.233448,.96655,.961912,-.150863,.209504,.992366,.966382,-.13577,.18597,1.01633,.969588,-.119593,.162905,1.03843,.971777,-.103203,.14053,1.05841,.97433,-.0865888,.117909,1.07632,.978686,-.0690829,.0944101,1.09326,.983281,-.0516568,.0705671,1.10796,.989562,-.034558,.0468592,1.12182,.995465,-.0167808,.0229846,1.1342,.999991,373016e-9,-235606e-9,1.1459,.662251,-939016e-11,.468575,132714e-10,.666634,-237624e-9,.471675,335842e-9,.666411,-950385e-9,.471516,.00134321,.666399,-.00213833,.471509,.00302221,.666386,-.0038014,.471499,.00537283,.666405,-.00593958,.471511,.00839533,.666406,-.00855253,.471508,.0120898,.666428,-.0116401,.471519,.0164569,.666444,-.0152015,.471522,.0214971,.66649,-.0192362,.471543,.027212,.666537,-.0237428,.471558,.033603,.666617,-.0287198,.471591,.0406728,.666718,-.0341647,.471631,.0484238,.666889,-.0400759,.47171,.0568621,.667104,-.0464479,.471805,.0659915,.667374,-.0532677,.471923,.0758178,.667772,-.0603805,.472098,.0863425,.668371,-.0677392,.472363,.0975917,.668971,-.0756028,.472596,.109567,.669696,-.0839293,.472869,.122272,.670481,-.0926683,.473126,.135718,.6715,-.1016,.473442,.149914,.672911,-.110566,.47389,.164882,.674512,-.119984,.474354,.180602,.67651,-.129574,.474922,.19711,.679292,-.139106,.475764,.214371,.682798,-.148993,.476886,.232405,.686955,-.158737,.478179,.251153,.691406,-.168754,.479432,.270436,.697438,-.178703,.481481,.290374,.704761,-.188955,.484143,.311044,.713599,-.198814,.487007,.333003,.723194,-.207869,.488962,.357144,.732601,-.216189,.489815,.382169,.744193,-.22398,.490888,.408227,.754907,-.231156,.490355,.434928,.767403,-.23747,.489548,.462599,.78107,-.243503,.488274,.490908,.793893,-.248114,.484843,.519421,.807296,-.25222,.4803,.548561,.820529,-.255265,.474097,.577772,.833716,-.256741,.466041,.607782,.848403,-.25637,.456547,.638807,.860755,-.254804,.443946,.670058,.874012,-.251834,.430852,.700749,.885619,-.247867,.414903,.731446,.896069,-.242634,.397276,.761191,.906266,-.236093,.378535,.791053,.916759,-.227543,.358038,.821298,.92523,-.21783,.335705,.850747,.93436,-.207534,.313797,.879258,.941631,-.195983,.289671,.907734,.947564,-.183567,.265319,.935206,.953681,-.169345,.240815,.962739,.960008,-.154909,.216119,.989227,.964145,-.140161,.192096,1.01465,.968171,-.123411,.167855,1.03737,.969859,-.106525,.144817,1.05767,.972666,-.0891023,.12149,1.0761,.977055,-.0718094,.0975306,1.09336,.982527,-.0534213,.0730217,1.10878,.989001,-.0355579,.0483366,1.12285,.99512,-.0176383,.023938,1.13548,1.00007,368831e-9,-211581e-9,1.14744,.651047,-960845e-11,.484101,12922e-9,.644145,-241347e-9,.478968,324578e-9,.64396,-965142e-9,.478831,.00129798,.64396,-.00217154,.47883,.00292046,.643968,-.00386049,.478835,.00519202,.643974,-.00603186,.478838,.0081128,.643977,-.0086854,.478836,.011683,.643982,-.0118207,.478834,.0159031,.644024,-.0154374,.478856,.0207743,.644059,-.0195343,.478868,.0262975,.644122,-.0241103,.478896,.0324747,.644207,-.0291638,.478933,.039309,.64432,-.0346919,.478981,.0468029,.644481,-.0406919,.479053,.0549614,.644722,-.047159,.479169,.0637909,.645013,-.0540748,.479302,.0732974,.645503,-.0612001,.479541,.0834898,.646117,-.0687303,.479829,.0943873,.646707,-.0767846,.480061,.105991,.647431,-.0852465,.480343,.11831,.64831,-.0940719,.48066,.131348,.649486,-.103056,.481083,.14514,.650864,-.112261,.481528,.159676,.652604,-.121852,.482102,.174979,.654825,-.131505,.482813,.191079,.657876,-.141189,.483876,.207927,.661339,-.151239,.48499,.225586,.665463,-.161091,.486279,.243947,.670542,-.171235,.487968,.262957,.677361,-.181347,.49053,.282781,.685672,-.191679,.493862,.303311,.694551,-.201781,.49699,.324607,.703753,-.211164,.498884,.347916,.713703,-.219675,.500086,.372628,.725911,-.227836,.501554,.398694,.73862,-.23533,.502193,.425529,.752118,-.241786,.501811,.453209,.76579,-.247865,.500185,.481381,.779568,-.252696,.497159,.51011,.793991,-.256802,.492765,.539322,.808182,-.259942,.486827,.569078,.821698,-.261703,.478386,.598818,.836009,-.262006,.468772,.629762,.849824,-.260333,.456352,.661366,.863888,-.257398,.442533,.69295,.876585,-.253264,.426573,.723608,.888665,-.248026,.408964,.754378,.899537,-.241487,.389677,.784761,.9094,-.233463,.368516,.814688,.920166,-.223397,.346624,.845009,.928899,-.21255,.322717,.874431,.937156,-.200869,.298698,.902922,.943861,-.188387,.273491,.931356,.949557,-.174341,.247866,.958854,.955862,-.158994,.222496,.986098,.961721,-.143664,.197522,1.01229,.965976,-.127412,.17302,1.03571,.968652,-.109798,.148954,1.05699,.971084,-.0916787,.125044,1.07587,.975584,-.0739634,.100577,1.09372,.98122,-.055322,.0753666,1.10948,.988253,-.0366825,.0498899,1.12394,.99482,-.0180389,.024611,1.13694,1.00001,229839e-9,-188283e-9,1.14919,.613867,-964198e-11,.479449,123452e-10,.621485,-244534e-9,.485399,313091e-9,.621429,-978202e-9,.485353,.00125245,.62112,-.00220004,.485114,.00281687,.621119,-.0039111,.485112,.00500783,.621122,-.00611091,.485112,.00782498,.621133,-.00879922,.485117,.0112687,.621152,-.0119756,.485125,.0153394,.621183,-.0156396,.485139,.0200382,.621227,-.0197898,.485158,.0253663,.621298,-.0244253,.485192,.0313261,.621388,-.0295441,.485233,.0379204,.621507,-.0351432,.485286,.0451523,.621693,-.0412198,.485378,.0530277,.621933,-.0477673,.485495,.0615522,.622232,-.0547574,.485635,.0707316,.622809,-.0619417,.485943,.0805883,.623407,-.069625,.486232,.0911267,.62406,-.077796,.486516,.102354,.624835,-.0863731,.486838,.114279,.625758,-.095251,.487188,.126902,.627043,-.104299,.487695,.140285,.628438,-.113724,.488163,.154397,.630325,-.123417,.488858,.169267,.632801,-.133137,.489754,.184941,.635784,-.143052,.490815,.20136,.639406,-.153132,.492048,.218643,.643872,-.163143,.49363,.236615,.6499,-.17333,.496009,.255449,.657201,-.183622,.498994,.275006,.666221,-.194019,.502888,.295354,.674419,-.204192,.505459,.316244,.683729,-.21406,.507771,.33849,.695584,-.222854,.510245,.363166,.708583,-.231315,.512293,.389071,.721233,-.238911,.512747,.415737,.735134,-.245657,.512482,.443331,.750179,-.251879,.511526,.471891,.765073,-.256911,.508935,.500892,.779794,-.261144,.504341,.530294,.794801,-.264316,.498515,.560144,.810339,-.266276,.491015,.590213,.824818,-.266981,.481126,.620865,.839375,-.265778,.468685,.652687,.853043,-.262748,.453925,.684759,.867335,-.258474,.437912,.716209,.88037,-.253187,.419648,.747508,.891711,-.246476,.39982,.77797,.902896,-.238735,.37879,.808586,.913601,-.22885,.355891,.838843,.923019,-.217656,.331773,.869014,.933432,-.205539,.307356,.898512,.939691,-.192595,.281321,.9269,.946938,-.178945,.255441,.955297,.952372,-.163587,.229013,.983231,.95909,-.147214,.203179,1.00971,.963675,-.13064,.17792,1.03438,.968247,-.113121,.152898,1.05625,.97001,-.0945824,.128712,1.07598,.974458,-.0755648,.103349,1.094,.980168,-.0571998,.0776731,1.1104,.987295,-.0377994,.0514445,1.12491,.994432,-.0186417,.025429,1.13851,.999975,542714e-9,-282356e-9,1.15108,.592656,-980249e-11,.486018,119532e-10,.598467,-247275e-9,.490781,301531e-9,.597934,-988317e-9,.490343,.00120517,.597903,-.00222366,.490319,.0027116,.597913,-.00395315,.490327,.00482077,.597919,-.00617653,.490329,.00753264,.597936,-.00889375,.490339,.0108478,.597956,-.0121043,.490347,.0147668,.597992,-.0158073,.490365,.0192905,.598032,-.0200017,.490382,.0244204,.598109,-.0246865,.49042,.0301593,.598215,-.0298594,.490474,.03651,.59833,-.0355167,.490524,.0434757,.598525,-.0416559,.490624,.0510629,.598778,-.0482692,.490753,.0592781,.599135,-.0553114,.49094,.0681304,.599802,-.062542,.491328,.0776467,.600361,-.0703638,.491598,.0878184,.60101,-.0786256,.491882,.0986573,.601811,-.0872962,.492232,.11018,.602861,-.0962284,.492684,.1224,.604167,-.10538,.493213,.135354,.605693,-.114896,.493799,.149034,.607682,-.124654,.494576,.163469,.610672,-.13456,.4959,.178747,.613313,-.144581,.496713,.194723,.617603,-.154703,.498499,.211617,.622174,-.16489,.500188,.229183,.628855,-.175164,.503072,.247786,.636963,-.185565,.506798,.267116,.644866,-.195911,.509719,.28702,.653741,-.206104,.512776,.307763,.664942,-.216447,.516812,.329631,.67633,-.22552,.519181,.353515,.690012,-.234316,.521681,.379226,.704243,-.242032,.523129,.405901,.719396,-.249172,.523768,.433585,.734471,-.255543,.522541,.462085,.750539,-.260697,.520217,.491233,.766365,-.26501,.516293,.521094,.781677,-.268409,.509708,.551014,.797132,-.270399,.501944,.581463,.812655,-.271247,.492025,.612402,.828592,-.270708,.480424,.643798,.844044,-.268085,.465955,.67682,.857305,-.263459,.448425,.708496,.87114,-.258151,.430243,.74046,.884936,-.251171,.410578,.771583,.895772,-.243305,.38862,.802234,.906961,-.234037,.365214,.833179,.917775,-.222714,.34116,.86353,.927883,-.210175,.31572,.893557,.936617,-.196925,.289159,.922976,.943384,-.182788,.261996,.951606,.949713,-.167965,.235324,.979958,.955818,-.151109,.208408,1.00765,.961344,-.133834,.182591,1.03329,.965469,-.115987,.156958,1.0557,.968693,-.09746,.132239,1.07583,.973165,-.0778514,.106195,1.09451,.979387,-.0585067,.0797669,1.11137,.98671,-.0390409,.0530263,1.12643,.994093,-.019408,.0263163,1.14016,1.00002,540029e-9,-194487e-9,1.15299,.574483,-989066e-11,.494533,114896e-10,.574478,-249127e-9,.494528,289403e-9,.574607,-996811e-9,.494637,.00115797,.574396,-.00224241,.494458,.00260498,.574377,-.00398632,.49444,.00463102,.574386,-.00622836,.494445,.00723623,.574401,-.0089683,.494453,.010421,.574419,-.0122056,.49446,.0141859,.574459,-.0159396,.494481,.0185322,.574525,-.0201692,.49452,.0234617,.574587,-.0248924,.494547,.0289762,.574697,-.0301074,.494604,.0350797,.574853,-.0358114,.494688,.0417767,.575027,-.041999,.494772,.0490718,.575294,-.0486618,.494915,.0569728,.575733,-.0557148,.495173,.0654955,.576356,-.0630489,.495537,.0746612,.576944,-.0709285,.495836,.0844615,.57765,-.0792723,.496177,.0949142,.578491,-.0880167,.496563,.10603,.579639,-.0969462,.497096,.117841,.580989,-.10622,.497684,.130367,.582587,-.115861,.498337,.143609,.584951,-.125605,.499414,.157625,.587602,-.135608,.500518,.172413,.59076,-.145742,.501767,.187999,.594992,-.155934,.503542,.20445,.600656,-.166303,.506135,.221764,.607816,-.176681,.509542,.24002,.61522,-.187071,.51263,.258992,.623702,-.197465,.516021,.278773,.634192,-.207816,.520422,.299377,.644936,-.218183,.524073,.320802,.657888,-.2278,.528049,.34384,.670666,-.236747,.52986,.36916,.685626,-.24484,.531892,.395867,.701304,-.252071,.532727,.423488,.717727,-.258714,.532146,.452201,.733914,-.264211,.529883,.481579,.750529,-.26859,.5259,.511558,.76747,-.272046,.51999,.542042,.785189,-.274225,.513083,.572799,.800954,-.275189,.502936,.603816,.816962,-.274946,.490921,.635461,.83336,-.272695,.47684,.6676,.848143,-.268223,.459405,.70051,.861818,-.262768,.440319,.732902,.876828,-.255872,.420123,.765084,.889312,-.247703,.398379,.796391,.900412,-.238381,.374496,.827333,.912251,-.227783,.349874,.858385,.921792,-.214832,.323181,.888652,.931273,-.200949,.296624,.917763,.940295,-.186537,.269211,.947878,.946812,-.171538,.241447,.977016,.953588,-.155254,.213829,1.00501,.958841,-.137156,.186807,1.03179,.963746,-.118699,.160706,1.05502,.966468,-.0998358,.135504,1.07568,.971178,-.0805186,.109131,1.09479,.97831,-.0599348,.0818293,1.1123,.985886,-.0399661,.0545872,1.12771,.994021,-.0198682,.0269405,1.14186,1.00009,271022e-9,-12989e-8,1.15514,.538716,-990918e-11,.486732,109675e-10,.550656,-250642e-9,.497518,277412e-9,.55057,-.00100265,.497441,.00110974,.550903,-.00225672,.497733,.00249779,.550568,-.00401046,.497438,.00443906,.550574,-.00626613,.49744,.00693637,.550591,-.0090226,.497449,.00998921,.550623,-.0122795,.497469,.0135984,.550667,-.0160361,.497495,.0177654,.550724,-.0202908,.497526,.0224915,.550792,-.0250421,.497557,.0277795,.550918,-.0302878,.49763,.0336334,.551058,-.0360241,.497701,.0400573,.551276,-.0422473,.497824,.0470585,.551551,-.0489441,.497977,.0546433,.552074,-.0559596,.498312,.0628367,.552681,-.0633978,.498679,.071646,.553324,-.0713176,.499031,.0810746,.554011,-.0797268,.499365,.091129,.55488,-.0885238,.499779,.101837,.556171,-.0974417,.500444,.113239,.557498,-.106841,.501025,.125316,.559299,-.116533,.501864,.138128,.561647,-.126298,.502967,.151695,.564347,-.136388,.504129,.16604,.567863,-.146576,.505713,.181207,.572569,-.156832,.507953,.197259,.578919,-.167323,.511186,.214258,.585387,-.177712,.514042,.232038,.593134,-.188184,.517484,.250733,.603295,-.198717,.522345,.270454,.613854,-.209177,.526751,.290807,.626092,-.219644,.531595,.312202,.637868,-.229494,.534721,.334435,.652458,-.238718,.538304,.359184,.666985,-.247061,.539875,.385637,.683301,-.254652,.541042,.41328,.69998,-.261376,.540735,.441903,.717824,-.267085,.539139,.471609,.734617,-.271465,.534958,.501446,.753663,-.27528,.53032,.532571,.770512,-.277617,.522134,.563641,.787356,-.278525,.51206,.595067,.806252,-.278512,.50119,.627226,.822061,-.277023,.486791,.659402,.838959,-.273175,.470467,.692874,.85379,-.267238,.450688,.725702,.868268,-.260327,.429741,.75832,.881994,-.251946,.407223,.790189,.893885,-.242432,.383214,.821625,.905118,-.231904,.357297,.853011,.916045,-.219545,.330733,.883773,.927614,-.205378,.303916,.914435,.936005,-.190388,.275941,.944502,.944533,-.1749,.247493,.974439,.950758,-.158588,.218996,1.00286,.957078,-.141027,.191559,1.0304,.962448,-.121507,.164457,1.05466,.964993,-.102068,.138636,1.0761,.970017,-.0822598,.111861,1.09541,.97661,-.062033,.0843438,1.11317,.985073,-.0409832,.0558496,1.12911,.993515,-.020146,.0275331,1.1438,1.00006,27329e-8,-107883e-9,1.15736,.525324,-999341e-11,.498153,105385e-10,.526513,-251605e-9,.499277,265329e-9,.526517,-.00100641,.499282,.0010613,.526588,-.00226466,.499337,.00238823,.526539,-.0040255,.499302,.00424535,.526547,-.00628954,.499306,.00663364,.526561,-.00905628,.499313,.00955337,.526593,-.0123253,.499334,.0130054,.526642,-.0160957,.499365,.0169911,.5267,-.0203661,.499396,.0215122,.526792,-.0251347,.499451,.0265718,.526904,-.0303985,.499511,.0321732,.527079,-.0361554,.499617,.0383231,.527285,-.0423982,.499731,.045026,.527602,-.0491121,.499924,.0522936,.528166,-.0561127,.500306,.0601528,.52879,-.0635988,.5007,.0686059,.529421,-.071581,.501048,.0776518,.530144,-.0799854,.501421,.0873148,.531062,-.0888032,.501884,.0976084,.532374,-.0977643,.50259,.108588,.533828,-.107197,.50329,.120234,.53581,-.116887,.504312,.132602,.538063,-.126755,.505365,.145721,.5409,-.136819,.506668,.159617,.544882,-.147117,.508731,.174369,.550238,-.157446,.511601,.190028,.556038,-.167988,.514431,.206587,.563031,-.178364,.517808,.224046,.571543,-.189007,.521937,.242503,.582255,-.199546,.527415,.261977,.59272,-.210084,.531682,.282162,.605648,-.220448,.537123,.303426,.61785,-.230593,.540664,.325323,.632223,-.240238,.544467,.348993,.648819,-.24887,.547594,.375462,.665825,-.256657,.54912,.403024,.683389,-.263711,.549294,.431773,.701495,-.269666,.547649,.461494,.719197,-.274169,.543786,.491623,.737906,-.278124,.538644,.522994,.756652,-.280632,.531057,.554775,.775279,-.281741,.521972,.586441,.792688,-.281652,.509613,.618596,.811894,-.280345,.496497,.651462,.827938,-.277128,.47968,.684023,.844837,-.271646,.460688,.718024,.859239,-.264397,.438872,.751207,.874088,-.256144,.41577,.784232,.887693,-.246311,.391369,.816191,.899402,-.235497,.365872,.847828,.910973,-.223631,.338618,.87934,.92204,-.209874,.310803,.910325,.930987,-.194265,.281802,.940695,.94,-.178125,.252836,.970958,.948018,-.161479,.224239,1.00078,.955141,-.144038,.195857,1.0288,.960513,-.124915,.168487,1.05371,.963964,-.104284,.141495,1.07596,.968713,-.0838732,.114437,1.09628,.975524,-.0635579,.0863105,1.11448,.98431,-.042291,.0574774,1.13069,.992916,-.0209131,.0284343,1.14568,.999926,743097e-9,-379265e-9,1.15955,.501042,-998428e-11,.498726,100306e-10,.502992,-252112e-9,.500665,253283e-9,.502417,-.00100791,.500092,.00101259,.502965,-.00226919,.500621,.00227978,.502318,-.00403109,.499994,.00405011,.502333,-.00629832,.500005,.00632868,.502362,-.00906907,.500027,.00911446,.502369,-.0123423,.500023,.0124078,.50243,-.0161178,.500066,.016211,.502493,-.0203937,.500103,.0205256,.502592,-.0251684,.500166,.0253548,.502707,-.0304389,.50023,.0307029,.502881,-.0362015,.500335,.0365753,.503124,-.0424507,.500488,.0429798,.503443,-.0491582,.500686,.0499268,.504083,-.0561476,.501155,.0574541,.504668,-.0636846,.501524,.0655408,.505319,-.0716834,.501904,.0742072,.50609,-.0800925,.502321,.0834699,.507122,-.0888425,.502896,.0933603,.508414,-.097855,.503603,.10391,.509955,-.107304,.504416,.115113,.512061,-.116921,.505565,.127054,.514419,-.12689,.506732,.139709,.517529,-.136934,.508338,.153173,.522085,-.147327,.510987,.167528,.526986,-.157612,.513527,.182708,.533122,-.168213,.516717,.198881,.540807,-.178688,.520832,.215986,.550687,-.189511,.52632,.234335,.560567,-.199998,.531009,.253375,.571698,-.210652,.535839,.273499,.584364,-.220917,.541091,.294355,.599066,-.23137,.546875,.316525,.614148,-.241206,.551306,.339671,.631157,-.250379,.555187,.36531,.647919,-.258397,.556595,.392767,.666112,-.265528,.556949,.421397,.686158,-.271827,.556617,.451433,.704838,-.27674,.552975,.482131,.723957,-.280733,.547814,.513458,.74262,-.283359,.53997,.545446,.762009,-.284541,.530422,.57775,.781314,-.284507,.518546,.610434,.799116,-.283309,.504178,.643178,.817604,-.280378,.48843,.676248,.83459,-.275619,.469457,.709698,.850974,-.26856,.447698,.744245,.866747,-.260094,.424791,.777695,.881412,-.249929,.399913,.810392,.8936,-.239137,.37308,.842872,.905943,-.226818,.345705,.874677,.916408,-.213699,.31706,.906257,.927215,-.198428,.288444,.936881,.935625,-.181643,.258329,.96795,.944076,-.164386,.228488,.998216,.951229,-.146339,.199763,1.02689,.958793,-.127709,.172153,1.0535,.963219,-.107244,.144989,1.07646,.967562,-.0857764,.11685,1.09675,.974866,-.0645377,.0880571,1.11576,.983353,-.0431732,.0587352,1.13227,.992503,-.0218356,.0294181,1.1478,1.00003,605203e-9,-231013e-9,1.16207,.482935,-101177e-10,.504695,968142e-11,.477554,-251521e-9,.499071,240676e-9,.477904,-.00100683,.499436,96342e-8,.478368,-.00226636,.499899,.0021687,.477977,-.00402719,.499513,.00385384,.477993,-.00629226,.499525,.0060221,.478011,-.00906011,.499536,.00867289,.478051,-.0123305,.499566,.0118074,.478089,-.016102,.499587,.0154269,.478171,-.0203736,.499645,.0195341,.478254,-.025143,.499692,.0241318,.47839,-.0304071,.499779,.0292247,.478588,-.0361631,.499911,.0348196,.478812,-.0424023,.500046,.0409231,.479208,-.0490724,.500326,.047552,.479841,-.0560722,.500805,.0547377,.480392,-.0636125,.501152,.0624607,.481068,-.0716134,.501561,.0707473,.481898,-.0800062,.502054,.0796118,.483022,-.0886568,.502728,.0890974,.484332,-.0977553,.503479,.0992099,.486126,-.107173,.504546,.10999,.488066,-.11677,.50557,.121476,.490521,-.126725,.506849,.133672,.494232,-.136793,.50911,.146731,.498302,-.147116,.511345,.160577,.503565,-.157446,.514344,.175335,.510902,-.168121,.518824,.191207,.519263,-.178799,.523666,.208058,.528204,-.189407,.528296,.225875,.538854,-.200145,.533724,.244782,.551278,-.210701,.539833,.264753,.565222,-.221303,.546131,.285745,.579403,-.231688,.551496,.307592,.595469,-.241718,.556809,.330582,.610929,-.250992,.559641,.354995,.629433,-.259602,.562379,.382471,.648504,-.267038,.563676,.411126,.66756,-.273388,.562092,.440924,.689143,-.278788,.560807,.472118,.709056,-.282783,.555701,.503774,.729855,-.285836,.548698,.536364,.748954,-.287078,.538544,.56895,.768373,-.287133,.526711,.601991,.78827,-.285839,.512511,.635403,.807465,-.283238,.496323,.668797,.825194,-.27906,.477638,.702584,.842203,-.272286,.456253,.736393,.857749,-.263854,.432412,.77096,.874799,-.253943,.407806,.80489,.887497,-.24237,.38033,.83771,.89966,-.230278,.352446,.870376,.911753,-.21646,.323268,.902256,.923011,-.202071,.294314,.933306,.932375,-.185519,.264104,.965177,.940537,-.167604,.234035,.996303,.948904,-.149068,.20412,1.0261,.955263,-.129539,.175431,1.05304,.960303,-.109932,.148116,1.07617,.965512,-.0880572,.119693,1.09742,.973466,-.0660548,.0901619,1.11721,.98284,-.0439228,.0599875,1.13436,.992216,-.0219588,.0298975,1.15006,.999946,119402e-9,-208547e-10,1.16471,.447827,-100414e-10,.491543,914833e-11,.454778,-251257e-9,.499172,22891e-8,.453519,-.00100342,.497787,914184e-9,.45357,-.00225776,.497847,.00205701,.453578,-.00401371,.497855,.00365705,.45357,-.00627107,.497841,.00571453,.453598,-.00902968,.497864,.00823019,.453627,-.0122888,.497882,.0112049,.453684,-.0160475,.497923,.0146405,.453764,-.0203044,.49798,.0185394,.453866,-.0250576,.498049,.0229054,.453996,-.0303028,.49813,.0277424,.454196,-.0360379,.498267,.0330587,.454457,-.0422521,.498445,.0388613,.454926,-.0488393,.498812,.0451767,.455525,-.0558653,.499272,.0520153,.456074,-.0633772,.499625,.0593754,.456752,-.0713606,.500049,.0672751,.457648,-.07971,.500615,.0757447,.458849,-.0883032,.501399,.0848231,.46029,-.0974095,.502293,.0945135,.462,-.106729,.503301,.104848,.464121,-.116354,.504533,.115884,.466889,-.126214,.506172,.127652,.470744,-.136324,.508667,.14024,.47488,-.146595,.510995,.153673,.480845,-.157027,.514832,.168053,.488262,-.167658,.519506,.183508,.496547,-.178343,.524347,.199948,.506254,-.188916,.52983,.217503,.517961,-.199975,.536357,.236272,.531484,-.210624,.543641,.256096,.545496,-.221227,.550048,.277085,.559497,-.231568,.555076,.298615,.575752,-.241698,.560541,.321547,.591999,-.251172,.564156,.345602,.610654,-.260178,.567607,.371851,.630484,-.268094,.56923,.40076,.651807,-.274661,.569779,.430801,.67239,-.280331,.566791,.461939,.693024,-.284501,.562007,.493854,.715473,-.287852,.555791,.526992,.736323,-.28929,.546345,.560102,.755771,-.289405,.534,.593543,.775424,-.2881,.519114,.627256,.795447,-.285562,.502543,.661464,.815319,-.281416,.484773,.695206,.831769,-.275523,.463445,.729044,.849464,-.267516,.440269,.764069,.866775,-.257584,.415049,.799089,.881252,-.245817,.388049,.831948,.894209,-.233127,.35889,.865526,.906922,-.219579,.329915,.89818,.919686,-.204491,.300441,.930013,.929044,-.188962,.269445,.962061,.938393,-.171079,.238402,.994214,.94661,-.15199,.208204,1.02533,.953095,-.131953,.178653,1.0529,.958644,-.111233,.150684,1.0771,.963925,-.0903098,.122359,1.09855,.971995,-.0680505,.0923342,1.11874,.981658,-.0448512,.0614195,1.13635,.991649,-.0221931,.0303582,1.15238,.999985,393403e-9,-111086e-9,1.16772,.396806,-971563e-11,.457671,842355e-11,.429186,-249421e-9,.495017,21625e-8,.429324,-998052e-9,.495173,865322e-9,.429175,-.00224487,.494999,.00194637,.429129,-.00399041,.494952,.00346004,.429153,-.00623476,.494974,.00540684,.429168,-.0089773,.494983,.00778714,.429207,-.0122175,.495012,.0106022,.429257,-.0159542,.495047,.0138535,.429338,-.0201864,.495106,.0175443,.429431,-.0249104,.495165,.0216774,.429587,-.0301252,.495279,.0262594,.429796,-.0358249,.495432,.0312968,.430065,-.0419972,.495621,.0367985,.430588,-.0485144,.496061,.042798,.43113,-.0555028,.496472,.0492914,.431743,-.0629852,.496904,.0562907,.432448,-.0709256,.497369,.0638056,.433414,-.0791942,.498032,.071885,.434638,-.0877346,.498854,.0805517,.43611,-.0968056,.499812,.0898047,.437859,-.106002,.500891,.0997142,.440017,-.115648,.502198,.110289,.443236,-.125427,.504389,.121644,.44697,-.135492,.506809,.133769,.451689,-.145746,.509858,.146787,.45811,-.156219,.514247,.160793,.465305,-.166834,.518816,.175791,.474085,-.177546,.524331,.191906,.484808,-.188262,.53104,.209199,.49732,-.199346,.538511,.227825,.509693,-.209951,.544554,.247269,.524367,-.220533,.551616,.267978,.539228,-.231082,.557368,.289672,.55644,-.241342,.563782,.31268,.574204,-.250964,.568851,.33651,.593388,-.260306,.57312,.362219,.613358,-.268667,.574916,.390322,.634512,-.275591,.575053,.420478,.65563,-.281328,.572404,.451614,.678265,-.285948,.568893,.484112,.70011,-.289408,.561878,.517348,.723005,-.291328,.55359,.551355,.743744,-.291418,.541099,.585109,.763949,-.290252,.526489,.619487,.784186,-.287648,.509496,.65404,.804304,-.283782,.491484,.688649,.823629,-.278067,.470517,.723133,.84094,-.270588,.44705,.757163,.857852,-.261188,.421252,.792816,.874934,-.249313,.394191,.827248,.888709,-.236492,.365359,.861074,.902589,-.222185,.336016,.894417,.914201,-.207314,.30527,.926825,.925978,-.191146,.274532,.9595,.93512,-.174135,.243393,.991583,.943656,-.155231,.212414,1.02356,.951719,-.134403,.182005,1.05239,.957164,-.113023,.153043,1.07754,.962656,-.0914493,.124186,1.09984,.970695,-.0694179,.0941654,1.12,.980749,-.0466199,.0629671,1.13849,.991205,-.0227032,.0311146,1.15494,.999884,632388e-9,-254483e-9,1.1706,.379821,-957289e-11,.460637,789337e-11,.405188,-247483e-9,.491396,204064e-9,.404796,-989434e-9,.490914,815853e-9,.40483,-.00222607,.490949,.00183559,.40473,-.00395723,.49084,.00326332,.404731,-.00618287,.490836,.00509945,.404768,-.00890258,.490871,.00734463,.404791,-.0121156,.490883,.00999992,.404857,-.0158214,.490938,.0130676,.404943,-.0200178,.491004,.0165503,.405059,-.0247027,.491093,.0204521,.405213,-.0298729,.491205,.0247788,.405399,-.0355226,.491333,.0295373,.405731,-.0416352,.491604,.034741,.406303,-.0480807,.492116,.0404255,.406814,-.0550458,.492506,.0465732,.407404,-.0624652,.492926,.0532058,.408149,-.0702958,.493442,.0603442,.409128,-.0784623,.494136,.0680297,.410408,-.087007,.495054,.0762786,.411813,-.0959639,.495962,.0851046,.413735,-.105075,.497257,.0945878,.416137,-.114646,.498882,.104725,.41934,-.124394,.501132,.11563,.423326,-.134328,.503883,.127325,.428419,-.14458,.50747,.139911,.43484,-.154979,.511964,.153481,.442641,-.165628,.517328,.168114,.452511,-.176365,.524258,.183995,.463473,-.187298,.531248,.200953,.475564,-.198244,.538367,.219176,.488664,-.208938,.545175,.238514,.504073,-.219599,.553227,.259129,.520832,-.230378,.560653,.280997,.538455,-.240703,.567523,.303821,.55709,-.250548,.573287,.327948,.576646,-.259964,.577795,.353362,.596705,-.268721,.580077,.380336,.618053,-.276054,.58018,.4101,.640303,-.282176,.578747,.44161,.662365,-.286931,.574294,.474106,.684542,-.290521,.567035,.507549,.707984,-.292672,.558687,.541853,.730913,-.293189,.547606,.576581,.752948,-.292199,.533471,.61172,.773452,-.289508,.516395,.646339,.794715,-.285716,.497873,.682131,.814251,-.280051,.476845,.716396,.833057,-.272873,.453449,.751503,.84959,-.263982,.427857,.786085,.867022,-.252745,.400335,.821355,.882277,-.239655,.371304,.85646,.895375,-.225386,.340397,.890828,.909347,-.209587,.310005,.923532,.921885,-.193433,.2796,.956419,.932127,-.176135,.247276,.989445,.941869,-.157872,.216186,1.02221,.949735,-.137577,.185602,1.05195,.956617,-.115285,.155767,1.07822,.961974,-.0928418,.126103,1.10149,.96972,-.0700592,.0956758,1.12207,.98012,-.0474671,.0643269,1.1408,.990825,-.0238113,.0320863,1.1577,.999876,381574e-9,-812203e-10,1.17403,.367636,-961342e-11,.469176,753287e-11,.380377,-244772e-9,.485434,191797e-9,.380416,-978857e-9,.485475,767015e-9,.380376,-.00220165,.485435,.00172522,.380419,-.00391408,.485487,.00306734,.380438,-.00611549,.485505,.00479332,.380462,-.00880558,.485525,.00690391,.380496,-.0119837,.485551,.00940039,.38056,-.0156487,.485605,.0122848,.38064,-.0197988,.485666,.0155601,.380767,-.0244324,.48577,.0192313,.380909,-.0295444,.485871,.0233032,.381142,-.0351321,.48606,.0277861,.381472,-.0411535,.486336,.0326939,.382015,-.0475408,.486833,.0380565,.382523,-.0544395,.487231,.0438615,.383129,-.061784,.487683,.0501332,.383952,-.0695085,.488313,.0568996,.38498,-.0775819,.489077,.0641952,.386331,-.0860443,.490113,.0720324,.387788,-.0948406,.491099,.0804379,.389808,-.103899,.492566,.0894899,.39252,-.113313,.494601,.0992098,.395493,-.123007,.496619,.109641,.399826,-.132859,.499912,.120919,.405341,-.143077,.504061,.133107,.411932,-.153465,.508905,.146263,.420591,-.164108,.515482,.160544,.43101,-.174893,.523191,.176123,.441881,-.185839,.53026,.192757,.453919,-.196633,.537295,.210535,.468715,-.207611,.546156,.229886,.485182,-.218517,.555173,.250543,.501926,-.229249,.562728,.27221,.51785,-.239481,.567494,.294892,.536947,-.249395,.573889,.318987,.557115,-.259,.578831,.344348,.577966,-.268075,.582055,.371223,.599489,-.276115,.583307,.399834,.62479,-.282523,.583902,.431415,.647504,-.287663,.57953,.464301,.670601,-.291538,.573103,.498123,.693539,-.293842,.563731,.532662,.717385,-.294681,.553169,.567925,.741533,-.293717,.539908,.603502,.762142,-.291156,.521902,.639074,.783014,-.28719,.502815,.674439,.805158,-.281773,.482598,.710497,.823646,-.274682,.458949,.7456,.841879,-.266184,.433129,.781085,.859515,-.255682,.406064,.816,.875335,-.242849,.376509,.851074,.890147,-.228329,.345502,.886473,.903144,-.212491,.31428,.920751,.916618,-.195695,.282994,.954606,.927953,-.178267,.251091,.988402,.937414,-.159549,.219107,1.02141,.946823,-.140022,.18896,1.05167,.954651,-.118154,.158667,1.07819,.959955,-.0946636,.128808,1.1025,.96858,-.0711792,.0973787,1.12391,.97938,-.0475046,.0650965,1.14322,.990498,-.024059,.0326267,1.16077,.999844,-512408e-10,112444e-9,1.17727,.316912,-934977e-11,.425996,695559e-11,.356423,-241372e-9,.479108,179562e-9,.356272,-965292e-9,.478897,71811e-8,.356262,-.00217182,.478894,.00161574,.356265,-.00386092,.478895,.00287261,.356278,-.0060324,.478905,.00448907,.356293,-.00868565,.478914,.00646572,.356346,-.0118207,.478965,.00880438,.356395,-.0154355,.479001,.0115066,.356484,-.019529,.479075,.0145762,.356609,-.0240991,.47918,.018018,.356766,-.0291413,.479305,.0218379,.357009,-.0346498,.479512,.0260454,.357424,-.0405462,.479909,.0306657,.357899,-.0468825,.480337,.0357054,.358424,-.0536887,.480771,.0411728,.359041,-.0609416,.481242,.0470841,.359903,-.0685239,.481943,.0534831,.360932,-.0764883,.482741,.0603795,.362196,-.0848364,.483688,.0678028,.363847,-.0935002,.484947,.0758086,.365972,-.102471,.486588,.0844173,.368741,-.111751,.488787,.0937199,.372146,-.121334,.491405,.103732,.377114,-.131147,.495604,.114608,.38226,-.141213,.499436,.126345,.389609,-.151632,.505334,.139116,.397925,-.162073,.51168,.152995,.407824,-.172819,.518876,.168071,.420014,-.183929,.527639,.184495,.434266,-.195032,.537588,.20232,.447352,-.205792,.544379,.221189,.463726,-.216704,.553422,.241616,.481406,-.227531,.562074,.263298,.498707,-.238017,.568227,.286116,.518039,-.247936,.574473,.3101,.538277,-.257437,.579191,.335401,.561166,-.266829,.584807,.362246,.583189,-.275329,.586476,.390609,.606024,-.28234,.585578,.420998,.632419,-.287924,.584496,.454357,.656128,-.291972,.577766,.488233,.679953,-.29456,.56875,.523248,.704654,-.295816,.558388,.559168,.729016,-.295157,.544826,.595326,.752062,-.292779,.528273,.631864,.773138,-.288681,.508482,.667793,.794869,-.283358,.487341,.704035,.815101,-.27608,.46354,.739925,.834212,-.26767,.438672,.775539,.852368,-.257397,.411239,.810895,.870207,-.245689,.3829,.846472,.884063,-.231452,.351496,.881788,.898284,-.215561,.31895,.917438,.912964,-.198208,.287367,.952422,.924666,-.180426,.254487,.987551,.934429,-.161525,.222226,1.02142,.943485,-.141197,.191143,1.05218,.9521,-.120085,.161112,1.07937,.957876,-.0975881,.130982,1.10403,.966943,-.0726842,.0990553,1.12616,.978313,-.0483705,.0662818,1.14619,.990048,-.0239072,.0329243,1.16413,.999984,461885e-9,-772859e-10,1.18099,.321287,-935049e-11,.455413,659662e-11,.332595,-237513e-9,.471437,167562e-9,.332729,-949964e-9,.471618,670192e-9,.332305,-.00213618,.471028,.00150712,.332326,-.00379765,.471055,.00267959,.332344,-.00593353,.471072,.00418751,.332356,-.00854349,.471077,.00603172,.332403,-.0116268,.471121,.00821362,.332461,-.0151824,.47117,.0107357,.332552,-.0192088,.471251,.0136014,.332657,-.0237024,.47133,.0168152,.332835,-.0286615,.471487,.0203853,.333083,-.0340765,.471708,.0243212,.333547,-.0398563,.47219,.0286518,.333989,-.0460916,.472587,.0333763,.334532,-.0527897,.473054,.0385084,.335167,-.0599284,.473568,.0440638,.33608,-.0673514,.474362,.0500962,.337146,-.0752237,.475231,.0566022,.338462,-.083418,.476282,.0636272,.34014,-.0919382,.477615,.0712153,.342341,-.100741,.479404,.079417,.345088,-.109905,.481618,.0882631,.349049,-.119369,.485081,.0978851,.353939,-.129033,.489317,.108336,.359893,-.139038,.494309,.119698,.366945,-.149411,.499983,.132024,.375814,-.159843,.507185,.145558,.387112,-.170664,.516392,.160433,.40023,-.181897,.526519,.176648,.412555,-.192785,.53423,.193922,.427023,-.203663,.542741,.212662,.443685,-.214695,.552066,.232944,.461499,-.225561,.560762,.254495,.480975,-.236257,.569421,.277531,.501,-.24639,.576101,.301724,.521691,-.256101,.581493,.327112,.543478,-.265289,.585221,.353917,.566094,-.273938,.587614,.381941,.589578,-.281679,.587991,.41172,.614583,-.287655,.585928,.444148,.641813,-.292228,.582092,.478617,.666189,-.295172,.57398,.51397,.690475,-.29648,.561676,.550118,.715543,-.296203,.548758,.586933,.740405,-.293999,.532792,.62384,.762183,-.28998,.512735,.660723,.786069,-.28478,.492402,.69807,.806812,-.277568,.469058,.734422,.826987,-.268951,.443017,.770946,.844588,-.259049,.415501,.80699,.863725,-.2471,.387328,.842107,.879137,-.234157,.356108,.878078,.894634,-.218719,.324315,.914058,.909162,-.201293,.291813,.949922,.92072,-.18267,.258474,.985337,.93158,-.163212,.225593,1.0205,.941238,-.142771,.193986,1.05273,.949293,-.120956,.163392,1.08075,.956226,-.0985743,.132934,1.10559,.96546,-.075118,.101255,1.12823,.977403,-.0497921,.0675441,1.149,.989648,-.0241574,.0334681,1.16765,1.00001,5762e-7,-184807e-9,1.18519,.303474,-916603e-11,.4542,61243e-10,.308894,-232869e-9,.462306,155592e-9,.309426,-931661e-9,.463093,622499e-9,.308643,-.0020949,.461933,.00139979,.308651,-.0037242,.461941,.00248874,.308662,-.00581873,.46195,.00388933,.308687,-.00837818,.461974,.00560247,.308728,-.0114016,.462011,.00762948,.308789,-.0148884,.462067,.00997326,.308882,-.0188369,.462151,.0126375,.309007,-.0232436,.462263,.0156271,.30918,-.0281054,.462417,.0189498,.309442,-.0334065,.462667,.0226167,.309901,-.0390589,.463162,.0266614,.310331,-.0452042,.463555,.0310715,.310858,-.0517735,.464019,.0358698,.311576,-.0587359,.464669,.0410848,.312436,-.0660383,.465406,.0467453,.313526,-.0737266,.466339,.0528718,.314903,-.0817574,.467504,.0595039,.316814,-.090167,.469226,.0666888,.318965,-.0987555,.470981,.0744658,.322077,-.107792,.473814,.082912,.325947,-.117098,.477241,.0920846,.331008,-.126602,.48184,.102137,.337893,-.136619,.488334,.113135,.345106,-.146838,.494415,.12511,.355111,-.157357,.503275,.138356,.365095,-.167955,.510966,.152686,.378344,-.179157,.521508,.16856,.391599,-.190143,.530455,.18561,.407786,-.20123,.541275,.204308,.425294,-.212456,.551784,.224623,.444021,-.223568,.561493,.246172,.463418,-.234154,.569886,.268979,.484077,-.244546,.577116,.293411,.505513,-.254301,.582914,.318936,.527672,-.263564,.587208,.345856,.550565,-.272332,.589277,.374054,.573656,-.280011,.588426,.403276,.59827,-.286924,.587504,.43474,.624731,-.291994,.583401,.468767,.652396,-.295159,.576997,.504411,.67732,-.296954,.565863,.54114,.703147,-.296877,.552316,.57816,.728715,-.295147,.536773,.616124,.752448,-.291275,.51771,.653885,.775169,-.285905,.496087,.691537,.799307,-.279064,.474232,.729251,.819482,-.270294,.447676,.766267,.837659,-.260032,.419656,.802616,.856903,-.248497,.391328,.838583,.873325,-.235252,.360285,.874711,.889788,-.221126,.329215,.91077,.904486,-.204304,.296392,.94653,.917711,-.185562,.262159,.983828,.928969,-.165635,.229142,1.01955,.939707,-.14442,.19673,1.05317,.948167,-.122147,.165095,1.0823,.955222,-.099098,.13451,1.10791,.964401,-.0755332,.102476,1.1312,.976605,-.0513817,.0689667,1.15218,.989085,-.0258499,.034506,1.17129,.999908,617773e-9,-271268e-9,1.18961,.285803,-905752e-11,.452348,572272e-11,.284689,-22732e-8,.450581,143626e-9,.285263,-910214e-9,.451482,575099e-9,.285302,-.00204784,.451553,.00129395,.285318,-.00364057,.451574,.0023006,.28533,-.00568813,.451585,.00359547,.285361,-.00819001,.451618,.00517934,.285397,-.0111458,.45165,.007054,.285447,-.0145536,.451688,.00922167,.285527,-.0184127,.451758,.0116869,.285688,-.0227207,.451929,.0144555,.28584,-.0274712,.452055,.0175341,.286136,-.0326278,.452369,.0209406,.286574,-.0381792,.452853,.0246965,.287012,-.0441879,.453272,.0287996,.287542,-.0506096,.453752,.033268,.288299,-.0573634,.454488,.0381504,.289186,-.0645458,.455294,.0434447,.290302,-.0720405,.456301,.0491973,.291776,-.0799046,.457648,.0554453,.29372,-.088117,.459483,.0622311,.296052,-.0965328,.461571,.0695992,.299563,-.105409,.465085,.077658,.30335,-.114553,.468506,.0864176,.309167,-.123917,.474423,.0961078,.31529,-.13381,.47995,.106643,.324163,-.144021,.488592,.118322,.333272,-.154382,.496461,.131133,.344224,-.165015,.50562,.145208,.357733,-.176168,.516719,.16073,.373046,-.187468,.528513,.177807,.38788,-.198488,.537713,.196072,.405133,-.209545,.547999,.21605,.423845,-.220724,.55759,.237484,.443777,-.231518,.566246,.26039,.464824,-.242035,.574326,.284835,.486635,-.251898,.58037,.310518,.51012,-.261304,.58568,.337678,.535301,-.270384,.590197,.366242,.559193,-.27841,.590569,.395873,.583544,-.285325,.588161,.426857,.608834,-.291113,.584249,.459477,.635753,-.294882,.57763,.494734,.664367,-.297088,.569479,.532023,.689688,-.297364,.555064,.569629,.715732,-.295949,.539522,.608124,.741307,-.292259,.521613,.646231,.764949,-.287063,.49969,.684938,.788599,-.28012,.476747,.723548,.81048,-.27153,.45116,.761135,.831372,-.261289,.424101,.798916,.850092,-.249559,.39443,.835952,.867777,-.236348,.363849,.871606,.884632,-.221569,.332477,.907843,.90047,-.20618,.300667,.944187,.914524,-.188771,.266552,.981371,.926892,-.168362,.232349,1.01841,.937951,-.146761,.199359,1.05308,.947236,-.123813,.1675,1.0839,.954367,-.099984,.136166,1.11047,.963907,-.0759278,.103808,1.13414,.976218,-.0511367,.0697061,1.15575,.988772,-.0267415,.0352529,1.17531,.999888,-520778e-9,289926e-9,1.19389,.263546,-883274e-11,.441896,526783e-11,.262352,-221849e-9,.439889,132311e-9,.262325,-886683e-9,.439848,528824e-9,.26228,-.00199476,.439765,.00118975,.262372,-.00354671,.439922,.00211568,.26239,-.00554141,.439941,.00330652,.262412,-.00797888,.439961,.00476346,.262453,-.0108584,.440002,.00648818,.262528,-.0141788,.440085,.0084835,.262615,-.017938,.440166,.0107533,.262744,-.0221346,.440291,.0133044,.262939,-.026762,.440493,.0161445,.263277,-.0317573,.440889,.0192974,.26368,-.0371832,.441338,.0227699,.264106,-.0430371,.441753,.0265698,.264624,-.0493035,.442227,.0307178,.265378,-.0558669,.442985,.0352616,.266253,-.0628718,.443795,.0401968,.267478,-.0701569,.445008,.04559,.269062,-.077845,.446599,.0514539,.270926,-.0857941,.448349,.0578382,.273693,-.0940773,.451221,.0648363,.276746,-.102704,.454097,.0724389,.281693,-.111735,.459517,.0808744,.287335,-.121004,.46531,.0901551,.29448,-.130734,.472605,.100371,.30257,-.140777,.480251,.111644,.312465,-.15111,.489444,.124111,.324856,-.16189,.500919,.137979,.33774,-.172946,.511317,.153163,.35255,-.184152,.522684,.169817,.367786,-.19522,.53248,.187886,.385474,-.20632,.543326,.207634,.404976,-.217744,.554109,.229165,.425203,-.228691,.563395,.252068,.446704,-.239299,.571565,.276471,.468951,-.249348,.577935,.302323,.493487,-.258933,.584309,.329882,.517861,-.268009,.58773,.358525,.543309,-.276238,.589612,.388585,.569704,-.28356,.589294,.419787,.594871,-.289497,.585137,.452114,.622555,-.294452,.580356,.486466,.651167,-.296918,.57185,.523079,.677332,-.297647,.558428,.5611,.703718,-.296321,.542232,.599592,.730262,-.293339,.524541,.639138,.754304,-.288036,.502691,.677978,.778051,-.281018,.479212,.716537,.801557,-.272414,.454071,.75586,.822559,-.262419,.425952,.794477,.843051,-.250702,.397313,.832664,.86232,-.237264,.366534,.869876,.879044,-.222716,.334816,.906973,.896362,-.206827,.303143,.943558,.910342,-.189659,.269699,.979759,.924119,-.171108,.236411,1.01718,.935374,-.149579,.202224,1.05289,.944295,-.126295,.16989,1.08496,.952227,-.101511,.138089,1.11256,.962041,-.0766392,.105053,1.1375,.97528,-.0511967,.070329,1.15983,.988476,-.025463,.0351268,1.17987,.999962,286808e-10,145564e-10,1.19901,.227089,-841413e-11,.404216,472707e-11,.239725,-215083e-9,.426708,120833e-9,.239904,-860718e-9,.427028,483555e-9,.239911,-.00193661,.427039,.00108806,.239914,-.00344276,.42704,.00193457,.239933,-.00537907,.427064,.00302363,.239944,-.00774482,.427065,.00435604,.239993,-.01054,.427122,.00593398,.240052,-.0137626,.427179,.00775987,.240148,-.0174115,.427279,.00983854,.240278,-.021484,.42741,.0121763,.240472,-.0259729,.427618,.0147827,.240839,-.0308131,.428086,.0176837,.241201,-.0360893,.428482,.0208775,.241626,-.0417723,.428907,.0243821,.242207,-.0478337,.42952,.0282228,.24298,-.0542199,.430332,.0324333,.243881,-.0610015,.431222,.0370252,.245123,-.0680874,.432512,.0420535,.24667,-.0755482,.434088,.0475414,.248779,-.0832873,.436323,.0535542,.251665,-.0913546,.439509,.0601716,.255305,-.0998489,.443478,.0674282,.260049,-.108576,.448713,.0754673,.266192,-.117754,.455524,.084339,.273158,-.127294,.4627,.0941683,.282131,-.137311,.472068,.10515,.293332,-.147736,.483565,.117402,.304667,-.158357,.493702,.130824,.317785,-.169274,.504708,.145724,.333245,-.180595,.517107,.16215,.349843,-.191892,.528849,.180149,.367944,-.203168,.540301,.199746,.387579,-.214443,.551514,.221047,.408247,-.225624,.560906,.243981,.43014,-.236422,.56959,.268513,.452669,-.24654,.576098,.294409,.476196,-.256157,.580925,.322002,.501157,-.265289,.584839,.351052,.527632,-.273671,.587614,.3812,.555754,-.281254,.589119,.412994,.581682,-.287448,.585204,.445498,.608196,-.292614,.579006,.479505,.635661,-.296068,.571297,.514643,.664999,-.297395,.560855,.552213,.691039,-.296645,.544525,.591365,.7179,-.293785,.526535,.630883,.744059,-.289089,.50545,.670932,.76863,-.282239,.482514,.710904,.793273,-.273688,.457246,.750259,.814731,-.26328,.428872,.78948,.835603,-.251526,.399384,.828597,.85489,-.238339,.368811,.866892,.872828,-.223607,.336617,.90563,.889462,-.207538,.303997,.943538,.904929,-.190297,.270812,.980591,.919101,-.172034,.237453,1.01935,.930536,-.152058,.204431,1.05498,.941223,-.129515,.172495,1.08717,.94982,-.104263,.140175,1.11551,.960592,-.0781944,.106465,1.14098,.974629,-.051688,.0711592,1.16418,.98811,-.0253929,.0354432,1.18465,1.00004,804378e-9,-330876e-9,1.20462,.214668,-821282e-11,.406619,433582e-11,.218053,-208144e-9,.413025,109887e-9,.217987,-832212e-9,.412901,439362e-9,.217971,-.00187246,.412876,988623e-9,.217968,-.00332855,.41286,.00175772,.217985,-.00520055,.412882,.00274729,.218014,-.00748814,.412916,.00395842,.218054,-.0101901,.412957,.00539274,.218106,-.0133057,.413005,.00705348,.218217,-.0168342,.413139,.00894581,.218338,-.0207707,.413258,.0110754,.21855,-.0251001,.413509,.0134551,.218913,-.0297861,.413992,.0161081,.219265,-.0348956,.414383,.0190307,.219696,-.0403909,.414839,.0222458,.220329,-.0462003,.415567,.025792,.220989,-.0524208,.41621,.0296637,.222027,-.058948,.417385,.0339323,.223301,-.0658208,.418779,.0386055,.224988,-.0730347,.420665,.0437355,.227211,-.0805274,.423198,.0493844,.230131,-.088395,.426566,.0556135,.233908,-.0966208,.43091,.0624829,.239092,-.105223,.437148,.0701636,.245315,-.11424,.444302,.0786949,.253166,-.12368,.453262,.0882382,.262374,-.133569,.463211,.0988682,.273145,-.143836,.474271,.110727,.285512,-.154577,.4863,.123945,.299512,-.165501,.498817,.138581,.314287,-.176698,.510341,.154676,.331083,-.188066,.522583,.172459,.349615,-.199597,.534879,.191979,.369318,-.210843,.546083,.21309,.390377,-.222068,.5562,.235998,.412411,-.233059,.564704,.260518,.435715,-.24357,.572314,.286795,.461196,-.253356,.579395,.314559,.485587,-.262362,.581985,.343581,.511908,-.270895,.584347,.374367,.539798,-.278452,.58505,.406015,.567974,-.284877,.583344,.439168,.594303,-.290124,.577348,.473005,.622951,-.294183,.570751,.508534,.652404,-.296389,.561541,.544764,.679291,-.296605,.546426,.582927,.706437,-.294095,.528599,.622681,.734485,-.28978,.508676,.663567,.758841,-.283363,.484768,.704092,.78537,-.275015,.460434,.745101,.807315,-.264689,.432166,.784712,.8271,-.252597,.401807,.824241,.849191,-.239154,.371458,.863803,.867046,-.224451,.338873,.903063,.8852,-.208342,.306175,.942763,.901771,-.190684,.272759,.981559,.915958,-.172105,.239306,1.02048,.928046,-.152214,.206071,1.05765,.939961,-.130247,.17367,1.08999,.948711,-.10672,.142201,1.11829,.959305,-.0808688,.108454,1.14467,.973009,-.0539145,.0728109,1.16839,.987631,-.0262947,.0360625,1.19004,.999978,.00132758,-559424e-9,1.21058,.193925,-793421e-11,.391974,392537e-11,.196746,-200315e-9,.397675,991033e-10,.19667,-801099e-9,.397521,396342e-9,.196633,-.00180246,.397445,891829e-9,.196654,-.00320443,.397482,.00158582,.196659,-.00500647,.39748,.00247867,.196683,-.0072086,.397506,.00357167,.196728,-.00981001,.397562,.00486675,.196792,-.0128096,.397633,.00636707,.19689,-.0162055,.397746,.00807752,.197017,-.0199943,.397884,.0100052,.19729,-.024139,.39827,.0121691,.197583,-.0286671,.398639,.0145755,.197927,-.0335858,.399034,.0172355,.198383,-.0388806,.399554,.0201718,.199002,-.0444736,.400289,.0234194,.199739,-.0504583,.401111,.026984,.200784,-.056729,.402349,.0309217,.202075,-.0633643,.403841,.0352496,.203898,-.0703247,.406076,.0400313,.206199,-.0775565,.408841,.0453282,.209252,-.085184,.41259,.0511794,.213638,-.0931994,.418288,.0577459,.21881,-.101617,.424681,.0650508,.225642,-.11052,.433429,.0732759,.233717,-.119772,.442897,.0824683,.242823,-.129505,.452888,.0927484,.254772,-.139906,.466407,.104417,.266603,-.150402,.477413,.117211,.28073,-.161395,.490519,.131598,.295399,-.172465,.50201,.147407,.312705,-.183982,.515311,.165031,.331335,-.195532,.52786,.184336,.351037,-.206971,.5392,.205361,.372175,-.218117,.54941,.228043,.394548,-.229327,.558642,.25267,.419598,-.240052,.567861,.279071,.443922,-.249937,.573332,.306882,.471495,-.259407,.58013,.33661,.496769,-.267749,.580564,.367328,.524951,-.275524,.581696,.399753,.55318,-.282148,.579885,.433134,.581577,-.287533,.575471,.467534,.609231,-.291612,.567445,.502943,.637478,-.293911,.557657,.53871,.667795,-.295096,.546535,.576568,.694272,-.294073,.529561,.614929,.722937,-.290386,.510561,.655909,.749682,-.284481,.487846,.697663,.774754,-.276188,.462487,.738515,.799301,-.266215,.43481,.779802,.820762,-.254116,.404879,.820045,.843231,-.240393,.374559,.860294,.861857,-.225503,.341582,.900965,.880815,-.209382,.308778,.941727,.89766,-.19155,.275232,.980916,.912926,-.172346,.240938,1.02162,.926391,-.151799,.207223,1.0597,.938429,-.129968,.17484,1.09291,.947834,-.10651,.142984,1.12248,.958432,-.0824098,.109902,1.149,.972402,-.0565242,.0744454,1.1733,.987191,-.028427,.0373794,1.19538,.999975,385685e-10,-4203e-8,1.21676,.178114,-766075e-11,.385418,354027e-11,.176074,-191966e-9,.381002,887135e-10,.17601,-767549e-9,.380861,354715e-9,.17598,-.00172696,.380798,798168e-9,.175994,-.00307012,.380824,.00141928,.176017,-.00479684,.380858,.00221859,.176019,-.00690648,.380839,.00319714,.176072,-.00939888,.380913,.0043572,.176131,-.0122726,.380979,.005702,.176239,-.0155264,.38112,.00723689,.176371,-.0191551,.381272,.00896907,.176638,-.023117,.381669,.0109194,.176912,-.0274633,.382015,.0130903,.177279,-.032173,.382476,.0154949,.17774,-.0372219,.383041,.0181669,.178344,-.0426132,.38378,.0211209,.179153,-.0483309,.384773,.0243899,.180197,-.0543447,.386076,.0280062,.181581,-.0607122,.387809,.032004,.18344,-.0673855,.390205,.036453,.186139,-.0743989,.393944,.0414162,.189432,-.0817731,.39832,.0469394,.193795,-.0895464,.404188,.0531442,.199641,-.0978264,.4121,.0601374,.206679,-.106499,.421425,.0680078,.214865,-.115654,.431504,.076919,.224406,-.125268,.442526,.0868835,.235876,-.135475,.455465,.0981875,.248335,-.146023,.4681,.110759,.262868,-.157016,.482069,.124885,.278962,-.168245,.496182,.140645,.295082,-.17958,.507401,.157838,.313738,-.191227,.520252,.17695,.333573,-.202718,.531708,.197817,.356433,-.214424,.544509,.220785,.378853,-.225492,.55373,.245306,.402717,-.236236,.561348,.271593,.428375,-.246568,.568538,.299776,.454724,-.255941,.573462,.329433,.482291,-.264511,.576356,.360598,.509706,-.272129,.576446,.393204,.538805,-.278979,.575298,.427227,.568919,-.284528,.572154,.462157,.596804,-.288801,.564691,.497997,.625987,-.291334,.555134,.534467,.656414,-.292722,.545051,.571736,.683916,-.292185,.528813,.610158,.711809,-.290043,.51106,.649061,.739547,-.285246,.490103,.690081,.766914,-.277647,.465523,.732554,.791375,-.267603,.437718,.773982,.814772,-.256109,.40882,.81609,.836691,-.242281,.377823,.856849,.856984,-.227155,.34496,.898363,.876332,-.210395,.311335,.939471,.894988,-.192612,.277703,.980799,.911113,-.173236,.243019,1.02215,.924092,-.152258,.209037,1.06139,.936828,-.129575,.175909,1.09635,.946869,-.10594,.143852,1.12707,.958284,-.081318,.110289,1.15419,.972325,-.0556133,.0747232,1.17909,.986878,-.0297899,.0383149,1.20163,.999936,-.00197169,912402e-9,1.22338,.151174,-720365e-11,.351531,309789e-11,.155594,-18279e-8,.361806,78608e-9,.156099,-731569e-9,.362982,314615e-9,.156053,-.00164578,.362869,707845e-9,.156093,-.0029261,.362961,.00125884,.156099,-.00457155,.362959,.00196783,.15612,-.00658224,.362982,.00283622,.156168,-.00895774,.363048,.00386625,.156221,-.0116962,.363101,.00506109,.156324,-.0147973,.363241,.00642675,.156476,-.0182503,.363448,.00797175,.156731,-.0220266,.36384,.00971484,.156994,-.026176,.364179,.0116575,.157341,-.0306701,.36462,.0138207,.157867,-.0354591,.365364,.0162356,.15846,-.0406141,.366111,.0189092,.159308,-.0460519,.367248,.021885,.160426,-.0518096,.368767,.0252004,.161877,-.0578906,.370745,.0288825,.163995,-.0642812,.373831,.0330139,.16655,-.0710067,.377366,.0376283,.170237,-.0781522,.382799,.0428493,.175096,-.0857172,.389915,.0487324,.181069,-.0938025,.398487,.0554214,.188487,-.102363,.408799,.0630189,.197029,-.111343,.419991,.071634,.206684,-.120812,.431455,.0812797,.218698,-.131033,.445746,.0923651,.230726,-.141373,.457471,.104545,.245516,-.152387,.472388,.118449,.261551,-.163628,.486671,.133923,.277437,-.174814,.49762,.150849,.296662,-.186713,.51162,.169924,.31795,-.198513,.525435,.190848,.339422,-.210119,.536267,.213504,.362143,-.221354,.545982,.237947,.387198,-.23224,.555364,.264427,.412349,-.24257,.561489,.292519,.439274,-.252284,.566903,.322561,.466779,-.261023,.569614,.353952,.496011,-.26899,.571589,.387278,.524964,-.275498,.570325,.421356,.556518,-.281449,.568792,.457314,.584363,-.285526,.560268,.493199,.614214,-.28844,.55205,.530276,.645684,-.289777,.541906,.56855,.673446,-.289722,.526464,.606927,.701924,-.287792,.509872,.645945,.73037,-.284315,.490649,.685564,.757405,-.278804,.467964,.726511,.784025,-.269543,.441468,.768601,.808255,-.258117,.41216,.811321,.830739,-.244728,.380606,.853496,.851914,-.229428,.348111,.895374,.872586,-.212508,.314732,.937674,.891581,-.194025,.280338,.979869,.907641,-.174711,.245203,1.02253,.922233,-.153509,.21077,1.06371,.935878,-.130418,.177399,1.09972,.946338,-.105558,.144507,1.13124,.957265,-.080059,.110508,1.15973,.971668,-.0539766,.0742311,1.18515,.9866,-.0277101,.0375224,1.20858,1.00021,-515531e-9,135226e-9,1.23135,.137468,-686011e-11,.345041,273315e-11,.13703,-173378e-9,.343936,690761e-10,.136986,-693048e-9,.34383,276126e-9,.136964,-.00155931,.343761,621337e-9,.137003,-.00277211,.343863,.00110494,.137012,-.00433103,.343868,.00172744,.137043,-.00623606,.343916,.00249022,.13709,-.0084868,.343986,.00339559,.137145,-.0110814,.344045,.00444687,.137242,-.0140187,.344177,.00565007,.137431,-.0172713,.344491,.00701868,.137644,-.0208605,.344805,.00856042,.13791,-.024792,.345172,.0102863,.138295,-.0290461,.345734,.0122185,.138764,-.0335957,.346371,.0143771,.139415,-.038467,.347298,.0167894,.140272,-.0436176,.348527,.0194895,.141457,-.0491016,.350276,.0225043,.14303,-.0548764,.352646,.0258962,.145289,-.0610096,.356206,.0297168,.148502,-.0674777,.361488,.0340562,.152188,-.074345,.367103,.0389534,.157359,-.0817442,.375247,.0445541,.16379,-.0896334,.385064,.0509535,.171376,-.098005,.396082,.0582611,.179901,-.106817,.407418,.06654,.189892,-.116239,.420031,.075994,.201838,-.12627,.434321,.0867239,.214311,-.136701,.447631,.0987517,.228902,-.147616,.462046,.112353,.245107,-.158871,.476942,.127605,.262292,-.170261,.490285,.144469,.281215,-.182017,.503783,.163282,.301058,-.193729,.515505,.183873,.322752,-.205512,.52682,.206466,.347547,-.217214,.539473,.231194,.370969,-.227966,.546625,.257288,.397533,-.238555,.55472,.285789,.42398,-.248278,.559468,.315746,.452928,-.257422,.564095,.347724,.482121,-.265306,.565426,.380922,.510438,-.272043,.563205,.415639,.541188,-.277614,.561087,.451702,.571667,-.281927,.554922,.48845,.602432,-.285015,.546838,.526442,.634126,-.286512,.537415,.564896,.662816,-.286388,.522906,.604037,.692411,-.284734,.507003,.643795,.720946,-.281297,.488398,.68298,.748293,-.276262,.466353,.723466,.776931,-.269978,.443573,.764565,.801065,-.260305,.415279,.805838,.825843,-.247426,.384773,.849985,.84807,-.232437,.352555,.893174,.869122,-.215806,.318642,.936564,.888963,-.197307,.28381,.980253,.905547,-.177203,.247888,1.02463,.918554,-.155542,.212904,1.06714,.931395,-.131948,.1787,1.10451,.941749,-.106723,.145902,1.13694,.954551,-.0804939,.111193,1.1666,.970279,-.0534239,.0744697,1.19249,.986117,-.0257452,.0368788,1.21665,.999938,.00190634,-.0010291,1.23981,.118493,-647439e-11,.32272,23772e-10,.118765,-163023e-9,.323456,598573e-10,.118772,-65212e-8,.323477,239447e-9,.118843,-.00146741,.323657,538881e-9,.118804,-.00260846,.323553,95826e-8,.118826,-.00407576,.323595,.00149845,.118846,-.00586826,.323617,.00216047,.118886,-.00798578,.32367,.00294679,.118947,-.0104273,.323753,.00386124,.119055,-.0131909,.323922,.00490999,.119241,-.0162444,.324251,.00610804,.11944,-.0196339,.324544,.00745805,.119739,-.0233378,.325026,.00897805,.12011,-.0273179,.325586,.0106895,.120571,-.0316143,.326231,.0126073,.12124,-.0361939,.327264,.0147654,.122162,-.0410511,.328733,.0172001,.123378,-.0462233,.330659,.0199375,.125183,-.0517109,.333754,.0230498,.127832,-.0575652,.338507,.026597,.130909,-.0637441,.343666,.0306345,.135221,-.0704302,.351063,.035273,.14082,-.0776364,.360604,.0406137,.146781,-.0852293,.369638,.0466788,.155121,-.0935351,.3827,.0537628,.16398,-.102234,.39522,.0617985,.173926,-.111465,.40793,.07097,.185137,-.121296,.42105,.0813426,.19826,-.13169,.435735,.0931596,.212938,-.142614,.450932,.106547,.229046,-.153884,.465726,.121575,.246246,-.165382,.479461,.138286,.264637,-.176806,.492106,.15666,.284959,-.188793,.504774,.17728,.308157,-.200763,.518805,.19988,.330951,-.21239,.528231,.224293,.3549,-.223521,.536376,.250541,.381502,-.234169,.544846,.278902,.409529,-.244077,.551717,.309227,.437523,-.253363,.55517,.341426,.467624,-.261659,.557772,.37518,.497268,-.268498,.556442,.41007,.528294,-.274018,.553915,.446445,.559053,-.278169,.549153,.483779,.589329,-.281229,.539878,.522249,.622503,-.282902,.53162,.561754,.652382,-.282815,.518119,.601544,.681847,-.281247,.502187,.641574,.712285,-.277986,.484824,.682633,.740094,-.273017,.463483,.723426,.768478,-.266692,.441299,.763747,.794556,-.258358,.415238,.805565,.819408,-.248807,.386912,.847254,.843411,-.236214,.356165,.891091,.862397,-.219794,.320562,.936174,.883113,-.201768,.285322,.982562,.90023,-.181672,.249713,1.02862,.915192,-.159279,.214546,1.07163,.928458,-.134725,.180285,1.10995,.94069,-.10913,.147119,1.14354,.953409,-.0821315,.112492,1.17372,.969537,-.0542677,.0752014,1.20043,.985612,-.0259096,.0370361,1.22528,.999835,.00298198,-.00151801,1.24959,.10097,-602574e-11,.300277,202619e-11,.101577,-152164e-9,.302077,511662e-10,.101572,-608889e-9,.302066,204751e-9,.101566,-.00136997,.302047,460753e-9,.101592,-.00243557,.302114,819497e-9,.101608,-.0038053,.30214,.00128154,.101627,-.00547906,.30216,.0018483,.101669,-.00745647,.302224,.00252223,.101732,-.00973615,.302318,.00330716,.101844,-.0123097,.302513,.00421061,.102025,-.0151681,.30285,.00524481,.102224,-.0183334,.303166,.0064154,.102515,-.0217819,.303654,.00774063,.102886,-.0255067,.304243,.0092398,.103395,-.029514,.305089,.0109339,.104109,-.0337912,.306301,.0128561,.105074,-.0383565,.30798,.0150338,.10654,-.0432132,.310726,.0175228,.108478,-.0484244,.314351,.0203648,.111015,-.0539339,.319032,.0236325,.114682,-.0598885,.32605,.0274188,.11911,-.0663375,.334109,.0317905,.124736,-.0733011,.344013,.0368502,.131479,-.0807744,.355358,.0427104,.139283,-.0888204,.367614,.0494788,.148054,-.0973394,.380072,.0572367,.159037,-.10665,.395678,.0662704,.169794,-.116221,.40795,.0763192,.18314,-.126632,.423546,.087956,.197515,-.137383,.438213,.101042,.213514,-.148641,.453248,.115827,.23065,-.160117,.46688,.132283,.249148,-.171807,.479962,.150644,.270219,-.183695,.494618,.171073,.292338,-.195574,.506937,.193378,.314999,-.207205,.516463,.217585,.340991,-.218955,.528123,.24428,.367982,-.229917,.537025,.272784,.39432,-.239737,.541627,.302742,.423364,-.249048,.546466,.335112,.453751,-.257329,.549466,.369032,.48416,-.264623,.549503,.404577,.515262,-.270411,.547008,.441337,.547036,-.274581,.542249,.479162,.576614,-.277266,.533015,.517904,.611143,-.279144,.525512,.558508,.640989,-.279001,.51154,.598995,.671182,-.277324,.495641,.639935,.700848,-.273908,.477526,.681017,.729862,-.269063,.457955,.722764,.758273,-.262282,.434846,.764349,.784121,-.254281,.409203,.806206,.809798,-.24505,.382694,.848617,.834953,-.233861,.354034,.892445,.856817,-.221308,.321764,.936263,.877609,-.205996,.288118,.982401,.897489,-.186702,.253277,1.02975,.913792,-.164618,.217963,1.07488,.92785,-.140023,.183221,1.11487,.940378,-.11328,.149385,1.14947,.95273,-.0853958,.114152,1.1807,.969059,-.0568698,.0769845,1.20912,.985574,-.0276502,.0381186,1.23498,.999943,.00239052,-.00126861,1.25987,.0852715,-560067e-11,.279021,171162e-11,.0854143,-140871e-9,.279483,430516e-10,.0854191,-563385e-9,.2795,172184e-9,.0854188,-.00126753,.279493,387464e-9,.0854229,-.00225337,.279501,68918e-8,.0854443,-.00352086,.279549,.00107803,.0854697,-.00506962,.279591,.00155536,.0855093,-.00689873,.279652,.00212354,.0855724,-.00900821,.279752,.00278703,.0856991,-.0113799,.280011,.0035551,.085855,-.0140314,.280297,.00443449,.0860682,-.016963,.280682,.00543636,.086344,-.0201438,.281159,.0065788,.0867426,-.0235999,.281886,.00787977,.087239,-.0273069,.282745,.0093606,.0879815,-.031269,.284139,.011056,.0891258,-.035531,.28647,.0130065,.0906909,-.0400947,.289708,.0152495,.0927624,-.0449638,.293904,.0178454,.0958376,-.0502427,.300471,.0208915,.0995827,-.0559514,.30806,.0244247,.104526,-.0622152,.317874,.0285721,.110532,-.0690046,.329332,.0334227,.117385,-.0763068,.341217,.0390466,.12522,-.084184,.353968,.0455786,.134037,-.0925248,.366797,.0530773,.144014,-.101487,.380209,.0617424,.156013,-.111273,.395956,.071777,.168872,-.121431,.41053,.0830905,.183089,-.132105,.425073,.0959341,.198763,-.143286,.439833,.110448,.216159,-.154841,.454507,.126769,.234859,-.166588,.468368,.14495,.255879,-.178626,.482846,.165233,.27677,-.190218,.493489,.187217,.301184,-.202227,.506549,.211659,.325852,-.213764,.5158,.237922,.352824,-.22487,.525442,.26632,.380882,-.235246,.532487,.296691,.410137,-.244847,.537703,.329179,.439787,-.253122,.540361,.363135,.472291,-.260517,.542734,.399222,.501856,-.266519,.538826,.436352,.534816,-.270905,.535152,.474505,.565069,-.273826,.525979,.513988,.597154,-.275333,.516394,.554852,.630473,-.275314,.506206,.596592,.660574,-.273323,.489769,.638117,.692015,-.270008,.472578,.680457,.720647,-.265001,.452134,.723008,.750528,-.258311,.430344,.765954,.777568,-.250046,.405624,.809012,.80387,-.240114,.378339,.852425,.828439,-.228737,.349877,.895346,.851472,-.216632,.318968,.940695,.873906,-.202782,.287489,.987235,.89467,-.187059,.254394,1.03348,.912281,-.168818,.221294,1.07812,.927358,-.146494,.18675,1.11928,.940385,-.120009,.152322,1.15609,.952672,-.0917183,.117514,1.18875,.968496,-.0620321,.0797405,1.21821,.985236,-.0314945,.0402383,1.24523,.99998,-575153e-9,110644e-9,1.27133,.0702429,-512222e-11,.255273,140947e-11,.0702981,-128826e-9,.255469,354488e-10,.0703691,-515562e-9,.255727,141874e-9,.0703805,-.00116,.255754,31929e-8,.0703961,-.00206224,.255813,567999e-9,.0704102,-.00322223,.255839,88871e-8,.0704298,-.00463928,.255863,.00128272,.0704759,-.00631375,.255953,.00175283,.0705434,-.00824317,.256079,.00230342,.0706693,-.010412,.25636,.0029443,.0708189,-.0128439,.256647,.00368031,.0710364,-.0155177,.257084,.00452614,.0713223,-.0184374,.257637,.00549706,.0717182,-.0216002,.258416,.00661246,.072321,-.0249966,.259699,.00790147,.0731446,-.0286566,.261475,.0093884,.0743352,-.0325888,.264132,.0111186,.0760676,-.036843,.26815,.013145,.078454,-.0414292,.273636,.0155251,.0818618,-.0464634,.281653,.0183525,.0857382,-.0519478,.289992,.0216642,.0908131,-.0579836,.30066,.0255956,.0967512,-.0645124,.312204,.0301954,.103717,-.0716505,.325001,.0356017,.111596,-.0793232,.338129,.041896,.120933,-.087645,.352853,.0492447,.130787,-.096492,.366192,.0576749,.142311,-.105973,.380864,.0673969,.155344,-.116182,.396575,.0785899,.169535,-.126815,.411443,.0912377,.185173,-.138015,.426256,.105607,.201755,-.149325,.439607,.121551,.221334,-.161207,.455467,.139608,.241461,-.173162,.469096,.159591,.26294,-.18504,.481014,.18156,.286776,-.196881,.493291,.205781,.311596,-.208311,.503556,.231819,.338667,-.219671,.513268,.260274,.366021,-.230451,.519414,.290862,.395875,-.240131,.526766,.323196,.425564,-.248566,.52905,.357071,.457094,-.256195,.530796,.393262,.488286,-.262331,.528703,.430797,.522291,-.267141,.52727,.470231,.554172,-.270411,.519848,.510477,.586427,-.271986,.510307,.551594,.619638,-.27192,.499158,.593849,.650656,-.269817,.483852,.636314,.68284,-.266267,.467515,.679679,.714356,-.26113,.44931,.723884,.742717,-.254067,.425789,.767245,.770894,-.245652,.401144,.811819,.797358,-.235554,.374224,.856315,.823377,-.223896,.346167,.901077,.847456,-.210865,.316056,.946502,.870697,-.196574,.284503,.993711,.891068,-.180814,.251628,1.04134,.909267,-.163314,.219065,1.08609,.925653,-.143304,.186446,1.12702,.940017,-.121322,.153416,1.16371,.952398,-.0973872,.120334,1.19712,.967568,-.0698785,.08352,1.22791,.984772,-.0390031,.0439209,1.25672,1.00026,-.0070087,.00315668,1.28428,.0556653,-459654e-11,.227325,112556e-11,.0565238,-116382e-9,.230826,284985e-10,.0565717,-465666e-9,.231026,114036e-9,.0565859,-.00104773,.231079,256656e-9,.0565761,-.00186255,.231025,45663e-8,.0565913,-.00291002,.231058,714664e-9,.0566108,-.00418998,.231085,.00103224,.0566532,-.00570206,.231169,.00141202,.0567473,-.00743666,.231417,.00186018,.0568567,-.00940298,.231661,.00238264,.0569859,-.0115991,.231895,.00298699,.0572221,-.0140096,.232456,.00368957,.057519,-.0166508,.233096,.00450303,.0579534,-.01951,.234094,.00544945,.0585922,-.0225991,.235629,.00655564,.0595647,-.0259416,.238106,.00785724,.0609109,-.0295661,.241557,.00939127,.0628751,-.0335126,.246652,.0112198,.0656908,-.0378604,.254091,.0134168,.0691347,-.0426543,.262666,.0160374,.0732165,-.0478967,.272029,.0191514,.0782863,-.0536716,.283007,.0228597,.0843973,-.0600683,.295732,.0272829,.0913598,-.0670095,.308779,.032484,.0994407,-.0745516,.322886,.0385886,.108189,-.082712,.336408,.0457133,.118574,-.0914927,.351692,.0539832,.129989,-.100854,.366502,.0635162,.142722,-.110837,.381675,.0744386,.156654,-.121353,.3963,.0868483,.172151,-.132414,.411477,.100963,.188712,-.143809,.42508,.116795,.208093,-.155765,.441328,.134715,.227936,-.167608,.454328,.154396,.249495,-.179579,.467235,.176179,.27362,-.191488,.480248,.200193,.296371,-.202618,.487886,.225775,.324234,-.214133,.499632,.25441,.353049,-.225212,.509532,.285077,.381785,-.234875,.514265,.317047,.414038,-.244205,.521282,.351874,.445251,-.252145,.522931,.388279,.476819,-.258433,.520947,.425825,.509209,-.263411,.517669,.465104,.542759,-.266732,.512841,.505741,.574822,-.268263,.503317,.547611,.609324,-.268489,.493035,.590953,.641772,-.266941,.478816,.63488,.674049,-.263297,.462863,.679072,.705071,-.257618,.442931,.723487,.734709,-.250625,.421299,.768708,.763704,-.24179,.397085,.814375,.791818,-.231115,.370577,.859907,.817439,-.21922,.34232,.906715,.843202,-.205658,.312627,.953943,.866639,-.190563,.280933,1.00185,.888129,-.173978,.248393,1.05105,.907239,-.155485,.216007,1.09704,.923893,-.134782,.183233,1.13857,.938882,-.11249,.150376,1.17539,.952464,-.0890706,.117177,1.20924,.968529,-.0646523,.0813095,1.24055,.984763,-.038606,.0439378,1.27018,1.00053,-.01238,.00598668,1.29873,.0437928,-409594e-11,.204012,879224e-12,.0440166,-103395e-9,.205049,221946e-10,.0440529,-413633e-9,.205225,887981e-10,.0440493,-930594e-9,.2052,199858e-9,.0439884,-.00165352,.204901,355495e-9,.0440716,-.0025849,.205255,556983e-9,.0440968,-.00372222,.205311,805326e-9,.0441359,-.00506478,.205391,.00110333,.0442231,-.00660384,.205638,.00145768,.0443254,-.00835246,.205877,.00187275,.0444832,-.0102992,.20627,.00235938,.0447001,-.0124449,.206796,.0029299,.0450168,-.0147935,.207593,.0036005,.0454816,-.017336,.208819,.00439246,.0462446,-.0201156,.211036,.00533864,.0473694,-.0231568,.214388,.00646984,.0490191,-.0264941,.219357,.00783856,.0512776,-.030184,.226061,.00950182,.0541279,-.0342661,.234094,.0115156,.0578989,-.0388539,.244297,.0139687,.0620835,-.0438735,.254457,.0169015,.0673497,-.04951,.266706,.0204554,.0731759,-.0556263,.278753,.0246606,.0803937,-.0624585,.29309,.0297126,.0879287,-.0697556,.305856,.0355868,.0970669,-.0778795,.321059,.0425768,.106508,-.0863541,.333873,.05056,.11776,-.0955935,.349008,.0598972,.130081,-.105438,.363776,.0706314,.144454,-.115899,.380112,.0828822,.1596,-.126827,.394843,.0967611,.176097,-.138161,.409033,.112381,.194726,-.149904,.424257,.129952,.213944,-.161675,.436945,.149333,.235516,-.173659,.450176,.170892,.260564,-.185963,.466305,.194984,.285183,-.197582,.477328,.220805,.311095,-.208697,.486566,.248694,.338924,-.219519,.494811,.279015,.369757,-.229766,.504065,.311725,.3996,-.238879,.507909,.345844,.430484,-.246802,.509805,.381749,.46413,-.253924,.511436,.420251,.497077,-.259319,.508787,.459957,.530434,-.263297,.50394,.501356,.565725,-.265619,.49804,.544252,.599254,-.265842,.487346,.587856,.631251,-.263978,.472975,.631969,.663972,-.26043,.457135,.677471,.697724,-.255358,.439844,.723744,.727725,-.248308,.417872,.770653,.756417,-.239181,.39273,.817357,.785419,-.22814,.367839,.864221,.81266,-.215681,.339449,.912701,.839391,-.201623,.309279,.962419,.86366,-.185624,.278029,1.0122,.885028,-.16797,.245294,1.06186,.904639,-.148336,.212689,1.10934,.922048,-.12637,.179616,1.15063,.936952,-.102928,.146749,1.18885,.951895,-.0785268,.112733,1.22352,.967198,-.0530153,.0760056,1.25681,.984405,-.02649,.0383183,1.28762,1.00021,70019e-8,-20039e-8,1.31656,.0325964,-355447e-11,.176706,655682e-12,.0329333,-899174e-10,.178527,165869e-10,.0329181,-359637e-9,.178453,663498e-10,.0329085,-808991e-9,.178383,149332e-9,.0329181,-.00143826,.178394,265873e-9,.0329425,-.00224678,.178517,416597e-9,.0329511,-.00323575,.17849,603299e-9,.033011,-.00439875,.178695,829422e-9,.0330733,-.00574059,.178843,.00109908,.0331857,-.00725896,.179176,.00141933,.0333445,-.00895289,.179618,.0017999,.0335674,-.0108219,.180238,.00225316,.033939,-.0128687,.181417,.00279765,.0345239,-.015114,.183395,.0034564,.0354458,-.017596,.186616,.00425864,.0368313,-.0203524,.191547,.00524936,.0386115,-.0234105,.197508,.00647033,.0410303,-.0268509,.205395,.00798121,.0442245,-.0307481,.215365,.0098557,.0478659,-.0350863,.225595,.0121417,.0522416,-.0399506,.236946,.0149385,.0574513,-.045357,.249442,.0183189,.0631208,-.0512863,.261222,.0223644,.0701124,-.0579273,.275418,.0272418,.0777331,-.0650652,.288989,.0329458,.0862709,-.0728813,.302546,.0396819,.096103,-.081363,.317164,.04757,.106976,-.0904463,.331733,.0567012,.119175,-.100105,.34661,.067202,.132919,-.110375,.362249,.0792588,.147727,-.121115,.376978,.0928672,.163618,-.132299,.390681,.108228,.182234,-.143887,.406571,.125502,.201809,-.155827,.42042,.144836,.225041,-.168357,.438411,.166706,.247621,-.18004,.450368,.189909,.27097,-.191536,.460083,.215251,.296658,-.203024,.469765,.243164,.325892,-.214056,.481837,.273388,.35406,-.224104,.487474,.305344,.384372,-.233489,.492773,.339741,.41749,-.241874,.498451,.376287,.45013,-.248834,.499632,.414195,.481285,-.254658,.495233,.454077,.519183,-.259367,.496401,.496352,.551544,-.261818,.487686,.538798,.587349,-.262964,.479453,.583626,.621679,-.262128,.467709,.629451,.654991,-.258998,.452123,.67566,.686873,-.254119,.433495,.723248,.719801,-.246946,.413657,.771156,.750355,-.237709,.390366,.81989,.780033,-.226549,.364947,.868601,.809254,-.214186,.337256,.920034,.836576,-.199639,.307395,.971706,.861774,-.183169,.275431,1.02479,.885707,-.165111,.243431,1.07837,.904742,-.144363,.210921,1.12783,.915604,-.121305,.17647,1.17254,.930959,-.0962119,.143106,1.21012,.948404,-.069969,.108112,1.24474,.967012,-.0427586,.0708478,1.27718,.984183,-.0147043,.032335,1.3083,.999577,.0142165,-.00726867,1.3382,.0229227,-299799e-11,.148623,462391e-12,.0232194,-758796e-10,.15054,117033e-10,.0232315,-303636e-9,.15063,468397e-10,.0232354,-683189e-9,.150624,105472e-9,.0232092,-.0012136,.150445,187744e-9,.0232523,-.00189765,.150679,294847e-9,.0232828,-.00273247,.150789,428013e-9,.0233371,-.00371287,.150995,591134e-9,.0234015,-.00484794,.15118,787642e-9,.023514,-.00612877,.151562,.00102547,.023679,-.00756125,.152116,.00131351,.0239559,-.00914651,.153162,.00166594,.0244334,-.010904,.155133,.00210182,.025139,-.0128615,.158035,.00264406,.0262598,-.0150628,.162751,.00332923,.0277875,-.0175532,.168944,.00419773,.0298472,-.0203981,.176835,.00530034,.0325444,-.023655,.186686,.00669777,.0355581,-.0272982,.196248,.00842661,.0392841,-.0314457,.207352,.0105854,.0436815,-.0361157,.219279,.0132458,.0485272,-.0412932,.230728,.0164736,.0541574,-.0470337,.242994,.0203715,.0609479,-.0535002,.257042,.0250953,.0685228,-.0605409,.27102,.0306856,.0768042,-.0680553,.28406,.037193,.0864844,-.0765011,.299186,.0449795,.0969415,-.0852674,.3132,.0538316,.108478,-.0947333,.327138,.0641149,.121705,-.10481,.342345,.0759185,.136743,-.115474,.358472,.0894116,.152986,-.126536,.374067,.104562,.170397,-.138061,.388267,.121632,.191392,-.150203,.406467,.140996,.211566,-.161751,.418641,.161696,.233567,-.173407,.430418,.184557,.257769,-.185397,.44277,.210092,.28531,-.197048,.457191,.237827,.311726,-.20784,.464712,.267253,.340537,-.218345,.472539,.299332,.372921,-.228306,.482331,.333988,.402924,-.236665,.484378,.369722,.434475,-.244097,.484717,.407836,.469736,-.250547,.487093,.448465,.505045,-.25511,.485575,.490263,.540262,-.258444,.481225,.534495,.576347,-.259903,.473481,.579451,.608656,-.259572,.4603,.625604,.646679,-.257908,.450341,.674511,.679902,-.253663,.431561,.723269,.714159,-.247419,.412684,.773263,.745345,-.239122,.389388,.824182,.778248,-.228837,.365361,.876634,.807208,-.216197,.337667,.92945,.835019,-.201772,.307197,.985261,.860261,-.185291,.274205,1.04299,.877601,-.165809,.240178,1.09816,.898211,-.143897,.207571,1.14694,.915789,-.119513,.174904,1.19008,.931831,-.0932919,.141423,1.2297,.949244,-.0656528,.105603,1.26553,.967527,-.0370262,.0679551,1.29986,.984139,-.00730117,.0283133,1.33252,.999713,.0234648,-.0121785,1.36397,.0152135,-245447e-11,.122795,304092e-12,.0151652,-615778e-10,.122399,76292e-10,.0151181,-245948e-9,.122023,304802e-10,.0151203,-553394e-9,.12203,686634e-10,.015125,-983841e-9,.122037,122463e-9,.0151427,-.00153774,.12214,192706e-9,.0151708,-.0022103,.122237,281219e-9,.0152115,-.00300741,.12238,390804e-9,.0152877,-.00392494,.1227,526317e-9,.015412,-.00496597,.123244,69443e-8,.0156201,-.00613314,.124228,90547e-8,.0159658,-.00744113,.125945,.0011732,.0165674,-.00892546,.129098,.00151888,.017487,-.010627,.133865,.00197007,.018839,-.0126043,.140682,.0025637,.020554,-.0148814,.148534,.00333637,.0226727,-.0175123,.157381,.00433738,.0251879,-.0205266,.166685,.00561664,.0283635,-.0240319,.177796,.00725563,.0318694,-.0279432,.188251,.00928811,.0361044,-.0324313,.200038,.011835,.0406656,-.0373527,.210685,.0149146,.0463846,-.0430132,.224182,.0187254,.0525696,-.0491013,.23634,.0232283,.0598083,-.0559175,.250013,.0286521,.0679437,-.0633657,.263981,.0350634,.0771181,-.0714602,.278072,.0425882,.0881273,-.0803502,.29511,.0514487,.0996628,-.0896903,.309976,.0615766,.112702,-.099644,.325611,.0732139,.126488,-.109829,.339321,.0862324,.142625,-.120859,.35574,.101275,.15953,-.131956,.369845,.117892,.176991,-.143145,.38146,.136205,.199715,-.155292,.40052,.157252,.220787,-.167066,.412055,.179966,.243697,-.178396,.423133,.204418,.272106,-.190433,.439524,.232141,.297637,-.201265,.447041,.261109,.325273,-.211834,.454488,.292627,.357219,-.221889,.465004,.326669,.387362,-.230729,.468527,.362426,.423131,-.23924,.475836,.401533,.45543,-.246067,.475017,.441902,.493393,-.251557,.478017,.484239,.526253,-.255571,.4709,.528586,.560554,-.257752,.463167,.574346,.599306,-.258076,.456452,.621655,.634541,-.256471,.443725,.670492,.668907,-.253283,.428719,.721943,.705619,-.247562,.411348,.772477,.739034,-.240626,.388939,.8264,.771408,-.231493,.36425,.881702,.803312,-.220125,.337321,.9385,.828457,-.206645,.305364,.997437,.854819,-.190664,.273715,1.05693,.878666,-.171429,.242218,1.11251,.898404,-.149235,.209556,1.16398,.917416,-.12435,.176863,1.21014,.933133,-.0972703,.142775,1.25178,.95066,-.0683607,.106735,1.29028,.968589,-.0378724,.0681609,1.32703,.984776,-.00605712,.0273966,1.36158,.99994,.0263276,-.0138124,1.3943,.00867437,-186005e-11,.0928979,173682e-12,.00864003,-466389e-10,.0925237,435505e-11,.00864593,-186594e-9,.0925806,174322e-10,.00864095,-419639e-9,.0924903,392862e-10,.00863851,-746272e-9,.0924589,702598e-10,.00868531,-.00116456,.0929,111188e-9,.00869667,-.00167711,.0928529,163867e-9,.00874332,-.00228051,.0930914,23104e-8,.00882709,-.00297864,.0935679,31741e-8,.00898874,-.00377557,.0946165,430186e-9,.00929346,-.00469247,.0967406,580383e-9,.00978271,-.00575491,.100084,783529e-9,.0105746,-.00701514,.105447,.00106304,.0116949,-.00851797,.112494,.00144685,.0130419,-.0102757,.119876,.00196439,.0148375,-.012381,.129034,.00266433,.0168725,-.01482,.137812,.00358364,.0193689,-.0176563,.147696,.00478132,.0222691,-.0209211,.157795,.00631721,.0256891,-.0246655,.168431,.00826346,.0294686,-.0288597,.178587,.0106714,.0340412,-.0336441,.190251,.0136629,.0393918,-.039033,.202999,.0173272,.0453947,-.0450087,.215655,.0217448,.0521936,-.0515461,.228686,.0269941,.0600279,-.058817,.242838,.033272,.0692398,-.0667228,.258145,.0406457,.0793832,-.0752401,.273565,.0492239,.0902297,-.0841851,.287735,.0590105,.102014,-.0936479,.301161,.0702021,.116054,-.103967,.317438,.0832001,.13191,-.114622,.334166,.0977951,.148239,-.125452,.348192,.113985,.165809,-.136453,.361094,.131928,.184616,-.147648,.373534,.151811,.207491,-.159607,.39101,.174476,.230106,-.171119,.402504,.198798,.257036,-.182906,.418032,.225796,.281172,-.193605,.425468,.254027,.312034,-.204771,.440379,.285713,.340402,-.214988,.445406,.319196,.370231,-.224711,.44968,.35537,.407105,-.233516,.460747,.393838,.439037,-.240801,.460624,.433747,.47781,-.24762,.465957,.477234,.510655,-.251823,.460054,.52044,.550584,-.255552,.459172,.567853,.585872,-.257036,.450311,.615943,.620466,-.257535,.437763,.667693,.660496,-.255248,.426639,.718988,.695578,-.251141,.409185,.772503,.732176,-.244718,.39015,.827023,.760782,-.236782,.362594,.885651,.79422,-.225923,.33711,.943756,.824521,-.213855,.308272,1.00874,.854964,-.197723,.278529,1.06764,.878065,-.179209,.246208,1.12836,.899834,-.157569,.21329,1.18318,.918815,-.133206,.181038,1.23161,.934934,-.106545,.146993,1.27644,.952115,-.0780574,.111175,1.31842,.96906,-.0478279,.0728553,1.35839,.985178,-.0160014,.032579,1.39697,1.00039,.0173126,-.0095256,1.43312,.00384146,-124311e-11,.0613583,778271e-13,.00390023,-314043e-10,.0622919,196626e-11,.00389971,-125622e-9,.0622632,787379e-11,.00389491,-282352e-9,.0620659,1778e-8,.00391618,-502512e-9,.0624687,320918e-10,.00392662,-784458e-9,.0625113,515573e-10,.00396053,-.00112907,.0628175,778668e-10,.00401911,-.00153821,.0633286,113811e-9,.00414994,-.0020208,.0646443,16445e-8,.00441223,-.00260007,.0673886,237734e-9,.00484427,-.0033097,.0716528,345929e-9,.00549109,-.00418966,.0774998,505987e-9,.00636293,-.00527331,.0844758,739208e-9,.00746566,-.00660428,.0921325,.00107347,.00876625,-.00818826,.0997067,.00153691,.0103125,-.0100811,.107433,.00217153,.0123309,-.0123643,.117088,.00303427,.0146274,-.0150007,.126438,.00416018,.0172295,-.0180531,.135672,.00561513,.0204248,-.0215962,.146244,.007478,.0241597,-.0256234,.157481,.00981046,.0284693,-.0302209,.169125,.0127148,.033445,-.0353333,.181659,.0162453,.0391251,-.0410845,.1944,.0205417,.0454721,-.0473451,.207082,.0256333,.0530983,-.0542858,.221656,.0317036,.0615356,-.0618384,.236036,.0388319,.0703363,-.0697631,.248398,.046974,.0810391,-.0784757,.263611,.0565246,.0920144,-.0873488,.275857,.0671724,.105584,-.0973652,.292555,.0798105,.119506,-.107271,.306333,.0935945,.134434,-.117608,.318888,.109106,.153399,-.128938,.337552,.127074,.171258,-.139944,.349955,.14643,.191059,-.151288,.361545,.168,.215069,-.163018,.378421,.192082,.237838,-.174226,.38879,.217838,.266965,-.186063,.405857,.246931,.292827,-.196909,.414146,.277505,.324352,-.207473,.426955,.310711,.354427,-.217713,.433429,.346794,.389854,-.227183,.443966,.385237,.420749,-.235131,.44471,.424955,.459597,-.242786,.451729,.468446,.495316,-.248767,.45072,.513422,.534903,-.253351,.450924,.560618,.572369,-.256277,.445266,.609677,.612383,-.2576,.438798,.660995,.644037,-.256931,.421693,.713807,.686749,-.254036,.4109,.767616,.719814,-.249785,.390151,.82533,.754719,-.244283,.367847,.888311,.792022,-.235076,.345013,.948177,.822404,-.225061,.316193,1.01661,.853084,-.211113,.287013,1.08075,.879871,-.19449,.255424,1.14501,.901655,-.174023,.222879,1.20203,.919957,-.1509,.18989,1.25698,.938412,-.124923,.15606,1.30588,.953471,-.0968139,.120512,1.3529,.970451,-.066734,.0828515,1.3986,.985522,-.034734,.0424458,1.44148,1.00099,-.00102222,678929e-9,1.48398,965494e-9,-627338e-12,.0306409,197672e-13,99168e-8,-158573e-10,.0314638,499803e-12,991068e-9,-634012e-10,.031363,200682e-11,974567e-9,-14144e-8,.03036,457312e-11,998079e-9,-252812e-9,.031496,860131e-11,.00102243,-396506e-9,.0319955,148288e-10,.00107877,-577593e-9,.0331376,249141e-10,.00121622,-816816e-9,.0359396,423011e-10,.0014455,-.00113761,.0399652,724613e-10,.00178791,-.00156959,.0450556,123929e-9,.00225668,-.00214064,.0508025,208531e-9,.00285627,-.00287655,.0568443,341969e-9,.0035991,-.00380271,.0630892,544158e-9,.00455524,-.00496264,.0702204,842423e-9,.00569143,-.0063793,.0773426,.00126704,.00716928,-.00813531,.0860839,.00186642,.00885307,-.0101946,.0944079,.00267014,.0109316,-.0126386,.103951,.00374033,.0133704,-.0154876,.113786,.0051304,.0161525,-.0187317,.123477,.00688858,.0194267,-.0224652,.133986,.00910557,.0230967,-.0265976,.143979,.0118074,.0273627,-.0312848,.154645,.0151266,.0323898,-.0365949,.166765,.0191791,.0379225,-.0422914,.177932,.0239236,.0447501,-.0487469,.19167,.0296568,.0519391,-.0556398,.203224,.0362924,.0599464,-.0631646,.215652,.0440585,.0702427,-.0714308,.232089,.0531619,.0806902,-.0800605,.245258,.0634564,.0923194,-.0892815,.258609,.0752481,.106938,-.09931,.276654,.0888914,.121238,-.109575,.289847,.104055,.138817,-.120461,.307566,.121266,.15595,-.131209,.320117,.139944,.178418,-.143049,.339677,.161591,.197875,-.154074,.349886,.184303,.224368,-.166307,.369352,.210669,.252213,-.178051,.386242,.238895,.277321,-.189335,.395294,.269182,.310332,-.200683,.412148,.302508,.338809,-.210856,.418266,.337264,.372678,-.220655,.428723,.374881,.405632,-.230053,.433887,.415656,.442293,-.237993,.439911,.457982,.477256,-.244897,.440175,.502831,.515592,-.250657,.441079,.550277,.550969,-.255459,.435219,.601102,.592883,-.257696,.432882,.651785,.629092,-.259894,.421054,.708961,.672033,-.258592,.41177,.763806,.709147,-.256525,.395267,.824249,.745367,-.254677,.375013,.8951,.784715,-.247892,.353906,.959317,.818107,-.240162,.327801,1.03153,.847895,-.229741,.298821,1.10601,.879603,-.213084,.269115,1.164,.902605,-.195242,.236606,1.22854,.922788,-.174505,.203442,1.29017,.944831,-.150169,.169594,1.34157,.959656,-.124099,.135909,1.3956,.972399,-.0960626,.0990563,1.45128,.986549,-.0657097,.0602348,1.50312,1.00013,-.0333558,.0186694,1.55364,619747e-11,-1e-7,.00778326,796756e-16,237499e-13,-999999e-13,282592e-10,114596e-15,100292e-11,-166369e-11,250354e-9,677492e-14,350752e-11,-637769e-11,357289e-9,631655e-13,826445e-11,-174689e-10,516179e-9,31851e-11,242481e-10,-450868e-10,.0010223,130577e-11,455631e-10,-89044e-9,.00144302,374587e-11,971222e-10,-178311e-9,.00241912,102584e-10,171403e-9,-313976e-9,.00354938,236481e-10,292747e-9,-520026e-9,.00513765,496014e-10,789827e-9,-.00118187,.0238621,139056e-9,.00114093,-.00171827,.0286691,244093e-9,.00176119,-.00249667,.0368565,420623e-9,.0022233,-.00333742,.0400469,65673e-8,.00343382,-.00481976,.0535751,.00109323,.00427602,-.00600755,.057099,.00155268,.00461435,-.00737637,.0551084,.00215031,.00695698,-.00971401,.0715767,.00316529,.00867619,-.0120943,.0793314,.00436995,.0106694,-.0148202,.0869391,.0058959,.0140351,-.0183501,.101572,.00798757,.0168939,-.022006,.11018,.0104233,.020197,-.0261568,.119041,.0134167,.0254702,-.0312778,.135404,.0173009,.0298384,-.0362469,.1437,.0215428,.035159,-.042237,.15512,.0268882,.0427685,-.0488711,.17128,.033235,.0494848,-.0557997,.181813,.0404443,.0592394,-.0635578,.198745,.0490043,.0681463,-.071838,.210497,.0588239,.0804753,-.0809297,.228864,.0702835,.0942205,-.0906488,.247008,.0834012,.106777,-.100216,.258812,.0975952,.124471,-.110827,.278617,.114162,.138389,-.121193,.287049,.131983,.159543,-.13253,.307151,.152541,.176432,-.143611,.31564,.174673,.201723,-.15548,.33538,.199842,.229721,-.167166,.355256,.227097,.250206,-.178238,.360047,.256014,.282118,-.189905,.378761,.28855,.312821,-.201033,.39181,.323348,.341482,-.211584,.397716,.360564,.377368,-.221314,.410141,.400004,.418229,-.230474,.423485,.442371,.444881,-.239443,.418874,.488796,.488899,-.245987,.427545,.535012,.520317,-.253948,.422147,.589678,.568566,-.256616,.42719,.637683,.599607,-.26376,.415114,.703363,.64222,-.268687,.408715,.771363,.685698,-.2694,.399722,.83574,.732327,-.266642,.388651,.897764,.769873,-.267712,.369198,.983312,.806733,-.263479,.346802,1.06222,.843466,-.254575,.321368,1.13477,.873008,-.242749,.29211,1.20712,.908438,-.22725,.262143,1.27465,.936321,-.207621,.228876,1.33203,.950353,-.187932,.19484,1.40439,.96442,-.165154,.163178,1.4732,.979856,-.139302,.127531,1.53574,.982561,-.11134,.0903457,1.59982,.996389,-.0808124,.0489007,1.6577],tr=[1,0,0,0,1,791421e-36,0,0,1,104392e-29,0,0,1,349405e-26,0,0,1,109923e-23,0,0,1,947414e-22,0,0,1,359627e-20,0,0,1,772053e-19,0,0,1,108799e-17,0,0,1,110655e-16,0,0,1,865818e-16,0,0,.999998,545037e-15,0,0,.999994,285095e-14,0,0,.999989,126931e-13,0,0,.999973,489938e-13,0,0,.999947,166347e-12,0,0,.999894,502694e-12,0,0,.999798,136532e-11,0,0,.999617,335898e-11,0,0,.999234,752126e-11,0,0,.998258,152586e-10,0,0,.99504,266207e-10,0,0,.980816,236802e-10,0,0,.967553,207684e-11,0,0,.966877,403733e-11,0,0,.965752,741174e-11,0,0,.96382,127746e-10,0,0,.960306,202792e-10,0,0,.953619,280232e-10,0,0,.941103,278816e-10,0,0,.926619,160221e-10,0,0,.920983,235164e-10,0,0,.912293,311924e-10,0,.0158731,.899277,348118e-10,0,.0476191,.880884,26041e-9,0,.0793651,.870399,338726e-10,0,.111111,.856138,392906e-10,0,.142857,.837436,372874e-10,0,.174603,.820973,392558e-10,0,.206349,.803583,434658e-10,0,.238095,.782168,40256e-9,0,.269841,.764107,448159e-10,0,.301587,.743092,457627e-10,0,.333333,.721626,455314e-10,0,.365079,.700375,477335e-10,0,.396825,.677334,461072e-10,0,.428571,.655702,484393e-10,0,.460317,.632059,464583e-10,0,.492064,.610125,483923e-10,0,.52381,.58653,464342e-10,0,.555556,.564508,477033e-10,0,.587302,.541405,459263e-10,0,.619048,.519556,46412e-9,0,.650794,.497292,448913e-10,0,.68254,.475898,445789e-10,0,.714286,.454722,433496e-10,0,.746032,.434042,423054e-10,0,.777778,.414126,413737e-10,0,.809524,.394387,397265e-10,0,.84127,.375841,390709e-10,0,.873016,.357219,369938e-10,0,.904762,.340084,365618e-10,0,.936508,.322714,342533e-10,0,.968254,.306974,339596e-10,0,1,1,101524e-23,0,0,1,10292e-22,0,0,1,130908e-23,0,0,1,473331e-23,0,0,1,625319e-22,0,0,1,107932e-20,0,0,1,163779e-19,0,0,1,203198e-18,0,0,1,204717e-17,0,0,.999999,168995e-16,0,0,.999998,115855e-15,0,0,.999996,66947e-14,0,0,.999991,330863e-14,0,0,.999983,141737e-13,0,0,.999968,532626e-13,0,0,.99994,177431e-12,0,0,.999891,528835e-12,0,0,.999797,142169e-11,0,0,.999617,347057e-11,0,0,.999227,77231e-10,0,0,.998239,155753e-10,0,0,.994937,268495e-10,0,0,.980225,213742e-10,0,0,.967549,21631e-10,0,0,.966865,417989e-11,0,0,.965739,763341e-11,0,0,.963794,130892e-10,0,0,.960244,206456e-10,0,0,.953495,282016e-10,0,148105e-9,.940876,271581e-10,0,.002454,.926569,164159e-10,0,.00867491,.920905,239521e-10,0,.01956,.912169,315127e-10,0,.035433,.899095,346626e-10,0,.056294,.882209,290223e-10,0,.0818191,.870272,342992e-10,0,.111259,.855977,394164e-10,0,.142857,.837431,372343e-10,0,.174603,.820826,396691e-10,0,.206349,.803408,435395e-10,0,.238095,.782838,419579e-10,0,.269841,.763941,450953e-10,0,.301587,.742904,455847e-10,0,.333333,.721463,458833e-10,0,.365079,.700197,477159e-10,0,.396825,.677501,470641e-10,0,.428571,.655527,484732e-10,0,.460317,.6324,476834e-10,0,.492064,.609964,484213e-10,0,.52381,.586839,475541e-10,0,.555556,.564353,476951e-10,0,.587302,.541589,467611e-10,0,.619048,.519413,463493e-10,0,.650794,.497337,453994e-10,0,.68254,.475797,445308e-10,0,.714286,.454659,435787e-10,0,.746032,.434065,424839e-10,0,.777778,.414018,41436e-9,0,.809524,.39455,401902e-10,0,.84127,.375742,390813e-10,0,.873016,.357501,377116e-10,0,.904762,.339996,36535e-9,0,.936508,.323069,351265e-10,0,.968254,.306897,339112e-10,0,1,1,10396e-19,0,0,1,104326e-20,0,0,1,110153e-20,0,0,1,144668e-20,0,0,1,34528e-19,0,0,1,175958e-19,0,0,1,12627e-17,0,0,1,936074e-18,0,0,1,645742e-17,0,0,.999998,401228e-16,0,0,.999997,222338e-15,0,0,.999995,10967e-13,0,0,.999991,482132e-14,0,0,.999981,189434e-13,0,0,.999967,667716e-13,0,0,.999938,212066e-12,0,0,.999886,60977e-11,0,0,.999792,159504e-11,0,0,.999608,381191e-11,0,0,.999209,833727e-11,0,0,.998179,165288e-10,0,0,.994605,274387e-10,0,0,.979468,167316e-10,0,0,.967529,242877e-11,0,0,.966836,461696e-11,0,0,.96569,830977e-11,0,0,.963706,140427e-10,0,244659e-11,.960063,217353e-10,0,760774e-9,.953113,286606e-10,0,.00367261,.940192,247691e-10,0,.00940263,.927731,195814e-10,0,.018333,.920669,252531e-10,0,.0306825,.911799,324277e-10,0,.0465556,.89857,340982e-10,0,.0659521,.883283,319622e-10,0,.0887677,.86989,35548e-9,0,.114784,.855483,397143e-10,0,.143618,.837987,391665e-10,0,.174606,.820546,411306e-10,0,.206349,.802878,436753e-10,0,.238095,.783402,444e-7,0,.269841,.763439,458726e-10,0,.301587,.742925,467097e-10,0,.333333,.721633,478887e-10,0,.365079,.69985,481251e-10,0,.396825,.67783,491811e-10,0,.428571,.655126,488199e-10,0,.460318,.632697,496025e-10,0,.492064,.609613,48829e-9,0,.52381,.587098,492754e-10,0,.555556,.564119,482625e-10,0,.587302,.541813,482807e-10,0,.619048,.519342,471552e-10,0,.650794,.497514,466765e-10,0,.68254,.475879,455582e-10,0,.714286,.454789,446007e-10,0,.746032,.434217,435382e-10,0,.777778,.414086,421753e-10,0,.809524,.394744,412093e-10,0,.84127,.375782,396634e-10,0,.873016,.357707,386419e-10,0,.904762,.340038,370345e-10,0,.936508,.323284,359725e-10,0,.968254,.306954,3436e-8,0,1,1,599567e-19,0,0,1,600497e-19,0,0,1,614839e-19,0,0,1,686641e-19,0,0,1,972658e-19,0,0,1,221271e-18,0,0,1,833195e-18,0,0,1,403601e-17,0,0,.999999,206001e-16,0,0,.999998,101739e-15,0,0,.999997,470132e-15,0,0,.999993,200436e-14,0,0,.999988,783682e-14,0,0,.999979,280338e-13,0,0,.999962,917033e-13,0,0,.999933,274514e-12,0,0,.999881,753201e-12,0,0,.999783,189826e-11,0,0,.999594,440279e-11,0,0,.999178,93898e-10,0,0,.998073,181265e-10,0,0,.993993,280487e-10,0,0,.979982,149422e-10,0,0,.968145,378481e-11,0,0,.966786,53771e-10,0,0,.965611,947508e-11,0,388934e-10,.963557,156616e-10,0,9693e-7,.959752,235144e-10,0,.00370329,.952461,291568e-10,0,.00868428,.940193,240102e-10,0,.0161889,.929042,231235e-10,0,.0263948,.920266,273968e-10,0,.0394088,.911178,337915e-10,0,.0552818,.897873,333629e-10,0,.0740138,.884053,351405e-10,0,.0955539,.869455,378034e-10,0,.119795,.854655,399378e-10,0,.14656,.838347,419108e-10,0,.175573,.820693,440831e-10,0,.206388,.802277,445599e-10,0,.238095,.783634,472691e-10,0,.269841,.763159,476984e-10,0,.301587,.742914,491487e-10,0,.333333,.721662,502312e-10,0,.365079,.699668,502817e-10,0,.396825,.677839,51406e-9,0,.428571,.655091,511095e-10,0,.460317,.632665,516067e-10,0,.492064,.609734,512255e-10,0,.52381,.587043,510263e-10,0,.555556,.564298,50565e-9,0,.587302,.541769,497951e-10,0,.619048,.519529,492698e-10,0,.650794,.497574,482066e-10,0,.68254,.476028,473689e-10,0,.714286,.454961,461941e-10,0,.746032,.434341,450618e-10,0,.777778,.414364,438355e-10,0,.809524,.394832,424196e-10,0,.84127,.376109,412563e-10,0,.873016,.35779,396226e-10,0,.904762,.340379,384886e-10,0,.936508,.323385,368214e-10,0,.968254,.307295,356636e-10,0,1,1,106465e-17,0,0,1,106555e-17,0,0,1,107966e-17,0,0,1,114601e-17,0,0,1,137123e-17,0,0,1,21243e-16,0,0,.999999,489653e-17,0,0,.999999,160283e-16,0,0,.999998,62269e-15,0,0,.999997,251859e-15,0,0,.999996,996192e-15,0,0,.999992,374531e-14,0,0,.999986,132022e-13,0,0,.999975,433315e-13,0,0,.999959,131956e-12,0,0,.999927,372249e-12,0,0,.999871,972461e-12,0,0,.999771,235343e-11,0,0,.999572,52768e-10,0,0,.999133,109237e-10,0,0,.997912,203675e-10,0,0,.993008,279396e-10,0,0,.980645,139604e-10,0,0,.970057,646596e-11,0,0,.966717,65089e-10,0,474145e-10,.965497,111863e-10,0,89544e-8,.96334,179857e-10,0,.0032647,.959294,259045e-10,0,.0075144,.951519,292327e-10,0,.0138734,.940517,249769e-10,0,.0224952,.93014,26803e-9,0,.0334828,.91972,303656e-10,0,.0468973,.910294,353323e-10,0,.0627703,.897701,351002e-10,0,.0811019,.884522,388104e-10,0,.10186,.869489,412932e-10,0,.124985,.853983,415781e-10,0,.150372,.838425,454066e-10,0,.177868,.820656,471624e-10,0,.207245,.801875,475243e-10,0,.238143,.783521,505621e-10,0,.269841,.763131,50721e-9,0,.301587,.74261,523293e-10,0,.333333,.72148,528699e-10,0,.365079,.699696,538677e-10,0,.396825,.677592,539255e-10,0,.428571,.65525,546367e-10,0,.460317,.632452,541348e-10,0,.492064,.609903,544976e-10,0,.52381,.586928,536201e-10,0,.555556,.564464,535185e-10,0,.587302,.541801,524949e-10,0,.619048,.519681,51812e-9,0,.650794,.497685,507687e-10,0,.68254,.47622,496243e-10,0,.714286,.455135,485714e-10,0,.746032,.4346,471847e-10,0,.777778,.414564,459294e-10,0,.809524,.395165,444705e-10,0,.84127,.376333,430772e-10,0,.873016,.358197,416229e-10,0,.904762,.34064,401019e-10,0,.936508,.323816,386623e-10,0,.968254,.307581,370933e-10,0,1,1,991541e-17,0,0,1,992077e-17,0,0,1,100041e-16,0,0,1,10385e-15,0,0,1,115777e-16,0,0,1,150215e-16,0,0,.999999,254738e-16,0,0,.999999,598822e-16,0,0,.999998,179597e-15,0,0,.999997,602367e-15,0,0,.999994,206835e-14,0,0,.99999,694952e-14,0,0,.999984,223363e-13,0,0,.999972,678578e-13,0,0,.999952,193571e-12,0,0,.999919,516594e-12,0,0,.99986,128739e-11,0,0,.999753,299298e-11,0,0,.999546,648258e-11,0,0,.999074,129985e-10,0,0,.997671,232176e-10,0,0,.991504,256701e-10,0,0,.981148,131141e-10,0,0,.971965,869048e-11,0,280182e-10,.966624,808301e-11,0,695475e-9,.965344,135235e-10,0,.00265522,.963048,210592e-10,0,.00622975,.958673,287473e-10,0,.0116234,.950262,281379e-10,0,.018976,.940836,271089e-10,0,.0283844,.930996,30926e-9,0,.0399151,.919848,348359e-10,0,.0536063,.909136,366092e-10,0,.0694793,.897554,384162e-10,0,.0875342,.884691,430971e-10,0,.107749,.869414,447803e-10,0,.130087,.853462,452858e-10,0,.154481,.838187,495769e-10,0,.180833,.820381,502709e-10,0,.209005,.801844,522713e-10,0,.238791,.783061,541505e-10,0,.269869,.763205,553712e-10,0,.301587,.742362,564909e-10,0,.333333,.721393,572646e-10,0,.365079,.699676,581012e-10,0,.396825,.677395,58096e-9,0,.428571,.655208,585766e-10,0,.460317,.632451,583602e-10,0,.492064,.609839,580234e-10,0,.52381,.587093,577161e-10,0,.555556,.564467,568447e-10,0,.587302,.542043,563166e-10,0,.619048,.519826,55156e-9,0,.650794,.497952,541682e-10,0,.68254,.476477,528971e-10,0,.714286,.455412,514952e-10,0,.746032,.434926,502222e-10,0,.777778,.4149,485779e-10,0,.809524,.395552,472242e-10,0,.84127,.376712,454891e-10,0,.873016,.358622,440924e-10,0,.904762,.341048,422984e-10,0,.936508,.324262,408582e-10,0,.968254,.308013,390839e-10,0,1,1,613913e-16,0,0,1,614145e-16,0,0,1,617708e-16,0,0,1,633717e-16,0,0,1,681648e-16,0,0,1,808291e-16,0,0,1,114608e-15,0,0,.999998,210507e-15,0,0,.999997,499595e-15,0,0,.999995,139897e-14,0,0,.999994,419818e-14,0,0,.999988,127042e-13,0,0,.999979,375153e-13,0,0,.999965,106206e-12,0,0,.999945,285381e-12,0,0,.999908,723611e-12,0,0,.999846,17255e-10,0,0,.999733,386104e-11,0,0,.999511,808493e-11,0,0,.998993,156884e-10,0,0,.997326,265538e-10,0,0,.989706,206466e-10,0,0,.981713,130756e-10,0,70005e-10,.973636,106473e-10,0,464797e-9,.966509,10194e-9,0,.00201743,.965149,165881e-10,0,.00497549,.962669,249147e-10,0,.00953262,.95786,317449e-10,0,.0158211,.949334,281045e-10,0,.0239343,.941041,303263e-10,0,.0339372,.931575,356754e-10,0,.0458738,.920102,397075e-10,0,.059772,.908002,384886e-10,0,.075645,.897269,43027e-9,0,.0934929,.884559,479925e-10,0,.113302,.869161,48246e-9,0,.135045,.853342,509505e-10,0,.158678,.837633,542846e-10,0,.184136,.820252,554139e-10,0,.211325,.801872,581412e-10,0,.240113,.782418,585535e-10,0,.270306,.7631,610923e-10,0,.301594,.742183,613678e-10,0,.333333,.721098,627275e-10,0,.365079,.699512,629413e-10,0,.396825,.677372,636351e-10,0,.428571,.655059,633555e-10,0,.460317,.632567,636513e-10,0,.492064,.609784,628965e-10,0,.52381,.587237,625546e-10,0,.555556,.564525,615825e-10,0,.587302,.542181,605048e-10,0,.619048,.520017,596329e-10,0,.650794,.498204,581516e-10,0,.68254,.476742,569186e-10,0,.714286,.455803,553833e-10,0,.746032,.435251,537807e-10,0,.777778,.415374,522025e-10,0,.809524,.395921,503421e-10,0,.84127,.377253,488211e-10,0,.873016,.359021,468234e-10,0,.904762,.341637,453269e-10,0,.936508,.3247,433014e-10,0,.968254,.308625,418007e-10,0,1,1,286798e-15,0,0,1,286877e-15,0,0,1,288094e-15,0,0,1,293506e-15,0,0,1,309262e-15,0,0,.999999,348593e-15,0,0,.999999,444582e-15,0,0,.999998,688591e-15,0,0,.999996,134391e-14,0,0,.999993,317438e-14,0,0,.999989,835609e-14,0,0,.999983,228677e-13,0,0,.999974,623361e-13,0,0,.999959,165225e-12,0,0,.999936,419983e-12,0,0,.999896,101546e-11,0,0,.99983,232376e-11,0,0,.999709,50156e-10,0,0,.999469,10167e-9,0,0,.998886,190775e-10,0,0,.996819,300511e-10,0,0,.988837,185092e-10,0,168222e-12,.982178,134622e-10,0,259622e-9,.975017,125961e-10,0,.00142595,.967101,13507e-9,0,.00382273,.964905,205003e-10,0,.00764164,.96218,29546e-9,0,.0130121,.956821,343738e-10,0,.0200253,.948829,305063e-10,0,.0287452,.941092,346487e-10,0,.039218,.931883,412061e-10,0,.0514748,.920211,444651e-10,0,.0655351,.907307,431252e-10,0,.0814082,.89684,490382e-10,0,.0990939,.884119,53334e-9,0,.118583,.869148,54114e-9,0,.139856,.853377,578536e-10,0,.162882,.836753,592285e-10,0,.187615,.820063,622787e-10,0,.213991,.801694,645492e-10,0,.241918,.782116,65353e-9,0,.271267,.762673,674344e-10,0,.301847,.742133,682788e-10,0,.333333,.720779,691959e-10,0,.365079,.699386,696817e-10,0,.396826,.67732,699583e-10,0,.428572,.654888,698447e-10,0,.460318,.632499,694063e-10,0,.492064,.609825,691612e-10,0,.52381,.587287,681576e-10,0,.555556,.564743,674138e-10,0,.587302,.542409,661617e-10,0,.619048,.520282,647785e-10,0,.650794,.498506,633836e-10,0,.68254,.477102,615905e-10,0,.714286,.456167,601013e-10,0,.746032,.435728,581457e-10,0,.777778,.415809,564215e-10,0,.809524,.396517,544997e-10,0,.84127,.377737,525061e-10,0,.873016,.359698,506831e-10,0,.904762,.342164,48568e-9,0,.936508,.325417,467826e-10,0,.968254,.309186,446736e-10,0,1,1,109018e-14,0,0,1,10904e-13,0,0,1,109393e-14,0,0,1,11095e-13,0,0,1,1154e-12,0,0,1,126089e-14,0,0,.999999,15059e-13,0,0,.999997,207899e-14,0,0,.999994,348164e-14,0,0,.999993,705728e-14,0,0,.999987,163692e-13,0,0,.999981,406033e-13,0,0,.999969,10245e-11,0,0,.999953,255023e-12,0,0,.999925,61511e-11,0,0,.999881,142218e-11,0,0,.99981,313086e-11,0,0,.99968,653119e-11,0,0,.999418,12832e-9,0,0,.998748,232497e-10,0,0,.996066,329522e-10,0,0,.988379,179613e-10,0,108799e-9,.982567,143715e-10,0,921302e-9,.976097,148096e-10,0,.00280738,.968475,178905e-10,0,.00596622,.964606,253921e-10,0,.0105284,.961564,348623e-10,0,.0165848,.955517,357612e-10,0,.0242,.948381,343493e-10,0,.03342,.941095,405849e-10,0,.0442777,.931923,475394e-10,0,.0567958,.91996,484328e-10,0,.0709879,.907419,502146e-10,0,.086861,.89618,561654e-10,0,.104415,.88337,587612e-10,0,.123643,.869046,618057e-10,0,.144531,.853278,657392e-10,0,.167057,.836091,66303e-9,0,.191188,.819644,704445e-10,0,.216878,.801246,714071e-10,0,.244062,.782031,740093e-10,0,.272649,.762066,74685e-9,0,.302509,.741964,766647e-10,0,.333442,.720554,766328e-10,0,.365079,.699098,777857e-10,0,.396826,.677189,774633e-10,0,.428572,.65484,776235e-10,0,.460318,.632496,770316e-10,0,.492064,.609908,762669e-10,0,.52381,.587312,753972e-10,0,.555556,.564938,739994e-10,0,.587302,.542577,728382e-10,0,.619048,.52062,71112e-9,0,.650794,.498819,694004e-10,0,.68254,.477555,675575e-10,0,.714286,.456568,653449e-10,0,.746032,.436278,636068e-10,0,.777778,.41637,613466e-10,0,.809524,.397144,594177e-10,0,.84127,.378412,570987e-10,0,.873016,.360376,550419e-10,0,.904762,.342906,527422e-10,0,.936508,.326136,506544e-10,0,.968254,.30997,484307e-10,0,1,1,354014e-14,0,0,1,354073e-14,0,0,1,354972e-14,0,0,1,358929e-14,0,0,1,370093e-14,0,0,.999999,396194e-14,0,0,.999998,453352e-14,0,0,.999997,578828e-14,0,0,.999994,863812e-14,0,0,.999991,153622e-13,0,0,.999985,316356e-13,0,0,.999977,712781e-13,0,0,.999964,166725e-12,0,0,.999945,390501e-12,0,0,.999912,895622e-12,0,0,.999866,198428e-11,0,0,.999786,421038e-11,0,0,.999647,850239e-11,0,0,.999356,162059e-10,0,0,.998563,282652e-10,0,0,.994928,336309e-10,0,244244e-10,.987999,178458e-10,0,523891e-9,.982893,159162e-10,0,.00194729,.977044,178056e-10,0,.00451099,.969972,230624e-10,0,.00835132,.964237,313922e-10,0,.013561,.960791,406145e-10,0,.0202056,.954292,372796e-10,0,.0283321,.948052,403199e-10,0,.0379739,.940938,479537e-10,0,.0491551,.931689,545292e-10,0,.0618918,.91987,54038e-9,0,.0761941,.907665,589909e-10,0,.0920672,.895281,642651e-10,0,.109511,.882621,659707e-10,0,.12852,.86873,709973e-10,0,.149085,.853008,742221e-10,0,.171189,.835944,761754e-10,0,.194809,.818949,797052e-10,0,.21991,.800951,812434e-10,0,.246447,.781847,838075e-10,0,.274352,.761649,84501e-9,0,.303535,.74152,860258e-10,0,.333857,.720495,866233e-10,0,.365104,.698742,868326e-10,0,.396826,.677096,87133e-9,0,.428572,.654782,863497e-10,0,.460318,.632335,860206e-10,0,.492064,.610031,849337e-10,0,.52381,.587457,838279e-10,0,.555556,.56513,82309e-9,0,.587302,.542877,803542e-10,0,.619048,.5209,786928e-10,0,.650794,.499291,765171e-10,0,.68254,.477971,744753e-10,0,.714286,.457221,72209e-9,0,.746032,.436803,697448e-10,0,.777778,.417083,675333e-10,0,.809524,.397749,648058e-10,0,.84127,.379177,625759e-10,0,.873016,.361061,598584e-10,0,.904762,.343713,575797e-10,0,.936508,.326894,549999e-10,0,.968254,.310816,527482e-10,0,1,1,10153e-12,0,0,1,101544e-13,0,0,1,101751e-13,0,0,1,102662e-13,0,0,1,10521e-12,0,0,.999999,111049e-13,0,0,.999999,123408e-13,0,0,.999996,14924e-12,0,0,.999992,204471e-13,0,0,.999989,326539e-13,0,0,.99998,603559e-13,0,0,.999971,123936e-12,0,0,.999955,269058e-12,0,0,.999933,593604e-12,0,0,.999901,129633e-11,0,0,.999847,275621e-11,0,0,.999761,564494e-11,0,0,.999607,110485e-10,0,0,.999282,204388e-10,0,0,.99831,341084e-10,0,22038e-11,.993288,294949e-10,0,242388e-9,.987855,192736e-10,0,.0012503,.983167,182383e-10,0,.0032745,.977908,218633e-10,0,.00646321,.971194,290662e-10,0,.0109133,.963867,386401e-10,0,.0166927,.95982,462827e-10,0,.0238494,.953497,420705e-10,0,.0324178,.947621,477743e-10,0,.0424225,.940611,568258e-10,0,.0538808,.931174,618061e-10,0,.0668047,.919919,627098e-10,0,.0812014,.907856,694714e-10,0,.0970745,.894509,735008e-10,0,.114424,.881954,763369e-10,0,.133246,.868309,821896e-10,0,.153534,.852511,83769e-9,0,.175275,.835821,881615e-10,0,.198453,.817981,896368e-10,0,.223042,.800504,930906e-10,0,.249009,.78141,945056e-10,0,.276304,.761427,963605e-10,0,.304862,.74094,968088e-10,0,.334584,.720233,981481e-10,0,.365322,.698592,979122e-10,0,.396826,.676763,981057e-10,0,.428571,.654808,973956e-10,0,.460318,.632326,962619e-10,0,.492064,.610049,952996e-10,0,.52381,.58763,933334e-10,0,.555556,.565261,917573e-10,0,.587302,.543244,896636e-10,0,.619048,.521273,873304e-10,0,.650794,.499818,852648e-10,0,.68254,.478536,823961e-10,0,.714286,.457826,79939e-9,0,.746032,.437549,77126e-9,0,.777778,.41776,743043e-10,0,.809524,.39863,716426e-10,0,.84127,.379954,686456e-10,0,.873016,.362025,660514e-10,0,.904762,.344581,630755e-10,0,.936508,.327909,605439e-10,0,.968254,.311736,576345e-10,0,1,1,263344e-13,0,0,1,263373e-13,0,0,1,263815e-13,0,0,1,265753e-13,0,0,1,271132e-13,0,0,.999999,283279e-13,0,0,.999997,30833e-12,0,0,.999995,358711e-13,0,0,.999992,461266e-13,0,0,.999985,67574e-12,0,0,.999977,11358e-11,0,0,.999966,213657e-12,0,0,.999948,431151e-12,0,0,.999923,896656e-12,0,0,.999884,186603e-11,0,0,.999826,381115e-11,0,0,.999732,754184e-11,0,0,.999561,143192e-10,0,0,.999191,257061e-10,0,0,.997955,405724e-10,0,744132e-10,.992228,276537e-10,0,716477e-9,.987638,208885e-10,0,.0022524,.983395,215226e-10,0,.00484816,.978614,270795e-10,0,.00860962,.972389,365282e-10,0,.0136083,.964392,474747e-10,0,.0198941,.95861,509141e-10,0,.0275023,.952806,48963e-9,0,.0364584,.94712,571119e-10,0,.04678,.940104,671704e-10,0,.0584799,.930398,687586e-10,0,.0715665,.919866,738161e-10,0,.086045,.907853,813235e-10,0,.101918,.894078,834582e-10,0,.119186,.881177,892093e-10,0,.137845,.867575,944548e-10,0,.157891,.852107,969607e-10,0,.179316,.835502,101456e-9,0,.202106,.81756,103256e-9,0,.226243,.79984,106954e-9,0,.251704,.780998,108066e-9,0,.278451,.761132,110111e-9,0,.306436,.740429,110459e-9,0,.335586,.719836,111219e-9,0,.365796,.698467,11145e-8,0,.3969,.676446,110393e-9,0,.428571,.654635,110035e-9,0,.460318,.632411,108548e-9,0,.492064,.609986,106963e-9,0,.52381,.587872,105238e-9,0,.555556,.565528,102665e-9,0,.587302,.543563,100543e-9,0,.619048,.52176,976182e-10,0,.650794,.500188,947099e-10,0,.68254,.479204,919929e-10,0,.714286,.458413,886139e-10,0,.746032,.438314,857839e-10,0,.777778,.418573,82411e-9,0,.809524,.39947,792211e-10,0,.84127,.380892,759546e-10,0,.873016,.362953,727571e-10,0,.904762,.345601,695738e-10,0,.936508,.328895,664907e-10,0,.968254,.312808,634277e-10,0,1,1,628647e-13,0,0,1,628705e-13,0,0,1,629587e-13,0,0,1,633441e-13,0,0,.999999,644087e-13,0,0,.999998,667856e-13,0,0,.999997,715889e-13,0,0,.999995,809577e-13,0,0,.999989,992764e-13,0,0,.999983,135834e-12,0,0,.999974,210482e-12,0,0,.999959,365215e-12,0,0,.999939,686693e-12,0,0,.999911,13472e-10,0,0,.999868,26731e-10,0,0,.999804,524756e-11,0,0,.9997,100403e-10,0,0,.99951,185019e-10,0,0,.999078,322036e-10,0,620676e-11,.997428,470002e-10,0,341552e-9,.99162,287123e-10,0,.00143727,.987479,234706e-10,0,.00349201,.983582,260083e-10,0,.0066242,.979186,337927e-10,0,.0109113,.97325,454689e-10,0,.0164064,.965221,573759e-10,0,.0231463,.957262,544114e-10,0,.0311571,.952211,587006e-10,0,.0404572,.946631,692256e-10,0,.0510592,.939391,787819e-10,0,.0629723,.929795,792368e-10,0,.0762025,.91965,875075e-10,0,.090753,.907737,950903e-10,0,.106626,.893899,972963e-10,0,.123822,.880239,10459e-8,0,.142337,.866562,107689e-9,0,.16217,.85164,113081e-9,0,.183314,.835021,116636e-9,0,.20576,.817311,120074e-9,0,.229496,.798845,121921e-9,0,.254502,.780479,12475e-8,0,.280753,.760694,125255e-9,0,.308212,.740142,126719e-9,0,.336825,.719248,12636e-8,0,.366517,.698209,126712e-9,0,.397167,.676398,125769e-9,0,.428578,.654378,124432e-9,0,.460318,.632484,123272e-9,0,.492064,.610113,12085e-8,0,.52381,.587931,118411e-9,0,.555556,.565872,11569e-8,0,.587302,.543814,112521e-9,0,.619048,.522265,109737e-9,0,.650794,.500835,106228e-9,0,.68254,.479818,102591e-9,0,.714286,.459258,991288e-10,0,.746032,.439061,952325e-10,0,.777778,.419552,91895e-9,0,.809524,.400399,879051e-10,0,.84127,.381976,844775e-10,0,.873016,.364009,806316e-10,0,.904762,.346761,771848e-10,0,.936508,.330049,735429e-10,0,.968254,.314018,702103e-10,0,1,1,139968e-12,0,0,1,139979e-12,0,0,1,140145e-12,0,0,1,14087e-11,0,0,.999999,142865e-12,0,0,.999998,147279e-12,0,0,.999997,156057e-12,0,0,.999992,17276e-11,0,0,.999989,204352e-12,0,0,.99998,26494e-11,0,0,.999969,383435e-12,0,0,.999953,618641e-12,0,0,.999929,108755e-11,0,0,.999898,201497e-11,0,0,.999849,381346e-11,0,0,.999778,719815e-11,0,0,.999661,133215e-10,0,0,.999451,238313e-10,0,0,.998936,401343e-10,0,113724e-9,.99662,517346e-10,0,820171e-9,.991094,304323e-10,0,.00238143,.987487,281757e-10,0,.00493527,.983731,320048e-10,0,.00856859,.979647,423905e-10,0,.0133393,.973837,562935e-10,0,.0192863,.96584,677442e-10,0,.0264369,.956309,623073e-10,0,.03481,.951523,704131e-10,0,.0444184,.946003,836594e-10,0,.0552713,.938454,911736e-10,0,.0673749,.929279,938264e-10,0,.0807329,.919239,103754e-9,0,.0953479,.907293,109928e-9,0,.111221,.893936,115257e-9,0,.128352,.879674,122265e-9,0,.14674,.865668,125733e-9,0,.166382,.850998,132305e-9,0,.187276,.834498,134844e-9,0,.209413,.816903,139276e-9,0,.232786,.798235,140984e-9,0,.257382,.779724,14378e-8,0,.283181,.760251,144623e-9,0,.310156,.739808,145228e-9,0,.338269,.718762,14539e-8,0,.367461,.697815,144432e-9,0,.397646,.67631,143893e-9,0,.428685,.654278,141846e-9,0,.460318,.632347,13935e-8,0,.492064,.610296,137138e-9,0,.52381,.588039,133806e-9,0,.555556,.566218,130755e-9,0,.587302,.544346,127128e-9,0,.619048,.522701,123002e-9,0,.650794,.501542,119443e-9,0,.68254,.480508,115055e-9,0,.714286,.460092,111032e-9,0,.746032,.440021,106635e-9,0,.777778,.420446,102162e-9,0,.809524,.401512,98184e-9,0,.84127,.38299,936497e-10,0,.873016,.365232,89813e-9,0,.904762,.347865,853073e-10,0,.936508,.331342,817068e-10,0,.968254,.315202,773818e-10,0,1,1,29368e-11,0,0,1,2937e-10,0,0,1,293998e-12,0,0,1,295298e-12,0,0,.999999,298865e-12,0,0,.999998,3067e-10,0,0,.999995,322082e-12,0,0,.999992,350767e-12,0,0,.999986,403538e-12,0,0,.999976,501372e-12,0,0,.999964,68562e-11,0,0,.999945,10374e-10,0,0,.999919,171269e-11,0,0,.999882,300175e-11,0,0,.999829,542144e-11,0,0,.999749,984182e-11,0,0,.99962,176213e-10,0,0,.999382,305995e-10,0,138418e-10,.998751,496686e-10,0,389844e-9,.995344,510733e-10,0,.00150343,.990768,345829e-10,0,.00352451,.987464,342841e-10,0,.00655379,.983846,399072e-10,0,.0106554,.980007,533219e-10,0,.0158723,.974494,696992e-10,0,.0222333,.96622,776754e-10,0,.029758,.956273,747718e-10,0,.0384596,.950952,864611e-10,0,.0483473,.945215,100464e-9,0,.0594266,.937287,103729e-9,0,.0717019,.928649,111665e-9,0,.0851752,.918791,12353e-8,0,.0998479,.906685,127115e-9,0,.115721,.893706,13628e-8,0,.132794,.879248,142427e-9,0,.151067,.864685,148091e-9,0,.170538,.850032,153517e-9,0,.191204,.833853,157322e-9,0,.213063,.816353,161086e-9,0,.236107,.797834,164111e-9,0,.260329,.778831,165446e-9,0,.285714,.759756,167492e-9,0,.312243,.739419,166928e-9,0,.339887,.718491,167e-6,0,.368604,.697392,165674e-9,0,.398329,.676102,163815e-9,0,.428961,.654243,162003e-9,0,.460331,.632176,158831e-9,0,.492064,.610407,155463e-9,0,.52381,.588394,152062e-9,0,.555556,.56645,147665e-9,0,.587302,.5449,14375e-8,0,.619048,.523276,138905e-9,0,.650794,.502179,134189e-9,0,.68254,.481359,129392e-9,0,.714286,.46092,124556e-9,0,.746032,.441084,11957e-8,0,.777778,.421517,114652e-9,0,.809524,.402721,109688e-9,0,.84127,.384222,104667e-9,0,.873016,.366534,999633e-10,0,.904762,.349205,950177e-10,0,.936508,.332702,907301e-10,0,.968254,.316599,859769e-10,0,1,1,585473e-12,0,0,1,585507e-12,0,0,1,58602e-11,0,0,.999999,588259e-12,0,0,.999999,594381e-12,0,0,.999998,607754e-12,0,0,.999995,633729e-12,0,0,.99999,68137e-11,0,0,.999984,767003e-12,0,0,.999973,921212e-12,0,0,.999959,120218e-11,0,0,.999936,172024e-11,0,0,.999907,268088e-11,0,0,.999866,445512e-11,0,0,.999806,768481e-11,0,0,.999716,1342e-8,0,0,.999576,232473e-10,0,0,.9993,391694e-10,0,129917e-9,.998498,608429e-10,0,845035e-9,.994132,489743e-10,0,.00237616,.99031,384644e-10,0,.00484456,.987409,421768e-10,0,.00832472,.983981,504854e-10,0,.0128643,.980268,671028e-10,0,.0184947,.974875,852749e-10,0,.025237,.966063,85531e-9,0,.0331046,.956779,900588e-10,0,.0421067,.950259,10577e-8,0,.0522487,.944239,119458e-9,0,.0635343,.936341,122164e-9,0,.0759654,.928047,134929e-9,0,.0895434,.918065,145544e-9,0,.104269,.906267,150531e-9,0,.120142,.893419,161652e-9,0,.137163,.878758,16593e-8,0,.15533,.863699,174014e-9,0,.174645,.848876,177877e-9,0,.195106,.833032,184049e-9,0,.21671,.815557,186088e-9,0,.239454,.797323,19054e-8,0,.263332,.778124,191765e-9,0,.288336,.758929,192535e-9,0,.314451,.738979,192688e-9,0,.341658,.718213,191522e-9,0,.369924,.696947,190491e-9,0,.399202,.675807,187913e-9,0,.429416,.654147,184451e-9,0,.460447,.63229,181442e-9,0,.492064,.610499,177139e-9,0,.523809,.588747,172596e-9,0,.555555,.566783,167457e-9,0,.587301,.545359,162518e-9,0,.619048,.523984,156818e-9,0,.650794,.502917,151884e-9,0,.68254,.482294,145514e-9,0,.714286,.461945,140199e-9,0,.746032,.442133,134101e-9,0,.777778,.422705,128374e-9,0,.809524,.403916,122996e-9,0,.84127,.38554,116808e-9,0,.873016,.367909,111973e-9,0,.904762,.350651,105938e-9,0,.936508,.334208,101355e-9,0,.968254,.318123,957629e-10,0,1,1,111633e-11,0,0,1,111639e-11,0,0,1,111725e-11,0,0,1,112096e-11,0,0,.999999,11311e-10,0,0,.999997,115315e-11,0,0,.999995,11956e-10,0,0,.999989,127239e-11,0,0,.999981,140772e-11,0,0,.999969,164541e-11,0,0,.999952,206607e-11,0,0,.999928,281783e-11,0,0,.999895,416835e-11,0,0,.999848,658728e-11,0,0,.999781,108648e-10,0,0,.999682,182579e-10,0,0,.999523,306003e-10,0,159122e-10,.999205,499862e-10,0,391184e-9,.998131,73306e-9,0,.00147534,.993334,513229e-10,0,.0034227,.99016,467783e-10,0,.00632232,.987321,523413e-10,0,.0102295,.984099,64267e-9,0,.0151794,.980432,843042e-10,0,.0211947,.974976,102819e-9,0,.0282899,.966429,996234e-10,0,.0364739,.957633,111074e-9,0,.0457522,.949422,128644e-9,0,.0561278,.943045,140076e-9,0,.0676023,.935448,146349e-9,0,.0801762,.927225,161854e-9,0,.0938499,.917033,169135e-9,0,.108623,.905762,179987e-9,0,.124496,.892879,189832e-9,0,.141469,.878435,195881e-9,0,.159541,.863114,20466e-8,0,.178713,.84776,209473e-9,0,.198985,.832084,214861e-9,0,.220355,.814915,217695e-9,0,.242823,.796711,220313e-9,0,.266385,.777603,22313e-8,0,.291036,.757991,222471e-9,0,.316767,.738371,222869e-9,0,.343563,.717872,221243e-9,0,.371402,.696619,218089e-9,0,.400248,.675379,21562e-8,0,.430047,.65411,21169e-8,0,.460709,.63241,206947e-9,0,.492079,.61046,201709e-9,0,.52381,.58903,196753e-9,0,.555556,.567267,189637e-9,0,.587302,.545886,184735e-9,0,.619048,.524714,177257e-9,0,.650794,.503789,171424e-9,0,.68254,.483204,164688e-9,0,.714286,.462976,157172e-9,0,.746032,.443294,151341e-9,0,.777778,.423988,143737e-9,0,.809524,.405325,138098e-9,0,.84127,.386981,130698e-9,0,.873016,.369436,125276e-9,0,.904762,.35219,118349e-9,0,.936508,.335804,11312e-8,0,.968254,.319749,106687e-9,0,1,1,204685e-11,0,0,1,204694e-11,0,0,1,204831e-11,0,0,.999999,205428e-11,0,0,.999999,207056e-11,0,0,.999997,210581e-11,0,0,.999993,21732e-10,0,0,.999987,229365e-11,0,0,.999979,250243e-11,0,0,.999965,286127e-11,0,0,.999947,348028e-11,0,0,.999918,455588e-11,0,0,.999881,643303e-11,0,0,.999828,970064e-11,0,0,.999753,153233e-10,0,0,.999642,24793e-9,0,0,.999464,402032e-10,0,122947e-9,.999089,635852e-10,0,807414e-9,.997567,857026e-10,0,.00227206,.992903,594912e-10,0,.00462812,.990011,578515e-10,0,.00794162,.987192,65399e-9,0,.0122534,.98418,819675e-10,0,.0175888,.980491,105514e-9,0,.0239635,.974779,121532e-9,0,.031387,.96675,119144e-9,0,.0398644,.958248,136125e-9,0,.0493982,.948884,155408e-9,0,.0599896,.941673,162281e-9,0,.0716382,.934521,176754e-9,0,.0843437,.926205,192873e-9,0,.0981056,.916089,200038e-9,0,.112923,.904963,213624e-9,0,.128796,.892089,221834e-9,0,.145725,.878028,232619e-9,0,.163709,.86249,238632e-9,0,.182749,.846587,247002e-9,0,.202847,.830988,250702e-9,0,.224001,.814165,255562e-9,0,.246214,.796135,257505e-9,0,.269482,.777052,258625e-9,0,.293805,.757201,258398e-9,0,.319176,.737655,256714e-9,0,.345587,.717477,255187e-9,0,.373021,.696433,251792e-9,0,.401454,.675084,247223e-9,0,.430844,.653907,242213e-9,0,.461125,.632561,237397e-9,0,.492187,.610658,229313e-9,0,.52381,.589322,224402e-9,0,.555556,.567857,216116e-9,0,.587302,.54652,209124e-9,0,.619048,.525433,201601e-9,0,.650794,.504679,192957e-9,0,.68254,.484203,186052e-9,0,.714286,.464203,177672e-9,0,.746032,.444549,170005e-9,0,.777778,.425346,162401e-9,0,.809524,.406706,1544e-7,0,.84127,.388576,147437e-9,0,.873016,.37094,139493e-9,0,.904762,.353996,133219e-9,0,.936508,.337391,125573e-9,0,.968254,.321648,119867e-9,0,1,1,362511e-11,0,0,1,362525e-11,0,0,1,362739e-11,0,0,.999999,363673e-11,0,0,.999998,366214e-11,0,0,.999996,371698e-11,0,0,.999992,382116e-11,0,0,.999986,400554e-11,0,0,.999976,432058e-11,0,0,.999961,485194e-11,0,0,.999938,574808e-11,0,0,.999908,726643e-11,0,0,.999865,984707e-11,0,0,.999807,142217e-10,0,0,.999723,215581e-10,0,0,.999602,336114e-10,0,119113e-10,.999398,527353e-10,0,355813e-9,.998946,805809e-10,0,.00137768,.996647,942908e-10,0,.00322469,.992298,668733e-10,0,.00597897,.989802,716564e-10,0,.00968903,.987019,821355e-10,0,.0143845,.984219,104555e-9,0,.0200831,.980425,131245e-9,0,.0267948,.974241,139613e-9,0,.034525,.967006,145931e-9,0,.0432757,.95893,167153e-9,0,.0530471,.949157,188146e-9,0,.0638386,.94062,194625e-9,0,.0756487,.933509,213721e-9,0,.0884762,.925088,229616e-9,0,.10232,.915178,239638e-9,0,.117178,.904093,254814e-9,0,.133051,.891337,263685e-9,0,.149939,.877326,274789e-9,0,.167841,.861794,280534e-9,0,.18676,.845758,289534e-9,0,.206696,.829792,294446e-9,0,.22765,.813037,296877e-9,0,.249625,.795285,300217e-9,0,.27262,.776323,299826e-9,0,.296636,.756673,299787e-9,0,.321671,.736856,297867e-9,0,.347718,.716883,294052e-9,0,.374768,.696089,289462e-9,0,.402804,.67505,285212e-9,0,.431796,.653509,27653e-8,0,.461695,.63258,271759e-9,0,.49242,.61104,262811e-9,0,.523822,.589567,255151e-9,0,.555556,.568322,246434e-9,0,.587302,.547235,237061e-9,0,.619048,.52616,228343e-9,0,.650794,.505716,219236e-9,0,.68254,.485274,209595e-9,0,.714286,.465411,201011e-9,0,.746032,.445854,19109e-8,0,.777778,.426911,182897e-9,0,.809524,.408222,173569e-9,0,.84127,.390307,165496e-9,0,.873016,.372624,156799e-9,0,.904762,.355804,14917e-8,0,.936508,.33924,140907e-9,0,.968254,.323534,134062e-9,0,1,1,622487e-11,0,0,1,62251e-10,0,0,1,622837e-11,0,0,.999999,624259e-11,0,0,.999998,628127e-11,0,0,.999996,636451e-11,0,0,.999991,65218e-10,0,0,.999984,679782e-11,0,0,.999973,726361e-11,0,0,.999955,803644e-11,0,0,.999931,931397e-11,0,0,.999896,114299e-10,0,0,.999847,149402e-10,0,0,.999784,207461e-10,0,0,.999692,302493e-10,0,0,.999554,454957e-10,0,997275e-10,.999326,690762e-10,0,724813e-9,.998757,101605e-9,0,.0020972,.995367,958745e-10,0,.00432324,.99209,832808e-10,0,.00746347,.989517,887601e-10,0,.0115534,.987008,10564e-8,0,.0166134,.98421,133179e-9,0,.0226552,.98021,161746e-9,0,.0296838,.973676,161821e-9,0,.0377016,.967052,178635e-9,0,.0467079,.959385,206765e-9,0,.0567013,.949461,22476e-8,0,.0676796,.939578,23574e-8,0,.0796403,.932416,25893e-8,0,.0925812,.923759,271228e-9,0,.106501,.914223,289165e-9,0,.121397,.902942,301156e-9,0,.13727,.890419,313852e-9,0,.15412,.876639,324408e-9,0,.171946,.861316,33249e-8,0,.190751,.84496,338497e-9,0,.210537,.828427,345861e-9,0,.231305,.811871,347863e-9,0,.253057,.794397,350225e-9,0,.275797,.775726,349915e-9,0,.299525,.75617,347297e-9,0,.324242,.736091,344232e-9,0,.349947,.716213,340835e-9,0,.376633,.695736,332369e-9,0,.404289,.674961,327943e-9,0,.432895,.653518,318533e-9,0,.462415,.632574,310391e-9,0,.492788,.61134,300755e-9,0,.523909,.590017,290506e-9,0,.555556,.568752,280446e-9,0,.587302,.548061,269902e-9,0,.619048,.52711,258815e-9,0,.650794,.506682,248481e-9,0,.68254,.486524,237141e-9,0,.714286,.466812,226872e-9,0,.746032,.44732,216037e-9,0,.777778,.428473,205629e-9,0,.809524,.409921,195691e-9,0,.84127,.392028,185457e-9,0,.873016,.374606,176436e-9,0,.904762,.357601,166508e-9,0,.936508,.341348,158385e-9,0,.968254,.32542,149203e-9,0,1,1,103967e-10,0,0,1,10397e-9,0,0,1,104019e-10,0,0,.999999,104231e-10,0,0,.999998,104806e-10,0,0,.999995,106042e-10,0,0,.999991,108366e-10,0,0,.999982,112415e-10,0,0,.999968,119174e-10,0,0,.99995,130227e-10,0,0,.999922,148176e-10,0,0,.999884,177303e-10,0,0,.99983,224564e-10,0,0,.999758,300966e-10,0,0,.999654,423193e-10,0,549083e-11,.999503,614848e-10,0,296087e-9,.999237,903576e-10,0,.00123144,.998491,1271e-7,0,.00295954,.994594,107754e-9,0,.00555829,.99178,103025e-9,0,.00907209,.989265,11154e-8,0,.0135257,.986998,136296e-9,0,.0189327,.984137,169154e-9,0,.0252993,.979798,196671e-9,0,.0326272,.97337,196678e-9,0,.0409157,.967239,223121e-9,0,.0501623,.959543,253809e-9,0,.0603638,.949466,265972e-9,0,.0715171,.939074,288372e-9,0,.0836187,.931118,310983e-9,0,.0966657,.922525,325561e-9,0,.110656,.912983,345725e-9,0,.125588,.901617,3556e-7,0,.141461,.889487,374012e-9,0,.158275,.875787,383445e-9,0,.176031,.860654,393972e-9,0,.19473,.844417,400311e-9,0,.214374,.82741,405004e-9,0,.234967,.810545,407378e-9,0,.256512,.793312,407351e-9,0,.279011,.774847,406563e-9,0,.302468,.755621,404903e-9,0,.326887,.735511,397486e-9,0,.352266,.715435,39357e-8,0,.378605,.695403,384739e-9,0,.405897,.674681,376108e-9,0,.43413,.65359,365997e-9,0,.463277,.632471,354957e-9,0,.493295,.61151,343593e-9,0,.524106,.59064,331841e-9,0,.555561,.569386,318891e-9,0,.587302,.548785,3072e-7,0,.619048,.528146,29361e-8,0,.650794,.507872,281709e-9,0,.68254,.487805,268627e-9,0,.714286,.468196,255887e-9,0,.746032,.448922,243997e-9,0,.777778,.430093,231662e-9,0,.809524,.411845,220339e-9,0,.84127,.393808,208694e-9,0,.873016,.376615,198045e-9,0,.904762,.359655,187375e-9,0,.936508,.343452,177371e-9,0,.968254,.32765,167525e-9,0,1,1,169351e-10,0,0,1,169356e-10,0,0,1,169427e-10,0,0,.999999,169736e-10,0,0,.999998,170575e-10,0,0,.999995,172372e-10,0,0,.99999,175739e-10,0,0,.999979,181568e-10,0,0,.999966,191206e-10,0,0,.999944,20677e-9,0,0,.999912,231644e-10,0,0,.999869,271268e-10,0,0,.999811,334272e-10,0,0,.99973,433979e-10,0,0,.999617,590083e-10,0,680315e-10,.999445,829497e-10,0,612796e-9,.999138,118019e-9,0,.00187408,.998095,156712e-9,0,.00395791,.993919,125054e-9,0,.00692144,.991333,126091e-9,0,.0107962,.989226,144912e-9,0,.0155986,.986954,175737e-9,0,.0213364,.983982,213883e-9,0,.0280114,.979128,234526e-9,0,.0356226,.973327,243725e-9,0,.0441668,.967416,2773e-7,0,.0536399,.959729,308799e-9,0,.0640376,.949758,322447e-9,0,.0753554,.939173,350021e-9,0,.0875893,.9296,370089e-9,0,.100736,.921181,391365e-9,0,.114793,.91164,413636e-9,0,.129759,.900435,427068e-9,0,.145632,.888183,441046e-9,0,.162412,.874772,454968e-9,0,.180101,.859566,461882e-9,0,.1987,.843579,471556e-9,0,.218213,.826453,474335e-9,0,.238641,.809164,477078e-9,0,.259989,.792179,47755e-8,0,.282262,.773866,472573e-9,0,.305464,.754944,469765e-9,0,.329599,.735133,462371e-9,0,.35467,.714858,453674e-9,0,.380678,.694829,443888e-9,0,.407622,.674453,432052e-9,0,.435493,.653685,420315e-9,0,.464275,.632666,406829e-9,0,.493938,.611676,392234e-9,0,.524422,.591193,379208e-9,0,.555624,.570145,36319e-8,0,.587302,.549566,349111e-9,0,.619048,.529278,334166e-9,0,.650794,.509026,318456e-9,0,.68254,.489186,30449e-8,0,.714286,.469662,289051e-9,0,.746032,.450691,275494e-9,0,.777778,.431841,261437e-9,0,.809524,.413752,247846e-9,0,.84127,.395951,235085e-9,0,.873016,.378633,222245e-9,0,.904762,.36194,210533e-9,0,.936508,.345599,198494e-9,0,.968254,.329999,188133e-9,0,1,1,269663e-10,0,0,1,26967e-9,0,0,1,269772e-10,0,0,.999999,270214e-10,0,0,.999998,271415e-10,0,0,.999994,27398e-9,0,0,.999988,278771e-10,0,0,.999977,287019e-10,0,0,.999961,300544e-10,0,0,.999937,322138e-10,0,0,.999904,356163e-10,0,0,.999854,409465e-10,0,0,.99979,492651e-10,0,0,.999699,621722e-10,0,88288e-11,.999572,819715e-10,0,223369e-9,.999381,111689e-9,0,.00105414,.999016,153862e-9,0,.0026493,.997437,187667e-9,0,.00508608,.993545,155672e-9,0,.00840554,.991135,161455e-9,0,.012629,.989157,188241e-9,0,.0177661,.986874,226229e-9,0,.0238198,.983714,268668e-9,0,.0307887,.978301,277109e-9,0,.0386688,.973227,303446e-9,0,.0474554,.967317,341851e-9,0,.0571428,.959477,370885e-9,0,.0677256,.950012,392753e-9,0,.0791988,.939484,42781e-8,0,.0915576,.928135,443866e-9,0,.104798,.919819,472959e-9,0,.118918,.910049,491551e-9,0,.133915,.899181,512616e-9,0,.149788,.886881,523563e-9,0,.166537,.87359,540183e-9,0,.184164,.858613,547386e-9,0,.202669,.842809,554809e-9,0,.222056,.825727,558316e-9,0,.242329,.808086,557824e-9,0,.263492,.790728,556346e-9,0,.285551,.772987,552672e-9,0,.30851,.7541,543738e-9,0,.332376,.734669,536107e-9,0,.357153,.714411,523342e-9,0,.382845,.694196,512238e-9,0,.409454,.674252,497465e-9,0,.436977,.65357,481096e-9,0,.465404,.632999,467054e-9,0,.494713,.611994,448771e-9,0,.524864,.591604,431889e-9,0,.555779,.571134,415238e-9,0,.587302,.550528,396369e-9,0,.619048,.530292,379477e-9,0,.650794,.510364,361488e-9,0,.68254,.490749,343787e-9,0,.714286,.471266,327822e-9,0,.746032,.452462,310626e-9,0,.777778,.433907,295352e-9,0,.809524,.415659,279179e-9,0,.84127,.398138,264685e-9,0,.873016,.380833,249905e-9,0,.904762,.364247,236282e-9,0,.936508,.348041,222905e-9,0,.968254,.332389,210522e-9,0,1,1,420604e-10,0,0,1,420614e-10,0,0,1,420757e-10,0,0,.999999,42138e-9,0,0,.999997,423067e-10,0,0,.999993,426668e-10,0,0,.999986,433372e-10,0,0,.999974,444857e-10,0,0,.999956,463554e-10,0,0,.99993,493105e-10,0,0,.999892,539077e-10,0,0,.999838,610005e-10,0,0,.999767,718822e-10,0,0,.999666,884581e-10,0,365471e-10,.999525,113398e-9,0,485623e-9,.999311,150043e-9,0,.00162096,.998865,200063e-9,0,.00355319,.996278,211014e-9,0,.00633818,.992956,189672e-9,0,.0100043,.991017,210262e-9,0,.0145648,.989055,244292e-9,0,.0200237,.986741,290481e-9,0,.0263798,.983288,334303e-9,0,.033629,.977784,340307e-9,0,.0417652,.973037,377864e-9,0,.0507821,.967181,4239e-7,0,.060673,.958971,443854e-9,0,.0714314,.950093,483039e-9,0,.0830518,.939552,517934e-9,0,.0955288,.927678,539449e-9,0,.108859,.918278,568604e-9,0,.123038,.908449,588505e-9,0,.138065,.897713,612473e-9,0,.153938,.885533,625575e-9,0,.170657,.872131,63854e-8,0,.188224,.857517,647034e-9,0,.20664,.841796,65209e-8,0,.225909,.824726,6544e-7,0,.246035,.807297,655744e-9,0,.267022,.789058,646716e-9,0,.288878,.77189,643898e-9,0,.311607,.753082,629973e-9,0,.335216,.7341,621564e-9,0,.359713,.714094,605171e-9,0,.385103,.693839,588752e-9,0,.41139,.673891,573294e-9,0,.438576,.653565,552682e-9,0,.466656,.633326,533446e-9,0,.495617,.612582,514635e-9,0,.525431,.59205,49303e-8,0,.556041,.571918,471842e-9,0,.587338,.551572,451713e-9,0,.619048,.531553,430049e-9,0,.650794,.51175,410445e-9,0,.68254,.49238,390098e-9,0,.714286,.473143,370033e-9,0,.746032,.45423,351205e-9,0,.777778,.435963,332049e-9,0,.809524,.41787,315021e-9,0,.84127,.400387,297315e-9,0,.873016,.383332,281385e-9,0,.904762,.366665,265397e-9,0,.936508,.350633,250601e-9,0,.968254,.334964,23589e-8,0,1,1,643736e-10,0,0,1,64375e-9,0,0,1,643947e-10,0,0,.999999,64481e-9,0,0,.999997,647143e-10,0,0,.999994,652119e-10,0,0,.999985,661359e-10,0,0,.999972,677116e-10,0,0,.999952,702599e-10,0,0,.999922,742517e-10,0,0,.99988,803906e-10,0,0,.99982,897315e-10,0,0,.999741,103838e-9,0,0,.999629,12496e-8,0,149024e-9,.999474,156161e-9,0,861027e-9,.999229,201034e-9,0,.00231198,.998662,259069e-9,0,.00458147,.995299,245439e-9,0,.00770895,.992732,24498e-8,0,.0117126,.990847,273211e-9,0,.0165989,.988911,316492e-9,0,.0223674,.98654,37161e-8,0,.0290135,.982636,410352e-9,0,.0365309,.977346,421756e-9,0,.0449117,.972909,475578e-9,0,.0541481,.966821,522482e-9,0,.0642326,.958686,545008e-9,0,.075158,.949754,589286e-9,0,.0869181,.939184,619995e-9,0,.0995074,.927505,654266e-9,0,.112922,.916606,682362e-9,0,.127157,.906707,704286e-9,0,.142212,.895937,725909e-9,0,.158085,.883913,743939e-9,0,.174776,.870642,755157e-9,0,.192287,.856241,764387e-9,0,.210619,.84069,771032e-9,0,.229775,.823728,765906e-9,0,.249761,.806481,767604e-9,0,.270582,.787924,754385e-9,0,.292243,.770588,749668e-9,0,.314753,.751991,731613e-9,0,.338118,.733407,717655e-9,0,.362347,.713688,700604e-9,0,.387447,.693595,678765e-9,0,.413424,.673426,657042e-9,0,.440284,.65359,635892e-9,0,.468027,.633576,611569e-9,0,.496645,.613144,586011e-9,0,.526122,.592711,563111e-9,0,.556417,.572722,537699e-9,0,.587451,.552762,512556e-9,0,.619048,.532985,489757e-9,0,.650794,.513219,464139e-9,0,.68254,.493992,442193e-9,0,.714286,.47509,418629e-9,0,.746032,.456287,397045e-9,0,.777778,.438152,375504e-9,0,.809524,.420294,35492e-8,0,.84127,.402749,335327e-9,0,.873016,.385879,316422e-9,0,.904762,.369352,298333e-9,0,.936508,.353301,281417e-9,0,.968254,.337781,265203e-9,0,1,1,968267e-10,0,0,1,968284e-10,0,0,1,968556e-10,0,0,.999999,969733e-10,0,0,.999997,972913e-10,0,0,.999993,979688e-10,0,0,.999984,992239e-10,0,0,.999969,101356e-9,0,0,.999946,104784e-9,0,0,.999913,110111e-9,0,0,.999868,118217e-9,0,0,.999801,130396e-9,0,0,.999712,148523e-9,0,124907e-10,.999589,175233e-9,0,355405e-9,.999416,213999e-9,0,.0013528,.999136,268529e-9,0,.00312557,.998367,333088e-9,0,.00573045,.994701,304757e-9,0,.00919397,.992497,318031e-9,0,.0135261,.990608,353863e-9,0,.0187278,.988715,409044e-9,0,.0247947,.986241,472967e-9,0,.0317196,.981696,495104e-9,0,.039494,.977097,532873e-9,0,.0481087,.972583,594447e-9,0,.0575549,.966142,636867e-9,0,.0678242,.95823,669899e-9,0,.0789089,.949677,719499e-9,0,.0908023,.939226,750584e-9,0,.103499,.927501,793183e-9,0,.116993,.915199,81995e-8,0,.131282,.90498,847654e-9,0,.146364,.894243,868929e-9,0,.162237,.882154,884278e-9,0,.178902,.869161,898108e-9,0,.196358,.854751,901254e-9,0,.21461,.839368,90679e-8,0,.23366,.822874,901541e-9,0,.253512,.805514,897297e-9,0,.274174,.78716,881856e-9,0,.29565,.769061,870032e-9,0,.31795,.751,851719e-9,0,.341081,.732614,830671e-9,0,.365053,.713171,806569e-9,0,.389874,.693472,78338e-8,0,.415553,.673528,756404e-9,0,.442098,.653397,726872e-9,0,.469512,.633781,700494e-9,0,.497794,.613877,67105e-8,0,.526935,.593506,640361e-9,0,.556908,.573667,613502e-9,0,.587657,.553932,583177e-9,0,.61906,.534345,554375e-9,0,.650794,.515042,527811e-9,0,.68254,.495674,499367e-9,0,.714286,.477132,47429e-8,0,.746032,.458609,447726e-9,0,.777778,.440354,424205e-9,0,.809524,.422765,399549e-9,0,.84127,.405472,378315e-9,0,.873016,.388482,355327e-9,0,.904762,.372191,336122e-9,0,.936508,.356099,315247e-9,0,.968254,.340737,29794e-8,0,1,1,143327e-9,0,0,1,14333e-8,0,0,1,143366e-9,0,0,.999999,143524e-9,0,0,.999996,143952e-9,0,0,.999991,144862e-9,0,0,.999981,146544e-9,0,0,.999966,149391e-9,0,0,.999941,153946e-9,0,0,.999905,160971e-9,0,0,.999852,171562e-9,0,0,.99978,18729e-8,0,0,.999681,210386e-9,0,826239e-10,.999546,243906e-9,0,664807e-9,.999352,291739e-9,0,.00196192,.999027,357419e-9,0,.00405941,.997886,422349e-9,0,.00699664,.99419,385008e-9,0,.0107896,.99214,409775e-9,0,.0154415,.990274,456418e-9,0,.0209488,.988455,527008e-9,0,.0273037,.985804,597685e-9,0,.0344969,.98103,613124e-9,0,.0425183,.976674,668321e-9,0,.0513575,.972021,736985e-9,0,.0610046,.965274,773789e-9,0,.0714508,.958046,830852e-9,0,.0826877,.949333,875766e-9,0,.0947085,.939135,917088e-9,0,.107507,.927119,952244e-9,0,.121078,.91469,990626e-9,0,.135419,.903006,.00101304,0,.150526,.892368,.00103834,0,.166399,.880231,.00105002,0,.183038,.867432,.00106331,0,.200443,.853208,.00106783,0,.218618,.837956,.00106458,0,.237566,.821772,.00105945,0,.257291,.804328,.00104685,0,.2778,.786465,.00103178,0,.2991,.768004,.00101077,0,.321199,.74972,985504e-9,0,.344106,.731682,962893e-9,0,.36783,.712813,932146e-9,0,.392383,.693139,89871e-8,0,.417774,.673566,869678e-9,0,.444013,.653483,835525e-9,0,.471107,.633891,799853e-9,0,.49906,.614433,766838e-9,0,.527869,.594586,732227e-9,0,.557517,.574769,696442e-9,0,.587966,.555149,663935e-9,0,.61913,.535898,629826e-9,0,.650794,.516753,596486e-9,0,.68254,.497816,567078e-9,0,.714286,.479034,534399e-9,0,.746032,.460975,507013e-9,0,.777778,.442935,477421e-9,0,.809524,.425263,451101e-9,0,.84127,.408248,424964e-9,0,.873016,.391339,39993e-8,0,.904762,.37513,377619e-9,0,.936508,.359172,354418e-9,0,.968254,.343876,334823e-9,0,1,1,209042e-9,0,0,1,209045e-9,0,0,1,209093e-9,0,0,.999999,209304e-9,0,0,.999996,209871e-9,0,0,.999991,211078e-9,0,0,.999979,213304e-9,0,0,.999963,217061e-9,0,0,.999933,223042e-9,0,0,.999894,232206e-9,0,0,.999837,245901e-9,0,0,.999756,266023e-9,0,102927e-11,.999648,295204e-9,0,233468e-9,.999499,336958e-9,0,.00108237,.999283,395563e-9,0,.00268832,.998896,473785e-9,0,.00511138,.997006,520008e-9,0,.00837705,.993819,497261e-9,0,.0124928,.991632,523722e-9,0,.0174561,.989875,587258e-9,0,.0232596,.988109,676329e-9,0,.0298932,.985155,747701e-9,0,.0373453,.980479,768803e-9,0,.0456045,.976271,841054e-9,0,.0546593,.971347,911469e-9,0,.0644994,.964528,953057e-9,0,.0751152,.957632,.00102221,0,.0864981,.948681,.00106122,0,.0986407,.938716,.00111857,0,.111537,.926629,.00114762,0,.125182,.914025,.00118995,0,.139571,.901026,.00121228,0,.154703,.890358,.00123946,0,.170576,.878283,.0012527,0,.18719,.865459,.00125536,0,.204547,.851407,.00126134,0,.222648,.836276,.00124759,0,.241498,.820436,.00124443,0,.261101,.803253,.00122071,0,.281465,.785562,.00120107,0,.302595,.76718,.00117762,0,.324501,.748551,.00114289,0,.347192,.730564,.00110872,0,.370679,.712253,.00107636,0,.394973,.692867,.00103646,0,.420085,.673695,996793e-9,0,.446027,.653912,95675e-8,0,.47281,.634129,916739e-9,0,.500441,.615004,874401e-9,0,.528921,.595587,833411e-9,0,.558244,.575965,794556e-9,0,.588384,.5566,75196e-8,0,.619281,.537428,716381e-9,0,.650795,.518623,676558e-9,0,.68254,.499964,64074e-8,0,.714286,.481356,605984e-9,0,.746032,.463279,570256e-9,0,.777778,.445673,540138e-9,0,.809524,.428032,507299e-9,0,.84127,.411112,479553e-9,0,.873016,.394444,450737e-9,0,.904762,.378247,424269e-9,0,.936508,.362415,399111e-9,0,.968254,.347103,375274e-9,0,1,1,300729e-9,0,0,1,300733e-9,0,0,1,300797e-9,0,0,.999998,301072e-9,0,0,.999996,301817e-9,0,0,.999989,303398e-9,0,0,.999977,306309e-9,0,0,.999958,311209e-9,0,0,.999927,318975e-9,0,0,.999884,330804e-9,0,0,.99982,34834e-8,0,0,.999733,373854e-9,0,326995e-10,.999613,410424e-9,0,477174e-9,.999447,462047e-9,0,.00161099,.999204,533322e-9,0,.00353153,.998725,624964e-9,0,.00627965,.995871,631786e-9,0,.0098693,.993194,632017e-9,0,.0143011,.991541,68923e-8,0,.019568,.989773,766892e-9,0,.0256593,.987647,863668e-9,0,.0325625,.984193,922089e-9,0,.0402647,.980016,970749e-9,0,.0487532,.975859,.00106027,0,.058016,.970514,.00112239,0,.0680419,.963625,.00117212,0,.0788208,.956959,.00125211,0,.0903439,.947956,.00129411,0,.102604,.93809,.00135879,0,.115594,.92659,.00139309,0,.129309,.913829,.00143253,0,.143745,.90005,.00145809,0,.158901,.888129,.0014748,0,.174774,.87607,.00148756,0,.191365,.863461,.00148714,0,.208674,.849594,.00148892,0,.226705,.834531,.00146496,0,.245461,.81903,.0014579,0,.264947,.802122,.00143039,0,.28517,.78445,.00139717,0,.306137,.766434,.00136312,0,.327857,.747816,.00132597,0,.350341,.729519,.00128323,0,.373598,.711454,.00123803,0,.397642,.692699,.00119097,0,.422485,.673723,.00114565,0,.448139,.654386,.00109552,0,.474619,.634673,.00104553,0,.501933,.615554,99985e-8,0,.530089,.596462,948207e-9,0,.559087,.577385,902299e-9,0,.588913,.558257,856448e-9,0,.619525,.5392,810395e-9,0,.650826,.520543,768558e-9,0,.68254,.502206,7239e-7,0,.714286,.48402,685794e-9,0,.746032,.465779,64471e-8,0,.777778,.448455,609583e-9,0,.809524,.431091,57227e-8,0,.84127,.414147,54042e-8,0,.873016,.39765,506545e-9,0,.904762,.381576,477635e-9,0,.936508,.365881,448446e-9,0,.968254,.350582,421424e-9,0,1,1,427144e-9,0,0,1,427151e-9,0,0,1,427232e-9,0,0,.999998,42759e-8,0,0,.999995,428555e-9,0,0,.999988,430603e-9,0,0,.999976,434368e-9,0,0,.999952,440688e-9,0,0,.999919,450667e-9,0,0,.999871,46578e-8,0,0,.999801,488024e-9,0,0,.999704,520092e-9,0,129791e-9,.999572,565553e-9,0,821056e-9,.999389,628906e-9,0,.00225241,.999114,714911e-9,0,.00449109,.998488,819218e-9,0,.00756249,.995234,80415e-8,0,.0114716,.993021,830181e-9,0,.0162131,.991407,902645e-9,0,.021776,.989625,996934e-9,0,.0281471,.987064,.00109707,0,.0353118,.983265,.00114353,0,.0432562,.979535,.0012272,0,.0519665,.975224,.00132642,0,.0614298,.969574,.00138092,0,.0716348,.963021,.00145896,0,.0825709,.956046,.00152834,0,.094229,.947136,.00158217,0,.106602,.937313,.0016347,0,.119682,.926073,.00168383,0,.133465,.913121,.00171627,0,.147947,.899165,.00174229,0,.163125,.885891,.00176137,0,.178998,.873783,.00176406,0,.195566,.861331,.00176156,0,.21283,.847569,.00175346,0,.230793,.832785,.00172753,0,.249459,.817442,.00170204,0,.268832,.800613,.00166576,0,.28892,.783597,.00162909,0,.30973,.76571,.0015826,0,.331271,.747021,.00153106,0,.353554,.728593,.00148036,0,.37659,.710661,.00142808,0,.400391,.692426,.00136906,0,.424973,.673623,.00131066,0,.450347,.65494,.00125569,0,.476531,.635448,.00119517,0,.503535,.616221,.00113828,0,.531372,.597531,.0010816,0,.560047,.578795,.00102673,0,.589554,.559892,970985e-9,0,.619869,.541307,919773e-9,0,.650923,.522608,868479e-9,0,.68254,.504484,82137e-8,0,.714286,.486603,772916e-9,0,.746032,.468802,730353e-9,0,.777778,.451172,684955e-9,0,.809524,.434348,647565e-9,0,.84127,.417445,605863e-9,0,.873016,.401077,571885e-9,0,.904762,.385039,536034e-9,0,.936508,.369483,504227e-9,0,.968254,.354272,473165e-9,0,1,1,599525e-9,0,0,1,599533e-9,0,0,1,599639e-9,0,0,.999998,600097e-9,0,0,.999994,601336e-9,0,0,.999987,603958e-9,0,0,.999972,608775e-9,0,0,.999949,616842e-9,0,0,.999912,629534e-9,0,0,.999857,648658e-9,0,0,.999781,676615e-9,0,538873e-11,.999674,716574e-9,0,308602e-9,.999528,772641e-9,0,.00127003,.999326,849806e-9,0,.00300783,.999009,952682e-9,0,.00556637,.998112,.00106394,0,.00895889,.994496,.00102228,0,.0131827,.992806,.00108586,0,.0182277,.991211,.0011759,0,.0240795,.989415,.00128955,0,.030723,.986499,.00139038,0,.0381418,.982679,.00144539,0,.046321,.978839,.00153954,0,.0552459,.974295,.00164417,0,.0649034,.968784,.00171517,0,.0752814,.962324,.00180282,0,.0863693,.954956,.00186387,0,.0981578,.94624,.00193817,0,.110639,.936517,.00198156,0,.123806,.925186,.00203042,0,.137655,.91252,.0020664,0,.15218,.898441,.00207822,0,.16738,.884394,.0020992,0,.183253,.871273,.00208748,0,.199799,.859057,.00208686,0,.21702,.845243,.00205519,0,.234918,.830723,.00202868,0,.253496,.815801,.00199501,0,.272761,.79914,.00194193,0,.292719,.782372,.00188824,0,.313377,.76482,.00183695,0,.334745,.746586,.00177418,0,.356833,.7281,.00170628,0,.379654,.709842,.00164063,0,.403221,.692019,.00157355,0,.427548,.67364,.00150262,0,.452651,.655277,.00143473,0,.478545,.636438,.00136371,0,.505246,.617364,.00129911,0,.532768,.598603,.00123014,0,.561122,.580195,.00116587,0,.590309,.561786,.00110398,0,.620318,.543377,.00104148,0,.651102,.525093,983984e-9,0,.682545,.506791,92667e-8,0,.714286,.489291,874326e-9,0,.746032,.471811,821734e-9,0,.777778,.454435,774698e-9,0,.809524,.437493,727302e-9,0,.84127,.420977,684039e-9,0,.873016,.404729,64373e-8,0,.904762,.388756,60285e-8,0,.936508,.373344,56765e-8,0,.968254,.358191,531929e-9,0,1,1,832169e-9,0,0,1,832178e-9,0,0,1,83231e-8,0,0,.999998,832893e-9,0,0,.999995,834465e-9,0,0,.999985,837791e-9,0,0,.999969,843893e-9,0,0,.999944,854086e-9,0,0,.999903,870071e-9,0,0,.999843,894042e-9,0,0,.999759,928865e-9,0,531805e-10,.999643,978242e-9,0,579365e-9,.99948,.00104684,0,.00182774,.999255,.00114012,0,.00387804,.998885,.00126188,0,.00675709,.997405,.00135888,0,.010468,.99424,.00133626,0,.0150018,.992458,.00140905,0,.0203443,.990929,.00152305,0,.0264786,.989116,.00165882,0,.0333875,.985624,.00174128,0,.0410536,.982003,.00182108,0,.0494609,.978336,.00194498,0,.0585941,.973184,.00202708,0,.0684396,.9678,.00212166,0,.0789851,.961348,.00221366,0,.0902199,.953841,.00228219,0,.102134,.94534,.00235662,0,.114721,.935552,.00240572,0,.127972,.924064,.00244405,0,.141884,.911827,.00247557,0,.156451,.897731,.00248374,0,.171672,.883409,.00249863,0,.187545,.868625,.00246688,0,.20407,.856529,.00246523,0,.221249,.842999,.00242368,0,.239083,.828505,.00237354,0,.257578,.813825,.00232588,0,.276738,.797813,.00226731,0,.296569,.781097,.00219704,0,.31708,.764038,.00212394,0,.338281,.746067,.00204786,0,.360181,.727687,.00196728,0,.382794,.709571,.00188779,0,.406133,.691503,.00180532,0,.430213,.673673,.00171849,0,.45505,.655732,.00164147,0,.480662,.637399,.00155858,0,.507065,.618616,.00147641,0,.534278,.60005,.00140125,0,.562313,.581713,.00132441,0,.59118,.563546,.00125014,0,.620875,.545605,.00118249,0,.651373,.527559,.0011116,0,.682593,.509764,.00104979,0,.714286,.49193,985977e-9,0,.746032,.475011,928592e-9,0,.777778,.457878,873466e-9,0,.809524,.440979,819585e-9,0,.84127,.424613,772365e-9,0,.873016,.408549,722195e-9,0,.904762,.392771,680014e-9,0,.936508,.377317,636797e-9,0,.968254,.362352,598318e-9,0,1,1,.00114313,0,0,1,.00114314,0,0,.999999,.00114331,0,0,.999998,.00114404,0,0,.999994,.00114601,0,0,.999984,.00115019,0,0,.999967,.00115784,0,0,.999937,.0011706,0,0,.999894,.00119054,0,0,.999828,.00122031,0,0,.999735,.00126331,0,169263e-9,.999606,.00132382,0,949167e-9,.999426,.0014071,0,.00249668,.999173,.00151895,0,.00486392,.99873,.00166102,0,.00806323,.996243,.0017023,0,.0120895,.993779,.00172782,0,.0169288,.9919,.0018108,0,.0225633,.990524,.00196028,0,.028974,.98868,.00212014,0,.036142,.984663,.00217598,0,.044049,.981457,.00230563,0,.0526781,.977608,.00243966,0,.0620137,.972215,.00251336,0,.0720418,.966798,.0026285,0,.0827499,.960241,.00271409,0,.0941271,.952489,.00278381,0,.106164,.944127,.00285399,0,.118852,.934282,.00290994,0,.132185,.923271,.00294558,0,.146157,.910803,.00296269,0,.160766,.896705,.00296803,0,.176007,.88238,.00296637,0,.19188,.867116,.00293163,0,.208385,.853636,.00289418,0,.225523,.840469,.00284663,0,.243296,.82639,.00278594,0,.261709,.811759,.00271618,0,.280767,.796113,.00263187,0,.300476,.779518,.00254589,0,.320845,.763142,.00246003,0,.341883,.745464,.00236529,0,.363601,.727491,.00226536,0,.386011,.709414,.00216375,0,.409128,.691396,.00207127,0,.432967,.67368,.00197106,0,.457545,.656049,.00187022,0,.482881,.638188,.00177605,0,.508992,.620177,.00168482,0,.535899,.601506,.00158909,0,.563619,.58362,.00150583,0,.592165,.565496,.00141791,0,.621544,.54789,.00133693,0,.651743,.530323,.00126038,0,.682709,.512795,.00118556,0,.714286,.495199,.00111527,0,.746032,.478101,.0010489,0,.777778,.461511,984264e-9,0,.809524,.444879,92591e-8,0,.84127,.428424,866582e-9,0,.873016,.412495,814463e-9,0,.904762,.396975,764498e-9,0,.936508,.381614,715967e-9,0,.968254,.366732,672483e-9,0,1,1,.00155501,0,0,1,.00155503,0,0,1,.00155524,0,0,.999998,.00155615,0,0,.999994,.0015586,0,0,.999983,.00156379,0,0,.999963,.0015733,0,0,.999932,.00158911,0,0,.999882,.00161376,0,0,.99981,.00165041,0,100875e-10,.999708,.00170304,0,367658e-9,.999565,.00177658,0,.0014234,.999368,.00187688,0,.00327939,.999081,.00200989,0,.00596629,.99852,.00217177,0,.0094852,.99549,.0021745,0,.013824,.993252,.00222357,0,.0189642,.991727,.00235022,0,.0248856,.989951,.00250561,0,.0315669,.988029,.00268829,0,.0389882,.984029,.0027496,0,.0471302,.980683,.00289793,0,.0559754,.976554,.00303315,0,.0655081,.97139,.00313257,0,.0757138,.965544,.00323656,0,.08658,.95912,.00333432,0,.0980954,.951183,.0034039,0,.110251,.942974,.00347515,0,.123038,.932642,.00350381,0,.13645,.922158,.00354519,0,.150482,.909404,.00353851,0,.165129,.896071,.0035435,0,.18039,.881206,.00349936,0,.196263,.866077,.00347256,0,.212748,.85093,.003415,0,.229847,.837703,.00333367,0,.247561,.823878,.003249,0,.265895,.809449,.00316347,0,.284854,.794379,.00306351,0,.304445,.778138,.0029499,0,.324675,.761997,.00284099,0,.345555,.744938,.00272104,0,.367095,.727212,.00260715,0,.389309,.709549,.00248855,0,.41221,.691704,.00236783,0,.435814,.673689,.00225178,0,.460138,.656453,.00213765,0,.485203,.639128,.00202178,0,.511028,.621512,.00191443,0,.537634,.603598,.00180977,0,.565041,.58559,.00170456,0,.593268,.567852,.00160927,0,.622327,.5503,.00151395,0,.652217,.533033,.00142499,0,.682907,.515942,.00133955,0,.714296,.498814,.0012602,0,.746032,.481595,.00118188,0,.777778,.465117,.00111171,0,.809524,.448865,.00104091,0,.84127,.432711,976618e-9,0,.873016,.416822,91859e-8,0,.904762,.401272,857704e-9,0,.936508,.386226,807172e-9,0,.968254,.371321,75464e-8,0,1,1,.00209596,0,0,1,.00209598,0,0,1,.00209624,0,0,.999997,.00209736,0,0,.999991,.00210039,0,0,.999979,.00210678,0,0,.999959,.00211847,0,0,.999925,.0021379,0,0,.99987,.00216809,0,0,.999791,.00221281,0,681487e-10,.999677,.00227669,0,658161e-9,.999521,.00236533,0,.00200635,.999301,.00248514,0,.0041779,.998977,.00264185,0,.00718648,.998191,.00281695,0,.0110239,.994801,.00278518,0,.015672,.993091,.00288774,0,.0211091,.991571,.00303931,0,.0273123,.9897,.00321643,0,.034259,.987023,.00337332,0,.0419282,.983289,.00346146,0,.0502998,.979892,.00363704,0,.0593562,.975111,.00373601,0,.069081,.970351,.0038842,0,.0794598,.964131,.00397053,0,.0904798,.957747,.00408078,0,.10213,.949536,.00413533,0,.1144,.941372,.00420305,0,.127284,.931049,.00422815,0,.140772,.920647,.00425048,0,.154862,.908033,.0042281,0,.169548,.895028,.00422026,0,.184828,.879968,.00415042,0,.200701,.864875,.00408821,0,.217167,.84918,.00400909,0,.234227,.834934,.00391178,0,.251884,.821397,.00380066,0,.270141,.807135,.00367974,0,.289004,.792363,.00355172,0,.308479,.776661,.003411,0,.328575,.760705,.00328123,0,.349301,.744408,.00314003,0,.370668,.726994,.0029906,0,.392689,.709598,.00285034,0,.415379,.692112,.00271179,0,.438754,.674435,.00257185,0,.46283,.65676,.00243425,0,.48763,.639982,.00230351,0,.513173,.622983,.0021777,0,.539482,.605471,.00204991,0,.566579,.58796,.00193759,0,.594488,.570463,.00181976,0,.623226,.553058,.00171497,0,.6528,.535894,.00161109,0,.683198,.519089,.00151394,0,.714354,.502454,.00142122,0,.746032,.485681,.00133488,0,.777778,.468935,.00124975,0,.809524,.452951,.00117309,0,.84127,.437139,.00110155,0,.873016,.421446,.00103124,0,.904762,.405951,966387e-9,0,.936508,.391003,908119e-9,0,.968254,.376198,848057e-9,0,1,1,.00280076,0,0,1,.00280078,0,0,.999999,.00280109,0,0,.999997,.00280246,0,0,.999992,.00280616,0,0,.999979,.00281396,0,0,.999956,.00282822,0,0,.999916,.00285186,0,0,.999857,.0028885,0,0,.999768,.00294259,0,196026e-9,.999645,.00301946,0,.00104842,.99947,.00312541,0,.00270199,.999229,.00326733,0,.00519449,.998852,.00344992,0,.00852602,.997558,.00361052,0,.0126804,.994417,.0035898,0,.017635,.992824,.00372393,0,.023365,.991344,.00390695,0,.0298456,.989337,.00410392,0,.0370529,.985811,.00420987,0,.0449651,.982772,.00437488,0,.0535615,.979001,.00455069,0,.0628243,.974102,.00464462,0,.0727368,.969197,.00480577,0,.0832844,.962759,.00487818,0,.0944545,.956207,.00498176,0,.106236,.947909,.00503392,0,.118619,.939596,.00507474,0,.131595,.929642,.00509798,0,.145159,.918807,.00508476,0,.159305,.906921,.00505634,0,.174028,.893312,.00498845,0,.189327,.878933,.0049133,0,.2052,.863986,.0048259,0,.221647,.847936,.00470848,0,.23867,.832253,.00456889,0,.25627,.818619,.00442726,0,.274453,.804788,.00427677,0,.293222,.790241,.00411906,0,.312585,.775162,.00394833,0,.33255,.759463,.00377366,0,.353126,.743598,.00361026,0,.374324,.72697,.00343627,0,.396158,.709646,.00326422,0,.418641,.69277,.00309717,0,.44179,.675371,.0029356,0,.465624,.657863,.00277712,0,.490163,.640772,.00261738,0,.515429,.624441,.0024737,0,.541445,.607497,.00233125,0,.568236,.590438,.00218994,0,.595828,.573224,.0020664,0,.624242,.556168,.00193526,0,.653496,.539232,.00182463,0,.683588,.522352,.00170735,0,.714482,.506172,.00160555,0,.746032,.489842,.00150451,0,.777778,.473463,.00140938,0,.809524,.457266,.00132568,0,.84127,.441609,.0012376,0,.873016,.426348,.00116265,0,.904762,.411002,.00108935,0,.936508,.396045,.00101946,0,.968254,.381448,955665e-9,0,1,1,.0037121,0,0,1,.00371213,0,0,1,.00371251,0,0,.999997,.00371417,0,0,.99999,.00371863,0,0,.999977,.00372807,0,0,.99995,.00374529,0,0,.999908,.0037738,0,0,.999843,.00381789,0,123596e-10,.999745,.00388273,0,407442e-9,.999608,.00397443,0,.0015447,.999415,.00409998,0,.00351385,.999143,.00426662,0,.0063316,.9987,.00447625,0,.00998679,.996363,.00455323,0,.0144569,.994021,.00461052,0,.0197151,.992372,.00476359,0,.0257344,.991007,.00499101,0,.0324882,.988767,.0051972,0,.0399517,.984872,.00528407,0,.0481022,.982004,.00548926,0,.0569191,.977714,.00564385,0,.0663839,.973076,.0057693,0,.0764801,.967565,.0058924,0,.0871928,.961384,.00599629,0,.0985095,.954435,.00605998,0,.110419,.946303,.0061133,0,.122912,.937662,.00612028,0,.13598,.927867,.00612209,0,.149617,.916475,.00604813,0,.163817,.90541,.00603088,0,.178577,.891591,.00592218,0,.193894,.877573,.00578854,0,.209767,.862511,.00566648,0,.226196,.846861,.00551481,0,.243182,.83068,.00533754,0,.260728,.815725,.00515487,0,.278837,.802321,.0049655,0,.297515,.787826,.00475421,0,.316768,.773454,.00456002,0,.336605,.758224,.00434727,0,.357034,.74265,.00414444,0,.378067,.726729,.00393738,0,.399717,.710155,.00373575,0,.421998,.693312,.00353736,0,.444928,.67653,.00334368,0,.468523,.659444,.00315981,0,.492806,.642051,.00297809,0,.517798,.625758,.00280592,0,.543525,.609615,.00264254,0,.570012,.592919,.00248459,0,.597288,.576298,.00233327,0,.625379,.559489,.00219519,0,.654307,.542891,.00205441,0,.684084,.526255,.00193385,0,.714693,.509853,.00180745,0,.746044,.494131,.00169817,0,.777778,.478114,.0015913,0,.809524,.462274,.00148981,0,.84127,.446412,.00139537,0,.873016,.431274,.00130984,0,.904762,.41635,.00122403,0,.936508,.401476,.00114809,0,.968254,.386993,.00107563,0,1,1,.00488216,0,0,1,.0048822,0,0,1,.00488265,0,0,.999997,.00488463,0,0,.999988,.00488999,0,0,.999974,.00490129,0,0,.999946,.00492191,0,0,.999897,.00495598,0,0,.999825,.00500855,0,744791e-10,.999718,.00508559,0,712744e-9,.999565,.005194,0,.00215249,.999352,.00534147,0,.00444576,.999046,.00553523,0,.00759218,.998492,.00577016,0,.0115714,.995564,.00578487,0,.0163557,.993339,.00586414,0,.021915,.991834,.00606002,0,.0282201,.990496,.00633312,0,.0352433,.987826,.00651941,0,.042959,.98383,.00660842,0,.0513439,.98109,.00685523,0,.0603772,.976131,.00695778,0,.0700402,.971922,.00714236,0,.0803163,.965901,.00721437,0,.0911908,.959606,.00732017,0,.102651,.952504,.00735788,0,.114686,.944365,.00738493,0,.127286,.935652,.00737969,0,.140443,.925813,.00733612,0,.154151,.914397,.00723094,0,.168405,.903257,.00714002,0,.183201,.890015,.00700149,0,.198536,.876014,.00682813,0,.214409,.861436,.00665567,0,.23082,.845752,.00644526,0,.24777,.829169,.00621635,0,.265263,.813435,.00597789,0,.283301,.799701,.00575694,0,.301889,.785726,.00549866,0,.321035,.77152,.0052503,0,.340746,.75683,.00499619,0,.361032,.741951,.0047543,0,.381904,.726367,.0045084,0,.403374,.710537,.00426784,0,.425457,.693965,.00403487,0,.448169,.677724,.0038075,0,.47153,.66117,.00359431,0,.495561,.644274,.00338354,0,.520284,.627449,.00318163,0,.545725,.611645,.00299672,0,.571911,.595614,.00281016,0,.598873,.579426,.00264252,0,.62664,.563016,.00247509,0,.655239,.546728,.00232647,0,.684692,.530539,.00217803,0,.714999,.514164,.00204216,0,.746106,.498344,.00191403,0,.777778,.482957,.00179203,0,.809524,.467336,.00167695,0,.84127,.451994,.00157567,0,.873016,.436514,.00147113,0,.904762,.42178,.00138034,0,.936508,.407271,.00129219,0,.968254,.392822,.0012098,0,1,1,.00637427,0,0,1,.00637431,0,0,.999999,.00637485,0,0,.999996,.00637721,0,0,.999987,.00638357,0,0,.999971,.006397,0,0,.999939,.00642142,0,0,.999888,.00646177,0,0,.999807,.00652387,0,207916e-9,.999689,.00661454,0,.00112051,.99952,.00674155,0,.00287719,.999283,.00691313,0,.00550145,.998936,.00713598,0,.00897928,.998165,.00738501,0,.0132829,.994847,.00734388,0,.01838,.993182,.00749991,0,.0242381,.991665,.0077246,0,.030826,.989708,.00797579,0,.0381152,.986663,.00813011,0,.0460794,.983288,.00830365,0,.0546951,.980104,.00853496,0,.0639411,.974855,.00861045,0,.0737988,.97045,.00879133,0,.0842516,.964509,.00886377,0,.0952848,.957594,.00890346,0,.106886,.950546,.00893289,0,.119044,.942225,.00890074,0,.131749,.933365,.00886826,0,.144994,.923202,.0087316,0,.158772,.912605,.00863082,0,.173078,.901099,.00847403,0,.187908,.888177,.00825838,0,.203261,.873955,.00801834,0,.219134,.860091,.00779026,0,.235527,.84434,.00752478,0,.252443,.828517,.00724074,0,.269883,.81239,.00693769,0,.287851,.79721,.00664817,0,.306352,.783489,.00634763,0,.325393,.769514,.00604221,0,.344981,.755419,.00573568,0,.365126,.741083,.00544359,0,.385839,.726059,.00515515,0,.407132,.710809,.00487139,0,.42902,.695052,.00459846,0,.45152,.678886,.00433412,0,.474651,.663042,.00407981,0,.498433,.646634,.00384264,0,.52289,.630117,.00360897,0,.548048,.613804,.00338863,0,.573936,.598338,.00318486,0,.600584,.582687,.00298377,0,.628027,.566809,.00280082,0,.656295,.550817,.00262255,0,.685417,.534937,.00245835,0,.715406,.519151,.00230574,0,.74624,.503118,.0021549,0,.777778,.487723,.00202008,0,.809524,.472725,.00189355,0,.84127,.457599,.00177108,0,.873016,.442558,.00165843,0,.904762,.427624,.00155494,0,.936508,.413171,.00145273,0,.968254,.399122,.00136454,0,1,1,.00826496,0,0,1,.00826499,0,0,1,.00826564,0,0,.999996,.00826842,0,0,.999987,.00827589,0,0,.999967,.00829167,0,0,.999933,.00832037,0,0,.999876,.00836768,0,109338e-10,.999786,.00844031,0,427145e-9,.999655,.00854603,0,.0016384,.999468,.00869337,0,.00372392,.999203,.008891,0,.00668513,.998803,.00914387,0,.0104968,.99748,.00935838,0,.015125,.994446,.00933309,0,.0205338,.99292,.00953084,0,.0266884,.991414,.0097893,0,.0335565,.989049,.0100228,0,.0411086,.98582,.0101664,0,.0493181,.982441,.0103582,0,.0581613,.978595,.0105292,0,.0676169,.973495,.0106274,0,.0776661,.968405,.0107261,0,.0882926,.962717,.0108234,0,.0994817,.955478,.0108102,0,.111221,.948275,.0107914,0,.123499,.940006,.0107161,0,.136308,.930831,.0106309,0,.149639,.920648,.0104083,0,.163485,.910205,.0102312,0,.177843,.898445,.0100051,0,.192707,.885986,.00971928,0,.208077,.872204,.00940747,0,.22395,.858436,.0091085,0,.240326,.843454,.00876595,0,.257208,.827437,.00839794,0,.274596,.811488,.00803692,0,.292496,.796039,.00767352,0,.310911,.781083,.0073097,0,.329849,.767642,.00694032,0,.349316,.753901,.00657476,0,.369323,.740131,.00622699,0,.38988,.725845,.0058838,0,.410999,.710991,.00555586,0,.432696,.696002,.00523089,0,.454987,.680461,.00492494,0,.47789,.664875,.00463464,0,.501426,.649273,.00435422,0,.52562,.63302,.0040875,0,.550498,.61705,.00384075,0,.576089,.601154,.00359557,0,.602427,.586008,.00337636,0,.629544,.570699,.00316019,0,.657479,.555166,.00296033,0,.686264,.539645,.00277552,0,.715924,.524159,.00259499,0,.746459,.508682,.00243257,0,.777789,.493163,.00227851,0,.809524,.478004,.00213083,0,.84127,.46347,.00199502,0,.873016,.448778,.00186967,0,.904762,.434105,.00174732,0,.936508,.419576,.00163861,0,.968254,.405541,.00153341,0,1,1,.0106462,0,0,1,.0106462,0,0,.999999,.010647,0,0,.999995,.0106502,0,0,.999985,.0106589,0,0,.999964,.0106773,0,0,.999925,.0107106,0,0,.999861,.0107655,0,712986e-10,.999763,.0108497,0,743959e-9,.999616,.0109716,0,.00227361,.999408,.0111408,0,.0046983,.999112,.0113659,0,.00800158,.998637,.0116475,0,.0121493,.996223,.0117231,0,.0171023,.994006,.0118064,0,.0228218,.992444,.0120254,0,.0292711,.991028,.0123314,0,.036417,.98803,.0124954,0,.0442295,.984816,.0126538,0,.0526815,.981399,.0128537,0,.0617492,.977085,.0129694,0,.0714114,.972154,.013091,0,.0816495,.966617,.0131166,0,.0924472,.960628,.0131583,0,.10379,.953295,.0131094,0,.115665,.94575,.0129966,0,.128062,.937654,.0128796,0,.140972,.927716,.0126477,0,.154387,.917932,.0123889,0,.168301,.907719,.012131,0,.182709,.89584,.0118013,0,.197608,.883526,.0114145,0,.212994,.870301,.0110075,0,.228867,.856272,.0106019,0,.245227,.842251,.0101938,0,.262074,.826466,.00973254,0,.279412,.810859,.0092846,0,.297244,.795051,.00883304,0,.315575,.780053,.00840272,0,.334412,.76575,.00796438,0,.35376,.752298,.00752526,0,.373631,.739153,.00711486,0,.394034,.725514,.00670361,0,.414983,.711473,.00632656,0,.436491,.696936,.00595206,0,.458575,.682126,.00559191,0,.481253,.667027,.00525362,0,.504547,.651875,.00493805,0,.528481,.636463,.00462848,0,.553081,.620641,.00433936,0,.578377,.604931,.00407,0,.604404,.589549,.00380864,0,.631197,.574712,.00357049,0,.658795,.559775,.00334466,0,.687238,.544514,.00312505,0,.716559,.529555,.00293199,0,.746776,.514402,.00274204,0,.777849,.499302,.00256647,0,.809524,.484114,.00239901,0,.84127,.469308,.00225148,0,.873016,.455133,.00210178,0,.904762,.440939,.0019727,0,.936508,.426627,.00184382,0,.968254,.412509,.00172548,0,1,1,.013628,0,0,1,.0136281,0,0,.999999,.0136289,0,0,.999995,.0136327,0,0,.999983,.0136427,0,0,.99996,.0136638,0,0,.999917,.0137022,0,0,.999846,.0137652,0,204597e-9,.999736,.0138615,0,.00116837,.999573,.0140007,0,.00303325,.99934,.0141927,0,.00580613,.999004,.0144457,0,.00945626,.998407,.0147489,0,.0139421,.995464,.014731,0,.0192202,.993328,.0148283,0,.0252495,.991799,.0150797,0,.0319921,.990397,.0154316,0,.0394138,.986835,.0155005,0,.0474843,.983938,.0157308,0,.0561763,.980154,.0158753,0,.0654661,.975659,.0159581,0,.0753326,.970171,.0159832,0,.0857571,.964803,.0160084,0,.0967236,.958366,.0159484,0,.108218,.950613,.0158001,0,.120227,.942874,.0155845,0,.132741,.935005,.0154292,0,.145751,.924991,.0150742,0,.159249,.914814,.0146757,0,.17323,.904743,.0143097,0,.187687,.893216,.0138695,0,.202619,.880769,.0133706,0,.218021,.868136,.0128606,0,.233894,.85469,.0123403,0,.250238,.840593,.0118091,0,.267052,.825808,.011253,0,.284341,.81009,.0107099,0,.302106,.79504,.0101636,0,.320354,.779757,.00964041,0,.33909,.764697,.00911896,0,.358322,.750913,.00859533,0,.378059,.738175,.00811592,0,.398311,.725242,.00764504,0,.41909,.711864,.00718885,0,.440412,.698009,.00675843,0,.462292,.683841,.00634984,0,.484748,.669391,.00595502,0,.507802,.654731,.00558671,0,.531477,.639805,.00523578,0,.555802,.624789,.00490834,0,.580805,.609325,.00459448,0,.606522,.593975,.00430342,0,.63299,.578983,.00403019,0,.66025,.564442,.0037707,0,.688346,.549835,.0035316,0,.717319,.535039,.00330255,0,.7472,.520403,.00308932,0,.777982,.505687,.00289335,0,.809524,.490939,.00270818,0,.84127,.476233,.0025343,0,.873016,.461624,.00237097,0,.904762,.447833,.00222065,0,.936508,.433992,.00207561,0,.968254,.420147,.00194955,0,1,1,.0173415,0,0,1,.0173416,0,0,.999999,.0173426,0,0,.999995,.0173468,0,0,.999983,.0173582,0,0,.999954,.0173822,0,0,.999908,.0174258,0,669501e-11,.999828,.0174973,0,427399e-9,.999705,.0176063,0,.00171019,.999524,.0177631,0,.0039248,.999263,.0179781,0,.00705382,.998878,.018258,0,.0110552,.998012,.0185551,0,.0158812,.994614,.0184264,0,.0214852,.993132,.0186385,0,.0278239,.991563,.0189067,0,.0348585,.989298,.0191577,0,.0425544,.986036,.0192522,0,.050881,.982558,.0194063,0,.059811,.978531,.019486,0,.0693209,.974198,.0195847,0,.0793895,.968148,.0194749,0,.0899984,.962565,.0194277,0,.101132,.956041,.0192991,0,.112775,.947749,.0189893,0,.124917,.94018,.018704,0,.137547,.93165,.0183458,0,.150655,.921798,.0178775,0,.164236,.911573,.0173618,0,.178281,.901569,.0168482,0,.192788,.890341,.016265,0,.207752,.877835,.0156199,0,.223171,.865472,.0149516,0,.239044,.852905,.0143274,0,.255371,.838906,.0136643,0,.272153,.824888,.0129903,0,.289393,.809977,.0123218,0,.307093,.794697,.0116572,0,.325259,.780028,.0110307,0,.343896,.765124,.0104236,0,.363012,.750411,.0098219,0,.382617,.737264,.00924397,0,.402719,.724799,.00868719,0,.423332,.712253,.00816476,0,.444469,.699267,.00767262,0,.466146,.685618,.00719746,0,.488383,.671736,.00673916,0,.511199,.657777,.00631937,0,.534618,.643497,.00592411,0,.558668,.62889,.00553928,0,.58338,.614299,.0051934,0,.608787,.599197,.00485985,0,.634929,.584175,.00454357,0,.661849,.569541,.00425787,0,.689594,.555193,.00397905,0,.718211,.540947,.00372364,0,.747742,.526593,.00348599,0,.778205,.512335,.00326103,0,.80953,.498017,.00305137,0,.84127,.483609,.00285485,0,.873016,.469368,.00267472,0,.904762,.455037,.00249945,0,.936508,.441493,.00234792,0,.968254,.428147,.00219936,0,1,1,.0219422,0,0,1,.0219423,0,0,.999998,.0219434,0,0,.999993,.0219481,0,0,.999981,.021961,0,0,.999949,.0219879,0,0,.999896,.0220367,0,593194e-10,.999808,.0221167,0,75364e-8,.99967,.0222383,0,.00237884,.999466,.0224125,0,.00495612,.999174,.0226495,0,.00844887,.998725,.0229525,0,.0128058,.996979,.0231123,0,.0179742,.994317,.0230742,0,.0239047,.992781,.0232895,0,.0305526,.991191,.0235734,0,.0378786,.987787,.0236152,0,.0458475,.985092,.0237994,0,.0544287,.981121,.0238553,0,.0635952,.976924,.0238706,0,.0733233,.97218,.0238704,0,.0835922,.965956,.0236598,0,.0943839,.959998,.0234735,0,.105682,.953245,.0232277,0,.117474,.944445,.0226973,0,.129747,.937087,.0223527,0,.142491,.928341,.0218144,0,.155697,.9184,.0211516,0,.169358,.907959,.0204553,0,.183469,.89808,.0197673,0,.198024,.887047,.0189915,0,.21302,.875221,.0182082,0,.228455,.86269,.0173584,0,.244329,.850735,.0165718,0,.260639,.837545,.0157524,0,.277389,.823639,.0149482,0,.29458,.809699,.0141431,0,.312216,.794797,.0133527,0,.3303,.780578,.0126193,0,.34884,.766019,.0118914,0,.367842,.751447,.0111839,0,.387315,.737275,.010514,0,.40727,.724545,.00987277,0,.427717,.712644,.00926569,0,.448671,.700432,.00869029,0,.470149,.687664,.00814691,0,.492167,.674288,.00763012,0,.514746,.660966,.00714437,0,.537911,.647264,.00668457,0,.561688,.633431,.00626581,0,.586108,.619133,.00585593,0,.611206,.604935,.00548188,0,.637022,.590236,.00513288,0,.663599,.575473,.0047906,0,.690989,.561228,.00448895,0,.719242,.547054,.00420233,0,.748411,.533175,.00392869,0,.778531,.519163,.00367445,0,.809583,.505328,.00344097,0,.84127,.491446,.00322003,0,.873016,.477356,.00301283,0,.904762,.46356,.00282592,0,.936508,.449623,.00264956,0,.968254,.436068,.00246956,0,1,1,.0276135,0,0,1,.0276136,0,0,.999998,.0276148,0,0,.999993,.0276201,0,0,.999976,.0276342,0,0,.999945,.027664,0,0,.999884,.0277179,0,18679e-8,.999784,.027806,0,.00119607,.99963,.0279394,0,.00318407,.999401,.0281295,0,.00613601,.999066,.0283858,0,.00999963,.998524,.0287027,0,.0147164,.995702,.0286256,0,.0202295,.993593,.0286733,0,.0264876,.992067,.0288989,0,.0334452,.990548,.0292135,0,.0410621,.986775,.0291296,0,.0493032,.984054,.0293099,0,.0581381,.979481,.0291881,0,.0675397,.975297,.0291598,0,.0774848,.96981,.028954,0,.0879528,.963524,.028628,0,.0989258,.957398,.0283135,0,.110388,.950088,.0278469,0,.122327,.941538,.0271798,0,.134729,.933332,.0265388,0,.147587,.924392,.0257776,0,.160889,.914581,.024916,0,.174631,.904347,.0240242,0,.188806,.894324,.0231229,0,.203409,.883724,.022153,0,.218437,.872207,.0211355,0,.233888,.859927,.0201048,0,.249761,.848373,.0191263,0,.266056,.836023,.0181306,0,.282774,.82289,.0171718,0,.299917,.809324,.0162196,0,.317488,.795361,.0152622,0,.335493,.781253,.01439,0,.353936,.767338,.013533,0,.372825,.753156,.0127244,0,.392168,.739122,.0119454,0,.411976,.725358,.0112054,0,.432259,.712949,.010487,0,.453032,.701621,.00984032,0,.47431,.689703,.00921495,0,.496111,.677216,.00862492,0,.518456,.664217,.00806882,0,.541367,.65137,.00755922,0,.564872,.638,.00705705,0,.589001,.62453,.00661266,0,.613789,.610601,.00618432,0,.639277,.59676,.00578033,0,.66551,.582433,.00540927,0,.692539,.568026,.00506104,0,.720422,.55414,.0047353,0,.749216,.540178,.00442889,0,.778974,.526513,.00414363,0,.809711,.512954,.00388237,0,.84127,.499403,.00362875,0,.873016,.486026,.00340827,0,.904762,.472345,.00318598,0,.936508,.458828,.00297635,0,.968254,.445379,.00279447,0,1,1,.0345716,0,0,1,.0345717,0,0,.999999,.034573,0,0,.999991,.0345787,0,0,.999974,.0345941,0,0,.999937,.0346263,0,188589e-11,.999869,.0346847,0,409238e-9,.999757,.0347798,0,.0017674,.999582,.0349233,0,.00413658,.999322,.0351265,0,.00747408,.998939,.0353967,0,.0117157,.998219,.0357018,0,.0167966,.994974,.0354726,0,.0226572,.993201,.0355621,0,.0292445,.991573,.0357641,0,.0365123,.989301,.0359252,0,.0444203,.985712,.0358017,0,.0529334,.982411,.0358353,0,.0620214,.977827,.035617,0,.0716574,.973278,.0354398,0,.0818186,.967397,.0350483,0,.0924846,.960696,.0344795,0,.103638,.954349,.0339861,0,.115263,.946066,.0331323,0,.127348,.938012,.032359,0,.13988,.929413,.0314413,0,.152849,.920355,.0304103,0,.166248,.910586,.0292785,0,.18007,.900609,.0281391,0,.194308,.890093,.0269103,0,.208958,.880013,.0257269,0,.224018,.869001,.0244671,0,.239485,.85751,.0232252,0,.255359,.84582,.0220117,0,.271638,.834383,.0208274,0,.288324,.822158,.0196628,0,.305419,.809056,.0185306,0,.322927,.795832,.0174174,0,.340851,.782547,.0163758,0,.359199,.7689,.015391,0,.377975,.755526,.0144488,0,.397189,.741681,.0135372,0,.416851,.728178,.0126957,0,.436971,.714642,.0118812,0,.457564,.702756,.0111165,0,.478644,.69175,.0104145,0,.500229,.680159,.00974439,0,.522339,.668073,.00911926,0,.544997,.655405,.00851393,0,.56823,.642921,.00797637,0,.592068,.629993,.00745119,0,.616546,.616828,.00696972,0,.641705,.603305,.00652425,0,.66759,.589833,.00610188,0,.694255,.575945,.00570834,0,.72176,.561745,.00533384,0,.750168,.548277,.00500001,0,.779545,.534467,.00467582,0,.809933,.521032,.00438092,0,.841272,.507877,.00410348,0,.873016,.494654,.00383618,0,.904762,.481592,.00358699,0,.936508,.468509,.00337281,0,.968254,.455293,.00316196,0,1,1,.0430698,0,0,1,.0430699,0,0,.999998,.0430713,0,0,.999991,.0430773,0,0,.99997,.0430936,0,0,.999928,.0431277,0,406396e-10,.999852,.0431893,0,744376e-9,.999724,.0432895,0,.0024806,.999527,.0434397,0,.00524779,.99923,.0436507,0,.00898164,.998783,.0439255,0,.0136083,.997507,.0441104,0,.0190582,.994418,.0438225,0,.0252694,.992864,.0439396,0,.0321879,.991127,.0440962,0,.039767,.987331,.0438408,0,.0479667,.984819,.0438991,0,.056752,.980384,.0435906,0,.0660929,.975846,.0432543,0,.075963,.970748,.0428293,0,.0863398,.964303,.042153,0,.0972035,.95772,.0414111,0,.108537,.950747,.0405893,0,.120325,.942533,.0394887,0,.132554,.934045,.0383544,0,.145215,.924942,.037057,0,.158296,.915811,.0356993,0,.17179,.90612,.0342401,0,.185691,.896434,.0328078,0,.199993,.886021,.031288,0,.214691,.876081,.0297776,0,.229782,.865608,.0282334,0,.245265,.854924,.026749,0,.261138,.843607,.02526,0,.277401,.832456,.0238214,0,.294056,.821342,.0224682,0,.311104,.809303,.0211297,0,.328548,.796468,.0198387,0,.346394,.784046,.0186227,0,.364645,.771262,.0174561,0,.38331,.758118,.0163806,0,.402396,.745075,.0153287,0,.421912,.731926,.0143647,0,.44187,.71863,.0134363,0,.462283,.705414,.0125603,0,.483165,.693792,.0117508,0,.504535,.683108,.0110016,0,.52641,.67183,.0102757,0,.548816,.66015,.00962044,0,.571776,.647907,.00898031,0,.595323,.635734,.00840811,0,.619489,.623208,.00786211,0,.644317,.610438,.00734953,0,.669852,.597345,.00687688,0,.696148,.584138,.00643469,0,.723267,.5707,.00602236,0,.75128,.556966,.0056324,0,.780258,.543607,.00528277,0,.810268,.530213,.00493999,0,.841311,.516912,.00462265,0,.873016,.503916,.0043307,0,.904762,.491146,.00406858,0,.936508,.478439,.00381436,0,.968254,.465834,.00358003,0,1,1,.0534039,0,0,1,.053404,0,0,.999998,.0534055,0,0,.999989,.0534116,0,0,.999968,.0534283,0,0,.999918,.0534633,0,155895e-9,.99983,.0535262,0,.00120914,.999685,.0536281,0,.00334944,.999461,.0537799,0,.00653077,.999119,.0539902,0,.0106718,.998582,.0542524,0,.0156907,.995919,.0540318,0,.0215147,.993735,.0538914,0,.0280801,.992126,.0539557,0,.0353323,.990266,.0540401,0,.0432247,.986317,.0536064,0,.0517172,.983213,.0534425,0,.0607754,.978303,.0528622,0,.0703698,.973665,.0523363,0,.0804742,.968091,.0516165,0,.0910667,.961026,.0505434,0,.102128,.954333,.049523,0,.113641,.946372,.0481698,0,.125591,.938254,.0467674,0,.137965,.929516,.0452341,0,.150754,.920106,.0435083,0,.163947,.910899,.0417399,0,.177537,.901532,.0399389,0,.191516,.891919,.0380901,0,.205881,.882006,.0362341,0,.220626,.871965,.0343444,0,.235749,.862145,.0324832,0,.251248,.852058,.0306681,0,.267121,.84161,.0289097,0,.283368,.830806,.0272079,0,.299992,.820476,.0256089,0,.316992,.809514,.0240394,0,.334374,.797865,.0225379,0,.35214,.785621,.0211235,0,.370296,.773765,.0197908,0,.388849,.761629,.0185235,0,.407807,.748891,.0173358,0,.427178,.736437,.0162305,0,.446974,.723707,.0151778,0,.467207,.710606,.0141791,0,.487892,.698019,.0132592,0,.509046,.686203,.0123887,0,.530687,.675692,.0115976,0,.552839,.664826,.0108325,0,.575527,.65349,.0101348,0,.59878,.641774,.00947756,0,.622634,.629794,.00886058,0,.647128,.617647,.00828526,0,.672308,.60534,.00775312,0,.698231,.592718,.00726033,0,.724958,.579746,.00679731,0,.752563,.566763,.00636111,0,.781127,.553515,.00595228,0,.810733,.540118,.00556876,0,.841426,.527325,.00523051,0,.873016,.514265,.00490712,0,.904762,.501406,.00460297,0,.936508,.488922,.00431247,0,.968254,.476541,.0040472,0,1,1,.0659184,0,0,1,.0659185,0,0,.999998,.06592,0,0,.999988,.0659259,0,0,.999963,.0659423,0,0,.999907,.0659764,0,374198e-9,.999806,.0660376,0,.00182071,.999639,.0661361,0,.0043894,.999378,.0662814,0,.00800055,.998985,.0664779,0,.0125594,.998285,.0666914,0,.0179786,.995071,.0661989,0,.0241822,.993172,.0660454,0,.031106,.991438,.0660105,0,.0386952,.988428,.0656875,0,.0469032,.985218,.0652913,0,.0556905,.981128,.0647107,0,.065023,.976015,.0638491,0,.0748717,.97097,.062993,0,.0852112,.964582,.0617927,0,.0960199,.957383,.0603626,0,.107279,.949969,.0588128,0,.118971,.941843,.0570274,0,.131084,.933624,.0551885,0,.143604,.924543,.053122,0,.156521,.914919,.0508897,0,.169825,.905773,.0486418,0,.18351,.896434,.0463364,0,.197569,.887195,.0440623,0,.211997,.877706,.0417799,0,.226789,.867719,.03945,0,.241944,.858587,.037243,0,.257458,.849317,.0350956,0,.273331,.839585,.0329852,0,.289563,.829856,.0310028,0,.306154,.819589,.0290953,0,.323108,.809714,.0272738,0,.340426,.79934,.0255631,0,.358113,.788224,.0239175,0,.376175,.776619,.0223831,0,.394616,.76521,.0209298,0,.413445,.753716,.0195786,0,.432671,.741564,.0183001,0,.452305,.729413,.0171259,0,.472358,.717146,.0159933,0,.492845,.70436,.0149495,0,.513783,.69219,.0139681,0,.535189,.680289,.0130577,0,.557087,.669611,.0122198,0,.5795,.659113,.0114174,0,.602459,.648148,.0106729,0,.625997,.636905,.00998997,0,.650154,.625154,.00934313,0,.674976,.613481,.00874839,0,.700518,.60154,.00818265,0,.726845,.58943,.00766889,0,.754032,.576828,.00717153,0,.782167,.564194,.00672696,0,.811344,.551501,.00630863,0,.841644,.538635,.00592177,0,.873016,.525724,.00554888,0,.904762,.513209,.00520225,0,.936508,.500457,.00488231,0,.968254,.48799,.00457153,0,1,1,.0810131,0,0,1,.0810133,0,0,.999997,.0810145,0,0,.999985,.08102,0,0,.999956,.0810347,0,195026e-10,.999893,.0810656,0,719316e-9,.999777,.0811205,0,.00259774,.999583,.081208,0,.00561807,.999281,.0813343,0,.00967472,.998813,.0814969,0,.0146627,.997597,.0815217,0,.0204902,.994379,.0808502,0,.0270802,.992744,.0806792,0,.0343674,.990745,.0804589,0,.0422974,.986646,.0796107,0,.0508242,.983611,.0790913,0,.0599087,.978869,.0780746,0,.0695175,.973475,.0768218,0,.0796223,.967845,.0754926,0,.0901983,.960778,.0737063,0,.101224,.953333,.0718052,0,.112682,.945274,.0695946,0,.124555,.936955,.0672492,0,.136831,.928319,.0647732,0,.149496,.919075,.0620947,0,.162542,.909114,.0591816,0,.175958,.900137,.0563917,0,.189739,.891069,.0535392,0,.203877,.882262,.0507642,0,.218368,.873232,.0479793,0,.233208,.864042,.045226,0,.248393,.855002,.0425413,0,.263923,.846569,.0400126,0,.279796,.837714,.0375269,0,.296012,.828918,.0352027,0,.312573,.819783,.0330011,0,.329479,.810129,.0308908,0,.346734,.800866,.0289112,0,.364342,.79093,.0270255,0,.382307,.780593,.0252758,0,.400637,.769511,.0236178,0,.419337,.758558,.0220652,0,.438418,.747632,.0206289,0,.457889,.736146,.0192873,0,.477761,.724093,.0180333,0,.49805,.71234,.0168264,0,.51877,.700201,.015746,0,.53994,.687949,.0147027,0,.561581,.676163,.0137512,0,.583718,.665001,.0128655,0,.60638,.65472,.0120366,0,.629599,.644213,.0112604,0,.653415,.633382,.0105413,0,.677874,.62212,.00986498,0,.70303,.610631,.00923308,0,.728948,.599078,.00864206,0,.755706,.587519,.00811784,0,.783396,.575505,.00761237,0,.812121,.563148,.00713949,0,.841989,.550828,.00668379,0,.873035,.538458,.00627715,0,.904762,.525905,.00588336,0,.936508,.513517,.00552687,0,.968254,.501395,.00519681,0,1,1,.0991506,0,0,1,.0991504,0,0,.999996,.0991515,0,0,.999984,.0991558,0,0,.999947,.0991672,0,114389e-9,.999874,.0991912,0,.00121503,.999739,.0992331,0,.00356108,.999514,.0992983,0,.00705578,.999159,.0993877,0,.011574,.998586,.0994837,0,.017003,.995731,.0988425,0,.0232484,.993384,.098276,0,.0302318,.991615,.0979269,0,.0378884,.989029,.0973432,0,.0461641,.985373,.0963539,0,.0550136,.981278,.0952306,0,.0643988,.975777,.0936233,0,.0742868,.970526,.0920219,0,.0846501,.963755,.0898912,0,.0954644,.956676,.0876064,0,.106709,.948099,.0847751,0,.118367,.939718,.0818638,0,.130423,.931305,.078857,0,.142862,.922342,.0756127,0,.155674,.912842,.0721473,0,.168849,.903304,.0686195,0,.182378,.89411,.0650589,0,.196255,.885512,.0616022,0,.210473,.877193,.0582434,0,.225027,.86877,.0548979,0,.239915,.860267,.0516095,0,.255132,.851915,.048468,0,.270678,.843912,.0454447,0,.286551,.83604,.0425612,0,.302751,.828245,.0398752,0,.31928,.820159,.0373198,0,.336138,.81167,.034916,0,.35333,.802659,.0326402,0,.370858,.793921,.0304901,0,.388728,.784713,.0284857,0,.406944,.774946,.0266186,0,.425515,.76448,.0248593,0,.444449,.753793,.0232114,0,.463756,.743506,.0217039,0,.483447,.732555,.0202841,0,.503535,.720965,.0189648,0,.524036,.709422,.0177189,0,.544968,.697756,.0165626,0,.56635,.685565,.015483,0,.588208,.673987,.0144892,0,.610569,.66244,.0135607,0,.633466,.651675,.0126956,0,.656936,.641598,.0118788,0,.681025,.63121,.0111261,0,.705788,.620514,.010437,0,.731289,.609366,.00978747,0,.757606,.598137,.00917257,0,.784834,.586966,.00859778,0,.813085,.575549,.00806803,0,.842485,.563797,.00757294,0,.87313,.551758,.00710592,0,.904762,.539894,.0066841,0,.936508,.527901,.00627901,0,.968254,.515819,.00590506,0,1,1,.120864,0,0,1,.120864,0,0,.999996,.120864,0,0,.99998,.120867,0,0,.99994,.120872,0,323781e-9,.999852,.120884,0,.00188693,.999693,.120903,0,.00473489,.999426,.120929,0,.00872704,.999002,.120955,0,.0137237,.998235,.120918,0,.0196068,.994608,.119764,0,.0262803,.992997,.119265,0,.0336657,.990968,.11863,0,.0416987,.987002,.117261,0,.0503261,.983524,.116009,0,.0595035,.97875,.114252,0,.0691935,.972652,.11193,0,.0793645,.966613,.109555,0,.0899894,.959275,.106612,0,.101045,.951272,.103375,0,.112512,.942323,.0996594,0,.124372,.933679,.0958841,0,.136611,.924822,.0919265,0,.149216,.915742,.0878061,0,.162176,.906348,.0834894,0,.175482,.896883,.079085,0,.189125,.88774,.0746745,0,.203098,.87986,.0705773,0,.217396,.871998,.0665005,0,.232015,.864325,.0625413,0,.24695,.856685,.0586781,0,.2622,.84925,.0550063,0,.277761,.841719,.0514727,0,.293634,.834755,.0481398,0,.309819,.827853,.0450172,0,.326315,.820888,.0420969,0,.343126,.813616,.0393702,0,.360254,.805767,.0367771,0,.377701,.797338,.0343274,0,.395474,.789122,.0320529,0,.413577,.780601,.0299485,0,.432018,.771424,.0279812,0,.450804,.761502,.0261054,0,.469944,.751166,.0243942,0,.489451,.741276,.0228087,0,.509337,.730898,.0213265,0,.529617,.719878,.0199307,0,.550307,.708379,.0186574,0,.571428,.697165,.0174446,0,.593003,.685554,.0163144,0,.615059,.673631,.015276,0,.637628,.662385,.0143003,0,.660746,.651059,.0134112,0,.68446,.640451,.0125794,0,.70882,.630536,.011793,0,.733893,.620316,.0110547,0,.759756,.609722,.0103668,0,.786505,.598804,.00973009,0,.814259,.587871,.00912812,0,.843157,.577121,.00858916,0,.87334,.566019,.00807333,0,.904762,.554664,.00759687,0,.936508,.543101,.00714759,0,.968254,.531558,.00673418,0,1,1,.146767,0,0,1,.146767,0,0,.999997,.146767,0,0,.999977,.146765,0,320658e-11,.999929,.146762,0,682576e-9,.999823,.146753,0,.00276402,.999633,.146735,0,.00614771,.999314,.146699,0,.0106613,.998796,.14662,0,.0161546,.997124,.146107,0,.0225063,.994062,.144857,0,.0296198,.992154,.144011,0,.037417,.989186,.142712,0,.0458348,.985279,.140926,0,.0548211,.980826,.13885,0,.0643326,.975056,.136168,0,.074333,.969005,.133217,0,.0847917,.961554,.12959,0,.0956828,.954206,.125886,0,.106984,.945046,.121335,0,.118675,.935678,.116492,0,.130741,.926748,.111635,0,.143166,.917764,.106625,0,.155939,.908358,.101325,0,.169049,.899219,.0960249,0,.182487,.890089,.0906527,0,.196245,.881488,.0853905,0,.210317,.874031,.0804177,0,.224697,.866932,.0756005,0,.23938,.859976,.0709019,0,.254364,.853375,.0664391,0,.269646,.846971,.0622012,0,.285223,.840483,.058129,0,.301096,.833969,.0542762,0,.317265,.82806,.0507042,0,.333729,.822128,.047368,0,.350491,.815989,.044272,0,.367554,.809336,.0413444,0,.38492,.802177,.038601,0,.402594,.79441,.0360227,0,.420582,.786573,.0336383,0,.438891,.778619,.0314321,0,.457527,.77,.029362,0,.476499,.760698,.0274102,0,.49582,.750932,.0256146,0,.5155,.740993,.023974,0,.535555,.731159,.0224182,0,.556,.720836,.0209889,0,.576855,.709913,.0196411,0,.598143,.698415,.0183824,0,.619888,.68745,.0172222,0,.642123,.676154,.0161509,0,.664883,.664383,.0151397,0,.688211,.6533,.0141873,0,.71216,.642072,.0133105,0,.736792,.631412,.0124932,0,.762186,.621622,.0117408,0,.788439,.611681,.0110358,0,.815672,.60142,.0103775,0,.844034,.59083,.00975623,0,.873699,.580254,.00918084,0,.904765,.569841,.00864721,0,.936508,.559224,.00815731,0,.968254,.548315,.00767924,0,1,1,.177563,0,0,1,.177563,0,0,.999994,.177562,0,0,.999972,.177555,0,664171e-10,.999914,.177536,0,.0012276,.999787,.177496,0,.00388025,.999556,.17742,0,.00783463,.999165,.177285,0,.0128953,.9985,.177037,0,.0189053,.995388,.175634,0,.025742,.993102,.174375,0,.033309,.990992,.173121,0,.0415298,.986932,.170896,0,.0503425,.982786,.16847,0,.0596964,.977592,.165455,0,.0695498,.971075,.161676,0,.0798676,.963967,.157458,0,.0906201,.956397,.152836,0,.101783,.947489,.147467,0,.113333,.937564,.14145,0,.125254,.928182,.135383,0,.137529,.919027,.129212,0,.150144,.909618,.12276,0,.163088,.900492,.116273,0,.176351,.891671,.1098,0,.189924,.883146,.103362,0,.203799,.875151,.0970799,0,.21797,.868338,.0911732,0,.232433,.862033,.0854966,0,.247182,.856107,.0800691,0,.262216,.850644,.0749618,0,.27753,.845261,.070079,0,.293124,.839885,.0654321,0,.308997,.834609,.0610975,0,.325149,.829083,.0569741,0,.341581,.82404,.0531736,0,.358294,.818968,.049665,0,.37529,.813496,.0463856,0,.392573,.807533,.0433217,0,.410148,.80099,.0404402,0,.428019,.793891,.0377578,0,.446192,.786281,.0352616,0,.464676,.778773,.0329577,0,.483478,.770737,.030808,0,.502608,.762094,.0287964,0,.522079,.752898,.0269254,0,.541905,.743306,.0251926,0,.5621,.733416,.023595,0,.582684,.723742,.0221155,0,.603677,.713542,.0207435,0,.625106,.702755,.019434,0,.646998,.691484,.0182046,0,.66939,.680531,.0170771,0,.692324,.66953,.0160339,0,.715849,.658126,.0150677,0,.740028,.646933,.0141551,0,.764937,.636107,.0133179,0,.790673,.625271,.0125284,0,.817358,.615225,.0117937,0,.84515,.605678,.0111181,0,.874244,.59583,.0104759,0,.904828,.585704,.00986672,0,.936508,.575413,.00929712,0,.968254,.565373,.00876713,0,1,1,.214058,0,0,.999999,.214058,0,0,.999994,.214055,0,0,.999966,.214039,0,259642e-9,.999893,.213998,0,.00200075,.999737,.21391,0,.00527775,.999449,.213745,0,.00983959,.99896,.213458,0,.0154755,.9979,.212855,0,.0220249,.994278,.210779,0,.0293654,.992254,.20926,0,.0374021,.98881,.206908,0,.0460604,.984715,.204009,0,.0552802,.979738,.200471,0,.0650127,.972884,.195813,0,.0752175,.965996,.190856,0,.0858612,.957974,.185077,0,.0969155,.949155,.17868,0,.108356,.939288,.171513,0,.120163,.928996,.163838,0,.132319,.919563,.156246,0,.144808,.910004,.148359,0,.157618,.900791,.140417,0,.170737,.892135,.132569,0,.184155,.883803,.124741,0,.197866,.876034,.117091,0,.211861,.869219,.109835,0,.226134,.863062,.102859,0,.240682,.857795,.0962928,0,.255499,.853009,.0900725,0,.270583,.848603,.0842101,0,.285931,.844335,.0786527,0,.301542,.840208,.0734397,0,.317415,.836035,.0685334,0,.33355,.83172,.0639275,0,.349948,.827135,.0595909,0,.36661,.822797,.0556204,0,.383539,.818387,.0519394,0,.400738,.813565,.0485317,0,.41821,.808142,.0453138,0,.435961,.802212,.0423354,0,.453997,.79573,.0395553,0,.472324,.788741,.036988,0,.490951,.781093,.0345688,0,.509887,.773597,.0323297,0,.529144,.765622,.0302719,0,.548735,.757083,.0283477,0,.568674,.747992,.0265562,0,.588979,.738591,.0248844,0,.609671,.728719,.0233342,0,.630773,.719146,.0219081,0,.652314,.709165,.0205711,0,.674328,.69875,.0193248,0,.696854,.687884,.0181582,0,.719942,.676818,.0170746,0,.743651,.666247,.0160718,0,.768057,.655284,.0151262,0,.793253,.64401,.0142561,0,.819363,.633353,.0134327,0,.846547,.622674,.012653,0,.875017,.612265,.0119354,0,.905021,.602455,.0112533,0,.936508,.593147,.0106234,0,.968254,.583592,.0100213,0,1,1,.25717,0,0,1,.25717,0,0,.999992,.257164,0,0,.999958,.257135,0,641715e-9,.999864,.25706,0,.00305314,.999666,.256897,0,.00700975,.999302,.256596,0,.0122194,.998663,.25607,0,.0184622,.995607,.254123,0,.0255773,.993094,.252081,0,.0334439,.9907,.249867,0,.0419696,.98594,.246118,0,.0510823,.981214,.242049,0,.0607242,.974966,.236869,0,.0708486,.967589,.230724,0,.081417,.95915,.223635,0,.0923974,.950257,.21596,0,.103763,.940165,.207296,0,.115491,.929396,.197901,0,.127562,.919288,.188437,0,.13996,.909428,.178762,0,.15267,.900105,.169072,0,.165679,.891418,.159478,0,.178979,.883347,.15002,0,.192558,.875992,.140813,0,.20641,.869466,.13196,0,.220529,.863699,.123501,0,.234907,.858553,.115436,0,.249542,.854379,.107901,0,.264428,.850894,.10088,0,.279564,.847632,.0942296,0,.294947,.844571,.0879861,0,.310575,.84163,.0821534,0,.326448,.838542,.0766409,0,.342566,.835412,.0715322,0,.358929,.831899,.0666883,0,.37554,.828177,.0622175,0,.392399,.82416,.0580452,0,.409511,.820393,.054267,0,.426878,.816068,.0507172,0,.444506,.811201,.0474041,0,.4624,.805785,.0443174,0,.480566,.799878,.0414562,0,.499013,.793469,.0388147,0,.517749,.786473,.0363453,0,.536785,.778874,.0340225,0,.556134,.771277,.0318599,0,.575809,.763426,.0298859,0,.595827,.755044,.0280357,0,.616207,.746161,.0262979,0,.636973,.737124,.0247295,0,.65815,.72761,.0232514,0,.679772,.717822,.0218755,0,.701876,.708279,.0205942,0,.724509,.698333,.0193947,0,.74773,.68802,.0182717,0,.771609,.677321,.0172044,0,.79624,.666504,.0162122,0,.821743,.656184,.0152924,0,.84828,.64556,.0144326,0,.876069,.634636,.0136157,0,.905404,.624124,.0128612,0,.936508,.613914,.0121435,0,.968254,.603589,.0114887,0,1,1,.307946,0,0,.999999,.307945,0,0,.999988,.307934,0,204479e-10,.999944,.307886,0,.00127833,.999824,.307756,0,.00445047,.999565,.30748,0,.00914673,.999085,.306966,0,.0150498,.998103,.306004,0,.0219367,.994249,.303028,0,.0296485,.991807,.300435,0,.038068,.987773,.296554,0,.0471062,.982673,.2916,0,.0566942,.976623,.285641,0,.0667768,.968757,.27815,0,.0773099,.959849,.269529,0,.088257,.950663,.260248,0,.0995879,.940129,.249704,0,.111277,.92895,.238291,0,.123304,.917996,.226501,0,.13565,.907813,.214669,0,.148299,.898305,.202835,0,.161237,.889626,.191158,0,.174455,.88175,.179695,0,.187941,.874715,.168548,0,.201687,.868746,.15792,0,.215687,.863703,.147807,0,.229933,.859315,.138149,0,.24442,.855538,.128993,0,.259145,.852428,.120414,0,.274103,.850168,.112498,0,.289293,.848132,.105054,0,.304711,.846291,.0981087,0,.320357,.844431,.0915942,0,.33623,.842493,.0855056,0,.35233,.840368,.0798204,0,.368658,.83798,.0745097,0,.385214,.83523,.0695424,0,.402002,.832091,.0649092,0,.419023,.828667,.0606291,0,.436282,.824805,.0566523,0,.453782,.820988,.0530229,0,.471529,.816635,.0496364,0,.489528,.811725,.0464658,0,.507788,.806316,.0435082,0,.526317,.800469,.0407873,0,.545124,.794107,.038255,0,.564221,.787218,.0358825,0,.583621,.779872,.0336785,0,.603341,.772097,.0316379,0,.623397,.764484,.0297379,0,.643812,.756428,.0279581,0,.664611,.748022,.0263153,0,.685824,.739268,.0247799,0,.707488,.73024,.0233385,0,.729646,.720893,.0220035,0,.752354,.71119,.0207555,0,.77568,.701791,.0195843,0,.799715,.692184,.0184891,0,.824574,.682258,.0174541,0,.850417,.67206,.0164873,0,.877466,.661717,.0155959,0,.90604,.651462,.0147519,0,.936528,.641467,.0139727,0,.968254,.631229,.0132363,0,1,1,.367573,0,0,.999999,.367571,0,0,.999984,.367553,0,183382e-9,.999925,.367473,0,.00225254,.999759,.367259,0,.00628165,.99941,.366801,0,.0117858,.998739,.365946,0,.0184359,.995529,.363191,0,.0260114,.992875,.360171,0,.0343581,.989135,.355981,0,.0433637,.984166,.350401,0,.0529438,.977871,.343348,0,.0630334,.96951,.334341,0,.0735805,.959964,.323862,0,.0845437,.950162,.312521,0,.095889,.938882,.299577,0,.107588,.926992,.285573,0,.119617,.915589,.271212,0,.131957,.904791,.256611,0,.144591,.895177,.242224,0,.157503,.886403,.227952,0,.170682,.878957,.214192,0,.184117,.872418,.200795,0,.197799,.867029,.188015,0,.21172,.862835,.175975,0,.225873,.859411,.164526,0,.240253,.856655,.153693,0,.254854,.854519,.14352,0,.269673,.852828,.13397,0,.284707,.851412,.124984,0,.299953,.850609,.116748,0,.315408,.849855,.10905,0,.331073,.849017,.101839,0,.346946,.848079,.0951359,0,.363028,.846911,.0888774,0,.379318,.845445,.0830375,0,.395818,.84362,.0775844,0,.41253,.841411,.0725054,0,.429457,.838768,.0677691,0,.446602,.835801,.0634016,0,.463968,.832341,.0593095,0,.481561,.828424,.0555121,0,.499386,.824312,.052024,0,.51745,.819918,.0487865,0,.535761,.815072,.0457801,0,.554328,.809863,.0430184,0,.573162,.804164,.0404245,0,.592275,.798034,.0380146,0,.611681,.791436,.0357436,0,.631398,.784498,.0336475,0,.651445,.777125,.0316666,0,.671845,.769365,.0298122,0,.692628,.761579,.0281001,0,.713827,.753746,.0265049,0,.735484,.745573,.0250067,0,.75765,.737083,.0236026,0,.78039,.728545,.0223302,0,.803789,.719691,.0211243,0,.82796,.710569,.0199983,0,.853056,.701216,.0189569,0,.879298,.692094,.0179702,0,.907014,.682909,.0170418,0,.936691,.673509,.0161732,0,.968254,.663863,.0153406,0,1,1,.437395,0,0,.999998,.437394,0,0,.99998,.437363,0,616704e-9,.999891,.437232,0,.00367925,.999656,.436877,0,.00867446,.999148,.436121,0,.0150679,.997959,.434564,0,.022531,.993464,.430134,0,.0308507,.990606,.426077,0,.0398805,.985027,.419397,0,.0495148,.978491,.41118,0,.0596749,.969643,.40048,0,.0703001,.959189,.38769,0,.0813427,.948223,.373575,0,.0927641,.935955,.357622,0,.104533,.923237,.34043,0,.116624,.911074,.322735,0,.129015,.899724,.30479,0,.141687,.890189,.287392,0,.154626,.881796,.270248,0,.167818,.874781,.253659,0,.181252,.869166,.237786,0,.194918,.864725,.222618,0,.208807,.861565,.208356,0,.222913,.859284,.194867,0,.237229,.857677,.18212,0,.25175,.856714,.17018,0,.266473,.856155,.158969,0,.281392,.8558,.148413,0,.296505,.855672,.138578,0,.311811,.855538,.129345,0,.327306,.855689,.120861,0,.342991,.855767,.112969,0,.358864,.855618,.105593,0,.374925,.85525,.0987451,0,.391176,.854583,.0923727,0,.407616,.853534,.0864143,0,.424249,.852061,.0808338,0,.441076,.850253,.0756771,0,.4581,.848004,.0708612,0,.475324,.845333,.0663784,0,.492754,.842376,.0622631,0,.510394,.838956,.0584112,0,.528251,.835121,.0548328,0,.546331,.830842,.0514838,0,.564644,.826212,.048355,0,.583198,.821522,.0454714,0,.602005,.816551,.0428263,0,.621078,.811211,.0403612,0,.640434,.805479,.038039,0,.660089,.799409,.0358739,0,.680066,.79306,.0338727,0,.70039,.786395,.0319985,0,.721094,.779416,.030241,0,.742215,.77214,.0285951,0,.7638,.764636,.0270747,0,.785912,.756836,.0256354,0,.808628,.749315,.0243027,0,.832055,.741561,.0230497,0,.856338,.733589,.0218801,0,.88169,.725479,.020784,0,.908441,.717255,.0197702,0,.937125,.708829,.0188168,0,.968254,.700191,.0179113,0,1,1,.518937,0,0,.999998,.518933,0,0,.999967,.518883,0,.00147741,.999832,.51866,0,.00573221,.999466,.518057,0,.011826,.998644,.516752,0,.0192116,.994458,.512347,0,.027573,.991223,.507675,0,.0367099,.985515,.500188,0,.046487,.978308,.490408,0,.0568071,.968359,.477357,0,.0675984,.95682,.461752,0,.0788059,.943929,.443796,0,.090386,.930224,.423893,0,.102304,.916514,.402682,0,.114532,.903653,.380914,0,.127047,.892315,.359212,0,.139828,.882942,.338102,0,.152861,.875438,.31773,0,.16613,.869642,.298186,0,.179624,.865304,.279491,0,.193332,.862382,.261804,0,.207247,.860666,.245146,0,.22136,.859788,.229406,0,.235666,.859608,.214605,0,.250158,.859912,.200691,0,.264832,.86053,.187623,0,.279684,.861368,.17539,0,.294711,.862237,.163901,0,.309911,.863127,.153175,0,.32528,.863923,.143147,0,.340819,.864567,.133781,0,.356524,.865013,.125042,0,.372397,.86539,.116952,0,.388438,.865591,.109476,0,.404645,.865517,.102542,0,.421022,.865084,.0960688,0,.437569,.864309,.0900499,0,.454287,.863151,.0844328,0,.471181,.861649,.0792218,0,.488253,.859742,.0743482,0,.505507,.857446,.0697963,0,.522947,.854757,.0655364,0,.54058,.851783,.061608,0,.558412,.848516,.0579701,0,.576449,.844897,.0545742,0,.594701,.840956,.0514167,0,.613178,.836676,.0484598,0,.631892,.832075,.0456934,0,.650856,.827191,.0431178,0,.670088,.822295,.0407718,0,.689606,.817294,.0386032,0,.709434,.812013,.0365675,0,.7296,.806465,.0346547,0,.750138,.800691,.0328717,0,.771093,.794709,.031211,0,.792519,.788493,.0296504,0,.814488,.782049,.0281782,0,.837097,.775403,.0267965,0,.860481,.76857,.0255002,0,.884842,.761536,.0242759,0,.910494,.754303,.0231142,0,.937985,.74692,.0220305,0,.968254,.739745,.0210192,0,1,1,.613914,0,0,.999996,.613907,0,963597e-10,.999942,.613814,0,.00301247,.999704,.613407,0,.00870385,.999046,.612302,0,.0160714,.995516,.608266,0,.0245899,.991726,.602863,0,.0339681,.985157,.593956,0,.0440254,.97642,.581748,0,.0546409,.964404,.565183,0,.0657284,.950601,.545273,0,.0772246,.935158,.522129,0,.0890812,.919364,.496782,0,.10126,.904754,.470571,0,.113731,.89176,.444037,0,.126469,.881492,.418322,0,.139454,.873656,.393522,0,.15267,.868053,.369795,0,.166101,.864336,.347171,0,.179736,.862259,.325737,0,.193565,.861556,.305532,0,.207578,.861776,.286416,0,.221769,.862661,.268355,0,.23613,.864015,.251334,0,.250656,.865711,.235352,0,.265343,.867519,.220302,0,.280187,.869351,.206161,0,.295183,.871144,.192908,0,.31033,.872839,.180505,0,.325624,.874307,.168848,0,.341065,.875667,.158021,0,.35665,.876758,.147877,0,.37238,.87764,.138441,0,.388253,.878237,.129627,0,.404269,.878563,.121415,0,.42043,.878572,.113741,0,.436735,.87842,.106652,0,.453187,.878057,.100097,0,.469786,.877413,.0940128,0,.486536,.87646,.0883462,0,.503439,.875233,.0830924,0,.520498,.8737,.0781975,0,.537717,.871873,.07364,0,.555102,.86978,.0694103,0,.572657,.867405,.0654696,0,.59039,.864751,.0617914,0,.608307,.861818,.0583491,0,.626419,.858645,.0551443,0,.644733,.855307,.0521894,0,.663264,.851736,.0494334,0,.682025,.847927,.0468504,0,.701032,.843888,.0444261,0,.720308,.839629,.0421497,0,.739875,.835158,.0400082,0,.759764,.830509,.0380076,0,.780014,.825714,.0361488,0,.800673,.820729,.0343956,0,.821803,.815751,.0327781,0,.843492,.810752,.031275,0,.86586,.805587,.0298542,0,.889087,.800317,.0285397,0,.913466,.79489,.0272948,0,.93952,.789314,.0261139,0,.96835,.783593,.0249938,0,1,1,.724258,0,0,.999992,.724243,0,726889e-9,.99987,.724044,0,.00569574,.999336,.72317,0,.0131702,.996271,.719432,0,.0220738,.991159,.712576,0,.0319405,.982465,.700927,0,.0425202,.97049,.684297,0,.0536599,.953973,.661244,0,.065258,.935546,.633804,0,.0772427,.916596,.603071,0,.0895616,.899353,.57105,0,.102175,.885216,.539206,0,.11505,.875076,.508714,0,.128164,.868334,.479571,0,.141495,.864414,.451796,0,.155026,.862678,.425328,0,.168745,.862835,.400352,0,.182639,.864067,.376532,0,.196699,.866086,.35391,0,.210915,.868557,.332424,0,.225282,.871271,.312053,0,.239792,.874058,.292764,0,.25444,.8768,.27453,0,.269223,.87939,.257297,0,.284135,.8819,.24114,0,.299174,.884187,.225934,0,.314337,.886262,.211669,0,.329622,.888119,.198311,0,.345026,.889709,.185783,0,.360549,.891054,.174063,0,.376189,.892196,.163143,0,.391946,.893101,.152952,0,.407819,.893803,.143475,0,.423808,.894277,.134647,0,.439914,.894532,.126434,0,.456137,.894576,.1188,0,.472479,.894393,.111694,0,.48894,.893976,.105069,0,.505523,.893346,.0989077,0,.52223,.892502,.0931724,0,.539064,.891441,.0878276,0,.556028,.890276,.082903,0,.573125,.888972,.0783505,0,.590361,.887469,.0741083,0,.607741,.885785,.0701633,0,.62527,.883914,.0664835,0,.642957,.881872,.0630567,0,.660809,.879651,.0598527,0,.678836,.877267,.0568615,0,.69705,.874717,.05406,0,.715465,.872012,.0514378,0,.734098,.869157,.0489805,0,.752968,.866155,.0466727,0,.772101,.863014,.0445056,0,.791529,.859748,.0424733,0,.81129,.856416,.0405957,0,.831438,.852958,.0388273,0,.852044,.849382,.0371619,0,.87321,.845694,.0355959,0,.89509,.841893,.0341155,0,.917932,.837981,.0327141,0,.942204,.833963,.0313856,0,.968981,.829847,.0301275,0,1,1,.85214,0,0,.999969,.852095,0,.00279627,.999483,.851408,0,.0107635,.994545,.84579,0,.0206454,.986188,.835231,0,.0315756,.969847,.814687,0,.0432021,.945951,.783735,0,.0553396,.91917,.746074,0,.0678766,.895488,.706938,0,.0807395,.878232,.669534,0,.0938767,.868252,.635168,0,.10725,.863873,.603069,0,.120832,.863369,.572514,0,.134598,.86545,.543169,0,.148533,.868803,.514578,0,.16262,.872794,.486762,0,.176849,.87702,.459811,0,.19121,.881054,.433654,0,.205694,.884974,.408574,0,.220294,.888587,.384525,0,.235005,.891877,.36156,0,.24982,.894793,.339661,0,.264737,.89743,.318913,0,.279751,.899796,.299302,0,.294859,.901943,.280843,0,.310058,.903858,.263481,0,.325346,.905574,.247197,0,.340721,.907069,.231915,0,.356181,.908379,.217614,0,.371725,.90952,.20425,0,.387353,.910483,.191758,0,.403063,.91128,.180092,0,.418854,.911936,.169222,0,.434727,.912454,.159098,0,.450682,.912835,.149668,0,.466718,.913078,.140884,0,.482837,.913192,.132709,0,.499038,.913175,.125095,0,.515324,.91304,.118012,0,.531695,.912781,.111417,0,.548153,.91241,.105281,0,.5647,.911924,.0995691,0,.581338,.911331,.0942531,0,.59807,.910637,.0893076,0,.6149,.90984,.0846998,0,.63183,.908941,.0804044,0,.648865,.907944,.0763984,0,.666011,.906857,.0726638,0,.683273,.90568,.0691783,0,.700659,.904416,.0659222,0,.718176,.903067,.0628782,0,.735834,.901637,.0600307,0,.753646,.900128,.0573647,0,.771625,.898544,.0548668,0,.78979,.89689,.052527,0,.808162,.895165,.0503306,0,.826771,.893371,.0482668,0,.845654,.891572,.0463605,0,.864863,.889763,.0445998,0,.884472,.887894,.0429451,0,.904592,.885967,.0413884,0,.925407,.883984,.0399225,0,.947271,.881945,.0385405,0,.97105,.879854,.0372362,0,1,.999804,.995833,0,0,.938155,.933611,0,.0158731,.864755,.854311,0,.0317461,.888594,.865264,0,.0476191,.905575,.863922,0,.0634921,.915125,.850558,0,.0793651,.920665,.829254,0,.0952381,.924073,.802578,0,.111111,.926304,.772211,0,.126984,.927829,.739366,0,.142857,.928924,.705033,0,.15873,.92973,.670019,0,.174603,.930339,.634993,0,.190476,.930811,.600485,0,.206349,.931191,.566897,0,.222222,.93149,.534485,0,.238095,.931737,.503429,0,.253968,.931939,.473811,0,.269841,.932108,.445668,0,.285714,.93225,.418993,0,.301587,.932371,.393762,0,.31746,.932474,.369939,0,.333333,.932562,.347479,0,.349206,.932638,.326336,0,.365079,.932703,.306462,0,.380952,.93276,.287805,0,.396825,.932809,.270313,0,.412698,.932851,.253933,0,.428571,.932887,.23861,0,.444444,.932917,.224289,0,.460317,.932943,.210917,0,.47619,.932965,.19844,0,.492063,.932982,.186807,0,.507937,.932995,.175966,0,.52381,.933005,.165869,0,.539683,.933011,.156468,0,.555556,.933013,.147719,0,.571429,.933013,.139579,0,.587302,.93301,.132007,0,.603175,.933004,.124965,0,.619048,.932994,.118416,0,.634921,.932982,.112326,0,.650794,.932968,.106663,0,.666667,.93295,.101397,0,.68254,.932931,.0964993,0,.698413,.932908,.0919438,0,.714286,.932883,.0877057,0,.730159,.932856,.0837623,0,.746032,.932827,.0800921,0,.761905,.932796,.0766754,0,.777778,.932762,.0734936,0,.793651,.932727,.0705296,0,.809524,.932689,.0677676,0,.825397,.93265,.0651929,0,.84127,.932609,.0627917,0,.857143,.932565,.0605515,0,.873016,.932521,.0584606,0,.888889,.932474,.0565082,0,.904762,.932427,.0546841,0,.920635,.932377,.0529793,0,.936508,.932326,.0513851,0,.952381,.932274,.0498936,0,.968254,.93222,.0484975,0,.984127,.932164,.0471899,0,1],rr=new Float32Array(er),nr=new Float32Array(tr),sr=new DataTexture(rr,64,64,RGBAFormat,FloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1),ar=new DataTexture(nr,64,64,RGBAFormat,FloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1);sr.needsUpdate=!0,ar.needsUpdate=!0;const or=new Uint16Array(er.length);er.forEach(function(fr,ur){or[ur]=DataUtils.toHalfFloat(fr)});const lr=new Uint16Array(tr.length);tr.forEach(function(fr,ur){lr[ur]=DataUtils.toHalfFloat(fr)});const cr=new DataTexture(or,64,64,RGBAFormat,HalfFloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1),hr=new DataTexture(lr,64,64,RGBAFormat,HalfFloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1);return cr.needsUpdate=!0,hr.needsUpdate=!0,this.LTC_HALF_1=cr,this.LTC_HALF_2=hr,this.LTC_FLOAT_1=sr,this.LTC_FLOAT_2=ar,this}}RectAreaLightTexturesLib.LTC_HALF_1=null;RectAreaLightTexturesLib.LTC_HALF_1=null;RectAreaLightTexturesLib.LTC_FLOAT_1=null;RectAreaLightTexturesLib.LTC_FLOAT_2=null;class RectAreaLightUniformsLib{static init(){RectAreaLightTexturesLib.init();const{LTC_FLOAT_1:er,LTC_FLOAT_2:tr,LTC_HALF_1:rr,LTC_HALF_2:nr}=RectAreaLightTexturesLib;UniformsLib.LTC_FLOAT_1=er,UniformsLib.LTC_FLOAT_2=tr,UniformsLib.LTC_HALF_1=rr,UniformsLib.LTC_HALF_2=nr}}const _box$1=new Box3,_vector$2=new Vector3$1;class LineSegmentsGeometry extends InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const er=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],tr=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],rr=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(rr),this.setAttribute("position",new Float32BufferAttribute(er,3)),this.setAttribute("uv",new Float32BufferAttribute(tr,2))}applyMatrix4(er){const tr=this.attributes.instanceStart,rr=this.attributes.instanceEnd;return tr!==void 0&&(tr.applyMatrix4(er),rr.applyMatrix4(er),tr.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(er){let tr;er instanceof Float32Array?tr=er:Array.isArray(er)&&(tr=new Float32Array(er));const rr=new InstancedInterleavedBuffer(tr,6,1);return this.setAttribute("instanceStart",new InterleavedBufferAttribute(rr,3,0)),this.setAttribute("instanceEnd",new InterleavedBufferAttribute(rr,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(er){let tr;er instanceof Float32Array?tr=er:Array.isArray(er)&&(tr=new Float32Array(er));const rr=new InstancedInterleavedBuffer(tr,6,1);return this.setAttribute("instanceColorStart",new InterleavedBufferAttribute(rr,3,0)),this.setAttribute("instanceColorEnd",new InterleavedBufferAttribute(rr,3,3)),this}fromWireframeGeometry(er){return this.setPositions(er.attributes.position.array),this}fromEdgesGeometry(er){return this.setPositions(er.attributes.position.array),this}fromMesh(er){return this.fromWireframeGeometry(new WireframeGeometry(er.geometry)),this}fromLineSegments(er){const tr=er.geometry;return this.setPositions(tr.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const er=this.attributes.instanceStart,tr=this.attributes.instanceEnd;er!==void 0&&tr!==void 0&&(this.boundingBox.setFromBufferAttribute(er),_box$1.setFromBufferAttribute(tr),this.boundingBox.union(_box$1))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingBox===null&&this.computeBoundingBox();const er=this.attributes.instanceStart,tr=this.attributes.instanceEnd;if(er!==void 0&&tr!==void 0){const rr=this.boundingSphere.center;this.boundingBox.getCenter(rr);let nr=0;for(let sr=0,ar=er.count;sr<ar;sr++)_vector$2.fromBufferAttribute(er,sr),nr=Math.max(nr,rr.distanceToSquared(_vector$2)),_vector$2.fromBufferAttribute(tr,sr),nr=Math.max(nr,rr.distanceToSquared(_vector$2));this.boundingSphere.radius=Math.sqrt(nr),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(er){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(er)}}UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ShaderLib.line={uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class LineMaterial extends ShaderMaterial{constructor(er){super({type:"LineMaterial",uniforms:UniformsUtils.clone(ShaderLib.line.uniforms),vertexShader:ShaderLib.line.vertexShader,fragmentShader:ShaderLib.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(er)}get color(){return this.uniforms.diffuse.value}set color(er){this.uniforms.diffuse.value=er}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(er){er===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(er){this.uniforms.linewidth&&(this.uniforms.linewidth.value=er)}get dashed(){return"USE_DASH"in this.defines}set dashed(er){er===!0!==this.dashed&&(this.needsUpdate=!0),er===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(er){this.uniforms.dashScale.value=er}get dashSize(){return this.uniforms.dashSize.value}set dashSize(er){this.uniforms.dashSize.value=er}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(er){this.uniforms.dashOffset.value=er}get gapSize(){return this.uniforms.gapSize.value}set gapSize(er){this.uniforms.gapSize.value=er}get opacity(){return this.uniforms.opacity.value}set opacity(er){this.uniforms&&(this.uniforms.opacity.value=er)}get resolution(){return this.uniforms.resolution.value}set resolution(er){this.uniforms.resolution.value.copy(er)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(er){this.defines&&(er===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),er===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const _viewport$1=new Vector4,_start$1=new Vector3$1,_end$1=new Vector3$1,_start4=new Vector4,_end4=new Vector4,_ssOrigin=new Vector4,_ssOrigin3=new Vector3$1,_mvMatrix=new Matrix4,_line=new Line3,_closestPoint=new Vector3$1,_box=new Box3,_sphere$1=new Sphere,_clipToWorldVector=new Vector4;let _ray$1,_lineWidth;function getWorldSpaceHalfWidth(ir,er,tr){return _clipToWorldVector.set(0,0,-er,1).applyMatrix4(ir.projectionMatrix),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),_clipToWorldVector.x=_lineWidth/tr.width,_clipToWorldVector.y=_lineWidth/tr.height,_clipToWorldVector.applyMatrix4(ir.projectionMatrixInverse),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),Math.abs(Math.max(_clipToWorldVector.x,_clipToWorldVector.y))}function raycastWorldUnits(ir,er){const tr=ir.matrixWorld,rr=ir.geometry,nr=rr.attributes.instanceStart,sr=rr.attributes.instanceEnd,ar=Math.min(rr.instanceCount,nr.count);for(let or=0,lr=ar;or<lr;or++){_line.start.fromBufferAttribute(nr,or),_line.end.fromBufferAttribute(sr,or),_line.applyMatrix4(tr);const cr=new Vector3$1,hr=new Vector3$1;_ray$1.distanceSqToSegment(_line.start,_line.end,hr,cr),hr.distanceTo(cr)<_lineWidth*.5&&er.push({point:hr,pointOnLine:cr,distance:_ray$1.origin.distanceTo(hr),object:ir,face:null,faceIndex:or,uv:null,uv1:null})}}function raycastScreenSpace(ir,er,tr){const rr=er.projectionMatrix,sr=ir.material.resolution,ar=ir.matrixWorld,or=ir.geometry,lr=or.attributes.instanceStart,cr=or.attributes.instanceEnd,hr=Math.min(or.instanceCount,lr.count),fr=-er.near;_ray$1.at(1,_ssOrigin),_ssOrigin.w=1,_ssOrigin.applyMatrix4(er.matrixWorldInverse),_ssOrigin.applyMatrix4(rr),_ssOrigin.multiplyScalar(1/_ssOrigin.w),_ssOrigin.x*=sr.x/2,_ssOrigin.y*=sr.y/2,_ssOrigin.z=0,_ssOrigin3.copy(_ssOrigin),_mvMatrix.multiplyMatrices(er.matrixWorldInverse,ar);for(let ur=0,pr=hr;ur<pr;ur++){if(_start4.fromBufferAttribute(lr,ur),_end4.fromBufferAttribute(cr,ur),_start4.w=1,_end4.w=1,_start4.applyMatrix4(_mvMatrix),_end4.applyMatrix4(_mvMatrix),_start4.z>fr&&_end4.z>fr)continue;if(_start4.z>fr){const Ar=_start4.z-_end4.z,yr=(_start4.z-fr)/Ar;_start4.lerp(_end4,yr)}else if(_end4.z>fr){const Ar=_end4.z-_start4.z,yr=(_end4.z-fr)/Ar;_end4.lerp(_start4,yr)}_start4.applyMatrix4(rr),_end4.applyMatrix4(rr),_start4.multiplyScalar(1/_start4.w),_end4.multiplyScalar(1/_end4.w),_start4.x*=sr.x/2,_start4.y*=sr.y/2,_end4.x*=sr.x/2,_end4.y*=sr.y/2,_line.start.copy(_start4),_line.start.z=0,_line.end.copy(_end4),_line.end.z=0;const _r=_line.closestPointToPointParameter(_ssOrigin3,!0);_line.at(_r,_closestPoint);const mr=MathUtils.lerp(_start4.z,_end4.z,_r),dr=mr>=-1&&mr<=1,vr=_ssOrigin3.distanceTo(_closestPoint)<_lineWidth*.5;if(dr&&vr){_line.start.fromBufferAttribute(lr,ur),_line.end.fromBufferAttribute(cr,ur),_line.start.applyMatrix4(ar),_line.end.applyMatrix4(ar);const Ar=new Vector3$1,yr=new Vector3$1;_ray$1.distanceSqToSegment(_line.start,_line.end,yr,Ar),tr.push({point:yr,pointOnLine:Ar,distance:_ray$1.origin.distanceTo(yr),object:ir,face:null,faceIndex:ur,uv:null,uv1:null})}}}class LineSegments2 extends Mesh{constructor(er=new LineSegmentsGeometry,tr=new LineMaterial({color:Math.random()*16777215})){super(er,tr),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const er=this.geometry,tr=er.attributes.instanceStart,rr=er.attributes.instanceEnd,nr=new Float32Array(2*tr.count);for(let ar=0,or=0,lr=tr.count;ar<lr;ar++,or+=2)_start$1.fromBufferAttribute(tr,ar),_end$1.fromBufferAttribute(rr,ar),nr[or]=or===0?0:nr[or-1],nr[or+1]=nr[or]+_start$1.distanceTo(_end$1);const sr=new InstancedInterleavedBuffer(nr,2,1);return er.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(sr,1,0)),er.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(sr,1,1)),this}raycast(er,tr){const rr=this.material.worldUnits,nr=er.camera;nr===null&&!rr&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const sr=er.params.Line2!==void 0&&er.params.Line2.threshold||0;_ray$1=er.ray;const ar=this.matrixWorld,or=this.geometry,lr=this.material;_lineWidth=lr.linewidth+sr,or.boundingSphere===null&&or.computeBoundingSphere(),_sphere$1.copy(or.boundingSphere).applyMatrix4(ar);let cr;if(rr)cr=_lineWidth*.5;else{const fr=Math.max(nr.near,_sphere$1.distanceToPoint(_ray$1.origin));cr=getWorldSpaceHalfWidth(nr,fr,lr.resolution)}if(_sphere$1.radius+=cr,_ray$1.intersectsSphere(_sphere$1)===!1)return;or.boundingBox===null&&or.computeBoundingBox(),_box.copy(or.boundingBox).applyMatrix4(ar);let hr;if(rr)hr=_lineWidth*.5;else{const fr=Math.max(nr.near,_box.distanceToPoint(_ray$1.origin));hr=getWorldSpaceHalfWidth(nr,fr,lr.resolution)}_box.expandByScalar(hr),_ray$1.intersectsBox(_box)!==!1&&(rr?raycastWorldUnits(this,tr):raycastScreenSpace(this,nr,tr))}onBeforeRender(er){const tr=this.material.uniforms;tr&&tr.resolution&&(er.getViewport(_viewport$1),this.material.uniforms.resolution.value.set(_viewport$1.z,_viewport$1.w))}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(er){const tr=er.length-3,rr=new Float32Array(2*tr);for(let nr=0;nr<tr;nr+=3)rr[2*nr]=er[nr],rr[2*nr+1]=er[nr+1],rr[2*nr+2]=er[nr+2],rr[2*nr+3]=er[nr+3],rr[2*nr+4]=er[nr+4],rr[2*nr+5]=er[nr+5];return super.setPositions(rr),this}setColors(er){const tr=er.length-3,rr=new Float32Array(2*tr);for(let nr=0;nr<tr;nr+=3)rr[2*nr]=er[nr],rr[2*nr+1]=er[nr+1],rr[2*nr+2]=er[nr+2],rr[2*nr+3]=er[nr+3],rr[2*nr+4]=er[nr+4],rr[2*nr+5]=er[nr+5];return super.setColors(rr),this}setFromPoints(er){const tr=er.length-1,rr=new Float32Array(6*tr);for(let nr=0;nr<tr;nr++)rr[6*nr]=er[nr].x,rr[6*nr+1]=er[nr].y,rr[6*nr+2]=er[nr].z||0,rr[6*nr+3]=er[nr+1].x,rr[6*nr+4]=er[nr+1].y,rr[6*nr+5]=er[nr+1].z||0;return super.setPositions(rr),this}fromLine(er){const tr=er.geometry;return this.setPositions(tr.attributes.position.array),this}}class Line2 extends LineSegments2{constructor(er=new LineGeometry,tr=new LineMaterial({color:Math.random()*16777215})){super(er,tr),this.isLine2=!0,this.type="Line2"}}const _start=new Vector3$1,_end=new Vector3$1,_viewport=new Vector4;class Wireframe extends Mesh{constructor(er=new LineSegmentsGeometry,tr=new LineMaterial({color:Math.random()*16777215})){super(er,tr),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const er=this.geometry,tr=er.attributes.instanceStart,rr=er.attributes.instanceEnd,nr=new Float32Array(2*tr.count);for(let ar=0,or=0,lr=tr.count;ar<lr;ar++,or+=2)_start.fromBufferAttribute(tr,ar),_end.fromBufferAttribute(rr,ar),nr[or]=or===0?0:nr[or-1],nr[or+1]=nr[or]+_start.distanceTo(_end);const sr=new InstancedInterleavedBuffer(nr,2,1);return er.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(sr,1,0)),er.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(sr,1,1)),this}onBeforeRender(er){const tr=this.material.uniforms;tr&&tr.resolution&&(er.getViewport(_viewport),this.material.uniforms.resolution.value.set(_viewport.z,_viewport.w))}}class WireframeGeometry2 extends LineSegmentsGeometry{constructor(er){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new WireframeGeometry(er))}}class EXRLoader extends DataTextureLoader{constructor(er){super(er),this.type=HalfFloatType}parse(er){const Cr=Math.pow(2.7182818,2.2);function Ir(Gi,cs){let xs=0;for(let ds=0;ds<65536;++ds)(ds==0||Gi[ds>>3]&1<<(ds&7))&&(cs[xs++]=ds);const $i=xs-1;for(;xs<65536;)cs[xs++]=0;return $i}function Rr(Gi){for(let cs=0;cs<16384;cs++)Gi[cs]={},Gi[cs].len=0,Gi[cs].lit=0,Gi[cs].p=null}const Pr={l:0,c:0,lc:0};function Fr(Gi,cs,xs,$i,ds){for(;xs<Gi;)cs=cs<<8|Ns($i,ds),xs+=8;xs-=Gi,Pr.l=cs>>xs&(1<<Gi)-1,Pr.c=cs,Pr.lc=xs}const Nr=new Array(59);function Ur(Gi){for(let xs=0;xs<=58;++xs)Nr[xs]=0;for(let xs=0;xs<65537;++xs)Nr[Gi[xs]]+=1;let cs=0;for(let xs=58;xs>0;--xs){const $i=cs+Nr[xs]>>1;Nr[xs]=cs,cs=$i}for(let xs=0;xs<65537;++xs){const $i=Gi[xs];$i>0&&(Gi[xs]=$i|Nr[$i]++<<6)}}function Br(Gi,cs,xs,$i,ds,ps){const ws=cs;let ys=0,Es=0;for(;$i<=ds;$i++){if(ws.value-cs.value>xs)return!1;Fr(6,ys,Es,Gi,ws);const Ts=Pr.l;if(ys=Pr.c,Es=Pr.lc,ps[$i]=Ts,Ts==63){if(ws.value-cs.value>xs)throw new Error("Something wrong with hufUnpackEncTable");Fr(8,ys,Es,Gi,ws);let Rs=Pr.l+6;if(ys=Pr.c,Es=Pr.lc,$i+Rs>ds+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Rs--;)ps[$i++]=0;$i--}else if(Ts>=59){let Rs=Ts-59+2;if($i+Rs>ds+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Rs--;)ps[$i++]=0;$i--}}Ur(ps)}function Or(Gi){return Gi&63}function Dr(Gi){return Gi>>6}function Wr(Gi,cs,xs,$i){for(;cs<=xs;cs++){const ds=Dr(Gi[cs]),ps=Or(Gi[cs]);if(ds>>ps)throw new Error("Invalid table entry");if(ps>14){const ws=$i[ds>>ps-14];if(ws.len)throw new Error("Invalid table entry");if(ws.lit++,ws.p){const ys=ws.p;ws.p=new Array(ws.lit);for(let Es=0;Es<ws.lit-1;++Es)ws.p[Es]=ys[Es]}else ws.p=new Array(1);ws.p[ws.lit-1]=cs}else if(ps){let ws=0;for(let ys=1<<14-ps;ys>0;ys--){const Es=$i[(ds<<14-ps)+ws];if(Es.len||Es.p)throw new Error("Invalid table entry");Es.len=ps,Es.lit=cs,ws++}}}return!0}const $r={c:0,lc:0};function Yr(Gi,cs,xs,$i){Gi=Gi<<8|Ns(xs,$i),cs+=8,$r.c=Gi,$r.lc=cs}const Qi={c:0,lc:0};function rs(Gi,cs,xs,$i,ds,ps,ws,ys,Es){if(Gi==cs){$i<8&&(Yr(xs,$i,ds,ps),xs=$r.c,$i=$r.lc),$i-=8;let Ts=xs>>$i;if(Ts=new Uint8Array([Ts])[0],ys.value+Ts>Es)return!1;const Rs=ws[ys.value-1];for(;Ts-- >0;)ws[ys.value++]=Rs}else if(ys.value<Es)ws[ys.value++]=Gi;else return!1;Qi.c=xs,Qi.lc=$i}function Kr(Gi){return Gi&65535}function Qr(Gi){const cs=Kr(Gi);return cs>32767?cs-65536:cs}const Vr={a:0,b:0};function Gr(Gi,cs){const xs=Qr(Gi),ds=Qr(cs),ps=xs+(ds&1)+(ds>>1),ws=ps,ys=ps-ds;Vr.a=ws,Vr.b=ys}function qr(Gi,cs){const xs=Kr(Gi),$i=Kr(cs),ds=xs-($i>>1)&65535,ps=$i+ds-32768&65535;Vr.a=ps,Vr.b=ds}function ji(Gi,cs,xs,$i,ds,ps,ws){const ys=ws<16384,Es=xs>ds?ds:xs;let Ts=1,Rs,Ds;for(;Ts<=Es;)Ts<<=1;for(Ts>>=1,Rs=Ts,Ts>>=1;Ts>=1;){Ds=0;const Us=Ds+ps*(ds-Rs),Os=ps*Ts,Gs=ps*Rs,zs=$i*Ts,Xs=$i*Rs;let na,wa,fa,sa;for(;Ds<=Us;Ds+=Gs){let Ea=Ds;const ca=Ds+$i*(xs-Rs);for(;Ea<=ca;Ea+=Xs){const Da=Ea+zs,Ma=Ea+Os,Pa=Ma+zs;ys?(Gr(Gi[Ea+cs],Gi[Ma+cs]),na=Vr.a,fa=Vr.b,Gr(Gi[Da+cs],Gi[Pa+cs]),wa=Vr.a,sa=Vr.b,Gr(na,wa),Gi[Ea+cs]=Vr.a,Gi[Da+cs]=Vr.b,Gr(fa,sa),Gi[Ma+cs]=Vr.a,Gi[Pa+cs]=Vr.b):(qr(Gi[Ea+cs],Gi[Ma+cs]),na=Vr.a,fa=Vr.b,qr(Gi[Da+cs],Gi[Pa+cs]),wa=Vr.a,sa=Vr.b,qr(na,wa),Gi[Ea+cs]=Vr.a,Gi[Da+cs]=Vr.b,qr(fa,sa),Gi[Ma+cs]=Vr.a,Gi[Pa+cs]=Vr.b)}if(xs&Ts){const Da=Ea+Os;ys?Gr(Gi[Ea+cs],Gi[Da+cs]):qr(Gi[Ea+cs],Gi[Da+cs]),na=Vr.a,Gi[Da+cs]=Vr.b,Gi[Ea+cs]=na}}if(ds&Ts){let Ea=Ds;const ca=Ds+$i*(xs-Rs);for(;Ea<=ca;Ea+=Xs){const Da=Ea+zs;ys?Gr(Gi[Ea+cs],Gi[Da+cs]):qr(Gi[Ea+cs],Gi[Da+cs]),na=Vr.a,Gi[Da+cs]=Vr.b,Gi[Ea+cs]=na}}Rs=Ts,Ts>>=1}return Ds}function Zr(Gi,cs,xs,$i,ds,ps,ws,ys,Es){let Ts=0,Rs=0;const Ds=ws,Us=Math.trunc($i.value+(ds+7)/8);for(;$i.value<Us;)for(Yr(Ts,Rs,xs,$i),Ts=$r.c,Rs=$r.lc;Rs>=14;){const Gs=Ts>>Rs-14&16383,zs=cs[Gs];if(zs.len)Rs-=zs.len,rs(zs.lit,ps,Ts,Rs,xs,$i,ys,Es,Ds),Ts=Qi.c,Rs=Qi.lc;else{if(!zs.p)throw new Error("hufDecode issues");let Xs;for(Xs=0;Xs<zs.lit;Xs++){const na=Or(Gi[zs.p[Xs]]);for(;Rs<na&&$i.value<Us;)Yr(Ts,Rs,xs,$i),Ts=$r.c,Rs=$r.lc;if(Rs>=na&&Dr(Gi[zs.p[Xs]])==(Ts>>Rs-na&(1<<na)-1)){Rs-=na,rs(zs.p[Xs],ps,Ts,Rs,xs,$i,ys,Es,Ds),Ts=Qi.c,Rs=Qi.lc;break}}if(Xs==zs.lit)throw new Error("hufDecode issues")}}const Os=8-ds&7;for(Ts>>=Os,Rs-=Os;Rs>0;){const Gs=cs[Ts<<14-Rs&16383];if(Gs.len)Rs-=Gs.len,rs(Gs.lit,ps,Ts,Rs,xs,$i,ys,Es,Ds),Ts=Qi.c,Rs=Qi.lc;else throw new Error("hufDecode issues")}return!0}function Zi(Gi,cs,xs,$i,ds,ps){const ws={value:0},ys=xs.value,Es=Fs(cs,xs),Ts=Fs(cs,xs);xs.value+=4;const Rs=Fs(cs,xs);if(xs.value+=4,Es<0||Es>=65537||Ts<0||Ts>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Ds=new Array(65537),Us=new Array(16384);Rr(Us);const Os=$i-(xs.value-ys);if(Br(Gi,xs,Os,Es,Ts,Ds),Rs>8*($i-(xs.value-ys)))throw new Error("Something wrong with hufUncompress");Wr(Ds,Es,Ts,Us),Zr(Ds,Us,Gi,xs,Rs,Ts,ps,ds,ws)}function Yi(Gi,cs,xs){for(let $i=0;$i<xs;++$i)cs[$i]=Gi[cs[$i]]}function qi(Gi){for(let cs=1;cs<Gi.length;cs++){const xs=Gi[cs-1]+Gi[cs]-128;Gi[cs]=xs}}function Xr(Gi,cs){let xs=0,$i=Math.floor((Gi.length+1)/2),ds=0;const ps=Gi.length-1;for(;!(ds>ps||(cs[ds++]=Gi[xs++],ds>ps));)cs[ds++]=Gi[$i++]}function ns(Gi){let cs=Gi.byteLength;const xs=new Array;let $i=0;const ds=new DataView(Gi);for(;cs>0;){const ps=ds.getInt8($i++);if(ps<0){const ws=-ps;cs-=ws+1;for(let ys=0;ys<ws;ys++)xs.push(ds.getUint8($i++))}else{const ws=ps;cs-=2;const ys=ds.getUint8($i++);for(let Es=0;Es<ws+1;Es++)xs.push(ys)}}return xs}function os(Gi,cs,xs,$i,ds,ps){let ws=new DataView(ps.buffer);const ys=xs[Gi.idx[0]].width,Es=xs[Gi.idx[0]].height,Ts=3,Rs=Math.floor(ys/8),Ds=Math.ceil(ys/8),Us=Math.ceil(Es/8),Os=ys-(Ds-1)*8,Gs=Es-(Us-1)*8,zs={value:0},Xs=new Array(Ts),na=new Array(Ts),wa=new Array(Ts),fa=new Array(Ts),sa=new Array(Ts);for(let ca=0;ca<Ts;++ca)sa[ca]=cs[Gi.idx[ca]],Xs[ca]=ca<1?0:Xs[ca-1]+Ds*Us,na[ca]=new Float32Array(64),wa[ca]=new Uint16Array(64),fa[ca]=new Uint16Array(Ds*64);for(let ca=0;ca<Us;++ca){let Da=8;ca==Us-1&&(Da=Gs);let Ma=8;for(let Ca=0;Ca<Ds;++Ca){Ca==Ds-1&&(Ma=Os);for(let ya=0;ya<Ts;++ya)wa[ya].fill(0),wa[ya][0]=ds[Xs[ya]++],us(zs,$i,wa[ya]),is(wa[ya],na[ya]),Ji(na[ya]);Ts==3&&ms(na);for(let ya=0;ya<Ts;++ya)Ki(na[ya],fa[ya],Ca*64)}let Pa=0;for(let Ca=0;Ca<Ts;++Ca){const ya=xs[Gi.idx[Ca]].type;for(let Va=8*ca;Va<8*ca+Da;++Va){Pa=sa[Ca][Va];for(let Ha=0;Ha<Rs;++Ha){const Oa=Ha*64+(Va&7)*8;ws.setUint16(Pa+0*2*ya,fa[Ca][Oa+0],!0),ws.setUint16(Pa+1*2*ya,fa[Ca][Oa+1],!0),ws.setUint16(Pa+2*2*ya,fa[Ca][Oa+2],!0),ws.setUint16(Pa+3*2*ya,fa[Ca][Oa+3],!0),ws.setUint16(Pa+4*2*ya,fa[Ca][Oa+4],!0),ws.setUint16(Pa+5*2*ya,fa[Ca][Oa+5],!0),ws.setUint16(Pa+6*2*ya,fa[Ca][Oa+6],!0),ws.setUint16(Pa+7*2*ya,fa[Ca][Oa+7],!0),Pa+=8*2*ya}}if(Rs!=Ds)for(let Va=8*ca;Va<8*ca+Da;++Va){const Ha=sa[Ca][Va]+8*Rs*2*ya,Oa=Rs*64+(Va&7)*8;for(let Ga=0;Ga<Ma;++Ga)ws.setUint16(Ha+Ga*2*ya,fa[Ca][Oa+Ga],!0)}}}const Ea=new Uint16Array(ys);ws=new DataView(ps.buffer);for(let ca=0;ca<Ts;++ca){xs[Gi.idx[ca]].decoded=!0;const Da=xs[Gi.idx[ca]].type;if(xs[ca].type==2)for(let Ma=0;Ma<Es;++Ma){const Pa=sa[ca][Ma];for(let Ca=0;Ca<ys;++Ca)Ea[Ca]=ws.getUint16(Pa+Ca*2*Da,!0);for(let Ca=0;Ca<ys;++Ca)ws.setFloat32(Pa+Ca*2*Da,Ms(Ea[Ca]),!0)}}}function us(Gi,cs,xs){let $i,ds=1;for(;ds<64;)$i=cs[Gi.value],$i==65280?ds=64:$i>>8==255?ds+=$i&255:(xs[ds]=$i,ds++),Gi.value++}function is(Gi,cs){cs[0]=Ms(Gi[0]),cs[1]=Ms(Gi[1]),cs[2]=Ms(Gi[5]),cs[3]=Ms(Gi[6]),cs[4]=Ms(Gi[14]),cs[5]=Ms(Gi[15]),cs[6]=Ms(Gi[27]),cs[7]=Ms(Gi[28]),cs[8]=Ms(Gi[2]),cs[9]=Ms(Gi[4]),cs[10]=Ms(Gi[7]),cs[11]=Ms(Gi[13]),cs[12]=Ms(Gi[16]),cs[13]=Ms(Gi[26]),cs[14]=Ms(Gi[29]),cs[15]=Ms(Gi[42]),cs[16]=Ms(Gi[3]),cs[17]=Ms(Gi[8]),cs[18]=Ms(Gi[12]),cs[19]=Ms(Gi[17]),cs[20]=Ms(Gi[25]),cs[21]=Ms(Gi[30]),cs[22]=Ms(Gi[41]),cs[23]=Ms(Gi[43]),cs[24]=Ms(Gi[9]),cs[25]=Ms(Gi[11]),cs[26]=Ms(Gi[18]),cs[27]=Ms(Gi[24]),cs[28]=Ms(Gi[31]),cs[29]=Ms(Gi[40]),cs[30]=Ms(Gi[44]),cs[31]=Ms(Gi[53]),cs[32]=Ms(Gi[10]),cs[33]=Ms(Gi[19]),cs[34]=Ms(Gi[23]),cs[35]=Ms(Gi[32]),cs[36]=Ms(Gi[39]),cs[37]=Ms(Gi[45]),cs[38]=Ms(Gi[52]),cs[39]=Ms(Gi[54]),cs[40]=Ms(Gi[20]),cs[41]=Ms(Gi[22]),cs[42]=Ms(Gi[33]),cs[43]=Ms(Gi[38]),cs[44]=Ms(Gi[46]),cs[45]=Ms(Gi[51]),cs[46]=Ms(Gi[55]),cs[47]=Ms(Gi[60]),cs[48]=Ms(Gi[21]),cs[49]=Ms(Gi[34]),cs[50]=Ms(Gi[37]),cs[51]=Ms(Gi[47]),cs[52]=Ms(Gi[50]),cs[53]=Ms(Gi[56]),cs[54]=Ms(Gi[59]),cs[55]=Ms(Gi[61]),cs[56]=Ms(Gi[35]),cs[57]=Ms(Gi[36]),cs[58]=Ms(Gi[48]),cs[59]=Ms(Gi[49]),cs[60]=Ms(Gi[57]),cs[61]=Ms(Gi[58]),cs[62]=Ms(Gi[62]),cs[63]=Ms(Gi[63])}function Ji(Gi){const cs=.5*Math.cos(.7853975),xs=.5*Math.cos(3.14159/16),$i=.5*Math.cos(3.14159/8),ds=.5*Math.cos(3*3.14159/16),ps=.5*Math.cos(5*3.14159/16),ws=.5*Math.cos(3*3.14159/8),ys=.5*Math.cos(7*3.14159/16),Es=new Array(4),Ts=new Array(4),Rs=new Array(4),Ds=new Array(4);for(let Us=0;Us<8;++Us){const Os=Us*8;Es[0]=$i*Gi[Os+2],Es[1]=ws*Gi[Os+2],Es[2]=$i*Gi[Os+6],Es[3]=ws*Gi[Os+6],Ts[0]=xs*Gi[Os+1]+ds*Gi[Os+3]+ps*Gi[Os+5]+ys*Gi[Os+7],Ts[1]=ds*Gi[Os+1]-ys*Gi[Os+3]-xs*Gi[Os+5]-ps*Gi[Os+7],Ts[2]=ps*Gi[Os+1]-xs*Gi[Os+3]+ys*Gi[Os+5]+ds*Gi[Os+7],Ts[3]=ys*Gi[Os+1]-ps*Gi[Os+3]+ds*Gi[Os+5]-xs*Gi[Os+7],Rs[0]=cs*(Gi[Os+0]+Gi[Os+4]),Rs[3]=cs*(Gi[Os+0]-Gi[Os+4]),Rs[1]=Es[0]+Es[3],Rs[2]=Es[1]-Es[2],Ds[0]=Rs[0]+Rs[1],Ds[1]=Rs[3]+Rs[2],Ds[2]=Rs[3]-Rs[2],Ds[3]=Rs[0]-Rs[1],Gi[Os+0]=Ds[0]+Ts[0],Gi[Os+1]=Ds[1]+Ts[1],Gi[Os+2]=Ds[2]+Ts[2],Gi[Os+3]=Ds[3]+Ts[3],Gi[Os+4]=Ds[3]-Ts[3],Gi[Os+5]=Ds[2]-Ts[2],Gi[Os+6]=Ds[1]-Ts[1],Gi[Os+7]=Ds[0]-Ts[0]}for(let Us=0;Us<8;++Us)Es[0]=$i*Gi[16+Us],Es[1]=ws*Gi[16+Us],Es[2]=$i*Gi[48+Us],Es[3]=ws*Gi[48+Us],Ts[0]=xs*Gi[8+Us]+ds*Gi[24+Us]+ps*Gi[40+Us]+ys*Gi[56+Us],Ts[1]=ds*Gi[8+Us]-ys*Gi[24+Us]-xs*Gi[40+Us]-ps*Gi[56+Us],Ts[2]=ps*Gi[8+Us]-xs*Gi[24+Us]+ys*Gi[40+Us]+ds*Gi[56+Us],Ts[3]=ys*Gi[8+Us]-ps*Gi[24+Us]+ds*Gi[40+Us]-xs*Gi[56+Us],Rs[0]=cs*(Gi[Us]+Gi[32+Us]),Rs[3]=cs*(Gi[Us]-Gi[32+Us]),Rs[1]=Es[0]+Es[3],Rs[2]=Es[1]-Es[2],Ds[0]=Rs[0]+Rs[1],Ds[1]=Rs[3]+Rs[2],Ds[2]=Rs[3]-Rs[2],Ds[3]=Rs[0]-Rs[1],Gi[0+Us]=Ds[0]+Ts[0],Gi[8+Us]=Ds[1]+Ts[1],Gi[16+Us]=Ds[2]+Ts[2],Gi[24+Us]=Ds[3]+Ts[3],Gi[32+Us]=Ds[3]-Ts[3],Gi[40+Us]=Ds[2]-Ts[2],Gi[48+Us]=Ds[1]-Ts[1],Gi[56+Us]=Ds[0]-Ts[0]}function ms(Gi){for(let cs=0;cs<64;++cs){const xs=Gi[0][cs],$i=Gi[1][cs],ds=Gi[2][cs];Gi[0][cs]=xs+1.5747*ds,Gi[1][cs]=xs-.1873*$i-.4682*ds,Gi[2][cs]=xs+1.8556*$i}}function Ki(Gi,cs,xs){for(let $i=0;$i<64;++$i)cs[xs+$i]=DataUtils.toHalfFloat(Ni(Gi[$i]))}function Ni(Gi){return Gi<=1?Math.sign(Gi)*Math.pow(Math.abs(Gi),2.2):Math.sign(Gi)*Math.pow(Cr,Math.abs(Gi)-1)}function Ri(Gi){return new DataView(Gi.array.buffer,Gi.offset.value,Gi.size)}function Jr(Gi){const cs=Gi.viewer.buffer.slice(Gi.offset.value,Gi.offset.value+Gi.size),xs=new Uint8Array(ns(cs)),$i=new Uint8Array(xs.length);return qi(xs),Xr(xs,$i),new DataView($i.buffer)}function Xi(Gi){const cs=Gi.array.slice(Gi.offset.value,Gi.offset.value+Gi.size),xs=unzlibSync(cs),$i=new Uint8Array(xs.length);return qi(xs),Xr(xs,$i),new DataView($i.buffer)}function ss(Gi){const cs=Gi.viewer,xs={value:Gi.offset.value},$i=new Uint16Array(Gi.columns*Gi.lines*(Gi.inputChannels.length*Gi.type)),ds=new Uint8Array(8192);let ps=0;const ws=new Array(Gi.inputChannels.length);for(let Gs=0,zs=Gi.inputChannels.length;Gs<zs;Gs++)ws[Gs]={},ws[Gs].start=ps,ws[Gs].end=ws[Gs].start,ws[Gs].nx=Gi.columns,ws[Gs].ny=Gi.lines,ws[Gs].size=Gi.type,ps+=ws[Gs].nx*ws[Gs].ny*ws[Gs].size;const ys=Cs(cs,xs),Es=Cs(cs,xs);if(Es>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(ys<=Es)for(let Gs=0;Gs<Es-ys+1;Gs++)ds[Gs+ys]=Ws(cs,xs);const Ts=new Uint16Array(65536),Rs=Ir(ds,Ts),Ds=Fs(cs,xs);Zi(Gi.array,cs,xs,Ds,$i,ps);for(let Gs=0;Gs<Gi.inputChannels.length;++Gs){const zs=ws[Gs];for(let Xs=0;Xs<ws[Gs].size;++Xs)ji($i,zs.start+Xs,zs.nx,zs.size,zs.ny,zs.nx*zs.size,Rs)}Yi(Ts,$i,ps);let Us=0;const Os=new Uint8Array($i.buffer.byteLength);for(let Gs=0;Gs<Gi.lines;Gs++)for(let zs=0;zs<Gi.inputChannels.length;zs++){const Xs=ws[zs],na=Xs.nx*Xs.size,wa=new Uint8Array($i.buffer,Xs.end*2,na*2);Os.set(wa,Us),Us+=na*2,Xs.end+=na}return new DataView(Os.buffer)}function ls(Gi){const cs=Gi.array.slice(Gi.offset.value,Gi.offset.value+Gi.size),xs=unzlibSync(cs),$i=Gi.inputChannels.length*Gi.lines*Gi.columns*Gi.totalBytes,ds=new ArrayBuffer($i),ps=new DataView(ds);let ws=0,ys=0;const Es=new Array(4);for(let Ts=0;Ts<Gi.lines;Ts++)for(let Rs=0;Rs<Gi.inputChannels.length;Rs++){let Ds=0;switch(Gi.inputChannels[Rs].pixelType){case 1:Es[0]=ws,Es[1]=Es[0]+Gi.columns,ws=Es[1]+Gi.columns;for(let Os=0;Os<Gi.columns;++Os){const Gs=xs[Es[0]++]<<8|xs[Es[1]++];Ds+=Gs,ps.setUint16(ys,Ds,!0),ys+=2}break;case 2:Es[0]=ws,Es[1]=Es[0]+Gi.columns,Es[2]=Es[1]+Gi.columns,ws=Es[2]+Gi.columns;for(let Os=0;Os<Gi.columns;++Os){const Gs=xs[Es[0]++]<<24|xs[Es[1]++]<<16|xs[Es[2]++]<<8;Ds+=Gs,ps.setUint32(ys,Ds,!0),ys+=4}break}}return ps}function gs(Gi){const cs=Gi.viewer,xs={value:Gi.offset.value},$i=new Uint8Array(Gi.columns*Gi.lines*(Gi.inputChannels.length*Gi.type*2)),ds={version:ks(cs,xs),unknownUncompressedSize:ks(cs,xs),unknownCompressedSize:ks(cs,xs),acCompressedSize:ks(cs,xs),dcCompressedSize:ks(cs,xs),rleCompressedSize:ks(cs,xs),rleUncompressedSize:ks(cs,xs),rleRawSize:ks(cs,xs),totalAcUncompressedCount:ks(cs,xs),totalDcUncompressedCount:ks(cs,xs),acCompression:ks(cs,xs)};if(ds.version<2)throw new Error("EXRLoader.parse: "+Ya.compression+" version "+ds.version+" is unsupported");const ps=new Array;let ws=Cs(cs,xs)-2;for(;ws>0;){const zs=_s(cs.buffer,xs),Xs=Ws(cs,xs),na=Xs>>2&3,wa=(Xs>>4)-1,fa=new Int8Array([wa])[0],sa=Ws(cs,xs);ps.push({name:zs,index:fa,type:sa,compression:na}),ws-=zs.length+3}const ys=Ya.channels,Es=new Array(Gi.inputChannels.length);for(let zs=0;zs<Gi.inputChannels.length;++zs){const Xs=Es[zs]={},na=ys[zs];Xs.name=na.name,Xs.compression=0,Xs.decoded=!1,Xs.type=na.pixelType,Xs.pLinear=na.pLinear,Xs.width=Gi.columns,Xs.height=Gi.lines}const Ts={idx:new Array(3)};for(let zs=0;zs<Gi.inputChannels.length;++zs){const Xs=Es[zs];for(let na=0;na<ps.length;++na){const wa=ps[na];Xs.name==wa.name&&(Xs.compression=wa.compression,wa.index>=0&&(Ts.idx[wa.index]=zs),Xs.offset=zs)}}let Rs,Ds,Us;if(ds.acCompressedSize>0)switch(ds.acCompression){case 0:Rs=new Uint16Array(ds.totalAcUncompressedCount),Zi(Gi.array,cs,xs,ds.acCompressedSize,Rs,ds.totalAcUncompressedCount);break;case 1:const zs=Gi.array.slice(xs.value,xs.value+ds.totalAcUncompressedCount),Xs=unzlibSync(zs);Rs=new Uint16Array(Xs.buffer),xs.value+=ds.totalAcUncompressedCount;break}if(ds.dcCompressedSize>0){const zs={array:Gi.array,offset:xs,size:ds.dcCompressedSize};Ds=new Uint16Array(Xi(zs).buffer),xs.value+=ds.dcCompressedSize}if(ds.rleRawSize>0){const zs=Gi.array.slice(xs.value,xs.value+ds.rleCompressedSize),Xs=unzlibSync(zs);Us=ns(Xs.buffer),xs.value+=ds.rleCompressedSize}let Os=0;const Gs=new Array(Es.length);for(let zs=0;zs<Gs.length;++zs)Gs[zs]=new Array;for(let zs=0;zs<Gi.lines;++zs)for(let Xs=0;Xs<Es.length;++Xs)Gs[Xs].push(Os),Os+=Es[Xs].width*Gi.type*2;os(Ts,Gs,Es,Rs,Ds,$i);for(let zs=0;zs<Es.length;++zs){const Xs=Es[zs];if(!Xs.decoded)switch(Xs.compression){case 2:let na=0,wa=0;for(let fa=0;fa<Gi.lines;++fa){let sa=Gs[zs][na];for(let Ea=0;Ea<Xs.width;++Ea){for(let ca=0;ca<2*Xs.type;++ca)$i[sa++]=Us[wa+ca*Xs.width*Xs.height];wa++}na++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView($i.buffer)}function _s(Gi,cs){const xs=new Uint8Array(Gi);let $i=0;for(;xs[cs.value+$i]!=0;)$i+=1;const ds=new TextDecoder().decode(xs.slice(cs.value,cs.value+$i));return cs.value=cs.value+$i+1,ds}function vs(Gi,cs,xs){const $i=new TextDecoder().decode(new Uint8Array(Gi).slice(cs.value,cs.value+xs));return cs.value=cs.value+xs,$i}function As(Gi,cs){const xs=Is(Gi,cs),$i=Fs(Gi,cs);return[xs,$i]}function Ss(Gi,cs){const xs=Fs(Gi,cs),$i=Fs(Gi,cs);return[xs,$i]}function Is(Gi,cs){const xs=Gi.getInt32(cs.value,!0);return cs.value=cs.value+4,xs}function Fs(Gi,cs){const xs=Gi.getUint32(cs.value,!0);return cs.value=cs.value+4,xs}function Ns(Gi,cs){const xs=Gi[cs.value];return cs.value=cs.value+1,xs}function Ws(Gi,cs){const xs=Gi.getUint8(cs.value);return cs.value=cs.value+1,xs}const ks=function(Gi,cs){let xs;return"getBigInt64"in DataView.prototype?xs=Number(Gi.getBigInt64(cs.value,!0)):xs=Gi.getUint32(cs.value+4,!0)+Number(Gi.getUint32(cs.value,!0)<<32),cs.value+=8,xs};function Vs(Gi,cs){const xs=Gi.getFloat32(cs.value,!0);return cs.value+=4,xs}function bs(Gi,cs){return DataUtils.toHalfFloat(Vs(Gi,cs))}function Ms(Gi){const cs=(Gi&31744)>>10,xs=Gi&1023;return(Gi>>15?-1:1)*(cs?cs===31?xs?NaN:1/0:Math.pow(2,cs-15)*(1+xs/1024):6103515625e-14*(xs/1024))}function Cs(Gi,cs){const xs=Gi.getUint16(cs.value,!0);return cs.value+=2,xs}function Ps(Gi,cs){return Ms(Cs(Gi,cs))}function Qs(Gi,cs,xs,$i){const ds=xs.value,ps=[];for(;xs.value<ds+$i-1;){const ws=_s(cs,xs),ys=Is(Gi,xs),Es=Ws(Gi,xs);xs.value+=3;const Ts=Is(Gi,xs),Rs=Is(Gi,xs);ps.push({name:ws,pixelType:ys,pLinear:Es,xSampling:Ts,ySampling:Rs})}return xs.value+=1,ps}function Hs(Gi,cs){const xs=Vs(Gi,cs),$i=Vs(Gi,cs),ds=Vs(Gi,cs),ps=Vs(Gi,cs),ws=Vs(Gi,cs),ys=Vs(Gi,cs),Es=Vs(Gi,cs),Ts=Vs(Gi,cs);return{redX:xs,redY:$i,greenX:ds,greenY:ps,blueX:ws,blueY:ys,whiteX:Es,whiteY:Ts}}function ta(Gi,cs){const xs=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],$i=Ws(Gi,cs);return xs[$i]}function Sa(Gi,cs){const xs=Is(Gi,cs),$i=Is(Gi,cs),ds=Is(Gi,cs),ps=Is(Gi,cs);return{xMin:xs,yMin:$i,xMax:ds,yMax:ps}}function ga(Gi,cs){const xs=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],$i=Ws(Gi,cs);return xs[$i]}function $s(Gi,cs){const xs=["ENVMAP_LATLONG","ENVMAP_CUBE"],$i=Ws(Gi,cs);return xs[$i]}function Ks(Gi,cs){const xs=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],$i=["ROUND_DOWN","ROUND_UP"],ds=Fs(Gi,cs),ps=Fs(Gi,cs),ws=Ws(Gi,cs);return{xSize:ds,ySize:ps,levelMode:xs[ws&15],roundingMode:$i[ws>>4]}}function qs(Gi,cs){const xs=Vs(Gi,cs),$i=Vs(Gi,cs);return[xs,$i]}function Zs(Gi,cs){const xs=Vs(Gi,cs),$i=Vs(Gi,cs),ds=Vs(Gi,cs);return[xs,$i,ds]}function ha(Gi,cs,xs,$i,ds){if($i==="string"||$i==="stringvector"||$i==="iccProfile")return vs(cs,xs,ds);if($i==="chlist")return Qs(Gi,cs,xs,ds);if($i==="chromaticities")return Hs(Gi,xs);if($i==="compression")return ta(Gi,xs);if($i==="box2i")return Sa(Gi,xs);if($i==="envmap")return $s(Gi,xs);if($i==="tiledesc")return Ks(Gi,xs);if($i==="lineOrder")return ga(Gi,xs);if($i==="float")return Vs(Gi,xs);if($i==="v2f")return qs(Gi,xs);if($i==="v3f")return Zs(Gi,xs);if($i==="int")return Is(Gi,xs);if($i==="rational")return As(Gi,xs);if($i==="timecode")return Ss(Gi,xs);if($i==="preview")return xs.value+=ds,"skipped";xs.value+=ds}function Ta(Gi,cs){const xs=Math.log2(Gi);return cs=="ROUND_DOWN"?Math.floor(xs):Math.ceil(xs)}function $a(Gi,cs,xs){let $i=0;switch(Gi.levelMode){case"ONE_LEVEL":$i=1;break;case"MIPMAP_LEVELS":$i=Ta(Math.max(cs,xs),Gi.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return $i}function Wa(Gi,cs,xs,$i){const ds=new Array(Gi);for(let ps=0;ps<Gi;ps++){const ws=1<<ps;let ys=cs/ws|0;$i=="ROUND_UP"&&ys*ws<cs&&(ys+=1);const Es=Math.max(ys,1);ds[ps]=(Es+xs-1)/xs|0}return ds}function Qa(){const Gi=this,cs=Gi.offset,xs={value:0};for(let $i=0;$i<Gi.tileCount;$i++){const ds=Is(Gi.viewer,cs),ps=Is(Gi.viewer,cs);cs.value+=8,Gi.size=Fs(Gi.viewer,cs);const ws=ds*Gi.blockWidth,ys=ps*Gi.blockHeight;Gi.columns=ws+Gi.blockWidth>Gi.width?Gi.width-ws:Gi.blockWidth,Gi.lines=ys+Gi.blockHeight>Gi.height?Gi.height-ys:Gi.blockHeight;const Es=Gi.columns*Gi.totalBytes,Rs=Gi.size<Gi.lines*Es?Gi.uncompress(Gi):Ri(Gi);cs.value+=Gi.size;for(let Ds=0;Ds<Gi.lines;Ds++){const Us=Ds*Gi.columns*Gi.totalBytes;for(let Os=0;Os<Gi.inputChannels.length;Os++){const Gs=Ya.channels[Os].name,zs=Gi.channelByteOffsets[Gs]*Gi.columns,Xs=Gi.decodeChannels[Gs];if(Xs===void 0)continue;xs.value=Us+zs;const na=(Gi.height-(1+ys+Ds))*Gi.outLineWidth;for(let wa=0;wa<Gi.columns;wa++){const fa=na+(wa+ws)*Gi.outputChannels+Xs;Gi.byteArray[fa]=Gi.getter(Rs,xs)}}}}}function Xa(){const Gi=this,cs=Gi.offset,xs={value:0};for(let $i=0;$i<Gi.height/Gi.blockHeight;$i++){const ds=Is(Gi.viewer,cs)-Ya.dataWindow.yMin;Gi.size=Fs(Gi.viewer,cs),Gi.lines=ds+Gi.blockHeight>Gi.height?Gi.height-ds:Gi.blockHeight;const ps=Gi.columns*Gi.totalBytes,ys=Gi.size<Gi.lines*ps?Gi.uncompress(Gi):Ri(Gi);cs.value+=Gi.size;for(let Es=0;Es<Gi.blockHeight;Es++){const Ts=$i*Gi.blockHeight,Rs=Es+Gi.scanOrder(Ts);if(Rs>=Gi.height)continue;const Ds=Es*ps,Us=(Gi.height-1-Rs)*Gi.outLineWidth;for(let Os=0;Os<Gi.inputChannels.length;Os++){const Gs=Ya.channels[Os].name,zs=Gi.channelByteOffsets[Gs]*Gi.columns,Xs=Gi.decodeChannels[Gs];if(Xs!==void 0){xs.value=Ds+zs;for(let na=0;na<Gi.columns;na++){const wa=Us+na*Gi.outputChannels+Xs;Gi.byteArray[wa]=Gi.getter(ys,xs)}}}}}}function Ka(Gi,cs,xs){const $i={};if(Gi.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");$i.version=Gi.getUint8(4);const ds=Gi.getUint8(5);$i.spec={singleTile:!!(ds&2),longName:!!(ds&4),deepFormat:!!(ds&8),multiPart:!!(ds&16)},xs.value=8;let ps=!0;for(;ps;){const ws=_s(cs,xs);if(ws==0)ps=!1;else{const ys=_s(cs,xs),Es=Fs(Gi,xs),Ts=ha(Gi,cs,xs,ys,Es);Ts===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${ys}'.`):$i[ws]=Ts}}if(ds&-7)throw console.error("THREE.EXRHeader:",$i),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return $i}function qa(Gi,cs,xs,$i,ds){const ps={size:0,viewer:cs,array:xs,offset:$i,width:Gi.dataWindow.xMax-Gi.dataWindow.xMin+1,height:Gi.dataWindow.yMax-Gi.dataWindow.yMin+1,inputChannels:Gi.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:LinearSRGBColorSpace};switch(Gi.compression){case"NO_COMPRESSION":ps.blockHeight=1,ps.uncompress=Ri;break;case"RLE_COMPRESSION":ps.blockHeight=1,ps.uncompress=Jr;break;case"ZIPS_COMPRESSION":ps.blockHeight=1,ps.uncompress=Xi;break;case"ZIP_COMPRESSION":ps.blockHeight=16,ps.uncompress=Xi;break;case"PIZ_COMPRESSION":ps.blockHeight=32,ps.uncompress=ss;break;case"PXR24_COMPRESSION":ps.blockHeight=16,ps.uncompress=ls;break;case"DWAA_COMPRESSION":ps.blockHeight=32,ps.uncompress=gs;break;case"DWAB_COMPRESSION":ps.blockHeight=256,ps.uncompress=gs;break;default:throw new Error("EXRLoader.parse: "+Gi.compression+" is unsupported")}const ws={};for(const Rs of Gi.channels)switch(Rs.name){case"Y":case"R":case"G":case"B":case"A":ws[Rs.name]=!0,ps.type=Rs.pixelType}let ys=!1;if(ws.R&&ws.G&&ws.B)ys=!ws.A,ps.outputChannels=4,ps.decodeChannels={R:0,G:1,B:2,A:3};else if(ws.Y)ps.outputChannels=1,ps.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(ps.type==1)switch(ds){case FloatType:ps.getter=Ps;break;case HalfFloatType:ps.getter=Cs;break}else if(ps.type==2)switch(ds){case FloatType:ps.getter=Vs;break;case HalfFloatType:ps.getter=bs}else throw new Error("EXRLoader.parse: unsupported pixelType "+ps.type+" for "+Gi.compression+".");ps.columns=ps.width;const Es=ps.width*ps.height*ps.outputChannels;switch(ds){case FloatType:ps.byteArray=new Float32Array(Es),ys&&ps.byteArray.fill(1,0,Es);break;case HalfFloatType:ps.byteArray=new Uint16Array(Es),ys&&ps.byteArray.fill(15360,0,Es);break;default:console.error("THREE.EXRLoader: unsupported type: ",ds);break}let Ts=0;for(const Rs of Gi.channels)ps.decodeChannels[Rs.name]!==void 0&&(ps.channelByteOffsets[Rs.name]=Ts),Ts+=Rs.pixelType*2;if(ps.totalBytes=Ts,ps.outLineWidth=ps.width*ps.outputChannels,Gi.lineOrder==="INCREASING_Y"?ps.scanOrder=Rs=>Rs:ps.scanOrder=Rs=>ps.height-1-Rs,ps.outputChannels==4?(ps.format=RGBAFormat,ps.colorSpace=LinearSRGBColorSpace):(ps.format=RedFormat,ps.colorSpace=NoColorSpace),Gi.spec.singleTile){ps.blockHeight=Gi.tiles.ySize,ps.blockWidth=Gi.tiles.xSize;const Rs=$a(Gi.tiles,ps.width,ps.height),Ds=Wa(Rs,ps.width,Gi.tiles.xSize,Gi.tiles.roundingMode),Us=Wa(Rs,ps.height,Gi.tiles.ySize,Gi.tiles.roundingMode);ps.tileCount=Ds[0]*Us[0];for(let Os=0;Os<Rs;Os++)for(let Gs=0;Gs<Us[Os];Gs++)for(let zs=0;zs<Ds[Os];zs++)ks(cs,$i);ps.decode=Qa.bind(ps)}else{ps.blockWidth=ps.width;const Rs=Math.ceil(ps.height/ps.blockHeight);for(let Ds=0;Ds<Rs;Ds++)ks(cs,$i);ps.decode=Xa.bind(ps)}return ps}const to={value:0},ro=new DataView(er),ao=new Uint8Array(er),Ya=Ka(ro,er,to),Za=qa(Ya,ro,ao,to,this.type);return Za.decode(),{header:Ya,width:Za.width,height:Za.height,data:Za.byteArray,format:Za.format,colorSpace:Za.colorSpace,type:this.type}}setDataType(er){return this.type=er,this}load(er,tr,rr,nr){function sr(ar,or){ar.colorSpace=or.colorSpace,ar.minFilter=LinearFilter,ar.magFilter=LinearFilter,ar.generateMipmaps=!1,ar.flipY=!1,tr&&tr(ar,or)}return super.load(er,sr,rr,nr)}}const _taskCache$2=new WeakMap;class Rhino3dmLoader extends Loader{constructor(er){super(er),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(er){return this.libraryPath=er,this}setWorkerLimit(er){return this.workerLimit=er,this}load(er,tr,rr,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setResponseType("arraybuffer"),sr.setRequestHeader(this.requestHeader),this.url=er,sr.load(er,ar=>{if(_taskCache$2.has(ar))return _taskCache$2.get(ar).promise.then(tr).catch(nr);this.decodeObjects(ar,er).then(or=>{or.userData.warnings=this.warnings,tr(or)}).catch(or=>nr(or))},rr,nr)}debug(){console.log("Task load: ",this.workerPool.map(er=>er._taskLoad))}decodeObjects(er,tr){let rr,nr;const sr=er.byteLength,ar=this._getWorker(sr).then(or=>(rr=or,nr=this.workerNextTaskID++,new Promise((lr,cr)=>{rr._callbacks[nr]={resolve:lr,reject:cr},rr.postMessage({type:"decode",id:nr,buffer:er},[er])}))).then(or=>this._createGeometry(or.data)).catch(or=>{throw or});return ar.catch(()=>!0).then(()=>{rr&&nr&&this._releaseTask(rr,nr)}),_taskCache$2.set(er,{url:tr,promise:ar}),ar}parse(er,tr,rr){this.decodeObjects(er,"").then(nr=>{nr.userData.warnings=this.warnings,tr(nr)}).catch(nr=>rr(nr))}_compareMaterials(er){const tr={};tr.name=er.name,tr.color={},tr.color.r=er.color.r,tr.color.g=er.color.g,tr.color.b=er.color.b,tr.type=er.type,tr.vertexColors=er.vertexColors;const rr=JSON.stringify(tr);for(let nr=0;nr<this.materials.length;nr++){const sr=this.materials[nr],ar={};if(ar.name=sr.name,ar.color={},ar.color.r=sr.color.r,ar.color.g=sr.color.g,ar.color.b=sr.color.b,ar.type=sr.type,ar.vertexColors=sr.vertexColors,JSON.stringify(ar)===rr)return sr}return this.materials.push(er),er}_createMaterial(er,tr){if(er===void 0)return new MeshStandardMaterial({color:new Color(1,1,1),metalness:.8,name:Loader.DEFAULT_MATERIAL_NAME,side:DoubleSide});const rr=new MeshPhysicalMaterial({color:new Color(er.diffuseColor.r/255,er.diffuseColor.g/255,er.diffuseColor.b/255),emissive:new Color(er.emissionColor.r,er.emissionColor.g,er.emissionColor.b),flatShading:er.disableLighting,ior:er.indexOfRefraction,name:er.name,reflectivity:er.reflectivity,opacity:1-er.transparency,side:DoubleSide,specularColor:er.specularColor,transparent:er.transparency>0});if(rr.userData.id=er.id,er.pbrSupported){const sr=er.pbr;rr.anisotropy=sr.anisotropic,rr.anisotropyRotation=sr.anisotropicRotation,rr.color=new Color(sr.baseColor.r,sr.baseColor.g,sr.baseColor.b),rr.clearcoat=sr.clearcoat,rr.clearcoatRoughness=sr.clearcoatRoughness,rr.metalness=sr.metallic,rr.transmission=1-sr.opacity,rr.roughness=sr.roughness,rr.sheen=sr.sheen,rr.specularIntensity=sr.specular,rr.thickness=sr.subsurface}er.pbrSupported&&er.pbr.opacity===0&&er.transparency===1&&(rr.opacity=.2,rr.transmission=1);const nr=new TextureLoader;for(let sr=0;sr<er.textures.length;sr++){const ar=er.textures[sr];if(ar.image!==null){const or=nr.load(ar.image);switch(ar.type){case"Bump":rr.bumpMap=or;break;case"Diffuse":rr.map=or;break;case"Emap":rr.envMap=or;break;case"Opacity":rr.transmissionMap=or;break;case"Transparency":rr.alphaMap=or,rr.transparent=!0;break;case"PBR_Alpha":rr.alphaMap=or,rr.transparent=!0;break;case"PBR_AmbientOcclusion":rr.aoMap=or;break;case"PBR_Anisotropic":rr.anisotropyMap=or;break;case"PBR_BaseColor":rr.map=or;break;case"PBR_Clearcoat":rr.clearcoatMap=or;break;case"PBR_ClearcoatBump":rr.clearcoatNormalMap=or;break;case"PBR_ClearcoatRoughness":rr.clearcoatRoughnessMap=or;break;case"PBR_Displacement":rr.displacementMap=or;break;case"PBR_Emission":rr.emissiveMap=or;break;case"PBR_Metallic":rr.metalnessMap=or;break;case"PBR_Roughness":rr.roughnessMap=or;break;case"PBR_Sheen":rr.sheenColorMap=or;break;case"PBR_Specular":rr.specularColorMap=or;break;case"PBR_Subsurface":rr.thicknessMap=or;break;default:this.warnings.push({message:`THREE.3DMLoader: No conversion exists for 3dm ${ar.type}.`,type:"no conversion"});break}or.wrapS=ar.wrapU===0?RepeatWrapping:ClampToEdgeWrapping,or.wrapT=ar.wrapV===0?RepeatWrapping:ClampToEdgeWrapping,ar.repeat&&or.repeat.set(ar.repeat[0],ar.repeat[1])}}return tr&&new EXRLoader().load(tr.image,function(sr){sr.mapping=THREE.EquirectangularReflectionMapping,rr.envMap=sr}),rr}_createGeometry(er){const tr=new Object3D,rr=[],nr=[],sr=[];tr.userData.layers=er.layers,tr.userData.groups=er.groups,tr.userData.settings=er.settings,tr.userData.settings.renderSettings=er.renderSettings,tr.userData.objectType="File3dm",tr.userData.materials=null,tr.name=this.url;let ar=er.objects;const or=er.materials;for(let lr=0;lr<ar.length;lr++){const cr=ar[lr],hr=cr.attributes;switch(cr.objectType){case"InstanceDefinition":nr.push(cr);break;case"InstanceReference":sr.push(cr);break;default:let fr=null;switch(hr.materialSource.name){case"ObjectMaterialSource_MaterialFromLayer":hr.layerIndex>=0&&(fr=er.layers[hr.layerIndex].renderMaterialIndex);break;case"ObjectMaterialSource_MaterialFromObject":hr.materialIndex>=0&&(fr=hr.materialIndex);break}let ur=null;if(fr>=0){const _r=or[fr];ur=this._createMaterial(_r,er.renderEnvironment)}const pr=this._createObject(cr,ur);if(pr===void 0)continue;const gr=er.layers[hr.layerIndex];pr.visible=gr?er.layers[hr.layerIndex].visible:!0,hr.isInstanceDefinitionObject?rr.push(pr):tr.add(pr);break}}for(let lr=0;lr<nr.length;lr++){const cr=nr[lr];ar=[];for(let hr=0;hr<cr.attributes.objectIds.length;hr++){const fr=cr.attributes.objectIds[hr];for(let ur=0;ur<rr.length;ur++){const pr=rr[ur].userData.attributes.id;fr===pr&&ar.push(rr[ur])}}for(let hr=0;hr<sr.length;hr++){const fr=sr[hr];if(fr.geometry.parentIdefId===cr.attributes.id){const ur=new Object3D,pr=fr.geometry.xform.array,gr=new Matrix4;gr.set(...pr),ur.applyMatrix4(gr);for(let _r=0;_r<ar.length;_r++)ur.add(ar[_r].clone(!0));tr.add(ur)}}}return tr.userData.materials=this.materials,tr.name="",tr}_createObject(er,tr){const rr=new BufferGeometryLoader,nr=er.attributes;let sr,ar,or,lr;switch(er.objectType){case"Point":case"PointSet":sr=rr.parse(er.geometry),sr.attributes.hasOwnProperty("color")?ar=new PointsMaterial({vertexColors:!0,sizeAttenuation:!1,size:2}):(or=nr.drawColor,lr=new Color(or.r/255,or.g/255,or.b/255),ar=new PointsMaterial({color:lr,sizeAttenuation:!1,size:2})),ar=this._compareMaterials(ar);const cr=new Points(sr,ar);return cr.userData.attributes=nr,cr.userData.objectType=er.objectType,nr.name&&(cr.name=nr.name),cr;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(er.geometry===null)return;sr=rr.parse(er.geometry),tr===null&&(tr=this._createMaterial()),sr.attributes.hasOwnProperty("color")&&(tr.vertexColors=!0),tr=this._compareMaterials(tr);const hr=new Mesh(sr,tr);return hr.castShadow=nr.castsShadows,hr.receiveShadow=nr.receivesShadows,hr.userData.attributes=nr,hr.userData.objectType=er.objectType,nr.name&&(hr.name=nr.name),hr;case"Curve":sr=rr.parse(er.geometry),or=nr.drawColor,lr=new Color(or.r/255,or.g/255,or.b/255),ar=new LineBasicMaterial({color:lr}),ar=this._compareMaterials(ar);const fr=new Line(sr,ar);return fr.userData.attributes=nr,fr.userData.objectType=er.objectType,nr.name&&(fr.name=nr.name),fr;case"TextDot":sr=er.geometry;const ur=document.createElement("canvas").getContext("2d"),pr=`${sr.fontHeight}px ${sr.fontFace}`;ur.font=pr;const gr=ur.measureText(sr.text).width+10,_r=sr.fontHeight+10,mr=window.devicePixelRatio;ur.canvas.width=gr*mr,ur.canvas.height=_r*mr,ur.canvas.style.width=gr+"px",ur.canvas.style.height=_r+"px",ur.setTransform(mr,0,0,mr,0,0),ur.font=pr,ur.textBaseline="middle",ur.textAlign="center",lr=nr.drawColor,ur.fillStyle=`rgba(${lr.r},${lr.g},${lr.b},${lr.a})`,ur.fillRect(0,0,gr,_r),ur.fillStyle="white",ur.fillText(sr.text,gr/2,_r/2);const dr=new CanvasTexture(ur.canvas);dr.minFilter=LinearFilter,dr.generateMipmaps=!1,dr.wrapS=ClampToEdgeWrapping,dr.wrapT=ClampToEdgeWrapping,ar=new SpriteMaterial({map:dr,depthTest:!1});const vr=new Sprite(ar);return vr.position.set(sr.point[0],sr.point[1],sr.point[2]),vr.scale.set(gr/10,_r/10,1),vr.userData.attributes=nr,vr.userData.objectType=er.objectType,nr.name&&(vr.name=nr.name),vr;case"Light":sr=er.geometry;let Ar;switch(sr.lightStyle.name){case"LightStyle_WorldPoint":Ar=new PointLight,Ar.castShadow=nr.castsShadows,Ar.position.set(sr.location[0],sr.location[1],sr.location[2]),Ar.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":Ar=new SpotLight,Ar.castShadow=nr.castsShadows,Ar.position.set(sr.location[0],sr.location[1],sr.location[2]),Ar.target.position.set(sr.direction[0],sr.direction[1],sr.direction[2]),Ar.angle=sr.spotAngleRadians,Ar.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":Ar=new RectAreaLight;const yr=Math.abs(sr.width[2]),wr=Math.abs(sr.length[0]);Ar.position.set(sr.location[0]-wr/2,sr.location[1],sr.location[2]-yr/2),Ar.height=wr,Ar.width=yr,Ar.lookAt(sr.direction[0],sr.direction[1],sr.direction[2]);break;case"LightStyle_WorldDirectional":Ar=new DirectionalLight,Ar.castShadow=nr.castsShadows,Ar.position.set(sr.location[0],sr.location[1],sr.location[2]),Ar.target.position.set(sr.direction[0],sr.direction[1],sr.direction[2]),Ar.shadow.normalBias=.1;break;case"LightStyle_WorldLinear":break;default:break}return Ar&&(Ar.intensity=sr.intensity,or=sr.diffuse,lr=new Color(or.r/255,or.g/255,or.b/255),Ar.color=lr,Ar.userData.attributes=nr,Ar.userData.objectType=er.objectType),Ar}}_initLibrary(){if(!this.libraryPending){const er=new FileLoader(this.manager);er.setPath(this.libraryPath);const tr=new Promise((sr,ar)=>{er.load("rhino3dm.js",sr,void 0,ar)}),rr=new FileLoader(this.manager);rr.setPath(this.libraryPath),rr.setResponseType("arraybuffer");const nr=new Promise((sr,ar)=>{rr.load("rhino3dm.wasm",sr,void 0,ar)});this.libraryPending=Promise.all([tr,nr]).then(([sr,ar])=>{this.libraryConfig.wasmBinary=ar;const or=Rhino3dmWorker.toString(),lr=["/* rhino3dm.js */",sr,"/* worker */",or.substring(or.indexOf("{")+1,or.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([lr]))})}return this.libraryPending}_getWorker(er){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const rr=new Worker(this.workerSourceURL);rr._callbacks={},rr._taskCosts={},rr._taskLoad=0,rr.postMessage({type:"init",libraryConfig:this.libraryConfig}),rr.onmessage=nr=>{const sr=nr.data;switch(sr.type){case"warning":this.warnings.push(sr.data),console.warn(sr.data);break;case"decode":rr._callbacks[sr.id].resolve(sr);break;case"error":rr._callbacks[sr.id].reject(sr);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+sr.type+'"')}},this.workerPool.push(rr)}else this.workerPool.sort(function(rr,nr){return rr._taskLoad>nr._taskLoad?-1:1});const tr=this.workerPool[this.workerPool.length-1];return tr._taskLoad+=er,tr})}_releaseTask(er,tr){er._taskLoad-=er._taskCosts[tr],delete er._callbacks[tr],delete er._taskCosts[tr]}dispose(){for(let er=0;er<this.workerPool.length;++er)this.workerPool[er].terminate();return this.workerPool.length=0,this}}function Rhino3dmWorker(){let ir,er,tr,rr;onmessage=function(hr){const fr=hr.data;switch(fr.type){case"init":er=fr.libraryConfig;const ur=er.wasmBinary;let pr;ir=new Promise(function(_r){pr={wasmBinary:ur,onRuntimeInitialized:_r},rhino3dm(pr)}).then(()=>{tr=pr});break;case"decode":rr=fr.id;const gr=fr.buffer;ir.then(()=>{try{const _r=nr(tr,gr);self.postMessage({type:"decode",id:fr.id,data:_r})}catch(_r){self.postMessage({type:"error",id:fr.id,error:_r})}});break}};function nr(hr,fr){const ur=new Uint8Array(fr),pr=hr.File3dm.fromByteArray(ur),gr=[],_r=[],mr=[],dr=[],vr=[],Ar=[],yr=[],wr=pr.objects(),br=wr.count;for(let Ur=0;Ur<br;Ur++){const Br=wr.get(Ur),Or=or(Br,pr);Br.delete(),Or&&gr.push(Or)}for(let Ur=0;Ur<pr.instanceDefinitions().count;Ur++){const Br=pr.instanceDefinitions().get(Ur),Or=lr(Br);Or.objectIds=Br.getObjectIds(),gr.push({geometry:null,attributes:Or,objectType:"InstanceDefinition"})}const Sr=[hr.TextureType.Diffuse,hr.TextureType.Bump,hr.TextureType.Transparency,hr.TextureType.Opacity,hr.TextureType.Emap],xr=[hr.TextureType.PBR_BaseColor,hr.TextureType.PBR_Subsurface,hr.TextureType.PBR_SubsurfaceScattering,hr.TextureType.PBR_SubsurfaceScatteringRadius,hr.TextureType.PBR_Metallic,hr.TextureType.PBR_Specular,hr.TextureType.PBR_SpecularTint,hr.TextureType.PBR_Roughness,hr.TextureType.PBR_Anisotropic,hr.TextureType.PBR_Anisotropic_Rotation,hr.TextureType.PBR_Sheen,hr.TextureType.PBR_SheenTint,hr.TextureType.PBR_Clearcoat,hr.TextureType.PBR_ClearcoatBump,hr.TextureType.PBR_ClearcoatRoughness,hr.TextureType.PBR_OpacityIor,hr.TextureType.PBR_OpacityRoughness,hr.TextureType.PBR_Emission,hr.TextureType.PBR_AmbientOcclusion,hr.TextureType.PBR_Displacement];for(let Ur=0;Ur<pr.materials().count;Ur++){const Br=pr.materials().get(Ur),Or=lr(Br),Dr=[];Dr.push(...sr(Br,Sr,pr)),Or.pbrSupported=Br.physicallyBased().supported,Or.pbrSupported&&(Dr.push(...sr(Br,xr,pr)),Or.pbr=lr(Br.physicallyBased())),Or.textures=Dr,_r.push(Or),Br.delete()}for(let Ur=0;Ur<pr.layers().count;Ur++){const Br=pr.layers().get(Ur),Or=lr(Br);mr.push(Or),Br.delete()}for(let Ur=0;Ur<pr.views().count;Ur++){const Br=pr.views().get(Ur),Or=lr(Br);dr.push(Or),Br.delete()}for(let Ur=0;Ur<pr.namedViews().count;Ur++){const Br=pr.namedViews().get(Ur),Or=lr(Br);vr.push(Or),Br.delete()}for(let Ur=0;Ur<pr.groups().count;Ur++){const Br=pr.groups().get(Ur),Or=lr(Br);Ar.push(Or),Br.delete()}const Cr=lr(pr.settings()),Ir=pr.strings().count;for(let Ur=0;Ur<Ir;Ur++)yr.push(pr.strings().get(Ur));const Rr=pr.settings().renderSettings().renderEnvironments.reflectionId,Pr=pr.renderContent();let Fr=null;for(let Ur=0;Ur<Pr.count;Ur++){const Br=Pr.get(Ur);switch(Br.kind){case"environment":if(Br.id!==Rr)break;const Wr=Br.findChild("texture").fileName;for(let $r=0;$r<pr.embeddedFiles().count;$r++){const Yr=pr.embeddedFiles().get($r).fileName;Wr===Yr&&(Fr={type:"renderEnvironment",image:"data:image/png;base64,"+pr.getEmbeddedFileAsBase64(Wr),name:Wr})}break}}const Nr={ambientLight:pr.settings().renderSettings().ambientLight,backgroundColorTop:pr.settings().renderSettings().backgroundColorTop,backgroundColorBottom:pr.settings().renderSettings().backgroundColorBottom,useHiddenLights:pr.settings().renderSettings().useHiddenLights,depthCue:pr.settings().renderSettings().depthCue,flatShade:pr.settings().renderSettings().flatShade,renderBackFaces:pr.settings().renderSettings().renderBackFaces,renderPoints:pr.settings().renderSettings().renderPoints,renderCurves:pr.settings().renderSettings().renderCurves,renderIsoParams:pr.settings().renderSettings().renderIsoParams,renderMeshEdges:pr.settings().renderSettings().renderMeshEdges,renderAnnotations:pr.settings().renderSettings().renderAnnotations,useViewportSize:pr.settings().renderSettings().useViewportSize,scaleBackgroundToFit:pr.settings().renderSettings().scaleBackgroundToFit,transparentBackground:pr.settings().renderSettings().transparentBackground,imageDpi:pr.settings().renderSettings().imageDpi,shadowMapLevel:pr.settings().renderSettings().shadowMapLevel,namedView:pr.settings().renderSettings().namedView,snapShot:pr.settings().renderSettings().snapShot,specificViewport:pr.settings().renderSettings().specificViewport,groundPlane:lr(pr.settings().renderSettings().groundPlane),safeFrame:lr(pr.settings().renderSettings().safeFrame),dithering:lr(pr.settings().renderSettings().dithering),skylight:lr(pr.settings().renderSettings().skylight),linearWorkflow:lr(pr.settings().renderSettings().linearWorkflow),renderChannels:lr(pr.settings().renderSettings().renderChannels),sun:lr(pr.settings().renderSettings().sun),renderEnvironments:lr(pr.settings().renderSettings().renderEnvironments),postEffects:lr(pr.settings().renderSettings().postEffects)};return pr.delete(),{objects:gr,materials:_r,layers:mr,views:dr,namedViews:vr,groups:Ar,strings:yr,settings:Cr,renderSettings:Nr,renderEnvironment:Fr}}function sr(hr,fr,ur){const pr=[];for(let gr=0;gr<fr.length;gr++){const _r=hr.getTexture(fr[gr]);if(_r){let mr=fr[gr].constructor.name;mr=mr.substring(12,mr.length);const dr=ar(_r,mr,ur);pr.push(dr),_r.delete()}}return pr}function ar(hr,fr,ur){const pr={type:fr},gr=ur.getEmbeddedFileAsBase64(hr.fileName);pr.wrapU=hr.wrapU,pr.wrapV=hr.wrapV,pr.wrapW=hr.wrapW;const _r=hr.uvwTransform.toFloatArray(!0);return pr.repeat=[_r[0],_r[5]],gr?pr.image="data:image/png;base64,"+gr:(self.postMessage({type:"warning",id:rr,data:{message:`THREE.3DMLoader: Image for ${fr} texture not embedded in file.`,type:"missing resource"}}),pr.image=null),pr}function or(hr,fr){const ur=hr.geometry(),pr=hr.attributes();let gr=ur.objectType,_r,mr,dr,vr,Ar;switch(gr){case tr.ObjectType.Curve:const yr=cr(ur,100);dr={},mr={},vr={},dr.itemSize=3,dr.type="Float32Array",dr.array=[];for(let Cr=0;Cr<yr.length;Cr++)dr.array.push(yr[Cr][0]),dr.array.push(yr[Cr][1]),dr.array.push(yr[Cr][2]);mr.position=dr,vr.attributes=mr,_r={data:vr};break;case tr.ObjectType.Point:const wr=ur.location;dr={};const br={};mr={},vr={},dr.itemSize=3,dr.type="Float32Array",dr.array=[wr[0],wr[1],wr[2]];const Sr=pr.drawColor(fr);br.itemSize=3,br.type="Float32Array",br.array=[Sr.r/255,Sr.g/255,Sr.b/255],mr.position=dr,mr.color=br,vr.attributes=mr,_r={data:vr};break;case tr.ObjectType.PointSet:case tr.ObjectType.Mesh:_r=ur.toThreejsJSON();break;case tr.ObjectType.Brep:const xr=ur.faces();Ar=new tr.Mesh;for(let Cr=0;Cr<xr.count;Cr++){const Ir=xr.get(Cr),Rr=Ir.getMesh(tr.MeshType.Any);Rr&&(Ar.append(Rr),Rr.delete()),Ir.delete()}Ar.faces().count>0&&(Ar.compact(),_r=Ar.toThreejsJSON(),xr.delete()),Ar.delete();break;case tr.ObjectType.Extrusion:Ar=ur.getMesh(tr.MeshType.Any),Ar&&(_r=Ar.toThreejsJSON(),Ar.delete());break;case tr.ObjectType.TextDot:_r=lr(ur);break;case tr.ObjectType.Light:_r=lr(ur),_r.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:rr,data:{message:`THREE.3DMLoader: No conversion exists for ${gr.constructor.name} ${_r.lightStyle.name}`,type:"no conversion",guid:pr.id}});break;case tr.ObjectType.InstanceReference:_r=lr(ur),_r.xform=lr(ur.xform),_r.xform.array=ur.xform.toFloatArray(!0);break;case tr.ObjectType.SubD:ur.subdivide(3),Ar=tr.Mesh.createFromSubDControlNet(ur,!1),Ar&&(_r=Ar.toThreejsJSON(),Ar.delete());break;default:self.postMessage({type:"warning",id:rr,data:{message:`THREE.3DMLoader: Conversion not implemented for ${gr.constructor.name}`,type:"not implemented",guid:pr.id}});break}if(_r)return mr=lr(pr),mr.geometry=lr(ur),pr.groupCount>0&&(mr.groupIds=pr.getGroupList()),pr.userStringCount>0&&(mr.userStrings=pr.getUserStrings()),ur.userStringCount>0&&(mr.geometry.userStrings=ur.getUserStrings()),pr.decals().count>0&&self.postMessage({type:"warning",id:rr,data:{message:"THREE.3DMLoader: No conversion exists for the decals associated with this object.",type:"no conversion",guid:pr.id}}),mr.drawColor=pr.drawColor(fr),gr=gr.constructor.name,gr=gr.substring(11,gr.length),{geometry:_r,attributes:mr,objectType:gr};self.postMessage({type:"warning",id:rr,data:{message:`THREE.3DMLoader: ${gr.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:pr.id}})}function lr(hr){const fr={};for(const ur in hr){const pr=hr[ur];typeof pr!="function"&&(typeof pr=="object"&&pr!==null&&pr.hasOwnProperty("constructor")?fr[ur]={name:pr.constructor.name,value:pr.value}:typeof pr=="object"&&pr!==null?fr[ur]=lr(pr):fr[ur]=pr)}return fr}function cr(hr,fr){let ur=fr,pr=[];const gr=[];if(hr instanceof tr.LineCurve)return[hr.pointAtStart,hr.pointAtEnd];if(hr instanceof tr.PolylineCurve){ur=hr.pointCount;for(let dr=0;dr<ur;dr++)pr.push(hr.point(dr));return pr}if(hr instanceof tr.PolyCurve){const dr=hr.segmentCount;for(let vr=0;vr<dr;vr++){const Ar=hr.segmentCurve(vr),yr=cr(Ar,ur);pr=pr.concat(yr),Ar.delete()}return pr}if(hr instanceof tr.ArcCurve&&(ur=Math.floor(hr.angleDegrees/5),ur=ur<2?2:ur),hr instanceof tr.NurbsCurve&&hr.degree===1){const dr=hr.tryGetPolyline();for(let vr=0;vr<dr.count;vr++)pr.push(dr.get(vr));return dr.delete(),pr}const _r=hr.domain,mr=ur-1;for(let dr=0;dr<ur;dr++){const vr=_r[0]+dr/mr*(_r[1]-_r[0]);if(vr===_r[0]||vr===_r[1]){gr.push(vr);continue}const Ar=hr.tangentAt(vr),yr=hr.tangentAt(gr.slice(-1)[0]),wr=Ar[0]*Ar[0]+Ar[1]*Ar[1]+Ar[2]*Ar[2],br=yr[0]*yr[0]+yr[1]*yr[1]+yr[2]*yr[2],Sr=Math.sqrt(wr*br);let xr;if(Sr===0)xr=Math.PI/2;else{const Cr=(Ar.x*yr.x+Ar.y*yr.y+Ar.z*yr.z)/Sr;xr=Math.acos(Math.max(-1,Math.min(1,Cr)))}xr<.1||gr.push(vr)}return pr=gr.map(dr=>hr.pointAt(dr)),pr}}const COLOR_SPACE_3MF=SRGBColorSpace;class ThreeMFLoader extends Loader{constructor(er){super(er),this.availableExtensions=[]}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr=this,rr=new TextureLoader(this.manager);function nr(Vr){let Gr=null,qr=null,ji,Zr;const Zi=[],Yi=[];let qi;const Xr={},ns={},os={},us=new TextDecoder;try{Gr=unzipSync(new Uint8Array(Vr))}catch(Ki){if(Ki instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}for(qr in Gr)qr.match(/\_rels\/.rels$/)?ji=qr:qr.match(/3D\/_rels\/.*\.model\.rels$/)?Zr=qr:qr.match(/^3D\/.*\.model$/)?Zi.push(qr):qr.match(/^3D\/Textures?\/.*/)&&Yi.push(qr);if(ji===void 0)throw new Error("THREE.ThreeMFLoader: Cannot find relationship file `rels` in 3MF archive.");const is=Gr[ji],Ji=us.decode(is),ms=sr(Ji);if(Zr){const Ki=Gr[Zr],Ni=us.decode(Ki);qi=sr(Ni)}for(let Ki=0;Ki<Zi.length;Ki++){const Ni=Zi[Ki],Ri=Gr[Ni],Jr=us.decode(Ri),Xi=new DOMParser().parseFromString(Jr,"application/xml");Xi.documentElement.nodeName.toLowerCase()!=="model"&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",Ni);const ss=Xi.querySelector("model"),ls={};for(let _s=0;_s<ss.attributes.length;_s++){const vs=ss.attributes[_s];vs.name.match(/^xmlns:(.+)$/)&&(ls[vs.value]=RegExp.$1)}const gs=br(ss);gs.xml=ss,0<Object.keys(ls).length&&(gs.extensions=ls),Xr[Ni]=gs}for(let Ki=0;Ki<Yi.length;Ki++){const Ni=Yi[Ki];os[Ni]=Gr[Ni].buffer}return{rels:ms,modelRels:qi,model:Xr,printTicket:ns,texture:os}}function sr(Vr){const Gr=[],ji=new DOMParser().parseFromString(Vr,"application/xml").querySelectorAll("Relationship");for(let Zr=0;Zr<ji.length;Zr++){const Zi=ji[Zr],Yi={target:Zi.getAttribute("Target"),id:Zi.getAttribute("Id"),type:Zi.getAttribute("Type")};Gr.push(Yi)}return Gr}function ar(Vr){const Gr={};for(let qr=0;qr<Vr.length;qr++){const ji=Vr[qr],Zr=ji.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(Zr)&&(Gr[Zr]=ji.textContent)}return Gr}function or(Vr){const Gr={id:Vr.getAttribute("id"),basematerials:[]},qr=Vr.querySelectorAll("base");for(let ji=0;ji<qr.length;ji++){const Zr=qr[ji],Zi=gr(Zr);Zi.index=ji,Gr.basematerials.push(Zi)}return Gr}function lr(Vr){return{id:Vr.getAttribute("id"),path:Vr.getAttribute("path"),contenttype:Vr.getAttribute("contenttype"),tilestyleu:Vr.getAttribute("tilestyleu"),tilestylev:Vr.getAttribute("tilestylev"),filter:Vr.getAttribute("filter")}}function cr(Vr){const Gr={id:Vr.getAttribute("id"),texid:Vr.getAttribute("texid"),displaypropertiesid:Vr.getAttribute("displaypropertiesid")},qr=Vr.querySelectorAll("tex2coord"),ji=[];for(let Zr=0;Zr<qr.length;Zr++){const Zi=qr[Zr],Yi=Zi.getAttribute("u"),qi=Zi.getAttribute("v");ji.push(parseFloat(Yi),parseFloat(qi))}return Gr.uvs=new Float32Array(ji),Gr}function hr(Vr){const Gr={id:Vr.getAttribute("id"),displaypropertiesid:Vr.getAttribute("displaypropertiesid")},qr=Vr.querySelectorAll("color"),ji=[],Zr=new Color;for(let Zi=0;Zi<qr.length;Zi++){const qi=qr[Zi].getAttribute("color");Zr.setStyle(qi.substring(0,7),COLOR_SPACE_3MF),ji.push(Zr.r,Zr.g,Zr.b)}return Gr.colors=new Float32Array(ji),Gr}function fr(Vr){const Gr=Vr.children,qr={};for(let ji=0;ji<Gr.length;ji++){const Zr={type:Gr[ji].nodeName.substring(2)};for(let Zi=0;Zi<Gr[ji].attributes.length;Zi++){const Yi=Gr[ji].attributes[Zi];Yi.specified&&(Zr[Yi.name]=Yi.value)}qr[Gr[ji].getAttribute("identifier")]=Zr}return qr}function ur(Vr){const Gr={id:Vr.getAttribute("id"),displayname:Vr.getAttribute("displayname")},qr=Vr.children,ji={};for(let Zr=0;Zr<qr.length;Zr++){const Zi=qr[Zr];if(Zi.nodeName==="i:in"||Zi.nodeName==="i:out")ji[Zi.nodeName==="i:in"?"inputs":"outputs"]=fr(Zi);else{const Yi=Zi.children,qi={op:Zi.nodeName.substring(2),identifier:Zi.getAttribute("identifier")};for(let Xr=0;Xr<Yi.length;Xr++)qi[Yi[Xr].nodeName.substring(2)]=fr(Yi[Xr]);ji[qi.identifier]=qi}}return Gr.operations=ji,Gr}function pr(Vr){const Gr={id:Vr.getAttribute("id")},qr=Vr.querySelectorAll("pbmetallic"),ji=[];for(let Zr=0;Zr<qr.length;Zr++){const Zi=qr[Zr];ji.push({name:Zi.getAttribute("name"),metallicness:parseFloat(Zi.getAttribute("metallicness")),roughness:parseFloat(Zi.getAttribute("roughness"))})}return Gr.data=ji,Gr}function gr(Vr){const Gr={};return Gr.name=Vr.getAttribute("name"),Gr.displaycolor=Vr.getAttribute("displaycolor"),Gr.displaypropertiesid=Vr.getAttribute("displaypropertiesid"),Gr}function _r(Vr){const Gr={},qr=[],ji=Vr.querySelectorAll("vertices vertex");for(let qi=0;qi<ji.length;qi++){const Xr=ji[qi],ns=Xr.getAttribute("x"),os=Xr.getAttribute("y"),us=Xr.getAttribute("z");qr.push(parseFloat(ns),parseFloat(os),parseFloat(us))}Gr.vertices=new Float32Array(qr);const Zr=[],Zi=[],Yi=Vr.querySelectorAll("triangles triangle");for(let qi=0;qi<Yi.length;qi++){const Xr=Yi[qi],ns=Xr.getAttribute("v1"),os=Xr.getAttribute("v2"),us=Xr.getAttribute("v3"),is=Xr.getAttribute("p1"),Ji=Xr.getAttribute("p2"),ms=Xr.getAttribute("p3"),Ki=Xr.getAttribute("pid"),Ni={};Ni.v1=parseInt(ns,10),Ni.v2=parseInt(os,10),Ni.v3=parseInt(us,10),Zi.push(Ni.v1,Ni.v2,Ni.v3),is&&(Ni.p1=parseInt(is,10)),Ji&&(Ni.p2=parseInt(Ji,10)),ms&&(Ni.p3=parseInt(ms,10)),Ki&&(Ni.pid=Ki),0<Object.keys(Ni).length&&Zr.push(Ni)}return Gr.triangleProperties=Zr,Gr.triangles=new Uint32Array(Zi),Gr}function mr(Vr){const Gr=[],qr=Vr.querySelectorAll("component");for(let ji=0;ji<qr.length;ji++){const Zr=qr[ji],Zi=dr(Zr);Gr.push(Zi)}return Gr}function dr(Vr){const Gr={};Gr.objectId=Vr.getAttribute("objectid");const qr=Vr.getAttribute("transform");return qr&&(Gr.transform=vr(qr)),Gr}function vr(Vr){const Gr=[];Vr.split(" ").forEach(function(ji){Gr.push(parseFloat(ji))});const qr=new Matrix4;return qr.set(Gr[0],Gr[3],Gr[6],Gr[9],Gr[1],Gr[4],Gr[7],Gr[10],Gr[2],Gr[5],Gr[8],Gr[11],0,0,0,1),qr}function Ar(Vr){const Gr={type:Vr.getAttribute("type")},qr=Vr.getAttribute("id");qr&&(Gr.id=qr);const ji=Vr.getAttribute("pid");ji&&(Gr.pid=ji);const Zr=Vr.getAttribute("pindex");Zr&&(Gr.pindex=Zr);const Zi=Vr.getAttribute("thumbnail");Zi&&(Gr.thumbnail=Zi);const Yi=Vr.getAttribute("partnumber");Yi&&(Gr.partnumber=Yi);const qi=Vr.getAttribute("name");qi&&(Gr.name=qi);const Xr=Vr.querySelector("mesh");Xr&&(Gr.mesh=_r(Xr));const ns=Vr.querySelector("components");return ns&&(Gr.components=mr(ns)),Gr}function yr(Vr){const Gr={};Gr.basematerials={};const qr=Vr.querySelectorAll("basematerials");for(let ns=0;ns<qr.length;ns++){const os=qr[ns],us=or(os);Gr.basematerials[us.id]=us}Gr.texture2d={};const ji=Vr.querySelectorAll("texture2d");for(let ns=0;ns<ji.length;ns++){const os=ji[ns],us=lr(os);Gr.texture2d[us.id]=us}Gr.colorgroup={};const Zr=Vr.querySelectorAll("colorgroup");for(let ns=0;ns<Zr.length;ns++){const os=Zr[ns],us=hr(os);Gr.colorgroup[us.id]=us}const Zi=Vr.querySelectorAll("implicitfunction");Zi.length>0&&(Gr.implicitfunction={});for(let ns=0;ns<Zi.length;ns++){const os=Zi[ns],us=ur(os);Gr.implicitfunction[us.id]=us}Gr.pbmetallicdisplayproperties={};const Yi=Vr.querySelectorAll("pbmetallicdisplayproperties");for(let ns=0;ns<Yi.length;ns++){const os=Yi[ns],us=pr(os);Gr.pbmetallicdisplayproperties[us.id]=us}Gr.texture2dgroup={};const qi=Vr.querySelectorAll("texture2dgroup");for(let ns=0;ns<qi.length;ns++){const os=qi[ns],us=cr(os);Gr.texture2dgroup[us.id]=us}Gr.object={};const Xr=Vr.querySelectorAll("object");for(let ns=0;ns<Xr.length;ns++){const os=Xr[ns],us=Ar(os);Gr.object[us.id]=us}return Gr}function wr(Vr){const Gr=[],qr=Vr.querySelectorAll("item");for(let ji=0;ji<qr.length;ji++){const Zr=qr[ji],Zi={objectId:Zr.getAttribute("objectid")},Yi=Zr.getAttribute("transform");Yi&&(Zi.transform=vr(Yi)),Gr.push(Zi)}return Gr}function br(Vr){const Gr={unit:Vr.getAttribute("unit")||"millimeter"},qr=Vr.querySelectorAll("metadata");qr&&(Gr.metadata=ar(qr));const ji=Vr.querySelector("resources");ji&&(Gr.resources=yr(ji));const Zr=Vr.querySelector("build");return Zr&&(Gr.build=wr(Zr)),Gr}function Sr(Vr,Gr,qr,ji){const Zr=Vr.texid,Yi=qr.resources.texture2d[Zr];if(Yi){const qi=ji[Yi.path],Xr=Yi.contenttype,ns=new Blob([qi],{type:Xr}),os=URL.createObjectURL(ns),us=rr.load(os,function(){URL.revokeObjectURL(os)});switch(us.colorSpace=COLOR_SPACE_3MF,Yi.tilestyleu){case"wrap":us.wrapS=RepeatWrapping;break;case"mirror":us.wrapS=MirroredRepeatWrapping;break;case"none":case"clamp":us.wrapS=ClampToEdgeWrapping;break;default:us.wrapS=RepeatWrapping}switch(Yi.tilestylev){case"wrap":us.wrapT=RepeatWrapping;break;case"mirror":us.wrapT=MirroredRepeatWrapping;break;case"none":case"clamp":us.wrapT=ClampToEdgeWrapping;break;default:us.wrapT=RepeatWrapping}switch(Yi.filter){case"auto":us.magFilter=LinearFilter,us.minFilter=LinearMipmapLinearFilter;break;case"linear":us.magFilter=LinearFilter,us.minFilter=LinearFilter,us.generateMipmaps=!1;break;case"nearest":us.magFilter=NearestFilter,us.minFilter=NearestFilter,us.generateMipmaps=!1;break;default:us.magFilter=LinearFilter,us.minFilter=LinearMipmapLinearFilter}return us}else return null}function xr(Vr,Gr,qr,ji,Zr,Zi,Yi){const qi=Yi.pindex,Xr={};for(let us=0,is=Gr.length;us<is;us++){const Ji=Gr[us],ms=Ji.p1!==void 0?Ji.p1:qi;Xr[ms]===void 0&&(Xr[ms]=[]),Xr[ms].push(Ji)}const ns=Object.keys(Xr),os=[];for(let us=0,is=ns.length;us<is;us++){const Ji=ns[us],ms=Xr[Ji],Ki=Vr.basematerials[Ji],Ni=Or(Ki,ji,Zr,Zi,Yi,Dr),Ri=new BufferGeometry,Jr=[],Xi=qr.vertices;for(let ls=0,gs=ms.length;ls<gs;ls++){const _s=ms[ls];Jr.push(Xi[_s.v1*3+0]),Jr.push(Xi[_s.v1*3+1]),Jr.push(Xi[_s.v1*3+2]),Jr.push(Xi[_s.v2*3+0]),Jr.push(Xi[_s.v2*3+1]),Jr.push(Xi[_s.v2*3+2]),Jr.push(Xi[_s.v3*3+0]),Jr.push(Xi[_s.v3*3+1]),Jr.push(Xi[_s.v3*3+2])}Ri.setAttribute("position",new Float32BufferAttribute(Jr,3));const ss=new Mesh(Ri,Ni);os.push(ss)}return os}function Cr(Vr,Gr,qr,ji,Zr,Zi,Yi){const qi=new BufferGeometry,Xr=[],ns=[],os=qr.vertices,us=Vr.uvs;for(let Ki=0,Ni=Gr.length;Ki<Ni;Ki++){const Ri=Gr[Ki];Xr.push(os[Ri.v1*3+0]),Xr.push(os[Ri.v1*3+1]),Xr.push(os[Ri.v1*3+2]),Xr.push(os[Ri.v2*3+0]),Xr.push(os[Ri.v2*3+1]),Xr.push(os[Ri.v2*3+2]),Xr.push(os[Ri.v3*3+0]),Xr.push(os[Ri.v3*3+1]),Xr.push(os[Ri.v3*3+2]),ns.push(us[Ri.p1*2+0]),ns.push(us[Ri.p1*2+1]),ns.push(us[Ri.p2*2+0]),ns.push(us[Ri.p2*2+1]),ns.push(us[Ri.p3*2+0]),ns.push(us[Ri.p3*2+1])}qi.setAttribute("position",new Float32BufferAttribute(Xr,3)),qi.setAttribute("uv",new Float32BufferAttribute(ns,2));const is=Or(Vr,ji,Zr,Zi,Yi,Sr),Ji=new MeshPhongMaterial({map:is,flatShading:!0});return new Mesh(qi,Ji)}function Ir(Vr,Gr,qr,ji){const Zr=new BufferGeometry,Zi=[],Yi=[],qi=qr.vertices,Xr=Vr.colors;for(let us=0,is=Gr.length;us<is;us++){const Ji=Gr[us],ms=Ji.v1,Ki=Ji.v2,Ni=Ji.v3;Zi.push(qi[ms*3+0]),Zi.push(qi[ms*3+1]),Zi.push(qi[ms*3+2]),Zi.push(qi[Ki*3+0]),Zi.push(qi[Ki*3+1]),Zi.push(qi[Ki*3+2]),Zi.push(qi[Ni*3+0]),Zi.push(qi[Ni*3+1]),Zi.push(qi[Ni*3+2]);const Ri=Ji.p1!==void 0?Ji.p1:ji.pindex,Jr=Ji.p2!==void 0?Ji.p2:Ri,Xi=Ji.p3!==void 0?Ji.p3:Ri;Yi.push(Xr[Ri*3+0]),Yi.push(Xr[Ri*3+1]),Yi.push(Xr[Ri*3+2]),Yi.push(Xr[Jr*3+0]),Yi.push(Xr[Jr*3+1]),Yi.push(Xr[Jr*3+2]),Yi.push(Xr[Xi*3+0]),Yi.push(Xr[Xi*3+1]),Yi.push(Xr[Xi*3+2])}Zr.setAttribute("position",new Float32BufferAttribute(Zi,3)),Zr.setAttribute("color",new Float32BufferAttribute(Yi,3));const ns=new MeshPhongMaterial({vertexColors:!0,flatShading:!0});return new Mesh(Zr,ns)}function Rr(Vr){const Gr=new BufferGeometry;Gr.setIndex(new BufferAttribute(Vr.triangles,1)),Gr.setAttribute("position",new BufferAttribute(Vr.vertices,3));const qr=new MeshPhongMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16777215,flatShading:!0});return new Mesh(Gr,qr)}function Pr(Vr,Gr,qr,ji,Zr,Zi){const Yi=Object.keys(Vr),qi=[];for(let Xr=0,ns=Yi.length;Xr<ns;Xr++){const os=Yi[Xr],us=Vr[os];switch(Fr(os,ji)){case"material":const Ji=ji.resources.basematerials[os],ms=xr(Ji,us,Gr,qr,ji,Zr,Zi);for(let Ri=0,Jr=ms.length;Ri<Jr;Ri++)qi.push(ms[Ri]);break;case"texture":const Ki=ji.resources.texture2dgroup[os];qi.push(Cr(Ki,us,Gr,qr,ji,Zr,Zi));break;case"vertexColors":const Ni=ji.resources.colorgroup[os];qi.push(Ir(Ni,us,Gr,Zi));break;case"default":qi.push(Rr(Gr));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}if(Zi.name)for(let Xr=0;Xr<qi.length;Xr++)qi[Xr].name=Zi.name;return qi}function Fr(Vr,Gr){return Gr.resources.texture2dgroup[Vr]!==void 0?"texture":Gr.resources.basematerials[Vr]!==void 0?"material":Gr.resources.colorgroup[Vr]!==void 0?"vertexColors":Vr==="default"?"default":void 0}function Nr(Vr,Gr){const qr={},ji=Vr.triangleProperties,Zr=Gr.pid;for(let Zi=0,Yi=ji.length;Zi<Yi;Zi++){const qi=ji[Zi];let Xr=qi.pid!==void 0?qi.pid:Zr;Xr===void 0&&(Xr="default"),qr[Xr]===void 0&&(qr[Xr]=[]),qr[Xr].push(qi)}return qr}function Ur(Vr,Gr,qr,ji,Zr){const Zi=new Group,Yi=Nr(Vr,Zr),qi=Pr(Yi,Vr,Gr,qr,ji,Zr);for(let Xr=0,ns=qi.length;Xr<ns;Xr++)Zi.add(qi[Xr]);return Zi}function Br(Vr,Gr,qr){if(!Vr)return;const ji=[],Zr=Object.keys(Vr);for(let Zi=0;Zi<Zr.length;Zi++){const Yi=Zr[Zi];for(let qi=0;qi<tr.availableExtensions.length;qi++){const Xr=tr.availableExtensions[qi];Xr.ns===Yi&&ji.push(Xr)}}for(let Zi=0;Zi<ji.length;Zi++){const Yi=ji[Zi];Yi.apply(qr,Vr[Yi.ns],Gr)}}function Or(Vr,Gr,qr,ji,Zr,Zi){return Vr.build!==void 0||(Vr.build=Zi(Vr,Gr,qr,ji,Zr)),Vr.build}function Dr(Vr,Gr,qr){let ji;const Zr=Vr.displaypropertiesid,Zi=qr.resources.pbmetallicdisplayproperties;if(Zr!==null&&Zi[Zr]!==void 0){const ns=Zi[Zr].data[Vr.index];ji=new MeshStandardMaterial({flatShading:!0,roughness:ns.roughness,metalness:ns.metallicness})}else ji=new MeshPhongMaterial({flatShading:!0});ji.name=Vr.name;const Yi=Vr.displaycolor,qi=Yi.substring(0,7);return ji.color.setStyle(qi,COLOR_SPACE_3MF),Yi.length===9&&(ji.opacity=parseInt(Yi.charAt(7)+Yi.charAt(8),16)/255),ji}function Wr(Vr,Gr,qr,ji){const Zr=new Group;for(let Zi=0;Zi<Vr.length;Zi++){const Yi=Vr[Zi];let qi=Gr[Yi.objectId];qi===void 0&&($r(Yi.objectId,Gr,qr,ji),qi=Gr[Yi.objectId]);const Xr=qi.clone(),ns=Yi.transform;ns&&Xr.applyMatrix4(ns),Zr.add(Xr)}return Zr}function $r(Vr,Gr,qr,ji){const Zr=qr.resources.object[Vr];if(Zr.mesh){const Zi=Zr.mesh,Yi=qr.extensions,qi=qr.xml;Br(Yi,Zi,qi),Gr[Zr.id]=Or(Zi,Gr,qr,ji,Zr,Ur)}else{const Zi=Zr.components;Gr[Zr.id]=Or(Zi,Gr,qr,ji,Zr,Wr)}Zr.name&&(Gr[Zr.id].name=Zr.name),qr.resources.implicitfunction&&console.warn("THREE.ThreeMFLoader: Implicit Functions are implemented in data-only.",qr.resources.implicitfunction)}function Yr(Vr){const Gr=Vr.model,qr=Vr.modelRels,ji={},Zr=Object.keys(Gr),Zi={};if(qr)for(let Yi=0,qi=qr.length;Yi<qi;Yi++){const Xr=qr[Yi],ns=Xr.target.substring(1);Vr.texture[ns]&&(Zi[Xr.target]=Vr.texture[ns])}for(let Yi=0;Yi<Zr.length;Yi++){const qi=Zr[Yi],Xr=Gr[qi],ns=Object.keys(Xr.resources.object);for(let os=0;os<ns.length;os++){const us=ns[os];$r(us,ji,Xr,Zi)}}return ji}function Qi(Vr){for(let Gr=0;Gr<Vr.length;Gr++){const qr=Vr[Gr];if(qr.target.split(".").pop().toLowerCase()==="model")return qr}}function rs(Vr,Gr){const qr=new Group,ji=Qi(Gr.rels),Zr=Gr.model[ji.target.substring(1)].build;for(let Zi=0;Zi<Zr.length;Zi++){const Yi=Zr[Zi],qi=Vr[Yi.objectId].clone(),Xr=Yi.transform;Xr&&qi.applyMatrix4(Xr),qr.add(qi)}return qr}const Kr=nr(er),Qr=Yr(Kr);return rs(Qr,Kr)}addExtension(er){this.availableExtensions.push(er)}}class AMFLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){function tr(yr){let wr=new DataView(yr);if(String.fromCharCode(wr.getUint8(0),wr.getUint8(1))==="PK"){let Cr=null,Ir=null;console.log("THREE.AMFLoader: Loading Zip");try{Cr=unzipSync(new Uint8Array(yr))}catch(Rr){if(Rr instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(Ir in Cr)if(Ir.toLowerCase().slice(-4)===".amf")break;console.log("THREE.AMFLoader: Trying to load file asset: "+Ir),wr=new DataView(Cr[Ir].buffer)}const Sr=new TextDecoder().decode(wr),xr=new DOMParser().parseFromString(Sr,"application/xml");return xr.documentElement.nodeName.toLowerCase()!=="amf"?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):xr}function rr(yr){let wr=1,br="millimeter";yr.documentElement.attributes.unit!==void 0&&(br=yr.documentElement.attributes.unit.value.toLowerCase());const Sr={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return Sr[br]!==void 0&&(wr=Sr[br]),console.log("THREE.AMFLoader: Unit scale: "+wr),wr}function nr(yr){let wr="AMF Material";const br=yr.attributes.id.textContent;let Sr={r:1,g:1,b:1,a:1},xr=null;for(let Cr=0;Cr<yr.childNodes.length;Cr++){const Ir=yr.childNodes[Cr];Ir.nodeName==="metadata"&&Ir.attributes.type!==void 0?Ir.attributes.type.value==="name"&&(wr=Ir.textContent):Ir.nodeName==="color"&&(Sr=sr(Ir))}return xr=new MeshPhongMaterial({flatShading:!0,color:new Color(Sr.r,Sr.g,Sr.b),name:wr}),Sr.a!==1&&(xr.transparent=!0,xr.opacity=Sr.a),{id:br,material:xr}}function sr(yr){const wr={r:1,g:1,b:1,a:1};for(let br=0;br<yr.childNodes.length;br++){const Sr=yr.childNodes[br];Sr.nodeName==="r"?wr.r=Sr.textContent:Sr.nodeName==="g"?wr.g=Sr.textContent:Sr.nodeName==="b"?wr.b=Sr.textContent:Sr.nodeName==="a"&&(wr.a=Sr.textContent)}return wr}function ar(yr){const wr={name:"",triangles:[],materialid:null};let br=yr.firstElementChild;for(yr.attributes.materialid!==void 0&&(wr.materialId=yr.attributes.materialid.nodeValue);br;){if(br.nodeName==="metadata")br.attributes.type!==void 0&&br.attributes.type.value==="name"&&(wr.name=br.textContent);else if(br.nodeName==="triangle"){const Sr=br.getElementsByTagName("v1")[0].textContent,xr=br.getElementsByTagName("v2")[0].textContent,Cr=br.getElementsByTagName("v3")[0].textContent;wr.triangles.push(Sr,xr,Cr)}br=br.nextElementSibling}return wr}function or(yr){const wr=[],br=[];let Sr=yr.firstElementChild;for(;Sr;){if(Sr.nodeName==="vertex"){let xr=Sr.firstElementChild;for(;xr;){if(xr.nodeName==="coordinates"){const Cr=xr.getElementsByTagName("x")[0].textContent,Ir=xr.getElementsByTagName("y")[0].textContent,Rr=xr.getElementsByTagName("z")[0].textContent;wr.push(Cr,Ir,Rr)}else if(xr.nodeName==="normal"){const Cr=xr.getElementsByTagName("nx")[0].textContent,Ir=xr.getElementsByTagName("ny")[0].textContent,Rr=xr.getElementsByTagName("nz")[0].textContent;br.push(Cr,Ir,Rr)}xr=xr.nextElementSibling}}Sr=Sr.nextElementSibling}return{vertices:wr,normals:br}}function lr(yr){const wr=yr.attributes.id.textContent,br={name:"amfobject",meshes:[]};let Sr=null,xr=yr.firstElementChild;for(;xr;){if(xr.nodeName==="metadata")xr.attributes.type!==void 0&&xr.attributes.type.value==="name"&&(br.name=xr.textContent);else if(xr.nodeName==="color")Sr=sr(xr);else if(xr.nodeName==="mesh"){let Cr=xr.firstElementChild;const Ir={vertices:[],normals:[],volumes:[],color:Sr};for(;Cr;){if(Cr.nodeName==="vertices"){const Rr=or(Cr);Ir.normals=Ir.normals.concat(Rr.normals),Ir.vertices=Ir.vertices.concat(Rr.vertices)}else Cr.nodeName==="volume"&&Ir.volumes.push(ar(Cr));Cr=Cr.nextElementSibling}br.meshes.push(Ir)}xr=xr.nextElementSibling}return{id:wr,obj:br}}const cr=tr(er);let hr="",fr="";const ur=rr(cr),pr={},gr={},_r=cr.documentElement.childNodes;let mr,dr;for(mr=0;mr<_r.length;mr++){const yr=_r[mr];if(yr.nodeName==="metadata")yr.attributes.type!==void 0&&(yr.attributes.type.value==="name"?hr=yr.textContent:yr.attributes.type.value==="author"&&(fr=yr.textContent));else if(yr.nodeName==="material"){const wr=nr(yr);pr[wr.id]=wr.material}else if(yr.nodeName==="object"){const wr=lr(yr);gr[wr.id]=wr.obj}}const vr=new Group,Ar=new MeshPhongMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:11184895,flatShading:!0});vr.name=hr,vr.userData.author=fr,vr.userData.loader="AMF";for(const yr in gr){const wr=gr[yr],br=wr.meshes,Sr=new Group;for(Sr.name=wr.name||"",mr=0;mr<br.length;mr++){let xr=Ar;const Cr=br[mr],Ir=new Float32BufferAttribute(Cr.vertices,3);let Rr=null;if(Cr.normals.length&&(Rr=new Float32BufferAttribute(Cr.normals,3)),Cr.color){const Fr=Cr.color;xr=Ar.clone(),xr.color=new Color(Fr.r,Fr.g,Fr.b),Fr.a!==1&&(xr.transparent=!0,xr.opacity=Fr.a)}const Pr=Cr.volumes;for(dr=0;dr<Pr.length;dr++){const Fr=Pr[dr],Nr=new BufferGeometry;let Ur=xr;Nr.setIndex(Fr.triangles),Nr.setAttribute("position",Ir.clone()),Rr&&Nr.setAttribute("normal",Rr.clone()),pr[Fr.materialId]!==void 0&&(Ur=pr[Fr.materialId]),Nr.scale(ur,ur,ur),Sr.add(new Mesh(Nr,Ur.clone()))}}vr.add(Sr)}return vr}}class BVHLoader extends Loader{constructor(er){super(er),this.animateBonePositions=!0,this.animateBoneRotations=!0}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){function tr(pr){or(pr)!=="HIERARCHY"&&console.error("THREE.BVHLoader: HIERARCHY expected.");const gr=[],_r=nr(pr,or(pr),gr);or(pr)!=="MOTION"&&console.error("THREE.BVHLoader: MOTION expected.");let mr=or(pr).split(/[\s]+/);const dr=parseInt(mr[1]);isNaN(dr)&&console.error("THREE.BVHLoader: Failed to read number of frames."),mr=or(pr).split(/[\s]+/);const vr=parseFloat(mr[2]);isNaN(vr)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(let Ar=0;Ar<dr;Ar++)mr=or(pr).split(/[\s]+/),rr(mr,Ar*vr,_r);return gr}function rr(pr,gr,_r){if(_r.type==="ENDSITE")return;const mr={time:gr,position:new Vector3$1,rotation:new Quaternion$1};_r.frames.push(mr);const dr=new Quaternion$1,vr=new Vector3$1(1,0,0),Ar=new Vector3$1(0,1,0),yr=new Vector3$1(0,0,1);for(let wr=0;wr<_r.channels.length;wr++)switch(_r.channels[wr]){case"Xposition":mr.position.x=parseFloat(pr.shift().trim());break;case"Yposition":mr.position.y=parseFloat(pr.shift().trim());break;case"Zposition":mr.position.z=parseFloat(pr.shift().trim());break;case"Xrotation":dr.setFromAxisAngle(vr,parseFloat(pr.shift().trim())*Math.PI/180),mr.rotation.multiply(dr);break;case"Yrotation":dr.setFromAxisAngle(Ar,parseFloat(pr.shift().trim())*Math.PI/180),mr.rotation.multiply(dr);break;case"Zrotation":dr.setFromAxisAngle(yr,parseFloat(pr.shift().trim())*Math.PI/180),mr.rotation.multiply(dr);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(let wr=0;wr<_r.children.length;wr++)rr(pr,gr,_r.children[wr])}function nr(pr,gr,_r){const mr={name:"",type:"",frames:[]};_r.push(mr);let dr=gr.split(/[\s]+/);dr[0].toUpperCase()==="END"&&dr[1].toUpperCase()==="SITE"?(mr.type="ENDSITE",mr.name="ENDSITE"):(mr.name=dr[1],mr.type=dr[0].toUpperCase()),or(pr)!=="{"&&console.error("THREE.BVHLoader: Expected opening { after type & name"),dr=or(pr).split(/[\s]+/),dr[0]!=="OFFSET"&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+dr[0]),dr.length!==4&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");const vr=new Vector3$1(parseFloat(dr[1]),parseFloat(dr[2]),parseFloat(dr[3]));if((isNaN(vr.x)||isNaN(vr.y)||isNaN(vr.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),mr.offset=vr,mr.type!=="ENDSITE"){dr=or(pr).split(/[\s]+/),dr[0]!=="CHANNELS"&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");const Ar=parseInt(dr[1]);mr.channels=dr.splice(2,Ar),mr.children=[]}for(;;){const Ar=or(pr);if(Ar==="}")return mr;mr.children.push(nr(pr,Ar,_r))}}function sr(pr,gr){const _r=new Bone;if(gr.push(_r),_r.position.add(pr.offset),_r.name=pr.name,pr.type!=="ENDSITE")for(let mr=0;mr<pr.children.length;mr++)_r.add(sr(pr.children[mr],gr));return _r}function ar(pr){const gr=[];for(let _r=0;_r<pr.length;_r++){const mr=pr[_r];if(mr.type==="ENDSITE")continue;const dr=[],vr=[],Ar=[];for(let yr=0;yr<mr.frames.length;yr++){const wr=mr.frames[yr];dr.push(wr.time),vr.push(wr.position.x+mr.offset.x),vr.push(wr.position.y+mr.offset.y),vr.push(wr.position.z+mr.offset.z),Ar.push(wr.rotation.x),Ar.push(wr.rotation.y),Ar.push(wr.rotation.z),Ar.push(wr.rotation.w)}lr.animateBonePositions&&gr.push(new VectorKeyframeTrack(mr.name+".position",dr,vr)),lr.animateBoneRotations&&gr.push(new QuaternionKeyframeTrack(mr.name+".quaternion",dr,Ar))}return new AnimationClip("animation",-1,gr)}function or(pr){let gr;for(;(gr=pr.shift().trim()).length===0;);return gr}const lr=this,cr=er.split(/[\r\n]+/g),hr=tr(cr),fr=[];sr(hr[0],fr);const ur=ar(hr);return{skeleton:new Skeleton(fr),clip:ur}}}class TGALoader extends DataTextureLoader{constructor(er){super(er)}parse(er){function tr(Br){switch(Br.image_type){case ur:case _r:if(Br.colormap_length>256||Br.colormap_size!==24||Br.colormap_type!==1)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case pr:case gr:case mr:case dr:if(Br.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case fr:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+Br.image_type)}if(Br.width<=0||Br.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(Br.pixel_size!==8&&Br.pixel_size!==16&&Br.pixel_size!==24&&Br.pixel_size!==32)throw new Error("THREE.TGALoader: Invalid pixel size "+Br.pixel_size)}function rr(Br,Or,Dr,Wr,$r){let Yr,Qi;const rs=Dr.pixel_size>>3,Kr=Dr.width*Dr.height*rs;if(Or&&(Qi=$r.subarray(Wr,Wr+=Dr.colormap_length*(Dr.colormap_size>>3))),Br){Yr=new Uint8Array(Kr);let Qr,Vr,Gr,qr=0;const ji=new Uint8Array(rs);for(;qr<Kr;)if(Qr=$r[Wr++],Vr=(Qr&127)+1,Qr&128){for(Gr=0;Gr<rs;++Gr)ji[Gr]=$r[Wr++];for(Gr=0;Gr<Vr;++Gr)Yr.set(ji,qr+Gr*rs);qr+=rs*Vr}else{for(Vr*=rs,Gr=0;Gr<Vr;++Gr)Yr[qr+Gr]=$r[Wr++];qr+=Vr}}else Yr=$r.subarray(Wr,Wr+=Or?Dr.width*Dr.height:Kr);return{pixel_data:Yr,palettes:Qi}}function nr(Br,Or,Dr,Wr,$r,Yr,Qi,rs,Kr){const Qr=Kr;let Vr,Gr=0,qr,ji;const Zr=Ir.width;for(ji=Or;ji!==Wr;ji+=Dr)for(qr=$r;qr!==Qi;qr+=Yr,Gr++)Vr=rs[Gr],Br[(qr+Zr*ji)*4+3]=255,Br[(qr+Zr*ji)*4+2]=Qr[Vr*3+0],Br[(qr+Zr*ji)*4+1]=Qr[Vr*3+1],Br[(qr+Zr*ji)*4+0]=Qr[Vr*3+2];return Br}function sr(Br,Or,Dr,Wr,$r,Yr,Qi,rs){let Kr,Qr=0,Vr,Gr;const qr=Ir.width;for(Gr=Or;Gr!==Wr;Gr+=Dr)for(Vr=$r;Vr!==Qi;Vr+=Yr,Qr+=2)Kr=rs[Qr+0]+(rs[Qr+1]<<8),Br[(Vr+qr*Gr)*4+0]=(Kr&31744)>>7,Br[(Vr+qr*Gr)*4+1]=(Kr&992)>>2,Br[(Vr+qr*Gr)*4+2]=(Kr&31)<<3,Br[(Vr+qr*Gr)*4+3]=Kr&32768?0:255;return Br}function ar(Br,Or,Dr,Wr,$r,Yr,Qi,rs){let Kr=0,Qr,Vr;const Gr=Ir.width;for(Vr=Or;Vr!==Wr;Vr+=Dr)for(Qr=$r;Qr!==Qi;Qr+=Yr,Kr+=3)Br[(Qr+Gr*Vr)*4+3]=255,Br[(Qr+Gr*Vr)*4+2]=rs[Kr+0],Br[(Qr+Gr*Vr)*4+1]=rs[Kr+1],Br[(Qr+Gr*Vr)*4+0]=rs[Kr+2];return Br}function or(Br,Or,Dr,Wr,$r,Yr,Qi,rs){let Kr=0,Qr,Vr;const Gr=Ir.width;for(Vr=Or;Vr!==Wr;Vr+=Dr)for(Qr=$r;Qr!==Qi;Qr+=Yr,Kr+=4)Br[(Qr+Gr*Vr)*4+2]=rs[Kr+0],Br[(Qr+Gr*Vr)*4+1]=rs[Kr+1],Br[(Qr+Gr*Vr)*4+0]=rs[Kr+2],Br[(Qr+Gr*Vr)*4+3]=rs[Kr+3];return Br}function lr(Br,Or,Dr,Wr,$r,Yr,Qi,rs){let Kr,Qr=0,Vr,Gr;const qr=Ir.width;for(Gr=Or;Gr!==Wr;Gr+=Dr)for(Vr=$r;Vr!==Qi;Vr+=Yr,Qr++)Kr=rs[Qr],Br[(Vr+qr*Gr)*4+0]=Kr,Br[(Vr+qr*Gr)*4+1]=Kr,Br[(Vr+qr*Gr)*4+2]=Kr,Br[(Vr+qr*Gr)*4+3]=255;return Br}function cr(Br,Or,Dr,Wr,$r,Yr,Qi,rs){let Kr=0,Qr,Vr;const Gr=Ir.width;for(Vr=Or;Vr!==Wr;Vr+=Dr)for(Qr=$r;Qr!==Qi;Qr+=Yr,Kr+=2)Br[(Qr+Gr*Vr)*4+0]=rs[Kr+0],Br[(Qr+Gr*Vr)*4+1]=rs[Kr+0],Br[(Qr+Gr*Vr)*4+2]=rs[Kr+0],Br[(Qr+Gr*Vr)*4+3]=rs[Kr+1];return Br}function hr(Br,Or,Dr,Wr,$r){let Yr,Qi,rs,Kr,Qr,Vr;switch((Ir.flags&vr)>>Ar){default:case br:Yr=0,rs=1,Qr=Or,Qi=0,Kr=1,Vr=Dr;break;case yr:Yr=0,rs=1,Qr=Or,Qi=Dr-1,Kr=-1,Vr=-1;break;case Sr:Yr=Or-1,rs=-1,Qr=-1,Qi=0,Kr=1,Vr=Dr;break;case wr:Yr=Or-1,rs=-1,Qr=-1,Qi=Dr-1,Kr=-1,Vr=-1;break}if(Fr)switch(Ir.pixel_size){case 8:lr(Br,Qi,Kr,Vr,Yr,rs,Qr,Wr);break;case 16:cr(Br,Qi,Kr,Vr,Yr,rs,Qr,Wr);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(Ir.pixel_size){case 8:nr(Br,Qi,Kr,Vr,Yr,rs,Qr,Wr,$r);break;case 16:sr(Br,Qi,Kr,Vr,Yr,rs,Qr,Wr);break;case 24:ar(Br,Qi,Kr,Vr,Yr,rs,Qr,Wr);break;case 32:or(Br,Qi,Kr,Vr,Yr,rs,Qr,Wr);break;default:throw new Error("THREE.TGALoader: Format not supported.")}return Br}const fr=0,ur=1,pr=2,gr=3,_r=9,mr=10,dr=11,vr=48,Ar=4,yr=0,wr=1,br=2,Sr=3;if(er.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let xr=0;const Cr=new Uint8Array(er),Ir={id_length:Cr[xr++],colormap_type:Cr[xr++],image_type:Cr[xr++],colormap_index:Cr[xr++]|Cr[xr++]<<8,colormap_length:Cr[xr++]|Cr[xr++]<<8,colormap_size:Cr[xr++],origin:[Cr[xr++]|Cr[xr++]<<8,Cr[xr++]|Cr[xr++]<<8],width:Cr[xr++]|Cr[xr++]<<8,height:Cr[xr++]|Cr[xr++]<<8,pixel_size:Cr[xr++],flags:Cr[xr++]};if(tr(Ir),Ir.id_length+xr>er.length)throw new Error("THREE.TGALoader: No data.");xr+=Ir.id_length;let Rr=!1,Pr=!1,Fr=!1;switch(Ir.image_type){case _r:Rr=!0,Pr=!0;break;case ur:Pr=!0;break;case mr:Rr=!0;break;case pr:break;case dr:Rr=!0,Fr=!0;break;case gr:Fr=!0;break}const Nr=new Uint8Array(Ir.width*Ir.height*4),Ur=rr(Rr,Pr,Ir,xr,Cr);return hr(Nr,Ir.width,Ir.height,Ur.pixel_data,Ur.palettes),{data:Nr,width:Ir.width,height:Ir.height,flipY:!0,generateMipmaps:!0,minFilter:LinearMipmapLinearFilter}}}class ColladaLoader extends Loader{load(er,tr,rr,nr){const sr=this,ar=sr.path===""?LoaderUtils.extractUrlBase(er):sr.path,or=new FileLoader(sr.manager);or.setPath(sr.path),or.setRequestHeader(sr.requestHeader),or.setWithCredentials(sr.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},rr,nr)}parse(er,tr){function rr(ts,es){const hs=[],as=ts.childNodes;for(let fs=0,Ls=as.length;fs<Ls;fs++){const Bs=as[fs];Bs.nodeName===es&&hs.push(Bs)}return hs}function nr(ts){if(ts.length===0)return[];const es=ts.trim().split(/\s+/),hs=new Array(es.length);for(let as=0,fs=es.length;as<fs;as++)hs[as]=es[as];return hs}function sr(ts){if(ts.length===0)return[];const es=ts.trim().split(/\s+/),hs=new Array(es.length);for(let as=0,fs=es.length;as<fs;as++)hs[as]=parseFloat(es[as]);return hs}function ar(ts){if(ts.length===0)return[];const es=ts.trim().split(/\s+/),hs=new Array(es.length);for(let as=0,fs=es.length;as<fs;as++)hs[as]=parseInt(es[as]);return hs}function or(ts){return ts.substring(1)}function lr(){return"three_default_"+Ja++}function cr(ts){return Object.keys(ts).length===0}function hr(ts){return{unit:fr(rr(ts,"unit")[0]),upAxis:ur(rr(ts,"up_axis")[0])}}function fr(ts){return ts!==void 0&&ts.hasAttribute("meter")===!0?parseFloat(ts.getAttribute("meter")):1}function ur(ts){return ts!==void 0?ts.textContent:"Y_UP"}function pr(ts,es,hs,as){const fs=rr(ts,es)[0];if(fs!==void 0){const Ls=rr(fs,hs);for(let Bs=0;Bs<Ls.length;Bs++)as(Ls[Bs])}}function gr(ts,es){for(const hs in ts){const as=ts[hs];as.build=es(ts[hs])}}function _r(ts,es){return ts.build!==void 0||(ts.build=es(ts)),ts.build}function mr(ts){const es={sources:{},samplers:{},channels:{}};let hs=!1;for(let as=0,fs=ts.childNodes.length;as<fs;as++){const Ls=ts.childNodes[as];if(Ls.nodeType!==1)continue;let Bs;switch(Ls.nodeName){case"source":Bs=Ls.getAttribute("id"),es.sources[Bs]=Cs(Ls);break;case"sampler":Bs=Ls.getAttribute("id"),es.samplers[Bs]=dr(Ls);break;case"channel":Bs=Ls.getAttribute("target"),es.channels[Bs]=vr(Ls);break;case"animation":mr(Ls),hs=!0;break;default:console.log(Ls)}}hs===!1&&(ba.animations[ts.getAttribute("id")||MathUtils.generateUUID()]=es)}function dr(ts){const es={inputs:{}};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"input":const Ls=or(fs.getAttribute("source")),Bs=fs.getAttribute("semantic");es.inputs[Bs]=Ls;break}}return es}function vr(ts){const es={};let as=ts.getAttribute("target").split("/");const fs=as.shift();let Ls=as.shift();const Bs=Ls.indexOf("(")!==-1,aa=Ls.indexOf(".")!==-1;if(aa)as=Ls.split("."),Ls=as.shift(),es.member=as.shift();else if(Bs){const Ys=Ls.split("(");Ls=Ys.shift();for(let Js=0;Js<Ys.length;Js++)Ys[Js]=parseInt(Ys[Js].replace(/\)/,""));es.indices=Ys}return es.id=fs,es.sid=Ls,es.arraySyntax=Bs,es.memberSyntax=aa,es.sampler=or(ts.getAttribute("source")),es}function Ar(ts){const es=[],hs=ts.channels,as=ts.samplers,fs=ts.sources;for(const Ls in hs)if(hs.hasOwnProperty(Ls)){const Bs=hs[Ls],aa=as[Bs.sampler],Ys=aa.inputs.INPUT,Js=aa.inputs.OUTPUT,ma=fs[Ys],js=fs[Js],da=wr(Bs,ma,js);Ir(da,es)}return es}function yr(ts){return _r(ba.animations[ts],Ar)}function wr(ts,es,hs){const as=ba.nodes[ts.id],fs=zs(as.id),Ls=as.transforms[ts.sid],Bs=as.matrix.clone().transpose();let aa,Ys,Js,ma,js,da;const ua={};switch(Ls){case"matrix":for(Js=0,ma=es.array.length;Js<ma;Js++)if(aa=es.array[Js],Ys=Js*hs.stride,ua[aa]===void 0&&(ua[aa]={}),ts.arraySyntax===!0){const za=hs.array[Ys],Ua=ts.indices[0]+4*ts.indices[1];ua[aa][Ua]=za}else for(js=0,da=hs.stride;js<da;js++)ua[aa][js]=hs.array[Ys+js];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',Ls);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',Ls);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',Ls);break}const xa=br(ua,Bs);return{name:fs.uuid,keyframes:xa}}function br(ts,es){const hs=[];for(const fs in ts)hs.push({time:parseFloat(fs),value:ts[fs]});hs.sort(as);for(let fs=0;fs<16;fs++)Rr(hs,fs,es.elements[fs]);return hs;function as(fs,Ls){return fs.time-Ls.time}}const Sr=new Vector3$1,xr=new Vector3$1,Cr=new Quaternion$1;function Ir(ts,es){const hs=ts.keyframes,as=ts.name,fs=[],Ls=[],Bs=[],aa=[];for(let Ys=0,Js=hs.length;Ys<Js;Ys++){const ma=hs[Ys],js=ma.time,da=ma.value;ds.fromArray(da).transpose(),ds.decompose(Sr,Cr,xr),fs.push(js),Ls.push(Sr.x,Sr.y,Sr.z),Bs.push(Cr.x,Cr.y,Cr.z,Cr.w),aa.push(xr.x,xr.y,xr.z)}return Ls.length>0&&es.push(new VectorKeyframeTrack(as+".position",fs,Ls)),Bs.length>0&&es.push(new QuaternionKeyframeTrack(as+".quaternion",fs,Bs)),aa.length>0&&es.push(new VectorKeyframeTrack(as+".scale",fs,aa)),es}function Rr(ts,es,hs){let as,fs=!0,Ls,Bs;for(Ls=0,Bs=ts.length;Ls<Bs;Ls++)as=ts[Ls],as.value[es]===void 0?as.value[es]=null:fs=!1;if(fs===!0)for(Ls=0,Bs=ts.length;Ls<Bs;Ls++)as=ts[Ls],as.value[es]=hs;else Pr(ts,es)}function Pr(ts,es){let hs,as;for(let fs=0,Ls=ts.length;fs<Ls;fs++){const Bs=ts[fs];if(Bs.value[es]===null){if(hs=Fr(ts,fs,es),as=Nr(ts,fs,es),hs===null){Bs.value[es]=as.value[es];continue}if(as===null){Bs.value[es]=hs.value[es];continue}Ur(Bs,hs,as,es)}}}function Fr(ts,es,hs){for(;es>=0;){const as=ts[es];if(as.value[hs]!==null)return as;es--}return null}function Nr(ts,es,hs){for(;es<ts.length;){const as=ts[es];if(as.value[hs]!==null)return as;es++}return null}function Ur(ts,es,hs,as){if(hs.time-es.time===0){ts.value[as]=es.value[as];return}ts.value[as]=(ts.time-es.time)*(hs.value[as]-es.value[as])/(hs.time-es.time)+es.value[as]}function Br(ts){const es={name:ts.getAttribute("id")||"default",start:parseFloat(ts.getAttribute("start")||0),end:parseFloat(ts.getAttribute("end")||0),animations:[]};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"instance_animation":es.animations.push(or(fs.getAttribute("url")));break}}ba.clips[ts.getAttribute("id")]=es}function Or(ts){const es=[],hs=ts.name,as=ts.end-ts.start||-1,fs=ts.animations;for(let Ls=0,Bs=fs.length;Ls<Bs;Ls++){const aa=yr(fs[Ls]);for(let Ys=0,Js=aa.length;Ys<Js;Ys++)es.push(aa[Ys])}return new AnimationClip(hs,as,es)}function Dr(ts){return _r(ba.clips[ts],Or)}function Wr(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"skin":es.id=or(fs.getAttribute("source")),es.skin=$r(fs);break;case"morph":es.id=or(fs.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}ba.controllers[ts.getAttribute("id")]=es}function $r(ts){const es={sources:{}};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"bind_shape_matrix":es.bindShapeMatrix=sr(fs.textContent);break;case"source":const Ls=fs.getAttribute("id");es.sources[Ls]=Cs(fs);break;case"joints":es.joints=Yr(fs);break;case"vertex_weights":es.vertexWeights=Qi(fs);break}}return es}function Yr(ts){const es={inputs:{}};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"input":const Ls=fs.getAttribute("semantic"),Bs=or(fs.getAttribute("source"));es.inputs[Ls]=Bs;break}}return es}function Qi(ts){const es={inputs:{}};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"input":const Ls=fs.getAttribute("semantic"),Bs=or(fs.getAttribute("source")),aa=parseInt(fs.getAttribute("offset"));es.inputs[Ls]={id:Bs,offset:aa};break;case"vcount":es.vcount=ar(fs.textContent);break;case"v":es.v=ar(fs.textContent);break}}return es}function rs(ts){const es={id:ts.id},hs=ba.geometries[es.id];return ts.skin!==void 0&&(es.skin=Kr(ts.skin),hs.sources.skinIndices=es.skin.indices,hs.sources.skinWeights=es.skin.weights),es}function Kr(ts){const hs={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},as=ts.sources,fs=ts.vertexWeights,Ls=fs.vcount,Bs=fs.v,aa=fs.inputs.JOINT.offset,Ys=fs.inputs.WEIGHT.offset,Js=ts.sources[ts.joints.inputs.JOINT],ma=ts.sources[ts.joints.inputs.INV_BIND_MATRIX],js=as[fs.inputs.WEIGHT.id].array;let da=0,ua,xa,Aa;for(ua=0,Aa=Ls.length;ua<Aa;ua++){const Ua=Ls[ua],Ba=[];for(xa=0;xa<Ua;xa++){const ka=Bs[da+aa],eo=Bs[da+Ys],ja=js[eo];Ba.push({index:ka,weight:ja}),da+=2}for(Ba.sort(za),xa=0;xa<4;xa++){const ka=Ba[xa];ka!==void 0?(hs.indices.array.push(ka.index),hs.weights.array.push(ka.weight)):(hs.indices.array.push(0),hs.weights.array.push(0))}}for(ts.bindShapeMatrix?hs.bindMatrix=new Matrix4().fromArray(ts.bindShapeMatrix).transpose():hs.bindMatrix=new Matrix4().identity(),ua=0,Aa=Js.array.length;ua<Aa;ua++){const Ua=Js.array[ua],Ba=new Matrix4().fromArray(ma.array,ua*ma.stride).transpose();hs.joints.push({name:Ua,boneInverse:Ba})}return hs;function za(Ua,Ba){return Ba.weight-Ua.weight}}function Qr(ts){return _r(ba.controllers[ts],rs)}function Vr(ts){const es={init_from:rr(ts,"init_from")[0].textContent};ba.images[ts.getAttribute("id")]=es}function Gr(ts){return ts.build!==void 0?ts.build:ts.init_from}function qr(ts){const es=ba.images[ts];return es!==void 0?_r(es,Gr):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",ts),null)}function ji(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"profile_COMMON":es.profile=Zr(fs);break}}ba.effects[ts.getAttribute("id")]=es}function Zr(ts){const es={surfaces:{},samplers:{}};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"newparam":Zi(fs,es);break;case"technique":es.technique=Xr(fs);break;case"extra":es.extra=ms(fs);break}}return es}function Zi(ts,es){const hs=ts.getAttribute("sid");for(let as=0,fs=ts.childNodes.length;as<fs;as++){const Ls=ts.childNodes[as];if(Ls.nodeType===1)switch(Ls.nodeName){case"surface":es.surfaces[hs]=Yi(Ls);break;case"sampler2D":es.samplers[hs]=qi(Ls);break}}}function Yi(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"init_from":es.init_from=fs.textContent;break}}return es}function qi(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"source":es.source=fs.textContent;break}}return es}function Xr(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"constant":case"lambert":case"blinn":case"phong":es.type=fs.nodeName,es.parameters=ns(fs);break;case"extra":es.extra=ms(fs);break}}return es}function ns(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":es[fs.nodeName]=os(fs);break;case"transparent":es[fs.nodeName]={opaque:fs.hasAttribute("opaque")?fs.getAttribute("opaque"):"A_ONE",data:os(fs)};break}}return es}function os(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"color":es[fs.nodeName]=sr(fs.textContent);break;case"float":es[fs.nodeName]=parseFloat(fs.textContent);break;case"texture":es[fs.nodeName]={id:fs.getAttribute("texture"),extra:us(fs)};break}}return es}function us(ts){const es={technique:{}};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"extra":is(fs,es);break}}return es}function is(ts,es){for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"technique":Ji(fs,es);break}}}function Ji(ts,es){for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":es.technique[fs.nodeName]=parseFloat(fs.textContent);break;case"wrapU":case"wrapV":fs.textContent.toUpperCase()==="TRUE"?es.technique[fs.nodeName]=1:fs.textContent.toUpperCase()==="FALSE"?es.technique[fs.nodeName]=0:es.technique[fs.nodeName]=parseInt(fs.textContent);break;case"bump":es[fs.nodeName]=Ni(fs);break}}}function ms(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"technique":es.technique=Ki(fs);break}}return es}function Ki(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"double_sided":es[fs.nodeName]=parseInt(fs.textContent);break;case"bump":es[fs.nodeName]=Ni(fs);break}}return es}function Ni(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"texture":es[fs.nodeName]={id:fs.getAttribute("texture"),texcoord:fs.getAttribute("texcoord"),extra:us(fs)};break}}return es}function Ri(ts){return ts}function Jr(ts){return _r(ba.effects[ts],Ri)}function Xi(ts){const es={name:ts.getAttribute("name")};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"instance_effect":es.url=or(fs.getAttribute("url"));break}}ba.materials[ts.getAttribute("id")]=es}function ss(ts){let es,hs=ts.slice((ts.lastIndexOf(".")-1>>>0)+2);switch(hs=hs.toLowerCase(),hs){case"tga":es=Ha;break;default:es=Va}return es}function ls(ts){const es=Jr(ts.url),hs=es.profile.technique;let as;switch(hs.type){case"phong":case"blinn":as=new MeshPhongMaterial;break;case"lambert":as=new MeshLambertMaterial;break;default:as=new MeshBasicMaterial;break}as.name=ts.name||"";function fs(Ys,Js=null){const ma=es.profile.samplers[Ys.id];let js=null;if(ma!==void 0){const da=es.profile.surfaces[ma.source];js=qr(da.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),js=qr(Ys.id);if(js!==null){const da=ss(js);if(da!==void 0){const ua=da.load(js),xa=Ys.extra;if(xa!==void 0&&xa.technique!==void 0&&cr(xa.technique)===!1){const Aa=xa.technique;ua.wrapS=Aa.wrapU?RepeatWrapping:ClampToEdgeWrapping,ua.wrapT=Aa.wrapV?RepeatWrapping:ClampToEdgeWrapping,ua.offset.set(Aa.offsetU||0,Aa.offsetV||0),ua.repeat.set(Aa.repeatU||1,Aa.repeatV||1)}else ua.wrapS=RepeatWrapping,ua.wrapT=RepeatWrapping;return Js!==null&&(ua.colorSpace=Js),ua}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",js),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",Ys.id),null}const Ls=hs.parameters;for(const Ys in Ls){const Js=Ls[Ys];switch(Ys){case"diffuse":Js.color&&as.color.fromArray(Js.color),Js.texture&&(as.map=fs(Js.texture,SRGBColorSpace));break;case"specular":Js.color&&as.specular&&as.specular.fromArray(Js.color),Js.texture&&(as.specularMap=fs(Js.texture));break;case"bump":Js.texture&&(as.normalMap=fs(Js.texture));break;case"ambient":Js.texture&&(as.lightMap=fs(Js.texture,SRGBColorSpace));break;case"shininess":Js.float&&as.shininess&&(as.shininess=Js.float);break;case"emission":Js.color&&as.emissive&&as.emissive.fromArray(Js.color),Js.texture&&(as.emissiveMap=fs(Js.texture,SRGBColorSpace));break}}ColorManagement.toWorkingColorSpace(as.color,SRGBColorSpace),as.specular&&ColorManagement.toWorkingColorSpace(as.specular,SRGBColorSpace),as.emissive&&ColorManagement.toWorkingColorSpace(as.emissive,SRGBColorSpace);let Bs=Ls.transparent,aa=Ls.transparency;if(aa===void 0&&Bs&&(aa={float:1}),Bs===void 0&&aa&&(Bs={opaque:"A_ONE",data:{color:[1,1,1,1]}}),Bs&&aa)if(Bs.data.texture)as.transparent=!0;else{const Ys=Bs.data.color;switch(Bs.opaque){case"A_ONE":as.opacity=Ys[3]*aa.float;break;case"RGB_ZERO":as.opacity=1-Ys[0]*aa.float;break;case"A_ZERO":as.opacity=1-Ys[3]*aa.float;break;case"RGB_ONE":as.opacity=Ys[0]*aa.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',Bs.opaque)}as.opacity<1&&(as.transparent=!0)}if(hs.extra!==void 0&&hs.extra.technique!==void 0){const Ys=hs.extra.technique;for(const Js in Ys){const ma=Ys[Js];switch(Js){case"double_sided":as.side=ma===1?DoubleSide:FrontSide;break;case"bump":as.normalMap=fs(ma.texture),as.normalScale=new Vector2(1,1);break}}}return as}function gs(ts){return _r(ba.materials[ts],ls)}function _s(ts){const es={name:ts.getAttribute("name")};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"optics":es.optics=vs(fs);break}}ba.cameras[ts.getAttribute("id")]=es}function vs(ts){for(let es=0;es<ts.childNodes.length;es++){const hs=ts.childNodes[es];switch(hs.nodeName){case"technique_common":return As(hs)}}return{}}function As(ts){const es={};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];switch(as.nodeName){case"perspective":case"orthographic":es.technique=as.nodeName,es.parameters=Ss(as);break}}return es}function Ss(ts){const es={};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];switch(as.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":es[as.nodeName]=parseFloat(as.textContent);break}}return es}function Is(ts){let es;switch(ts.optics.technique){case"perspective":es=new PerspectiveCamera(ts.optics.parameters.yfov,ts.optics.parameters.aspect_ratio,ts.optics.parameters.znear,ts.optics.parameters.zfar);break;case"orthographic":let hs=ts.optics.parameters.ymag,as=ts.optics.parameters.xmag;const fs=ts.optics.parameters.aspect_ratio;as=as===void 0?hs*fs:as,hs=hs===void 0?as/fs:hs,as*=.5,hs*=.5,es=new OrthographicCamera(-as,as,hs,-hs,ts.optics.parameters.znear,ts.optics.parameters.zfar);break;default:es=new PerspectiveCamera;break}return es.name=ts.name||"",es}function Fs(ts){const es=ba.cameras[ts];return es!==void 0?_r(es,Is):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",ts),null)}function Ns(ts){let es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"technique_common":es=Ws(fs);break}}ba.lights[ts.getAttribute("id")]=es}function Ws(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"directional":case"point":case"spot":case"ambient":es.technique=fs.nodeName,es.parameters=ks(fs)}}return es}function ks(ts){const es={};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"color":const Ls=sr(fs.textContent);es.color=new Color().fromArray(Ls),ColorManagement.toWorkingColorSpace(es.color,SRGBColorSpace);break;case"falloff_angle":es.falloffAngle=parseFloat(fs.textContent);break;case"quadratic_attenuation":const Bs=parseFloat(fs.textContent);es.distance=Bs?Math.sqrt(1/Bs):0;break}}return es}function Vs(ts){let es;switch(ts.technique){case"directional":es=new DirectionalLight;break;case"point":es=new PointLight;break;case"spot":es=new SpotLight;break;case"ambient":es=new AmbientLight;break}return ts.parameters.color&&es.color.copy(ts.parameters.color),ts.parameters.distance&&(es.distance=ts.parameters.distance),es}function bs(ts){const es=ba.lights[ts];return es!==void 0?_r(es,Vs):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",ts),null)}function Ms(ts){const es={name:ts.getAttribute("name"),sources:{},vertices:{},primitives:[]},hs=rr(ts,"mesh")[0];if(hs!==void 0){for(let as=0;as<hs.childNodes.length;as++){const fs=hs.childNodes[as];if(fs.nodeType!==1)continue;const Ls=fs.getAttribute("id");switch(fs.nodeName){case"source":es.sources[Ls]=Cs(fs);break;case"vertices":es.vertices=Ps(fs);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",fs.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":es.primitives.push(Qs(fs));break;default:console.log(fs)}}ba.geometries[ts.getAttribute("id")]=es}}function Cs(ts){const es={array:[],stride:3};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"float_array":es.array=sr(as.textContent);break;case"Name_array":es.array=nr(as.textContent);break;case"technique_common":const fs=rr(as,"accessor")[0];fs!==void 0&&(es.stride=parseInt(fs.getAttribute("stride")));break}}return es}function Ps(ts){const es={};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];as.nodeType===1&&(es[as.getAttribute("semantic")]=or(as.getAttribute("source")))}return es}function Qs(ts){const es={type:ts.nodeName,material:ts.getAttribute("material"),count:parseInt(ts.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let hs=0,as=ts.childNodes.length;hs<as;hs++){const fs=ts.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"input":const Ls=or(fs.getAttribute("source")),Bs=fs.getAttribute("semantic"),aa=parseInt(fs.getAttribute("offset")),Ys=parseInt(fs.getAttribute("set")),Js=Ys>0?Bs+Ys:Bs;es.inputs[Js]={id:Ls,offset:aa},es.stride=Math.max(es.stride,aa+1),Bs==="TEXCOORD"&&(es.hasUV=!0);break;case"vcount":es.vcount=ar(fs.textContent);break;case"p":es.p=ar(fs.textContent);break}}return es}function Hs(ts){const es={};for(let hs=0;hs<ts.length;hs++){const as=ts[hs];es[as.type]===void 0&&(es[as.type]=[]),es[as.type].push(as)}return es}function ta(ts){let es=0;for(let hs=0,as=ts.length;hs<as;hs++)ts[hs].hasUV===!0&&es++;es>0&&es<ts.length&&(ts.uvsNeedsFix=!0)}function Sa(ts){const es={},hs=ts.sources,as=ts.vertices,fs=ts.primitives;if(fs.length===0)return{};const Ls=Hs(fs);for(const Bs in Ls){const aa=Ls[Bs];ta(aa),es[Bs]=ga(aa,hs,as)}return es}function ga(ts,es,hs){const as={},fs={array:[],stride:0},Ls={array:[],stride:0},Bs={array:[],stride:0},aa={array:[],stride:0},Ys={array:[],stride:0},Js={array:[],stride:4},ma={array:[],stride:4},js=new BufferGeometry,da=[];let ua=0;for(let xa=0;xa<ts.length;xa++){const Aa=ts[xa],za=Aa.inputs;let Ua=0;switch(Aa.type){case"lines":case"linestrips":Ua=Aa.count*2;break;case"triangles":Ua=Aa.count*3;break;case"polylist":for(let Ba=0;Ba<Aa.count;Ba++){const ka=Aa.vcount[Ba];switch(ka){case 3:Ua+=3;break;case 4:Ua+=6;break;default:Ua+=(ka-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknown primitive type:",Aa.type)}js.addGroup(ua,Ua,xa),ua+=Ua,Aa.material&&da.push(Aa.material);for(const Ba in za){const ka=za[Ba];switch(Ba){case"VERTEX":for(const eo in hs){const ja=hs[eo];switch(eo){case"POSITION":const no=fs.array.length;if($s(Aa,es[ja],ka.offset,fs.array),fs.stride=es[ja].stride,es.skinWeights&&es.skinIndices&&($s(Aa,es.skinIndices,ka.offset,Js.array),$s(Aa,es.skinWeights,ka.offset,ma.array)),Aa.hasUV===!1&&ts.uvsNeedsFix===!0){const uo=(fs.array.length-no)/fs.stride;for(let lo=0;lo<uo;lo++)Bs.array.push(0,0)}break;case"NORMAL":$s(Aa,es[ja],ka.offset,Ls.array),Ls.stride=es[ja].stride;break;case"COLOR":$s(Aa,es[ja],ka.offset,Ys.array),Ys.stride=es[ja].stride;break;case"TEXCOORD":$s(Aa,es[ja],ka.offset,Bs.array),Bs.stride=es[ja].stride;break;case"TEXCOORD1":$s(Aa,es[ja],ka.offset,aa.array),Bs.stride=es[ja].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',eo)}}break;case"NORMAL":$s(Aa,es[ka.id],ka.offset,Ls.array),Ls.stride=es[ka.id].stride;break;case"COLOR":$s(Aa,es[ka.id],ka.offset,Ys.array,!0),Ys.stride=es[ka.id].stride;break;case"TEXCOORD":$s(Aa,es[ka.id],ka.offset,Bs.array),Bs.stride=es[ka.id].stride;break;case"TEXCOORD1":$s(Aa,es[ka.id],ka.offset,aa.array),aa.stride=es[ka.id].stride;break}}}return fs.array.length>0&&js.setAttribute("position",new Float32BufferAttribute(fs.array,fs.stride)),Ls.array.length>0&&js.setAttribute("normal",new Float32BufferAttribute(Ls.array,Ls.stride)),Ys.array.length>0&&js.setAttribute("color",new Float32BufferAttribute(Ys.array,Ys.stride)),Bs.array.length>0&&js.setAttribute("uv",new Float32BufferAttribute(Bs.array,Bs.stride)),aa.array.length>0&&js.setAttribute("uv1",new Float32BufferAttribute(aa.array,aa.stride)),Js.array.length>0&&js.setAttribute("skinIndex",new Float32BufferAttribute(Js.array,Js.stride)),ma.array.length>0&&js.setAttribute("skinWeight",new Float32BufferAttribute(ma.array,ma.stride)),as.data=js,as.type=ts[0].type,as.materialKeys=da,as}function $s(ts,es,hs,as,fs=!1){const Ls=ts.p,Bs=ts.stride,aa=ts.vcount;function Ys(js){let da=Ls[js+hs]*ma;const ua=da+ma;for(;da<ua;da++)as.push(Js[da]);if(fs){const xa=as.length-ma-1;Oa.setRGB(as[xa+0],as[xa+1],as[xa+2],SRGBColorSpace),as[xa+0]=Oa.r,as[xa+1]=Oa.g,as[xa+2]=Oa.b}}const Js=es.array,ma=es.stride;if(ts.vcount!==void 0){let js=0;for(let da=0,ua=aa.length;da<ua;da++){const xa=aa[da];if(xa===4){const Aa=js+Bs*0,za=js+Bs*1,Ua=js+Bs*2,Ba=js+Bs*3;Ys(Aa),Ys(za),Ys(Ba),Ys(za),Ys(Ua),Ys(Ba)}else if(xa===3){const Aa=js+Bs*0,za=js+Bs*1,Ua=js+Bs*2;Ys(Aa),Ys(za),Ys(Ua)}else if(xa>4)for(let Aa=1,za=xa-2;Aa<=za;Aa++){const Ua=js+Bs*0,Ba=js+Bs*Aa,ka=js+Bs*(Aa+1);Ys(Ua),Ys(Ba),Ys(ka)}js+=Bs*xa}}else for(let js=0,da=Ls.length;js<da;js+=Bs)Ys(js)}function Ks(ts){return _r(ba.geometries[ts],Sa)}function qs(ts){const es={name:ts.getAttribute("name")||"",joints:{},links:[]};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"technique_common":Ta(as,es);break}}ba.kinematicsModels[ts.getAttribute("id")]=es}function Zs(ts){return ts.build!==void 0?ts.build:ts}function ha(ts){return _r(ba.kinematicsModels[ts],Zs)}function Ta(ts,es){for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"joint":es.joints[as.getAttribute("sid")]=$a(as);break;case"link":es.links.push(Qa(as));break}}}function $a(ts){let es;for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"prismatic":case"revolute":es=Wa(as);break}}return es}function Wa(ts){const es={sid:ts.getAttribute("sid"),name:ts.getAttribute("name")||"",axis:new Vector3$1,limits:{min:0,max:0},type:ts.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"axis":const fs=sr(as.textContent);es.axis.fromArray(fs);break;case"limits":const Ls=as.getElementsByTagName("max")[0],Bs=as.getElementsByTagName("min")[0];es.limits.max=parseFloat(Ls.textContent),es.limits.min=parseFloat(Bs.textContent);break}}return es.limits.min>=es.limits.max&&(es.static=!0),es.middlePosition=(es.limits.min+es.limits.max)/2,es}function Qa(ts){const es={sid:ts.getAttribute("sid"),name:ts.getAttribute("name")||"",attachments:[],transforms:[]};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"attachment_full":es.attachments.push(Xa(as));break;case"matrix":case"translate":case"rotate":es.transforms.push(Ka(as));break}}return es}function Xa(ts){const es={joint:ts.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"link":es.links.push(Qa(as));break;case"matrix":case"translate":case"rotate":es.transforms.push(Ka(as));break}}return es}function Ka(ts){const es={type:ts.nodeName},hs=sr(ts.textContent);switch(es.type){case"matrix":es.obj=new Matrix4,es.obj.fromArray(hs).transpose();break;case"translate":es.obj=new Vector3$1,es.obj.fromArray(hs);break;case"rotate":es.obj=new Vector3$1,es.obj.fromArray(hs),es.angle=MathUtils.degToRad(hs[3]);break}return es}function qa(ts){const es={name:ts.getAttribute("name")||"",rigidBodies:{}};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"rigid_body":es.rigidBodies[as.getAttribute("name")]={},to(as,es.rigidBodies[as.getAttribute("name")]);break}}ba.physicsModels[ts.getAttribute("id")]=es}function to(ts,es){for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"technique_common":ro(as,es);break}}}function ro(ts,es){for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"inertia":es.inertia=sr(as.textContent);break;case"mass":es.mass=sr(as.textContent)[0];break}}}function ao(ts){const es={bindJointAxis:[]};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"bind_joint_axis":es.bindJointAxis.push(Ya(as));break}}ba.kinematicsScenes[or(ts.getAttribute("url"))]=es}function Ya(ts){const es={target:ts.getAttribute("target").split("/").pop()};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType===1)switch(as.nodeName){case"axis":const fs=as.getElementsByTagName("param")[0];es.axis=fs.textContent;const Ls=es.axis.split("inst_").pop().split("axis")[0];es.jointIndex=Ls.substring(0,Ls.length-1);break}}return es}function Za(ts){return ts.build!==void 0?ts.build:ts}function Gi(ts){return _r(ba.kinematicsScenes[ts],Za)}function cs(){const ts=Object.keys(ba.kinematicsModels)[0],es=Object.keys(ba.kinematicsScenes)[0],hs=Object.keys(ba.visualScenes)[0];if(ts===void 0||es===void 0)return;const as=ha(ts),fs=Gi(es),Ls=fa(hs),Bs=fs.bindJointAxis,aa={};for(let ma=0,js=Bs.length;ma<js;ma++){const da=Bs[ma],ua=Ma.querySelector('[sid="'+da.target+'"]');if(ua){const xa=ua.parentElement;Ys(da.jointIndex,xa)}}function Ys(ma,js){const da=js.getAttribute("name"),ua=as.joints[ma];Ls.traverse(function(xa){xa.name===da&&(aa[ma]={object:xa,transforms:xs(js),joint:ua,position:ua.zeroPosition})})}const Js=new Matrix4;io={joints:as&&as.joints,getJointValue:function(ma){const js=aa[ma];if(js)return js.position;console.warn("THREE.ColladaLoader: Joint "+ma+" doesn't exist.")},setJointValue:function(ma,js){const da=aa[ma];if(da){const ua=da.joint;if(js>ua.limits.max||js<ua.limits.min)console.warn("THREE.ColladaLoader: Joint "+ma+" value "+js+" outside of limits (min: "+ua.limits.min+", max: "+ua.limits.max+").");else if(ua.static)console.warn("THREE.ColladaLoader: Joint "+ma+" is static.");else{const xa=da.object,Aa=ua.axis,za=da.transforms;ds.identity();for(let Ua=0;Ua<za.length;Ua++){const Ba=za[Ua];if(Ba.sid&&Ba.sid.indexOf(ma)!==-1)switch(ua.type){case"revolute":ds.multiply(Js.makeRotationAxis(Aa,MathUtils.degToRad(js)));break;case"prismatic":ds.multiply(Js.makeTranslation(Aa.x*js,Aa.y*js,Aa.z*js));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+ua.type);break}else switch(Ba.type){case"matrix":ds.multiply(Ba.obj);break;case"translate":ds.multiply(Js.makeTranslation(Ba.obj.x,Ba.obj.y,Ba.obj.z));break;case"scale":ds.scale(Ba.obj);break;case"rotate":ds.multiply(Js.makeRotationAxis(Ba.obj,Ba.angle));break}}xa.matrix.copy(ds),xa.matrix.decompose(xa.position,xa.quaternion,xa.scale),aa[ma].position=js}}else console.log("THREE.ColladaLoader: "+ma+" does not exist.")}}}function xs(ts){const es=[],hs=Ma.querySelector('[id="'+ts.id+'"]');for(let as=0;as<hs.childNodes.length;as++){const fs=hs.childNodes[as];if(fs.nodeType!==1)continue;let Ls,Bs;switch(fs.nodeName){case"matrix":Ls=sr(fs.textContent);const aa=new Matrix4().fromArray(Ls).transpose();es.push({sid:fs.getAttribute("sid"),type:fs.nodeName,obj:aa});break;case"translate":case"scale":Ls=sr(fs.textContent),Bs=new Vector3$1().fromArray(Ls),es.push({sid:fs.getAttribute("sid"),type:fs.nodeName,obj:Bs});break;case"rotate":Ls=sr(fs.textContent),Bs=new Vector3$1().fromArray(Ls);const Ys=MathUtils.degToRad(Ls[3]);es.push({sid:fs.getAttribute("sid"),type:fs.nodeName,obj:Bs,angle:Ys});break}}return es}function $i(ts){const es=ts.getElementsByTagName("node");for(let hs=0;hs<es.length;hs++){const as=es[hs];as.hasAttribute("id")===!1&&as.setAttribute("id",lr())}}const ds=new Matrix4,ps=new Vector3$1;function ws(ts){const es={name:ts.getAttribute("name")||"",type:ts.getAttribute("type"),id:ts.getAttribute("id"),sid:ts.getAttribute("sid"),matrix:new Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];if(as.nodeType!==1)continue;let fs;switch(as.nodeName){case"node":es.nodes.push(as.getAttribute("id")),ws(as);break;case"instance_camera":es.instanceCameras.push(or(as.getAttribute("url")));break;case"instance_controller":es.instanceControllers.push(ys(as));break;case"instance_light":es.instanceLights.push(or(as.getAttribute("url")));break;case"instance_geometry":es.instanceGeometries.push(ys(as));break;case"instance_node":es.instanceNodes.push(or(as.getAttribute("url")));break;case"matrix":fs=sr(as.textContent),es.matrix.multiply(ds.fromArray(fs).transpose()),es.transforms[as.getAttribute("sid")]=as.nodeName;break;case"translate":fs=sr(as.textContent),ps.fromArray(fs),es.matrix.multiply(ds.makeTranslation(ps.x,ps.y,ps.z)),es.transforms[as.getAttribute("sid")]=as.nodeName;break;case"rotate":fs=sr(as.textContent);const Ls=MathUtils.degToRad(fs[3]);es.matrix.multiply(ds.makeRotationAxis(ps.fromArray(fs),Ls)),es.transforms[as.getAttribute("sid")]=as.nodeName;break;case"scale":fs=sr(as.textContent),es.matrix.scale(ps.fromArray(fs)),es.transforms[as.getAttribute("sid")]=as.nodeName;break;case"extra":break;default:console.log(as)}}return Gs(es.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",es.id):ba.nodes[es.id]=es,es}function ys(ts){const es={id:or(ts.getAttribute("url")),materials:{},skeletons:[]};for(let hs=0;hs<ts.childNodes.length;hs++){const as=ts.childNodes[hs];switch(as.nodeName){case"bind_material":const fs=as.getElementsByTagName("instance_material");for(let Ls=0;Ls<fs.length;Ls++){const Bs=fs[Ls],aa=Bs.getAttribute("symbol"),Ys=Bs.getAttribute("target");es.materials[aa]=or(Ys)}break;case"skeleton":es.skeletons.push(or(as.textContent));break;default:break}}return es}function Es(ts,es){const hs=[],as=[];let fs,Ls,Bs;for(fs=0;fs<ts.length;fs++){const Js=ts[fs];let ma;if(Gs(Js))ma=zs(Js),Ts(ma,es,hs);else if(wa(Js)){const da=ba.visualScenes[Js].children;for(let ua=0;ua<da.length;ua++){const xa=da[ua];if(xa.type==="JOINT"){const Aa=zs(xa.id);Ts(Aa,es,hs)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",Js)}for(fs=0;fs<es.length;fs++)for(Ls=0;Ls<hs.length;Ls++)if(Bs=hs[Ls],Bs.bone.name===es[fs].name){as[fs]=Bs,Bs.processed=!0;break}for(fs=0;fs<hs.length;fs++)Bs=hs[fs],Bs.processed===!1&&(as.push(Bs),Bs.processed=!0);const aa=[],Ys=[];for(fs=0;fs<as.length;fs++)Bs=as[fs],aa.push(Bs.bone),Ys.push(Bs.boneInverse);return new Skeleton(aa,Ys)}function Ts(ts,es,hs){ts.traverse(function(as){if(as.isBone===!0){let fs;for(let Ls=0;Ls<es.length;Ls++){const Bs=es[Ls];if(Bs.name===as.name){fs=Bs.boneInverse;break}}fs===void 0&&(fs=new Matrix4),hs.push({bone:as,boneInverse:fs,processed:!1})}})}function Rs(ts){const es=[],hs=ts.matrix,as=ts.nodes,fs=ts.type,Ls=ts.instanceCameras,Bs=ts.instanceControllers,aa=ts.instanceLights,Ys=ts.instanceGeometries,Js=ts.instanceNodes;for(let js=0,da=as.length;js<da;js++)es.push(zs(as[js]));for(let js=0,da=Ls.length;js<da;js++){const ua=Fs(Ls[js]);ua!==null&&es.push(ua.clone())}for(let js=0,da=Bs.length;js<da;js++){const ua=Bs[js],xa=Qr(ua.id),Aa=Ks(xa.id),za=Os(Aa,ua.materials),Ua=ua.skeletons,Ba=xa.skin.joints,ka=Es(Ua,Ba);for(let eo=0,ja=za.length;eo<ja;eo++){const no=za[eo];no.isSkinnedMesh&&(no.bind(ka,xa.skin.bindMatrix),no.normalizeSkinWeights()),es.push(no)}}for(let js=0,da=aa.length;js<da;js++){const ua=bs(aa[js]);ua!==null&&es.push(ua.clone())}for(let js=0,da=Ys.length;js<da;js++){const ua=Ys[js],xa=Ks(ua.id),Aa=Os(xa,ua.materials);for(let za=0,Ua=Aa.length;za<Ua;za++)es.push(Aa[za])}for(let js=0,da=Js.length;js<da;js++)es.push(zs(Js[js]).clone());let ma;if(as.length===0&&es.length===1)ma=es[0];else{ma=fs==="JOINT"?new Bone:new Group;for(let js=0;js<es.length;js++)ma.add(es[js])}return ma.name=fs==="JOINT"?ts.sid:ts.name,ma.matrix.copy(hs),ma.matrix.decompose(ma.position,ma.quaternion,ma.scale),ma}const Ds=new MeshBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16711935});function Us(ts,es){const hs=[];for(let as=0,fs=ts.length;as<fs;as++){const Ls=es[ts[as]];Ls===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",ts[as]),hs.push(Ds)):hs.push(gs(Ls))}return hs}function Os(ts,es){const hs=[];for(const as in ts){const fs=ts[as],Ls=Us(fs.materialKeys,es);if(Ls.length===0&&(as==="lines"||as==="linestrips"?Ls.push(new LineBasicMaterial):Ls.push(new MeshPhongMaterial)),as==="lines"||as==="linestrips")for(let Js=0,ma=Ls.length;Js<ma;Js++){const js=Ls[Js];if(js.isMeshPhongMaterial===!0||js.isMeshLambertMaterial===!0){const da=new LineBasicMaterial;da.color.copy(js.color),da.opacity=js.opacity,da.transparent=js.transparent,Ls[Js]=da}}const Bs=fs.data.attributes.skinIndex!==void 0,aa=Ls.length===1?Ls[0]:Ls;let Ys;switch(as){case"lines":Ys=new LineSegments(fs.data,aa);break;case"linestrips":Ys=new Line(fs.data,aa);break;case"triangles":case"polylist":Bs?Ys=new SkinnedMesh(fs.data,aa):Ys=new Mesh(fs.data,aa);break}hs.push(Ys)}return hs}function Gs(ts){return ba.nodes[ts]!==void 0}function zs(ts){return _r(ba.nodes[ts],Rs)}function Xs(ts){const es={name:ts.getAttribute("name"),children:[]};$i(ts);const hs=rr(ts,"node");for(let as=0;as<hs.length;as++)es.children.push(ws(hs[as]));ba.visualScenes[ts.getAttribute("id")]=es}function na(ts){const es=new Group;es.name=ts.name;const hs=ts.children;for(let as=0;as<hs.length;as++){const fs=hs[as];es.add(zs(fs.id))}return es}function wa(ts){return ba.visualScenes[ts]!==void 0}function fa(ts){return _r(ba.visualScenes[ts],na)}function sa(ts){const es=rr(ts,"instance_visual_scene")[0];return fa(or(es.getAttribute("url")))}function Ea(){const ts=ba.clips;if(cr(ts)===!0){if(cr(ba.animations)===!1){const es=[];for(const hs in ba.animations){const as=yr(hs);for(let fs=0,Ls=as.length;fs<Ls;fs++)es.push(as[fs])}Ga.push(new AnimationClip("default",-1,es))}}else for(const es in ts)Ga.push(Dr(es))}function ca(ts){let es="";const hs=[ts];for(;hs.length;){const as=hs.shift();as.nodeType===Node.TEXT_NODE?es+=as.textContent:(es+=`
`,hs.push.apply(hs,as.childNodes))}return es.trim()}if(er.length===0)return{scene:new Scene};const Da=new DOMParser().parseFromString(er,"application/xml"),Ma=rr(Da,"COLLADA")[0],Pa=Da.getElementsByTagName("parsererror")[0];if(Pa!==void 0){const ts=rr(Pa,"div")[0];let es;return ts?es=ts.textContent:es=ca(Pa),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,es),null}const Ca=Ma.getAttribute("version");console.debug("THREE.ColladaLoader: File version",Ca);const ya=hr(rr(Ma,"asset")[0]),Va=new TextureLoader(this.manager);Va.setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin);let Ha;TGALoader&&(Ha=new TGALoader(this.manager),Ha.setPath(this.resourcePath||tr));const Oa=new Color,Ga=[];let io={},Ja=0;const ba={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};pr(Ma,"library_animations","animation",mr),pr(Ma,"library_animation_clips","animation_clip",Br),pr(Ma,"library_controllers","controller",Wr),pr(Ma,"library_images","image",Vr),pr(Ma,"library_effects","effect",ji),pr(Ma,"library_materials","material",Xi),pr(Ma,"library_cameras","camera",_s),pr(Ma,"library_lights","light",Ns),pr(Ma,"library_geometries","geometry",Ms),pr(Ma,"library_nodes","node",ws),pr(Ma,"library_visual_scenes","visual_scene",Xs),pr(Ma,"library_kinematics_models","kinematics_model",qs),pr(Ma,"library_physics_models","physics_model",qa),pr(Ma,"scene","instance_kinematics_scene",ao),gr(ba.animations,Ar),gr(ba.clips,Or),gr(ba.controllers,rs),gr(ba.images,Gr),gr(ba.effects,Ri),gr(ba.materials,ls),gr(ba.cameras,Is),gr(ba.lights,Vs),gr(ba.geometries,Sa),gr(ba.visualScenes,na),Ea(),cs();const oo=sa(rr(Ma,"scene")[0]);return oo.animations=Ga,ya.upAxis==="Z_UP"&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),oo.rotation.set(-Math.PI/2,0,0)),oo.scale.multiplyScalar(ya.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ga},kinematics:io,library:ba,scene:oo}}}class DDSLoader extends CompressedTextureLoader{constructor(er){super(er)}parse(er,tr){const rr={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},nr=542327876,sr=131072,ar=512,or=1024,lr=2048,cr=4096,hr=8192,fr=16384,ur=32768,pr=95,gr=96;function _r(Yi){return Yi.charCodeAt(0)+(Yi.charCodeAt(1)<<8)+(Yi.charCodeAt(2)<<16)+(Yi.charCodeAt(3)<<24)}function mr(Yi){return String.fromCharCode(Yi&255,Yi>>8&255,Yi>>16&255,Yi>>24&255)}function dr(Yi,qi,Xr,ns){const os=Xr*ns*4,us=new Uint8Array(Yi,qi,os),is=new Uint8Array(os);let Ji=0,ms=0;for(let Ki=0;Ki<ns;Ki++)for(let Ni=0;Ni<Xr;Ni++){const Ri=us[ms];ms++;const Jr=us[ms];ms++;const Xi=us[ms];ms++;const ss=us[ms];ms++,is[Ji]=Xi,Ji++,is[Ji]=Jr,Ji++,is[Ji]=Ri,Ji++,is[Ji]=ss,Ji++}return is}function vr(Yi,qi,Xr,ns){const os=Xr*ns*3,us=new Uint8Array(Yi,qi,os),is=new Uint8Array(Xr*ns*4);let Ji=0,ms=0;for(let Ki=0;Ki<ns;Ki++)for(let Ni=0;Ni<Xr;Ni++){const Ri=us[ms];ms++;const Jr=us[ms];ms++;const Xi=us[ms];ms++,is[Ji]=Xi,Ji++,is[Ji]=Jr,Ji++,is[Ji]=Ri,Ji++,is[Ji]=1,Ji++}return is}const Ar=_r("DXT1"),yr=_r("DXT3"),wr=_r("DXT5"),br=_r("ETC1"),Sr=_r("DX10"),xr=31,Cr=5,Ir=0,Rr=1,Pr=2,Fr=3,Nr=4,Ur=7,Br=21,Or=22,Dr=23,Wr=24,$r=25,Yr=26,Qi=28,rs=0,Kr=new Int32Array(er,0,xr);if(Kr[Ir]!==nr)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),rr;let Qr;const Vr=Kr[Br];let Gr=!1,qr=!1,ji=Kr[Rr]+4;switch(Vr){case Ar:Qr=8,rr.format=RGB_S3TC_DXT1_Format;break;case yr:Qr=16,rr.format=RGBA_S3TC_DXT3_Format;break;case wr:Qr=16,rr.format=RGBA_S3TC_DXT5_Format;break;case br:Qr=8,rr.format=RGB_ETC1_Format;break;case Sr:ji+=Cr*4;const qi=new Int32Array(er,(xr+1)*4,Cr)[rs];switch(qi){case gr:{Qr=16,rr.format=RGB_BPTC_SIGNED_Format;break}case pr:{Qr=16,rr.format=RGB_BPTC_UNSIGNED_Format;break}default:return console.error("THREE.DDSLoader.parse: Unsupported DXGI_FORMAT code ",qi),rr}break;default:if(Kr[Or]===32&&Kr[Dr]&16711680&&Kr[Wr]&65280&&Kr[$r]&255&&Kr[Yr]&4278190080)Gr=!0,Qr=64,rr.format=RGBAFormat;else if(Kr[Or]===24&&Kr[Dr]&16711680&&Kr[Wr]&65280&&Kr[$r]&255)qr=!0,Qr=64,rr.format=RGBAFormat;else return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",mr(Vr)),rr}rr.mipmapCount=1,Kr[Pr]&sr&&tr!==!1&&(rr.mipmapCount=Math.max(1,Kr[Ur]));const Zr=Kr[Qi];if(rr.isCubemap=!!(Zr&ar),rr.isCubemap&&(!(Zr&or)||!(Zr&lr)||!(Zr&cr)||!(Zr&hr)||!(Zr&fr)||!(Zr&ur)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),rr;rr.width=Kr[Nr],rr.height=Kr[Fr];const Zi=rr.isCubemap?6:1;for(let Yi=0;Yi<Zi;Yi++){let qi=rr.width,Xr=rr.height;for(let ns=0;ns<rr.mipmapCount;ns++){let os,us;Gr?(os=dr(er,ji,qi,Xr),us=os.length):qr?(os=vr(er,ji,qi,Xr),us=qi*Xr*3):(us=Math.max(4,qi)/4*Math.max(4,Xr)/4*Qr,os=new Uint8Array(er,ji,us));const is={data:os,width:qi,height:Xr};rr.mipmaps.push(is),ji+=us,qi=Math.max(qi>>1,1),Xr=Math.max(Xr>>1,1)}}return rr}}const _taskCache$1=new WeakMap;class DRACOLoader extends Loader{constructor(er){super(er),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(er){return this.decoderPath=er,this}setDecoderConfig(er){return this.decoderConfig=er,this}setWorkerLimit(er){return this.workerLimit=er,this}load(er,tr,rr,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setResponseType("arraybuffer"),sr.setRequestHeader(this.requestHeader),sr.setWithCredentials(this.withCredentials),sr.load(er,ar=>{this.parse(ar,tr,nr)},rr,nr)}parse(er,tr,rr=()=>{}){this.decodeDracoFile(er,tr,null,null,SRGBColorSpace,rr).catch(rr)}decodeDracoFile(er,tr,rr,nr,sr=LinearSRGBColorSpace,ar=()=>{}){const or={attributeIDs:rr||this.defaultAttributeIDs,attributeTypes:nr||this.defaultAttributeTypes,useUniqueIDs:!!rr,vertexColorSpace:sr};return this.decodeGeometry(er,or).then(tr).catch(ar)}decodeGeometry(er,tr){const rr=JSON.stringify(tr);if(_taskCache$1.has(er)){const lr=_taskCache$1.get(er);if(lr.key===rr)return lr.promise;if(er.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let nr;const sr=this.workerNextTaskID++,ar=er.byteLength,or=this._getWorker(sr,ar).then(lr=>(nr=lr,new Promise((cr,hr)=>{nr._callbacks[sr]={resolve:cr,reject:hr},nr.postMessage({type:"decode",id:sr,taskConfig:tr,buffer:er},[er])}))).then(lr=>this._createGeometry(lr.geometry));return or.catch(()=>!0).then(()=>{nr&&sr&&this._releaseTask(nr,sr)}),_taskCache$1.set(er,{key:rr,promise:or}),or}_createGeometry(er){const tr=new BufferGeometry;er.index&&tr.setIndex(new BufferAttribute(er.index.array,1));for(let rr=0;rr<er.attributes.length;rr++){const nr=er.attributes[rr],sr=nr.name,ar=nr.array,or=nr.itemSize,lr=new BufferAttribute(ar,or);sr==="color"&&(this._assignVertexColorSpace(lr,nr.vertexColorSpace),lr.normalized=!(ar instanceof Float32Array)),tr.setAttribute(sr,lr)}return tr}_assignVertexColorSpace(er,tr){if(tr!==SRGBColorSpace)return;const rr=new Color;for(let nr=0,sr=er.count;nr<sr;nr++)rr.fromBufferAttribute(er,nr),ColorManagement.toWorkingColorSpace(rr,SRGBColorSpace),er.setXYZ(nr,rr.r,rr.g,rr.b)}_loadLibrary(er,tr){const rr=new FileLoader(this.manager);return rr.setPath(this.decoderPath),rr.setResponseType(tr),rr.setWithCredentials(this.withCredentials),new Promise((nr,sr)=>{rr.load(er,nr,void 0,sr)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const er=typeof WebAssembly!="object"||this.decoderConfig.type==="js",tr=[];return er?tr.push(this._loadLibrary("draco_decoder.js","text")):(tr.push(this._loadLibrary("draco_wasm_wrapper.js","text")),tr.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(tr).then(rr=>{const nr=rr[0];er||(this.decoderConfig.wasmBinary=rr[1]);const sr=DRACOWorker.toString(),ar=["/* draco decoder */",nr,"","/* worker */",sr.substring(sr.indexOf("{")+1,sr.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([ar]))}),this.decoderPending}_getWorker(er,tr){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const nr=new Worker(this.workerSourceURL);nr._callbacks={},nr._taskCosts={},nr._taskLoad=0,nr.postMessage({type:"init",decoderConfig:this.decoderConfig}),nr.onmessage=function(sr){const ar=sr.data;switch(ar.type){case"decode":nr._callbacks[ar.id].resolve(ar);break;case"error":nr._callbacks[ar.id].reject(ar);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+ar.type+'"')}},this.workerPool.push(nr)}else this.workerPool.sort(function(nr,sr){return nr._taskLoad>sr._taskLoad?-1:1});const rr=this.workerPool[this.workerPool.length-1];return rr._taskCosts[er]=tr,rr._taskLoad+=tr,rr})}_releaseTask(er,tr){er._taskLoad-=er._taskCosts[tr],delete er._callbacks[tr],delete er._taskCosts[tr]}debug(){console.log("Task load: ",this.workerPool.map(er=>er._taskLoad))}dispose(){for(let er=0;er<this.workerPool.length;++er)this.workerPool[er].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function DRACOWorker(){let ir,er;onmessage=function(ar){const or=ar.data;switch(or.type){case"init":ir=or.decoderConfig,er=new Promise(function(hr){ir.onModuleLoaded=function(fr){hr({draco:fr})},DracoDecoderModule(ir)});break;case"decode":const lr=or.buffer,cr=or.taskConfig;er.then(hr=>{const fr=hr.draco,ur=new fr.Decoder;try{const pr=tr(fr,ur,new Int8Array(lr),cr),gr=pr.attributes.map(_r=>_r.array.buffer);pr.index&&gr.push(pr.index.array.buffer),self.postMessage({type:"decode",id:or.id,geometry:pr},gr)}catch(pr){console.error(pr),self.postMessage({type:"error",id:or.id,error:pr.message})}finally{fr.destroy(ur)}});break}};function tr(ar,or,lr,cr){const hr=cr.attributeIDs,fr=cr.attributeTypes;let ur,pr;const gr=or.GetEncodedGeometryType(lr);if(gr===ar.TRIANGULAR_MESH)ur=new ar.Mesh,pr=or.DecodeArrayToMesh(lr,lr.byteLength,ur);else if(gr===ar.POINT_CLOUD)ur=new ar.PointCloud,pr=or.DecodeArrayToPointCloud(lr,lr.byteLength,ur);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!pr.ok()||ur.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+pr.error_msg());const _r={index:null,attributes:[]};for(const mr in hr){const dr=self[fr[mr]];let vr,Ar;if(cr.useUniqueIDs)Ar=hr[mr],vr=or.GetAttributeByUniqueId(ur,Ar);else{if(Ar=or.GetAttributeId(ur,ar[hr[mr]]),Ar===-1)continue;vr=or.GetAttribute(ur,Ar)}const yr=nr(ar,or,ur,mr,dr,vr);mr==="color"&&(yr.vertexColorSpace=cr.vertexColorSpace),_r.attributes.push(yr)}return gr===ar.TRIANGULAR_MESH&&(_r.index=rr(ar,or,ur)),ar.destroy(ur),_r}function rr(ar,or,lr){const hr=lr.num_faces()*3,fr=hr*4,ur=ar._malloc(fr);or.GetTrianglesUInt32Array(lr,fr,ur);const pr=new Uint32Array(ar.HEAPF32.buffer,ur,hr).slice();return ar._free(ur),{array:pr,itemSize:1}}function nr(ar,or,lr,cr,hr,fr){const ur=fr.num_components(),gr=lr.num_points()*ur,_r=gr*hr.BYTES_PER_ELEMENT,mr=sr(ar,hr),dr=ar._malloc(_r);or.GetAttributeDataArrayForAllPoints(lr,fr,mr,_r,dr);const vr=new hr(ar.HEAPF32.buffer,dr,gr).slice();return ar._free(dr),{name:cr,array:vr,itemSize:ur}}function sr(ar,or){switch(or){case Float32Array:return ar.DT_FLOAT32;case Int8Array:return ar.DT_INT8;case Int16Array:return ar.DT_INT16;case Int32Array:return ar.DT_INT32;case Uint8Array:return ar.DT_UINT8;case Uint16Array:return ar.DT_UINT16;case Uint32Array:return ar.DT_UINT32}}}let fbxTree,connections,sceneGraph;class FBXLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=sr.path===""?LoaderUtils.extractUrlBase(er):sr.path,or=new FileLoader(this.manager);or.setPath(sr.path),or.setResponseType("arraybuffer"),or.setRequestHeader(sr.requestHeader),or.setWithCredentials(sr.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},rr,nr)}parse(er,tr){if(isFbxFormatBinary(er))fbxTree=new BinaryParser().parse(er);else{const nr=convertArrayBufferToString(er);if(!isFbxFormatASCII(nr))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(nr)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(nr));fbxTree=new TextParser().parse(nr)}const rr=new TextureLoader(this.manager).setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin);return new FBXTreeParser(rr,this.manager).parse(fbxTree)}}class FBXTreeParser{constructor(er,tr){this.textureLoader=er,this.manager=tr}parse(){connections=this.parseConnections();const er=this.parseImages(),tr=this.parseTextures(er),rr=this.parseMaterials(tr),nr=this.parseDeformers(),sr=new GeometryParser$1().parse(nr);return this.parseScene(nr,sr,rr),sceneGraph}parseConnections(){const er=new Map;return"Connections"in fbxTree&&fbxTree.Connections.connections.forEach(function(rr){const nr=rr[0],sr=rr[1],ar=rr[2];er.has(nr)||er.set(nr,{parents:[],children:[]});const or={ID:sr,relationship:ar};er.get(nr).parents.push(or),er.has(sr)||er.set(sr,{parents:[],children:[]});const lr={ID:nr,relationship:ar};er.get(sr).children.push(lr)}),er}parseImages(){const er={},tr={};if("Video"in fbxTree.Objects){const rr=fbxTree.Objects.Video;for(const nr in rr){const sr=rr[nr],ar=parseInt(nr);if(er[ar]=sr.RelativeFilename||sr.Filename,"Content"in sr){const or=sr.Content instanceof ArrayBuffer&&sr.Content.byteLength>0,lr=typeof sr.Content=="string"&&sr.Content!=="";if(or||lr){const cr=this.parseImage(rr[nr]);tr[sr.RelativeFilename||sr.Filename]=cr}}}}for(const rr in er){const nr=er[rr];tr[nr]!==void 0?er[rr]=tr[nr]:er[rr]=er[rr].split("\\").pop()}return er}parseImage(er){const tr=er.Content,rr=er.RelativeFilename||er.Filename,nr=rr.slice(rr.lastIndexOf(".")+1).toLowerCase();let sr;switch(nr){case"bmp":sr="image/bmp";break;case"jpg":case"jpeg":sr="image/jpeg";break;case"png":sr="image/png";break;case"tif":sr="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",rr),sr="image/tga";break;default:console.warn('FBXLoader: Image type "'+nr+'" is not supported.');return}if(typeof tr=="string")return"data:"+sr+";base64,"+tr;{const ar=new Uint8Array(tr);return window.URL.createObjectURL(new Blob([ar],{type:sr}))}}parseTextures(er){const tr=new Map;if("Texture"in fbxTree.Objects){const rr=fbxTree.Objects.Texture;for(const nr in rr){const sr=this.parseTexture(rr[nr],er);tr.set(parseInt(nr),sr)}}return tr}parseTexture(er,tr){const rr=this.loadTexture(er,tr);rr.ID=er.id,rr.name=er.attrName;const nr=er.WrapModeU,sr=er.WrapModeV,ar=nr!==void 0?nr.value:0,or=sr!==void 0?sr.value:0;if(rr.wrapS=ar===0?RepeatWrapping:ClampToEdgeWrapping,rr.wrapT=or===0?RepeatWrapping:ClampToEdgeWrapping,"Scaling"in er){const lr=er.Scaling.value;rr.repeat.x=lr[0],rr.repeat.y=lr[1]}if("Translation"in er){const lr=er.Translation.value;rr.offset.x=lr[0],rr.offset.y=lr[1]}return rr}loadTexture(er,tr){const rr=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),nr=er.FileName.split(".").pop().toLowerCase(),sr=rr.has(nr)?this.manager.getHandler(`.${nr}`):this.textureLoader;if(!sr)return console.warn(`FBXLoader: ${nr.toUpperCase()} loader not found, creating placeholder texture for`,er.RelativeFilename),new Texture;const ar=sr.path;ar||sr.setPath(this.textureLoader.path);const or=connections.get(er.id).children;let lr;or!==void 0&&or.length>0&&tr[or[0].ID]!==void 0&&(lr=tr[or[0].ID],(lr.indexOf("blob:")===0||lr.indexOf("data:")===0)&&sr.setPath(void 0));const cr=sr.load(lr);return sr.setPath(ar),cr}parseMaterials(er){const tr=new Map;if("Material"in fbxTree.Objects){const rr=fbxTree.Objects.Material;for(const nr in rr){const sr=this.parseMaterial(rr[nr],er);sr!==null&&tr.set(parseInt(nr),sr)}}return tr}parseMaterial(er,tr){const rr=er.id,nr=er.attrName;let sr=er.ShadingModel;if(typeof sr=="object"&&(sr=sr.value),!connections.has(rr))return null;const ar=this.parseParameters(er,tr,rr);let or;switch(sr.toLowerCase()){case"phong":or=new MeshPhongMaterial;break;case"lambert":or=new MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',sr),or=new MeshPhongMaterial;break}return or.setValues(ar),or.name=nr,or}parseParameters(er,tr,rr){const nr={};er.BumpFactor&&(nr.bumpScale=er.BumpFactor.value),er.Diffuse?nr.color=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.Diffuse.value),SRGBColorSpace):er.DiffuseColor&&(er.DiffuseColor.type==="Color"||er.DiffuseColor.type==="ColorRGB")&&(nr.color=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.DiffuseColor.value),SRGBColorSpace)),er.DisplacementFactor&&(nr.displacementScale=er.DisplacementFactor.value),er.Emissive?nr.emissive=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.Emissive.value),SRGBColorSpace):er.EmissiveColor&&(er.EmissiveColor.type==="Color"||er.EmissiveColor.type==="ColorRGB")&&(nr.emissive=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.EmissiveColor.value),SRGBColorSpace)),er.EmissiveFactor&&(nr.emissiveIntensity=parseFloat(er.EmissiveFactor.value)),nr.opacity=1-(er.TransparencyFactor?parseFloat(er.TransparencyFactor.value):0),(nr.opacity===1||nr.opacity===0)&&(nr.opacity=er.Opacity?parseFloat(er.Opacity.value):null,nr.opacity===null&&(nr.opacity=1-(er.TransparentColor?parseFloat(er.TransparentColor.value[0]):0))),nr.opacity<1&&(nr.transparent=!0),er.ReflectionFactor&&(nr.reflectivity=er.ReflectionFactor.value),er.Shininess&&(nr.shininess=er.Shininess.value),er.Specular?nr.specular=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.Specular.value),SRGBColorSpace):er.SpecularColor&&er.SpecularColor.type==="Color"&&(nr.specular=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.SpecularColor.value),SRGBColorSpace));const sr=this;return connections.get(rr).children.forEach(function(ar){const or=ar.relationship;switch(or){case"Bump":nr.bumpMap=sr.getTexture(tr,ar.ID);break;case"Maya|TEX_ao_map":nr.aoMap=sr.getTexture(tr,ar.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":nr.map=sr.getTexture(tr,ar.ID),nr.map!==void 0&&(nr.map.colorSpace=SRGBColorSpace);break;case"DisplacementColor":nr.displacementMap=sr.getTexture(tr,ar.ID);break;case"EmissiveColor":nr.emissiveMap=sr.getTexture(tr,ar.ID),nr.emissiveMap!==void 0&&(nr.emissiveMap.colorSpace=SRGBColorSpace);break;case"NormalMap":case"Maya|TEX_normal_map":nr.normalMap=sr.getTexture(tr,ar.ID);break;case"ReflectionColor":nr.envMap=sr.getTexture(tr,ar.ID),nr.envMap!==void 0&&(nr.envMap.mapping=EquirectangularReflectionMapping,nr.envMap.colorSpace=SRGBColorSpace);break;case"SpecularColor":nr.specularMap=sr.getTexture(tr,ar.ID),nr.specularMap!==void 0&&(nr.specularMap.colorSpace=SRGBColorSpace);break;case"TransparentColor":case"TransparencyFactor":nr.alphaMap=sr.getTexture(tr,ar.ID),nr.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",or);break}}),nr}getTexture(er,tr){return"LayeredTexture"in fbxTree.Objects&&tr in fbxTree.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),tr=connections.get(tr).children[0].ID),er.get(tr)}parseDeformers(){const er={},tr={};if("Deformer"in fbxTree.Objects){const rr=fbxTree.Objects.Deformer;for(const nr in rr){const sr=rr[nr],ar=connections.get(parseInt(nr));if(sr.attrType==="Skin"){const or=this.parseSkeleton(ar,rr);or.ID=nr,ar.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),or.geometryID=ar.parents[0].ID,er[nr]=or}else if(sr.attrType==="BlendShape"){const or={id:nr};or.rawTargets=this.parseMorphTargets(ar,rr),or.id=nr,ar.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),tr[nr]=or}}}return{skeletons:er,morphTargets:tr}}parseSkeleton(er,tr){const rr=[];return er.children.forEach(function(nr){const sr=tr[nr.ID];if(sr.attrType!=="Cluster")return;const ar={ID:nr.ID,indices:[],weights:[],transformLink:new Matrix4().fromArray(sr.TransformLink.a)};"Indexes"in sr&&(ar.indices=sr.Indexes.a,ar.weights=sr.Weights.a),rr.push(ar)}),{rawBones:rr,bones:[]}}parseMorphTargets(er,tr){const rr=[];for(let nr=0;nr<er.children.length;nr++){const sr=er.children[nr],ar=tr[sr.ID],or={name:ar.attrName,initialWeight:ar.DeformPercent,id:ar.id,fullWeights:ar.FullWeights.a};if(ar.attrType!=="BlendShapeChannel")return;or.geoID=connections.get(parseInt(sr.ID)).children.filter(function(lr){return lr.relationship===void 0})[0].ID,rr.push(or)}return rr}parseScene(er,tr,rr){sceneGraph=new Group;const nr=this.parseModels(er.skeletons,tr,rr),sr=fbxTree.Objects.Model,ar=this;nr.forEach(function(lr){const cr=sr[lr.ID];ar.setLookAtProperties(lr,cr),connections.get(lr.ID).parents.forEach(function(fr){const ur=nr.get(fr.ID);ur!==void 0&&ur.add(lr)}),lr.parent===null&&sceneGraph.add(lr)}),this.bindSkeleton(er.skeletons,tr,nr),this.addGlobalSceneSettings(),sceneGraph.traverse(function(lr){if(lr.userData.transformData){lr.parent&&(lr.userData.transformData.parentMatrix=lr.parent.matrix,lr.userData.transformData.parentMatrixWorld=lr.parent.matrixWorld);const cr=generateTransform(lr.userData.transformData);lr.applyMatrix4(cr),lr.updateWorldMatrix()}});const or=new AnimationParser().parse();sceneGraph.children.length===1&&sceneGraph.children[0].isGroup&&(sceneGraph.children[0].animations=or,sceneGraph=sceneGraph.children[0]),sceneGraph.animations=or}parseModels(er,tr,rr){const nr=new Map,sr=fbxTree.Objects.Model;for(const ar in sr){const or=parseInt(ar),lr=sr[ar],cr=connections.get(or);let hr=this.buildSkeleton(cr,er,or,lr.attrName);if(!hr){switch(lr.attrType){case"Camera":hr=this.createCamera(cr);break;case"Light":hr=this.createLight(cr);break;case"Mesh":hr=this.createMesh(cr,tr,rr);break;case"NurbsCurve":hr=this.createCurve(cr,tr);break;case"LimbNode":case"Root":hr=new Bone;break;case"Null":default:hr=new Group;break}hr.name=lr.attrName?PropertyBinding.sanitizeNodeName(lr.attrName):"",hr.userData.originalName=lr.attrName,hr.ID=or}this.getTransformData(hr,lr),nr.set(or,hr)}return nr}buildSkeleton(er,tr,rr,nr){let sr=null;return er.parents.forEach(function(ar){for(const or in tr){const lr=tr[or];lr.rawBones.forEach(function(cr,hr){if(cr.ID===ar.ID){const fr=sr;sr=new Bone,sr.matrixWorld.copy(cr.transformLink),sr.name=nr?PropertyBinding.sanitizeNodeName(nr):"",sr.userData.originalName=nr,sr.ID=rr,lr.bones[hr]=sr,fr!==null&&sr.add(fr)}})}}),sr}createCamera(er){let tr,rr;if(er.children.forEach(function(nr){const sr=fbxTree.Objects.NodeAttribute[nr.ID];sr!==void 0&&(rr=sr)}),rr===void 0)tr=new Object3D;else{let nr=0;rr.CameraProjectionType!==void 0&&rr.CameraProjectionType.value===1&&(nr=1);let sr=1;rr.NearPlane!==void 0&&(sr=rr.NearPlane.value/1e3);let ar=1e3;rr.FarPlane!==void 0&&(ar=rr.FarPlane.value/1e3);let or=window.innerWidth,lr=window.innerHeight;rr.AspectWidth!==void 0&&rr.AspectHeight!==void 0&&(or=rr.AspectWidth.value,lr=rr.AspectHeight.value);const cr=or/lr;let hr=45;rr.FieldOfView!==void 0&&(hr=rr.FieldOfView.value);const fr=rr.FocalLength?rr.FocalLength.value:null;switch(nr){case 0:tr=new PerspectiveCamera(hr,cr,sr,ar),fr!==null&&tr.setFocalLength(fr);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),tr=new Object3D;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+nr+"."),tr=new Object3D;break}}return tr}createLight(er){let tr,rr;if(er.children.forEach(function(nr){const sr=fbxTree.Objects.NodeAttribute[nr.ID];sr!==void 0&&(rr=sr)}),rr===void 0)tr=new Object3D;else{let nr;rr.LightType===void 0?nr=0:nr=rr.LightType.value;let sr=16777215;rr.Color!==void 0&&(sr=ColorManagement.toWorkingColorSpace(new Color().fromArray(rr.Color.value),SRGBColorSpace));let ar=rr.Intensity===void 0?1:rr.Intensity.value/100;rr.CastLightOnObject!==void 0&&rr.CastLightOnObject.value===0&&(ar=0);let or=0;rr.FarAttenuationEnd!==void 0&&(rr.EnableFarAttenuation!==void 0&&rr.EnableFarAttenuation.value===0?or=0:or=rr.FarAttenuationEnd.value);const lr=1;switch(nr){case 0:tr=new PointLight(sr,ar,or,lr);break;case 1:tr=new DirectionalLight(sr,ar);break;case 2:let cr=Math.PI/3;rr.InnerAngle!==void 0&&(cr=MathUtils.degToRad(rr.InnerAngle.value));let hr=0;rr.OuterAngle!==void 0&&(hr=MathUtils.degToRad(rr.OuterAngle.value),hr=Math.max(hr,1)),tr=new SpotLight(sr,ar,or,cr,hr,lr);break;default:console.warn("THREE.FBXLoader: Unknown light type "+rr.LightType.value+", defaulting to a PointLight."),tr=new PointLight(sr,ar);break}rr.CastShadows!==void 0&&rr.CastShadows.value===1&&(tr.castShadow=!0)}return tr}createMesh(er,tr,rr){let nr,sr=null,ar=null;const or=[];return er.children.forEach(function(lr){tr.has(lr.ID)&&(sr=tr.get(lr.ID)),rr.has(lr.ID)&&or.push(rr.get(lr.ID))}),or.length>1?ar=or:or.length>0?ar=or[0]:(ar=new MeshPhongMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:13421772}),or.push(ar)),"color"in sr.attributes&&or.forEach(function(lr){lr.vertexColors=!0}),sr.FBX_Deformer?(nr=new SkinnedMesh(sr,ar),nr.normalizeSkinWeights()):nr=new Mesh(sr,ar),nr}createCurve(er,tr){const rr=er.children.reduce(function(sr,ar){return tr.has(ar.ID)&&(sr=tr.get(ar.ID)),sr},null),nr=new LineBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Line(rr,nr)}getTransformData(er,tr){const rr={};"InheritType"in tr&&(rr.inheritType=parseInt(tr.InheritType.value)),"RotationOrder"in tr?rr.eulerOrder=getEulerOrder(tr.RotationOrder.value):rr.eulerOrder=getEulerOrder(0),"Lcl_Translation"in tr&&(rr.translation=tr.Lcl_Translation.value),"PreRotation"in tr&&(rr.preRotation=tr.PreRotation.value),"Lcl_Rotation"in tr&&(rr.rotation=tr.Lcl_Rotation.value),"PostRotation"in tr&&(rr.postRotation=tr.PostRotation.value),"Lcl_Scaling"in tr&&(rr.scale=tr.Lcl_Scaling.value),"ScalingOffset"in tr&&(rr.scalingOffset=tr.ScalingOffset.value),"ScalingPivot"in tr&&(rr.scalingPivot=tr.ScalingPivot.value),"RotationOffset"in tr&&(rr.rotationOffset=tr.RotationOffset.value),"RotationPivot"in tr&&(rr.rotationPivot=tr.RotationPivot.value),er.userData.transformData=rr}setLookAtProperties(er,tr){"LookAtProperty"in tr&&connections.get(er.ID).children.forEach(function(nr){if(nr.relationship==="LookAtProperty"){const sr=fbxTree.Objects.Model[nr.ID];if("Lcl_Translation"in sr){const ar=sr.Lcl_Translation.value;er.target!==void 0?(er.target.position.fromArray(ar),sceneGraph.add(er.target)):er.lookAt(new Vector3$1().fromArray(ar))}}})}bindSkeleton(er,tr,rr){const nr=this.parsePoseNodes();for(const sr in er){const ar=er[sr];connections.get(parseInt(ar.ID)).parents.forEach(function(lr){if(tr.has(lr.ID)){const cr=lr.ID;connections.get(cr).parents.forEach(function(fr){rr.has(fr.ID)&&rr.get(fr.ID).bind(new Skeleton(ar.bones),nr[fr.ID])})}})}}parsePoseNodes(){const er={};if("Pose"in fbxTree.Objects){const tr=fbxTree.Objects.Pose;for(const rr in tr)if(tr[rr].attrType==="BindPose"&&tr[rr].NbPoseNodes>0){const nr=tr[rr].PoseNode;Array.isArray(nr)?nr.forEach(function(sr){er[sr.Node]=new Matrix4().fromArray(sr.Matrix.a)}):er[nr.Node]=new Matrix4().fromArray(nr.Matrix.a)}}return er}addGlobalSceneSettings(){if("GlobalSettings"in fbxTree){if("AmbientColor"in fbxTree.GlobalSettings){const er=fbxTree.GlobalSettings.AmbientColor.value,tr=er[0],rr=er[1],nr=er[2];if(tr!==0||rr!==0||nr!==0){const sr=new Color().setRGB(tr,rr,nr,SRGBColorSpace);sceneGraph.add(new AmbientLight(sr,1))}}"UnitScaleFactor"in fbxTree.GlobalSettings&&(sceneGraph.userData.unitScaleFactor=fbxTree.GlobalSettings.UnitScaleFactor.value)}}}let GeometryParser$1=class{constructor(){this.negativeMaterialIndices=!1}parse(er){const tr=new Map;if("Geometry"in fbxTree.Objects){const rr=fbxTree.Objects.Geometry;for(const nr in rr){const sr=connections.get(parseInt(nr)),ar=this.parseGeometry(sr,rr[nr],er);tr.set(parseInt(nr),ar)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),tr}parseGeometry(er,tr,rr){switch(tr.attrType){case"Mesh":return this.parseMeshGeometry(er,tr,rr);case"NurbsCurve":return this.parseNurbsGeometry(tr)}}parseMeshGeometry(er,tr,rr){const nr=rr.skeletons,sr=[],ar=er.parents.map(function(fr){return fbxTree.Objects.Model[fr.ID]});if(ar.length===0)return;const or=er.children.reduce(function(fr,ur){return nr[ur.ID]!==void 0&&(fr=nr[ur.ID]),fr},null);er.children.forEach(function(fr){rr.morphTargets[fr.ID]!==void 0&&sr.push(rr.morphTargets[fr.ID])});const lr=ar[0],cr={};"RotationOrder"in lr&&(cr.eulerOrder=getEulerOrder(lr.RotationOrder.value)),"InheritType"in lr&&(cr.inheritType=parseInt(lr.InheritType.value)),"GeometricTranslation"in lr&&(cr.translation=lr.GeometricTranslation.value),"GeometricRotation"in lr&&(cr.rotation=lr.GeometricRotation.value),"GeometricScaling"in lr&&(cr.scale=lr.GeometricScaling.value);const hr=generateTransform(cr);return this.genGeometry(tr,or,sr,hr)}genGeometry(er,tr,rr,nr){const sr=new BufferGeometry;er.attrName&&(sr.name=er.attrName);const ar=this.parseGeoNode(er,tr),or=this.genBuffers(ar),lr=new Float32BufferAttribute(or.vertex,3);if(lr.applyMatrix4(nr),sr.setAttribute("position",lr),or.colors.length>0&&sr.setAttribute("color",new Float32BufferAttribute(or.colors,3)),tr&&(sr.setAttribute("skinIndex",new Uint16BufferAttribute(or.weightsIndices,4)),sr.setAttribute("skinWeight",new Float32BufferAttribute(or.vertexWeights,4)),sr.FBX_Deformer=tr),or.normal.length>0){const cr=new Matrix3().getNormalMatrix(nr),hr=new Float32BufferAttribute(or.normal,3);hr.applyNormalMatrix(cr),sr.setAttribute("normal",hr)}if(or.uvs.forEach(function(cr,hr){const fr=hr===0?"uv":`uv${hr}`;sr.setAttribute(fr,new Float32BufferAttribute(or.uvs[hr],2))}),ar.material&&ar.material.mappingType!=="AllSame"){let cr=or.materialIndex[0],hr=0;if(or.materialIndex.forEach(function(fr,ur){fr!==cr&&(sr.addGroup(hr,ur-hr,cr),cr=fr,hr=ur)}),sr.groups.length>0){const fr=sr.groups[sr.groups.length-1],ur=fr.start+fr.count;ur!==or.materialIndex.length&&sr.addGroup(ur,or.materialIndex.length-ur,cr)}sr.groups.length===0&&sr.addGroup(0,or.materialIndex.length,or.materialIndex[0])}return this.addMorphTargets(sr,er,rr,nr),sr}parseGeoNode(er,tr){const rr={};if(rr.vertexPositions=er.Vertices!==void 0?er.Vertices.a:[],rr.vertexIndices=er.PolygonVertexIndex!==void 0?er.PolygonVertexIndex.a:[],er.LayerElementColor&&(rr.color=this.parseVertexColors(er.LayerElementColor[0])),er.LayerElementMaterial&&(rr.material=this.parseMaterialIndices(er.LayerElementMaterial[0])),er.LayerElementNormal&&(rr.normal=this.parseNormals(er.LayerElementNormal[0])),er.LayerElementUV){rr.uv=[];let nr=0;for(;er.LayerElementUV[nr];)er.LayerElementUV[nr].UV&&rr.uv.push(this.parseUVs(er.LayerElementUV[nr])),nr++}return rr.weightTable={},tr!==null&&(rr.skeleton=tr,tr.rawBones.forEach(function(nr,sr){nr.indices.forEach(function(ar,or){rr.weightTable[ar]===void 0&&(rr.weightTable[ar]=[]),rr.weightTable[ar].push({id:sr,weight:nr.weights[or]})})})),rr}genBuffers(er){const tr={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let rr=0,nr=0,sr=!1,ar=[],or=[],lr=[],cr=[],hr=[],fr=[];const ur=this;return er.vertexIndices.forEach(function(pr,gr){let _r,mr=!1;pr<0&&(pr=pr^-1,mr=!0);let dr=[],vr=[];if(ar.push(pr*3,pr*3+1,pr*3+2),er.color){const Ar=getData(gr,rr,pr,er.color);lr.push(Ar[0],Ar[1],Ar[2])}if(er.skeleton){if(er.weightTable[pr]!==void 0&&er.weightTable[pr].forEach(function(Ar){vr.push(Ar.weight),dr.push(Ar.id)}),vr.length>4){sr||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),sr=!0);const Ar=[0,0,0,0],yr=[0,0,0,0];vr.forEach(function(wr,br){let Sr=wr,xr=dr[br];yr.forEach(function(Cr,Ir,Rr){if(Sr>Cr){Rr[Ir]=Sr,Sr=Cr;const Pr=Ar[Ir];Ar[Ir]=xr,xr=Pr}})}),dr=Ar,vr=yr}for(;vr.length<4;)vr.push(0),dr.push(0);for(let Ar=0;Ar<4;++Ar)hr.push(vr[Ar]),fr.push(dr[Ar])}if(er.normal){const Ar=getData(gr,rr,pr,er.normal);or.push(Ar[0],Ar[1],Ar[2])}er.material&&er.material.mappingType!=="AllSame"&&(_r=getData(gr,rr,pr,er.material)[0],_r<0&&(ur.negativeMaterialIndices=!0,_r=0)),er.uv&&er.uv.forEach(function(Ar,yr){const wr=getData(gr,rr,pr,Ar);cr[yr]===void 0&&(cr[yr]=[]),cr[yr].push(wr[0]),cr[yr].push(wr[1])}),nr++,mr&&(ur.genFace(tr,er,ar,_r,or,lr,cr,hr,fr,nr),rr++,nr=0,ar=[],or=[],lr=[],cr=[],hr=[],fr=[])}),tr}getNormalNewell(er){const tr=new Vector3$1(0,0,0);for(let rr=0;rr<er.length;rr++){const nr=er[rr],sr=er[(rr+1)%er.length];tr.x+=(nr.y-sr.y)*(nr.z+sr.z),tr.y+=(nr.z-sr.z)*(nr.x+sr.x),tr.z+=(nr.x-sr.x)*(nr.y+sr.y)}return tr.normalize(),tr}getNormalTangentAndBitangent(er){const tr=this.getNormalNewell(er),nr=(Math.abs(tr.z)>.5?new Vector3$1(0,1,0):new Vector3$1(0,0,1)).cross(tr).normalize(),sr=tr.clone().cross(nr).normalize();return{normal:tr,tangent:nr,bitangent:sr}}flattenVertex(er,tr,rr){return new Vector2(er.dot(tr),er.dot(rr))}genFace(er,tr,rr,nr,sr,ar,or,lr,cr,hr){let fr;if(hr>3){const ur=[],pr=tr.baseVertexPositions||tr.vertexPositions;for(let dr=0;dr<rr.length;dr+=3)ur.push(new Vector3$1(pr[rr[dr]],pr[rr[dr+1]],pr[rr[dr+2]]));const{tangent:gr,bitangent:_r}=this.getNormalTangentAndBitangent(ur),mr=[];for(const dr of ur)mr.push(this.flattenVertex(dr,gr,_r));fr=ShapeUtils.triangulateShape(mr,[])}else fr=[[0,1,2]];for(const[ur,pr,gr]of fr)er.vertex.push(tr.vertexPositions[rr[ur*3]]),er.vertex.push(tr.vertexPositions[rr[ur*3+1]]),er.vertex.push(tr.vertexPositions[rr[ur*3+2]]),er.vertex.push(tr.vertexPositions[rr[pr*3]]),er.vertex.push(tr.vertexPositions[rr[pr*3+1]]),er.vertex.push(tr.vertexPositions[rr[pr*3+2]]),er.vertex.push(tr.vertexPositions[rr[gr*3]]),er.vertex.push(tr.vertexPositions[rr[gr*3+1]]),er.vertex.push(tr.vertexPositions[rr[gr*3+2]]),tr.skeleton&&(er.vertexWeights.push(lr[ur*4]),er.vertexWeights.push(lr[ur*4+1]),er.vertexWeights.push(lr[ur*4+2]),er.vertexWeights.push(lr[ur*4+3]),er.vertexWeights.push(lr[pr*4]),er.vertexWeights.push(lr[pr*4+1]),er.vertexWeights.push(lr[pr*4+2]),er.vertexWeights.push(lr[pr*4+3]),er.vertexWeights.push(lr[gr*4]),er.vertexWeights.push(lr[gr*4+1]),er.vertexWeights.push(lr[gr*4+2]),er.vertexWeights.push(lr[gr*4+3]),er.weightsIndices.push(cr[ur*4]),er.weightsIndices.push(cr[ur*4+1]),er.weightsIndices.push(cr[ur*4+2]),er.weightsIndices.push(cr[ur*4+3]),er.weightsIndices.push(cr[pr*4]),er.weightsIndices.push(cr[pr*4+1]),er.weightsIndices.push(cr[pr*4+2]),er.weightsIndices.push(cr[pr*4+3]),er.weightsIndices.push(cr[gr*4]),er.weightsIndices.push(cr[gr*4+1]),er.weightsIndices.push(cr[gr*4+2]),er.weightsIndices.push(cr[gr*4+3])),tr.color&&(er.colors.push(ar[ur*3]),er.colors.push(ar[ur*3+1]),er.colors.push(ar[ur*3+2]),er.colors.push(ar[pr*3]),er.colors.push(ar[pr*3+1]),er.colors.push(ar[pr*3+2]),er.colors.push(ar[gr*3]),er.colors.push(ar[gr*3+1]),er.colors.push(ar[gr*3+2])),tr.material&&tr.material.mappingType!=="AllSame"&&(er.materialIndex.push(nr),er.materialIndex.push(nr),er.materialIndex.push(nr)),tr.normal&&(er.normal.push(sr[ur*3]),er.normal.push(sr[ur*3+1]),er.normal.push(sr[ur*3+2]),er.normal.push(sr[pr*3]),er.normal.push(sr[pr*3+1]),er.normal.push(sr[pr*3+2]),er.normal.push(sr[gr*3]),er.normal.push(sr[gr*3+1]),er.normal.push(sr[gr*3+2])),tr.uv&&tr.uv.forEach(function(_r,mr){er.uvs[mr]===void 0&&(er.uvs[mr]=[]),er.uvs[mr].push(or[mr][ur*2]),er.uvs[mr].push(or[mr][ur*2+1]),er.uvs[mr].push(or[mr][pr*2]),er.uvs[mr].push(or[mr][pr*2+1]),er.uvs[mr].push(or[mr][gr*2]),er.uvs[mr].push(or[mr][gr*2+1])})}addMorphTargets(er,tr,rr,nr){if(rr.length===0)return;er.morphTargetsRelative=!0,er.morphAttributes.position=[];const sr=this;rr.forEach(function(ar){ar.rawTargets.forEach(function(or){const lr=fbxTree.Objects.Geometry[or.geoID];lr!==void 0&&sr.genMorphGeometry(er,tr,lr,nr,or.name)})})}genMorphGeometry(er,tr,rr,nr,sr){const ar=tr.Vertices!==void 0?tr.Vertices.a:[],or=tr.PolygonVertexIndex!==void 0?tr.PolygonVertexIndex.a:[],lr=rr.Vertices!==void 0?rr.Vertices.a:[],cr=rr.Indexes!==void 0?rr.Indexes.a:[],hr=er.attributes.position.count*3,fr=new Float32Array(hr);for(let _r=0;_r<cr.length;_r++){const mr=cr[_r]*3;fr[mr]=lr[_r*3],fr[mr+1]=lr[_r*3+1],fr[mr+2]=lr[_r*3+2]}const ur={vertexIndices:or,vertexPositions:fr,baseVertexPositions:ar},pr=this.genBuffers(ur),gr=new Float32BufferAttribute(pr.vertex,3);gr.name=sr||rr.attrName,gr.applyMatrix4(nr),er.morphAttributes.position.push(gr)}parseNormals(er){const tr=er.MappingInformationType,rr=er.ReferenceInformationType,nr=er.Normals.a;let sr=[];return rr==="IndexToDirect"&&("NormalIndex"in er?sr=er.NormalIndex.a:"NormalsIndex"in er&&(sr=er.NormalsIndex.a)),{dataSize:3,buffer:nr,indices:sr,mappingType:tr,referenceType:rr}}parseUVs(er){const tr=er.MappingInformationType,rr=er.ReferenceInformationType,nr=er.UV.a;let sr=[];return rr==="IndexToDirect"&&(sr=er.UVIndex.a),{dataSize:2,buffer:nr,indices:sr,mappingType:tr,referenceType:rr}}parseVertexColors(er){const tr=er.MappingInformationType,rr=er.ReferenceInformationType,nr=er.Colors.a;let sr=[];rr==="IndexToDirect"&&(sr=er.ColorIndex.a);for(let ar=0,or=new Color;ar<nr.length;ar+=4)or.fromArray(nr,ar),ColorManagement.toWorkingColorSpace(or,SRGBColorSpace),or.toArray(nr,ar);return{dataSize:4,buffer:nr,indices:sr,mappingType:tr,referenceType:rr}}parseMaterialIndices(er){const tr=er.MappingInformationType,rr=er.ReferenceInformationType;if(tr==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:rr};const nr=er.Materials.a,sr=[];for(let ar=0;ar<nr.length;++ar)sr.push(ar);return{dataSize:1,buffer:nr,indices:sr,mappingType:tr,referenceType:rr}}parseNurbsGeometry(er){const tr=parseInt(er.Order);if(isNaN(tr))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",er.Order,er.id),new BufferGeometry;const rr=tr-1,nr=er.KnotVector.a,sr=[],ar=er.Points.a;for(let fr=0,ur=ar.length;fr<ur;fr+=4)sr.push(new Vector4().fromArray(ar,fr));let or,lr;if(er.Form==="Closed")sr.push(sr[0]);else if(er.Form==="Periodic"){or=rr,lr=nr.length-1-or;for(let fr=0;fr<rr;++fr)sr.push(sr[fr])}const hr=new NURBSCurve(rr,nr,sr,or,lr).getPoints(sr.length*12);return new BufferGeometry().setFromPoints(hr)}};class AnimationParser{parse(){const er=[],tr=this.parseClips();if(tr!==void 0)for(const rr in tr){const nr=tr[rr],sr=this.addClip(nr);er.push(sr)}return er}parseClips(){if(fbxTree.Objects.AnimationCurve===void 0)return;const er=this.parseAnimationCurveNodes();this.parseAnimationCurves(er);const tr=this.parseAnimationLayers(er);return this.parseAnimStacks(tr)}parseAnimationCurveNodes(){const er=fbxTree.Objects.AnimationCurveNode,tr=new Map;for(const rr in er){const nr=er[rr];if(nr.attrName.match(/S|R|T|DeformPercent/)!==null){const sr={id:nr.id,attr:nr.attrName,curves:{}};tr.set(sr.id,sr)}}return tr}parseAnimationCurves(er){const tr=fbxTree.Objects.AnimationCurve;for(const rr in tr){const nr={id:tr[rr].id,times:tr[rr].KeyTime.a.map(convertFBXTimeToSeconds),values:tr[rr].KeyValueFloat.a},sr=connections.get(nr.id);if(sr!==void 0){const ar=sr.parents[0].ID,or=sr.parents[0].relationship;or.match(/X/)?er.get(ar).curves.x=nr:or.match(/Y/)?er.get(ar).curves.y=nr:or.match(/Z/)?er.get(ar).curves.z=nr:or.match(/DeformPercent/)&&er.has(ar)&&(er.get(ar).curves.morph=nr)}}}parseAnimationLayers(er){const tr=fbxTree.Objects.AnimationLayer,rr=new Map;for(const nr in tr){const sr=[],ar=connections.get(parseInt(nr));ar!==void 0&&(ar.children.forEach(function(lr,cr){if(er.has(lr.ID)){const hr=er.get(lr.ID);if(hr.curves.x!==void 0||hr.curves.y!==void 0||hr.curves.z!==void 0){if(sr[cr]===void 0){const fr=connections.get(lr.ID).parents.filter(function(ur){return ur.relationship!==void 0})[0].ID;if(fr!==void 0){const ur=fbxTree.Objects.Model[fr.toString()];if(ur===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",lr);return}const pr={modelName:ur.attrName?PropertyBinding.sanitizeNodeName(ur.attrName):"",ID:ur.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};sceneGraph.traverse(function(gr){gr.ID===ur.id&&(pr.transform=gr.matrix,gr.userData.transformData&&(pr.eulerOrder=gr.userData.transformData.eulerOrder))}),pr.transform||(pr.transform=new Matrix4),"PreRotation"in ur&&(pr.preRotation=ur.PreRotation.value),"PostRotation"in ur&&(pr.postRotation=ur.PostRotation.value),sr[cr]=pr}}sr[cr]&&(sr[cr][hr.attr]=hr)}else if(hr.curves.morph!==void 0){if(sr[cr]===void 0){const fr=connections.get(lr.ID).parents.filter(function(dr){return dr.relationship!==void 0})[0].ID,ur=connections.get(fr).parents[0].ID,pr=connections.get(ur).parents[0].ID,gr=connections.get(pr).parents[0].ID,_r=fbxTree.Objects.Model[gr],mr={modelName:_r.attrName?PropertyBinding.sanitizeNodeName(_r.attrName):"",morphName:fbxTree.Objects.Deformer[fr].attrName};sr[cr]=mr}sr[cr][hr.attr]=hr}}}),rr.set(parseInt(nr),sr))}return rr}parseAnimStacks(er){const tr=fbxTree.Objects.AnimationStack,rr={};for(const nr in tr){const sr=connections.get(parseInt(nr)).children;sr.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const ar=er.get(sr[0].ID);rr[nr]={name:tr[nr].attrName,layer:ar}}return rr}addClip(er){let tr=[];const rr=this;return er.layer.forEach(function(nr){tr=tr.concat(rr.generateTracks(nr))}),new AnimationClip(er.name,-1,tr)}generateTracks(er){const tr=[];let rr=new Vector3$1,nr=new Vector3$1;if(er.transform&&er.transform.decompose(rr,new Quaternion$1,nr),rr=rr.toArray(),nr=nr.toArray(),er.T!==void 0&&Object.keys(er.T.curves).length>0){const sr=this.generateVectorTrack(er.modelName,er.T.curves,rr,"position");sr!==void 0&&tr.push(sr)}if(er.R!==void 0&&Object.keys(er.R.curves).length>0){const sr=this.generateRotationTrack(er.modelName,er.R.curves,er.preRotation,er.postRotation,er.eulerOrder);sr!==void 0&&tr.push(sr)}if(er.S!==void 0&&Object.keys(er.S.curves).length>0){const sr=this.generateVectorTrack(er.modelName,er.S.curves,nr,"scale");sr!==void 0&&tr.push(sr)}if(er.DeformPercent!==void 0){const sr=this.generateMorphTrack(er);sr!==void 0&&tr.push(sr)}return tr}generateVectorTrack(er,tr,rr,nr){const sr=this.getTimesForAllAxes(tr),ar=this.getKeyframeTrackValues(sr,tr,rr);return new VectorKeyframeTrack(er+"."+nr,sr,ar)}generateRotationTrack(er,tr,rr,nr,sr){let ar,or;if(tr.x!==void 0&&tr.y!==void 0&&tr.z!==void 0){const ur=this.interpolateRotations(tr.x,tr.y,tr.z,sr);ar=ur[0],or=ur[1]}const lr=getEulerOrder(0);rr!==void 0&&(rr=rr.map(MathUtils.degToRad),rr.push(lr),rr=new Euler().fromArray(rr),rr=new Quaternion$1().setFromEuler(rr)),nr!==void 0&&(nr=nr.map(MathUtils.degToRad),nr.push(lr),nr=new Euler().fromArray(nr),nr=new Quaternion$1().setFromEuler(nr).invert());const cr=new Quaternion$1,hr=new Euler,fr=[];if(!or||!ar)return new QuaternionKeyframeTrack(er+".quaternion",[0],[0]);for(let ur=0;ur<or.length;ur+=3)hr.set(or[ur],or[ur+1],or[ur+2],sr),cr.setFromEuler(hr),rr!==void 0&&cr.premultiply(rr),nr!==void 0&&cr.multiply(nr),ur>2&&new Quaternion$1().fromArray(fr,(ur-3)/3*4).dot(cr)<0&&cr.set(-cr.x,-cr.y,-cr.z,-cr.w),cr.toArray(fr,ur/3*4);return new QuaternionKeyframeTrack(er+".quaternion",ar,fr)}generateMorphTrack(er){const tr=er.DeformPercent.curves.morph,rr=tr.values.map(function(sr){return sr/100}),nr=sceneGraph.getObjectByName(er.modelName).morphTargetDictionary[er.morphName];return new NumberKeyframeTrack(er.modelName+".morphTargetInfluences["+nr+"]",tr.times,rr)}getTimesForAllAxes(er){let tr=[];if(er.x!==void 0&&(tr=tr.concat(er.x.times)),er.y!==void 0&&(tr=tr.concat(er.y.times)),er.z!==void 0&&(tr=tr.concat(er.z.times)),tr=tr.sort(function(rr,nr){return rr-nr}),tr.length>1){let rr=1,nr=tr[0];for(let sr=1;sr<tr.length;sr++){const ar=tr[sr];ar!==nr&&(tr[rr]=ar,nr=ar,rr++)}tr=tr.slice(0,rr)}return tr}getKeyframeTrackValues(er,tr,rr){const nr=rr,sr=[];let ar=-1,or=-1,lr=-1;return er.forEach(function(cr){if(tr.x&&(ar=tr.x.times.indexOf(cr)),tr.y&&(or=tr.y.times.indexOf(cr)),tr.z&&(lr=tr.z.times.indexOf(cr)),ar!==-1){const hr=tr.x.values[ar];sr.push(hr),nr[0]=hr}else sr.push(nr[0]);if(or!==-1){const hr=tr.y.values[or];sr.push(hr),nr[1]=hr}else sr.push(nr[1]);if(lr!==-1){const hr=tr.z.values[lr];sr.push(hr),nr[2]=hr}else sr.push(nr[2])}),sr}interpolateRotations(er,tr,rr,nr){const sr=[],ar=[];sr.push(er.times[0]),ar.push(MathUtils.degToRad(er.values[0])),ar.push(MathUtils.degToRad(tr.values[0])),ar.push(MathUtils.degToRad(rr.values[0]));for(let or=1;or<er.values.length;or++){const lr=[er.values[or-1],tr.values[or-1],rr.values[or-1]];if(isNaN(lr[0])||isNaN(lr[1])||isNaN(lr[2]))continue;const cr=lr.map(MathUtils.degToRad),hr=[er.values[or],tr.values[or],rr.values[or]];if(isNaN(hr[0])||isNaN(hr[1])||isNaN(hr[2]))continue;const fr=hr.map(MathUtils.degToRad),ur=[hr[0]-lr[0],hr[1]-lr[1],hr[2]-lr[2]],pr=[Math.abs(ur[0]),Math.abs(ur[1]),Math.abs(ur[2])];if(pr[0]>=180||pr[1]>=180||pr[2]>=180){const _r=Math.max(...pr)/180,mr=new Euler(...cr,nr),dr=new Euler(...fr,nr),vr=new Quaternion$1().setFromEuler(mr),Ar=new Quaternion$1().setFromEuler(dr);vr.dot(Ar)&&Ar.set(-Ar.x,-Ar.y,-Ar.z,-Ar.w);const yr=er.times[or-1],wr=er.times[or]-yr,br=new Quaternion$1,Sr=new Euler;for(let xr=0;xr<1;xr+=1/_r)br.copy(vr.clone().slerp(Ar.clone(),xr)),sr.push(yr+xr*wr),Sr.setFromQuaternion(br,nr),ar.push(Sr.x),ar.push(Sr.y),ar.push(Sr.z)}else sr.push(er.times[or]),ar.push(MathUtils.degToRad(er.values[or])),ar.push(MathUtils.degToRad(tr.values[or])),ar.push(MathUtils.degToRad(rr.values[or]))}return[sr,ar]}}class TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(er){this.nodeStack.push(er),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(er,tr){this.currentProp=er,this.currentPropName=tr}parse(er){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const tr=this,rr=er.split(/[\r\n]+/);return rr.forEach(function(nr,sr){const ar=nr.match(/^[\s\t]*;/),or=nr.match(/^[\s\t]*$/);if(ar||or)return;const lr=nr.match("^\\t{"+tr.currentIndent+"}(\\w+):(.*){",""),cr=nr.match("^\\t{"+tr.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),hr=nr.match("^\\t{"+(tr.currentIndent-1)+"}}");lr?tr.parseNodeBegin(nr,lr):cr?tr.parseNodeProperty(nr,cr,rr[++sr]):hr?tr.popStack():nr.match(/^[^\s\t}]/)&&tr.parseNodePropertyContinued(nr)}),this.allNodes}parseNodeBegin(er,tr){const rr=tr[1].trim().replace(/^"/,"").replace(/"$/,""),nr=tr[2].split(",").map(function(lr){return lr.trim().replace(/^"/,"").replace(/"$/,"")}),sr={name:rr},ar=this.parseNodeAttr(nr),or=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(rr,sr):rr in or?(rr==="PoseNode"?or.PoseNode.push(sr):or[rr].id!==void 0&&(or[rr]={},or[rr][or[rr].id]=or[rr]),ar.id!==""&&(or[rr][ar.id]=sr)):typeof ar.id=="number"?(or[rr]={},or[rr][ar.id]=sr):rr!=="Properties70"&&(rr==="PoseNode"?or[rr]=[sr]:or[rr]=sr),typeof ar.id=="number"&&(sr.id=ar.id),ar.name!==""&&(sr.attrName=ar.name),ar.type!==""&&(sr.attrType=ar.type),this.pushStack(sr)}parseNodeAttr(er){let tr=er[0];er[0]!==""&&(tr=parseInt(er[0]),isNaN(tr)&&(tr=er[0]));let rr="",nr="";return er.length>1&&(rr=er[1].replace(/^(\w+)::/,""),nr=er[2]),{id:tr,name:rr,type:nr}}parseNodeProperty(er,tr,rr){let nr=tr[1].replace(/^"/,"").replace(/"$/,"").trim(),sr=tr[2].replace(/^"/,"").replace(/"$/,"").trim();nr==="Content"&&sr===","&&(sr=rr.replace(/"/g,"").replace(/,$/,"").trim());const ar=this.getCurrentNode();if(ar.name==="Properties70"){this.parseNodeSpecialProperty(er,nr,sr);return}if(nr==="C"){const lr=sr.split(",").slice(1),cr=parseInt(lr[0]),hr=parseInt(lr[1]);let fr=sr.split(",").slice(3);fr=fr.map(function(ur){return ur.trim().replace(/^"/,"")}),nr="connections",sr=[cr,hr],append(sr,fr),ar[nr]===void 0&&(ar[nr]=[])}nr==="Node"&&(ar.id=sr),nr in ar&&Array.isArray(ar[nr])?ar[nr].push(sr):nr!=="a"?ar[nr]=sr:ar.a=sr,this.setCurrentProp(ar,nr),nr==="a"&&sr.slice(-1)!==","&&(ar.a=parseNumberArray(sr))}parseNodePropertyContinued(er){const tr=this.getCurrentNode();tr.a+=er,er.slice(-1)!==","&&(tr.a=parseNumberArray(tr.a))}parseNodeSpecialProperty(er,tr,rr){const nr=rr.split('",').map(function(hr){return hr.trim().replace(/^\"/,"").replace(/\s/,"_")}),sr=nr[0],ar=nr[1],or=nr[2],lr=nr[3];let cr=nr[4];switch(ar){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":cr=parseFloat(cr);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":cr=parseNumberArray(cr);break}this.getPrevNode()[sr]={type:ar,type2:or,flag:lr,value:cr},this.setCurrentProp(this.getPrevNode(),sr)}}class BinaryParser{parse(er){const tr=new BinaryReader(er);tr.skip(23);const rr=tr.getUint32();if(rr<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+rr);const nr=new FBXTree;for(;!this.endOfContent(tr);){const sr=this.parseNode(tr,rr);sr!==null&&nr.add(sr.name,sr)}return nr}endOfContent(er){return er.size()%16===0?(er.getOffset()+160+16&-16)>=er.size():er.getOffset()+160+16>=er.size()}parseNode(er,tr){const rr={},nr=tr>=7500?er.getUint64():er.getUint32(),sr=tr>=7500?er.getUint64():er.getUint32();tr>=7500?er.getUint64():er.getUint32();const ar=er.getUint8(),or=er.getString(ar);if(nr===0)return null;const lr=[];for(let ur=0;ur<sr;ur++)lr.push(this.parseProperty(er));const cr=lr.length>0?lr[0]:"",hr=lr.length>1?lr[1]:"",fr=lr.length>2?lr[2]:"";for(rr.singleProperty=sr===1&&er.getOffset()===nr;nr>er.getOffset();){const ur=this.parseNode(er,tr);ur!==null&&this.parseSubNode(or,rr,ur)}return rr.propertyList=lr,typeof cr=="number"&&(rr.id=cr),hr!==""&&(rr.attrName=hr),fr!==""&&(rr.attrType=fr),or!==""&&(rr.name=or),rr}parseSubNode(er,tr,rr){if(rr.singleProperty===!0){const nr=rr.propertyList[0];Array.isArray(nr)?(tr[rr.name]=rr,rr.a=nr):tr[rr.name]=nr}else if(er==="Connections"&&rr.name==="C"){const nr=[];rr.propertyList.forEach(function(sr,ar){ar!==0&&nr.push(sr)}),tr.connections===void 0&&(tr.connections=[]),tr.connections.push(nr)}else if(rr.name==="Properties70")Object.keys(rr).forEach(function(sr){tr[sr]=rr[sr]});else if(er==="Properties70"&&rr.name==="P"){let nr=rr.propertyList[0],sr=rr.propertyList[1];const ar=rr.propertyList[2],or=rr.propertyList[3];let lr;nr.indexOf("Lcl ")===0&&(nr=nr.replace("Lcl ","Lcl_")),sr.indexOf("Lcl ")===0&&(sr=sr.replace("Lcl ","Lcl_")),sr==="Color"||sr==="ColorRGB"||sr==="Vector"||sr==="Vector3D"||sr.indexOf("Lcl_")===0?lr=[rr.propertyList[4],rr.propertyList[5],rr.propertyList[6]]:lr=rr.propertyList[4],tr[nr]={type:sr,type2:ar,flag:or,value:lr}}else tr[rr.name]===void 0?typeof rr.id=="number"?(tr[rr.name]={},tr[rr.name][rr.id]=rr):tr[rr.name]=rr:rr.name==="PoseNode"?(Array.isArray(tr[rr.name])||(tr[rr.name]=[tr[rr.name]]),tr[rr.name].push(rr)):tr[rr.name][rr.id]===void 0&&(tr[rr.name][rr.id]=rr)}parseProperty(er){const tr=er.getString(1);let rr;switch(tr){case"C":return er.getBoolean();case"D":return er.getFloat64();case"F":return er.getFloat32();case"I":return er.getInt32();case"L":return er.getInt64();case"R":return rr=er.getUint32(),er.getArrayBuffer(rr);case"S":return rr=er.getUint32(),er.getString(rr);case"Y":return er.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const nr=er.getUint32(),sr=er.getUint32(),ar=er.getUint32();if(sr===0)switch(tr){case"b":case"c":return er.getBooleanArray(nr);case"d":return er.getFloat64Array(nr);case"f":return er.getFloat32Array(nr);case"i":return er.getInt32Array(nr);case"l":return er.getInt64Array(nr)}const or=unzlibSync(new Uint8Array(er.getArrayBuffer(ar))),lr=new BinaryReader(or.buffer);switch(tr){case"b":case"c":return lr.getBooleanArray(nr);case"d":return lr.getFloat64Array(nr);case"f":return lr.getFloat32Array(nr);case"i":return lr.getInt32Array(nr);case"l":return lr.getInt64Array(nr)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+tr)}}}class BinaryReader{constructor(er,tr){this.dv=new DataView(er),this.offset=0,this.littleEndian=tr!==void 0?tr:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(er){this.offset+=er}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(er){const tr=[];for(let rr=0;rr<er;rr++)tr.push(this.getBoolean());return tr}getUint8(){const er=this.dv.getUint8(this.offset);return this.offset+=1,er}getInt16(){const er=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,er}getInt32(){const er=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,er}getInt32Array(er){const tr=[];for(let rr=0;rr<er;rr++)tr.push(this.getInt32());return tr}getUint32(){const er=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,er}getInt64(){let er,tr;return this.littleEndian?(er=this.getUint32(),tr=this.getUint32()):(tr=this.getUint32(),er=this.getUint32()),tr&2147483648?(tr=~tr&4294967295,er=~er&4294967295,er===4294967295&&(tr=tr+1&4294967295),er=er+1&4294967295,-(tr*4294967296+er)):tr*4294967296+er}getInt64Array(er){const tr=[];for(let rr=0;rr<er;rr++)tr.push(this.getInt64());return tr}getUint64(){let er,tr;return this.littleEndian?(er=this.getUint32(),tr=this.getUint32()):(tr=this.getUint32(),er=this.getUint32()),tr*4294967296+er}getFloat32(){const er=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,er}getFloat32Array(er){const tr=[];for(let rr=0;rr<er;rr++)tr.push(this.getFloat32());return tr}getFloat64(){const er=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,er}getFloat64Array(er){const tr=[];for(let rr=0;rr<er;rr++)tr.push(this.getFloat64());return tr}getArrayBuffer(er){const tr=this.dv.buffer.slice(this.offset,this.offset+er);return this.offset+=er,tr}getString(er){const tr=this.offset;let rr=new Uint8Array(this.dv.buffer,tr,er);this.skip(er);const nr=rr.indexOf(0);return nr>=0&&(rr=new Uint8Array(this.dv.buffer,tr,nr)),this._textDecoder.decode(rr)}}class FBXTree{add(er,tr){this[er]=tr}}function isFbxFormatBinary(ir){const er="Kaydara FBX Binary  \0";return ir.byteLength>=er.length&&er===convertArrayBufferToString(ir,0,er.length)}function isFbxFormatASCII(ir){const er=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let tr=0;function rr(nr){const sr=ir[nr-1];return ir=ir.slice(tr+nr),tr++,sr}for(let nr=0;nr<er.length;++nr)if(rr(1)===er[nr])return!1;return!0}function getFbxVersion(ir){const er=/FBXVersion: (\d+)/,tr=ir.match(er);if(tr)return parseInt(tr[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(ir){return ir/46186158e3}const dataArray=[];function getData(ir,er,tr,rr){let nr;switch(rr.mappingType){case"ByPolygonVertex":nr=ir;break;case"ByPolygon":nr=er;break;case"ByVertice":nr=tr;break;case"AllSame":nr=rr.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+rr.mappingType)}rr.referenceType==="IndexToDirect"&&(nr=rr.indices[nr]);const sr=nr*rr.dataSize,ar=sr+rr.dataSize;return slice(dataArray,rr.buffer,sr,ar)}const tempEuler=new Euler,tempVec=new Vector3$1;function generateTransform(ir){const er=new Matrix4,tr=new Matrix4,rr=new Matrix4,nr=new Matrix4,sr=new Matrix4,ar=new Matrix4,or=new Matrix4,lr=new Matrix4,cr=new Matrix4,hr=new Matrix4,fr=new Matrix4,ur=new Matrix4,pr=ir.inheritType?ir.inheritType:0;ir.translation&&er.setPosition(tempVec.fromArray(ir.translation));const gr=getEulerOrder(0);if(ir.preRotation){const Rr=ir.preRotation.map(MathUtils.degToRad);Rr.push(gr),tr.makeRotationFromEuler(tempEuler.fromArray(Rr))}if(ir.rotation){const Rr=ir.rotation.map(MathUtils.degToRad);Rr.push(ir.eulerOrder||gr),rr.makeRotationFromEuler(tempEuler.fromArray(Rr))}if(ir.postRotation){const Rr=ir.postRotation.map(MathUtils.degToRad);Rr.push(gr),nr.makeRotationFromEuler(tempEuler.fromArray(Rr)),nr.invert()}ir.scale&&sr.scale(tempVec.fromArray(ir.scale)),ir.scalingOffset&&or.setPosition(tempVec.fromArray(ir.scalingOffset)),ir.scalingPivot&&ar.setPosition(tempVec.fromArray(ir.scalingPivot)),ir.rotationOffset&&lr.setPosition(tempVec.fromArray(ir.rotationOffset)),ir.rotationPivot&&cr.setPosition(tempVec.fromArray(ir.rotationPivot)),ir.parentMatrixWorld&&(fr.copy(ir.parentMatrix),hr.copy(ir.parentMatrixWorld));const _r=tr.clone().multiply(rr).multiply(nr),mr=new Matrix4;mr.extractRotation(hr);const dr=new Matrix4;dr.copyPosition(hr);const vr=dr.clone().invert().multiply(hr),Ar=mr.clone().invert().multiply(vr),yr=sr,wr=new Matrix4;if(pr===0)wr.copy(mr).multiply(_r).multiply(Ar).multiply(yr);else if(pr===1)wr.copy(mr).multiply(Ar).multiply(_r).multiply(yr);else{const Pr=new Matrix4().scale(new Vector3$1().setFromMatrixScale(fr)).clone().invert(),Fr=Ar.clone().multiply(Pr);wr.copy(mr).multiply(_r).multiply(Fr).multiply(yr)}const br=cr.clone().invert(),Sr=ar.clone().invert();let xr=er.clone().multiply(lr).multiply(cr).multiply(tr).multiply(rr).multiply(nr).multiply(br).multiply(or).multiply(ar).multiply(sr).multiply(Sr);const Cr=new Matrix4().copyPosition(xr),Ir=hr.clone().multiply(Cr);return ur.copyPosition(Ir),xr=ur.clone().multiply(wr),xr.premultiply(hr.invert()),xr}function getEulerOrder(ir){ir=ir||0;const er=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return ir===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),er[0]):er[ir]}function parseNumberArray(ir){return ir.split(",").map(function(tr){return parseFloat(tr)})}function convertArrayBufferToString(ir,er,tr){return er===void 0&&(er=0),tr===void 0&&(tr=ir.byteLength),new TextDecoder().decode(new Uint8Array(ir,er,tr))}function append(ir,er){for(let tr=0,rr=ir.length,nr=er.length;tr<nr;tr++,rr++)ir[rr]=er[tr]}function slice(ir,er,tr,rr){for(let nr=tr,sr=0;nr<rr;nr++,sr++)ir[sr]=er[nr];return ir}class FontLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){const lr=sr.parse(JSON.parse(or));tr&&tr(lr)},rr,nr)}parse(er){return new Font$1(er)}}let Font$1=class{constructor(er){this.isFont=!0,this.type="Font",this.data=er}generateShapes(er,tr=100){const rr=[],nr=createPaths(er,tr,this.data);for(let sr=0,ar=nr.length;sr<ar;sr++)rr.push(...nr[sr].toShapes());return rr}};function createPaths(ir,er,tr){const rr=Array.from(ir),nr=er/tr.resolution,sr=(tr.boundingBox.yMax-tr.boundingBox.yMin+tr.underlineThickness)*nr,ar=[];let or=0,lr=0;for(let cr=0;cr<rr.length;cr++){const hr=rr[cr];if(hr===`
`)or=0,lr-=sr;else{const fr=createPath(hr,nr,or,lr,tr);or+=fr.offsetX,ar.push(fr.path)}}return ar}function createPath(ir,er,tr,rr,nr){const sr=nr.glyphs[ir]||nr.glyphs["?"];if(!sr){console.error('THREE.Font: character "'+ir+'" does not exists in font family '+nr.familyName+".");return}const ar=new ShapePath;let or,lr,cr,hr,fr,ur,pr,gr;if(sr.o){const _r=sr._cachedOutline||(sr._cachedOutline=sr.o.split(" "));for(let mr=0,dr=_r.length;mr<dr;)switch(_r[mr++]){case"m":or=_r[mr++]*er+tr,lr=_r[mr++]*er+rr,ar.moveTo(or,lr);break;case"l":or=_r[mr++]*er+tr,lr=_r[mr++]*er+rr,ar.lineTo(or,lr);break;case"q":cr=_r[mr++]*er+tr,hr=_r[mr++]*er+rr,fr=_r[mr++]*er+tr,ur=_r[mr++]*er+rr,ar.quadraticCurveTo(fr,ur,cr,hr);break;case"b":cr=_r[mr++]*er+tr,hr=_r[mr++]*er+rr,fr=_r[mr++]*er+tr,ur=_r[mr++]*er+rr,pr=_r[mr++]*er+tr,gr=_r[mr++]*er+rr,ar.bezierCurveTo(fr,ur,pr,gr,cr,hr);break}}return{offsetX:sr.ha*er,path:ar}}class GCodeLoader extends Loader{constructor(er){super(er),this.splitLayer=!1}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){let tr={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1};const rr=[];let nr;const sr=new LineBasicMaterial({color:16711680});sr.name="path";const ar=new LineBasicMaterial({color:65280});ar.name="extruded";function or(gr){nr={vertex:[],pathVertex:[],z:gr.z},rr.push(nr)}function lr(gr,_r){nr===void 0&&or(gr),tr.extruding?(nr.vertex.push(gr.x,gr.y,gr.z),nr.vertex.push(_r.x,_r.y,_r.z)):(nr.pathVertex.push(gr.x,gr.y,gr.z),nr.pathVertex.push(_r.x,_r.y,_r.z))}function cr(gr,_r){return tr.relative?_r:_r-gr}function hr(gr,_r){return tr.relative?gr+_r:_r}const fr=er.replace(/;.+/g,"").split(`
`);for(let gr=0;gr<fr.length;gr++){const _r=fr[gr].split(" "),mr=_r[0].toUpperCase(),dr={};if(_r.splice(1).forEach(function(vr){if(vr[0]!==void 0){const Ar=vr[0].toLowerCase(),yr=parseFloat(vr.substring(1));dr[Ar]=yr}}),mr==="G0"||mr==="G1"){const vr={x:dr.x!==void 0?hr(tr.x,dr.x):tr.x,y:dr.y!==void 0?hr(tr.y,dr.y):tr.y,z:dr.z!==void 0?hr(tr.z,dr.z):tr.z,e:dr.e!==void 0?hr(tr.e,dr.e):tr.e,f:dr.f!==void 0?hr(tr.f,dr.f):tr.f};cr(tr.e,vr.e)>0&&(tr.extruding=cr(tr.e,vr.e)>0,(nr==null||vr.z!=nr.z)&&or(vr)),lr(tr,vr),tr=vr}else if(!(mr==="G2"||mr==="G3")){if(mr==="G90")tr.relative=!1;else if(mr==="G91")tr.relative=!0;else if(mr==="G92"){const vr=tr;vr.x=dr.x!==void 0?dr.x:vr.x,vr.y=dr.y!==void 0?dr.y:vr.y,vr.z=dr.z!==void 0?dr.z:vr.z,vr.e=dr.e!==void 0?dr.e:vr.e}}}function ur(gr,_r,mr){const dr=new BufferGeometry;dr.setAttribute("position",new Float32BufferAttribute(gr,3));const vr=new LineSegments(dr,_r?ar:sr);vr.name="layer"+mr,pr.add(vr)}const pr=new Group;if(pr.name="gcode",this.splitLayer)for(let gr=0;gr<rr.length;gr++){const _r=rr[gr];ur(_r.vertex,!0,gr),ur(_r.pathVertex,!1,gr)}else{const gr=[],_r=[];for(let mr=0;mr<rr.length;mr++){const dr=rr[mr],vr=dr.vertex,Ar=dr.pathVertex;for(let yr=0;yr<vr.length;yr++)gr.push(vr[yr]);for(let yr=0;yr<Ar.length;yr++)_r.push(Ar[yr])}ur(gr,!0,rr.length),ur(_r,!1,rr.length)}return pr.rotation.set(-Math.PI/2,0,0),pr}}class GLTFLoader extends Loader{constructor(er){super(er),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(tr){return new GLTFMaterialsClearcoatExtension(tr)}),this.register(function(tr){return new GLTFMaterialsDispersionExtension(tr)}),this.register(function(tr){return new GLTFTextureBasisUExtension(tr)}),this.register(function(tr){return new GLTFTextureWebPExtension(tr)}),this.register(function(tr){return new GLTFTextureAVIFExtension(tr)}),this.register(function(tr){return new GLTFMaterialsSheenExtension(tr)}),this.register(function(tr){return new GLTFMaterialsTransmissionExtension(tr)}),this.register(function(tr){return new GLTFMaterialsVolumeExtension(tr)}),this.register(function(tr){return new GLTFMaterialsIorExtension(tr)}),this.register(function(tr){return new GLTFMaterialsEmissiveStrengthExtension(tr)}),this.register(function(tr){return new GLTFMaterialsSpecularExtension(tr)}),this.register(function(tr){return new GLTFMaterialsIridescenceExtension(tr)}),this.register(function(tr){return new GLTFMaterialsAnisotropyExtension(tr)}),this.register(function(tr){return new GLTFMaterialsBumpExtension(tr)}),this.register(function(tr){return new GLTFLightsExtension(tr)}),this.register(function(tr){return new GLTFMeshoptCompression(tr)}),this.register(function(tr){return new GLTFMeshGpuInstancing(tr)})}load(er,tr,rr,nr){const sr=this;let ar;if(this.resourcePath!=="")ar=this.resourcePath;else if(this.path!==""){const cr=LoaderUtils.extractUrlBase(er);ar=LoaderUtils.resolveURL(cr,this.path)}else ar=LoaderUtils.extractUrlBase(er);this.manager.itemStart(er);const or=function(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er),sr.manager.itemEnd(er)},lr=new FileLoader(this.manager);lr.setPath(this.path),lr.setResponseType("arraybuffer"),lr.setRequestHeader(this.requestHeader),lr.setWithCredentials(this.withCredentials),lr.load(er,function(cr){try{sr.parse(cr,ar,function(hr){tr(hr),sr.manager.itemEnd(er)},or)}catch(hr){or(hr)}},rr,or)}setDRACOLoader(er){return this.dracoLoader=er,this}setKTX2Loader(er){return this.ktx2Loader=er,this}setMeshoptDecoder(er){return this.meshoptDecoder=er,this}register(er){return this.pluginCallbacks.indexOf(er)===-1&&this.pluginCallbacks.push(er),this}unregister(er){return this.pluginCallbacks.indexOf(er)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(er),1),this}parse(er,tr,rr,nr){let sr;const ar={},or={},lr=new TextDecoder;if(typeof er=="string")sr=JSON.parse(er);else if(er instanceof ArrayBuffer)if(lr.decode(new Uint8Array(er,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{ar[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(er)}catch(fr){nr&&nr(fr);return}sr=JSON.parse(ar[EXTENSIONS.KHR_BINARY_GLTF].content)}else sr=JSON.parse(lr.decode(er));else sr=er;if(sr.asset===void 0||sr.asset.version[0]<2){nr&&nr(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const cr=new GLTFParser(sr,{path:tr||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});cr.fileLoader.setRequestHeader(this.requestHeader);for(let hr=0;hr<this.pluginCallbacks.length;hr++){const fr=this.pluginCallbacks[hr](cr);fr.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),or[fr.name]=fr,ar[fr.name]=!0}if(sr.extensionsUsed)for(let hr=0;hr<sr.extensionsUsed.length;++hr){const fr=sr.extensionsUsed[hr],ur=sr.extensionsRequired||[];switch(fr){case EXTENSIONS.KHR_MATERIALS_UNLIT:ar[fr]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:ar[fr]=new GLTFDracoMeshCompressionExtension(sr,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:ar[fr]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:ar[fr]=new GLTFMeshQuantizationExtension;break;default:ur.indexOf(fr)>=0&&or[fr]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+fr+'".')}}cr.setExtensions(ar),cr.setPlugins(or),cr.parse(rr,nr)}parseAsync(er,tr){const rr=this;return new Promise(function(nr,sr){rr.parse(er,tr,nr,sr)})}}function GLTFRegistry(){let ir={};return{get:function(er){return ir[er]},add:function(er,tr){ir[er]=tr},remove:function(er){delete ir[er]},removeAll:function(){ir={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const er=this.parser,tr=this.parser.json.nodes||[];for(let rr=0,nr=tr.length;rr<nr;rr++){const sr=tr[rr];sr.extensions&&sr.extensions[this.name]&&sr.extensions[this.name].light!==void 0&&er._addNodeRef(this.cache,sr.extensions[this.name].light)}}_loadLight(er){const tr=this.parser,rr="light:"+er;let nr=tr.cache.get(rr);if(nr)return nr;const sr=tr.json,lr=((sr.extensions&&sr.extensions[this.name]||{}).lights||[])[er];let cr;const hr=new Color(16777215);lr.color!==void 0&&hr.setRGB(lr.color[0],lr.color[1],lr.color[2],LinearSRGBColorSpace);const fr=lr.range!==void 0?lr.range:0;switch(lr.type){case"directional":cr=new DirectionalLight(hr),cr.target.position.set(0,0,-1),cr.add(cr.target);break;case"point":cr=new PointLight(hr),cr.distance=fr;break;case"spot":cr=new SpotLight(hr),cr.distance=fr,lr.spot=lr.spot||{},lr.spot.innerConeAngle=lr.spot.innerConeAngle!==void 0?lr.spot.innerConeAngle:0,lr.spot.outerConeAngle=lr.spot.outerConeAngle!==void 0?lr.spot.outerConeAngle:Math.PI/4,cr.angle=lr.spot.outerConeAngle,cr.penumbra=1-lr.spot.innerConeAngle/lr.spot.outerConeAngle,cr.target.position.set(0,0,-1),cr.add(cr.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+lr.type)}return cr.position.set(0,0,0),assignExtrasToUserData(cr,lr),lr.intensity!==void 0&&(cr.intensity=lr.intensity),cr.name=tr.createUniqueName(lr.name||"light_"+er),nr=Promise.resolve(cr),tr.cache.add(rr,nr),nr}getDependency(er,tr){if(er==="light")return this._loadLight(tr)}createNodeAttachment(er){const tr=this,rr=this.parser,sr=rr.json.nodes[er],or=(sr.extensions&&sr.extensions[this.name]||{}).light;return or===void 0?null:this._loadLight(or).then(function(lr){return rr._getNodeRef(tr.cache,or,lr)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(er,tr,rr){const nr=[];er.color=new Color(1,1,1),er.opacity=1;const sr=tr.pbrMetallicRoughness;if(sr){if(Array.isArray(sr.baseColorFactor)){const ar=sr.baseColorFactor;er.color.setRGB(ar[0],ar[1],ar[2],LinearSRGBColorSpace),er.opacity=ar[3]}sr.baseColorTexture!==void 0&&nr.push(rr.assignTexture(er,"map",sr.baseColorTexture,SRGBColorSpace))}return Promise.all(nr)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(er,tr){const nr=this.parser.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=nr.extensions[this.name].emissiveStrength;return sr!==void 0&&(tr.emissiveIntensity=sr),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const rr=this.parser,nr=rr.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];if(ar.clearcoatFactor!==void 0&&(tr.clearcoat=ar.clearcoatFactor),ar.clearcoatTexture!==void 0&&sr.push(rr.assignTexture(tr,"clearcoatMap",ar.clearcoatTexture)),ar.clearcoatRoughnessFactor!==void 0&&(tr.clearcoatRoughness=ar.clearcoatRoughnessFactor),ar.clearcoatRoughnessTexture!==void 0&&sr.push(rr.assignTexture(tr,"clearcoatRoughnessMap",ar.clearcoatRoughnessTexture)),ar.clearcoatNormalTexture!==void 0&&(sr.push(rr.assignTexture(tr,"clearcoatNormalMap",ar.clearcoatNormalTexture)),ar.clearcoatNormalTexture.scale!==void 0)){const or=ar.clearcoatNormalTexture.scale;tr.clearcoatNormalScale=new Vector2(or,or)}return Promise.all(sr)}}class GLTFMaterialsDispersionExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_DISPERSION}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const nr=this.parser.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=nr.extensions[this.name];return tr.dispersion=sr.dispersion!==void 0?sr.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const rr=this.parser,nr=rr.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];return ar.iridescenceFactor!==void 0&&(tr.iridescence=ar.iridescenceFactor),ar.iridescenceTexture!==void 0&&sr.push(rr.assignTexture(tr,"iridescenceMap",ar.iridescenceTexture)),ar.iridescenceIor!==void 0&&(tr.iridescenceIOR=ar.iridescenceIor),tr.iridescenceThicknessRange===void 0&&(tr.iridescenceThicknessRange=[100,400]),ar.iridescenceThicknessMinimum!==void 0&&(tr.iridescenceThicknessRange[0]=ar.iridescenceThicknessMinimum),ar.iridescenceThicknessMaximum!==void 0&&(tr.iridescenceThicknessRange[1]=ar.iridescenceThicknessMaximum),ar.iridescenceThicknessTexture!==void 0&&sr.push(rr.assignTexture(tr,"iridescenceThicknessMap",ar.iridescenceThicknessTexture)),Promise.all(sr)}}class GLTFMaterialsSheenExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const rr=this.parser,nr=rr.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[];tr.sheenColor=new Color(0,0,0),tr.sheenRoughness=0,tr.sheen=1;const ar=nr.extensions[this.name];if(ar.sheenColorFactor!==void 0){const or=ar.sheenColorFactor;tr.sheenColor.setRGB(or[0],or[1],or[2],LinearSRGBColorSpace)}return ar.sheenRoughnessFactor!==void 0&&(tr.sheenRoughness=ar.sheenRoughnessFactor),ar.sheenColorTexture!==void 0&&sr.push(rr.assignTexture(tr,"sheenColorMap",ar.sheenColorTexture,SRGBColorSpace)),ar.sheenRoughnessTexture!==void 0&&sr.push(rr.assignTexture(tr,"sheenRoughnessMap",ar.sheenRoughnessTexture)),Promise.all(sr)}}class GLTFMaterialsTransmissionExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const rr=this.parser,nr=rr.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];return ar.transmissionFactor!==void 0&&(tr.transmission=ar.transmissionFactor),ar.transmissionTexture!==void 0&&sr.push(rr.assignTexture(tr,"transmissionMap",ar.transmissionTexture)),Promise.all(sr)}}class GLTFMaterialsVolumeExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const rr=this.parser,nr=rr.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];tr.thickness=ar.thicknessFactor!==void 0?ar.thicknessFactor:0,ar.thicknessTexture!==void 0&&sr.push(rr.assignTexture(tr,"thicknessMap",ar.thicknessTexture)),tr.attenuationDistance=ar.attenuationDistance||1/0;const or=ar.attenuationColor||[1,1,1];return tr.attenuationColor=new Color().setRGB(or[0],or[1],or[2],LinearSRGBColorSpace),Promise.all(sr)}}class GLTFMaterialsIorExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const nr=this.parser.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=nr.extensions[this.name];return tr.ior=sr.ior!==void 0?sr.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const rr=this.parser,nr=rr.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];tr.specularIntensity=ar.specularFactor!==void 0?ar.specularFactor:1,ar.specularTexture!==void 0&&sr.push(rr.assignTexture(tr,"specularIntensityMap",ar.specularTexture));const or=ar.specularColorFactor||[1,1,1];return tr.specularColor=new Color().setRGB(or[0],or[1],or[2],LinearSRGBColorSpace),ar.specularColorTexture!==void 0&&sr.push(rr.assignTexture(tr,"specularColorMap",ar.specularColorTexture,SRGBColorSpace)),Promise.all(sr)}}class GLTFMaterialsBumpExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.EXT_MATERIALS_BUMP}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const rr=this.parser,nr=rr.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];return tr.bumpScale=ar.bumpFactor!==void 0?ar.bumpFactor:1,ar.bumpTexture!==void 0&&sr.push(rr.assignTexture(tr,"bumpMap",ar.bumpTexture)),Promise.all(sr)}}class GLTFMaterialsAnisotropyExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(er){const rr=this.parser.json.materials[er];return!rr.extensions||!rr.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const rr=this.parser,nr=rr.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];return ar.anisotropyStrength!==void 0&&(tr.anisotropy=ar.anisotropyStrength),ar.anisotropyRotation!==void 0&&(tr.anisotropyRotation=ar.anisotropyRotation),ar.anisotropyTexture!==void 0&&sr.push(rr.assignTexture(tr,"anisotropyMap",ar.anisotropyTexture)),Promise.all(sr)}}class GLTFTextureBasisUExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(er){const tr=this.parser,rr=tr.json,nr=rr.textures[er];if(!nr.extensions||!nr.extensions[this.name])return null;const sr=nr.extensions[this.name],ar=tr.options.ktx2Loader;if(!ar){if(rr.extensionsRequired&&rr.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return tr.loadTextureImage(er,sr.source,ar)}}class GLTFTextureWebPExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(er){const tr=this.name,rr=this.parser,nr=rr.json,sr=nr.textures[er];if(!sr.extensions||!sr.extensions[tr])return null;const ar=sr.extensions[tr],or=nr.images[ar.source];let lr=rr.textureLoader;if(or.uri){const cr=rr.options.manager.getHandler(or.uri);cr!==null&&(lr=cr)}return this.detectSupport().then(function(cr){if(cr)return rr.loadTextureImage(er,ar.source,lr);if(nr.extensionsRequired&&nr.extensionsRequired.indexOf(tr)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return rr.loadTexture(er)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(er){const tr=new Image;tr.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",tr.onload=tr.onerror=function(){er(tr.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(er){const tr=this.name,rr=this.parser,nr=rr.json,sr=nr.textures[er];if(!sr.extensions||!sr.extensions[tr])return null;const ar=sr.extensions[tr],or=nr.images[ar.source];let lr=rr.textureLoader;if(or.uri){const cr=rr.options.manager.getHandler(or.uri);cr!==null&&(lr=cr)}return this.detectSupport().then(function(cr){if(cr)return rr.loadTextureImage(er,ar.source,lr);if(nr.extensionsRequired&&nr.extensionsRequired.indexOf(tr)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return rr.loadTexture(er)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(er){const tr=new Image;tr.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",tr.onload=tr.onerror=function(){er(tr.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(er){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=er}loadBufferView(er){const tr=this.parser.json,rr=tr.bufferViews[er];if(rr.extensions&&rr.extensions[this.name]){const nr=rr.extensions[this.name],sr=this.parser.getDependency("buffer",nr.buffer),ar=this.parser.options.meshoptDecoder;if(!ar||!ar.supported){if(tr.extensionsRequired&&tr.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return sr.then(function(or){const lr=nr.byteOffset||0,cr=nr.byteLength||0,hr=nr.count,fr=nr.byteStride,ur=new Uint8Array(or,lr,cr);return ar.decodeGltfBufferAsync?ar.decodeGltfBufferAsync(hr,fr,ur,nr.mode,nr.filter).then(function(pr){return pr.buffer}):ar.ready.then(function(){const pr=new ArrayBuffer(hr*fr);return ar.decodeGltfBuffer(new Uint8Array(pr),hr,fr,ur,nr.mode,nr.filter),pr})})}else return null}}class GLTFMeshGpuInstancing{constructor(er){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=er}createNodeMesh(er){const tr=this.parser.json,rr=tr.nodes[er];if(!rr.extensions||!rr.extensions[this.name]||rr.mesh===void 0)return null;const nr=tr.meshes[rr.mesh];for(const cr of nr.primitives)if(cr.mode!==WEBGL_CONSTANTS.TRIANGLES&&cr.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&cr.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&cr.mode!==void 0)return null;const ar=rr.extensions[this.name].attributes,or=[],lr={};for(const cr in ar)or.push(this.parser.getDependency("accessor",ar[cr]).then(hr=>(lr[cr]=hr,lr[cr])));return or.length<1?null:(or.push(this.parser.createNodeMesh(er)),Promise.all(or).then(cr=>{const hr=cr.pop(),fr=hr.isGroup?hr.children:[hr],ur=cr[0].count,pr=[];for(const gr of fr){const _r=new Matrix4,mr=new Vector3$1,dr=new Quaternion$1,vr=new Vector3$1(1,1,1),Ar=new InstancedMesh(gr.geometry,gr.material,ur);for(let yr=0;yr<ur;yr++)lr.TRANSLATION&&mr.fromBufferAttribute(lr.TRANSLATION,yr),lr.ROTATION&&dr.fromBufferAttribute(lr.ROTATION,yr),lr.SCALE&&vr.fromBufferAttribute(lr.SCALE,yr),Ar.setMatrixAt(yr,_r.compose(mr,dr,vr));for(const yr in lr)if(yr==="_COLOR_0"){const wr=lr[yr];Ar.instanceColor=new InstancedBufferAttribute(wr.array,wr.itemSize,wr.normalized)}else yr!=="TRANSLATION"&&yr!=="ROTATION"&&yr!=="SCALE"&&gr.geometry.setAttribute(yr,lr[yr]);Object3D.prototype.copy.call(Ar,gr),this.parser.assignFinalMaterial(Ar),pr.push(Ar)}return hr.isGroup?(hr.clear(),hr.add(...pr),hr):pr[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(er){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const tr=new DataView(er,0,BINARY_EXTENSION_HEADER_LENGTH),rr=new TextDecoder;if(this.header={magic:rr.decode(new Uint8Array(er.slice(0,4))),version:tr.getUint32(4,!0),length:tr.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const nr=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,sr=new DataView(er,BINARY_EXTENSION_HEADER_LENGTH);let ar=0;for(;ar<nr;){const or=sr.getUint32(ar,!0);ar+=4;const lr=sr.getUint32(ar,!0);if(ar+=4,lr===BINARY_EXTENSION_CHUNK_TYPES.JSON){const cr=new Uint8Array(er,BINARY_EXTENSION_HEADER_LENGTH+ar,or);this.content=rr.decode(cr)}else if(lr===BINARY_EXTENSION_CHUNK_TYPES.BIN){const cr=BINARY_EXTENSION_HEADER_LENGTH+ar;this.body=er.slice(cr,cr+or)}ar+=or}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(er,tr){if(!tr)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=er,this.dracoLoader=tr,this.dracoLoader.preload()}decodePrimitive(er,tr){const rr=this.json,nr=this.dracoLoader,sr=er.extensions[this.name].bufferView,ar=er.extensions[this.name].attributes,or={},lr={},cr={};for(const hr in ar){const fr=ATTRIBUTES[hr]||hr.toLowerCase();or[fr]=ar[hr]}for(const hr in er.attributes){const fr=ATTRIBUTES[hr]||hr.toLowerCase();if(ar[hr]!==void 0){const ur=rr.accessors[er.attributes[hr]],pr=WEBGL_COMPONENT_TYPES[ur.componentType];cr[fr]=pr.name,lr[fr]=ur.normalized===!0}}return tr.getDependency("bufferView",sr).then(function(hr){return new Promise(function(fr,ur){nr.decodeDracoFile(hr,function(pr){for(const gr in pr.attributes){const _r=pr.attributes[gr],mr=lr[gr];mr!==void 0&&(_r.normalized=mr)}fr(pr)},or,cr,LinearSRGBColorSpace,ur)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(er,tr){return(tr.texCoord===void 0||tr.texCoord===er.channel)&&tr.offset===void 0&&tr.rotation===void 0&&tr.scale===void 0||(er=er.clone(),tr.texCoord!==void 0&&(er.channel=tr.texCoord),tr.offset!==void 0&&er.offset.fromArray(tr.offset),tr.rotation!==void 0&&(er.rotation=tr.rotation),tr.scale!==void 0&&er.repeat.fromArray(tr.scale),er.needsUpdate=!0),er}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(er,tr,rr,nr){super(er,tr,rr,nr)}copySampleValue_(er){const tr=this.resultBuffer,rr=this.sampleValues,nr=this.valueSize,sr=er*nr*3+nr;for(let ar=0;ar!==nr;ar++)tr[ar]=rr[sr+ar];return tr}interpolate_(er,tr,rr,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=or*2,cr=or*3,hr=nr-tr,fr=(rr-tr)/hr,ur=fr*fr,pr=ur*fr,gr=er*cr,_r=gr-cr,mr=-2*pr+3*ur,dr=pr-ur,vr=1-mr,Ar=dr-ur+fr;for(let yr=0;yr!==or;yr++){const wr=ar[_r+yr+or],br=ar[_r+yr+lr]*hr,Sr=ar[gr+yr+or],xr=ar[gr+yr]*hr;sr[yr]=vr*wr+Ar*br+mr*Sr+dr*xr}return sr}}const _q=new Quaternion$1;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(er,tr,rr,nr){const sr=super.interpolate_(er,tr,rr,nr);return _q.fromArray(sr).normalize().toArray(sr),sr}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(ir){return ir.DefaultMaterial===void 0&&(ir.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),ir.DefaultMaterial}function addUnknownExtensionsToUserData(ir,er,tr){for(const rr in tr.extensions)ir[rr]===void 0&&(er.userData.gltfExtensions=er.userData.gltfExtensions||{},er.userData.gltfExtensions[rr]=tr.extensions[rr])}function assignExtrasToUserData(ir,er){er.extras!==void 0&&(typeof er.extras=="object"?Object.assign(ir.userData,er.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+er.extras))}function addMorphTargets(ir,er,tr){let rr=!1,nr=!1,sr=!1;for(let cr=0,hr=er.length;cr<hr;cr++){const fr=er[cr];if(fr.POSITION!==void 0&&(rr=!0),fr.NORMAL!==void 0&&(nr=!0),fr.COLOR_0!==void 0&&(sr=!0),rr&&nr&&sr)break}if(!rr&&!nr&&!sr)return Promise.resolve(ir);const ar=[],or=[],lr=[];for(let cr=0,hr=er.length;cr<hr;cr++){const fr=er[cr];if(rr){const ur=fr.POSITION!==void 0?tr.getDependency("accessor",fr.POSITION):ir.attributes.position;ar.push(ur)}if(nr){const ur=fr.NORMAL!==void 0?tr.getDependency("accessor",fr.NORMAL):ir.attributes.normal;or.push(ur)}if(sr){const ur=fr.COLOR_0!==void 0?tr.getDependency("accessor",fr.COLOR_0):ir.attributes.color;lr.push(ur)}}return Promise.all([Promise.all(ar),Promise.all(or),Promise.all(lr)]).then(function(cr){const hr=cr[0],fr=cr[1],ur=cr[2];return rr&&(ir.morphAttributes.position=hr),nr&&(ir.morphAttributes.normal=fr),sr&&(ir.morphAttributes.color=ur),ir.morphTargetsRelative=!0,ir})}function updateMorphTargets(ir,er){if(ir.updateMorphTargets(),er.weights!==void 0)for(let tr=0,rr=er.weights.length;tr<rr;tr++)ir.morphTargetInfluences[tr]=er.weights[tr];if(er.extras&&Array.isArray(er.extras.targetNames)){const tr=er.extras.targetNames;if(ir.morphTargetInfluences.length===tr.length){ir.morphTargetDictionary={};for(let rr=0,nr=tr.length;rr<nr;rr++)ir.morphTargetDictionary[tr[rr]]=rr}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(ir){let er;const tr=ir.extensions&&ir.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(tr?er="draco:"+tr.bufferView+":"+tr.indices+":"+createAttributesKey(tr.attributes):er=ir.indices+":"+createAttributesKey(ir.attributes)+":"+ir.mode,ir.targets!==void 0)for(let rr=0,nr=ir.targets.length;rr<nr;rr++)er+=":"+createAttributesKey(ir.targets[rr]);return er}function createAttributesKey(ir){let er="";const tr=Object.keys(ir).sort();for(let rr=0,nr=tr.length;rr<nr;rr++)er+=tr[rr]+":"+ir[tr[rr]]+";";return er}function getNormalizedComponentScale(ir){switch(ir){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(ir){return ir.search(/\.jpe?g($|\?)/i)>0||ir.search(/^data\:image\/jpeg/)===0?"image/jpeg":ir.search(/\.webp($|\?)/i)>0||ir.search(/^data\:image\/webp/)===0?"image/webp":ir.search(/\.ktx2($|\?)/i)>0||ir.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const _identityMatrix=new Matrix4;class GLTFParser{constructor(er={},tr={}){this.json=er,this.extensions={},this.plugins={},this.options=tr,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let rr=!1,nr=-1,sr=!1,ar=-1;if(typeof navigator<"u"){const or=navigator.userAgent;rr=/^((?!chrome|android).)*safari/i.test(or)===!0;const lr=or.match(/Version\/(\d+)/);nr=rr&&lr?parseInt(lr[1],10):-1,sr=or.indexOf("Firefox")>-1,ar=sr?or.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||rr&&nr<17||sr&&ar<98?this.textureLoader=new TextureLoader(this.options.manager):this.textureLoader=new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(er){this.extensions=er}setPlugins(er){this.plugins=er}parse(er,tr){const rr=this,nr=this.json,sr=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(ar){return ar._markDefs&&ar._markDefs()}),Promise.all(this._invokeAll(function(ar){return ar.beforeRoot&&ar.beforeRoot()})).then(function(){return Promise.all([rr.getDependencies("scene"),rr.getDependencies("animation"),rr.getDependencies("camera")])}).then(function(ar){const or={scene:ar[0][nr.scene||0],scenes:ar[0],animations:ar[1],cameras:ar[2],asset:nr.asset,parser:rr,userData:{}};return addUnknownExtensionsToUserData(sr,or,nr),assignExtrasToUserData(or,nr),Promise.all(rr._invokeAll(function(lr){return lr.afterRoot&&lr.afterRoot(or)})).then(function(){for(const lr of or.scenes)lr.updateMatrixWorld();er(or)})}).catch(tr)}_markDefs(){const er=this.json.nodes||[],tr=this.json.skins||[],rr=this.json.meshes||[];for(let nr=0,sr=tr.length;nr<sr;nr++){const ar=tr[nr].joints;for(let or=0,lr=ar.length;or<lr;or++)er[ar[or]].isBone=!0}for(let nr=0,sr=er.length;nr<sr;nr++){const ar=er[nr];ar.mesh!==void 0&&(this._addNodeRef(this.meshCache,ar.mesh),ar.skin!==void 0&&(rr[ar.mesh].isSkinnedMesh=!0)),ar.camera!==void 0&&this._addNodeRef(this.cameraCache,ar.camera)}}_addNodeRef(er,tr){tr!==void 0&&(er.refs[tr]===void 0&&(er.refs[tr]=er.uses[tr]=0),er.refs[tr]++)}_getNodeRef(er,tr,rr){if(er.refs[tr]<=1)return rr;const nr=rr.clone(),sr=(ar,or)=>{const lr=this.associations.get(ar);lr!=null&&this.associations.set(or,lr);for(const[cr,hr]of ar.children.entries())sr(hr,or.children[cr])};return sr(rr,nr),nr.name+="_instance_"+er.uses[tr]++,nr}_invokeOne(er){const tr=Object.values(this.plugins);tr.push(this);for(let rr=0;rr<tr.length;rr++){const nr=er(tr[rr]);if(nr)return nr}return null}_invokeAll(er){const tr=Object.values(this.plugins);tr.unshift(this);const rr=[];for(let nr=0;nr<tr.length;nr++){const sr=er(tr[nr]);sr&&rr.push(sr)}return rr}getDependency(er,tr){const rr=er+":"+tr;let nr=this.cache.get(rr);if(!nr){switch(er){case"scene":nr=this.loadScene(tr);break;case"node":nr=this._invokeOne(function(sr){return sr.loadNode&&sr.loadNode(tr)});break;case"mesh":nr=this._invokeOne(function(sr){return sr.loadMesh&&sr.loadMesh(tr)});break;case"accessor":nr=this.loadAccessor(tr);break;case"bufferView":nr=this._invokeOne(function(sr){return sr.loadBufferView&&sr.loadBufferView(tr)});break;case"buffer":nr=this.loadBuffer(tr);break;case"material":nr=this._invokeOne(function(sr){return sr.loadMaterial&&sr.loadMaterial(tr)});break;case"texture":nr=this._invokeOne(function(sr){return sr.loadTexture&&sr.loadTexture(tr)});break;case"skin":nr=this.loadSkin(tr);break;case"animation":nr=this._invokeOne(function(sr){return sr.loadAnimation&&sr.loadAnimation(tr)});break;case"camera":nr=this.loadCamera(tr);break;default:if(nr=this._invokeOne(function(sr){return sr!=this&&sr.getDependency&&sr.getDependency(er,tr)}),!nr)throw new Error("Unknown type: "+er);break}this.cache.add(rr,nr)}return nr}getDependencies(er){let tr=this.cache.get(er);if(!tr){const rr=this,nr=this.json[er+(er==="mesh"?"es":"s")]||[];tr=Promise.all(nr.map(function(sr,ar){return rr.getDependency(er,ar)})),this.cache.add(er,tr)}return tr}loadBuffer(er){const tr=this.json.buffers[er],rr=this.fileLoader;if(tr.type&&tr.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+tr.type+" buffer type is not supported.");if(tr.uri===void 0&&er===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const nr=this.options;return new Promise(function(sr,ar){rr.load(LoaderUtils.resolveURL(tr.uri,nr.path),sr,void 0,function(){ar(new Error('THREE.GLTFLoader: Failed to load buffer "'+tr.uri+'".'))})})}loadBufferView(er){const tr=this.json.bufferViews[er];return this.getDependency("buffer",tr.buffer).then(function(rr){const nr=tr.byteLength||0,sr=tr.byteOffset||0;return rr.slice(sr,sr+nr)})}loadAccessor(er){const tr=this,rr=this.json,nr=this.json.accessors[er];if(nr.bufferView===void 0&&nr.sparse===void 0){const ar=WEBGL_TYPE_SIZES[nr.type],or=WEBGL_COMPONENT_TYPES[nr.componentType],lr=nr.normalized===!0,cr=new or(nr.count*ar);return Promise.resolve(new BufferAttribute(cr,ar,lr))}const sr=[];return nr.bufferView!==void 0?sr.push(this.getDependency("bufferView",nr.bufferView)):sr.push(null),nr.sparse!==void 0&&(sr.push(this.getDependency("bufferView",nr.sparse.indices.bufferView)),sr.push(this.getDependency("bufferView",nr.sparse.values.bufferView))),Promise.all(sr).then(function(ar){const or=ar[0],lr=WEBGL_TYPE_SIZES[nr.type],cr=WEBGL_COMPONENT_TYPES[nr.componentType],hr=cr.BYTES_PER_ELEMENT,fr=hr*lr,ur=nr.byteOffset||0,pr=nr.bufferView!==void 0?rr.bufferViews[nr.bufferView].byteStride:void 0,gr=nr.normalized===!0;let _r,mr;if(pr&&pr!==fr){const dr=Math.floor(ur/pr),vr="InterleavedBuffer:"+nr.bufferView+":"+nr.componentType+":"+dr+":"+nr.count;let Ar=tr.cache.get(vr);Ar||(_r=new cr(or,dr*pr,nr.count*pr/hr),Ar=new InterleavedBuffer(_r,pr/hr),tr.cache.add(vr,Ar)),mr=new InterleavedBufferAttribute(Ar,lr,ur%pr/hr,gr)}else or===null?_r=new cr(nr.count*lr):_r=new cr(or,ur,nr.count*lr),mr=new BufferAttribute(_r,lr,gr);if(nr.sparse!==void 0){const dr=WEBGL_TYPE_SIZES.SCALAR,vr=WEBGL_COMPONENT_TYPES[nr.sparse.indices.componentType],Ar=nr.sparse.indices.byteOffset||0,yr=nr.sparse.values.byteOffset||0,wr=new vr(ar[1],Ar,nr.sparse.count*dr),br=new cr(ar[2],yr,nr.sparse.count*lr);or!==null&&(mr=new BufferAttribute(mr.array.slice(),mr.itemSize,mr.normalized)),mr.normalized=!1;for(let Sr=0,xr=wr.length;Sr<xr;Sr++){const Cr=wr[Sr];if(mr.setX(Cr,br[Sr*lr]),lr>=2&&mr.setY(Cr,br[Sr*lr+1]),lr>=3&&mr.setZ(Cr,br[Sr*lr+2]),lr>=4&&mr.setW(Cr,br[Sr*lr+3]),lr>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}mr.normalized=gr}return mr})}loadTexture(er){const tr=this.json,rr=this.options,sr=tr.textures[er].source,ar=tr.images[sr];let or=this.textureLoader;if(ar.uri){const lr=rr.manager.getHandler(ar.uri);lr!==null&&(or=lr)}return this.loadTextureImage(er,sr,or)}loadTextureImage(er,tr,rr){const nr=this,sr=this.json,ar=sr.textures[er],or=sr.images[tr],lr=(or.uri||or.bufferView)+":"+ar.sampler;if(this.textureCache[lr])return this.textureCache[lr];const cr=this.loadImageSource(tr,rr).then(function(hr){hr.flipY=!1,hr.name=ar.name||or.name||"",hr.name===""&&typeof or.uri=="string"&&or.uri.startsWith("data:image/")===!1&&(hr.name=or.uri);const ur=(sr.samplers||{})[ar.sampler]||{};return hr.magFilter=WEBGL_FILTERS[ur.magFilter]||LinearFilter,hr.minFilter=WEBGL_FILTERS[ur.minFilter]||LinearMipmapLinearFilter,hr.wrapS=WEBGL_WRAPPINGS[ur.wrapS]||RepeatWrapping,hr.wrapT=WEBGL_WRAPPINGS[ur.wrapT]||RepeatWrapping,hr.generateMipmaps=!hr.isCompressedTexture&&hr.minFilter!==NearestFilter&&hr.minFilter!==LinearFilter,nr.associations.set(hr,{textures:er}),hr}).catch(function(){return null});return this.textureCache[lr]=cr,cr}loadImageSource(er,tr){const rr=this,nr=this.json,sr=this.options;if(this.sourceCache[er]!==void 0)return this.sourceCache[er].then(fr=>fr.clone());const ar=nr.images[er],or=self.URL||self.webkitURL;let lr=ar.uri||"",cr=!1;if(ar.bufferView!==void 0)lr=rr.getDependency("bufferView",ar.bufferView).then(function(fr){cr=!0;const ur=new Blob([fr],{type:ar.mimeType});return lr=or.createObjectURL(ur),lr});else if(ar.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+er+" is missing URI and bufferView");const hr=Promise.resolve(lr).then(function(fr){return new Promise(function(ur,pr){let gr=ur;tr.isImageBitmapLoader===!0&&(gr=function(_r){const mr=new Texture(_r);mr.needsUpdate=!0,ur(mr)}),tr.load(LoaderUtils.resolveURL(fr,sr.path),gr,void 0,pr)})}).then(function(fr){return cr===!0&&or.revokeObjectURL(lr),assignExtrasToUserData(fr,ar),fr.userData.mimeType=ar.mimeType||getImageURIMimeType(ar.uri),fr}).catch(function(fr){throw console.error("THREE.GLTFLoader: Couldn't load texture",lr),fr});return this.sourceCache[er]=hr,hr}assignTexture(er,tr,rr,nr){const sr=this;return this.getDependency("texture",rr.index).then(function(ar){if(!ar)return null;if(rr.texCoord!==void 0&&rr.texCoord>0&&(ar=ar.clone(),ar.channel=rr.texCoord),sr.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const or=rr.extensions!==void 0?rr.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(or){const lr=sr.associations.get(ar);ar=sr.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(ar,or),sr.associations.set(ar,lr)}}return nr!==void 0&&(ar.colorSpace=nr),er[tr]=ar,ar})}assignFinalMaterial(er){const tr=er.geometry;let rr=er.material;const nr=tr.attributes.tangent===void 0,sr=tr.attributes.color!==void 0,ar=tr.attributes.normal===void 0;if(er.isPoints){const or="PointsMaterial:"+rr.uuid;let lr=this.cache.get(or);lr||(lr=new PointsMaterial,Material.prototype.copy.call(lr,rr),lr.color.copy(rr.color),lr.map=rr.map,lr.sizeAttenuation=!1,this.cache.add(or,lr)),rr=lr}else if(er.isLine){const or="LineBasicMaterial:"+rr.uuid;let lr=this.cache.get(or);lr||(lr=new LineBasicMaterial,Material.prototype.copy.call(lr,rr),lr.color.copy(rr.color),lr.map=rr.map,this.cache.add(or,lr)),rr=lr}if(nr||sr||ar){let or="ClonedMaterial:"+rr.uuid+":";nr&&(or+="derivative-tangents:"),sr&&(or+="vertex-colors:"),ar&&(or+="flat-shading:");let lr=this.cache.get(or);lr||(lr=rr.clone(),sr&&(lr.vertexColors=!0),ar&&(lr.flatShading=!0),nr&&(lr.normalScale&&(lr.normalScale.y*=-1),lr.clearcoatNormalScale&&(lr.clearcoatNormalScale.y*=-1)),this.cache.add(or,lr),this.associations.set(lr,this.associations.get(rr))),rr=lr}er.material=rr}getMaterialType(){return MeshStandardMaterial}loadMaterial(er){const tr=this,rr=this.json,nr=this.extensions,sr=rr.materials[er];let ar;const or={},lr=sr.extensions||{},cr=[];if(lr[EXTENSIONS.KHR_MATERIALS_UNLIT]){const fr=nr[EXTENSIONS.KHR_MATERIALS_UNLIT];ar=fr.getMaterialType(),cr.push(fr.extendParams(or,sr,tr))}else{const fr=sr.pbrMetallicRoughness||{};if(or.color=new Color(1,1,1),or.opacity=1,Array.isArray(fr.baseColorFactor)){const ur=fr.baseColorFactor;or.color.setRGB(ur[0],ur[1],ur[2],LinearSRGBColorSpace),or.opacity=ur[3]}fr.baseColorTexture!==void 0&&cr.push(tr.assignTexture(or,"map",fr.baseColorTexture,SRGBColorSpace)),or.metalness=fr.metallicFactor!==void 0?fr.metallicFactor:1,or.roughness=fr.roughnessFactor!==void 0?fr.roughnessFactor:1,fr.metallicRoughnessTexture!==void 0&&(cr.push(tr.assignTexture(or,"metalnessMap",fr.metallicRoughnessTexture)),cr.push(tr.assignTexture(or,"roughnessMap",fr.metallicRoughnessTexture))),ar=this._invokeOne(function(ur){return ur.getMaterialType&&ur.getMaterialType(er)}),cr.push(Promise.all(this._invokeAll(function(ur){return ur.extendMaterialParams&&ur.extendMaterialParams(er,or)})))}sr.doubleSided===!0&&(or.side=DoubleSide);const hr=sr.alphaMode||ALPHA_MODES.OPAQUE;if(hr===ALPHA_MODES.BLEND?(or.transparent=!0,or.depthWrite=!1):(or.transparent=!1,hr===ALPHA_MODES.MASK&&(or.alphaTest=sr.alphaCutoff!==void 0?sr.alphaCutoff:.5)),sr.normalTexture!==void 0&&ar!==MeshBasicMaterial&&(cr.push(tr.assignTexture(or,"normalMap",sr.normalTexture)),or.normalScale=new Vector2(1,1),sr.normalTexture.scale!==void 0)){const fr=sr.normalTexture.scale;or.normalScale.set(fr,fr)}if(sr.occlusionTexture!==void 0&&ar!==MeshBasicMaterial&&(cr.push(tr.assignTexture(or,"aoMap",sr.occlusionTexture)),sr.occlusionTexture.strength!==void 0&&(or.aoMapIntensity=sr.occlusionTexture.strength)),sr.emissiveFactor!==void 0&&ar!==MeshBasicMaterial){const fr=sr.emissiveFactor;or.emissive=new Color().setRGB(fr[0],fr[1],fr[2],LinearSRGBColorSpace)}return sr.emissiveTexture!==void 0&&ar!==MeshBasicMaterial&&cr.push(tr.assignTexture(or,"emissiveMap",sr.emissiveTexture,SRGBColorSpace)),Promise.all(cr).then(function(){const fr=new ar(or);return sr.name&&(fr.name=sr.name),assignExtrasToUserData(fr,sr),tr.associations.set(fr,{materials:er}),sr.extensions&&addUnknownExtensionsToUserData(nr,fr,sr),fr})}createUniqueName(er){const tr=PropertyBinding.sanitizeNodeName(er||"");return tr in this.nodeNamesUsed?tr+"_"+ ++this.nodeNamesUsed[tr]:(this.nodeNamesUsed[tr]=0,tr)}loadGeometries(er){const tr=this,rr=this.extensions,nr=this.primitiveCache;function sr(or){return rr[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(or,tr).then(function(lr){return addPrimitiveAttributes(lr,or,tr)})}const ar=[];for(let or=0,lr=er.length;or<lr;or++){const cr=er[or],hr=createPrimitiveKey(cr),fr=nr[hr];if(fr)ar.push(fr.promise);else{let ur;cr.extensions&&cr.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?ur=sr(cr):ur=addPrimitiveAttributes(new BufferGeometry,cr,tr),nr[hr]={primitive:cr,promise:ur},ar.push(ur)}}return Promise.all(ar)}loadMesh(er){const tr=this,rr=this.json,nr=this.extensions,sr=rr.meshes[er],ar=sr.primitives,or=[];for(let lr=0,cr=ar.length;lr<cr;lr++){const hr=ar[lr].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",ar[lr].material);or.push(hr)}return or.push(tr.loadGeometries(ar)),Promise.all(or).then(function(lr){const cr=lr.slice(0,lr.length-1),hr=lr[lr.length-1],fr=[];for(let pr=0,gr=hr.length;pr<gr;pr++){const _r=hr[pr],mr=ar[pr];let dr;const vr=cr[pr];if(mr.mode===WEBGL_CONSTANTS.TRIANGLES||mr.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||mr.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||mr.mode===void 0)dr=sr.isSkinnedMesh===!0?new SkinnedMesh(_r,vr):new Mesh(_r,vr),dr.isSkinnedMesh===!0&&dr.normalizeSkinWeights(),mr.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?dr.geometry=toTrianglesDrawMode(dr.geometry,TriangleStripDrawMode):mr.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(dr.geometry=toTrianglesDrawMode(dr.geometry,TriangleFanDrawMode));else if(mr.mode===WEBGL_CONSTANTS.LINES)dr=new LineSegments(_r,vr);else if(mr.mode===WEBGL_CONSTANTS.LINE_STRIP)dr=new Line(_r,vr);else if(mr.mode===WEBGL_CONSTANTS.LINE_LOOP)dr=new LineLoop(_r,vr);else if(mr.mode===WEBGL_CONSTANTS.POINTS)dr=new Points(_r,vr);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+mr.mode);Object.keys(dr.geometry.morphAttributes).length>0&&updateMorphTargets(dr,sr),dr.name=tr.createUniqueName(sr.name||"mesh_"+er),assignExtrasToUserData(dr,sr),mr.extensions&&addUnknownExtensionsToUserData(nr,dr,mr),tr.assignFinalMaterial(dr),fr.push(dr)}for(let pr=0,gr=fr.length;pr<gr;pr++)tr.associations.set(fr[pr],{meshes:er,primitives:pr});if(fr.length===1)return sr.extensions&&addUnknownExtensionsToUserData(nr,fr[0],sr),fr[0];const ur=new Group;sr.extensions&&addUnknownExtensionsToUserData(nr,ur,sr),tr.associations.set(ur,{meshes:er});for(let pr=0,gr=fr.length;pr<gr;pr++)ur.add(fr[pr]);return ur})}loadCamera(er){let tr;const rr=this.json.cameras[er],nr=rr[rr.type];if(!nr){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return rr.type==="perspective"?tr=new PerspectiveCamera(MathUtils.radToDeg(nr.yfov),nr.aspectRatio||1,nr.znear||1,nr.zfar||2e6):rr.type==="orthographic"&&(tr=new OrthographicCamera(-nr.xmag,nr.xmag,nr.ymag,-nr.ymag,nr.znear,nr.zfar)),rr.name&&(tr.name=this.createUniqueName(rr.name)),assignExtrasToUserData(tr,rr),Promise.resolve(tr)}loadSkin(er){const tr=this.json.skins[er],rr=[];for(let nr=0,sr=tr.joints.length;nr<sr;nr++)rr.push(this._loadNodeShallow(tr.joints[nr]));return tr.inverseBindMatrices!==void 0?rr.push(this.getDependency("accessor",tr.inverseBindMatrices)):rr.push(null),Promise.all(rr).then(function(nr){const sr=nr.pop(),ar=nr,or=[],lr=[];for(let cr=0,hr=ar.length;cr<hr;cr++){const fr=ar[cr];if(fr){or.push(fr);const ur=new Matrix4;sr!==null&&ur.fromArray(sr.array,cr*16),lr.push(ur)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',tr.joints[cr])}return new Skeleton(or,lr)})}loadAnimation(er){const tr=this.json,rr=this,nr=tr.animations[er],sr=nr.name?nr.name:"animation_"+er,ar=[],or=[],lr=[],cr=[],hr=[];for(let fr=0,ur=nr.channels.length;fr<ur;fr++){const pr=nr.channels[fr],gr=nr.samplers[pr.sampler],_r=pr.target,mr=_r.node,dr=nr.parameters!==void 0?nr.parameters[gr.input]:gr.input,vr=nr.parameters!==void 0?nr.parameters[gr.output]:gr.output;_r.node!==void 0&&(ar.push(this.getDependency("node",mr)),or.push(this.getDependency("accessor",dr)),lr.push(this.getDependency("accessor",vr)),cr.push(gr),hr.push(_r))}return Promise.all([Promise.all(ar),Promise.all(or),Promise.all(lr),Promise.all(cr),Promise.all(hr)]).then(function(fr){const ur=fr[0],pr=fr[1],gr=fr[2],_r=fr[3],mr=fr[4],dr=[];for(let vr=0,Ar=ur.length;vr<Ar;vr++){const yr=ur[vr],wr=pr[vr],br=gr[vr],Sr=_r[vr],xr=mr[vr];if(yr===void 0)continue;yr.updateMatrix&&yr.updateMatrix();const Cr=rr._createAnimationTracks(yr,wr,br,Sr,xr);if(Cr)for(let Ir=0;Ir<Cr.length;Ir++)dr.push(Cr[Ir])}return new AnimationClip(sr,void 0,dr)})}createNodeMesh(er){const tr=this.json,rr=this,nr=tr.nodes[er];return nr.mesh===void 0?null:rr.getDependency("mesh",nr.mesh).then(function(sr){const ar=rr._getNodeRef(rr.meshCache,nr.mesh,sr);return nr.weights!==void 0&&ar.traverse(function(or){if(or.isMesh)for(let lr=0,cr=nr.weights.length;lr<cr;lr++)or.morphTargetInfluences[lr]=nr.weights[lr]}),ar})}loadNode(er){const tr=this.json,rr=this,nr=tr.nodes[er],sr=rr._loadNodeShallow(er),ar=[],or=nr.children||[];for(let cr=0,hr=or.length;cr<hr;cr++)ar.push(rr.getDependency("node",or[cr]));const lr=nr.skin===void 0?Promise.resolve(null):rr.getDependency("skin",nr.skin);return Promise.all([sr,Promise.all(ar),lr]).then(function(cr){const hr=cr[0],fr=cr[1],ur=cr[2];ur!==null&&hr.traverse(function(pr){pr.isSkinnedMesh&&pr.bind(ur,_identityMatrix)});for(let pr=0,gr=fr.length;pr<gr;pr++)hr.add(fr[pr]);return hr})}_loadNodeShallow(er){const tr=this.json,rr=this.extensions,nr=this;if(this.nodeCache[er]!==void 0)return this.nodeCache[er];const sr=tr.nodes[er],ar=sr.name?nr.createUniqueName(sr.name):"",or=[],lr=nr._invokeOne(function(cr){return cr.createNodeMesh&&cr.createNodeMesh(er)});return lr&&or.push(lr),sr.camera!==void 0&&or.push(nr.getDependency("camera",sr.camera).then(function(cr){return nr._getNodeRef(nr.cameraCache,sr.camera,cr)})),nr._invokeAll(function(cr){return cr.createNodeAttachment&&cr.createNodeAttachment(er)}).forEach(function(cr){or.push(cr)}),this.nodeCache[er]=Promise.all(or).then(function(cr){let hr;if(sr.isBone===!0?hr=new Bone:cr.length>1?hr=new Group:cr.length===1?hr=cr[0]:hr=new Object3D,hr!==cr[0])for(let fr=0,ur=cr.length;fr<ur;fr++)hr.add(cr[fr]);if(sr.name&&(hr.userData.name=sr.name,hr.name=ar),assignExtrasToUserData(hr,sr),sr.extensions&&addUnknownExtensionsToUserData(rr,hr,sr),sr.matrix!==void 0){const fr=new Matrix4;fr.fromArray(sr.matrix),hr.applyMatrix4(fr)}else sr.translation!==void 0&&hr.position.fromArray(sr.translation),sr.rotation!==void 0&&hr.quaternion.fromArray(sr.rotation),sr.scale!==void 0&&hr.scale.fromArray(sr.scale);return nr.associations.has(hr)||nr.associations.set(hr,{}),nr.associations.get(hr).nodes=er,hr}),this.nodeCache[er]}loadScene(er){const tr=this.extensions,rr=this.json.scenes[er],nr=this,sr=new Group;rr.name&&(sr.name=nr.createUniqueName(rr.name)),assignExtrasToUserData(sr,rr),rr.extensions&&addUnknownExtensionsToUserData(tr,sr,rr);const ar=rr.nodes||[],or=[];for(let lr=0,cr=ar.length;lr<cr;lr++)or.push(nr.getDependency("node",ar[lr]));return Promise.all(or).then(function(lr){for(let hr=0,fr=lr.length;hr<fr;hr++)sr.add(lr[hr]);const cr=hr=>{const fr=new Map;for(const[ur,pr]of nr.associations)(ur instanceof Material||ur instanceof Texture)&&fr.set(ur,pr);return hr.traverse(ur=>{const pr=nr.associations.get(ur);pr!=null&&fr.set(ur,pr)}),fr};return nr.associations=cr(sr),sr})}_createAnimationTracks(er,tr,rr,nr,sr){const ar=[],or=er.name?er.name:er.uuid,lr=[];PATH_PROPERTIES[sr.path]===PATH_PROPERTIES.weights?er.traverse(function(ur){ur.morphTargetInfluences&&lr.push(ur.name?ur.name:ur.uuid)}):lr.push(or);let cr;switch(PATH_PROPERTIES[sr.path]){case PATH_PROPERTIES.weights:cr=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:cr=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:cr=VectorKeyframeTrack;break;default:switch(rr.itemSize){case 1:cr=NumberKeyframeTrack;break;case 2:case 3:default:cr=VectorKeyframeTrack;break}break}const hr=nr.interpolation!==void 0?INTERPOLATION[nr.interpolation]:InterpolateLinear,fr=this._getArrayFromAccessor(rr);for(let ur=0,pr=lr.length;ur<pr;ur++){const gr=new cr(lr[ur]+"."+PATH_PROPERTIES[sr.path],tr.array,fr,hr);nr.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(gr),ar.push(gr)}return ar}_getArrayFromAccessor(er){let tr=er.array;if(er.normalized){const rr=getNormalizedComponentScale(tr.constructor),nr=new Float32Array(tr.length);for(let sr=0,ar=tr.length;sr<ar;sr++)nr[sr]=tr[sr]*rr;tr=nr}return tr}_createCubicSplineTrackInterpolant(er){er.createInterpolant=function(rr){const nr=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new nr(this.times,this.values,this.getValueSize()/3,rr)},er.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(ir,er,tr){const rr=er.attributes,nr=new Box3;if(rr.POSITION!==void 0){const or=tr.json.accessors[rr.POSITION],lr=or.min,cr=or.max;if(lr!==void 0&&cr!==void 0){if(nr.set(new Vector3$1(lr[0],lr[1],lr[2]),new Vector3$1(cr[0],cr[1],cr[2])),or.normalized){const hr=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[or.componentType]);nr.min.multiplyScalar(hr),nr.max.multiplyScalar(hr)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const sr=er.targets;if(sr!==void 0){const or=new Vector3$1,lr=new Vector3$1;for(let cr=0,hr=sr.length;cr<hr;cr++){const fr=sr[cr];if(fr.POSITION!==void 0){const ur=tr.json.accessors[fr.POSITION],pr=ur.min,gr=ur.max;if(pr!==void 0&&gr!==void 0){if(lr.setX(Math.max(Math.abs(pr[0]),Math.abs(gr[0]))),lr.setY(Math.max(Math.abs(pr[1]),Math.abs(gr[1]))),lr.setZ(Math.max(Math.abs(pr[2]),Math.abs(gr[2]))),ur.normalized){const _r=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[ur.componentType]);lr.multiplyScalar(_r)}or.max(lr)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}nr.expandByVector(or)}ir.boundingBox=nr;const ar=new Sphere;nr.getCenter(ar.center),ar.radius=nr.min.distanceTo(nr.max)/2,ir.boundingSphere=ar}function addPrimitiveAttributes(ir,er,tr){const rr=er.attributes,nr=[];function sr(ar,or){return tr.getDependency("accessor",ar).then(function(lr){ir.setAttribute(or,lr)})}for(const ar in rr){const or=ATTRIBUTES[ar]||ar.toLowerCase();or in ir.attributes||nr.push(sr(rr[ar],or))}if(er.indices!==void 0&&!ir.index){const ar=tr.getDependency("accessor",er.indices).then(function(or){ir.setIndex(or)});nr.push(ar)}return ColorManagement.workingColorSpace!==LinearSRGBColorSpace&&"COLOR_0"in rr&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ColorManagement.workingColorSpace}" not supported.`),assignExtrasToUserData(ir,er),computeBounds(ir,er,tr),Promise.all(nr).then(function(){return er.targets!==void 0?addMorphTargets(ir,er.targets,tr):ir})}class RGBELoader extends DataTextureLoader{constructor(er){super(er),this.type=HalfFloatType}parse(er){const ar=function(xr,Cr){switch(xr){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(Cr||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(Cr||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(Cr||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(Cr||""))}},hr=`
`,fr=function(xr,Cr,Ir){Cr=Cr||1024;let Pr=xr.pos,Fr=-1,Nr=0,Ur="",Br=String.fromCharCode.apply(null,new Uint16Array(xr.subarray(Pr,Pr+128)));for(;0>(Fr=Br.indexOf(hr))&&Nr<Cr&&Pr<xr.byteLength;)Ur+=Br,Nr+=Br.length,Pr+=128,Br+=String.fromCharCode.apply(null,new Uint16Array(xr.subarray(Pr,Pr+128)));return-1<Fr?(Ir!==!1&&(xr.pos+=Nr+Fr+1),Ur+Br.slice(0,Fr)):!1},ur=function(xr){const Cr=/^#\?(\S+)/,Ir=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Rr=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Pr=/^\s*FORMAT=(\S+)\s*$/,Fr=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,Nr={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Ur,Br;for((xr.pos>=xr.byteLength||!(Ur=fr(xr)))&&ar(1,"no header found"),(Br=Ur.match(Cr))||ar(3,"bad initial token"),Nr.valid|=1,Nr.programtype=Br[1],Nr.string+=Ur+`
`;Ur=fr(xr),Ur!==!1;){if(Nr.string+=Ur+`
`,Ur.charAt(0)==="#"){Nr.comments+=Ur+`
`;continue}if((Br=Ur.match(Ir))&&(Nr.gamma=parseFloat(Br[1])),(Br=Ur.match(Rr))&&(Nr.exposure=parseFloat(Br[1])),(Br=Ur.match(Pr))&&(Nr.valid|=2,Nr.format=Br[1]),(Br=Ur.match(Fr))&&(Nr.valid|=4,Nr.height=parseInt(Br[1],10),Nr.width=parseInt(Br[2],10)),Nr.valid&2&&Nr.valid&4)break}return Nr.valid&2||ar(3,"missing format specifier"),Nr.valid&4||ar(3,"missing image size specifier"),Nr},pr=function(xr,Cr,Ir){const Rr=Cr;if(Rr<8||Rr>32767||xr[0]!==2||xr[1]!==2||xr[2]&128)return new Uint8Array(xr);Rr!==(xr[2]<<8|xr[3])&&ar(3,"wrong scanline width");const Pr=new Uint8Array(4*Cr*Ir);Pr.length||ar(4,"unable to allocate buffer space");let Fr=0,Nr=0;const Ur=4*Rr,Br=new Uint8Array(4),Or=new Uint8Array(Ur);let Dr=Ir;for(;Dr>0&&Nr<xr.byteLength;){Nr+4>xr.byteLength&&ar(1),Br[0]=xr[Nr++],Br[1]=xr[Nr++],Br[2]=xr[Nr++],Br[3]=xr[Nr++],(Br[0]!=2||Br[1]!=2||(Br[2]<<8|Br[3])!=Rr)&&ar(3,"bad rgbe scanline format");let Wr=0,$r;for(;Wr<Ur&&Nr<xr.byteLength;){$r=xr[Nr++];const Qi=$r>128;if(Qi&&($r-=128),($r===0||Wr+$r>Ur)&&ar(3,"bad scanline data"),Qi){const rs=xr[Nr++];for(let Kr=0;Kr<$r;Kr++)Or[Wr++]=rs}else Or.set(xr.subarray(Nr,Nr+$r),Wr),Wr+=$r,Nr+=$r}const Yr=Rr;for(let Qi=0;Qi<Yr;Qi++){let rs=0;Pr[Fr]=Or[Qi+rs],rs+=Rr,Pr[Fr+1]=Or[Qi+rs],rs+=Rr,Pr[Fr+2]=Or[Qi+rs],rs+=Rr,Pr[Fr+3]=Or[Qi+rs],Fr+=4}Dr--}return Pr},gr=function(xr,Cr,Ir,Rr){const Pr=xr[Cr+3],Fr=Math.pow(2,Pr-128)/255;Ir[Rr+0]=xr[Cr+0]*Fr,Ir[Rr+1]=xr[Cr+1]*Fr,Ir[Rr+2]=xr[Cr+2]*Fr,Ir[Rr+3]=1},_r=function(xr,Cr,Ir,Rr){const Pr=xr[Cr+3],Fr=Math.pow(2,Pr-128)/255;Ir[Rr+0]=DataUtils.toHalfFloat(Math.min(xr[Cr+0]*Fr,65504)),Ir[Rr+1]=DataUtils.toHalfFloat(Math.min(xr[Cr+1]*Fr,65504)),Ir[Rr+2]=DataUtils.toHalfFloat(Math.min(xr[Cr+2]*Fr,65504)),Ir[Rr+3]=DataUtils.toHalfFloat(1)},mr=new Uint8Array(er);mr.pos=0;const dr=ur(mr),vr=dr.width,Ar=dr.height,yr=pr(mr.subarray(mr.pos),vr,Ar);let wr,br,Sr;switch(this.type){case FloatType:Sr=yr.length/4;const xr=new Float32Array(Sr*4);for(let Ir=0;Ir<Sr;Ir++)gr(yr,Ir*4,xr,Ir*4);wr=xr,br=FloatType;break;case HalfFloatType:Sr=yr.length/4;const Cr=new Uint16Array(Sr*4);for(let Ir=0;Ir<Sr;Ir++)_r(yr,Ir*4,Cr,Ir*4);wr=Cr,br=HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:vr,height:Ar,data:wr,header:dr.string,gamma:dr.gamma,exposure:dr.exposure,type:br}}setDataType(er){return this.type=er,this}load(er,tr,rr,nr){function sr(ar,or){switch(ar.type){case FloatType:case HalfFloatType:ar.colorSpace=LinearSRGBColorSpace,ar.minFilter=LinearFilter,ar.magFilter=LinearFilter,ar.generateMipmaps=!1,ar.flipY=!0;break}tr&&tr(ar,or)}return super.load(er,sr,rr,nr)}}class HDRCubeTextureLoader extends Loader{constructor(er){super(er),this.hdrLoader=new RGBELoader,this.type=HalfFloatType}load(er,tr,rr,nr){const sr=new CubeTexture;switch(sr.type=this.type,sr.type){case FloatType:sr.colorSpace=LinearSRGBColorSpace,sr.minFilter=LinearFilter,sr.magFilter=LinearFilter,sr.generateMipmaps=!1;break;case HalfFloatType:sr.colorSpace=LinearSRGBColorSpace,sr.minFilter=LinearFilter,sr.magFilter=LinearFilter,sr.generateMipmaps=!1;break}const ar=this;let or=0;function lr(cr,hr,fr,ur){new FileLoader(ar.manager).setPath(ar.path).setResponseType("arraybuffer").setWithCredentials(ar.withCredentials).load(er[cr],function(pr){or++;const gr=ar.hdrLoader.parse(pr);if(gr){if(gr.data!==void 0){const _r=new DataTexture(gr.data,gr.width,gr.height);_r.type=sr.type,_r.colorSpace=sr.colorSpace,_r.format=sr.format,_r.minFilter=sr.minFilter,_r.magFilter=sr.magFilter,_r.generateMipmaps=sr.generateMipmaps,sr.images[cr]=_r}or===6&&(sr.needsUpdate=!0,hr&&hr(sr))}},fr,ur)}for(let cr=0;cr<er.length;cr++)lr(cr,tr,rr,nr);return sr}setDataType(er){return this.type=er,this.hdrLoader.setDataType(er),this}}class IESLoader extends Loader{constructor(er){super(er),this.type=HalfFloatType}_getIESValues(er,tr){const ar=new Array(64800);function or(fr,ur){let pr=0,gr=0,_r=0,mr=0,dr=0,vr=0;for(let Rr=0;Rr<er.numHorAngles-1;++Rr)if(ur<er.horAngles[Rr+1]||Rr==er.numHorAngles-2){gr=Rr,_r=er.horAngles[Rr],mr=er.horAngles[Rr+1];break}for(let Rr=0;Rr<er.numVerAngles-1;++Rr)if(fr<er.verAngles[Rr+1]||Rr==er.numVerAngles-2){pr=Rr,dr=er.verAngles[Rr],vr=er.verAngles[Rr+1];break}const Ar=mr-_r,yr=vr-dr;if(yr===0)return 0;const wr=Ar===0?0:(ur-_r)/Ar,br=(fr-dr)/yr,Sr=Ar===0?gr:gr+1,xr=MathUtils.lerp(er.candelaValues[gr][pr],er.candelaValues[Sr][pr],wr),Cr=MathUtils.lerp(er.candelaValues[gr][pr+1],er.candelaValues[Sr][pr+1],wr);return MathUtils.lerp(xr,Cr,br)}const lr=er.horAngles[0],cr=er.horAngles[er.numHorAngles-1];for(let fr=0;fr<64800;++fr){let ur=fr%360;const pr=Math.floor(fr/360);cr-lr!==0&&(ur<lr||ur>=cr)&&(ur%=cr*2,ur>cr&&(ur=cr*2-ur)),ar[pr+ur*180]=or(pr,ur)}let hr=null;return tr===UnsignedByteType?hr=Uint8Array.from(ar.map(fr=>Math.min(fr*255,255))):tr===HalfFloatType?hr=Uint16Array.from(ar.map(fr=>DataUtils.toHalfFloat(fr))):tr===FloatType?hr=Float32Array.from(ar):console.error("IESLoader: Unsupported type:",tr),hr}load(er,tr,rr,nr){const sr=new FileLoader(this.manager);sr.setResponseType("text"),sr.setCrossOrigin(this.crossOrigin),sr.setWithCredentials(this.withCredentials),sr.setPath(this.path),sr.setRequestHeader(this.requestHeader),sr.load(er,ar=>{tr(this.parse(ar))},rr,nr)}parse(er){const tr=this.type,rr=new IESLamp(er),nr=this._getIESValues(rr,tr),sr=new DataTexture(nr,180,1,RedFormat,tr);return sr.minFilter=LinearFilter,sr.magFilter=LinearFilter,sr.needsUpdate=!0,sr}}function IESLamp(ir){const er=this,tr=ir.split(`
`);let rr=0,nr;er.verAngles=[],er.horAngles=[],er.candelaValues=[],er.tiltData={},er.tiltData.angles=[],er.tiltData.mulFactors=[];function sr(ur){return ur=ur.replace(/^\s+|\s+$/g,""),ur=ur.replace(/,/g," "),ur=ur.replace(/\s\s+/g," "),ur.split(" ")}function ar(ur,pr){for(;;){const gr=tr[rr++],_r=sr(gr);for(let mr=0;mr<_r.length;++mr)pr.push(Number(_r[mr]));if(pr.length===ur)break}}function or(){let ur=tr[rr++],pr=sr(ur);er.tiltData.lampToLumGeometry=Number(pr[0]),ur=tr[rr++],pr=sr(ur),er.tiltData.numAngles=Number(pr[0]),ar(er.tiltData.numAngles,er.tiltData.angles),ar(er.tiltData.numAngles,er.tiltData.mulFactors)}function lr(){const ur=[];ar(10,ur),er.count=Number(ur[0]),er.lumens=Number(ur[1]),er.multiplier=Number(ur[2]),er.numVerAngles=Number(ur[3]),er.numHorAngles=Number(ur[4]),er.gonioType=Number(ur[5]),er.units=Number(ur[6]),er.width=Number(ur[7]),er.length=Number(ur[8]),er.height=Number(ur[9])}function cr(){const ur=[];ar(3,ur),er.ballFactor=Number(ur[0]),er.blpFactor=Number(ur[1]),er.inputWatts=Number(ur[2])}for(;nr=tr[rr++],!nr.includes("TILT"););nr.includes("NONE")||nr.includes("INCLUDE")&&or(),lr(),cr();for(let ur=0;ur<er.numHorAngles;++ur)er.candelaValues.push([]);ar(er.numVerAngles,er.verAngles),ar(er.numHorAngles,er.horAngles);for(let ur=0;ur<er.numHorAngles;++ur)ar(er.numVerAngles,er.candelaValues[ur]);for(let ur=0;ur<er.numHorAngles;++ur)for(let pr=0;pr<er.numVerAngles;++pr)er.candelaValues[ur][pr]*=er.candelaValues[ur][pr]*er.multiplier*er.ballFactor*er.blpFactor;let hr=-1;for(let ur=0;ur<er.numHorAngles;++ur)for(let pr=0;pr<er.numVerAngles;++pr){const gr=er.candelaValues[ur][pr];hr=hr<gr?gr:hr}if(!0&&hr>0)for(let ur=0;ur<er.numHorAngles;++ur)for(let pr=0;pr<er.numVerAngles;++pr)er.candelaValues[ur][pr]/=hr}class KMZLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){function tr(sr){for(const ar in nr)if(ar.slice(-sr.length)===sr)return nr[ar]}const rr=new LoadingManager;rr.setURLModifier(function(sr){const ar=tr(sr);if(ar){console.log("Loading",sr);const or=new Blob([ar.buffer],{type:"application/octet-stream"});return URL.createObjectURL(or)}return sr});const nr=unzipSync(new Uint8Array(er));if(nr["doc.kml"]){const ar=new DOMParser().parseFromString(strFromU8(nr["doc.kml"]),"application/xml").querySelector("Placemark Model Link href");if(ar)return new ColladaLoader(rr).parse(strFromU8(nr[ar.textContent]))}else{console.warn("KMZLoader: Missing doc.kml file.");for(const sr in nr)if(sr.split(".").pop().toLowerCase()==="dae")return new ColladaLoader(rr).parse(strFromU8(nr[sr]))}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new Group}}}class WorkerPool{constructor(er=4){this.pool=er,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(er){if(!this.workers[er]){const tr=this.workerCreator();tr.addEventListener("message",this._onMessage.bind(this,er)),this.workers[er]=tr}}_getIdleWorker(){for(let er=0;er<this.pool;er++)if(!(this.workerStatus&1<<er))return er;return-1}_onMessage(er,tr){const rr=this.workersResolve[er];if(rr&&rr(tr),this.queue.length){const{resolve:nr,msg:sr,transfer:ar}=this.queue.shift();this.workersResolve[er]=nr,this.workers[er].postMessage(sr,ar)}else this.workerStatus^=1<<er}setWorkerCreator(er){this.workerCreator=er}setWorkerLimit(er){this.pool=er}postMessage(er,tr){return new Promise(rr=>{const nr=this._getIdleWorker();nr!==-1?(this._initWorker(nr),this.workerStatus|=1<<nr,this.workersResolve[nr]=rr,this.workers[nr].postMessage(er,tr)):this.queue.push({resolve:rr,msg:er,transfer:tr})})}dispose(){this.workers.forEach(er=>er.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}let A,I,B;const g={env:{emscripten_notify_memory_growth:function(ir){B=new Uint8Array(I.exports.memory.buffer)}}};class Q{init(){return A||(A=typeof fetch<"u"?fetch("data:application/wasm;base64,"+C).then(er=>er.arrayBuffer()).then(er=>WebAssembly.instantiate(er,g)).then(this._init):WebAssembly.instantiate(Buffer.from(C,"base64"),g).then(this._init),A)}_init(er){I=er.instance,g.env.emscripten_notify_memory_growth(0)}decode(er,tr=0){if(!I)throw new Error("ZSTDDecoder: Await .init() before decoding.");const rr=er.byteLength,nr=I.exports.malloc(rr);B.set(er,nr),tr=tr||Number(I.exports.ZSTD_findDecompressedSize(nr,rr));const sr=I.exports.malloc(tr),ar=I.exports.ZSTD_decompress(sr,tr,nr,rr),or=B.slice(sr,sr+ar);return I.exports.free(nr),I.exports.free(sr),or}}const C="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",P3_PRIMARIES=[.68,.32,.265,.69,.15,.06],P3_LUMINANCE_COEFFICIENTS=[.2289,.6917,.0793],REC2020_PRIMARIES=[.708,.292,.17,.797,.131,.046],REC2020_LUMINANCE_COEFFICIENTS=[.2627,.678,.0593],D65=[.3127,.329],LINEAR_DISPLAY_P3_TO_XYZ=new Matrix3().set(.4865709,.2656677,.1982173,.2289746,.6917385,.0792869,0,.0451134,1.0439444),XYZ_TO_LINEAR_DISPLAY_P3=new Matrix3().set(2.4934969,-.9313836,-.4027108,-.829489,1.7626641,.0236247,.0358458,-.0761724,.9568845),DisplayP3ColorSpace="display-p3",LinearDisplayP3ColorSpace="display-p3-linear",DisplayP3ColorSpaceImpl={primaries:P3_PRIMARIES,whitePoint:D65,transfer:SRGBTransfer,toXYZ:LINEAR_DISPLAY_P3_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_DISPLAY_P3,luminanceCoefficients:P3_LUMINANCE_COEFFICIENTS,outputColorSpaceConfig:{drawingBufferColorSpace:DisplayP3ColorSpace}},LinearDisplayP3ColorSpaceImpl={primaries:P3_PRIMARIES,whitePoint:D65,transfer:LinearTransfer,toXYZ:LINEAR_DISPLAY_P3_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_DISPLAY_P3,luminanceCoefficients:P3_LUMINANCE_COEFFICIENTS,workingColorSpaceConfig:{unpackColorSpace:DisplayP3ColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:DisplayP3ColorSpace}},LINEAR_REC2020_TO_XYZ=new Matrix3().set(.636958,.1446169,.168881,.2627002,.6779981,.0593017,0,.0280727,1.0609851),XYZ_TO_LINEAR_REC2020=new Matrix3().set(1.7166512,-.3556708,-.2533663,-.6666844,1.6164812,.0157685,.0176399,-.0427706,.9421031),LinearRec2020ColorSpace="rec2020-linear",LinearRec2020ColorSpaceImpl={primaries:REC2020_PRIMARIES,whitePoint:D65,transfer:LinearTransfer,toXYZ:LINEAR_REC2020_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC2020,luminanceCoefficients:REC2020_LUMINANCE_COEFFICIENTS},_taskCache=new WeakMap;let _activeLoaders=0,_zstd;class KTX2Loader extends Loader{constructor(er){super(er),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(er){return this.transcoderPath=er,this}setWorkerLimit(er){return this.workerPool.setWorkerLimit(er),this}async detectSupportAsync(er){return this.workerConfig={astcSupported:await er.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await er.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await er.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await er.hasFeatureAsync("texture-compression-bc"),bptcSupported:await er.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await er.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(er){return er.isWebGPURenderer===!0?this.workerConfig={astcSupported:er.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:er.hasFeature("texture-compression-etc1"),etc2Supported:er.hasFeature("texture-compression-etc2"),dxtSupported:er.hasFeature("texture-compression-bc"),bptcSupported:er.hasFeature("texture-compression-bptc"),pvrtcSupported:er.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:er.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:er.extensions.has("WEBGL_compressed_texture_astc")&&er.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:er.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:er.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:er.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:er.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:er.extensions.has("WEBGL_compressed_texture_pvrtc")||er.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const er=new FileLoader(this.manager);er.setPath(this.transcoderPath),er.setWithCredentials(this.withCredentials);const tr=er.loadAsync("basis_transcoder.js"),rr=new FileLoader(this.manager);rr.setPath(this.transcoderPath),rr.setResponseType("arraybuffer"),rr.setWithCredentials(this.withCredentials);const nr=rr.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([tr,nr]).then(([sr,ar])=>{const or=KTX2Loader.BasisWorker.toString(),lr=["/* constants */","let _EngineFormat = "+JSON.stringify(KTX2Loader.EngineFormat),"let _EngineType = "+JSON.stringify(KTX2Loader.EngineType),"let _TranscoderFormat = "+JSON.stringify(KTX2Loader.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(KTX2Loader.BasisFormat),"/* basis_transcoder.js */",sr,"/* worker */",or.substring(or.indexOf("{")+1,or.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([lr])),this.transcoderBinary=ar,this.workerPool.setWorkerCreator(()=>{const cr=new Worker(this.workerSourceURL),hr=this.transcoderBinary.slice(0);return cr.postMessage({type:"init",config:this.workerConfig,transcoderBinary:hr},[hr]),cr})}),_activeLoaders>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),_activeLoaders++}return this.transcoderPending}load(er,tr,rr,nr){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const sr=new FileLoader(this.manager);sr.setResponseType("arraybuffer"),sr.setWithCredentials(this.withCredentials),sr.load(er,ar=>{this.parse(ar,tr,nr)},rr,nr)}parse(er,tr,rr){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(_taskCache.has(er))return _taskCache.get(er).promise.then(tr).catch(rr);this._createTexture(er).then(nr=>tr?tr(nr):null).catch(rr)}_createTextureFrom(er,tr){const{type:rr,error:nr,data:{faces:sr,width:ar,height:or,format:lr,type:cr,dfdFlags:hr}}=er;if(rr==="error")return Promise.reject(nr);let fr;if(tr.faceCount===6)fr=new CompressedCubeTexture(sr,lr,cr);else{const ur=sr[0].mipmaps;fr=tr.layerCount>1?new CompressedArrayTexture(ur,ar,or,tr.layerCount,lr,cr):new CompressedTexture(ur,ar,or,lr,cr)}return fr.minFilter=sr[0].mipmaps.length===1?LinearFilter:LinearMipmapLinearFilter,fr.magFilter=LinearFilter,fr.generateMipmaps=!1,fr.needsUpdate=!0,fr.colorSpace=parseColorSpace(tr),fr.premultiplyAlpha=!!(hr&g$1),fr}async _createTexture(er,tr={}){const rr=Pi(new Uint8Array(er)),nr=rr.vkFormat===pi$1&&rr.dataFormatDescriptor[0].colorModel===167;if(!(rr.vkFormat===it||nr&&!this.workerConfig.astcHDRSupported))return createRawTexture(rr);const ar=tr,or=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:er,taskConfig:ar},[er])).then(lr=>this._createTextureFrom(lr.data,rr));return _taskCache.set(er,{promise:or}),or}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),_activeLoaders--,this}}KTX2Loader.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2};KTX2Loader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25};KTX2Loader.EngineFormat={RGBAFormat,RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format};KTX2Loader.EngineType={UnsignedByteType,HalfFloatType,FloatType};KTX2Loader.BasisWorker=function(){let ir,er,tr;const rr=_EngineFormat,nr=_EngineType,sr=_TranscoderFormat,ar=_BasisFormat;self.addEventListener("message",function(gr){const _r=gr.data;switch(_r.type){case"init":ir=_r.config,or(_r.transcoderBinary);break;case"transcode":er.then(()=>{try{const{faces:mr,buffers:dr,width:vr,height:Ar,hasAlpha:yr,format:wr,type:br,dfdFlags:Sr}=lr(_r.buffer);self.postMessage({type:"transcode",id:_r.id,data:{faces:mr,width:vr,height:Ar,hasAlpha:yr,format:wr,type:br,dfdFlags:Sr}},dr)}catch(mr){console.error(mr),self.postMessage({type:"error",id:_r.id,error:mr.message})}});break}});function or(gr){er=new Promise(_r=>{tr={wasmBinary:gr,onRuntimeInitialized:_r},BASIS(tr)}).then(()=>{tr.initializeBasis(),tr.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function lr(gr){const _r=new tr.KTX2File(new Uint8Array(gr));function mr(){_r.close(),_r.delete()}if(!_r.isValid())throw mr(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let dr;if(_r.isUASTC())dr=ar.UASTC;else if(_r.isETC1S())dr=ar.ETC1S;else if(_r.isHDR())dr=ar.UASTC_HDR;else throw new Error("THREE.KTX2Loader: Unknown Basis encoding");const vr=_r.getWidth(),Ar=_r.getHeight(),yr=_r.getLayers()||1,wr=_r.getLevels(),br=_r.getFaces(),Sr=_r.getHasAlpha(),xr=_r.getDFDFlags(),{transcoderFormat:Cr,engineFormat:Ir,engineType:Rr}=fr(dr,vr,Ar,Sr);if(!vr||!Ar||!wr)throw mr(),new Error("THREE.KTX2Loader:	Invalid texture");if(!_r.startTranscoding())throw mr(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Pr=[],Fr=[];for(let Nr=0;Nr<br;Nr++){const Ur=[];for(let Br=0;Br<wr;Br++){const Or=[];let Dr,Wr;for(let Yr=0;Yr<yr;Yr++){const Qi=_r.getImageLevelInfo(Br,Yr,Nr);Nr===0&&Br===0&&Yr===0&&(Qi.origWidth%4!==0||Qi.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),wr>1?(Dr=Qi.origWidth,Wr=Qi.origHeight):(Dr=Qi.width,Wr=Qi.height);let rs=new Uint8Array(_r.getImageTranscodedSizeInBytes(Br,Yr,0,Cr));const Kr=_r.transcodeImage(rs,Br,Yr,Nr,Cr,0,-1,-1);if(Rr===nr.HalfFloatType&&(rs=new Uint16Array(rs.buffer,rs.byteOffset,rs.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!Kr)throw mr(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Or.push(rs)}const $r=pr(Or);Ur.push({data:$r,width:Dr,height:Wr}),Fr.push($r.buffer)}Pr.push({mipmaps:Ur,width:vr,height:Ar,format:Ir,type:Rr})}return mr(),{faces:Pr,buffers:Fr,width:vr,height:Ar,hasAlpha:Sr,dfdFlags:xr,format:Ir,type:Rr}}const cr=[{if:"astcSupported",basisFormat:[ar.UASTC],transcoderFormat:[sr.ASTC_4x4,sr.ASTC_4x4],engineFormat:[rr.RGBA_ASTC_4x4_Format,rr.RGBA_ASTC_4x4_Format],engineType:[nr.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.BC7_M5,sr.BC7_M5],engineFormat:[rr.RGBA_BPTC_Format,rr.RGBA_BPTC_Format],engineType:[nr.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.BC1,sr.BC3],engineFormat:[rr.RGBA_S3TC_DXT1_Format,rr.RGBA_S3TC_DXT5_Format],engineType:[nr.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.ETC1,sr.ETC2],engineFormat:[rr.RGB_ETC2_Format,rr.RGBA_ETC2_EAC_Format],engineType:[nr.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.ETC1],engineFormat:[rr.RGB_ETC1_Format],engineType:[nr.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.PVRTC1_4_RGB,sr.PVRTC1_4_RGBA],engineFormat:[rr.RGB_PVRTC_4BPPV1_Format,rr.RGBA_PVRTC_4BPPV1_Format],engineType:[nr.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[ar.UASTC_HDR],transcoderFormat:[sr.BC6H],engineFormat:[rr.RGB_BPTC_UNSIGNED_Format],engineType:[nr.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.RGBA32,sr.RGBA32],engineFormat:[rr.RGBAFormat,rr.RGBAFormat],engineType:[nr.UnsignedByteType,nr.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[ar.UASTC_HDR],transcoderFormat:[sr.RGBA_HALF],engineFormat:[rr.RGBAFormat],engineType:[nr.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],hr={[ar.ETC1S]:cr.filter(gr=>gr.basisFormat.includes(ar.ETC1S)).sort((gr,_r)=>gr.priorityUASTC-_r.priorityUASTC),[ar.UASTC]:cr.filter(gr=>gr.basisFormat.includes(ar.UASTC)).sort((gr,_r)=>gr.priorityUASTC-_r.priorityUASTC),[ar.UASTC_HDR]:cr.filter(gr=>gr.basisFormat.includes(ar.UASTC_HDR)).sort((gr,_r)=>gr.priorityHDR-_r.priorityHDR)};function fr(gr,_r,mr,dr){const vr=hr[gr];for(let Ar=0;Ar<vr.length;Ar++){const yr=vr[Ar];if(yr.if&&!ir[yr.if]||!yr.basisFormat.includes(gr)||dr&&yr.transcoderFormat.length<2||yr.needsPowerOfTwo&&!(ur(_r)&&ur(mr)))continue;const wr=yr.transcoderFormat[dr?1:0],br=yr.engineFormat[dr?1:0],Sr=yr.engineType[0];return{transcoderFormat:wr,engineFormat:br,engineType:Sr}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}function ur(gr){return gr<=2?!0:(gr&gr-1)===0&&gr!==0}function pr(gr){if(gr.length===1)return gr[0];let _r=0;for(let vr=0;vr<gr.length;vr++){const Ar=gr[vr];_r+=Ar.byteLength}const mr=new Uint8Array(_r);let dr=0;for(let vr=0;vr<gr.length;vr++){const Ar=gr[vr];mr.set(Ar,dr),dr+=Ar.byteLength}return mr}};const UNCOMPRESSED_FORMATS=new Set([RGBAFormat,RGFormat,RedFormat]),FORMAT_MAP={[Ae]:RGBAFormat,[ge]:RGBAFormat,[Ft]:RGBAFormat,[Ct]:RGBAFormat,[we]:RGFormat,[ae]:RGFormat,[xt$1]:RGFormat,[wt]:RGFormat,[ue]:RedFormat,[te]:RedFormat,[yt$1]:RedFormat,[ct]:RedFormat,[pi$1]:RGBA_ASTC_4x4_Format,[Sn]:RGBA_ASTC_6x6_Format,[In]:RGBA_ASTC_6x6_Format},TYPE_MAP={[Ae]:FloatType,[ge]:HalfFloatType,[Ft]:UnsignedByteType,[Ct]:UnsignedByteType,[we]:FloatType,[ae]:HalfFloatType,[xt$1]:UnsignedByteType,[wt]:UnsignedByteType,[ue]:FloatType,[te]:HalfFloatType,[yt$1]:UnsignedByteType,[ct]:UnsignedByteType,[pi$1]:HalfFloatType,[Sn]:UnsignedByteType,[In]:UnsignedByteType};async function createRawTexture(ir){const{vkFormat:er}=ir;if(FORMAT_MAP[er]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let tr;ir.supercompressionScheme===n&&(_zstd||(_zstd=new Promise(async sr=>{const ar=new Q;await ar.init(),sr(ar)})),tr=await _zstd);const rr=[];for(let sr=0;sr<ir.levels.length;sr++){const ar=Math.max(1,ir.pixelWidth>>sr),or=Math.max(1,ir.pixelHeight>>sr),lr=ir.pixelDepth?Math.max(1,ir.pixelDepth>>sr):0,cr=ir.levels[sr];let hr;if(ir.supercompressionScheme===t$1)hr=cr.levelData;else if(ir.supercompressionScheme===n)hr=tr.decode(cr.levelData,cr.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let fr;TYPE_MAP[er]===FloatType?fr=new Float32Array(hr.buffer,hr.byteOffset,hr.byteLength/Float32Array.BYTES_PER_ELEMENT):TYPE_MAP[er]===HalfFloatType?fr=new Uint16Array(hr.buffer,hr.byteOffset,hr.byteLength/Uint16Array.BYTES_PER_ELEMENT):fr=hr,rr.push({data:fr,width:ar,height:or,depth:lr})}let nr;if(UNCOMPRESSED_FORMATS.has(FORMAT_MAP[er]))nr=ir.pixelDepth===0?new DataTexture(rr[0].data,ir.pixelWidth,ir.pixelHeight):new Data3DTexture(rr[0].data,ir.pixelWidth,ir.pixelHeight,ir.pixelDepth);else{if(ir.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");nr=new CompressedTexture(rr,ir.pixelWidth,ir.pixelHeight),nr.minFilter=rr.length===1?LinearFilter:LinearMipmapLinearFilter,nr.magFilter=LinearFilter}return nr.mipmaps=rr,nr.type=TYPE_MAP[er],nr.format=FORMAT_MAP[er],nr.colorSpace=parseColorSpace(ir),nr.needsUpdate=!0,Promise.resolve(nr)}function parseColorSpace(ir){const er=ir.dataFormatDescriptor[0];return er.colorPrimaries===C$1?er.transferFunction===u?SRGBColorSpace:LinearSRGBColorSpace:er.colorPrimaries===R$2?er.transferFunction===u?DisplayP3ColorSpace:LinearDisplayP3ColorSpace:(er.colorPrimaries===T||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${er.colorPrimaries}"`),NoColorSpace)}class KTXLoader extends CompressedTextureLoader{constructor(er){super(er)}parse(er,tr){const rr=new KhronosTextureContainer(er,1);return{mipmaps:rr.mipmaps(tr),width:rr.pixelWidth,height:rr.pixelHeight,format:rr.glInternalFormat,isCubemap:rr.numberOfFaces===6,mipmapCount:rr.numberOfMipmapLevels}}}const HEADER_LEN=12+13*4,COMPRESSED_2D=0;class KhronosTextureContainer{constructor(er,tr){this.arrayBuffer=er;const rr=new Uint8Array(this.arrayBuffer,0,12);if(rr[0]!==171||rr[1]!==75||rr[2]!==84||rr[3]!==88||rr[4]!==32||rr[5]!==49||rr[6]!==49||rr[7]!==187||rr[8]!==13||rr[9]!==10||rr[10]!==26||rr[11]!==10){console.error("texture missing KTX identifier");return}const nr=Uint32Array.BYTES_PER_ELEMENT,sr=new DataView(this.arrayBuffer,12,13*nr),or=sr.getUint32(0,!0)===67305985;if(this.glType=sr.getUint32(1*nr,or),this.glTypeSize=sr.getUint32(2*nr,or),this.glFormat=sr.getUint32(3*nr,or),this.glInternalFormat=sr.getUint32(4*nr,or),this.glBaseInternalFormat=sr.getUint32(5*nr,or),this.pixelWidth=sr.getUint32(6*nr,or),this.pixelHeight=sr.getUint32(7*nr,or),this.pixelDepth=sr.getUint32(8*nr,or),this.numberOfArrayElements=sr.getUint32(9*nr,or),this.numberOfFaces=sr.getUint32(10*nr,or),this.numberOfMipmapLevels=sr.getUint32(11*nr,or),this.bytesOfKeyValueData=sr.getUint32(12*nr,or),this.glType!==0){console.warn("only compressed formats currently supported");return}else this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels);if(this.pixelHeight===0||this.pixelDepth!==0){console.warn("only 2D textures currently supported");return}if(this.numberOfArrayElements!==0){console.warn("texture arrays not currently supported");return}if(this.numberOfFaces!==tr){console.warn("number of faces expected"+tr+", but found "+this.numberOfFaces);return}this.loadType=COMPRESSED_2D}mipmaps(er){const tr=[];let rr=HEADER_LEN+this.bytesOfKeyValueData,nr=this.pixelWidth,sr=this.pixelHeight;const ar=er?this.numberOfMipmapLevels:1;for(let or=0;or<ar;or++){const lr=new Int32Array(this.arrayBuffer,rr,1)[0];rr+=4;for(let cr=0;cr<this.numberOfFaces;cr++){const hr=new Uint8Array(this.arrayBuffer,rr,lr);tr.push({data:hr,width:nr,height:sr}),rr+=lr,rr+=3-(lr+3)%4}nr=Math.max(1,nr*.5),sr=Math.max(1,sr*.5)}return tr}}const FINISH_TYPE_DEFAULT=0,FINISH_TYPE_CHROME=1,FINISH_TYPE_PEARLESCENT=2,FINISH_TYPE_RUBBER=3,FINISH_TYPE_MATTE_METALLIC=4,FINISH_TYPE_METAL=5,FILE_LOCATION_TRY_PARTS=0,FILE_LOCATION_TRY_P=1,FILE_LOCATION_TRY_MODELS=2,FILE_LOCATION_AS_IS=3,FILE_LOCATION_TRY_RELATIVE=4,FILE_LOCATION_TRY_ABSOLUTE=5,FILE_LOCATION_NOT_FOUND=6,MAIN_COLOUR_CODE="16",MAIN_EDGE_COLOUR_CODE="24",COLOR_SPACE_LDRAW=SRGBColorSpace,_tempVec0=new Vector3$1,_tempVec1=new Vector3$1;class ConditionalLineSegments extends LineSegments{constructor(er,tr){super(er,tr),this.isConditionalLine=!0}}function generateFaceNormals(ir){for(let er=0,tr=ir.length;er<tr;er++){const rr=ir[er],nr=rr.vertices,sr=nr[0],ar=nr[1],or=nr[2];_tempVec0.subVectors(ar,sr),_tempVec1.subVectors(or,ar),rr.faceNormal=new Vector3$1().crossVectors(_tempVec0,_tempVec1).normalize()}}const _ray=new Ray$1;function smoothNormals(ir,er,tr=!1){const rr=100.00000001000001;function nr(ur){const pr=~~(ur.x*rr),gr=~~(ur.y*rr),_r=~~(ur.z*rr);return`${pr},${gr},${_r}`}function sr(ur,pr){return`${nr(ur)}_${nr(pr)}`}function ar(ur,pr,gr){gr.direction.subVectors(pr,ur).normalize();const _r=ur.dot(gr.direction);return gr.origin.copy(ur).addScaledVector(gr.direction,-_r),gr}function or(ur){return sr(ur.origin,ur.direction)}const lr=new Set,cr=new Map,hr={},fr=[];for(let ur=0,pr=er.length;ur<pr;ur++){const _r=er[ur].vertices,mr=_r[0],dr=_r[1];if(lr.add(sr(mr,dr)),lr.add(sr(dr,mr)),tr){const vr=ar(mr,dr,new Ray$1),Ar=or(vr);if(!cr.has(Ar)){ar(dr,mr,vr);const Sr=or(vr),xr={ray:vr,distances:[]};cr.set(Ar,xr),cr.set(Sr,xr)}const yr=cr.get(Ar);let wr=yr.ray.direction.dot(mr),br=yr.ray.direction.dot(dr);wr>br&&([wr,br]=[br,wr]),yr.distances.push(wr,br)}}for(let ur=0,pr=ir.length;ur<pr;ur++){const gr=ir[ur],_r=gr.vertices,mr=_r.length;for(let dr=0;dr<mr;dr++){const vr=dr,Ar=(dr+1)%mr,yr=_r[vr],wr=_r[Ar],br=sr(yr,wr);if(lr.has(br))continue;if(tr){ar(yr,wr,_ray);const xr=or(_ray);if(cr.has(xr)){const Cr=cr.get(xr),{ray:Ir,distances:Rr}=Cr;let Pr=Ir.direction.dot(yr),Fr=Ir.direction.dot(wr);Pr>Fr&&([Pr,Fr]=[Fr,Pr]);let Nr=!1;for(let Ur=0,Br=Rr.length;Ur<Br;Ur+=2)if(Pr>=Rr[Ur]&&Fr<=Rr[Ur+1]){Nr=!0;break}if(Nr)continue}}const Sr={index:vr,tri:gr};hr[br]=Sr}}for(;;){let ur=null;for(const gr in hr){ur=hr[gr];break}if(ur===null)break;const pr=[ur];for(;pr.length>0;){const gr=pr.pop().tri,_r=gr.vertices,mr=gr.normals,dr=gr.faceNormal,vr=_r.length;for(let Ar=0;Ar<vr;Ar++){const yr=Ar,wr=(Ar+1)%vr,br=_r[yr],Sr=_r[wr],xr=sr(br,Sr);delete hr[xr];const Cr=sr(Sr,br),Ir=hr[Cr];if(Ir){const Rr=Ir.tri,Pr=Ir.index,Fr=Rr.normals,Nr=Fr.length,Ur=Rr.faceNormal;if(Math.abs(Rr.faceNormal.dot(gr.faceNormal))<.25)continue;Cr in hr&&(pr.push(Ir),delete hr[Cr]);const Br=(Pr+1)%Nr;mr[yr]&&Fr[Br]&&mr[yr]!==Fr[Br]&&(Fr[Br].norm.add(mr[yr].norm),mr[yr].norm=Fr[Br].norm);let Or=mr[yr]||Fr[Br];Or===null&&(Or={norm:new Vector3$1},fr.push(Or.norm)),mr[yr]===null&&(mr[yr]=Or,Or.norm.add(dr)),Fr[Br]===null&&(Fr[Br]=Or,Or.norm.add(Ur)),mr[wr]&&Fr[Pr]&&mr[wr]!==Fr[Pr]&&(Fr[Pr].norm.add(mr[wr].norm),mr[wr].norm=Fr[Pr].norm);let Dr=mr[wr]||Fr[Pr];Dr===null&&(Dr={norm:new Vector3$1},fr.push(Dr.norm)),mr[wr]===null&&(mr[wr]=Dr,Dr.norm.add(dr)),Fr[Pr]===null&&(Fr[Pr]=Dr,Dr.norm.add(Ur))}}}}for(let ur=0,pr=fr.length;ur<pr;ur++)fr[ur].normalize()}function isPartType(ir){return ir==="Part"||ir==="Unofficial_Part"}function isPrimitiveType(ir){return/primitive/i.test(ir)||ir==="Subpart"}class LineParser{constructor(er,tr){this.line=er,this.lineLength=er.length,this.currentCharIndex=0,this.currentChar=" ",this.lineNumber=tr}seekNonSpace(){for(;this.currentCharIndex<this.lineLength;){if(this.currentChar=this.line.charAt(this.currentCharIndex),this.currentChar!==" "&&this.currentChar!=="	")return;this.currentCharIndex++}}getToken(){const er=this.currentCharIndex++;for(;this.currentCharIndex<this.lineLength&&(this.currentChar=this.line.charAt(this.currentCharIndex),!(this.currentChar===" "||this.currentChar==="	"));)this.currentCharIndex++;const tr=this.currentCharIndex;return this.seekNonSpace(),this.line.substring(er,tr)}getVector(){return new Vector3$1(parseFloat(this.getToken()),parseFloat(this.getToken()),parseFloat(this.getToken()))}getRemainingString(){return this.line.substring(this.currentCharIndex,this.lineLength)}isAtTheEnd(){return this.currentCharIndex>=this.lineLength}setToEnd(){this.currentCharIndex=this.lineLength}getLineNumberString(){return this.lineNumber>=0?" at line "+this.lineNumber:""}}class LDrawParsedCache{constructor(er){this.loader=er,this._cache={}}cloneResult(er){const tr={};return tr.faces=er.faces.map(rr=>({colorCode:rr.colorCode,material:rr.material,vertices:rr.vertices.map(nr=>nr.clone()),normals:rr.normals.map(()=>null),faceNormal:null})),tr.conditionalSegments=er.conditionalSegments.map(rr=>({colorCode:rr.colorCode,material:rr.material,vertices:rr.vertices.map(nr=>nr.clone()),controlPoints:rr.controlPoints.map(nr=>nr.clone())})),tr.lineSegments=er.lineSegments.map(rr=>({colorCode:rr.colorCode,material:rr.material,vertices:rr.vertices.map(nr=>nr.clone())})),tr.type=er.type,tr.category=er.category,tr.keywords=er.keywords,tr.author=er.author,tr.subobjects=er.subobjects,tr.fileName=er.fileName,tr.totalFaces=er.totalFaces,tr.startingBuildingStep=er.startingBuildingStep,tr.materials=er.materials,tr.group=null,tr}async fetchData(er){let tr=!1,rr=FILE_LOCATION_TRY_PARTS;for(;rr!==FILE_LOCATION_NOT_FOUND;){let nr=er;switch(rr){case FILE_LOCATION_AS_IS:rr=rr+1;break;case FILE_LOCATION_TRY_PARTS:nr="parts/"+nr,rr=rr+1;break;case FILE_LOCATION_TRY_P:nr="p/"+nr,rr=rr+1;break;case FILE_LOCATION_TRY_MODELS:nr="models/"+nr,rr=rr+1;break;case FILE_LOCATION_TRY_RELATIVE:nr=er.substring(0,er.lastIndexOf("/")+1)+nr,rr=rr+1;break;case FILE_LOCATION_TRY_ABSOLUTE:tr?rr=FILE_LOCATION_NOT_FOUND:(er=er.toLowerCase(),nr=er,tr=!0,rr=FILE_LOCATION_TRY_PARTS);break}const sr=this.loader,ar=new FileLoader(sr.manager);ar.setPath(sr.partsLibraryPath),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials);try{return await ar.loadAsync(nr)}catch{continue}}throw new Error('LDrawLoader: Subobject "'+er+'" could not be loaded.')}parse(er,tr=null){const rr=this.loader,nr=[],sr=[],ar=[],or=[],lr={},cr=Cr=>lr[Cr]||null;let hr="Model",fr=null,ur=null,pr=null,gr=0;er.indexOf(`\r
`)!==-1&&(er=er.replace(/\r\n/g,`
`));const _r=er.split(`
`),mr=_r.length;let dr=!1,vr=null,Ar=null,yr=!1,wr=!0,br=!1,Sr=!0,xr=!1;for(let Cr=0;Cr<mr;Cr++){const Ir=_r[Cr];if(Ir.length===0)continue;if(dr){Ir.startsWith("0 FILE ")?(this.setData(vr,Ar),vr=Ir.substring(7),Ar=""):Ar+=Ir+`
`;continue}const Rr=new LineParser(Ir,Cr+1);if(Rr.seekNonSpace(),Rr.isAtTheEnd())continue;const Pr=Rr.getToken();let Fr,Nr,Ur,Br,Or,Dr,Wr,$r,Yr,Qi,rs;switch(Pr){case"0":const Kr=Rr.getToken();if(Kr)switch(Kr){case"!LDRAW_ORG":hr=Rr.getToken();break;case"!COLOUR":Fr=rr.parseColorMetaDirective(Rr),Fr?lr[Fr.userData.code]=Fr:console.warn("LDrawLoader: Error parsing material"+Rr.getLineNumberString());break;case"!CATEGORY":fr=Rr.getToken();break;case"!KEYWORDS":const Ji=Rr.getRemainingString().split(",");Ji.length>0&&(ur||(ur=[]),Ji.forEach(function(ms){ur.push(ms.trim())}));break;case"FILE":Cr>0&&(dr=!0,vr=Rr.getRemainingString(),Ar="",yr=!1,wr=!0);break;case"BFC":for(;!Rr.isAtTheEnd();){const ms=Rr.getToken();switch(ms){case"CERTIFY":case"NOCERTIFY":yr=ms==="CERTIFY",wr=!0;break;case"CW":case"CCW":wr=ms==="CCW";break;case"INVERTNEXT":br=!0;break;case"CLIP":case"NOCLIP":Sr=ms==="CLIP";break;default:console.warn('THREE.LDrawLoader: BFC directive "'+ms+'" is unknown.');break}}break;case"STEP":xr=!0;break;case"Author:":pr=Rr.getToken();break;default:break}break;case"1":Nr=Rr.getToken(),Fr=cr(Nr);const Qr=parseFloat(Rr.getToken()),Vr=parseFloat(Rr.getToken()),Gr=parseFloat(Rr.getToken()),qr=parseFloat(Rr.getToken()),ji=parseFloat(Rr.getToken()),Zr=parseFloat(Rr.getToken()),Zi=parseFloat(Rr.getToken()),Yi=parseFloat(Rr.getToken()),qi=parseFloat(Rr.getToken()),Xr=parseFloat(Rr.getToken()),ns=parseFloat(Rr.getToken()),os=parseFloat(Rr.getToken()),us=new Matrix4().set(qr,ji,Zr,Qr,Zi,Yi,qi,Vr,Xr,ns,os,Gr,0,0,0,1);let is=Rr.getRemainingString().trim().replace(/\\/g,"/");rr.fileMap[is]?is=rr.fileMap[is]:is.startsWith("s/")?is="parts/"+is:is.startsWith("48/")&&(is="p/"+is),or.push({material:Fr,colorCode:Nr,matrix:us,fileName:is,inverted:br,startingBuildingStep:xr}),xr=!1,br=!1;break;case"2":Nr=Rr.getToken(),Fr=cr(Nr),Dr=Rr.getVector(),Wr=Rr.getVector(),Ur={material:Fr,colorCode:Nr,vertices:[Dr,Wr]},sr.push(Ur);break;case"5":Nr=Rr.getToken(),Fr=cr(Nr),Dr=Rr.getVector(),Wr=Rr.getVector(),Qi=Rr.getVector(),rs=Rr.getVector(),Ur={material:Fr,colorCode:Nr,vertices:[Dr,Wr],controlPoints:[Qi,rs]},ar.push(Ur);break;case"3":Nr=Rr.getToken(),Fr=cr(Nr),Br=wr,Or=!yr||!Sr,Br===!0?(Dr=Rr.getVector(),Wr=Rr.getVector(),$r=Rr.getVector()):($r=Rr.getVector(),Wr=Rr.getVector(),Dr=Rr.getVector()),nr.push({material:Fr,colorCode:Nr,faceNormal:null,vertices:[Dr,Wr,$r],normals:[null,null,null]}),gr++,Or===!0&&(nr.push({material:Fr,colorCode:Nr,faceNormal:null,vertices:[$r,Wr,Dr],normals:[null,null,null]}),gr++);break;case"4":Nr=Rr.getToken(),Fr=cr(Nr),Br=wr,Or=!yr||!Sr,Br===!0?(Dr=Rr.getVector(),Wr=Rr.getVector(),$r=Rr.getVector(),Yr=Rr.getVector()):(Yr=Rr.getVector(),$r=Rr.getVector(),Wr=Rr.getVector(),Dr=Rr.getVector()),nr.push({material:Fr,colorCode:Nr,faceNormal:null,vertices:[Dr,Wr,$r,Yr],normals:[null,null,null,null]}),gr+=2,Or===!0&&(nr.push({material:Fr,colorCode:Nr,faceNormal:null,vertices:[Yr,$r,Wr,Dr],normals:[null,null,null,null]}),gr+=2);break;default:throw new Error('LDrawLoader: Unknown line type "'+Pr+'"'+Rr.getLineNumberString()+".")}}return dr&&this.setData(vr,Ar),{faces:nr,conditionalSegments:ar,lineSegments:sr,type:hr,category:fr,keywords:ur,author:pr,subobjects:or,totalFaces:gr,startingBuildingStep:xr,materials:lr,fileName:tr,group:null}}getData(er,tr=!0){const rr=er.toLowerCase(),nr=this._cache[rr];return nr===null||nr instanceof Promise?null:tr?this.cloneResult(nr):nr}async ensureDataLoaded(er){const tr=er.toLowerCase();tr in this._cache||(this._cache[tr]=this.fetchData(er).then(rr=>{const nr=this.parse(rr,er);return this._cache[tr]=nr,nr})),await this._cache[tr]}setData(er,tr){const rr=er.toLowerCase();this._cache[rr]=this.parse(tr,er)}}function getMaterialFromCode(ir,er,tr,rr){return(!rr&&ir===MAIN_COLOUR_CODE||rr&&ir===MAIN_EDGE_COLOUR_CODE)&&(ir=er),tr[ir]||null}class LDrawPartsGeometryCache{constructor(er){this.loader=er,this.parseCache=new LDrawParsedCache(er),this._cache={}}async processIntoMesh(er){const tr=this.loader,rr=this.parseCache,nr=new Set,sr=async(or,lr=null)=>{const cr=or.subobjects,hr=[];for(let pr=0,gr=cr.length;pr<gr;pr++){const _r=cr[pr],mr=rr.ensureDataLoaded(_r.fileName).then(()=>{const dr=rr.getData(_r.fileName,!1);return isPrimitiveType(dr.type)?sr(rr.getData(_r.fileName),_r):this.loadModel(_r.fileName).catch(vr=>(console.warn(vr),null))});hr.push(mr)}const fr=new Group;fr.userData.category=or.category,fr.userData.keywords=or.keywords,fr.userData.author=or.author,fr.userData.type=or.type,fr.userData.fileName=or.fileName,or.group=fr;const ur=await Promise.all(hr);for(let pr=0,gr=ur.length;pr<gr;pr++){const _r=or.subobjects[pr],mr=ur[pr];if(mr===null)continue;if(mr.isGroup){const Pr=mr;_r.matrix.decompose(Pr.position,Pr.quaternion,Pr.scale),Pr.userData.startingBuildingStep=_r.startingBuildingStep,Pr.name=_r.fileName,tr.applyMaterialsToMesh(Pr,_r.colorCode,or.materials),Pr.userData.colorCode=_r.colorCode,fr.add(Pr);continue}mr.group.children.length&&fr.add(mr.group);const dr=or.lineSegments,vr=or.conditionalSegments,Ar=or.faces,yr=mr.lineSegments,wr=mr.conditionalSegments,br=mr.faces,Sr=_r.matrix,xr=_r.inverted,Cr=Sr.determinant()<0,Ir=_r.colorCode,Rr=Ir===MAIN_COLOUR_CODE?MAIN_EDGE_COLOUR_CODE:Ir;for(let Pr=0,Fr=yr.length;Pr<Fr;Pr++){const Nr=yr[Pr],Ur=Nr.vertices;Ur[0].applyMatrix4(Sr),Ur[1].applyMatrix4(Sr),Nr.colorCode=Nr.colorCode===MAIN_EDGE_COLOUR_CODE?Rr:Nr.colorCode,Nr.material=Nr.material||getMaterialFromCode(Nr.colorCode,Nr.colorCode,or.materials,!0),dr.push(Nr)}for(let Pr=0,Fr=wr.length;Pr<Fr;Pr++){const Nr=wr[Pr],Ur=Nr.vertices,Br=Nr.controlPoints;Ur[0].applyMatrix4(Sr),Ur[1].applyMatrix4(Sr),Br[0].applyMatrix4(Sr),Br[1].applyMatrix4(Sr),Nr.colorCode=Nr.colorCode===MAIN_EDGE_COLOUR_CODE?Rr:Nr.colorCode,Nr.material=Nr.material||getMaterialFromCode(Nr.colorCode,Nr.colorCode,or.materials,!0),vr.push(Nr)}for(let Pr=0,Fr=br.length;Pr<Fr;Pr++){const Nr=br[Pr],Ur=Nr.vertices;for(let Br=0,Or=Ur.length;Br<Or;Br++)Ur[Br].applyMatrix4(Sr);Nr.colorCode=Nr.colorCode===MAIN_COLOUR_CODE?Ir:Nr.colorCode,Nr.material=Nr.material||getMaterialFromCode(Nr.colorCode,Ir,or.materials,!1),nr.add(Nr.colorCode),Cr!==xr&&Ur.reverse(),Ar.push(Nr)}or.totalFaces+=mr.totalFaces}return lr&&(tr.applyMaterialsToMesh(fr,lr.colorCode,or.materials),fr.userData.colorCode=lr.colorCode),or};for(let or=0,lr=er.faces;or<lr;or++)nr.add(er.faces[or].colorCode);if(await sr(er),tr.smoothNormals){const or=nr.size>1;generateFaceNormals(er.faces),smoothNormals(er.faces,er.lineSegments,or)}const ar=er.group;return er.faces.length>0&&ar.add(createObject(this.loader,er.faces,3,!1,er.totalFaces)),er.lineSegments.length>0&&ar.add(createObject(this.loader,er.lineSegments,2)),er.conditionalSegments.length>0&&ar.add(createObject(this.loader,er.conditionalSegments,2,!0)),ar}hasCachedModel(er){return er!==null&&er.toLowerCase()in this._cache}async getCachedModel(er){if(er!==null&&this.hasCachedModel(er)){const tr=er.toLowerCase();return(await this._cache[tr]).clone()}else return null}async loadModel(er){const tr=this.parseCache,rr=er.toLowerCase();if(this.hasCachedModel(er))return this.getCachedModel(er);{await tr.ensureDataLoaded(er);const nr=tr.getData(er),sr=this.processIntoMesh(nr);return this.hasCachedModel(er)?this.getCachedModel(er):(isPartType(nr.type)&&(this._cache[rr]=sr),(await sr).clone())}}async parseModel(er){const rr=this.parseCache.parse(er);return isPartType(rr.type)&&this.hasCachedModel(rr.fileName)?this.getCachedModel(rr.fileName):this.processIntoMesh(rr)}}function sortByMaterial(ir,er){return ir.colorCode===er.colorCode?0:ir.colorCode<er.colorCode?-1:1}function createObject(ir,er,tr,rr=!1,nr=null){er.sort(sortByMaterial),nr===null&&(nr=er.length);const sr=new Float32Array(tr*nr*3),ar=tr===3?new Float32Array(tr*nr*3):null,or=[],lr=new Array(6),cr=new BufferGeometry;let hr=null,fr=0,ur=0,pr=0;for(let _r=0,mr=er.length;_r<mr;_r++){const dr=er[_r];let vr=dr.vertices;vr.length===4&&(lr[0]=vr[0],lr[1]=vr[1],lr[2]=vr[2],lr[3]=vr[0],lr[4]=vr[2],lr[5]=vr[3],vr=lr);for(let Ar=0,yr=vr.length;Ar<yr;Ar++){const wr=vr[Ar],br=pr+Ar*3;sr[br+0]=wr.x,sr[br+1]=wr.y,sr[br+2]=wr.z}if(tr===3){if(!dr.faceNormal){const yr=vr[0],wr=vr[1],br=vr[2];_tempVec0.subVectors(wr,yr),_tempVec1.subVectors(br,wr),dr.faceNormal=new Vector3$1().crossVectors(_tempVec0,_tempVec1).normalize()}let Ar=dr.normals;Ar.length===4&&(lr[0]=Ar[0],lr[1]=Ar[1],lr[2]=Ar[2],lr[3]=Ar[0],lr[4]=Ar[2],lr[5]=Ar[3],Ar=lr);for(let yr=0,wr=Ar.length;yr<wr;yr++){let br=dr.faceNormal;Ar[yr]&&(br=Ar[yr].norm);const Sr=pr+yr*3;ar[Sr+0]=br.x,ar[Sr+1]=br.y,ar[Sr+2]=br.z}}if(hr!==dr.colorCode){hr!==null&&cr.addGroup(fr,ur,or.length-1);const Ar=dr.material;if(Ar!==null){if(tr===3)or.push(Ar);else if(tr===2)if(rr){const yr=ir.edgeMaterialCache.get(Ar);or.push(ir.conditionalEdgeMaterialCache.get(yr))}else or.push(ir.edgeMaterialCache.get(Ar))}else or.push(dr.colorCode);hr=dr.colorCode,fr=pr/3,ur=vr.length}else ur+=vr.length;pr+=3*vr.length}ur>0&&cr.addGroup(fr,1/0,or.length-1),cr.setAttribute("position",new BufferAttribute(sr,3)),ar!==null&&cr.setAttribute("normal",new BufferAttribute(ar,3));let gr=null;if(tr===2?rr?gr=new ConditionalLineSegments(cr,or.length===1?or[0]:or):gr=new LineSegments(cr,or.length===1?or[0]:or):tr===3&&(gr=new Mesh(cr,or.length===1?or[0]:or)),rr){gr.isConditionalLine=!0;const _r=new Float32Array(er.length*3*2),mr=new Float32Array(er.length*3*2),dr=new Float32Array(er.length*3*2);for(let vr=0,Ar=er.length;vr<Ar;vr++){const yr=er[vr],wr=yr.vertices,br=yr.controlPoints,Sr=br[0],xr=br[1],Cr=wr[0],Ir=wr[1],Rr=vr*3*2;_r[Rr+0]=Sr.x,_r[Rr+1]=Sr.y,_r[Rr+2]=Sr.z,_r[Rr+3]=Sr.x,_r[Rr+4]=Sr.y,_r[Rr+5]=Sr.z,mr[Rr+0]=xr.x,mr[Rr+1]=xr.y,mr[Rr+2]=xr.z,mr[Rr+3]=xr.x,mr[Rr+4]=xr.y,mr[Rr+5]=xr.z,dr[Rr+0]=Ir.x-Cr.x,dr[Rr+1]=Ir.y-Cr.y,dr[Rr+2]=Ir.z-Cr.z,dr[Rr+3]=Ir.x-Cr.x,dr[Rr+4]=Ir.y-Cr.y,dr[Rr+5]=Ir.z-Cr.z}cr.setAttribute("control0",new BufferAttribute(_r,3,!1)),cr.setAttribute("control1",new BufferAttribute(mr,3,!1)),cr.setAttribute("direction",new BufferAttribute(dr,3,!1))}return gr}class LDrawLoader extends Loader{constructor(er){super(er),this.materials=[],this.materialLibrary={},this.edgeMaterialCache=new WeakMap,this.conditionalEdgeMaterialCache=new WeakMap,this.partsCache=new LDrawPartsGeometryCache(this),this.fileMap={},this.smoothNormals=!0,this.partsLibraryPath="",this.ConditionalLineMaterial=null,this.missingColorMaterial=new MeshStandardMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16711935,roughness:.3,metalness:0}),this.missingEdgeColorMaterial=new LineBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16711935}),this.missingConditionalEdgeColorMaterial=null,this.edgeMaterialCache.set(this.missingColorMaterial,this.missingEdgeColorMaterial),this.conditionalEdgeMaterialCache.set(this.missingEdgeColorMaterial,this.missingConditionalEdgeColorMaterial)}setPartsLibraryPath(er){return this.partsLibraryPath=er,this}setConditionalLineMaterial(er){return this.ConditionalLineMaterial=er,this.missingConditionalEdgeColorMaterial=new this.ConditionalLineMaterial({name:Loader.DEFAULT_MATERIAL_NAME,fog:!0,color:16711935}),this}async preloadMaterials(er){const tr=new FileLoader(this.manager);tr.setPath(this.path),tr.setRequestHeader(this.requestHeader),tr.setWithCredentials(this.withCredentials);const rr=await tr.loadAsync(er),nr=/^0 !COLOUR/,sr=rr.split(/[\n\r]/g),ar=[];for(let or=0,lr=sr.length;or<lr;or++){const cr=sr[or];if(nr.test(cr)){const hr=cr.replace(nr,""),fr=this.parseColorMetaDirective(new LineParser(hr));ar.push(fr)}}this.setMaterials(ar)}load(er,tr,rr,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setRequestHeader(this.requestHeader),sr.setWithCredentials(this.withCredentials),sr.load(er,ar=>{this.setMaterials([]),this.partsCache.parseModel(ar,this.materialLibrary).then(or=>{this.applyMaterialsToMesh(or,MAIN_COLOUR_CODE,this.materialLibrary,!0),this.computeBuildingSteps(or),or.userData.fileName=er,tr(or)}).catch(nr)},rr,nr)}parse(er,tr,rr){this.partsCache.parseModel(er,this.materialLibrary).then(nr=>{this.applyMaterialsToMesh(nr,MAIN_COLOUR_CODE,this.materialLibrary,!0),this.computeBuildingSteps(nr),nr.userData.fileName="",tr(nr)}).catch(rr)}setMaterials(er){this.materialLibrary={},this.materials=[];for(let tr=0,rr=er.length;tr<rr;tr++)this.addMaterial(er[tr]);return this.addMaterial(this.parseColorMetaDirective(new LineParser("Main_Colour CODE 16 VALUE #FF8080 EDGE #333333"))),this.addMaterial(this.parseColorMetaDirective(new LineParser("Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333"))),this}setFileMap(er){return this.fileMap=er,this}addMaterial(er){const tr=this.materialLibrary;return tr[er.userData.code]||(this.materials.push(er),tr[er.userData.code]=er),this}getMaterial(er){if(er.startsWith("0x2")){const tr=er.substring(3);return this.parseColorMetaDirective(new LineParser("Direct_Color_"+tr+" CODE -1 VALUE #"+tr+" EDGE #"+tr))}return this.materialLibrary[er]||null}applyMaterialsToMesh(er,tr,rr,nr=!1){const sr=this,ar=tr===MAIN_COLOUR_CODE;er.traverse(lr=>{if(lr.isMesh||lr.isLineSegments)if(Array.isArray(lr.material))for(let cr=0,hr=lr.material.length;cr<hr;cr++)lr.material[cr].isMaterial||(lr.material[cr]=or(lr,lr.material[cr]));else lr.material.isMaterial||(lr.material=or(lr,lr.material))});function or(lr,cr){if(ar&&!(cr in rr)&&!nr)return cr;const hr=lr.isLineSegments||lr.isConditionalLine;(!hr&&cr===MAIN_COLOUR_CODE||hr&&cr===MAIN_EDGE_COLOUR_CODE)&&(cr=tr);let ur=null;if(cr in rr)ur=rr[cr];else if(nr)ur=sr.getMaterial(cr),ur===null&&(console.warn(`LDrawLoader: Material properties for code ${cr} not available.`),ur=sr.missingColorMaterial);else return cr;return lr.isLineSegments&&(ur=sr.edgeMaterialCache.get(ur),lr.isConditionalLine&&(ur=sr.conditionalEdgeMaterialCache.get(ur))),ur}}getMainMaterial(){return this.getMaterial(MAIN_COLOUR_CODE)}getMainEdgeMaterial(){const er=this.getMaterial(MAIN_EDGE_COLOUR_CODE);return er?this.edgeMaterialCache.get(er):null}parseColorMetaDirective(er){let tr=null,rr="#FF00FF",nr="#FF00FF",sr=1,ar=!1,or=0,lr=FINISH_TYPE_DEFAULT,cr=null;const hr=er.getToken();if(!hr)throw new Error('LDrawLoader: Material name was expected after "!COLOUR tag'+er.getLineNumberString()+".");let fr=null;for(;fr=er.getToken(),!!fr;)if(!pr(fr))switch(fr.toUpperCase()){case"CODE":tr=er.getToken();break;case"VALUE":if(rr=er.getToken(),rr.startsWith("0x"))rr="#"+rr.substring(2);else if(!rr.startsWith("#"))throw new Error("LDrawLoader: Invalid color while parsing material"+er.getLineNumberString()+".");break;case"EDGE":if(nr=er.getToken(),nr.startsWith("0x"))nr="#"+nr.substring(2);else if(!nr.startsWith("#")){if(cr=this.getMaterial(nr),!cr)throw new Error("LDrawLoader: Invalid edge color while parsing material"+er.getLineNumberString()+".");cr=this.edgeMaterialCache.get(cr)}break;case"ALPHA":if(sr=parseInt(er.getToken()),isNaN(sr))throw new Error("LDrawLoader: Invalid alpha value in material definition"+er.getLineNumberString()+".");sr=Math.max(0,Math.min(1,sr/255)),sr<1&&(ar=!0);break;case"LUMINANCE":if(!pr(er.getToken()))throw new Error("LDrawLoader: Invalid luminance value in material definition"+LineParser.getLineNumberString()+".");break;case"CHROME":lr=FINISH_TYPE_CHROME;break;case"PEARLESCENT":lr=FINISH_TYPE_PEARLESCENT;break;case"RUBBER":lr=FINISH_TYPE_RUBBER;break;case"MATTE_METALLIC":lr=FINISH_TYPE_MATTE_METALLIC;break;case"METAL":lr=FINISH_TYPE_METAL;break;case"MATERIAL":er.setToEnd();break;default:throw new Error('LDrawLoader: Unknown token "'+fr+'" while parsing material'+er.getLineNumberString()+".")}let ur=null;switch(lr){case FINISH_TYPE_DEFAULT:ur=new MeshStandardMaterial({roughness:.3,metalness:0});break;case FINISH_TYPE_PEARLESCENT:ur=new MeshStandardMaterial({roughness:.3,metalness:.25});break;case FINISH_TYPE_CHROME:ur=new MeshStandardMaterial({roughness:0,metalness:1});break;case FINISH_TYPE_RUBBER:ur=new MeshStandardMaterial({roughness:.9,metalness:0});break;case FINISH_TYPE_MATTE_METALLIC:ur=new MeshStandardMaterial({roughness:.8,metalness:.4});break;case FINISH_TYPE_METAL:ur=new MeshStandardMaterial({roughness:.2,metalness:.85});break;default:break}if(ur.color.setStyle(rr,COLOR_SPACE_LDRAW),ur.transparent=ar,ur.premultipliedAlpha=!0,ur.opacity=sr,ur.depthWrite=!ar,ur.polygonOffset=!0,ur.polygonOffsetFactor=1,or!==0&&ur.emissive.setStyle(rr,COLOR_SPACE_LDRAW).multiplyScalar(or),!cr){if(cr=new LineBasicMaterial({color:new Color().setStyle(nr,COLOR_SPACE_LDRAW),transparent:ar,opacity:sr,depthWrite:!ar}),cr.color,cr.userData.code=tr,cr.name=hr+" - Edge",this.ConditionalLineMaterial===null)throw new Error("THREE.LDrawLoader: ConditionalLineMaterial type must be specified via .setConditionalLineMaterial().");const gr=new this.ConditionalLineMaterial({fog:!0,transparent:ar,depthWrite:!ar,color:new Color().setStyle(nr,COLOR_SPACE_LDRAW),opacity:sr});gr.userData.code=tr,gr.name=hr+" - Conditional Edge",this.conditionalEdgeMaterialCache.set(cr,gr)}return ur.userData.code=tr,ur.name=hr,this.edgeMaterialCache.set(ur,cr),this.addMaterial(ur),ur;function pr(gr){let _r;return gr.startsWith("LUMINANCE")?_r=parseInt(gr.substring(9)):_r=parseInt(gr),isNaN(_r)?!1:(or=Math.max(0,Math.min(1,_r/255)),!0)}}computeBuildingSteps(er){let tr=0;er.traverse(rr=>{rr.isGroup&&(rr.userData.startingBuildingStep&&tr++,rr.userData.buildingStep=tr)}),er.userData.numBuildingSteps=tr+1}}class LUT3dlLoader extends Loader{constructor(er){super(er),this.type=UnsignedByteType}setType(er){if(er!==UnsignedByteType&&er!==FloatType)throw new Error("LUT3dlLoader: Unsupported type");return this.type=er,this}load(er,tr,rr,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setResponseType("text"),sr.load(er,ar=>{try{tr(this.parse(ar))}catch(or){nr?nr(or):console.error(or),this.manager.itemError(er)}},rr,nr)}parse(er){const tr=/^[\d ]+$/m,rr=/^([\d.e+-]+) +([\d.e+-]+) +([\d.e+-]+) *$/gm;let nr=tr.exec(er);if(nr===null)throw new Error("LUT3dlLoader: Missing grid information");const sr=nr[0].trim().split(/\s+/g).map(Number),ar=sr[1]-sr[0],or=sr.length,lr=or**2;for(let dr=1,vr=sr.length;dr<vr;++dr)if(ar!==sr[dr]-sr[dr-1])throw new Error("LUT3dlLoader: Inconsistent grid size");const cr=new Float32Array(or**3*4);let hr=0,fr=0;for(;(nr=rr.exec(er))!==null;){const dr=Number(nr[1]),vr=Number(nr[2]),Ar=Number(nr[3]);hr=Math.max(hr,dr,vr,Ar);const yr=fr%or,wr=Math.floor(fr/or)%or,br=Math.floor(fr/lr)%or,Sr=(yr*lr+wr*or+br)*4;cr[Sr+0]=dr,cr[Sr+1]=vr,cr[Sr+2]=Ar,++fr}const ur=Math.ceil(Math.log2(hr)),pr=Math.pow(2,ur),gr=this.type===UnsignedByteType?new Uint8Array(cr.length):cr,_r=this.type===UnsignedByteType?255:1;for(let dr=0,vr=gr.length;dr<vr;dr+=4){const Ar=dr+1,yr=dr+2,wr=dr+3;gr[dr]=cr[dr]/pr*_r,gr[Ar]=cr[Ar]/pr*_r,gr[yr]=cr[yr]/pr*_r,gr[wr]=_r}const mr=new Data3DTexture;return mr.image.data=gr,mr.image.width=or,mr.image.height=or,mr.image.depth=or,mr.format=RGBAFormat,mr.type=this.type,mr.magFilter=LinearFilter,mr.minFilter=LinearFilter,mr.wrapS=ClampToEdgeWrapping,mr.wrapT=ClampToEdgeWrapping,mr.wrapR=ClampToEdgeWrapping,mr.generateMipmaps=!1,mr.needsUpdate=!0,{size:or,texture3D:mr}}}class LUTCubeLoader extends Loader{constructor(er){super(er),this.type=UnsignedByteType}setType(er){if(er!==UnsignedByteType&&er!==FloatType)throw new Error("LUTCubeLoader: Unsupported type");return this.type=er,this}load(er,tr,rr,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setResponseType("text"),sr.load(er,ar=>{try{tr(this.parse(ar))}catch(or){nr?nr(or):console.error(or),this.manager.itemError(er)}},rr,nr)}parse(er){const tr=/TITLE +"([^"]*)"/,rr=/LUT_3D_SIZE +(\d+)/,nr=/DOMAIN_MIN +([\d.]+) +([\d.]+) +([\d.]+)/,sr=/DOMAIN_MAX +([\d.]+) +([\d.]+) +([\d.]+)/,ar=/^([\d.e+-]+) +([\d.e+-]+) +([\d.e+-]+) *$/gm;let or=tr.exec(er);const lr=or!==null?or[1]:null;if(or=rr.exec(er),or===null)throw new Error("LUTCubeLoader: Missing LUT_3D_SIZE information");const cr=Number(or[1]),hr=cr**3*4,fr=this.type===UnsignedByteType?new Uint8Array(hr):new Float32Array(hr),ur=new Vector3$1(0,0,0),pr=new Vector3$1(1,1,1);if(or=nr.exec(er),or!==null&&ur.set(Number(or[1]),Number(or[2]),Number(or[3])),or=sr.exec(er),or!==null&&pr.set(Number(or[1]),Number(or[2]),Number(or[3])),ur.x>pr.x||ur.y>pr.y||ur.z>pr.z)throw new Error("LUTCubeLoader: Invalid input domain");const gr=this.type===UnsignedByteType?255:1;let _r=0;for(;(or=ar.exec(er))!==null;)fr[_r++]=Number(or[1])*gr,fr[_r++]=Number(or[2])*gr,fr[_r++]=Number(or[3])*gr,fr[_r++]=gr;const mr=new Data3DTexture;return mr.image.data=fr,mr.image.width=cr,mr.image.height=cr,mr.image.depth=cr,mr.type=this.type,mr.magFilter=LinearFilter,mr.minFilter=LinearFilter,mr.wrapS=ClampToEdgeWrapping,mr.wrapT=ClampToEdgeWrapping,mr.wrapR=ClampToEdgeWrapping,mr.generateMipmaps=!1,mr.needsUpdate=!0,{title:lr,size:cr,domainMin:ur,domainMax:pr,texture3D:mr}}}class LWO2Parser{constructor(er){this.IFF=er}parseBlock(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();const er=this.IFF.reader.getIDTag();let tr=this.IFF.reader.getUint32();switch(tr>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,tr=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=tr,er){case"FORM":this.IFF.parseForm(tr);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(tr);break;case"SURF":this.IFF.parseSurfaceLwo2(tr);break;case"CLIP":this.IFF.parseClipLwo2(tr);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":tr===4?this.IFF.currentNode[er]=this.IFF.reader.getInt32():this.IFF.reader.skip(tr);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(tr);break;case"PNTS":this.IFF.parsePoints(tr);break;case"VMAP":this.IFF.parseVertexMapping(tr);break;case"AUVU":case"AUVN":this.IFF.reader.skip(tr-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(tr);break;case"TAGS":this.IFF.parseTagStrings(tr);break;case"PTAG":this.IFF.parsePolygonTagMapping(tr);break;case"VMAD":this.IFF.parseVertexMapping(tr,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":const rr=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=rr;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":tr===4?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(tr);break;case"SMAN":const nr=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(nr<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(tr);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(tr);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(er,tr)}er!="FORM"&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=er,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}}class LWO3Parser{constructor(er){this.IFF=er}parseBlock(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();const er=this.IFF.reader.getIDTag(),tr=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=tr,er){case"FORM":this.IFF.parseForm(tr);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(tr);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":tr===4?this.IFF.currentNode[er]=this.IFF.reader.getInt32():this.IFF.reader.skip(tr);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(tr);break;case"PNTS":this.IFF.parsePoints(tr);break;case"VMAP":this.IFF.parseVertexMapping(tr);break;case"POLS":this.IFF.parsePolygonList(tr);break;case"TAGS":this.IFF.parseTagStrings(tr);break;case"PTAG":this.IFF.parsePolygonTagMapping(tr);break;case"VMAD":this.IFF.parseVertexMapping(tr,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":const rr=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=rr;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":tr===4?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(tr);break;case"SMAN":const nr=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(nr<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(tr);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(er,tr)}er!="FORM"&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=er,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}}class IFFParser{constructor(){this.debugger=new Debugger}parse(er){if(this.reader=new DataViewReader(er),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),this.tree.format!==void 0){if(this.tree.format==="LWO2")for(this.parser=new LWO2Parser(this);!this.reader.endOfFile();)this.parser.parseBlock();else if(this.tree.format==="LWO3")for(this.parser=new LWO3Parser(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}}parseTopForm(){this.debugger.offset=this.reader.offset;var er=this.reader.getIDTag();if(er!=="FORM"){console.warn("LWOLoader: Top-level FORM missing.");return}var tr=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=tr;var rr=this.reader.getIDTag();rr==="LWO2"?this.tree.format=rr:rr==="LWO3"&&(this.tree.format=rr),this.debugger.node=0,this.debugger.nodeID=rr,this.debugger.log()}parseForm(er){var tr=this.reader.getIDTag();switch(tr){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(er);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(tr);break;case"ENVL":this.parseEnvelope(er);break;case"CLIP":this.tree.format==="LWO2"?this.parseForm(er):this.parseClip(er);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(er);break;case"SURF":this.parseSurfaceForm(er);break;case"VALU":this.parseValueForm(er);break;case"NTAG":this.parseSubNode(er);break;case"ATTR":case"SATR":this.setupForm("attributes",er);break;case"NCON":this.parseConnections(er);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",er);break;case"SSHD":this.setupForm("surfaceShaderData",er);break;case"ENTR":this.parseEntryForm(er);break;case"IMAP":this.parseImageMap(er);break;case"TAMP":this.parseXVAL("amplitude",er);break;case"TMAP":this.setupForm("textureMap",er);break;case"CNTR":this.parseXVAL3("center",er);break;case"SIZE":this.parseXVAL3("scale",er);break;case"ROTA":this.parseXVAL3("rotation",er);break;default:this.parseUnknownForm(tr,er)}this.debugger.node=0,this.debugger.nodeID=tr,this.debugger.log()}setupForm(er,tr){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+tr,this.parentForm=this.currentForm,this.currentForm[er]?(console.warn("LWOLoader: form already exists on parent: ",er,this.currentForm),this.currentForm=this.currentForm[er]):(this.currentForm[er]={},this.currentForm=this.currentForm[er])}skipForm(er){this.reader.skip(er-4)}parseUnknownForm(er,tr){console.warn("LWOLoader: unknown FORM encountered: "+er,tr),printBuffer(this.reader.dv.buffer,this.reader.offset,tr-4),this.reader.skip(tr-4)}parseSurfaceForm(er){this.reader.skip(8);var tr=this.reader.getString(),rr={attributes:{},connections:{},name:tr,inputName:tr,nodes:{},source:this.reader.getString()};this.tree.materials[tr]=rr,this.currentSurface=rr,this.parentForm=this.tree.materials,this.currentForm=rr,this.currentFormEnd=this.reader.offset+er}parseSurfaceLwo2(er){var tr=this.reader.getString(),rr={attributes:{},connections:{},name:tr,nodes:{},source:this.reader.getString()};this.tree.materials[tr]=rr,this.currentSurface=rr,this.parentForm=this.tree.materials,this.currentForm=rr,this.currentFormEnd=this.reader.offset+er}parseSubNode(er){this.reader.skip(8);var tr=this.reader.getString(),rr={name:tr};this.currentForm=rr,this.currentNode=rr,this.currentFormEnd=this.reader.offset+er}parseConnections(er){this.currentFormEnd=this.reader.offset+er,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections}parseEntryForm(er){this.reader.skip(8);var tr=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(tr,er)}parseValueForm(){this.reader.skip(8);var er=this.reader.getString();er==="double"?this.currentForm.value=this.reader.getUint64():er==="int"?this.currentForm.value=this.reader.getUint32():er==="vparam"?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):er==="vparam3"&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))}parseImageStateForm(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()}parseImageMap(er){this.currentFormEnd=this.reader.offset+er,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var tr={};this.currentForm.maps.push(tr),this.currentForm=tr,this.reader.skip(10)}parseTextureNodeAttribute(er){switch(this.reader.skip(28),this.reader.skip(20),er){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32();break}this.reader.skip(2)}parseEnvelope(er){this.reader.skip(er-4)}parseClip(er){var tr=this.reader.getIDTag();if(tr==="FORM"){this.reader.skip(16),this.currentNode.fileName=this.reader.getString();return}this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+er,this.parentForm=this.currentForm,this.reader.skip(8);var rr={index:this.reader.getUint32()};this.tree.textures.push(rr),this.currentForm=rr}parseClipLwo2(er){for(var tr={index:this.reader.getUint32(),fileName:""};;){var rr=this.reader.getIDTag(),nr=this.reader.getUint16();if(rr==="STIL"){tr.fileName=this.reader.getString();break}if(nr>=er)break}this.tree.textures.push(tr),this.currentForm=tr}parseImage(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()}parseXVAL(er,tr){var rr=this.reader.offset+tr-4;this.reader.skip(8),this.currentForm[er]=this.reader.getFloat32(),this.reader.setOffset(rr)}parseXVAL3(er,tr){var rr=this.reader.offset+tr-4;this.reader.skip(8),this.currentForm[er]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(rr)}parseObjectTag(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}}parseLayer(er){var tr=this.reader.getUint16(),rr=this.reader.getUint16(),nr=this.reader.getFloat32Array(3),sr={number:tr,flags:rr,pivot:[-nr[0],nr[1],nr[2]],name:this.reader.getString()};this.tree.layers.push(sr),this.currentLayer=sr;var ar=16+stringOffset(this.currentLayer.name);this.currentLayer.parent=ar<er?this.reader.getUint16():-1}parsePoints(er){this.currentPoints=[];for(var tr=0;tr<er/4;tr+=3)this.currentPoints.push(-this.reader.getFloat32(),this.reader.getFloat32(),this.reader.getFloat32())}parseVertexMapping(er,tr){var rr=this.reader.offset+er,nr=this.reader.getString();if(this.reader.offset===rr){this.currentForm.UVChannel=nr;return}this.reader.setOffset(this.reader.offset-stringOffset(nr));var sr=this.reader.getIDTag();this.reader.getUint16();var ar=this.reader.getString(),or=er-6-stringOffset(ar);switch(sr){case"TXUV":this.parseUVMapping(ar,rr,tr);break;case"MORF":case"SPOT":this.parseMorphTargets(ar,rr,sr);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(or);break;default:console.warn("LWOLoader: unknown vertex map type: "+sr),this.reader.skip(or)}}parseUVMapping(er,tr,rr){for(var nr=[],sr=[],ar=[];this.reader.offset<tr;)nr.push(this.reader.getVariableLengthIndex()),rr&&sr.push(this.reader.getVariableLengthIndex()),ar.push(this.reader.getFloat32(),this.reader.getFloat32());rr?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[er]={uvIndices:nr,polyIndices:sr,uvs:ar}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[er]={uvIndices:nr,uvs:ar})}parseMorphTargets(er,tr,rr){var nr=[],sr=[];for(rr=rr==="MORF"?"relative":"absolute";this.reader.offset<tr;)nr.push(this.reader.getVariableLengthIndex()),sr.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[er]={indices:nr,points:sr,type:rr}}parsePolygonList(er){for(var tr=this.reader.offset+er,rr=this.reader.getIDTag(),nr=[],sr=[];this.reader.offset<tr;){var ar=this.reader.getUint16();ar=ar&1023,sr.push(ar);for(var or=0;or<ar;or++)nr.push(this.reader.getVariableLengthIndex())}var lr={type:rr,vertexIndices:nr,polygonDimensions:sr,points:this.currentPoints};sr[0]===1?lr.type="points":sr[0]===2&&(lr.type="lines"),this.currentLayer.geometry=lr}parseTagStrings(er){this.tree.tags=this.reader.getStringArray(er)}parsePolygonTagMapping(er){var tr=this.reader.offset+er,rr=this.reader.getIDTag();rr==="SURF"?this.parseMaterialIndices(tr):this.reader.skip(er-4)}parseMaterialIndices(er){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<er;){var tr=this.reader.getVariableLengthIndex(),rr=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(tr,rr)}}parseUnknownCHUNK(er,tr){console.warn("LWOLoader: unknown chunk type: "+er+" length: "+tr);var rr=this.reader.getString(tr);this.currentForm[er]=rr}}class DataViewReader{constructor(er){this.dv=new DataView(er),this.offset=0,this._textDecoder=new TextDecoder,this._bytes=new Uint8Array(er)}size(){return this.dv.buffer.byteLength}setOffset(er){er>0&&er<this.dv.buffer.byteLength?this.offset=er:console.error("LWOLoader: invalid buffer offset")}endOfFile(){return this.offset>=this.size()}skip(er){this.offset+=er}getUint8(){var er=this.dv.getUint8(this.offset);return this.offset+=1,er}getUint16(){var er=this.dv.getUint16(this.offset);return this.offset+=2,er}getInt32(){var er=this.dv.getInt32(this.offset,!1);return this.offset+=4,er}getUint32(){var er=this.dv.getUint32(this.offset,!1);return this.offset+=4,er}getUint64(){var er,tr;return tr=this.getUint32(),er=this.getUint32(),tr*4294967296+er}getFloat32(){var er=this.dv.getFloat32(this.offset,!1);return this.offset+=4,er}getFloat32Array(er){for(var tr=[],rr=0;rr<er;rr++)tr.push(this.getFloat32());return tr}getFloat64(){var er=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,er}getFloat64Array(er){for(var tr=[],rr=0;rr<er;rr++)tr.push(this.getFloat64());return tr}getVariableLengthIndex(){var er=this.getUint8();return er===255?this.getUint8()*65536+this.getUint8()*256+this.getUint8():er*256+this.getUint8()}getIDTag(){return this.getString(4)}getString(er){if(er===0)return;const tr=this.offset;let rr,nr;return er?(nr=er,rr=this._textDecoder.decode(new Uint8Array(this.dv.buffer,tr,er))):(nr=this._bytes.indexOf(0,tr)-tr,rr=this._textDecoder.decode(new Uint8Array(this.dv.buffer,tr,nr)),nr++,nr+=nr%2),this.skip(nr),rr}getStringArray(er){var tr=this.getString(er);return tr=tr.split("\0"),tr.filter(Boolean)}}class Debugger{constructor(){this.active=!1,this.depth=0,this.formList=[]}enable(){this.active=!0}log(){if(this.active){var er;switch(this.node){case 0:er="FORM";break;case 1:er="CHK";break;case 2:er="S-CHK";break}console.log("| ".repeat(this.depth)+er,this.nodeID,`( ${this.offset} ) -> ( ${this.dataOffset+this.length} )`,this.node==0?" {":"",this.skipped?"SKIPPED":"",this.node==0&&this.skipped?"}":""),this.node==0&&!this.skipped&&(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}}closeForms(){if(this.active)for(var er=this.formList.length-1;er>=0;er--)this.offset>=this.formList[er]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}}function isEven(ir){return ir%2}function stringOffset(ir){return ir.length+1+(isEven(ir.length+1)?1:0)}function printBuffer(ir,er,tr){console.log(new TextDecoder().decode(new Uint8Array(ir,er,tr)))}let _lwoTree;class LWOLoader extends Loader{constructor(er,tr={}){super(er),this.resourcePath=tr.resourcePath!==void 0?tr.resourcePath:""}load(er,tr,rr,nr){const sr=this,ar=sr.path===""?extractParentUrl(er,"Objects"):sr.path,or=er.split(ar).pop().split(".")[0],lr=new FileLoader(this.manager);lr.setPath(sr.path),lr.setResponseType("arraybuffer"),lr.load(er,function(cr){try{tr(sr.parse(cr,ar,or))}catch(hr){nr?nr(hr):console.error(hr),sr.manager.itemError(er)}},rr,nr)}parse(er,tr,rr){_lwoTree=new IFFParser().parse(er);const nr=new TextureLoader(this.manager).setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin);return new LWOTreeParser(nr).parse(rr)}}class LWOTreeParser{constructor(er){this.textureLoader=er}parse(er){return this.materials=new MaterialParser(this.textureLoader).parse(),this.defaultLayerName=er,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}}parseLayers(){const er=[],tr=[],rr=new GeometryParser,nr=this;return _lwoTree.layers.forEach(function(sr){const ar=rr.parse(sr.geometry,sr),or=nr.parseMesh(ar,sr);er[sr.number]=or,sr.parent===-1?tr.push(or):er[sr.parent].add(or)}),this.applyPivots(tr),tr}parseMesh(er,tr){let rr;const nr=this.getMaterials(er.userData.matNames,tr.geometry.type);return tr.geometry.type==="points"?rr=new Points(er,nr):tr.geometry.type==="lines"?rr=new LineSegments(er,nr):rr=new Mesh(er,nr),tr.name?rr.name=tr.name:rr.name=this.defaultLayerName+"_layer_"+tr.number,rr.userData.pivot=tr.pivot,rr}applyPivots(er){er.forEach(function(tr){tr.traverse(function(rr){const nr=rr.userData.pivot;if(rr.position.x+=nr[0],rr.position.y+=nr[1],rr.position.z+=nr[2],rr.parent){const sr=rr.parent.userData.pivot;rr.position.x-=sr[0],rr.position.y-=sr[1],rr.position.z-=sr[2]}})})}getMaterials(er,tr){const rr=[],nr=this;er.forEach(function(ar,or){rr[or]=nr.getMaterialByName(ar)}),(tr==="points"||tr==="lines")&&rr.forEach(function(ar,or){const lr={color:ar.color};tr==="points"?(lr.size=.1,lr.map=ar.map,rr[or]=new PointsMaterial(lr)):tr==="lines"&&(rr[or]=new LineBasicMaterial(lr))});const sr=rr.filter(Boolean);return sr.length===1?sr[0]:rr}getMaterialByName(er){return this.materials.filter(function(tr){return tr.name===er})[0]}}class MaterialParser{constructor(er){this.textureLoader=er}parse(){const er=[];this.textures={};for(const tr in _lwoTree.materials)_lwoTree.format==="LWO3"?er.push(this.parseMaterial(_lwoTree.materials[tr],tr,_lwoTree.textures)):_lwoTree.format==="LWO2"&&er.push(this.parseMaterialLwo2(_lwoTree.materials[tr],tr,_lwoTree.textures));return er}parseMaterial(er,tr,rr){let nr={name:tr,side:this.getSide(er.attributes),flatShading:this.getSmooth(er.attributes)};const sr=this.parseConnections(er.connections,er.nodes),ar=this.parseTextureNodes(sr.maps);this.parseAttributeImageMaps(sr.attributes,rr,ar,er.maps);const or=this.parseAttributes(sr.attributes,ar);this.parseEnvMap(sr,ar,or),nr=Object.assign(ar,nr),nr=Object.assign(nr,or);const lr=this.getMaterialType(sr.attributes);return lr!==MeshPhongMaterial&&delete nr.refractionRatio,new lr(nr)}parseMaterialLwo2(er,tr){let rr={name:tr,side:this.getSide(er.attributes),flatShading:this.getSmooth(er.attributes)};const nr=this.parseAttributes(er.attributes,{});return rr=Object.assign(rr,nr),new MeshPhongMaterial(rr)}getSide(er){if(!er.side)return BackSide;switch(er.side){case 0:case 1:return BackSide;case 2:return FrontSide;case 3:return DoubleSide}}getSmooth(er){return er.smooth?!er.smooth:!0}parseConnections(er,tr){const rr={maps:{}},nr=er.inputName,sr=er.inputNodeName,ar=er.nodeName,or=this;return nr.forEach(function(lr,cr){if(lr==="Material"){const hr=or.getNodeByRefName(sr[cr],tr);rr.attributes=hr.attributes,rr.envMap=hr.fileName,rr.name=sr[cr]}}),ar.forEach(function(lr,cr){lr===rr.name&&(rr.maps[nr[cr]]=or.getNodeByRefName(sr[cr],tr))}),rr}getNodeByRefName(er,tr){for(const rr in tr)if(tr[rr].refName===er)return tr[rr]}parseTextureNodes(er){const tr={};for(const rr in er){const nr=er[rr],sr=nr.fileName;if(!sr)return;const ar=this.loadTexture(sr);switch(nr.widthWrappingMode!==void 0&&(ar.wrapS=this.getWrappingType(nr.widthWrappingMode)),nr.heightWrappingMode!==void 0&&(ar.wrapT=this.getWrappingType(nr.heightWrappingMode)),rr){case"Color":tr.map=ar,tr.map.colorSpace=SRGBColorSpace;break;case"Roughness":tr.roughnessMap=ar,tr.roughness=1;break;case"Specular":tr.specularMap=ar,tr.specularMap.colorSpace=SRGBColorSpace,tr.specular=16777215;break;case"Luminous":tr.emissiveMap=ar,tr.emissiveMap.colorSpace=SRGBColorSpace,tr.emissive=8421504;break;case"Luminous Color":tr.emissive=8421504;break;case"Metallic":tr.metalnessMap=ar,tr.metalness=1;break;case"Transparency":case"Alpha":tr.alphaMap=ar,tr.transparent=!0;break;case"Normal":tr.normalMap=ar,nr.amplitude!==void 0&&(tr.normalScale=new Vector2(nr.amplitude,nr.amplitude));break;case"Bump":tr.bumpMap=ar;break}}return tr.roughnessMap&&tr.specularMap&&delete tr.specularMap,tr}parseAttributeImageMaps(er,tr,rr){for(const nr in er){const sr=er[nr];if(sr.maps){const ar=sr.maps[0],or=this.getTexturePathByIndex(ar.imageIndex,tr);if(!or)return;const lr=this.loadTexture(or);switch(ar.wrap!==void 0&&(lr.wrapS=this.getWrappingType(ar.wrap.w)),ar.wrap!==void 0&&(lr.wrapT=this.getWrappingType(ar.wrap.h)),nr){case"Color":rr.map=lr,rr.map.colorSpace=SRGBColorSpace;break;case"Diffuse":rr.aoMap=lr;break;case"Roughness":rr.roughnessMap=lr,rr.roughness=1;break;case"Specular":rr.specularMap=lr,rr.specularMap.colorSpace=SRGBColorSpace,rr.specular=16777215;break;case"Luminosity":rr.emissiveMap=lr,rr.emissiveMap.colorSpace=SRGBColorSpace,rr.emissive=8421504;break;case"Metallic":rr.metalnessMap=lr,rr.metalness=1;break;case"Transparency":case"Alpha":rr.alphaMap=lr,rr.transparent=!0;break;case"Normal":rr.normalMap=lr;break;case"Bump":rr.bumpMap=lr;break}}}}parseAttributes(er,tr){const rr={};return er.Color&&!tr.map?rr.color=new Color().fromArray(er.Color.value):rr.color=new Color,er.Transparency&&er.Transparency.value!==0&&(rr.opacity=1-er.Transparency.value,rr.transparent=!0),er["Bump Height"]&&(rr.bumpScale=er["Bump Height"].value*.1),this.parsePhysicalAttributes(rr,er,tr),this.parseStandardAttributes(rr,er,tr),this.parsePhongAttributes(rr,er,tr),rr}parsePhysicalAttributes(er,tr){tr.Clearcoat&&tr.Clearcoat.value>0&&(er.clearcoat=tr.Clearcoat.value,tr["Clearcoat Gloss"]&&(er.clearcoatRoughness=.5*(1-tr["Clearcoat Gloss"].value)))}parseStandardAttributes(er,tr,rr){tr.Luminous&&(er.emissiveIntensity=tr.Luminous.value,tr["Luminous Color"]&&!rr.emissive?er.emissive=new Color().fromArray(tr["Luminous Color"].value):er.emissive=new Color(8421504)),tr.Roughness&&!rr.roughnessMap&&(er.roughness=tr.Roughness.value),tr.Metallic&&!rr.metalnessMap&&(er.metalness=tr.Metallic.value)}parsePhongAttributes(er,tr,rr){tr["Refraction Index"]&&(er.refractionRatio=.98/tr["Refraction Index"].value),tr.Diffuse&&er.color.multiplyScalar(tr.Diffuse.value),tr.Reflection&&(er.reflectivity=tr.Reflection.value,er.combine=AddOperation),tr.Luminosity&&(er.emissiveIntensity=tr.Luminosity.value,!rr.emissiveMap&&!rr.map?er.emissive=er.color:er.emissive=new Color(8421504)),!tr.Roughness&&tr.Specular&&!rr.specularMap&&(tr["Color Highlight"]?er.specular=new Color().setScalar(tr.Specular.value).lerp(er.color.clone().multiplyScalar(tr.Specular.value),tr["Color Highlight"].value):er.specular=new Color().setScalar(tr.Specular.value)),er.specular&&tr.Glossiness&&(er.shininess=7+Math.pow(2,tr.Glossiness.value*12+2))}parseEnvMap(er,tr,rr){if(er.envMap){const nr=this.loadTexture(er.envMap);rr.transparent&&rr.opacity<.999?(nr.mapping=EquirectangularRefractionMapping,rr.reflectivity!==void 0&&(delete rr.reflectivity,delete rr.combine),rr.metalness!==void 0&&(rr.metalness=1),rr.opacity=1):nr.mapping=EquirectangularReflectionMapping,tr.envMap=nr}}getTexturePathByIndex(er){let tr="";return _lwoTree.textures&&_lwoTree.textures.forEach(function(rr){rr.index===er&&(tr=rr.fileName)}),tr}loadTexture(er){return er?this.textureLoader.load(er,void 0,void 0,function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")}):null}getWrappingType(er){switch(er){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),ClampToEdgeWrapping;case 1:return RepeatWrapping;case 2:return MirroredRepeatWrapping;case 3:return ClampToEdgeWrapping}}getMaterialType(er){return er.Clearcoat&&er.Clearcoat.value>0?MeshPhysicalMaterial:er.Roughness?MeshStandardMaterial:MeshPhongMaterial}}class GeometryParser{parse(er,tr){const rr=new BufferGeometry;rr.setAttribute("position",new Float32BufferAttribute(er.points,3));const nr=this.splitIndices(er.vertexIndices,er.polygonDimensions);return rr.setIndex(nr),this.parseGroups(rr,er),rr.computeVertexNormals(),this.parseUVs(rr,tr,nr),this.parseMorphTargets(rr,tr,nr),rr.translate(-tr.pivot[0],-tr.pivot[1],-tr.pivot[2]),rr}splitIndices(er,tr){const rr=[];let nr=0;return tr.forEach(function(sr){if(sr<4)for(let ar=0;ar<sr;ar++)rr.push(er[nr+ar]);else if(sr===4)rr.push(er[nr],er[nr+1],er[nr+2],er[nr],er[nr+2],er[nr+3]);else if(sr>4){for(let ar=1;ar<sr-1;ar++)rr.push(er[nr],er[nr+ar],er[nr+ar+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}nr+=sr}),rr}parseGroups(er,tr){const rr=_lwoTree.tags,nr=[];let sr=3;tr.type==="lines"&&(sr=2),tr.type==="points"&&(sr=1);const ar=this.splitMaterialIndices(tr.polygonDimensions,tr.materialIndices);let or=0;const lr={};let cr,hr,fr=0,ur=0;for(let pr=0;pr<ar.length;pr+=2){if(hr=ar[pr+1],pr===0&&(nr[or]=rr[hr]),cr===void 0&&(cr=hr),hr!==cr){let gr;lr[rr[cr]]?gr=lr[rr[cr]]:(gr=or,lr[rr[cr]]=or,nr[or]=rr[cr],or++),er.addGroup(fr,ur,gr),fr+=ur,cr=hr,ur=0}ur+=sr}if(er.groups.length>0){let pr;lr[rr[hr]]?pr=lr[rr[hr]]:(pr=or,lr[rr[hr]]=or,nr[or]=rr[hr]),er.addGroup(fr,ur,pr)}er.userData.matNames=nr}splitMaterialIndices(er,tr){const rr=[];return er.forEach(function(nr,sr){if(nr<=3)rr.push(tr[sr*2],tr[sr*2+1]);else if(nr===4)rr.push(tr[sr*2],tr[sr*2+1],tr[sr*2],tr[sr*2+1]);else for(let ar=0;ar<nr-2;ar++)rr.push(tr[sr*2],tr[sr*2+1])}),rr}parseUVs(er,tr){const rr=Array.from(Array(er.attributes.position.count*2),function(){return 0});for(const nr in tr.uvs){const sr=tr.uvs[nr].uvs;tr.uvs[nr].uvIndices.forEach(function(or,lr){rr[or*2]=sr[lr*2],rr[or*2+1]=sr[lr*2+1]})}er.setAttribute("uv",new Float32BufferAttribute(rr,2))}parseMorphTargets(er,tr){let rr=0;for(const nr in tr.morphTargets){const sr=er.attributes.position.array.slice();er.morphAttributes.position||(er.morphAttributes.position=[]);const ar=tr.morphTargets[nr].points,or=tr.morphTargets[nr].indices,lr=tr.morphTargets[nr].type;or.forEach(function(cr,hr){lr==="relative"?(sr[cr*3]+=ar[hr*3],sr[cr*3+1]+=ar[hr*3+1],sr[cr*3+2]+=ar[hr*3+2]):(sr[cr*3]=ar[hr*3],sr[cr*3+1]=ar[hr*3+1],sr[cr*3+2]=ar[hr*3+2])}),er.morphAttributes.position[rr]=new Float32BufferAttribute(sr,3),er.morphAttributes.position[rr].name=nr,rr++}er.morphTargetsRelative=!1}}function extractParentUrl(ir,er){const tr=ir.indexOf(er);return tr===-1?"./":ir.slice(0,tr)}const lottie={};if(typeof document<"u"){function createTag(ir){return document.createElement(ir)}function extendPrototype(ir,er){var tr,rr=ir.length,nr;for(tr=0;tr<rr;tr+=1){nr=ir[tr].prototype;for(var sr in nr)Object.prototype.hasOwnProperty.call(nr,sr)&&(er.prototype[sr]=nr[sr])}}function getDescriptor(ir,er){return Object.getOwnPropertyDescriptor(ir,er)}function createProxyFunction(ir){function er(){}return er.prototype=ir,er}function createSizedArray(ir){return Array.apply(null,{length:ir})}function ProjectInterface$1(){return{}}function roundValues(ir){_shouldRoundValues=!!ir}function bmRnd(ir){return _shouldRoundValues?Math.round(ir):ir}function styleDiv(ir){ir.style.position="absolute",ir.style.top=0,ir.style.left=0,ir.style.display="block",ir.style.transformOrigin="0 0",ir.style.webkitTransformOrigin="0 0",ir.style.backfaceVisibility="visible",ir.style.webkitBackfaceVisibility="visible",ir.style.transformStyle="preserve-3d",ir.style.webkitTransformStyle="preserve-3d",ir.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(ir,er,tr,rr){this.type=ir,this.currentTime=er,this.totalTime=tr,this.direction=rr<0?-1:1}function BMCompleteEvent(ir,er){this.type=ir,this.direction=er<0?-1:1}function BMCompleteLoopEvent(ir,er,tr,rr){this.type=ir,this.currentLoop=tr,this.totalLoops=er,this.direction=rr<0?-1:1}function BMSegmentStartEvent(ir,er,tr){this.type=ir,this.firstFrame=er,this.totalFrames=tr}function BMDestroyEvent(ir,er){this.type=ir,this.target=er}function BMRenderFrameErrorEvent(ir,er){this.type="renderFrameError",this.nativeError=ir,this.currentTime=er}function BMConfigErrorEvent(ir){this.type="configError",this.nativeError=ir}function BMAnimationConfigErrorEvent(ir,er){this.type=ir,this.nativeError=er}function HSVtoRGB(ir,er,tr){var rr,nr,sr,ar,or,lr,cr,hr;switch(ar=Math.floor(ir*6),or=ir*6-ar,lr=tr*(1-er),cr=tr*(1-or*er),hr=tr*(1-(1-or)*er),ar%6){case 0:rr=tr,nr=hr,sr=lr;break;case 1:rr=cr,nr=tr,sr=lr;break;case 2:rr=lr,nr=tr,sr=hr;break;case 3:rr=lr,nr=cr,sr=tr;break;case 4:rr=hr,nr=lr,sr=tr;break;case 5:rr=tr,nr=lr,sr=cr;break;default:break}return[rr,nr,sr]}function RGBtoHSV(ir,er,tr){var rr=Math.max(ir,er,tr),nr=Math.min(ir,er,tr),sr=rr-nr,ar,or=rr===0?0:sr/rr,lr=rr/255;switch(rr){case nr:ar=0;break;case ir:ar=er-tr+sr*(er<tr?6:0),ar/=6*sr;break;case er:ar=tr-ir+sr*2,ar/=6*sr;break;case tr:ar=ir-er+sr*4,ar/=6*sr;break;default:break}return[ar,or,lr]}function addSaturationToRGB(ir,er){var tr=RGBtoHSV(ir[0]*255,ir[1]*255,ir[2]*255);return tr[1]+=er,tr[1]>1?tr[1]=1:tr[1]<=0&&(tr[1]=0),HSVtoRGB(tr[0],tr[1],tr[2])}function addBrightnessToRGB(ir,er){var tr=RGBtoHSV(ir[0]*255,ir[1]*255,ir[2]*255);return tr[2]+=er,tr[2]>1?tr[2]=1:tr[2]<0&&(tr[2]=0),HSVtoRGB(tr[0],tr[1],tr[2])}function addHueToRGB(ir,er){var tr=RGBtoHSV(ir[0]*255,ir[1]*255,ir[2]*255);return tr[0]+=er/360,tr[0]>1?tr[0]-=1:tr[0]<0&&(tr[0]+=1),HSVtoRGB(tr[0],tr[1],tr[2])}function createNS(ir){return document.createElementNS(svgNS,ir)}function BaseEvent(){}function getRenderer(ir){return renderers[ir]}function bezFunction(){var ir=Math;function er(ur,pr,gr,_r,mr,dr){var vr=ur*_r+pr*mr+gr*dr-mr*_r-dr*ur-gr*pr;return vr>-.001&&vr<.001}function tr(ur,pr,gr,_r,mr,dr,vr,Ar,yr){if(gr===0&&dr===0&&yr===0)return er(ur,pr,_r,mr,vr,Ar);var wr=ir.sqrt(ir.pow(_r-ur,2)+ir.pow(mr-pr,2)+ir.pow(dr-gr,2)),br=ir.sqrt(ir.pow(vr-ur,2)+ir.pow(Ar-pr,2)+ir.pow(yr-gr,2)),Sr=ir.sqrt(ir.pow(vr-_r,2)+ir.pow(Ar-mr,2)+ir.pow(yr-dr,2)),xr;return wr>br?wr>Sr?xr=wr-br-Sr:xr=Sr-br-wr:Sr>br?xr=Sr-br-wr:xr=br-wr-Sr,xr>-1e-4&&xr<1e-4}var rr=function(){return function(ur,pr,gr,_r){var mr=getDefaultCurveSegments(),dr,vr,Ar,yr,wr,br=0,Sr,xr=[],Cr=[],Ir=bezierLengthPool.newElement();for(Ar=gr.length,dr=0;dr<mr;dr+=1){for(wr=dr/(mr-1),Sr=0,vr=0;vr<Ar;vr+=1)yr=bmPow(1-wr,3)*ur[vr]+3*bmPow(1-wr,2)*wr*gr[vr]+3*(1-wr)*bmPow(wr,2)*_r[vr]+bmPow(wr,3)*pr[vr],xr[vr]=yr,Cr[vr]!==null&&(Sr+=bmPow(xr[vr]-Cr[vr],2)),Cr[vr]=xr[vr];Sr&&(Sr=bmSqrt(Sr),br+=Sr),Ir.percents[dr]=wr,Ir.lengths[dr]=br}return Ir.addedLength=br,Ir}}();function nr(ur){var pr=segmentsLengthPool.newElement(),gr=ur.c,_r=ur.v,mr=ur.o,dr=ur.i,vr,Ar=ur._length,yr=pr.lengths,wr=0;for(vr=0;vr<Ar-1;vr+=1)yr[vr]=rr(_r[vr],_r[vr+1],mr[vr],dr[vr+1]),wr+=yr[vr].addedLength;return gr&&Ar&&(yr[vr]=rr(_r[vr],_r[0],mr[vr],dr[0]),wr+=yr[vr].addedLength),pr.totalLength=wr,pr}function sr(ur){this.segmentLength=0,this.points=new Array(ur)}function ar(ur,pr){this.partialLength=ur,this.point=pr}var or=function(){var ur={};return function(pr,gr,_r,mr){var dr=(pr[0]+"_"+pr[1]+"_"+gr[0]+"_"+gr[1]+"_"+_r[0]+"_"+_r[1]+"_"+mr[0]+"_"+mr[1]).replace(/\./g,"p");if(!ur[dr]){var vr=getDefaultCurveSegments(),Ar,yr,wr,br,Sr,xr=0,Cr,Ir,Rr=null;pr.length===2&&(pr[0]!==gr[0]||pr[1]!==gr[1])&&er(pr[0],pr[1],gr[0],gr[1],pr[0]+_r[0],pr[1]+_r[1])&&er(pr[0],pr[1],gr[0],gr[1],gr[0]+mr[0],gr[1]+mr[1])&&(vr=2);var Pr=new sr(vr);for(wr=_r.length,Ar=0;Ar<vr;Ar+=1){for(Ir=createSizedArray(wr),Sr=Ar/(vr-1),Cr=0,yr=0;yr<wr;yr+=1)br=bmPow(1-Sr,3)*pr[yr]+3*bmPow(1-Sr,2)*Sr*(pr[yr]+_r[yr])+3*(1-Sr)*bmPow(Sr,2)*(gr[yr]+mr[yr])+bmPow(Sr,3)*gr[yr],Ir[yr]=br,Rr!==null&&(Cr+=bmPow(Ir[yr]-Rr[yr],2));Cr=bmSqrt(Cr),xr+=Cr,Pr.points[Ar]=new ar(Cr,Ir),Rr=Ir}Pr.segmentLength=xr,ur[dr]=Pr}return ur[dr]}}();function lr(ur,pr){var gr=pr.percents,_r=pr.lengths,mr=gr.length,dr=bmFloor((mr-1)*ur),vr=ur*pr.addedLength,Ar=0;if(dr===mr-1||dr===0||vr===_r[dr])return gr[dr];for(var yr=_r[dr]>vr?-1:1,wr=!0;wr;)if(_r[dr]<=vr&&_r[dr+1]>vr?(Ar=(vr-_r[dr])/(_r[dr+1]-_r[dr]),wr=!1):dr+=yr,dr<0||dr>=mr-1){if(dr===mr-1)return gr[dr];wr=!1}return gr[dr]+(gr[dr+1]-gr[dr])*Ar}function cr(ur,pr,gr,_r,mr,dr){var vr=lr(mr,dr),Ar=1-vr,yr=ir.round((Ar*Ar*Ar*ur[0]+(vr*Ar*Ar+Ar*vr*Ar+Ar*Ar*vr)*gr[0]+(vr*vr*Ar+Ar*vr*vr+vr*Ar*vr)*_r[0]+vr*vr*vr*pr[0])*1e3)/1e3,wr=ir.round((Ar*Ar*Ar*ur[1]+(vr*Ar*Ar+Ar*vr*Ar+Ar*Ar*vr)*gr[1]+(vr*vr*Ar+Ar*vr*vr+vr*Ar*vr)*_r[1]+vr*vr*vr*pr[1])*1e3)/1e3;return[yr,wr]}var hr=createTypedArray("float32",8);function fr(ur,pr,gr,_r,mr,dr,vr){mr<0?mr=0:mr>1&&(mr=1);var Ar=lr(mr,vr);dr=dr>1?1:dr;var yr=lr(dr,vr),wr,br=ur.length,Sr=1-Ar,xr=1-yr,Cr=Sr*Sr*Sr,Ir=Ar*Sr*Sr*3,Rr=Ar*Ar*Sr*3,Pr=Ar*Ar*Ar,Fr=Sr*Sr*xr,Nr=Ar*Sr*xr+Sr*Ar*xr+Sr*Sr*yr,Ur=Ar*Ar*xr+Sr*Ar*yr+Ar*Sr*yr,Br=Ar*Ar*yr,Or=Sr*xr*xr,Dr=Ar*xr*xr+Sr*yr*xr+Sr*xr*yr,Wr=Ar*yr*xr+Sr*yr*yr+Ar*xr*yr,$r=Ar*yr*yr,Yr=xr*xr*xr,Qi=yr*xr*xr+xr*yr*xr+xr*xr*yr,rs=yr*yr*xr+xr*yr*yr+yr*xr*yr,Kr=yr*yr*yr;for(wr=0;wr<br;wr+=1)hr[wr*4]=ir.round((Cr*ur[wr]+Ir*gr[wr]+Rr*_r[wr]+Pr*pr[wr])*1e3)/1e3,hr[wr*4+1]=ir.round((Fr*ur[wr]+Nr*gr[wr]+Ur*_r[wr]+Br*pr[wr])*1e3)/1e3,hr[wr*4+2]=ir.round((Or*ur[wr]+Dr*gr[wr]+Wr*_r[wr]+$r*pr[wr])*1e3)/1e3,hr[wr*4+3]=ir.round((Yr*ur[wr]+Qi*gr[wr]+rs*_r[wr]+Kr*pr[wr])*1e3)/1e3;return hr}return{getSegmentsLength:nr,getNewSegment:fr,getPointInSegment:cr,buildBezierData:or,pointOnLine2D:er,pointOnLine3D:tr}}function DynamicPropertyContainer(){}function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}function setLocation(ir){setLocationHref(ir)}function searchAnimations(){standalone===!0?animationManager.searchAnimations(animationData,standalone,renderer$1):animationManager.searchAnimations()}function setSubframeRendering(ir){setSubframeEnabled(ir)}function setPrefix(ir){setIdPrefix(ir)}function loadAnimation(ir){return standalone===!0&&(ir.animationData=JSON.parse(animationData)),animationManager.loadAnimation(ir)}function setQuality(ir){if(typeof ir=="string")switch(ir){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(ir)&&ir>1&&setDefaultCurveSegments(ir);getDefaultCurveSegments()>=50?roundValues(!1):roundValues(!0)}function inBrowser(){return typeof navigator<"u"}function installPlugin(ir,er){ir==="expressions"&&setExpressionsPlugin(er)}function getFactory(ir){switch(ir){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(ir){for(var er=queryString.split("&"),tr=0;tr<er.length;tr+=1){var rr=er[tr].split("=");if(decodeURIComponent(rr[0])==ir)return decodeURIComponent(rr[1])}return null}function ShapeModifier(){}function TrimModifier(){}function PuckerAndBloatModifier(){}function RepeaterModifier(){}function RoundCornersModifier(){}function getFontProperties(ir){for(var er=ir.fStyle?ir.fStyle.split(" "):[],tr="normal",rr="normal",nr=er.length,sr,ar=0;ar<nr;ar+=1)switch(sr=er[ar].toLowerCase(),sr){case"italic":rr="italic";break;case"bold":tr="700";break;case"black":tr="900";break;case"medium":tr="500";break;case"regular":case"normal":tr="400";break;case"light":case"thin":tr="200";break;default:break}return{style:rr,weight:ir.fWeight||tr}}function RenderableElement(){}function SliderEffect(ir,er,tr){this.p=PropertyFactory.getProp(er,ir.v,0,0,tr)}function AngleEffect(ir,er,tr){this.p=PropertyFactory.getProp(er,ir.v,0,0,tr)}function ColorEffect(ir,er,tr){this.p=PropertyFactory.getProp(er,ir.v,1,0,tr)}function PointEffect(ir,er,tr){this.p=PropertyFactory.getProp(er,ir.v,1,0,tr)}function LayerIndexEffect(ir,er,tr){this.p=PropertyFactory.getProp(er,ir.v,0,0,tr)}function MaskIndexEffect(ir,er,tr){this.p=PropertyFactory.getProp(er,ir.v,0,0,tr)}function CheckboxEffect(ir,er,tr){this.p=PropertyFactory.getProp(er,ir.v,0,0,tr)}function NoValueEffect(){this.p={}}function EffectsManager(ir,er){var tr=ir.ef||[];this.effectElements=[];var rr,nr=tr.length,sr;for(rr=0;rr<nr;rr+=1)sr=new GroupEffect(tr[rr],er),this.effectElements.push(sr)}function GroupEffect(ir,er){this.init(ir,er)}function BaseElement(){}function FrameElement(){}function FootageElement(ir,er,tr){this.initFrame(),this.initRenderable(),this.assetData=er.getAssetData(ir.refId),this.footageData=er.imageLoader.getAsset(this.assetData),this.initBaseData(ir,er,tr)}function AudioElement(ir,er,tr){this.initFrame(),this.initRenderable(),this.assetData=er.getAssetData(ir.refId),this.initBaseData(ir,er,tr),this._isPlaying=!1,this._canPlay=!1;var rr=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(rr),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=ir.tm?PropertyFactory.getProp(this,ir.tm,0,er.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,ir.au&&ir.au.lv?ir.au.lv:{k:[100]},1,.01,this)}function BaseRenderer(){}function TransformElement(){}function MaskElement(ir,er,tr){this.data=ir,this.element=er,this.globalData=tr,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var rr=this.globalData.defs,nr,sr=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(sr),this.solidPath="";var ar,or=this.masksProperties,lr=0,cr=[],hr,fr,ur=createElementID(),pr,gr,_r,mr,dr="clipPath",vr="clip-path";for(nr=0;nr<sr;nr+=1)if((or[nr].mode!=="a"&&or[nr].mode!=="n"||or[nr].inv||or[nr].o.k!==100||or[nr].o.x)&&(dr="mask",vr="mask"),(or[nr].mode==="s"||or[nr].mode==="i")&&lr===0?(pr=createNS("rect"),pr.setAttribute("fill","#ffffff"),pr.setAttribute("width",this.element.comp.data.w||0),pr.setAttribute("height",this.element.comp.data.h||0),cr.push(pr)):pr=null,ar=createNS("path"),or[nr].mode==="n")this.viewData[nr]={op:PropertyFactory.getProp(this.element,or[nr].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,or[nr],3),elem:ar,lastPath:""},rr.appendChild(ar);else{lr+=1,ar.setAttribute("fill",or[nr].mode==="s"?"#000000":"#ffffff"),ar.setAttribute("clip-rule","nonzero");var Ar;if(or[nr].x.k!==0?(dr="mask",vr="mask",mr=PropertyFactory.getProp(this.element,or[nr].x,0,null,this.element),Ar=createElementID(),gr=createNS("filter"),gr.setAttribute("id",Ar),_r=createNS("feMorphology"),_r.setAttribute("operator","erode"),_r.setAttribute("in","SourceGraphic"),_r.setAttribute("radius","0"),gr.appendChild(_r),rr.appendChild(gr),ar.setAttribute("stroke",or[nr].mode==="s"?"#000000":"#ffffff")):(_r=null,mr=null),this.storedData[nr]={elem:ar,x:mr,expan:_r,lastPath:"",lastOperator:"",filterId:Ar,lastRadius:0},or[nr].mode==="i"){fr=cr.length;var yr=createNS("g");for(hr=0;hr<fr;hr+=1)yr.appendChild(cr[hr]);var wr=createNS("mask");wr.setAttribute("mask-type","alpha"),wr.setAttribute("id",ur+"_"+lr),wr.appendChild(ar),rr.appendChild(wr),yr.setAttribute("mask","url("+getLocationHref()+"#"+ur+"_"+lr+")"),cr.length=0,cr.push(yr)}else cr.push(ar);or[nr].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[nr]={elem:ar,lastPath:"",op:PropertyFactory.getProp(this.element,or[nr].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,or[nr],3),invRect:pr},this.viewData[nr].prop.k||this.drawPath(or[nr],this.viewData[nr].prop.v,this.viewData[nr])}for(this.maskElement=createNS(dr),sr=cr.length,nr=0;nr<sr;nr+=1)this.maskElement.appendChild(cr[nr]);lr>0&&(this.maskElement.setAttribute("id",ur),this.element.maskedElement.setAttribute(vr,"url("+getLocationHref()+"#"+ur+")"),rr.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}function SVGEffects(ir){var er,tr="SourceGraphic",rr=ir.data.ef?ir.data.ef.length:0,nr=createElementID(),sr=filtersFactory.createFilter(nr,!0),ar=0;this.filters=[];var or;for(er=0;er<rr;er+=1){or=null;var lr=ir.data.ef[er].ty;if(registeredEffects[lr]){var cr=registeredEffects[lr].effect;or=new cr(sr,ir.effectsManager.effectElements[er],ir,idPrefix+ar,tr),tr=idPrefix+ar,registeredEffects[lr].countsAsEffect&&(ar+=1)}or&&this.filters.push(or)}ar&&(ir.globalData.defs.appendChild(sr),ir.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+nr+")")),this.filters.length&&ir.addRenderableComponent(this)}function registerEffect(ir,er,tr){registeredEffects[ir]={effect:er,countsAsEffect:tr}}function SVGBaseElement(){}function HierarchyElement(){}function RenderableDOMElement(){}function IImageElement(ir,er,tr){this.assetData=er.getAssetData(ir.refId),this.initElement(ir,er,tr),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function ProcessedElement(ir,er){this.elem=ir,this.pos=er}function IShapeElement(){}function SVGShapeData(ir,er,tr){this.caches=[],this.styles=[],this.transformers=ir,this.lStr="",this.sh=tr,this.lvl=er,this._isAnimated=!!tr.k;for(var rr=0,nr=ir.length;rr<nr;){if(ir[rr].mProps.dynamicProperties.length){this._isAnimated=!0;break}rr+=1}}function SVGStyleData(ir,er){this.data=ir,this.type=ir.ty,this.d="",this.lvl=er,this._mdf=!1,this.closed=ir.hd===!0,this.pElem=createNS("path"),this.msElem=null}function DashProperty(ir,er,tr,rr){this.elem=ir,this.frameId=-1,this.dataProps=createSizedArray(er.length),this.renderer=tr,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",er.length?er.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(rr);var nr,sr=er.length||0,ar;for(nr=0;nr<sr;nr+=1)ar=PropertyFactory.getProp(ir,er[nr].v,0,0,this),this.k=ar.k||this.k,this.dataProps[nr]={n:er[nr].n,p:ar};this.k||this.getValue(!0),this._isAnimated=this.k}function SVGStrokeStyleData(ir,er,tr){this.initDynamicPropertyContainer(ir),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(ir,er.o,0,.01,this),this.w=PropertyFactory.getProp(ir,er.w,0,null,this),this.d=new DashProperty(ir,er.d||{},"svg",this),this.c=PropertyFactory.getProp(ir,er.c,1,255,this),this.style=tr,this._isAnimated=!!this._isAnimated}function SVGFillStyleData(ir,er,tr){this.initDynamicPropertyContainer(ir),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(ir,er.o,0,.01,this),this.c=PropertyFactory.getProp(ir,er.c,1,255,this),this.style=tr}function SVGNoStyleData(ir,er,tr){this.initDynamicPropertyContainer(ir),this.getValue=this.iterateDynamicProperties,this.style=tr}function GradientProperty(ir,er,tr){this.data=er,this.c=createTypedArray("uint8c",er.p*4);var rr=er.k.k[0].s?er.k.k[0].s.length-er.p*4:er.k.k.length-er.p*4;this.o=createTypedArray("float32",rr),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=rr,this.initDynamicPropertyContainer(tr),this.prop=PropertyFactory.getProp(ir,er.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}function SVGGradientFillStyleData(ir,er,tr){this.initDynamicPropertyContainer(ir),this.getValue=this.iterateDynamicProperties,this.initGradientData(ir,er,tr)}function SVGGradientStrokeStyleData(ir,er,tr){this.initDynamicPropertyContainer(ir),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(ir,er.w,0,null,this),this.d=new DashProperty(ir,er.d||{},"svg",this),this.initGradientData(ir,er,tr),this._isAnimated=!!this._isAnimated}function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(ir,er,tr){this.transform={mProps:ir,op:er,container:tr},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}function SVGShapeElement(ir,er,tr){this.shapes=[],this.shapesData=ir.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(ir,er,tr),this.prevViewData=[]}function LetterProps(ir,er,tr,rr,nr,sr){this.o=ir,this.sw=er,this.sc=tr,this.fc=rr,this.m=nr,this.p=sr,this._mdf={o:!0,sw:!!er,sc:!!tr,fc:!!rr,m:!0,p:!0}}function TextProperty(ir,er){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,this.data=er,this.elem=ir,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}function TextAnimatorDataProperty(ir,er,tr){var rr={propType:!1},nr=PropertyFactory.getProp,sr=er.a;this.a={r:sr.r?nr(ir,sr.r,0,degToRads,tr):rr,rx:sr.rx?nr(ir,sr.rx,0,degToRads,tr):rr,ry:sr.ry?nr(ir,sr.ry,0,degToRads,tr):rr,sk:sr.sk?nr(ir,sr.sk,0,degToRads,tr):rr,sa:sr.sa?nr(ir,sr.sa,0,degToRads,tr):rr,s:sr.s?nr(ir,sr.s,1,.01,tr):rr,a:sr.a?nr(ir,sr.a,1,0,tr):rr,o:sr.o?nr(ir,sr.o,0,.01,tr):rr,p:sr.p?nr(ir,sr.p,1,0,tr):rr,sw:sr.sw?nr(ir,sr.sw,0,0,tr):rr,sc:sr.sc?nr(ir,sr.sc,1,0,tr):rr,fc:sr.fc?nr(ir,sr.fc,1,0,tr):rr,fh:sr.fh?nr(ir,sr.fh,0,0,tr):rr,fs:sr.fs?nr(ir,sr.fs,0,.01,tr):rr,fb:sr.fb?nr(ir,sr.fb,0,.01,tr):rr,t:sr.t?nr(ir,sr.t,0,0,tr):rr},this.s=TextSelectorProp.getTextSelectorProp(ir,er.s,tr),this.s.t=er.s.t}function TextAnimatorProperty(ir,er,tr){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=ir,this._renderType=er,this._elem=tr,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(tr)}function ITextElement(){}function SVGTextLottieElement(ir,er,tr){this.textSpans=[],this.renderType="svg",this.initElement(ir,er,tr)}function ISolidElement(ir,er,tr){this.initElement(ir,er,tr)}function NullElement(ir,er,tr){this.initFrame(),this.initBaseData(ir,er,tr),this.initFrame(),this.initTransform(ir,er,tr),this.initHierarchy()}function SVGRendererBase(){}function ICompElement(){}function SVGCompElement(ir,er,tr){this.layers=ir.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(ir,er,tr),this.tm=ir.tm?PropertyFactory.getProp(this,ir.tm,0,er.frameRate,this):{_placeholder:!0}}function SVGRenderer(ir,er){this.animationItem=ir,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var tr="";if(er&&er.title){var rr=createNS("title"),nr=createElementID();rr.setAttribute("id",nr),rr.textContent=er.title,this.svgElement.appendChild(rr),tr+=nr}if(er&&er.description){var sr=createNS("desc"),ar=createElementID();sr.setAttribute("id",ar),sr.textContent=er.description,this.svgElement.appendChild(sr),tr+=" "+ar}tr&&this.svgElement.setAttribute("aria-labelledby",tr);var or=createNS("defs");this.svgElement.appendChild(or);var lr=createNS("g");this.svgElement.appendChild(lr),this.layerElement=lr,this.renderConfig={preserveAspectRatio:er&&er.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:er&&er.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:er&&er.contentVisibility||"visible",progressiveLoad:er&&er.progressiveLoad||!1,hideOnTransparent:!(er&&er.hideOnTransparent===!1),viewBoxOnly:er&&er.viewBoxOnly||!1,viewBoxSize:er&&er.viewBoxSize||!1,className:er&&er.className||"",id:er&&er.id||"",focusable:er&&er.focusable,filterSize:{width:er&&er.filterSize&&er.filterSize.width||"100%",height:er&&er.filterSize&&er.filterSize.height||"100%",x:er&&er.filterSize&&er.filterSize.x||"0%",y:er&&er.filterSize&&er.filterSize.y||"0%"},width:er&&er.width,height:er&&er.height},this.globalData={_mdf:!1,frameNum:-1,defs:or,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function CVContextData(){this.saved=[],this.cArrPos=0,this.cTr=new Matrix,this.cO=1;var ir,er=15;for(this.savedOp=createTypedArray("float32",er),ir=0;ir<er;ir+=1)this.saved[ir]=createTypedArray("float32",16);this._length=er}function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}function CVEffects(){}function CVMaskElement(ir,er){this.data=ir,this.element=er,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var tr,rr=this.masksProperties.length,nr=!1;for(tr=0;tr<rr;tr+=1)this.masksProperties[tr].mode!=="n"&&(nr=!0),this.viewData[tr]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[tr],3);this.hasMasks=nr,nr&&this.element.addRenderableComponent(this)}function CVBaseElement(){}function CVShapeData(ir,er,tr,rr){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var nr=4;er.ty==="rc"?nr=5:er.ty==="el"?nr=6:er.ty==="sr"&&(nr=7),this.sh=ShapePropertyFactory.getShapeProp(ir,er,nr,ir);var sr,ar=tr.length,or;for(sr=0;sr<ar;sr+=1)tr[sr].closed||(or={transforms:rr.addTransformSequence(tr[sr].transforms),trNodes:[]},this.styledShapes.push(or),tr[sr].elements.push(or))}function CVShapeElement(ir,er,tr){this.shapes=[],this.shapesData=ir.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(ir,er,tr)}function CVTextElement(ir,er,tr){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(ir,er,tr)}function CVImageElement(ir,er,tr){this.assetData=er.getAssetData(ir.refId),this.img=er.imageLoader.getAsset(this.assetData),this.initElement(ir,er,tr)}function CVSolidElement(ir,er,tr){this.initElement(ir,er,tr)}function CanvasRendererBase(ir,er){this.animationItem=ir,this.renderConfig={clearCanvas:er&&er.clearCanvas!==void 0?er.clearCanvas:!0,context:er&&er.context||null,progressiveLoad:er&&er.progressiveLoad||!1,preserveAspectRatio:er&&er.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:er&&er.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:er&&er.contentVisibility||"visible",className:er&&er.className||"",id:er&&er.id||""},this.renderConfig.dpr=er&&er.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=er&&er.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas"}function CVCompElement(ir,er,tr){this.completeLayers=!1,this.layers=ir.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(ir,er,tr),this.tm=ir.tm?PropertyFactory.getProp(this,ir.tm,0,er.frameRate,this):{_placeholder:!0}}function CanvasRenderer(ir,er){this.animationItem=ir,this.renderConfig={clearCanvas:er&&er.clearCanvas!==void 0?er.clearCanvas:!0,context:er&&er.context||null,progressiveLoad:er&&er.progressiveLoad||!1,preserveAspectRatio:er&&er.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:er&&er.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:er&&er.contentVisibility||"visible",className:er&&er.className||"",id:er&&er.id||""},this.renderConfig.dpr=er&&er.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=er&&er.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas"}function seedRandom(ir,er){var tr=this,rr=256,nr=6,sr=52,ar="random",or=er.pow(rr,nr),lr=er.pow(2,sr),cr=lr*2,hr=rr-1,fr;function ur(Ar,yr,wr){var br=[];yr=yr===!0?{entropy:!0}:yr||{};var Sr=mr(_r(yr.entropy?[Ar,vr(ir)]:Ar===null?dr():Ar,3),br),xr=new pr(br),Cr=function(){for(var Ir=xr.g(nr),Rr=or,Pr=0;Ir<lr;)Ir=(Ir+Pr)*rr,Rr*=rr,Pr=xr.g(1);for(;Ir>=cr;)Ir/=2,Rr/=2,Pr>>>=1;return(Ir+Pr)/Rr};return Cr.int32=function(){return xr.g(4)|0},Cr.quick=function(){return xr.g(4)/4294967296},Cr.double=Cr,mr(vr(xr.S),ir),(yr.pass||wr||function(Ir,Rr,Pr,Fr){return Fr&&(Fr.S&&gr(Fr,xr),Ir.state=function(){return gr(xr,{})}),Pr?(er[ar]=Ir,Rr):Ir})(Cr,Sr,"global"in yr?yr.global:this==er,yr.state)}er["seed"+ar]=ur;function pr(Ar){var yr,wr=Ar.length,br=this,Sr=0,xr=br.i=br.j=0,Cr=br.S=[];for(wr||(Ar=[wr++]);Sr<rr;)Cr[Sr]=Sr++;for(Sr=0;Sr<rr;Sr++)Cr[Sr]=Cr[xr=hr&xr+Ar[Sr%wr]+(yr=Cr[Sr])],Cr[xr]=yr;br.g=function(Ir){for(var Rr,Pr=0,Fr=br.i,Nr=br.j,Ur=br.S;Ir--;)Rr=Ur[Fr=hr&Fr+1],Pr=Pr*rr+Ur[hr&(Ur[Fr]=Ur[Nr=hr&Nr+Rr])+(Ur[Nr]=Rr)];return br.i=Fr,br.j=Nr,Pr}}function gr(Ar,yr){return yr.i=Ar.i,yr.j=Ar.j,yr.S=Ar.S.slice(),yr}function _r(Ar,yr){var wr=[],br=typeof Ar,Sr;if(yr&&br=="object")for(Sr in Ar)try{wr.push(_r(Ar[Sr],yr-1))}catch{}return wr.length?wr:br=="string"?Ar:Ar+"\0"}function mr(Ar,yr){for(var wr=Ar+"",br,Sr=0;Sr<wr.length;)yr[hr&Sr]=hr&(br^=yr[hr&Sr]*19)+wr.charCodeAt(Sr++);return vr(yr)}function dr(){try{if(fr)return vr(fr.randomBytes(rr));var Ar=new Uint8Array(rr);return(tr.crypto||tr.msCrypto).getRandomValues(Ar),vr(Ar)}catch{var yr=tr.navigator,wr=yr&&yr.plugins;return[+new Date,tr,wr,tr.screen,vr(ir)]}}function vr(Ar){return String.fromCharCode.apply(0,Ar)}mr(er.random(),ir)}function initialize$2(ir){seedRandom([],ir)}function addPropertyDecorator(){function ir(ur,pr,gr){if(!this.k||!this.keyframes)return this.pv;ur=ur?ur.toLowerCase():"";var _r=this.comp.renderedFrame,mr=this.keyframes,dr=mr[mr.length-1].t;if(_r<=dr)return this.pv;var vr,Ar;gr?(pr?vr=Math.abs(dr-this.elem.comp.globalData.frameRate*pr):vr=Math.max(0,dr-this.elem.data.ip),Ar=dr-vr):((!pr||pr>mr.length-1)&&(pr=mr.length-1),Ar=mr[mr.length-1-pr].t,vr=dr-Ar);var yr,wr,br;if(ur==="pingpong"){var Sr=Math.floor((_r-Ar)/vr);if(Sr%2!==0)return this.getValueAtTime((vr-(_r-Ar)%vr+Ar)/this.comp.globalData.frameRate,0)}else if(ur==="offset"){var xr=this.getValueAtTime(Ar/this.comp.globalData.frameRate,0),Cr=this.getValueAtTime(dr/this.comp.globalData.frameRate,0),Ir=this.getValueAtTime(((_r-Ar)%vr+Ar)/this.comp.globalData.frameRate,0),Rr=Math.floor((_r-Ar)/vr);if(this.pv.length){for(br=new Array(xr.length),wr=br.length,yr=0;yr<wr;yr+=1)br[yr]=(Cr[yr]-xr[yr])*Rr+Ir[yr];return br}return(Cr-xr)*Rr+Ir}else if(ur==="continue"){var Pr=this.getValueAtTime(dr/this.comp.globalData.frameRate,0),Fr=this.getValueAtTime((dr-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(br=new Array(Pr.length),wr=br.length,yr=0;yr<wr;yr+=1)br[yr]=Pr[yr]+(Pr[yr]-Fr[yr])*((_r-dr)/this.comp.globalData.frameRate)/5e-4;return br}return Pr+(Pr-Fr)*((_r-dr)/.001)}return this.getValueAtTime(((_r-Ar)%vr+Ar)/this.comp.globalData.frameRate,0)}function er(ur,pr,gr){if(!this.k)return this.pv;ur=ur?ur.toLowerCase():"";var _r=this.comp.renderedFrame,mr=this.keyframes,dr=mr[0].t;if(_r>=dr)return this.pv;var vr,Ar;gr?(pr?vr=Math.abs(this.elem.comp.globalData.frameRate*pr):vr=Math.max(0,this.elem.data.op-dr),Ar=dr+vr):((!pr||pr>mr.length-1)&&(pr=mr.length-1),Ar=mr[pr].t,vr=Ar-dr);var yr,wr,br;if(ur==="pingpong"){var Sr=Math.floor((dr-_r)/vr);if(Sr%2===0)return this.getValueAtTime(((dr-_r)%vr+dr)/this.comp.globalData.frameRate,0)}else if(ur==="offset"){var xr=this.getValueAtTime(dr/this.comp.globalData.frameRate,0),Cr=this.getValueAtTime(Ar/this.comp.globalData.frameRate,0),Ir=this.getValueAtTime((vr-(dr-_r)%vr+dr)/this.comp.globalData.frameRate,0),Rr=Math.floor((dr-_r)/vr)+1;if(this.pv.length){for(br=new Array(xr.length),wr=br.length,yr=0;yr<wr;yr+=1)br[yr]=Ir[yr]-(Cr[yr]-xr[yr])*Rr;return br}return Ir-(Cr-xr)*Rr}else if(ur==="continue"){var Pr=this.getValueAtTime(dr/this.comp.globalData.frameRate,0),Fr=this.getValueAtTime((dr+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(br=new Array(Pr.length),wr=br.length,yr=0;yr<wr;yr+=1)br[yr]=Pr[yr]+(Pr[yr]-Fr[yr])*(dr-_r)/.001;return br}return Pr+(Pr-Fr)*(dr-_r)/.001}return this.getValueAtTime((vr-((dr-_r)%vr+dr))/this.comp.globalData.frameRate,0)}function tr(ur,pr){if(!this.k)return this.pv;if(ur=(ur||.4)*.5,pr=Math.floor(pr||5),pr<=1)return this.pv;var gr=this.comp.renderedFrame/this.comp.globalData.frameRate,_r=gr-ur,mr=gr+ur,dr=pr>1?(mr-_r)/(pr-1):1,vr=0,Ar=0,yr;this.pv.length?yr=createTypedArray("float32",this.pv.length):yr=0;for(var wr;vr<pr;){if(wr=this.getValueAtTime(_r+vr*dr),this.pv.length)for(Ar=0;Ar<this.pv.length;Ar+=1)yr[Ar]+=wr[Ar];else yr+=wr;vr+=1}if(this.pv.length)for(Ar=0;Ar<this.pv.length;Ar+=1)yr[Ar]/=pr;else yr/=pr;return yr}function rr(ur){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var pr=this._transformCachingAtTime.v;if(pr.cloneFromProps(this.pre.props),this.appliedTransformations<1){var gr=this.a.getValueAtTime(ur);pr.translate(-gr[0]*this.a.mult,-gr[1]*this.a.mult,gr[2]*this.a.mult)}if(this.appliedTransformations<2){var _r=this.s.getValueAtTime(ur);pr.scale(_r[0]*this.s.mult,_r[1]*this.s.mult,_r[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var mr=this.sk.getValueAtTime(ur),dr=this.sa.getValueAtTime(ur);pr.skewFromAxis(-mr*this.sk.mult,dr*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var vr=this.r.getValueAtTime(ur);pr.rotate(-vr*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var Ar=this.rz.getValueAtTime(ur),yr=this.ry.getValueAtTime(ur),wr=this.rx.getValueAtTime(ur),br=this.or.getValueAtTime(ur);pr.rotateZ(-Ar*this.rz.mult).rotateY(yr*this.ry.mult).rotateX(wr*this.rx.mult).rotateZ(-br[2]*this.or.mult).rotateY(br[1]*this.or.mult).rotateX(br[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var Sr=this.px.getValueAtTime(ur),xr=this.py.getValueAtTime(ur);if(this.data.p.z){var Cr=this.pz.getValueAtTime(ur);pr.translate(Sr*this.px.mult,xr*this.py.mult,-Cr*this.pz.mult)}else pr.translate(Sr*this.px.mult,xr*this.py.mult,0)}else{var Ir=this.p.getValueAtTime(ur);pr.translate(Ir[0]*this.p.mult,Ir[1]*this.p.mult,-Ir[2]*this.p.mult)}return pr}function nr(){return this.v.clone(new Matrix)}var sr=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(ur,pr,gr){var _r=sr(ur,pr,gr);return _r.dynamicProperties.length?_r.getValueAtTime=rr.bind(_r):_r.getValueAtTime=nr.bind(_r),_r.setGroupProperty=expressionHelpers.setGroupProperty,_r};var ar=PropertyFactory.getProp;PropertyFactory.getProp=function(ur,pr,gr,_r,mr){var dr=ar(ur,pr,gr,_r,mr);dr.kf?dr.getValueAtTime=expressionHelpers.getValueAtTime.bind(dr):dr.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(dr),dr.setGroupProperty=expressionHelpers.setGroupProperty,dr.loopOut=ir,dr.loopIn=er,dr.smooth=tr,dr.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(dr),dr.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(dr),dr.numKeys=pr.a===1?pr.k.length:0,dr.propertyIndex=pr.ix;var vr=0;return gr!==0&&(vr=createTypedArray("float32",pr.a===1?pr.k[0].s.length:pr.k.length)),dr._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:vr},expressionHelpers.searchExpressions(ur,pr,dr),dr.k&&mr.addDynamicProperty(dr),dr};function or(ur){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),ur*=this.elem.globalData.frameRate,ur-=this.offsetTime,ur!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<ur?this._caching.lastIndex:0,this._cachingAtTime.lastTime=ur,this.interpolateShape(ur,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var lr=ShapePropertyFactory.getConstructorFunction(),cr=ShapePropertyFactory.getKeyframedConstructorFunction();function hr(){}hr.prototype={vertices:function(ur,pr){this.k&&this.getValue();var gr=this.v;pr!==void 0&&(gr=this.getValueAtTime(pr,0));var _r,mr=gr._length,dr=gr[ur],vr=gr.v,Ar=createSizedArray(mr);for(_r=0;_r<mr;_r+=1)ur==="i"||ur==="o"?Ar[_r]=[dr[_r][0]-vr[_r][0],dr[_r][1]-vr[_r][1]]:Ar[_r]=[dr[_r][0],dr[_r][1]];return Ar},points:function(ur){return this.vertices("v",ur)},inTangents:function(ur){return this.vertices("i",ur)},outTangents:function(ur){return this.vertices("o",ur)},isClosed:function(){return this.v.c},pointOnPath:function(ur,pr){var gr=this.v;pr!==void 0&&(gr=this.getValueAtTime(pr,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(gr));for(var _r=this._segmentsLength,mr=_r.lengths,dr=_r.totalLength*ur,vr=0,Ar=mr.length,yr=0,wr;vr<Ar;){if(yr+mr[vr].addedLength>dr){var br=vr,Sr=gr.c&&vr===Ar-1?0:vr+1,xr=(dr-yr)/mr[vr].addedLength;wr=bez.getPointInSegment(gr.v[br],gr.v[Sr],gr.o[br],gr.i[Sr],xr,mr[vr]);break}else yr+=mr[vr].addedLength;vr+=1}return wr||(wr=gr.c?[gr.v[0][0],gr.v[0][1]]:[gr.v[gr._length-1][0],gr.v[gr._length-1][1]]),wr},vectorOnPath:function(ur,pr,gr){ur==1?ur=this.v.c:ur==0&&(ur=.999);var _r=this.pointOnPath(ur,pr),mr=this.pointOnPath(ur+.001,pr),dr=mr[0]-_r[0],vr=mr[1]-_r[1],Ar=Math.sqrt(Math.pow(dr,2)+Math.pow(vr,2));if(Ar===0)return[0,0];var yr=gr==="tangent"?[dr/Ar,vr/Ar]:[-vr/Ar,dr/Ar];return yr},tangentOnPath:function(ur,pr){return this.vectorOnPath(ur,pr,"tangent")},normalOnPath:function(ur,pr){return this.vectorOnPath(ur,pr,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([hr],lr),extendPrototype([hr],cr),cr.prototype.getValueAtTime=or,cr.prototype.initiateExpression=ExpressionManager.initiateExpression;var fr=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(ur,pr,gr,_r,mr){var dr=fr(ur,pr,gr,_r,mr);return dr.propertyIndex=pr.ix,dr.lock=!1,gr===3?expressionHelpers.searchExpressions(ur,pr.pt,dr):gr===4&&expressionHelpers.searchExpressions(ur,pr.ks,dr),dr.k&&ur.addDynamicProperty(dr),dr}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function ir(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(er,tr){var rr=this.calculateExpression(tr);if(er.t!==rr){var nr={};return this.copyData(nr,er),nr.t=rr.toString(),nr.__complete=!1,nr}return er},TextProperty.prototype.searchProperty=function(){var er=this.searchKeyframes(),tr=this.searchExpressions();return this.kf=er||tr,this.kf},TextProperty.prototype.searchExpressions=ir}function initialize(){addDecorator()}const svgNS="http://www.w3.org/2000/svg";let locationHref="",_useWebWorker=!1;const initialDefaultFrame=-999999,setWebWorker=ir=>{_useWebWorker=!!ir},getWebWorker=()=>_useWebWorker,setLocationHref=ir=>{locationHref=ir},getLocationHref=()=>locationHref,audioControllerFactory=function(){function ir(er){this.audios=[],this.audioFactory=er,this._volume=1,this._isMuted=!1}return ir.prototype={addAudio:function(er){this.audios.push(er)},pause:function(){var er,tr=this.audios.length;for(er=0;er<tr;er+=1)this.audios[er].pause()},resume:function(){var er,tr=this.audios.length;for(er=0;er<tr;er+=1)this.audios[er].resume()},setRate:function(er){var tr,rr=this.audios.length;for(tr=0;tr<rr;tr+=1)this.audios[tr].setRate(er)},createAudio:function(er){return this.audioFactory?this.audioFactory(er):window.Howl?new window.Howl({src:[er]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(er){this.audioFactory=er},setVolume:function(er){this._volume=er,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var er,tr=this.audios.length;for(er=0;er<tr;er+=1)this.audios[er].volume(this._volume*(this._isMuted?0:1))}},function(){return new ir}}(),createTypedArray=function(){function ir(tr,rr){var nr=0,sr=[],ar;switch(tr){case"int16":case"uint8c":ar=1;break;default:ar=1.1;break}for(nr=0;nr<rr;nr+=1)sr.push(ar);return sr}function er(tr,rr){return tr==="float32"?new Float32Array(rr):tr==="int16"?new Int16Array(rr):tr==="uint8c"?new Uint8ClampedArray(rr):ir(tr,rr)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?er:ir}();let subframeEnabled=!0,expressionsPlugin=null,idPrefix$1="";const isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let _shouldRoundValues=!1;const bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var ir=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],er,tr=ir.length;for(er=0;er<tr;er+=1)BMMath[ir[er]]=Math[ir[er]]})(),BMMath.random=Math.random,BMMath.abs=function(ir){var er=typeof ir;if(er==="object"&&ir.length){var tr=createSizedArray(ir.length),rr,nr=ir.length;for(rr=0;rr<nr;rr+=1)tr[rr]=Math.abs(ir[rr]);return tr}return Math.abs(ir)};let defaultCurveSegments=150;const degToRads=Math.PI/180,roundCorner=.5519,createElementID=function(){var ir=0;return function(){return ir+=1,idPrefix$1+"__lottie_element_"+ir}}(),rgbToHex=function(){var ir=[],er,tr;for(er=0;er<256;er+=1)tr=er.toString(16),ir[er]=tr.length===1?"0"+tr:tr;return function(rr,nr,sr){return rr<0&&(rr=0),nr<0&&(nr=0),sr<0&&(sr=0),"#"+ir[rr]+ir[nr]+ir[sr]}}(),setSubframeEnabled=ir=>{subframeEnabled=!!ir},getSubframeEnabled=()=>subframeEnabled,setExpressionsPlugin=ir=>{expressionsPlugin=ir},getExpressionsPlugin=()=>expressionsPlugin,setDefaultCurveSegments=ir=>{defaultCurveSegments=ir},getDefaultCurveSegments=()=>defaultCurveSegments,setIdPrefix=ir=>{idPrefix$1=ir},getIdPrefix=()=>idPrefix$1,dataManager=function(){var ir=1,er=[],tr,rr,nr={onmessage:function(){},postMessage:function(ur){tr({data:ur})}},sr={postMessage:function(ur){nr.onmessage({data:ur})}};function ar(ur){if(window.Worker&&window.Blob&&getWebWorker()){var pr=new Blob(["var _workerSelf = self; self.onmessage = ",ur.toString()],{type:"text/javascript"}),gr=URL.createObjectURL(pr);return new Worker(gr)}return tr=ur,nr}function or(){rr||(rr=ar(function(pr){function gr(){function mr(Ur,Br){var Or,Dr,Wr=Ur.length,$r,Yr,Qi,rs;for(Dr=0;Dr<Wr;Dr+=1)if(Or=Ur[Dr],"ks"in Or&&!Or.completed){if(Or.completed=!0,Or.tt&&(Ur[Dr-1].td=Or.tt),Or.hasMask){var Kr=Or.masksProperties;for(Yr=Kr.length,$r=0;$r<Yr;$r+=1)if(Kr[$r].pt.k.i)wr(Kr[$r].pt.k);else for(rs=Kr[$r].pt.k.length,Qi=0;Qi<rs;Qi+=1)Kr[$r].pt.k[Qi].s&&wr(Kr[$r].pt.k[Qi].s[0]),Kr[$r].pt.k[Qi].e&&wr(Kr[$r].pt.k[Qi].e[0])}Or.ty===0?(Or.layers=Ar(Or.refId,Br),mr(Or.layers,Br)):Or.ty===4?yr(Or.shapes):Or.ty===5&&Fr(Or)}}function dr(Ur,Br){if(Ur){var Or=0,Dr=Ur.length;for(Or=0;Or<Dr;Or+=1)Ur[Or].t===1&&(Ur[Or].data.layers=Ar(Ur[Or].data.refId,Br),mr(Ur[Or].data.layers,Br))}}function vr(Ur,Br){for(var Or=0,Dr=Br.length;Or<Dr;){if(Br[Or].id===Ur)return Br[Or];Or+=1}return null}function Ar(Ur,Br){var Or=vr(Ur,Br);return Or?Or.layers.__used?JSON.parse(JSON.stringify(Or.layers)):(Or.layers.__used=!0,Or.layers):null}function yr(Ur){var Br,Or=Ur.length,Dr,Wr;for(Br=Or-1;Br>=0;Br-=1)if(Ur[Br].ty==="sh")if(Ur[Br].ks.k.i)wr(Ur[Br].ks.k);else for(Wr=Ur[Br].ks.k.length,Dr=0;Dr<Wr;Dr+=1)Ur[Br].ks.k[Dr].s&&wr(Ur[Br].ks.k[Dr].s[0]),Ur[Br].ks.k[Dr].e&&wr(Ur[Br].ks.k[Dr].e[0]);else Ur[Br].ty==="gr"&&yr(Ur[Br].it)}function wr(Ur){var Br,Or=Ur.i.length;for(Br=0;Br<Or;Br+=1)Ur.i[Br][0]+=Ur.v[Br][0],Ur.i[Br][1]+=Ur.v[Br][1],Ur.o[Br][0]+=Ur.v[Br][0],Ur.o[Br][1]+=Ur.v[Br][1]}function br(Ur,Br){var Or=Br?Br.split("."):[100,100,100];return Ur[0]>Or[0]?!0:Or[0]>Ur[0]?!1:Ur[1]>Or[1]?!0:Or[1]>Ur[1]?!1:Ur[2]>Or[2]?!0:Or[2]>Ur[2]?!1:null}var Sr=function(){var Ur=[4,4,14];function Br(Dr){var Wr=Dr.t.d;Dr.t.d={k:[{s:Wr,t:0}]}}function Or(Dr){var Wr,$r=Dr.length;for(Wr=0;Wr<$r;Wr+=1)Dr[Wr].ty===5&&Br(Dr[Wr])}return function(Dr){if(br(Ur,Dr.v)&&(Or(Dr.layers),Dr.assets)){var Wr,$r=Dr.assets.length;for(Wr=0;Wr<$r;Wr+=1)Dr.assets[Wr].layers&&Or(Dr.assets[Wr].layers)}}}(),xr=function(){var Ur=[4,7,99];return function(Br){if(Br.chars&&!br(Ur,Br.v)){var Or,Dr=Br.chars.length;for(Or=0;Or<Dr;Or+=1){var Wr=Br.chars[Or];Wr.data&&Wr.data.shapes&&(yr(Wr.data.shapes),Wr.data.ip=0,Wr.data.op=99999,Wr.data.st=0,Wr.data.sr=1,Wr.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},Br.chars[Or].t||(Wr.data.shapes.push({ty:"no"}),Wr.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),Cr=function(){var Ur=[5,7,15];function Br(Dr){var Wr=Dr.t.p;typeof Wr.a=="number"&&(Wr.a={a:0,k:Wr.a}),typeof Wr.p=="number"&&(Wr.p={a:0,k:Wr.p}),typeof Wr.r=="number"&&(Wr.r={a:0,k:Wr.r})}function Or(Dr){var Wr,$r=Dr.length;for(Wr=0;Wr<$r;Wr+=1)Dr[Wr].ty===5&&Br(Dr[Wr])}return function(Dr){if(br(Ur,Dr.v)&&(Or(Dr.layers),Dr.assets)){var Wr,$r=Dr.assets.length;for(Wr=0;Wr<$r;Wr+=1)Dr.assets[Wr].layers&&Or(Dr.assets[Wr].layers)}}}(),Ir=function(){var Ur=[4,1,9];function Br(Dr){var Wr,$r=Dr.length,Yr,Qi;for(Wr=0;Wr<$r;Wr+=1)if(Dr[Wr].ty==="gr")Br(Dr[Wr].it);else if(Dr[Wr].ty==="fl"||Dr[Wr].ty==="st")if(Dr[Wr].c.k&&Dr[Wr].c.k[0].i)for(Qi=Dr[Wr].c.k.length,Yr=0;Yr<Qi;Yr+=1)Dr[Wr].c.k[Yr].s&&(Dr[Wr].c.k[Yr].s[0]/=255,Dr[Wr].c.k[Yr].s[1]/=255,Dr[Wr].c.k[Yr].s[2]/=255,Dr[Wr].c.k[Yr].s[3]/=255),Dr[Wr].c.k[Yr].e&&(Dr[Wr].c.k[Yr].e[0]/=255,Dr[Wr].c.k[Yr].e[1]/=255,Dr[Wr].c.k[Yr].e[2]/=255,Dr[Wr].c.k[Yr].e[3]/=255);else Dr[Wr].c.k[0]/=255,Dr[Wr].c.k[1]/=255,Dr[Wr].c.k[2]/=255,Dr[Wr].c.k[3]/=255}function Or(Dr){var Wr,$r=Dr.length;for(Wr=0;Wr<$r;Wr+=1)Dr[Wr].ty===4&&Br(Dr[Wr].shapes)}return function(Dr){if(br(Ur,Dr.v)&&(Or(Dr.layers),Dr.assets)){var Wr,$r=Dr.assets.length;for(Wr=0;Wr<$r;Wr+=1)Dr.assets[Wr].layers&&Or(Dr.assets[Wr].layers)}}}(),Rr=function(){var Ur=[4,4,18];function Br(Dr){var Wr,$r=Dr.length,Yr,Qi;for(Wr=$r-1;Wr>=0;Wr-=1)if(Dr[Wr].ty==="sh")if(Dr[Wr].ks.k.i)Dr[Wr].ks.k.c=Dr[Wr].closed;else for(Qi=Dr[Wr].ks.k.length,Yr=0;Yr<Qi;Yr+=1)Dr[Wr].ks.k[Yr].s&&(Dr[Wr].ks.k[Yr].s[0].c=Dr[Wr].closed),Dr[Wr].ks.k[Yr].e&&(Dr[Wr].ks.k[Yr].e[0].c=Dr[Wr].closed);else Dr[Wr].ty==="gr"&&Br(Dr[Wr].it)}function Or(Dr){var Wr,$r,Yr=Dr.length,Qi,rs,Kr,Qr;for($r=0;$r<Yr;$r+=1){if(Wr=Dr[$r],Wr.hasMask){var Vr=Wr.masksProperties;for(rs=Vr.length,Qi=0;Qi<rs;Qi+=1)if(Vr[Qi].pt.k.i)Vr[Qi].pt.k.c=Vr[Qi].cl;else for(Qr=Vr[Qi].pt.k.length,Kr=0;Kr<Qr;Kr+=1)Vr[Qi].pt.k[Kr].s&&(Vr[Qi].pt.k[Kr].s[0].c=Vr[Qi].cl),Vr[Qi].pt.k[Kr].e&&(Vr[Qi].pt.k[Kr].e[0].c=Vr[Qi].cl)}Wr.ty===4&&Br(Wr.shapes)}}return function(Dr){if(br(Ur,Dr.v)&&(Or(Dr.layers),Dr.assets)){var Wr,$r=Dr.assets.length;for(Wr=0;Wr<$r;Wr+=1)Dr.assets[Wr].layers&&Or(Dr.assets[Wr].layers)}}}();function Pr(Ur){Ur.__complete||(Ir(Ur),Sr(Ur),xr(Ur),Cr(Ur),Rr(Ur),mr(Ur.layers,Ur.assets),dr(Ur.chars,Ur.assets),Ur.__complete=!0)}function Fr(Ur){Ur.t.a.length===0&&"m"in Ur.t.p}var Nr={};return Nr.completeData=Pr,Nr.checkColors=Ir,Nr.checkChars=xr,Nr.checkPathProperties=Cr,Nr.checkShapes=Rr,Nr.completeLayers=mr,Nr}if(sr.dataManager||(sr.dataManager=gr()),sr.assetLoader||(sr.assetLoader=function(){function mr(vr){var Ar=vr.getResponseHeader("content-type");return Ar&&vr.responseType==="json"&&Ar.indexOf("json")!==-1||vr.response&&typeof vr.response=="object"?vr.response:vr.response&&typeof vr.response=="string"?JSON.parse(vr.response):vr.responseText?JSON.parse(vr.responseText):null}function dr(vr,Ar,yr,wr){var br,Sr=new XMLHttpRequest;try{Sr.responseType="json"}catch{}Sr.onreadystatechange=function(){if(Sr.readyState===4)if(Sr.status===200)br=mr(Sr),yr(br);else try{br=mr(Sr),yr(br)}catch(xr){wr&&wr(xr)}};try{Sr.open("GET",vr,!0)}catch{Sr.open("GET",Ar+"/"+vr,!0)}Sr.send()}return{load:dr}}()),pr.data.type==="loadAnimation")sr.assetLoader.load(pr.data.path,pr.data.fullPath,function(mr){sr.dataManager.completeData(mr),sr.postMessage({id:pr.data.id,payload:mr,status:"success"})},function(){sr.postMessage({id:pr.data.id,status:"error"})});else if(pr.data.type==="complete"){var _r=pr.data.animation;sr.dataManager.completeData(_r),sr.postMessage({id:pr.data.id,payload:_r,status:"success"})}else pr.data.type==="loadData"&&sr.assetLoader.load(pr.data.path,pr.data.fullPath,function(mr){sr.postMessage({id:pr.data.id,payload:mr,status:"success"})},function(){sr.postMessage({id:pr.data.id,status:"error"})})}),rr.onmessage=function(ur){var pr=ur.data,gr=pr.id,_r=er[gr];er[gr]=null,pr.status==="success"?_r.onComplete(pr.payload):_r.onError&&_r.onError()})}function lr(ur,pr){ir+=1;var gr="processId_"+ir;return er[gr]={onComplete:ur,onError:pr},gr}function cr(ur,pr,gr){or();var _r=lr(pr,gr);rr.postMessage({type:"loadAnimation",path:ur,fullPath:window.location.origin+window.location.pathname,id:_r})}function hr(ur,pr,gr){or();var _r=lr(pr,gr);rr.postMessage({type:"loadData",path:ur,fullPath:window.location.origin+window.location.pathname,id:_r})}function fr(ur,pr,gr){or();var _r=lr(pr,gr);rr.postMessage({type:"complete",animation:ur,id:_r})}return{loadAnimation:cr,loadData:hr,completeAnimation:fr}}(),ImagePreloader=function(){var ir=function(){var dr=createTag("canvas");dr.width=1,dr.height=1;var vr=dr.getContext("2d");return vr.fillStyle="rgba(0,0,0,0)",vr.fillRect(0,0,1,1),dr}();function er(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function tr(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function rr(dr,vr,Ar){var yr="";if(dr.e)yr=dr.p;else if(vr){var wr=dr.p;wr.indexOf("images/")!==-1&&(wr=wr.split("/")[1]),yr=vr+wr}else yr=Ar,yr+=dr.u?dr.u:"",yr+=dr.p;return yr}function nr(dr){var vr=0,Ar=setInterval(function(){var yr=dr.getBBox();(yr.width||vr>500)&&(this._imageLoaded(),clearInterval(Ar)),vr+=1}.bind(this),50)}function sr(dr){var vr=rr(dr,this.assetsPath,this.path),Ar=createNS("image");isSafari?this.testImageLoaded(Ar):Ar.addEventListener("load",this._imageLoaded,!1),Ar.addEventListener("error",function(){yr.img=ir,this._imageLoaded()}.bind(this),!1),Ar.setAttributeNS("http://www.w3.org/1999/xlink","href",vr),this._elementHelper.append?this._elementHelper.append(Ar):this._elementHelper.appendChild(Ar);var yr={img:Ar,assetData:dr};return yr}function ar(dr){var vr=rr(dr,this.assetsPath,this.path),Ar=createTag("img");Ar.crossOrigin="anonymous",Ar.addEventListener("load",this._imageLoaded,!1),Ar.addEventListener("error",function(){yr.img=ir,this._imageLoaded()}.bind(this),!1),Ar.src=vr;var yr={img:Ar,assetData:dr};return yr}function or(dr){var vr={assetData:dr},Ar=rr(dr,this.assetsPath,this.path);return dataManager.loadData(Ar,function(yr){vr.img=yr,this._footageLoaded()}.bind(this),function(){vr.img={},this._footageLoaded()}.bind(this)),vr}function lr(dr,vr){this.imagesLoadedCb=vr;var Ar,yr=dr.length;for(Ar=0;Ar<yr;Ar+=1)dr[Ar].layers||(!dr[Ar].t||dr[Ar].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(dr[Ar]))):dr[Ar].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(dr[Ar]))))}function cr(dr){this.path=dr||""}function hr(dr){this.assetsPath=dr||""}function fr(dr){for(var vr=0,Ar=this.images.length;vr<Ar;){if(this.images[vr].assetData===dr)return this.images[vr].img;vr+=1}return null}function ur(){this.imagesLoadedCb=null,this.images.length=0}function pr(){return this.totalImages===this.loadedAssets}function gr(){return this.totalFootages===this.loadedFootagesCount}function _r(dr,vr){dr==="svg"?(this._elementHelper=vr,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function mr(){this._imageLoaded=er.bind(this),this._footageLoaded=tr.bind(this),this.testImageLoaded=nr.bind(this),this.createFootageData=or.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return mr.prototype={loadAssets:lr,setAssetsPath:hr,setPath:cr,loadedImages:pr,loadedFootages:gr,destroy:ur,getAsset:fr,createImgData:ar,createImageData:sr,imageLoaded:er,footageLoaded:tr,setCacheType:_r},mr}();BaseEvent.prototype={triggerEvent:function(ir,er){if(this._cbs[ir])for(var tr=this._cbs[ir],rr=0;rr<tr.length;rr+=1)tr[rr](er)},addEventListener:function(ir,er){return this._cbs[ir]||(this._cbs[ir]=[]),this._cbs[ir].push(er),function(){this.removeEventListener(ir,er)}.bind(this)},removeEventListener:function(ir,er){if(!er)this._cbs[ir]=null;else if(this._cbs[ir]){for(var tr=0,rr=this._cbs[ir].length;tr<rr;)this._cbs[ir][tr]===er&&(this._cbs[ir].splice(tr,1),tr-=1,rr-=1),tr+=1;this._cbs[ir].length||(this._cbs[ir]=null)}}};const markerParser=function(){function ir(er){for(var tr=er.split(`\r
`),rr={},nr,sr=0,ar=0;ar<tr.length;ar+=1)nr=tr[ar].split(":"),nr.length===2&&(rr[nr[0]]=nr[1].trim(),sr+=1);if(sr===0)throw new Error;return rr}return function(er){for(var tr=[],rr=0;rr<er.length;rr+=1){var nr=er[rr],sr={time:nr.tm,duration:nr.dr};try{sr.payload=JSON.parse(er[rr].cm)}catch{try{sr.payload=ir(er[rr].cm)}catch{sr.payload={name:er[rr].cm}}}tr.push(sr)}return tr}}(),ProjectInterface=function(){function ir(er){this.compositions.push(er)}return function(){function er(tr){for(var rr=0,nr=this.compositions.length;rr<nr;){if(this.compositions[rr].data&&this.compositions[rr].data.nm===tr)return this.compositions[rr].prepareFrame&&this.compositions[rr].data.xt&&this.compositions[rr].prepareFrame(this.currentFrame),this.compositions[rr].compInterface;rr+=1}return null}return er.compositions=[],er.currentFrame=0,er.registerComposition=ir,er}}(),renderers={},registerRenderer=(ir,er)=>{renderers[ir]=er},AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0)};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(ir){(ir.wrapper||ir.container)&&(this.wrapper=ir.wrapper||ir.container);var er="svg";ir.animType?er=ir.animType:ir.renderer&&(er=ir.renderer);const tr=getRenderer(er);this.renderer=new tr(this,ir.rendererSettings),this.imagePreloader.setCacheType(er,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=er,ir.loop===""||ir.loop===null||ir.loop===void 0||ir.loop===!0?this.loop=!0:ir.loop===!1?this.loop=!1:this.loop=parseInt(ir.loop,10),this.autoplay="autoplay"in ir?ir.autoplay:!0,this.name=ir.name?ir.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(ir,"autoloadSegments")?ir.autoloadSegments:!0,this.assetsPath=ir.assetsPath,this.initialSegment=ir.initialSegment,ir.audioFactory&&this.audioController.setAudioFactory(ir.audioFactory),ir.animationData?this.setupAnimation(ir.animationData):ir.path&&(ir.path.lastIndexOf("\\")!==-1?this.path=ir.path.substr(0,ir.path.lastIndexOf("\\")+1):this.path=ir.path.substr(0,ir.path.lastIndexOf("/")+1),this.fileName=ir.path.substr(ir.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(ir.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(ir){dataManager.completeAnimation(ir,this.configAnimation)},AnimationItem.prototype.setData=function(ir,er){er&&typeof er!="object"&&(er=JSON.parse(er));var tr={wrapper:ir,animationData:er},rr=ir.attributes;tr.path=rr.getNamedItem("data-animation-path")?rr.getNamedItem("data-animation-path").value:rr.getNamedItem("data-bm-path")?rr.getNamedItem("data-bm-path").value:rr.getNamedItem("bm-path")?rr.getNamedItem("bm-path").value:"",tr.animType=rr.getNamedItem("data-anim-type")?rr.getNamedItem("data-anim-type").value:rr.getNamedItem("data-bm-type")?rr.getNamedItem("data-bm-type").value:rr.getNamedItem("bm-type")?rr.getNamedItem("bm-type").value:rr.getNamedItem("data-bm-renderer")?rr.getNamedItem("data-bm-renderer").value:rr.getNamedItem("bm-renderer")?rr.getNamedItem("bm-renderer").value:"canvas";var nr=rr.getNamedItem("data-anim-loop")?rr.getNamedItem("data-anim-loop").value:rr.getNamedItem("data-bm-loop")?rr.getNamedItem("data-bm-loop").value:rr.getNamedItem("bm-loop")?rr.getNamedItem("bm-loop").value:"";nr==="false"?tr.loop=!1:nr==="true"?tr.loop=!0:nr!==""&&(tr.loop=parseInt(nr,10));var sr=rr.getNamedItem("data-anim-autoplay")?rr.getNamedItem("data-anim-autoplay").value:rr.getNamedItem("data-bm-autoplay")?rr.getNamedItem("data-bm-autoplay").value:rr.getNamedItem("bm-autoplay")?rr.getNamedItem("bm-autoplay").value:!0;tr.autoplay=sr!=="false",tr.name=rr.getNamedItem("data-name")?rr.getNamedItem("data-name").value:rr.getNamedItem("data-bm-name")?rr.getNamedItem("data-bm-name").value:rr.getNamedItem("bm-name")?rr.getNamedItem("bm-name").value:"";var ar=rr.getNamedItem("data-anim-prerender")?rr.getNamedItem("data-anim-prerender").value:rr.getNamedItem("data-bm-prerender")?rr.getNamedItem("data-bm-prerender").value:rr.getNamedItem("bm-prerender")?rr.getNamedItem("bm-prerender").value:"";ar==="false"&&(tr.prerender=!1),this.setParams(tr)},AnimationItem.prototype.includeLayers=function(ir){ir.op>this.animationData.op&&(this.animationData.op=ir.op,this.totalFrames=Math.floor(ir.op-this.animationData.ip));var er=this.animationData.layers,tr,rr=er.length,nr=ir.layers,sr,ar=nr.length;for(sr=0;sr<ar;sr+=1)for(tr=0;tr<rr;){if(er[tr].id===nr[sr].id){er[tr]=nr[sr];break}tr+=1}if((ir.chars||ir.fonts)&&(this.renderer.globalData.fontManager.addChars(ir.chars),this.renderer.globalData.fontManager.addFonts(ir.fonts,this.renderer.globalData.defs)),ir.assets)for(rr=ir.assets.length,tr=0;tr<rr;tr+=1)this.animationData.assets.push(ir.assets[tr]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(ir){this.animationData=ir;var er=getExpressionsPlugin();er&&er.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var ir=this.animationData.segments;if(!ir||ir.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var er=ir.shift();this.timeCompleted=er.time*this.frameRate;var tr=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(tr,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){var ir=this.animationData.segments;ir||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(ir){if(this.renderer)try{this.animationData=ir,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(ir),ir.assets||(ir.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(ir.assets),this.markers=markerParser(ir.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(er){this.triggerConfigError(er)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var ir=getExpressionsPlugin();ir&&ir.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(){this.renderer.updateContainerSize()},AnimationItem.prototype.setSubframe=function(ir){this.isSubframeEnabled=!!ir},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(ir){this.triggerRenderFrameError(ir)}},AnimationItem.prototype.play=function(ir){ir&&this.name!==ir||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_pause"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(ir){ir&&this.name!==ir||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_play"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(ir){ir&&this.name!==ir||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(ir){ir&&this.name!==ir||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(ir){for(var er,tr=0;tr<this.markers.length;tr+=1)if(er=this.markers[tr],er.payload&&er.payload.name===ir)return er;return null},AnimationItem.prototype.goToAndStop=function(ir,er,tr){if(!(tr&&this.name!==tr)){var rr=Number(ir);if(isNaN(rr)){var nr=this.getMarkerData(ir);nr&&this.goToAndStop(nr.time,!0)}else er?this.setCurrentRawFrameValue(ir):this.setCurrentRawFrameValue(ir*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(ir,er,tr){if(!(tr&&this.name!==tr)){var rr=Number(ir);if(isNaN(rr)){var nr=this.getMarkerData(ir);nr&&(nr.duration?this.playSegments([nr.time,nr.time+nr.duration],!0):this.goToAndStop(nr.time,!0))}else this.goToAndStop(rr,er,tr);this.play()}},AnimationItem.prototype.advanceTime=function(ir){if(!(this.isPaused===!0||this.isLoaded===!1)){var er=this.currentRawFrame+ir*this.frameModifier,tr=!1;er>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(er>this.totalFrames?er%this.totalFrames:0)||(tr=!0,er=this.totalFrames-1):er>=this.totalFrames?(this.playCount+=1,this.checkSegments(er%this.totalFrames)||(this.setCurrentRawFrameValue(er%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(er):er<0?this.checkSegments(er%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+er%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(tr=!0,er=0)):this.setCurrentRawFrameValue(er),tr&&(this.setCurrentRawFrameValue(er),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(ir,er){this.playCount=0,ir[1]<ir[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=ir[0]-ir[1],this.timeCompleted=this.totalFrames,this.firstFrame=ir[1],this.setCurrentRawFrameValue(this.totalFrames-.001-er)):ir[1]>ir[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=ir[1]-ir[0],this.timeCompleted=this.totalFrames,this.firstFrame=ir[0],this.setCurrentRawFrameValue(.001+er)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(ir,er){var tr=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<ir?tr=ir:this.currentRawFrame+this.firstFrame>er&&(tr=er-ir)),this.firstFrame=ir,this.totalFrames=er-ir,this.timeCompleted=this.totalFrames,tr!==-1&&this.goToAndStop(tr,!0)},AnimationItem.prototype.playSegments=function(ir,er){if(er&&(this.segments.length=0),typeof ir[0]=="object"){var tr,rr=ir.length;for(tr=0;tr<rr;tr+=1)this.segments.push(ir[tr])}else this.segments.push(ir);this.segments.length&&er&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(ir){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),ir&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(ir){return this.segments.length?(this.adjustSegment(this.segments.shift(),ir),!0):!1},AnimationItem.prototype.destroy=function(ir){ir&&this.name!==ir||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.renderer=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(ir){this.currentRawFrame=ir,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(ir){this.playSpeed=ir,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(ir){this.playDirection=ir<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setVolume=function(ir,er){er&&this.name!==er||this.audioController.setVolume(ir)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(ir){ir&&this.name!==ir||this.audioController.mute()},AnimationItem.prototype.unmute=function(ir){ir&&this.name!==ir||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(ir){var er="";if(ir.e)er=ir.p;else if(this.assetsPath){var tr=ir.p;tr.indexOf("images/")!==-1&&(tr=tr.split("/")[1]),er=this.assetsPath+tr}else er=this.path,er+=ir.u?ir.u:"",er+=ir.p;return er},AnimationItem.prototype.getAssetData=function(ir){for(var er=0,tr=this.assets.length;er<tr;){if(ir===this.assets[er].id)return this.assets[er];er+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(ir){return ir?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(ir,er,tr){try{var rr=this.renderer.getElementByPath(ir);rr.updateDocumentData(er,tr)}catch{}},AnimationItem.prototype.trigger=function(ir){if(this._cbs&&this._cbs[ir])switch(ir){case"enterFrame":this.triggerEvent(ir,new BMEnterFrameEvent(ir,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(ir,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(ir,new BMCompleteLoopEvent(ir,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(ir,new BMCompleteEvent(ir,this.frameMult));break;case"segmentStart":this.triggerEvent(ir,new BMSegmentStartEvent(ir,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(ir,new BMDestroyEvent(ir,this));break;default:this.triggerEvent(ir)}ir==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(ir,this.currentFrame,this.totalFrames,this.frameMult)),ir==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(ir,this.loop,this.playCount,this.frameMult)),ir==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(ir,this.frameMult)),ir==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(ir,this.firstFrame,this.totalFrames)),ir==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(ir,this))},AnimationItem.prototype.triggerRenderFrameError=function(ir){var er=new BMRenderFrameErrorEvent(ir,this.currentFrame);this.triggerEvent("error",er),this.onError&&this.onError.call(this,er)},AnimationItem.prototype.triggerConfigError=function(ir){var er=new BMConfigErrorEvent(ir,this.currentFrame);this.triggerEvent("error",er),this.onError&&this.onError.call(this,er)};const animationManager=function(){var ir={},er=[],tr=0,rr=0,nr=0,sr=!0,ar=!1;function or(Br){for(var Or=0,Dr=Br.target;Or<rr;)er[Or].animation===Dr&&(er.splice(Or,1),Or-=1,rr-=1,Dr.isPaused||fr()),Or+=1}function lr(Br,Or){if(!Br)return null;for(var Dr=0;Dr<rr;){if(er[Dr].elem===Br&&er[Dr].elem!==null)return er[Dr].animation;Dr+=1}var Wr=new AnimationItem;return ur(Wr,Br),Wr.setData(Br,Or),Wr}function cr(){var Br,Or=er.length,Dr=[];for(Br=0;Br<Or;Br+=1)Dr.push(er[Br].animation);return Dr}function hr(){nr+=1,Ir()}function fr(){nr-=1}function ur(Br,Or){Br.addEventListener("destroy",or),Br.addEventListener("_active",hr),Br.addEventListener("_idle",fr),er.push({elem:Or,animation:Br}),rr+=1}function pr(Br){var Or=new AnimationItem;return ur(Or,null),Or.setParams(Br),Or}function gr(Br,Or){var Dr;for(Dr=0;Dr<rr;Dr+=1)er[Dr].animation.setSpeed(Br,Or)}function _r(Br,Or){var Dr;for(Dr=0;Dr<rr;Dr+=1)er[Dr].animation.setDirection(Br,Or)}function mr(Br){var Or;for(Or=0;Or<rr;Or+=1)er[Or].animation.play(Br)}function dr(Br){var Or=Br-tr,Dr;for(Dr=0;Dr<rr;Dr+=1)er[Dr].animation.advanceTime(Or);tr=Br,nr&&!ar?window.requestAnimationFrame(dr):sr=!0}function vr(Br){tr=Br,window.requestAnimationFrame(dr)}function Ar(Br){var Or;for(Or=0;Or<rr;Or+=1)er[Or].animation.pause(Br)}function yr(Br,Or,Dr){var Wr;for(Wr=0;Wr<rr;Wr+=1)er[Wr].animation.goToAndStop(Br,Or,Dr)}function wr(Br){var Or;for(Or=0;Or<rr;Or+=1)er[Or].animation.stop(Br)}function br(Br){var Or;for(Or=0;Or<rr;Or+=1)er[Or].animation.togglePause(Br)}function Sr(Br){var Or;for(Or=rr-1;Or>=0;Or-=1)er[Or].animation.destroy(Br)}function xr(Br,Or,Dr){var Wr=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),$r,Yr=Wr.length;for($r=0;$r<Yr;$r+=1)Dr&&Wr[$r].setAttribute("data-bm-type",Dr),lr(Wr[$r],Br);if(Or&&Yr===0){Dr||(Dr="svg");var Qi=document.getElementsByTagName("body")[0];Qi.innerText="";var rs=createTag("div");rs.style.width="100%",rs.style.height="100%",rs.setAttribute("data-bm-type",Dr),Qi.appendChild(rs),lr(rs,Br)}}function Cr(){var Br;for(Br=0;Br<rr;Br+=1)er[Br].animation.resize()}function Ir(){!ar&&nr&&sr&&(window.requestAnimationFrame(vr),sr=!1)}function Rr(){ar=!0}function Pr(){ar=!1,Ir()}function Fr(Br,Or){var Dr;for(Dr=0;Dr<rr;Dr+=1)er[Dr].animation.setVolume(Br,Or)}function Nr(Br){var Or;for(Or=0;Or<rr;Or+=1)er[Or].animation.mute(Br)}function Ur(Br){var Or;for(Or=0;Or<rr;Or+=1)er[Or].animation.unmute(Br)}return ir.registerAnimation=lr,ir.loadAnimation=pr,ir.setSpeed=gr,ir.setDirection=_r,ir.play=mr,ir.pause=Ar,ir.stop=wr,ir.togglePause=br,ir.searchAnimations=xr,ir.resize=Cr,ir.goToAndStop=yr,ir.destroy=Sr,ir.freeze=Rr,ir.unfreeze=Pr,ir.setVolume=Fr,ir.mute=Nr,ir.unmute=Ur,ir.getRegisteredAnimations=cr,ir}(),BezierFactory=function(){var ir={};ir.getBezierEasing=tr;var er={};function tr(vr,Ar,yr,wr,br){var Sr=br||("bez_"+vr+"_"+Ar+"_"+yr+"_"+wr).replace(/\./g,"p");if(er[Sr])return er[Sr];var xr=new dr([vr,Ar,yr,wr]);return er[Sr]=xr,xr}var rr=4,nr=.001,sr=1e-7,ar=10,or=11,lr=1/(or-1),cr=typeof Float32Array=="function";function hr(vr,Ar){return 1-3*Ar+3*vr}function fr(vr,Ar){return 3*Ar-6*vr}function ur(vr){return 3*vr}function pr(vr,Ar,yr){return((hr(Ar,yr)*vr+fr(Ar,yr))*vr+ur(Ar))*vr}function gr(vr,Ar,yr){return 3*hr(Ar,yr)*vr*vr+2*fr(Ar,yr)*vr+ur(Ar)}function _r(vr,Ar,yr,wr,br){var Sr,xr,Cr=0;do xr=Ar+(yr-Ar)/2,Sr=pr(xr,wr,br)-vr,Sr>0?yr=xr:Ar=xr;while(Math.abs(Sr)>sr&&++Cr<ar);return xr}function mr(vr,Ar,yr,wr){for(var br=0;br<rr;++br){var Sr=gr(Ar,yr,wr);if(Sr===0)return Ar;var xr=pr(Ar,yr,wr)-vr;Ar-=xr/Sr}return Ar}function dr(vr){this._p=vr,this._mSampleValues=cr?new Float32Array(or):new Array(or),this._precomputed=!1,this.get=this.get.bind(this)}return dr.prototype={get:function(vr){var Ar=this._p[0],yr=this._p[1],wr=this._p[2],br=this._p[3];return this._precomputed||this._precompute(),Ar===yr&&wr===br?vr:vr===0?0:vr===1?1:pr(this._getTForX(vr),yr,br)},_precompute:function(){var vr=this._p[0],Ar=this._p[1],yr=this._p[2],wr=this._p[3];this._precomputed=!0,(vr!==Ar||yr!==wr)&&this._calcSampleValues()},_calcSampleValues:function(){for(var vr=this._p[0],Ar=this._p[2],yr=0;yr<or;++yr)this._mSampleValues[yr]=pr(yr*lr,vr,Ar)},_getTForX:function(vr){for(var Ar=this._p[0],yr=this._p[2],wr=this._mSampleValues,br=0,Sr=1,xr=or-1;Sr!==xr&&wr[Sr]<=vr;++Sr)br+=lr;--Sr;var Cr=(vr-wr[Sr])/(wr[Sr+1]-wr[Sr]),Ir=br+Cr*lr,Rr=gr(Ir,Ar,yr);return Rr>=nr?mr(vr,Ir,Ar,yr):Rr===0?Ir:_r(vr,br,br+lr,Ar,yr)}},ir}(),pooling=function(){function ir(er){return er.concat(createSizedArray(er.length))}return{double:ir}}(),poolFactory=function(){return function(ir,er,tr){var rr=0,nr=ir,sr=createSizedArray(nr),ar={newElement:or,release:lr};function or(){var cr;return rr?(rr-=1,cr=sr[rr]):cr=er(),cr}function lr(cr){rr===nr&&(sr=pooling.double(sr),nr*=2),tr&&tr(cr),sr[rr]=cr,rr+=1}return ar}}(),bezierLengthPool=function(){function ir(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,ir)}(),segmentsLengthPool=function(){function ir(){return{lengths:[],totalLength:0}}function er(tr){var rr,nr=tr.lengths.length;for(rr=0;rr<nr;rr+=1)bezierLengthPool.release(tr.lengths[rr]);tr.lengths.length=0}return poolFactory(8,ir,er)}(),bez=bezFunction(),PropertyFactory=function(){var ir=initialDefaultFrame,er=Math.abs;function tr(mr,dr){var vr=this.offsetTime,Ar;this.propType==="multidimensional"&&(Ar=createTypedArray("float32",this.pv.length));for(var yr=dr.lastIndex,wr=yr,br=this.keyframes.length-1,Sr=!0,xr,Cr,Ir;Sr;){if(xr=this.keyframes[wr],Cr=this.keyframes[wr+1],wr===br-1&&mr>=Cr.t-vr){xr.h&&(xr=Cr),yr=0;break}if(Cr.t-vr>mr){yr=wr;break}wr<br-1?wr+=1:(yr=0,Sr=!1)}Ir=this.keyframesMetadata[wr]||{};var Rr,Pr,Fr,Nr,Ur,Br,Or=Cr.t-vr,Dr=xr.t-vr,Wr;if(xr.to){Ir.bezierData||(Ir.bezierData=bez.buildBezierData(xr.s,Cr.s||xr.e,xr.to,xr.ti));var $r=Ir.bezierData;if(mr>=Or||mr<Dr){var Yr=mr>=Or?$r.points.length-1:0;for(Pr=$r.points[Yr].point.length,Rr=0;Rr<Pr;Rr+=1)Ar[Rr]=$r.points[Yr].point[Rr]}else{Ir.__fnct?Br=Ir.__fnct:(Br=BezierFactory.getBezierEasing(xr.o.x,xr.o.y,xr.i.x,xr.i.y,xr.n).get,Ir.__fnct=Br),Fr=Br((mr-Dr)/(Or-Dr));var Qi=$r.segmentLength*Fr,rs,Kr=dr.lastFrame<mr&&dr._lastKeyframeIndex===wr?dr._lastAddedLength:0;for(Ur=dr.lastFrame<mr&&dr._lastKeyframeIndex===wr?dr._lastPoint:0,Sr=!0,Nr=$r.points.length;Sr;){if(Kr+=$r.points[Ur].partialLength,Qi===0||Fr===0||Ur===$r.points.length-1){for(Pr=$r.points[Ur].point.length,Rr=0;Rr<Pr;Rr+=1)Ar[Rr]=$r.points[Ur].point[Rr];break}else if(Qi>=Kr&&Qi<Kr+$r.points[Ur+1].partialLength){for(rs=(Qi-Kr)/$r.points[Ur+1].partialLength,Pr=$r.points[Ur].point.length,Rr=0;Rr<Pr;Rr+=1)Ar[Rr]=$r.points[Ur].point[Rr]+($r.points[Ur+1].point[Rr]-$r.points[Ur].point[Rr])*rs;break}Ur<Nr-1?Ur+=1:Sr=!1}dr._lastPoint=Ur,dr._lastAddedLength=Kr-$r.points[Ur].partialLength,dr._lastKeyframeIndex=wr}}else{var Qr,Vr,Gr,qr,ji;if(br=xr.s.length,Wr=Cr.s||xr.e,this.sh&&xr.h!==1)if(mr>=Or)Ar[0]=Wr[0],Ar[1]=Wr[1],Ar[2]=Wr[2];else if(mr<=Dr)Ar[0]=xr.s[0],Ar[1]=xr.s[1],Ar[2]=xr.s[2];else{var Zr=sr(xr.s),Zi=sr(Wr),Yi=(mr-Dr)/(Or-Dr);nr(Ar,rr(Zr,Zi,Yi))}else for(wr=0;wr<br;wr+=1)xr.h!==1&&(mr>=Or?Fr=1:mr<Dr?Fr=0:(xr.o.x.constructor===Array?(Ir.__fnct||(Ir.__fnct=[]),Ir.__fnct[wr]?Br=Ir.__fnct[wr]:(Qr=xr.o.x[wr]===void 0?xr.o.x[0]:xr.o.x[wr],Vr=xr.o.y[wr]===void 0?xr.o.y[0]:xr.o.y[wr],Gr=xr.i.x[wr]===void 0?xr.i.x[0]:xr.i.x[wr],qr=xr.i.y[wr]===void 0?xr.i.y[0]:xr.i.y[wr],Br=BezierFactory.getBezierEasing(Qr,Vr,Gr,qr).get,Ir.__fnct[wr]=Br)):Ir.__fnct?Br=Ir.__fnct:(Qr=xr.o.x,Vr=xr.o.y,Gr=xr.i.x,qr=xr.i.y,Br=BezierFactory.getBezierEasing(Qr,Vr,Gr,qr).get,xr.keyframeMetadata=Br),Fr=Br((mr-Dr)/(Or-Dr)))),Wr=Cr.s||xr.e,ji=xr.h===1?xr.s[wr]:xr.s[wr]+(Wr[wr]-xr.s[wr])*Fr,this.propType==="multidimensional"?Ar[wr]=ji:Ar=ji}return dr.lastIndex=yr,Ar}function rr(mr,dr,vr){var Ar=[],yr=mr[0],wr=mr[1],br=mr[2],Sr=mr[3],xr=dr[0],Cr=dr[1],Ir=dr[2],Rr=dr[3],Pr,Fr,Nr,Ur,Br;return Fr=yr*xr+wr*Cr+br*Ir+Sr*Rr,Fr<0&&(Fr=-Fr,xr=-xr,Cr=-Cr,Ir=-Ir,Rr=-Rr),1-Fr>1e-6?(Pr=Math.acos(Fr),Nr=Math.sin(Pr),Ur=Math.sin((1-vr)*Pr)/Nr,Br=Math.sin(vr*Pr)/Nr):(Ur=1-vr,Br=vr),Ar[0]=Ur*yr+Br*xr,Ar[1]=Ur*wr+Br*Cr,Ar[2]=Ur*br+Br*Ir,Ar[3]=Ur*Sr+Br*Rr,Ar}function nr(mr,dr){var vr=dr[0],Ar=dr[1],yr=dr[2],wr=dr[3],br=Math.atan2(2*Ar*wr-2*vr*yr,1-2*Ar*Ar-2*yr*yr),Sr=Math.asin(2*vr*Ar+2*yr*wr),xr=Math.atan2(2*vr*wr-2*Ar*yr,1-2*vr*vr-2*yr*yr);mr[0]=br/degToRads,mr[1]=Sr/degToRads,mr[2]=xr/degToRads}function sr(mr){var dr=mr[0]*degToRads,vr=mr[1]*degToRads,Ar=mr[2]*degToRads,yr=Math.cos(dr/2),wr=Math.cos(vr/2),br=Math.cos(Ar/2),Sr=Math.sin(dr/2),xr=Math.sin(vr/2),Cr=Math.sin(Ar/2),Ir=yr*wr*br-Sr*xr*Cr,Rr=Sr*xr*br+yr*wr*Cr,Pr=Sr*wr*br+yr*xr*Cr,Fr=yr*xr*br-Sr*wr*Cr;return[Rr,Pr,Fr,Ir]}function ar(){var mr=this.comp.renderedFrame-this.offsetTime,dr=this.keyframes[0].t-this.offsetTime,vr=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(mr===this._caching.lastFrame||this._caching.lastFrame!==ir&&(this._caching.lastFrame>=vr&&mr>=vr||this._caching.lastFrame<dr&&mr<dr))){this._caching.lastFrame>=mr&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var Ar=this.interpolateValue(mr,this._caching);this.pv=Ar}return this._caching.lastFrame=mr,this.pv}function or(mr){var dr;if(this.propType==="unidimensional")dr=mr*this.mult,er(this.v-dr)>1e-5&&(this.v=dr,this._mdf=!0);else for(var vr=0,Ar=this.v.length;vr<Ar;)dr=mr[vr]*this.mult,er(this.v[vr]-dr)>1e-5&&(this.v[vr]=dr,this._mdf=!0),vr+=1}function lr(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var mr,dr=this.effectsSequence.length,vr=this.kf?this.pv:this.data.k;for(mr=0;mr<dr;mr+=1)vr=this.effectsSequence[mr](vr);this.setVValue(vr),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function cr(mr){this.effectsSequence.push(mr),this.container.addDynamicProperty(this)}function hr(mr,dr,vr,Ar){this.propType="unidimensional",this.mult=vr||1,this.data=dr,this.v=vr?dr.k*vr:dr.k,this.pv=dr.k,this._mdf=!1,this.elem=mr,this.container=Ar,this.comp=mr.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=lr,this.setVValue=or,this.addEffect=cr}function fr(mr,dr,vr,Ar){this.propType="multidimensional",this.mult=vr||1,this.data=dr,this._mdf=!1,this.elem=mr,this.container=Ar,this.comp=mr.comp,this.k=!1,this.kf=!1,this.frameId=-1;var yr,wr=dr.k.length;for(this.v=createTypedArray("float32",wr),this.pv=createTypedArray("float32",wr),this.vel=createTypedArray("float32",wr),yr=0;yr<wr;yr+=1)this.v[yr]=dr.k[yr]*this.mult,this.pv[yr]=dr.k[yr];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=lr,this.setVValue=or,this.addEffect=cr}function ur(mr,dr,vr,Ar){this.propType="unidimensional",this.keyframes=dr.k,this.keyframesMetadata=[],this.offsetTime=mr.data.st,this.frameId=-1,this._caching={lastFrame:ir,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=dr,this.mult=vr||1,this.elem=mr,this.container=Ar,this.comp=mr.comp,this.v=ir,this.pv=ir,this._isFirstFrame=!0,this.getValue=lr,this.setVValue=or,this.interpolateValue=tr,this.effectsSequence=[ar.bind(this)],this.addEffect=cr}function pr(mr,dr,vr,Ar){this.propType="multidimensional";var yr,wr=dr.k.length,br,Sr,xr,Cr;for(yr=0;yr<wr-1;yr+=1)dr.k[yr].to&&dr.k[yr].s&&dr.k[yr+1]&&dr.k[yr+1].s&&(br=dr.k[yr].s,Sr=dr.k[yr+1].s,xr=dr.k[yr].to,Cr=dr.k[yr].ti,(br.length===2&&!(br[0]===Sr[0]&&br[1]===Sr[1])&&bez.pointOnLine2D(br[0],br[1],Sr[0],Sr[1],br[0]+xr[0],br[1]+xr[1])&&bez.pointOnLine2D(br[0],br[1],Sr[0],Sr[1],Sr[0]+Cr[0],Sr[1]+Cr[1])||br.length===3&&!(br[0]===Sr[0]&&br[1]===Sr[1]&&br[2]===Sr[2])&&bez.pointOnLine3D(br[0],br[1],br[2],Sr[0],Sr[1],Sr[2],br[0]+xr[0],br[1]+xr[1],br[2]+xr[2])&&bez.pointOnLine3D(br[0],br[1],br[2],Sr[0],Sr[1],Sr[2],Sr[0]+Cr[0],Sr[1]+Cr[1],Sr[2]+Cr[2]))&&(dr.k[yr].to=null,dr.k[yr].ti=null),br[0]===Sr[0]&&br[1]===Sr[1]&&xr[0]===0&&xr[1]===0&&Cr[0]===0&&Cr[1]===0&&(br.length===2||br[2]===Sr[2]&&xr[2]===0&&Cr[2]===0)&&(dr.k[yr].to=null,dr.k[yr].ti=null));this.effectsSequence=[ar.bind(this)],this.data=dr,this.keyframes=dr.k,this.keyframesMetadata=[],this.offsetTime=mr.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=vr||1,this.elem=mr,this.container=Ar,this.comp=mr.comp,this.getValue=lr,this.setVValue=or,this.interpolateValue=tr,this.frameId=-1;var Ir=dr.k[0].s.length;for(this.v=createTypedArray("float32",Ir),this.pv=createTypedArray("float32",Ir),yr=0;yr<Ir;yr+=1)this.v[yr]=ir,this.pv[yr]=ir;this._caching={lastFrame:ir,lastIndex:0,value:createTypedArray("float32",Ir)},this.addEffect=cr}function gr(mr,dr,vr,Ar,yr){var wr;if(!dr.k.length)wr=new hr(mr,dr,Ar,yr);else if(typeof dr.k[0]=="number")wr=new fr(mr,dr,Ar,yr);else switch(vr){case 0:wr=new ur(mr,dr,Ar,yr);break;case 1:wr=new pr(mr,dr,Ar,yr);break;default:break}return wr.effectsSequence.length&&yr.addDynamicProperty(wr),wr}var _r={getProp:gr};return _r}();DynamicPropertyContainer.prototype={addDynamicProperty:function(ir){this.dynamicProperties.indexOf(ir)===-1&&(this.dynamicProperties.push(ir),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var ir,er=this.dynamicProperties.length;for(ir=0;ir<er;ir+=1)this.dynamicProperties[ir].getValue(),this.dynamicProperties[ir]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(ir){this.container=ir,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};const pointPool=function(){function ir(){return createTypedArray("float32",2)}return poolFactory(8,ir)}();ShapePath.prototype.setPathData=function(ir,er){this.c=ir,this.setLength(er);for(var tr=0;tr<er;)this.v[tr]=pointPool.newElement(),this.o[tr]=pointPool.newElement(),this.i[tr]=pointPool.newElement(),tr+=1},ShapePath.prototype.setLength=function(ir){for(;this._maxLength<ir;)this.doubleArrayLength();this._length=ir},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(ir,er,tr,rr,nr){var sr;switch(this._length=Math.max(this._length,rr+1),this._length>=this._maxLength&&this.doubleArrayLength(),tr){case"v":sr=this.v;break;case"i":sr=this.i;break;case"o":sr=this.o;break;default:sr=[];break}(!sr[rr]||sr[rr]&&!nr)&&(sr[rr]=pointPool.newElement()),sr[rr][0]=ir,sr[rr][1]=er},ShapePath.prototype.setTripleAt=function(ir,er,tr,rr,nr,sr,ar,or){this.setXYAt(ir,er,"v",ar,or),this.setXYAt(tr,rr,"o",ar,or),this.setXYAt(nr,sr,"i",ar,or)},ShapePath.prototype.reverse=function(){var ir=new ShapePath;ir.setPathData(this.c,this._length);var er=this.v,tr=this.o,rr=this.i,nr=0;this.c&&(ir.setTripleAt(er[0][0],er[0][1],rr[0][0],rr[0][1],tr[0][0],tr[0][1],0,!1),nr=1);var sr=this._length-1,ar=this._length,or;for(or=nr;or<ar;or+=1)ir.setTripleAt(er[sr][0],er[sr][1],rr[sr][0],rr[sr][1],tr[sr][0],tr[sr][1],or,!1),sr-=1;return ir};const shapePool=function(){function ir(){return new ShapePath}function er(nr){var sr=nr._length,ar;for(ar=0;ar<sr;ar+=1)pointPool.release(nr.v[ar]),pointPool.release(nr.i[ar]),pointPool.release(nr.o[ar]),nr.v[ar]=null,nr.i[ar]=null,nr.o[ar]=null;nr._length=0,nr.c=!1}function tr(nr){var sr=rr.newElement(),ar,or=nr._length===void 0?nr.v.length:nr._length;for(sr.setLength(or),sr.c=nr.c,ar=0;ar<or;ar+=1)sr.setTripleAt(nr.v[ar][0],nr.v[ar][1],nr.o[ar][0],nr.o[ar][1],nr.i[ar][0],nr.i[ar][1],ar);return sr}var rr=poolFactory(4,ir,er);return rr.clone=tr,rr}();ShapeCollection.prototype.addShape=function(ir){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=ir,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var ir;for(ir=0;ir<this._length;ir+=1)shapePool.release(this.shapes[ir]);this._length=0};const shapeCollectionPool=function(){var ir={newShapeCollection:nr,release:sr},er=0,tr=4,rr=createSizedArray(tr);function nr(){var ar;return er?(er-=1,ar=rr[er]):ar=new ShapeCollection,ar}function sr(ar){var or,lr=ar._length;for(or=0;or<lr;or+=1)shapePool.release(ar.shapes[or]);ar._length=0,er===tr&&(rr=pooling.double(rr),tr*=2),rr[er]=ar,er+=1}return ir}(),ShapePropertyFactory=function(){var ir=-999999;function er(dr,vr,Ar){var yr=Ar.lastIndex,wr,br,Sr,xr,Cr,Ir,Rr,Pr,Fr,Nr=this.keyframes;if(dr<Nr[0].t-this.offsetTime)wr=Nr[0].s[0],Sr=!0,yr=0;else if(dr>=Nr[Nr.length-1].t-this.offsetTime)wr=Nr[Nr.length-1].s?Nr[Nr.length-1].s[0]:Nr[Nr.length-2].e[0],Sr=!0;else{for(var Ur=yr,Br=Nr.length-1,Or=!0,Dr,Wr,$r;Or&&(Dr=Nr[Ur],Wr=Nr[Ur+1],!(Wr.t-this.offsetTime>dr));)Ur<Br-1?Ur+=1:Or=!1;if($r=this.keyframesMetadata[Ur]||{},Sr=Dr.h===1,yr=Ur,!Sr){if(dr>=Wr.t-this.offsetTime)Pr=1;else if(dr<Dr.t-this.offsetTime)Pr=0;else{var Yr;$r.__fnct?Yr=$r.__fnct:(Yr=BezierFactory.getBezierEasing(Dr.o.x,Dr.o.y,Dr.i.x,Dr.i.y).get,$r.__fnct=Yr),Pr=Yr((dr-(Dr.t-this.offsetTime))/(Wr.t-this.offsetTime-(Dr.t-this.offsetTime)))}br=Wr.s?Wr.s[0]:Dr.e[0]}wr=Dr.s[0]}for(Ir=vr._length,Rr=wr.i[0].length,Ar.lastIndex=yr,xr=0;xr<Ir;xr+=1)for(Cr=0;Cr<Rr;Cr+=1)Fr=Sr?wr.i[xr][Cr]:wr.i[xr][Cr]+(br.i[xr][Cr]-wr.i[xr][Cr])*Pr,vr.i[xr][Cr]=Fr,Fr=Sr?wr.o[xr][Cr]:wr.o[xr][Cr]+(br.o[xr][Cr]-wr.o[xr][Cr])*Pr,vr.o[xr][Cr]=Fr,Fr=Sr?wr.v[xr][Cr]:wr.v[xr][Cr]+(br.v[xr][Cr]-wr.v[xr][Cr])*Pr,vr.v[xr][Cr]=Fr}function tr(){var dr=this.comp.renderedFrame-this.offsetTime,vr=this.keyframes[0].t-this.offsetTime,Ar=this.keyframes[this.keyframes.length-1].t-this.offsetTime,yr=this._caching.lastFrame;return yr!==ir&&(yr<vr&&dr<vr||yr>Ar&&dr>Ar)||(this._caching.lastIndex=yr<dr?this._caching.lastIndex:0,this.interpolateShape(dr,this.pv,this._caching)),this._caching.lastFrame=dr,this.pv}function rr(){this.paths=this.localShapeCollection}function nr(dr,vr){if(dr._length!==vr._length||dr.c!==vr.c)return!1;var Ar,yr=dr._length;for(Ar=0;Ar<yr;Ar+=1)if(dr.v[Ar][0]!==vr.v[Ar][0]||dr.v[Ar][1]!==vr.v[Ar][1]||dr.o[Ar][0]!==vr.o[Ar][0]||dr.o[Ar][1]!==vr.o[Ar][1]||dr.i[Ar][0]!==vr.i[Ar][0]||dr.i[Ar][1]!==vr.i[Ar][1])return!1;return!0}function sr(dr){nr(this.v,dr)||(this.v=shapePool.clone(dr),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function ar(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var dr;this.kf?dr=this.pv:this.data.ks?dr=this.data.ks.k:dr=this.data.pt.k;var vr,Ar=this.effectsSequence.length;for(vr=0;vr<Ar;vr+=1)dr=this.effectsSequence[vr](dr);this.setVValue(dr),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function or(dr,vr,Ar){this.propType="shape",this.comp=dr.comp,this.container=dr,this.elem=dr,this.data=vr,this.k=!1,this.kf=!1,this._mdf=!1;var yr=Ar===3?vr.pt.k:vr.ks.k;this.v=shapePool.clone(yr),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=rr,this.effectsSequence=[]}function lr(dr){this.effectsSequence.push(dr),this.container.addDynamicProperty(this)}or.prototype.interpolateShape=er,or.prototype.getValue=ar,or.prototype.setVValue=sr,or.prototype.addEffect=lr;function cr(dr,vr,Ar){this.propType="shape",this.comp=dr.comp,this.elem=dr,this.container=dr,this.offsetTime=dr.data.st,this.keyframes=Ar===3?vr.pt.k:vr.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var yr=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,yr),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=ir,this.reset=rr,this._caching={lastFrame:ir,lastIndex:0},this.effectsSequence=[tr.bind(this)]}cr.prototype.getValue=ar,cr.prototype.interpolateShape=er,cr.prototype.setVValue=sr,cr.prototype.addEffect=lr;var hr=function(){var dr=roundCorner;function vr(Ar,yr){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=yr.d,this.elem=Ar,this.comp=Ar.comp,this.frameId=-1,this.initDynamicPropertyContainer(Ar),this.p=PropertyFactory.getProp(Ar,yr.p,1,0,this),this.s=PropertyFactory.getProp(Ar,yr.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return vr.prototype={reset:rr,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var Ar=this.p.v[0],yr=this.p.v[1],wr=this.s.v[0]/2,br=this.s.v[1]/2,Sr=this.d!==3,xr=this.v;xr.v[0][0]=Ar,xr.v[0][1]=yr-br,xr.v[1][0]=Sr?Ar+wr:Ar-wr,xr.v[1][1]=yr,xr.v[2][0]=Ar,xr.v[2][1]=yr+br,xr.v[3][0]=Sr?Ar-wr:Ar+wr,xr.v[3][1]=yr,xr.i[0][0]=Sr?Ar-wr*dr:Ar+wr*dr,xr.i[0][1]=yr-br,xr.i[1][0]=Sr?Ar+wr:Ar-wr,xr.i[1][1]=yr-br*dr,xr.i[2][0]=Sr?Ar+wr*dr:Ar-wr*dr,xr.i[2][1]=yr+br,xr.i[3][0]=Sr?Ar-wr:Ar+wr,xr.i[3][1]=yr+br*dr,xr.o[0][0]=Sr?Ar+wr*dr:Ar-wr*dr,xr.o[0][1]=yr-br,xr.o[1][0]=Sr?Ar+wr:Ar-wr,xr.o[1][1]=yr+br*dr,xr.o[2][0]=Sr?Ar-wr*dr:Ar+wr*dr,xr.o[2][1]=yr+br,xr.o[3][0]=Sr?Ar-wr:Ar+wr,xr.o[3][1]=yr-br*dr}},extendPrototype([DynamicPropertyContainer],vr),vr}(),fr=function(){function dr(vr,Ar){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=vr,this.comp=vr.comp,this.data=Ar,this.frameId=-1,this.d=Ar.d,this.initDynamicPropertyContainer(vr),Ar.sy===1?(this.ir=PropertyFactory.getProp(vr,Ar.ir,0,0,this),this.is=PropertyFactory.getProp(vr,Ar.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(vr,Ar.pt,0,0,this),this.p=PropertyFactory.getProp(vr,Ar.p,1,0,this),this.r=PropertyFactory.getProp(vr,Ar.r,0,degToRads,this),this.or=PropertyFactory.getProp(vr,Ar.or,0,0,this),this.os=PropertyFactory.getProp(vr,Ar.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return dr.prototype={reset:rr,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var vr=Math.floor(this.pt.v)*2,Ar=Math.PI*2/vr,yr=!0,wr=this.or.v,br=this.ir.v,Sr=this.os.v,xr=this.is.v,Cr=2*Math.PI*wr/(vr*2),Ir=2*Math.PI*br/(vr*2),Rr,Pr,Fr,Nr,Ur=-Math.PI/2;Ur+=this.r.v;var Br=this.data.d===3?-1:1;for(this.v._length=0,Rr=0;Rr<vr;Rr+=1){Pr=yr?wr:br,Fr=yr?Sr:xr,Nr=yr?Cr:Ir;var Or=Pr*Math.cos(Ur),Dr=Pr*Math.sin(Ur),Wr=Or===0&&Dr===0?0:Dr/Math.sqrt(Or*Or+Dr*Dr),$r=Or===0&&Dr===0?0:-Or/Math.sqrt(Or*Or+Dr*Dr);Or+=+this.p.v[0],Dr+=+this.p.v[1],this.v.setTripleAt(Or,Dr,Or-Wr*Nr*Fr*Br,Dr-$r*Nr*Fr*Br,Or+Wr*Nr*Fr*Br,Dr+$r*Nr*Fr*Br,Rr,!0),yr=!yr,Ur+=Ar*Br}},convertPolygonToPath:function(){var vr=Math.floor(this.pt.v),Ar=Math.PI*2/vr,yr=this.or.v,wr=this.os.v,br=2*Math.PI*yr/(vr*4),Sr,xr=-Math.PI*.5,Cr=this.data.d===3?-1:1;for(xr+=this.r.v,this.v._length=0,Sr=0;Sr<vr;Sr+=1){var Ir=yr*Math.cos(xr),Rr=yr*Math.sin(xr),Pr=Ir===0&&Rr===0?0:Rr/Math.sqrt(Ir*Ir+Rr*Rr),Fr=Ir===0&&Rr===0?0:-Ir/Math.sqrt(Ir*Ir+Rr*Rr);Ir+=+this.p.v[0],Rr+=+this.p.v[1],this.v.setTripleAt(Ir,Rr,Ir-Pr*br*wr*Cr,Rr-Fr*br*wr*Cr,Ir+Pr*br*wr*Cr,Rr+Fr*br*wr*Cr,Sr,!0),xr+=Ar*Cr}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],dr),dr}(),ur=function(){function dr(vr,Ar){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=vr,this.comp=vr.comp,this.frameId=-1,this.d=Ar.d,this.initDynamicPropertyContainer(vr),this.p=PropertyFactory.getProp(vr,Ar.p,1,0,this),this.s=PropertyFactory.getProp(vr,Ar.s,1,0,this),this.r=PropertyFactory.getProp(vr,Ar.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return dr.prototype={convertRectToPath:function(){var vr=this.p.v[0],Ar=this.p.v[1],yr=this.s.v[0]/2,wr=this.s.v[1]/2,br=bmMin(yr,wr,this.r.v),Sr=br*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(vr+yr,Ar-wr+br,vr+yr,Ar-wr+br,vr+yr,Ar-wr+Sr,0,!0),this.v.setTripleAt(vr+yr,Ar+wr-br,vr+yr,Ar+wr-Sr,vr+yr,Ar+wr-br,1,!0),br!==0?(this.v.setTripleAt(vr+yr-br,Ar+wr,vr+yr-br,Ar+wr,vr+yr-Sr,Ar+wr,2,!0),this.v.setTripleAt(vr-yr+br,Ar+wr,vr-yr+Sr,Ar+wr,vr-yr+br,Ar+wr,3,!0),this.v.setTripleAt(vr-yr,Ar+wr-br,vr-yr,Ar+wr-br,vr-yr,Ar+wr-Sr,4,!0),this.v.setTripleAt(vr-yr,Ar-wr+br,vr-yr,Ar-wr+Sr,vr-yr,Ar-wr+br,5,!0),this.v.setTripleAt(vr-yr+br,Ar-wr,vr-yr+br,Ar-wr,vr-yr+Sr,Ar-wr,6,!0),this.v.setTripleAt(vr+yr-br,Ar-wr,vr+yr-Sr,Ar-wr,vr+yr-br,Ar-wr,7,!0)):(this.v.setTripleAt(vr-yr,Ar+wr,vr-yr+Sr,Ar+wr,vr-yr,Ar+wr,2),this.v.setTripleAt(vr-yr,Ar-wr,vr-yr,Ar-wr+Sr,vr-yr,Ar-wr,3))):(this.v.setTripleAt(vr+yr,Ar-wr+br,vr+yr,Ar-wr+Sr,vr+yr,Ar-wr+br,0,!0),br!==0?(this.v.setTripleAt(vr+yr-br,Ar-wr,vr+yr-br,Ar-wr,vr+yr-Sr,Ar-wr,1,!0),this.v.setTripleAt(vr-yr+br,Ar-wr,vr-yr+Sr,Ar-wr,vr-yr+br,Ar-wr,2,!0),this.v.setTripleAt(vr-yr,Ar-wr+br,vr-yr,Ar-wr+br,vr-yr,Ar-wr+Sr,3,!0),this.v.setTripleAt(vr-yr,Ar+wr-br,vr-yr,Ar+wr-Sr,vr-yr,Ar+wr-br,4,!0),this.v.setTripleAt(vr-yr+br,Ar+wr,vr-yr+br,Ar+wr,vr-yr+Sr,Ar+wr,5,!0),this.v.setTripleAt(vr+yr-br,Ar+wr,vr+yr-Sr,Ar+wr,vr+yr-br,Ar+wr,6,!0),this.v.setTripleAt(vr+yr,Ar+wr-br,vr+yr,Ar+wr-br,vr+yr,Ar+wr-Sr,7,!0)):(this.v.setTripleAt(vr-yr,Ar-wr,vr-yr+Sr,Ar-wr,vr-yr,Ar-wr,1,!0),this.v.setTripleAt(vr-yr,Ar+wr,vr-yr,Ar+wr-Sr,vr-yr,Ar+wr,2,!0),this.v.setTripleAt(vr+yr,Ar+wr,vr+yr-Sr,Ar+wr,vr+yr,Ar+wr,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:rr},extendPrototype([DynamicPropertyContainer],dr),dr}();function pr(dr,vr,Ar){var yr;if(Ar===3||Ar===4){var wr=Ar===3?vr.pt:vr.ks,br=wr.k;br.length?yr=new cr(dr,vr,Ar):yr=new or(dr,vr,Ar)}else Ar===5?yr=new ur(dr,vr):Ar===6?yr=new hr(dr,vr):Ar===7&&(yr=new fr(dr,vr));return yr.k&&dr.addDynamicProperty(yr),yr}function gr(){return or}function _r(){return cr}var mr={};return mr.getShapeProp=pr,mr.getConstructorFunction=gr,mr.getKeyframedConstructorFunction=_r,mr}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */const Matrix=function(){var ir=Math.cos,er=Math.sin,tr=Math.tan,rr=Math.round;function nr(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function sr(Or){if(Or===0)return this;var Dr=ir(Or),Wr=er(Or);return this._t(Dr,-Wr,0,0,Wr,Dr,0,0,0,0,1,0,0,0,0,1)}function ar(Or){if(Or===0)return this;var Dr=ir(Or),Wr=er(Or);return this._t(1,0,0,0,0,Dr,-Wr,0,0,Wr,Dr,0,0,0,0,1)}function or(Or){if(Or===0)return this;var Dr=ir(Or),Wr=er(Or);return this._t(Dr,0,Wr,0,0,1,0,0,-Wr,0,Dr,0,0,0,0,1)}function lr(Or){if(Or===0)return this;var Dr=ir(Or),Wr=er(Or);return this._t(Dr,-Wr,0,0,Wr,Dr,0,0,0,0,1,0,0,0,0,1)}function cr(Or,Dr){return this._t(1,Dr,Or,1,0,0)}function hr(Or,Dr){return this.shear(tr(Or),tr(Dr))}function fr(Or,Dr){var Wr=ir(Dr),$r=er(Dr);return this._t(Wr,$r,0,0,-$r,Wr,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,tr(Or),1,0,0,0,0,1,0,0,0,0,1)._t(Wr,-$r,0,0,$r,Wr,0,0,0,0,1,0,0,0,0,1)}function ur(Or,Dr,Wr){return!Wr&&Wr!==0&&(Wr=1),Or===1&&Dr===1&&Wr===1?this:this._t(Or,0,0,0,0,Dr,0,0,0,0,Wr,0,0,0,0,1)}function pr(Or,Dr,Wr,$r,Yr,Qi,rs,Kr,Qr,Vr,Gr,qr,ji,Zr,Zi,Yi){return this.props[0]=Or,this.props[1]=Dr,this.props[2]=Wr,this.props[3]=$r,this.props[4]=Yr,this.props[5]=Qi,this.props[6]=rs,this.props[7]=Kr,this.props[8]=Qr,this.props[9]=Vr,this.props[10]=Gr,this.props[11]=qr,this.props[12]=ji,this.props[13]=Zr,this.props[14]=Zi,this.props[15]=Yi,this}function gr(Or,Dr,Wr){return Wr=Wr||0,Or!==0||Dr!==0||Wr!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,Or,Dr,Wr,1):this}function _r(Or,Dr,Wr,$r,Yr,Qi,rs,Kr,Qr,Vr,Gr,qr,ji,Zr,Zi,Yi){var qi=this.props;if(Or===1&&Dr===0&&Wr===0&&$r===0&&Yr===0&&Qi===1&&rs===0&&Kr===0&&Qr===0&&Vr===0&&Gr===1&&qr===0)return qi[12]=qi[12]*Or+qi[15]*ji,qi[13]=qi[13]*Qi+qi[15]*Zr,qi[14]=qi[14]*Gr+qi[15]*Zi,qi[15]*=Yi,this._identityCalculated=!1,this;var Xr=qi[0],ns=qi[1],os=qi[2],us=qi[3],is=qi[4],Ji=qi[5],ms=qi[6],Ki=qi[7],Ni=qi[8],Ri=qi[9],Jr=qi[10],Xi=qi[11],ss=qi[12],ls=qi[13],gs=qi[14],_s=qi[15];return qi[0]=Xr*Or+ns*Yr+os*Qr+us*ji,qi[1]=Xr*Dr+ns*Qi+os*Vr+us*Zr,qi[2]=Xr*Wr+ns*rs+os*Gr+us*Zi,qi[3]=Xr*$r+ns*Kr+os*qr+us*Yi,qi[4]=is*Or+Ji*Yr+ms*Qr+Ki*ji,qi[5]=is*Dr+Ji*Qi+ms*Vr+Ki*Zr,qi[6]=is*Wr+Ji*rs+ms*Gr+Ki*Zi,qi[7]=is*$r+Ji*Kr+ms*qr+Ki*Yi,qi[8]=Ni*Or+Ri*Yr+Jr*Qr+Xi*ji,qi[9]=Ni*Dr+Ri*Qi+Jr*Vr+Xi*Zr,qi[10]=Ni*Wr+Ri*rs+Jr*Gr+Xi*Zi,qi[11]=Ni*$r+Ri*Kr+Jr*qr+Xi*Yi,qi[12]=ss*Or+ls*Yr+gs*Qr+_s*ji,qi[13]=ss*Dr+ls*Qi+gs*Vr+_s*Zr,qi[14]=ss*Wr+ls*rs+gs*Gr+_s*Zi,qi[15]=ss*$r+ls*Kr+gs*qr+_s*Yi,this._identityCalculated=!1,this}function mr(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function dr(Or){for(var Dr=0;Dr<16;){if(Or.props[Dr]!==this.props[Dr])return!1;Dr+=1}return!0}function vr(Or){var Dr;for(Dr=0;Dr<16;Dr+=1)Or.props[Dr]=this.props[Dr];return Or}function Ar(Or){var Dr;for(Dr=0;Dr<16;Dr+=1)this.props[Dr]=Or[Dr]}function yr(Or,Dr,Wr){return{x:Or*this.props[0]+Dr*this.props[4]+Wr*this.props[8]+this.props[12],y:Or*this.props[1]+Dr*this.props[5]+Wr*this.props[9]+this.props[13],z:Or*this.props[2]+Dr*this.props[6]+Wr*this.props[10]+this.props[14]}}function wr(Or,Dr,Wr){return Or*this.props[0]+Dr*this.props[4]+Wr*this.props[8]+this.props[12]}function br(Or,Dr,Wr){return Or*this.props[1]+Dr*this.props[5]+Wr*this.props[9]+this.props[13]}function Sr(Or,Dr,Wr){return Or*this.props[2]+Dr*this.props[6]+Wr*this.props[10]+this.props[14]}function xr(){var Or=this.props[0]*this.props[5]-this.props[1]*this.props[4],Dr=this.props[5]/Or,Wr=-this.props[1]/Or,$r=-this.props[4]/Or,Yr=this.props[0]/Or,Qi=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/Or,rs=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/Or,Kr=new Matrix;return Kr.props[0]=Dr,Kr.props[1]=Wr,Kr.props[4]=$r,Kr.props[5]=Yr,Kr.props[12]=Qi,Kr.props[13]=rs,Kr}function Cr(Or){var Dr=this.getInverseMatrix();return Dr.applyToPointArray(Or[0],Or[1],Or[2]||0)}function Ir(Or){var Dr,Wr=Or.length,$r=[];for(Dr=0;Dr<Wr;Dr+=1)$r[Dr]=Cr(Or[Dr]);return $r}function Rr(Or,Dr,Wr){var $r=createTypedArray("float32",6);if(this.isIdentity())$r[0]=Or[0],$r[1]=Or[1],$r[2]=Dr[0],$r[3]=Dr[1],$r[4]=Wr[0],$r[5]=Wr[1];else{var Yr=this.props[0],Qi=this.props[1],rs=this.props[4],Kr=this.props[5],Qr=this.props[12],Vr=this.props[13];$r[0]=Or[0]*Yr+Or[1]*rs+Qr,$r[1]=Or[0]*Qi+Or[1]*Kr+Vr,$r[2]=Dr[0]*Yr+Dr[1]*rs+Qr,$r[3]=Dr[0]*Qi+Dr[1]*Kr+Vr,$r[4]=Wr[0]*Yr+Wr[1]*rs+Qr,$r[5]=Wr[0]*Qi+Wr[1]*Kr+Vr}return $r}function Pr(Or,Dr,Wr){var $r;return this.isIdentity()?$r=[Or,Dr,Wr]:$r=[Or*this.props[0]+Dr*this.props[4]+Wr*this.props[8]+this.props[12],Or*this.props[1]+Dr*this.props[5]+Wr*this.props[9]+this.props[13],Or*this.props[2]+Dr*this.props[6]+Wr*this.props[10]+this.props[14]],$r}function Fr(Or,Dr){if(this.isIdentity())return Or+","+Dr;var Wr=this.props;return Math.round((Or*Wr[0]+Dr*Wr[4]+Wr[12])*100)/100+","+Math.round((Or*Wr[1]+Dr*Wr[5]+Wr[13])*100)/100}function Nr(){for(var Or=0,Dr=this.props,Wr="matrix3d(",$r=1e4;Or<16;)Wr+=rr(Dr[Or]*$r)/$r,Wr+=Or===15?")":",",Or+=1;return Wr}function Ur(Or){var Dr=1e4;return Or<1e-6&&Or>0||Or>-1e-6&&Or<0?rr(Or*Dr)/Dr:Or}function Br(){var Or=this.props,Dr=Ur(Or[0]),Wr=Ur(Or[1]),$r=Ur(Or[4]),Yr=Ur(Or[5]),Qi=Ur(Or[12]),rs=Ur(Or[13]);return"matrix("+Dr+","+Wr+","+$r+","+Yr+","+Qi+","+rs+")"}return function(){this.reset=nr,this.rotate=sr,this.rotateX=ar,this.rotateY=or,this.rotateZ=lr,this.skew=hr,this.skewFromAxis=fr,this.shear=cr,this.scale=ur,this.setTransform=pr,this.translate=gr,this.transform=_r,this.applyToPoint=yr,this.applyToX=wr,this.applyToY=br,this.applyToZ=Sr,this.applyToPointArray=Pr,this.applyToTriplePoints=Rr,this.applyToPointStringified=Fr,this.toCSS=Nr,this.to2dCSS=Br,this.clone=vr,this.cloneFromProps=Ar,this.equals=dr,this.inversePoints=Ir,this.inversePoint=Cr,this.getInverseMatrix=xr,this._t=this.transform,this.isIdentity=mr,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();var standalone="__[STANDALONE]__",animationData="__[ANIMATIONDATA]__",renderer$1="";lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="[[BM_VERSION]]";var queryString="";if(standalone){var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",renderer$1=getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{!(typeof exports=="object"&&typeof module<"u")&&!(typeof define=="function"&&define.amd)&&(window.bodymovin=lottie)}catch(ir){}const ShapeModifiers=function(){var ir={},er={};ir.registerModifier=tr,ir.getModifier=rr;function tr(nr,sr){er[nr]||(er[nr]=sr)}function rr(nr,sr,ar){return new er[nr](sr,ar)}return ir}();ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(ir){if(!this.closed){ir.sh.container.addDynamicProperty(ir.sh);var er={shape:ir.sh,data:ir,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(er),this.addShapeToModifier(er),this._isAnimated&&ir.setAsAnimated()}},ShapeModifier.prototype.init=function(ir,er){this.shapes=[],this.elem=ir,this.initDynamicPropertyContainer(ir),this.initModifierProperties(ir,er),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier),extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(ir,er){this.s=PropertyFactory.getProp(ir,er.s,0,.01,this),this.e=PropertyFactory.getProp(ir,er.e,0,.01,this),this.o=PropertyFactory.getProp(ir,er.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=er.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(ir){ir.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(ir,er,tr,rr,nr){var sr=[];er<=1?sr.push({s:ir,e:er}):ir>=1?sr.push({s:ir-1,e:er-1}):(sr.push({s:ir,e:1}),sr.push({s:0,e:er-1}));var ar=[],or,lr=sr.length,cr;for(or=0;or<lr;or+=1)if(cr=sr[or],!(cr.e*nr<rr||cr.s*nr>rr+tr)){var hr,fr;cr.s*nr<=rr?hr=0:hr=(cr.s*nr-rr)/tr,cr.e*nr>=rr+tr?fr=1:fr=(cr.e*nr-rr)/tr,ar.push([hr,fr])}return ar.length||ar.push([0,0]),ar},TrimModifier.prototype.releasePathsData=function(ir){var er,tr=ir.length;for(er=0;er<tr;er+=1)segmentsLengthPool.release(ir[er]);return ir.length=0,ir},TrimModifier.prototype.processShapes=function(ir){var er,tr;if(this._mdf||ir){var rr=this.o.v%360/360;if(rr<0&&(rr+=1),this.s.v>1?er=1+rr:this.s.v<0?er=0+rr:er=this.s.v+rr,this.e.v>1?tr=1+rr:this.e.v<0?tr=0+rr:tr=this.e.v+rr,er>tr){var nr=er;er=tr,tr=nr}er=Math.round(er*1e4)*1e-4,tr=Math.round(tr*1e4)*1e-4,this.sValue=er,this.eValue=tr}else er=this.sValue,tr=this.eValue;var sr,ar,or=this.shapes.length,lr,cr,hr,fr,ur,pr=0;if(tr===er)for(ar=0;ar<or;ar+=1)this.shapes[ar].localShapeCollection.releaseShapes(),this.shapes[ar].shape._mdf=!0,this.shapes[ar].shape.paths=this.shapes[ar].localShapeCollection,this._mdf&&(this.shapes[ar].pathsData.length=0);else if(tr===1&&er===0||tr===0&&er===1){if(this._mdf)for(ar=0;ar<or;ar+=1)this.shapes[ar].pathsData.length=0,this.shapes[ar].shape._mdf=!0}else{var gr=[],_r,mr;for(ar=0;ar<or;ar+=1)if(_r=this.shapes[ar],!_r.shape._mdf&&!this._mdf&&!ir&&this.m!==2)_r.shape.paths=_r.localShapeCollection;else{if(sr=_r.shape.paths,cr=sr._length,ur=0,!_r.shape._mdf&&_r.pathsData.length)ur=_r.totalShapeLength;else{for(hr=this.releasePathsData(_r.pathsData),lr=0;lr<cr;lr+=1)fr=bez.getSegmentsLength(sr.shapes[lr]),hr.push(fr),ur+=fr.totalLength;_r.totalShapeLength=ur,_r.pathsData=hr}pr+=ur,_r.shape._mdf=!0}var dr=er,vr=tr,Ar=0,yr;for(ar=or-1;ar>=0;ar-=1)if(_r=this.shapes[ar],_r.shape._mdf){for(mr=_r.localShapeCollection,mr.releaseShapes(),this.m===2&&or>1?(yr=this.calculateShapeEdges(er,tr,_r.totalShapeLength,Ar,pr),Ar+=_r.totalShapeLength):yr=[[dr,vr]],cr=yr.length,lr=0;lr<cr;lr+=1){dr=yr[lr][0],vr=yr[lr][1],gr.length=0,vr<=1?gr.push({s:_r.totalShapeLength*dr,e:_r.totalShapeLength*vr}):dr>=1?gr.push({s:_r.totalShapeLength*(dr-1),e:_r.totalShapeLength*(vr-1)}):(gr.push({s:_r.totalShapeLength*dr,e:_r.totalShapeLength}),gr.push({s:0,e:_r.totalShapeLength*(vr-1)}));var wr=this.addShapes(_r,gr[0]);if(gr[0].s!==gr[0].e){if(gr.length>1){var br=_r.shape.paths.shapes[_r.shape.paths._length-1];if(br.c){var Sr=wr.pop();this.addPaths(wr,mr),wr=this.addShapes(_r,gr[1],Sr)}else this.addPaths(wr,mr),wr=this.addShapes(_r,gr[1])}this.addPaths(wr,mr)}}_r.shape.paths=mr}}},TrimModifier.prototype.addPaths=function(ir,er){var tr,rr=ir.length;for(tr=0;tr<rr;tr+=1)er.addShape(ir[tr])},TrimModifier.prototype.addSegment=function(ir,er,tr,rr,nr,sr,ar){nr.setXYAt(er[0],er[1],"o",sr),nr.setXYAt(tr[0],tr[1],"i",sr+1),ar&&nr.setXYAt(ir[0],ir[1],"v",sr),nr.setXYAt(rr[0],rr[1],"v",sr+1)},TrimModifier.prototype.addSegmentFromArray=function(ir,er,tr,rr){er.setXYAt(ir[1],ir[5],"o",tr),er.setXYAt(ir[2],ir[6],"i",tr+1),rr&&er.setXYAt(ir[0],ir[4],"v",tr),er.setXYAt(ir[3],ir[7],"v",tr+1)},TrimModifier.prototype.addShapes=function(ir,er,tr){var rr=ir.pathsData,nr=ir.shape.paths.shapes,sr,ar=ir.shape.paths._length,or,lr,cr=0,hr,fr,ur,pr,gr=[],_r,mr=!0;for(tr?(fr=tr._length,_r=tr._length):(tr=shapePool.newElement(),fr=0,_r=0),gr.push(tr),sr=0;sr<ar;sr+=1){for(ur=rr[sr].lengths,tr.c=nr[sr].c,lr=nr[sr].c?ur.length:ur.length+1,or=1;or<lr;or+=1)if(hr=ur[or-1],cr+hr.addedLength<er.s)cr+=hr.addedLength,tr.c=!1;else if(cr>er.e){tr.c=!1;break}else er.s<=cr&&er.e>=cr+hr.addedLength?(this.addSegment(nr[sr].v[or-1],nr[sr].o[or-1],nr[sr].i[or],nr[sr].v[or],tr,fr,mr),mr=!1):(pr=bez.getNewSegment(nr[sr].v[or-1],nr[sr].v[or],nr[sr].o[or-1],nr[sr].i[or],(er.s-cr)/hr.addedLength,(er.e-cr)/hr.addedLength,ur[or-1]),this.addSegmentFromArray(pr,tr,fr,mr),mr=!1,tr.c=!1),cr+=hr.addedLength,fr+=1;if(nr[sr].c&&ur.length){if(hr=ur[or-1],cr<=er.e){var dr=ur[or-1].addedLength;er.s<=cr&&er.e>=cr+dr?(this.addSegment(nr[sr].v[or-1],nr[sr].o[or-1],nr[sr].i[0],nr[sr].v[0],tr,fr,mr),mr=!1):(pr=bez.getNewSegment(nr[sr].v[or-1],nr[sr].v[0],nr[sr].o[or-1],nr[sr].i[0],(er.s-cr)/dr,(er.e-cr)/dr,ur[or-1]),this.addSegmentFromArray(pr,tr,fr,mr),mr=!1,tr.c=!1)}else tr.c=!1;cr+=hr.addedLength,fr+=1}if(tr._length&&(tr.setXYAt(tr.v[_r][0],tr.v[_r][1],"i",_r),tr.setXYAt(tr.v[tr._length-1][0],tr.v[tr._length-1][1],"o",tr._length-1)),cr>er.e)break;sr<ar-1&&(tr=shapePool.newElement(),mr=!0,gr.push(tr),fr=0)}return gr},extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(ir,er){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(ir,er.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(ir,er){var tr=er/100,rr=[0,0],nr=ir._length,sr=0;for(sr=0;sr<nr;sr+=1)rr[0]+=ir.v[sr][0],rr[1]+=ir.v[sr][1];rr[0]/=nr,rr[1]/=nr;var ar=shapePool.newElement();ar.c=ir.c;var or,lr,cr,hr,fr,ur;for(sr=0;sr<nr;sr+=1)or=ir.v[sr][0]+(rr[0]-ir.v[sr][0])*tr,lr=ir.v[sr][1]+(rr[1]-ir.v[sr][1])*tr,cr=ir.o[sr][0]+(rr[0]-ir.o[sr][0])*-tr,hr=ir.o[sr][1]+(rr[1]-ir.o[sr][1])*-tr,fr=ir.i[sr][0]+(rr[0]-ir.i[sr][0])*-tr,ur=ir.i[sr][1]+(rr[1]-ir.i[sr][1])*-tr,ar.setTripleAt(or,lr,cr,hr,fr,ur,sr);return ar},PuckerAndBloatModifier.prototype.processShapes=function(ir){var er,tr,rr=this.shapes.length,nr,sr,ar=this.amount.v;if(ar!==0){var or,lr;for(tr=0;tr<rr;tr+=1){if(or=this.shapes[tr],lr=or.localShapeCollection,!(!or.shape._mdf&&!this._mdf&&!ir))for(lr.releaseShapes(),or.shape._mdf=!0,er=or.shape.paths.shapes,sr=or.shape.paths._length,nr=0;nr<sr;nr+=1)lr.addShape(this.processPath(er[nr],ar));or.shape.paths=or.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};const TransformPropertyFactory=function(){var ir=[0,0];function er(lr){var cr=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||cr,this.a&&lr.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&lr.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&lr.skewFromAxis(-this.sk.v,this.sa.v),this.r?lr.rotate(-this.r.v):lr.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?lr.translate(this.px.v,this.py.v,-this.pz.v):lr.translate(this.px.v,this.py.v,0):lr.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function tr(lr){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||lr){var cr;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var hr,fr;if(cr=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(hr=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/cr,0),fr=this.p.getValueAtTime(this.p.keyframes[0].t/cr,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(hr=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/cr,0),fr=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/cr,0)):(hr=this.p.pv,fr=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/cr,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){hr=[],fr=[];var ur=this.px,pr=this.py;ur._caching.lastFrame+ur.offsetTime<=ur.keyframes[0].t?(hr[0]=ur.getValueAtTime((ur.keyframes[0].t+.01)/cr,0),hr[1]=pr.getValueAtTime((pr.keyframes[0].t+.01)/cr,0),fr[0]=ur.getValueAtTime(ur.keyframes[0].t/cr,0),fr[1]=pr.getValueAtTime(pr.keyframes[0].t/cr,0)):ur._caching.lastFrame+ur.offsetTime>=ur.keyframes[ur.keyframes.length-1].t?(hr[0]=ur.getValueAtTime(ur.keyframes[ur.keyframes.length-1].t/cr,0),hr[1]=pr.getValueAtTime(pr.keyframes[pr.keyframes.length-1].t/cr,0),fr[0]=ur.getValueAtTime((ur.keyframes[ur.keyframes.length-1].t-.01)/cr,0),fr[1]=pr.getValueAtTime((pr.keyframes[pr.keyframes.length-1].t-.01)/cr,0)):(hr=[ur.pv,pr.pv],fr[0]=ur.getValueAtTime((ur._caching.lastFrame+ur.offsetTime-.01)/cr,ur.offsetTime),fr[1]=pr.getValueAtTime((pr._caching.lastFrame+pr.offsetTime-.01)/cr,pr.offsetTime))}else fr=ir,hr=fr;this.v.rotate(-Math.atan2(hr[1]-fr[1],hr[0]-fr[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function rr(){if(!this.a.k)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function nr(){}function sr(lr){this._addDynamicProperty(lr),this.elem.addDynamicProperty(lr),this._isDirty=!0}function ar(lr,cr,hr){if(this.elem=lr,this.frameId=-1,this.propType="transform",this.data=cr,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(hr||lr),cr.p&&cr.p.s?(this.px=PropertyFactory.getProp(lr,cr.p.x,0,0,this),this.py=PropertyFactory.getProp(lr,cr.p.y,0,0,this),cr.p.z&&(this.pz=PropertyFactory.getProp(lr,cr.p.z,0,0,this))):this.p=PropertyFactory.getProp(lr,cr.p||{k:[0,0,0]},1,0,this),cr.rx){if(this.rx=PropertyFactory.getProp(lr,cr.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(lr,cr.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(lr,cr.rz,0,degToRads,this),cr.or.k[0].ti){var fr,ur=cr.or.k.length;for(fr=0;fr<ur;fr+=1)cr.or.k[fr].to=null,cr.or.k[fr].ti=null}this.or=PropertyFactory.getProp(lr,cr.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(lr,cr.r||{k:0},0,degToRads,this);cr.sk&&(this.sk=PropertyFactory.getProp(lr,cr.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(lr,cr.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(lr,cr.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(lr,cr.s||{k:[100,100,100]},1,.01,this),cr.o?this.o=PropertyFactory.getProp(lr,cr.o,0,.01,lr):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}ar.prototype={applyToMatrix:er,getValue:tr,precalculateMatrix:rr,autoOrient:nr},extendPrototype([DynamicPropertyContainer],ar),ar.prototype.addDynamicProperty=sr,ar.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function or(lr,cr,hr){return new ar(lr,cr,hr)}return{getTransformProperty:or}}();extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(ir,er){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(ir,er.c,0,null,this),this.o=PropertyFactory.getProp(ir,er.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(ir,er.tr,this),this.so=PropertyFactory.getProp(ir,er.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(ir,er.tr.eo,0,.01,this),this.data=er,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(ir,er,tr,rr,nr,sr){var ar=sr?-1:1,or=rr.s.v[0]+(1-rr.s.v[0])*(1-nr),lr=rr.s.v[1]+(1-rr.s.v[1])*(1-nr);ir.translate(rr.p.v[0]*ar*nr,rr.p.v[1]*ar*nr,rr.p.v[2]),er.translate(-rr.a.v[0],-rr.a.v[1],rr.a.v[2]),er.rotate(-rr.r.v*ar*nr),er.translate(rr.a.v[0],rr.a.v[1],rr.a.v[2]),tr.translate(-rr.a.v[0],-rr.a.v[1],rr.a.v[2]),tr.scale(sr?1/or:or,sr?1/lr:lr),tr.translate(rr.a.v[0],rr.a.v[1],rr.a.v[2])},RepeaterModifier.prototype.init=function(ir,er,tr,rr){for(this.elem=ir,this.arr=er,this.pos=tr,this.elemsData=rr,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(ir),this.initModifierProperties(ir,er[tr]);tr>0;)tr-=1,this._elements.unshift(er[tr]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(ir){var er,tr=ir.length;for(er=0;er<tr;er+=1)ir[er]._processed=!1,ir[er].ty==="gr"&&this.resetElements(ir[er].it)},RepeaterModifier.prototype.cloneElements=function(ir){var er=JSON.parse(JSON.stringify(ir));return this.resetElements(er),er},RepeaterModifier.prototype.changeGroupRender=function(ir,er){var tr,rr=ir.length;for(tr=0;tr<rr;tr+=1)ir[tr]._render=er,ir[tr].ty==="gr"&&this.changeGroupRender(ir[tr].it,er)},RepeaterModifier.prototype.processShapes=function(ir){var er,tr,rr,nr,sr,ar=!1;if(this._mdf||ir){var or=Math.ceil(this.c.v);if(this._groups.length<or){for(;this._groups.length<or;){var lr={it:this.cloneElements(this._elements),ty:"gr"};lr.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,lr),this._groups.splice(0,0,lr),this._currentCopies+=1}this.elem.reloadShapes(),ar=!0}sr=0;var cr;for(rr=0;rr<=this._groups.length-1;rr+=1){if(cr=sr<or,this._groups[rr]._render=cr,this.changeGroupRender(this._groups[rr].it,cr),!cr){var hr=this.elemsData[rr].it,fr=hr[hr.length-1];fr.transform.op.v!==0?(fr.transform.op._mdf=!0,fr.transform.op.v=0):fr.transform.op._mdf=!1}sr+=1}this._currentCopies=or;var ur=this.o.v,pr=ur%1,gr=ur>0?Math.floor(ur):Math.ceil(ur),_r=this.pMatrix.props,mr=this.rMatrix.props,dr=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var vr=0;if(ur>0){for(;vr<gr;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),vr+=1;pr&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,pr,!1),vr+=pr)}else if(ur<0){for(;vr>gr;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),vr-=1;pr&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-pr,!0),vr-=pr)}rr=this.data.m===1?0:this._currentCopies-1,nr=this.data.m===1?1:-1,sr=this._currentCopies;for(var Ar,yr;sr;){if(er=this.elemsData[rr].it,tr=er[er.length-1].transform.mProps.v.props,yr=tr.length,er[er.length-1].transform.mProps._mdf=!0,er[er.length-1].transform.op._mdf=!0,er[er.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(rr/(this._currentCopies-1)),vr!==0){for((rr!==0&&nr===1||rr!==this._currentCopies-1&&nr===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(mr[0],mr[1],mr[2],mr[3],mr[4],mr[5],mr[6],mr[7],mr[8],mr[9],mr[10],mr[11],mr[12],mr[13],mr[14],mr[15]),this.matrix.transform(dr[0],dr[1],dr[2],dr[3],dr[4],dr[5],dr[6],dr[7],dr[8],dr[9],dr[10],dr[11],dr[12],dr[13],dr[14],dr[15]),this.matrix.transform(_r[0],_r[1],_r[2],_r[3],_r[4],_r[5],_r[6],_r[7],_r[8],_r[9],_r[10],_r[11],_r[12],_r[13],_r[14],_r[15]),Ar=0;Ar<yr;Ar+=1)tr[Ar]=this.matrix.props[Ar];this.matrix.reset()}else for(this.matrix.reset(),Ar=0;Ar<yr;Ar+=1)tr[Ar]=this.matrix.props[Ar];vr+=1,sr-=1,rr+=nr}}else for(sr=this._currentCopies,rr=0,nr=1;sr;)er=this.elemsData[rr].it,tr=er[er.length-1].transform.mProps.v.props,er[er.length-1].transform.mProps._mdf=!1,er[er.length-1].transform.op._mdf=!1,sr-=1,rr+=nr;return ar},RepeaterModifier.prototype.addShape=function(){},extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(ir,er){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(ir,er.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(ir,er){var tr=shapePool.newElement();tr.c=ir.c;var rr,nr=ir._length,sr,ar,or,lr,cr,hr,fr=0,ur,pr,gr,_r,mr,dr;for(rr=0;rr<nr;rr+=1)sr=ir.v[rr],or=ir.o[rr],ar=ir.i[rr],sr[0]===or[0]&&sr[1]===or[1]&&sr[0]===ar[0]&&sr[1]===ar[1]?(rr===0||rr===nr-1)&&!ir.c?(tr.setTripleAt(sr[0],sr[1],or[0],or[1],ar[0],ar[1],fr),fr+=1):(rr===0?lr=ir.v[nr-1]:lr=ir.v[rr-1],cr=Math.sqrt(Math.pow(sr[0]-lr[0],2)+Math.pow(sr[1]-lr[1],2)),hr=cr?Math.min(cr/2,er)/cr:0,mr=sr[0]+(lr[0]-sr[0])*hr,ur=mr,dr=sr[1]-(sr[1]-lr[1])*hr,pr=dr,gr=ur-(ur-sr[0])*roundCorner,_r=pr-(pr-sr[1])*roundCorner,tr.setTripleAt(ur,pr,gr,_r,mr,dr,fr),fr+=1,rr===nr-1?lr=ir.v[0]:lr=ir.v[rr+1],cr=Math.sqrt(Math.pow(sr[0]-lr[0],2)+Math.pow(sr[1]-lr[1],2)),hr=cr?Math.min(cr/2,er)/cr:0,gr=sr[0]+(lr[0]-sr[0])*hr,ur=gr,_r=sr[1]+(lr[1]-sr[1])*hr,pr=_r,mr=ur-(ur-sr[0])*roundCorner,dr=pr-(pr-sr[1])*roundCorner,tr.setTripleAt(ur,pr,gr,_r,mr,dr,fr),fr+=1):(tr.setTripleAt(ir.v[rr][0],ir.v[rr][1],ir.o[rr][0],ir.o[rr][1],ir.i[rr][0],ir.i[rr][1],fr),fr+=1);return tr},RoundCornersModifier.prototype.processShapes=function(ir){var er,tr,rr=this.shapes.length,nr,sr,ar=this.rd.v;if(ar!==0){var or,lr;for(tr=0;tr<rr;tr+=1){if(or=this.shapes[tr],lr=or.localShapeCollection,!(!or.shape._mdf&&!this._mdf&&!ir))for(lr.releaseShapes(),or.shape._mdf=!0,er=or.shape.paths.shapes,sr=or.shape.paths._length,nr=0;nr<sr;nr+=1)lr.addShape(this.processPath(er[nr],ar));or.shape.paths=or.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};const FontManager=function(){var ir=5e3,er={w:0,size:0,shapes:[],data:{shapes:[]}},tr=[];tr=tr.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var rr=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"],nr=[65039,8205];function sr(yr){var wr=yr.split(","),br,Sr=wr.length,xr=[];for(br=0;br<Sr;br+=1)wr[br]!=="sans-serif"&&wr[br]!=="monospace"&&xr.push(wr[br]);return xr.join(",")}function ar(yr,wr){var br=createTag("span");br.setAttribute("aria-hidden",!0),br.style.fontFamily=wr;var Sr=createTag("span");Sr.innerText="giItT1WQy@!-/#",br.style.position="absolute",br.style.left="-10000px",br.style.top="-10000px",br.style.fontSize="300px",br.style.fontVariant="normal",br.style.fontStyle="normal",br.style.fontWeight="normal",br.style.letterSpacing="0",br.appendChild(Sr),document.body.appendChild(br);var xr=Sr.offsetWidth;return Sr.style.fontFamily=sr(yr)+", "+wr,{node:Sr,w:xr,parent:br}}function or(){var yr,wr=this.fonts.length,br,Sr,xr=wr;for(yr=0;yr<wr;yr+=1)this.fonts[yr].loaded?xr-=1:this.fonts[yr].fOrigin==="n"||this.fonts[yr].origin===0?this.fonts[yr].loaded=!0:(br=this.fonts[yr].monoCase.node,Sr=this.fonts[yr].monoCase.w,br.offsetWidth!==Sr?(xr-=1,this.fonts[yr].loaded=!0):(br=this.fonts[yr].sansCase.node,Sr=this.fonts[yr].sansCase.w,br.offsetWidth!==Sr&&(xr-=1,this.fonts[yr].loaded=!0)),this.fonts[yr].loaded&&(this.fonts[yr].sansCase.parent.parentNode.removeChild(this.fonts[yr].sansCase.parent),this.fonts[yr].monoCase.parent.parentNode.removeChild(this.fonts[yr].monoCase.parent)));xr!==0&&Date.now()-this.initTime<ir?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function lr(yr,wr){var br=document.body&&wr?"svg":"canvas",Sr,xr=getFontProperties(yr);if(br==="svg"){var Cr=createNS("text");Cr.style.fontSize="100px",Cr.setAttribute("font-family",yr.fFamily),Cr.setAttribute("font-style",xr.style),Cr.setAttribute("font-weight",xr.weight),Cr.textContent="1",yr.fClass?(Cr.style.fontFamily="inherit",Cr.setAttribute("class",yr.fClass)):Cr.style.fontFamily=yr.fFamily,wr.appendChild(Cr),Sr=Cr}else{var Ir=new OffscreenCanvas(500,500).getContext("2d");Ir.font=xr.style+" "+xr.weight+" 100px "+yr.fFamily,Sr=Ir}function Rr(Pr){return br==="svg"?(Sr.textContent=Pr,Sr.getComputedTextLength()):Sr.measureText(Pr).width}return{measureText:Rr}}function cr(yr,wr){if(!yr){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=yr.list;return}if(!document.body){this.isLoaded=!0,yr.list.forEach(Br=>{Br.helper=lr(Br),Br.cache={}}),this.fonts=yr.list;return}var br=yr.list,Sr,xr=br.length,Cr=xr;for(Sr=0;Sr<xr;Sr+=1){var Ir=!0,Rr,Pr;if(br[Sr].loaded=!1,br[Sr].monoCase=ar(br[Sr].fFamily,"monospace"),br[Sr].sansCase=ar(br[Sr].fFamily,"sans-serif"),!br[Sr].fPath)br[Sr].loaded=!0,Cr-=1;else if(br[Sr].fOrigin==="p"||br[Sr].origin===3){if(Rr=document.querySelectorAll('style[f-forigin="p"][f-family="'+br[Sr].fFamily+'"], style[f-origin="3"][f-family="'+br[Sr].fFamily+'"]'),Rr.length>0&&(Ir=!1),Ir){var Fr=createTag("style");Fr.setAttribute("f-forigin",br[Sr].fOrigin),Fr.setAttribute("f-origin",br[Sr].origin),Fr.setAttribute("f-family",br[Sr].fFamily),Fr.type="text/css",Fr.innerText="@font-face {font-family: "+br[Sr].fFamily+"; font-style: normal; src: url('"+br[Sr].fPath+"');}",wr.appendChild(Fr)}}else if(br[Sr].fOrigin==="g"||br[Sr].origin===1){for(Rr=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),Pr=0;Pr<Rr.length;Pr+=1)Rr[Pr].href.indexOf(br[Sr].fPath)!==-1&&(Ir=!1);if(Ir){var Nr=createTag("link");Nr.setAttribute("f-forigin",br[Sr].fOrigin),Nr.setAttribute("f-origin",br[Sr].origin),Nr.type="text/css",Nr.rel="stylesheet",Nr.href=br[Sr].fPath,document.body.appendChild(Nr)}}else if(br[Sr].fOrigin==="t"||br[Sr].origin===2){for(Rr=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),Pr=0;Pr<Rr.length;Pr+=1)br[Sr].fPath===Rr[Pr].src&&(Ir=!1);if(Ir){var Ur=createTag("link");Ur.setAttribute("f-forigin",br[Sr].fOrigin),Ur.setAttribute("f-origin",br[Sr].origin),Ur.setAttribute("rel","stylesheet"),Ur.setAttribute("href",br[Sr].fPath),wr.appendChild(Ur)}}br[Sr].helper=lr(br[Sr],wr),br[Sr].cache={},this.fonts.push(br[Sr])}Cr===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function hr(yr){if(yr){this.chars||(this.chars=[]);var wr,br=yr.length,Sr,xr=this.chars.length,Cr;for(wr=0;wr<br;wr+=1){for(Sr=0,Cr=!1;Sr<xr;)this.chars[Sr].style===yr[wr].style&&this.chars[Sr].fFamily===yr[wr].fFamily&&this.chars[Sr].ch===yr[wr].ch&&(Cr=!0),Sr+=1;Cr||(this.chars.push(yr[wr]),xr+=1)}}}function fr(yr,wr,br){for(var Sr=0,xr=this.chars.length;Sr<xr;){if(this.chars[Sr].ch===yr&&this.chars[Sr].style===wr&&this.chars[Sr].fFamily===br)return this.chars[Sr];Sr+=1}return(typeof yr=="string"&&yr.charCodeAt(0)!==13||!yr)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",yr,wr,br)),er}function ur(yr,wr,br){var Sr=this.getFontByName(wr),xr=yr.charCodeAt(0);if(!Sr.cache[xr+1]){var Cr=Sr.helper;if(yr===" "){var Ir=Cr.measureText("|"+yr+"|"),Rr=Cr.measureText("||");Sr.cache[xr+1]=(Ir-Rr)/100}else Sr.cache[xr+1]=Cr.measureText(yr)/100}return Sr.cache[xr+1]*br}function pr(yr){for(var wr=0,br=this.fonts.length;wr<br;){if(this.fonts[wr].fName===yr)return this.fonts[wr];wr+=1}return this.fonts[0]}function gr(yr,wr){var br=yr.toString(16)+wr.toString(16);return rr.indexOf(br)!==-1}function _r(yr,wr){return wr?yr===nr[0]&&wr===nr[1]:yr===nr[1]}function mr(yr){return tr.indexOf(yr)!==-1}function dr(){this.isLoaded=!0}var vr=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};vr.isModifier=gr,vr.isZeroWidthJoiner=_r,vr.isCombinedCharacter=mr;var Ar={addChars:hr,addFonts:cr,getCharData:fr,getFontByName:pr,measureText:ur,checkLoadedFonts:or,setIsLoaded:dr};return vr.prototype=Ar,vr}();RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(ir){this.renderableComponents.indexOf(ir)===-1&&this.renderableComponents.push(ir)},removeRenderableComponent:function(ir){this.renderableComponents.indexOf(ir)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(ir),1)},prepareRenderableFrame:function(ir){this.checkLayerLimits(ir)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(ir){this.data.ip-this.data.st<=ir&&this.data.op-this.data.st>ir?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var ir,er=this.renderableComponents.length;for(ir=0;ir<er;ir+=1)this.renderableComponents[ir].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};const MaskManagerInterface=function(){function ir(tr,rr){this._mask=tr,this._data=rr}Object.defineProperty(ir.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(ir.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var er=function(tr){var rr=createSizedArray(tr.viewData.length),nr,sr=tr.viewData.length;for(nr=0;nr<sr;nr+=1)rr[nr]=new ir(tr.viewData[nr],tr.masksProperties[nr]);var ar=function(or){for(nr=0;nr<sr;){if(tr.masksProperties[nr].nm===or)return rr[nr];nr+=1}return null};return ar};return er}(),ExpressionPropertyInterface=function(){var ir={pv:0,v:0,mult:1},er={pv:[0,0,0],v:[0,0,0],mult:1};function tr(ar,or,lr){Object.defineProperty(ar,"velocity",{get:function(){return or.getVelocityAtTime(or.comp.currentFrame)}}),ar.numKeys=or.keyframes?or.keyframes.length:0,ar.key=function(cr){if(!ar.numKeys)return 0;var hr="";"s"in or.keyframes[cr-1]?hr=or.keyframes[cr-1].s:"e"in or.keyframes[cr-2]?hr=or.keyframes[cr-2].e:hr=or.keyframes[cr-2].s;var fr=lr==="unidimensional"?new Number(hr):Object.assign({},hr);return fr.time=or.keyframes[cr-1].t/or.elem.comp.globalData.frameRate,fr.value=lr==="unidimensional"?hr[0]:hr,fr},ar.valueAtTime=or.getValueAtTime,ar.speedAtTime=or.getSpeedAtTime,ar.velocityAtTime=or.getVelocityAtTime,ar.propertyGroup=or.propertyGroup}function rr(ar){(!ar||!("pv"in ar))&&(ar=ir);var or=1/ar.mult,lr=ar.pv*or,cr=new Number(lr);return cr.value=lr,tr(cr,ar,"unidimensional"),function(){return ar.k&&ar.getValue(),lr=ar.v*or,cr.value!==lr&&(cr=new Number(lr),cr.value=lr,tr(cr,ar,"unidimensional")),cr}}function nr(ar){(!ar||!("pv"in ar))&&(ar=er);var or=1/ar.mult,lr=ar.data&&ar.data.l||ar.pv.length,cr=createTypedArray("float32",lr),hr=createTypedArray("float32",lr);return cr.value=hr,tr(cr,ar,"multidimensional"),function(){ar.k&&ar.getValue();for(var fr=0;fr<lr;fr+=1)hr[fr]=ar.v[fr]*or,cr[fr]=hr[fr];return cr}}function sr(){return ir}return function(ar){return ar?ar.propType==="unidimensional"?rr(ar):nr(ar):sr}}(),TransformExpressionInterface=function(){return function(ir){function er(ar){switch(ar){case"scale":case"Scale":case"ADBE Scale":case 6:return er.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return er.rotation;case"ADBE Rotate X":return er.xRotation;case"ADBE Rotate Y":return er.yRotation;case"position":case"Position":case"ADBE Position":case 2:return er.position;case"ADBE Position_0":return er.xPosition;case"ADBE Position_1":return er.yPosition;case"ADBE Position_2":return er.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return er.anchorPoint;case"opacity":case"Opacity":case 11:return er.opacity;default:return null}}Object.defineProperty(er,"rotation",{get:ExpressionPropertyInterface(ir.r||ir.rz)}),Object.defineProperty(er,"zRotation",{get:ExpressionPropertyInterface(ir.rz||ir.r)}),Object.defineProperty(er,"xRotation",{get:ExpressionPropertyInterface(ir.rx)}),Object.defineProperty(er,"yRotation",{get:ExpressionPropertyInterface(ir.ry)}),Object.defineProperty(er,"scale",{get:ExpressionPropertyInterface(ir.s)});var tr,rr,nr,sr;return ir.p?sr=ExpressionPropertyInterface(ir.p):(tr=ExpressionPropertyInterface(ir.px),rr=ExpressionPropertyInterface(ir.py),ir.pz&&(nr=ExpressionPropertyInterface(ir.pz))),Object.defineProperty(er,"position",{get:function(){return ir.p?sr():[tr(),rr(),nr?nr():0]}}),Object.defineProperty(er,"xPosition",{get:ExpressionPropertyInterface(ir.px)}),Object.defineProperty(er,"yPosition",{get:ExpressionPropertyInterface(ir.py)}),Object.defineProperty(er,"zPosition",{get:ExpressionPropertyInterface(ir.pz)}),Object.defineProperty(er,"anchorPoint",{get:ExpressionPropertyInterface(ir.a)}),Object.defineProperty(er,"opacity",{get:ExpressionPropertyInterface(ir.o)}),Object.defineProperty(er,"skew",{get:ExpressionPropertyInterface(ir.sk)}),Object.defineProperty(er,"skewAxis",{get:ExpressionPropertyInterface(ir.sa)}),Object.defineProperty(er,"orientation",{get:ExpressionPropertyInterface(ir.or)}),er}}(),LayerExpressionInterface=function(){function ir(cr){var hr=new Matrix;if(cr!==void 0){var fr=this._elem.finalTransform.mProp.getValueAtTime(cr);fr.clone(hr)}else{var ur=this._elem.finalTransform.mProp;ur.applyToMatrix(hr)}return hr}function er(cr,hr){var fr=this.getMatrix(hr);return fr.props[12]=0,fr.props[13]=0,fr.props[14]=0,this.applyPoint(fr,cr)}function tr(cr,hr){var fr=this.getMatrix(hr);return this.applyPoint(fr,cr)}function rr(cr,hr){var fr=this.getMatrix(hr);return fr.props[12]=0,fr.props[13]=0,fr.props[14]=0,this.invertPoint(fr,cr)}function nr(cr,hr){var fr=this.getMatrix(hr);return this.invertPoint(fr,cr)}function sr(cr,hr){if(this._elem.hierarchy&&this._elem.hierarchy.length){var fr,ur=this._elem.hierarchy.length;for(fr=0;fr<ur;fr+=1)this._elem.hierarchy[fr].finalTransform.mProp.applyToMatrix(cr)}return cr.applyToPointArray(hr[0],hr[1],hr[2]||0)}function ar(cr,hr){if(this._elem.hierarchy&&this._elem.hierarchy.length){var fr,ur=this._elem.hierarchy.length;for(fr=0;fr<ur;fr+=1)this._elem.hierarchy[fr].finalTransform.mProp.applyToMatrix(cr)}return cr.inversePoint(hr)}function or(cr){var hr=new Matrix;if(hr.reset(),this._elem.finalTransform.mProp.applyToMatrix(hr),this._elem.hierarchy&&this._elem.hierarchy.length){var fr,ur=this._elem.hierarchy.length;for(fr=0;fr<ur;fr+=1)this._elem.hierarchy[fr].finalTransform.mProp.applyToMatrix(hr);return hr.inversePoint(cr)}return hr.inversePoint(cr)}function lr(){return[1,1,1,1]}return function(cr){var hr;function fr(_r){pr.mask=new MaskManagerInterface(_r,cr)}function ur(_r){pr.effect=_r}function pr(_r){switch(_r){case"ADBE Root Vectors Group":case"Contents":case 2:return pr.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return hr;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return pr.effect;case"ADBE Text Properties":return pr.textInterface;default:return null}}pr.getMatrix=ir,pr.invertPoint=ar,pr.applyPoint=sr,pr.toWorld=tr,pr.toWorldVec=er,pr.fromWorld=nr,pr.fromWorldVec=rr,pr.toComp=tr,pr.fromComp=or,pr.sampleImage=lr,pr.sourceRectAtTime=cr.sourceRectAtTime.bind(cr),pr._elem=cr,hr=TransformExpressionInterface(cr.finalTransform.mProp);var gr=getDescriptor(hr,"anchorPoint");return Object.defineProperties(pr,{hasParent:{get:function(){return cr.hierarchy.length}},parent:{get:function(){return cr.hierarchy[0].layerInterface}},rotation:getDescriptor(hr,"rotation"),scale:getDescriptor(hr,"scale"),position:getDescriptor(hr,"position"),opacity:getDescriptor(hr,"opacity"),anchorPoint:gr,anchor_point:gr,transform:{get:function(){return hr}},active:{get:function(){return cr.isInRange}}}),pr.startTime=cr.data.st,pr.index=cr.data.ind,pr.source=cr.data.refId,pr.height=cr.data.ty===0?cr.data.h:100,pr.width=cr.data.ty===0?cr.data.w:100,pr.inPoint=cr.data.ip/cr.comp.globalData.frameRate,pr.outPoint=cr.data.op/cr.comp.globalData.frameRate,pr._name=cr.data.nm,pr.registerMaskInterface=fr,pr.registerEffectsInterface=ur,pr}}(),propertyGroupFactory=function(){return function(ir,er){return function(tr){return tr=tr===void 0?1:tr,tr<=0?ir:er(tr-1)}}}(),PropertyInterface=function(){return function(ir,er){var tr={_name:ir};function rr(nr){return nr=nr===void 0?1:nr,nr<=0?tr:er(nr-1)}return rr}}(),EffectsExpressionInterface=function(){var ir={createEffectsInterface:er};function er(nr,sr){if(nr.effectsManager){var ar=[],or=nr.data.ef,lr,cr=nr.effectsManager.effectElements.length;for(lr=0;lr<cr;lr+=1)ar.push(tr(or[lr],nr.effectsManager.effectElements[lr],sr,nr));var hr=nr.data.ef||[],fr=function(ur){for(lr=0,cr=hr.length;lr<cr;){if(ur===hr[lr].nm||ur===hr[lr].mn||ur===hr[lr].ix)return ar[lr];lr+=1}return null};return Object.defineProperty(fr,"numProperties",{get:function(){return hr.length}}),fr}return null}function tr(nr,sr,ar,or){function lr(pr){for(var gr=nr.ef,_r=0,mr=gr.length;_r<mr;){if(pr===gr[_r].nm||pr===gr[_r].mn||pr===gr[_r].ix)return gr[_r].ty===5?hr[_r]:hr[_r]();_r+=1}throw new Error}var cr=propertyGroupFactory(lr,ar),hr=[],fr,ur=nr.ef.length;for(fr=0;fr<ur;fr+=1)nr.ef[fr].ty===5?hr.push(tr(nr.ef[fr],sr.effectElements[fr],sr.effectElements[fr].propertyGroup,or)):hr.push(rr(sr.effectElements[fr],nr.ef[fr].ty,or,cr));return nr.mn==="ADBE Color Control"&&Object.defineProperty(lr,"color",{get:function(){return hr[0]()}}),Object.defineProperties(lr,{numProperties:{get:function(){return nr.np}},_name:{value:nr.nm},propertyGroup:{value:cr}}),lr.enabled=nr.en!==0,lr.active=lr.enabled,lr}function rr(nr,sr,ar,or){var lr=ExpressionPropertyInterface(nr.p);function cr(){return sr===10?ar.comp.compInterface(nr.p.v):lr()}return nr.p.setGroupProperty&&nr.p.setGroupProperty(PropertyInterface("",or)),cr}return ir}(),CompExpressionInterface=function(){return function(ir){function er(tr){for(var rr=0,nr=ir.layers.length;rr<nr;){if(ir.layers[rr].nm===tr||ir.layers[rr].ind===tr)return ir.elements[rr].layerInterface;rr+=1}return null}return Object.defineProperty(er,"_name",{value:ir.data.nm}),er.layer=er,er.pixelAspect=1,er.height=ir.data.h||ir.globalData.compSize.h,er.width=ir.data.w||ir.globalData.compSize.w,er.pixelAspect=1,er.frameDuration=1/ir.globalData.frameRate,er.displayStartTime=0,er.numLayers=ir.layers.length,er}}(),ShapePathInterface=function(){return function(er,tr,rr){var nr=tr.sh;function sr(or){return or==="Shape"||or==="shape"||or==="Path"||or==="path"||or==="ADBE Vector Shape"||or===2?sr.path:null}var ar=propertyGroupFactory(sr,rr);return nr.setGroupProperty(PropertyInterface("Path",ar)),Object.defineProperties(sr,{path:{get:function(){return nr.k&&nr.getValue(),nr}},shape:{get:function(){return nr.k&&nr.getValue(),nr}},_name:{value:er.nm},ix:{value:er.ix},propertyIndex:{value:er.ix},mn:{value:er.mn},propertyGroup:{value:rr}}),sr}}(),ShapeExpressionInterface=function(){function ir(gr,_r,mr){var dr=[],vr,Ar=gr?gr.length:0;for(vr=0;vr<Ar;vr+=1)gr[vr].ty==="gr"?dr.push(tr(gr[vr],_r[vr],mr)):gr[vr].ty==="fl"?dr.push(rr(gr[vr],_r[vr],mr)):gr[vr].ty==="st"?dr.push(ar(gr[vr],_r[vr],mr)):gr[vr].ty==="tm"?dr.push(or(gr[vr],_r[vr],mr)):gr[vr].ty==="tr"||(gr[vr].ty==="el"?dr.push(cr(gr[vr],_r[vr],mr)):gr[vr].ty==="sr"?dr.push(hr(gr[vr],_r[vr],mr)):gr[vr].ty==="sh"?dr.push(ShapePathInterface(gr[vr],_r[vr],mr)):gr[vr].ty==="rc"?dr.push(fr(gr[vr],_r[vr],mr)):gr[vr].ty==="rd"?dr.push(ur(gr[vr],_r[vr],mr)):gr[vr].ty==="rp"?dr.push(pr(gr[vr],_r[vr],mr)):gr[vr].ty==="gf"?dr.push(nr(gr[vr],_r[vr],mr)):dr.push(sr(gr[vr],_r[vr],mr)));return dr}function er(gr,_r,mr){var dr,vr=function(wr){for(var br=0,Sr=dr.length;br<Sr;){if(dr[br]._name===wr||dr[br].mn===wr||dr[br].propertyIndex===wr||dr[br].ix===wr||dr[br].ind===wr)return dr[br];br+=1}return typeof wr=="number"?dr[wr-1]:null};vr.propertyGroup=propertyGroupFactory(vr,mr),dr=ir(gr.it,_r.it,vr.propertyGroup),vr.numProperties=dr.length;var Ar=lr(gr.it[gr.it.length-1],_r.it[_r.it.length-1],vr.propertyGroup);return vr.transform=Ar,vr.propertyIndex=gr.cix,vr._name=gr.nm,vr}function tr(gr,_r,mr){var dr=function(wr){switch(wr){case"ADBE Vectors Group":case"Contents":case 2:return dr.content;default:return dr.transform}};dr.propertyGroup=propertyGroupFactory(dr,mr);var vr=er(gr,_r,dr.propertyGroup),Ar=lr(gr.it[gr.it.length-1],_r.it[_r.it.length-1],dr.propertyGroup);return dr.content=vr,dr.transform=Ar,Object.defineProperty(dr,"_name",{get:function(){return gr.nm}}),dr.numProperties=gr.np,dr.propertyIndex=gr.ix,dr.nm=gr.nm,dr.mn=gr.mn,dr}function rr(gr,_r,mr){function dr(vr){return vr==="Color"||vr==="color"?dr.color:vr==="Opacity"||vr==="opacity"?dr.opacity:null}return Object.defineProperties(dr,{color:{get:ExpressionPropertyInterface(_r.c)},opacity:{get:ExpressionPropertyInterface(_r.o)},_name:{value:gr.nm},mn:{value:gr.mn}}),_r.c.setGroupProperty(PropertyInterface("Color",mr)),_r.o.setGroupProperty(PropertyInterface("Opacity",mr)),dr}function nr(gr,_r,mr){function dr(vr){return vr==="Start Point"||vr==="start point"?dr.startPoint:vr==="End Point"||vr==="end point"?dr.endPoint:vr==="Opacity"||vr==="opacity"?dr.opacity:null}return Object.defineProperties(dr,{startPoint:{get:ExpressionPropertyInterface(_r.s)},endPoint:{get:ExpressionPropertyInterface(_r.e)},opacity:{get:ExpressionPropertyInterface(_r.o)},type:{get:function(){return"a"}},_name:{value:gr.nm},mn:{value:gr.mn}}),_r.s.setGroupProperty(PropertyInterface("Start Point",mr)),_r.e.setGroupProperty(PropertyInterface("End Point",mr)),_r.o.setGroupProperty(PropertyInterface("Opacity",mr)),dr}function sr(){function gr(){return null}return gr}function ar(gr,_r,mr){var dr=propertyGroupFactory(Sr,mr),vr=propertyGroupFactory(br,dr);function Ar(xr){Object.defineProperty(br,gr.d[xr].nm,{get:ExpressionPropertyInterface(_r.d.dataProps[xr].p)})}var yr,wr=gr.d?gr.d.length:0,br={};for(yr=0;yr<wr;yr+=1)Ar(yr),_r.d.dataProps[yr].p.setGroupProperty(vr);function Sr(xr){return xr==="Color"||xr==="color"?Sr.color:xr==="Opacity"||xr==="opacity"?Sr.opacity:xr==="Stroke Width"||xr==="stroke width"?Sr.strokeWidth:null}return Object.defineProperties(Sr,{color:{get:ExpressionPropertyInterface(_r.c)},opacity:{get:ExpressionPropertyInterface(_r.o)},strokeWidth:{get:ExpressionPropertyInterface(_r.w)},dash:{get:function(){return br}},_name:{value:gr.nm},mn:{value:gr.mn}}),_r.c.setGroupProperty(PropertyInterface("Color",dr)),_r.o.setGroupProperty(PropertyInterface("Opacity",dr)),_r.w.setGroupProperty(PropertyInterface("Stroke Width",dr)),Sr}function or(gr,_r,mr){function dr(Ar){return Ar===gr.e.ix||Ar==="End"||Ar==="end"?dr.end:Ar===gr.s.ix?dr.start:Ar===gr.o.ix?dr.offset:null}var vr=propertyGroupFactory(dr,mr);return dr.propertyIndex=gr.ix,_r.s.setGroupProperty(PropertyInterface("Start",vr)),_r.e.setGroupProperty(PropertyInterface("End",vr)),_r.o.setGroupProperty(PropertyInterface("Offset",vr)),dr.propertyIndex=gr.ix,dr.propertyGroup=mr,Object.defineProperties(dr,{start:{get:ExpressionPropertyInterface(_r.s)},end:{get:ExpressionPropertyInterface(_r.e)},offset:{get:ExpressionPropertyInterface(_r.o)},_name:{value:gr.nm}}),dr.mn=gr.mn,dr}function lr(gr,_r,mr){function dr(Ar){return gr.a.ix===Ar||Ar==="Anchor Point"?dr.anchorPoint:gr.o.ix===Ar||Ar==="Opacity"?dr.opacity:gr.p.ix===Ar||Ar==="Position"?dr.position:gr.r.ix===Ar||Ar==="Rotation"||Ar==="ADBE Vector Rotation"?dr.rotation:gr.s.ix===Ar||Ar==="Scale"?dr.scale:gr.sk&&gr.sk.ix===Ar||Ar==="Skew"?dr.skew:gr.sa&&gr.sa.ix===Ar||Ar==="Skew Axis"?dr.skewAxis:null}var vr=propertyGroupFactory(dr,mr);return _r.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",vr)),_r.transform.mProps.p.setGroupProperty(PropertyInterface("Position",vr)),_r.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",vr)),_r.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",vr)),_r.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",vr)),_r.transform.mProps.sk&&(_r.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",vr)),_r.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",vr))),_r.transform.op.setGroupProperty(PropertyInterface("Opacity",vr)),Object.defineProperties(dr,{opacity:{get:ExpressionPropertyInterface(_r.transform.mProps.o)},position:{get:ExpressionPropertyInterface(_r.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(_r.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(_r.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(_r.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(_r.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(_r.transform.mProps.sa)},_name:{value:gr.nm}}),dr.ty="tr",dr.mn=gr.mn,dr.propertyGroup=mr,dr}function cr(gr,_r,mr){function dr(yr){return gr.p.ix===yr?dr.position:gr.s.ix===yr?dr.size:null}var vr=propertyGroupFactory(dr,mr);dr.propertyIndex=gr.ix;var Ar=_r.sh.ty==="tm"?_r.sh.prop:_r.sh;return Ar.s.setGroupProperty(PropertyInterface("Size",vr)),Ar.p.setGroupProperty(PropertyInterface("Position",vr)),Object.defineProperties(dr,{size:{get:ExpressionPropertyInterface(Ar.s)},position:{get:ExpressionPropertyInterface(Ar.p)},_name:{value:gr.nm}}),dr.mn=gr.mn,dr}function hr(gr,_r,mr){function dr(yr){return gr.p.ix===yr?dr.position:gr.r.ix===yr?dr.rotation:gr.pt.ix===yr?dr.points:gr.or.ix===yr||yr==="ADBE Vector Star Outer Radius"?dr.outerRadius:gr.os.ix===yr?dr.outerRoundness:gr.ir&&(gr.ir.ix===yr||yr==="ADBE Vector Star Inner Radius")?dr.innerRadius:gr.is&&gr.is.ix===yr?dr.innerRoundness:null}var vr=propertyGroupFactory(dr,mr),Ar=_r.sh.ty==="tm"?_r.sh.prop:_r.sh;return dr.propertyIndex=gr.ix,Ar.or.setGroupProperty(PropertyInterface("Outer Radius",vr)),Ar.os.setGroupProperty(PropertyInterface("Outer Roundness",vr)),Ar.pt.setGroupProperty(PropertyInterface("Points",vr)),Ar.p.setGroupProperty(PropertyInterface("Position",vr)),Ar.r.setGroupProperty(PropertyInterface("Rotation",vr)),gr.ir&&(Ar.ir.setGroupProperty(PropertyInterface("Inner Radius",vr)),Ar.is.setGroupProperty(PropertyInterface("Inner Roundness",vr))),Object.defineProperties(dr,{position:{get:ExpressionPropertyInterface(Ar.p)},rotation:{get:ExpressionPropertyInterface(Ar.r)},points:{get:ExpressionPropertyInterface(Ar.pt)},outerRadius:{get:ExpressionPropertyInterface(Ar.or)},outerRoundness:{get:ExpressionPropertyInterface(Ar.os)},innerRadius:{get:ExpressionPropertyInterface(Ar.ir)},innerRoundness:{get:ExpressionPropertyInterface(Ar.is)},_name:{value:gr.nm}}),dr.mn=gr.mn,dr}function fr(gr,_r,mr){function dr(yr){return gr.p.ix===yr?dr.position:gr.r.ix===yr?dr.roundness:gr.s.ix===yr||yr==="Size"||yr==="ADBE Vector Rect Size"?dr.size:null}var vr=propertyGroupFactory(dr,mr),Ar=_r.sh.ty==="tm"?_r.sh.prop:_r.sh;return dr.propertyIndex=gr.ix,Ar.p.setGroupProperty(PropertyInterface("Position",vr)),Ar.s.setGroupProperty(PropertyInterface("Size",vr)),Ar.r.setGroupProperty(PropertyInterface("Rotation",vr)),Object.defineProperties(dr,{position:{get:ExpressionPropertyInterface(Ar.p)},roundness:{get:ExpressionPropertyInterface(Ar.r)},size:{get:ExpressionPropertyInterface(Ar.s)},_name:{value:gr.nm}}),dr.mn=gr.mn,dr}function ur(gr,_r,mr){function dr(yr){return gr.r.ix===yr||yr==="Round Corners 1"?dr.radius:null}var vr=propertyGroupFactory(dr,mr),Ar=_r;return dr.propertyIndex=gr.ix,Ar.rd.setGroupProperty(PropertyInterface("Radius",vr)),Object.defineProperties(dr,{radius:{get:ExpressionPropertyInterface(Ar.rd)},_name:{value:gr.nm}}),dr.mn=gr.mn,dr}function pr(gr,_r,mr){function dr(yr){return gr.c.ix===yr||yr==="Copies"?dr.copies:gr.o.ix===yr||yr==="Offset"?dr.offset:null}var vr=propertyGroupFactory(dr,mr),Ar=_r;return dr.propertyIndex=gr.ix,Ar.c.setGroupProperty(PropertyInterface("Copies",vr)),Ar.o.setGroupProperty(PropertyInterface("Offset",vr)),Object.defineProperties(dr,{copies:{get:ExpressionPropertyInterface(Ar.c)},offset:{get:ExpressionPropertyInterface(Ar.o)},_name:{value:gr.nm}}),dr.mn=gr.mn,dr}return function(gr,_r,mr){var dr;function vr(yr){if(typeof yr=="number")return yr=yr===void 0?1:yr,yr===0?mr:dr[yr-1];for(var wr=0,br=dr.length;wr<br;){if(dr[wr]._name===yr)return dr[wr];wr+=1}return null}function Ar(){return mr}return vr.propertyGroup=propertyGroupFactory(vr,Ar),dr=ir(gr,_r,vr.propertyGroup),vr.numProperties=dr.length,vr._name="Contents",vr}}(),TextExpressionInterface=function(){return function(ir){var er,tr;function rr(nr){switch(nr){case"ADBE Text Document":return rr.sourceText;default:return null}}return Object.defineProperty(rr,"sourceText",{get:function(){ir.textProperty.getValue();var nr=ir.textProperty.currentData.t;return nr!==er&&(ir.textProperty.currentData.t=er,tr=new String(nr),tr.value=nr||new String(nr)),tr}}),rr}}(),getBlendMode=function(){var ir={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(er){return ir[er]||""}}();extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(ir,er){this.data=ir,this.effectElements=[],this.initDynamicPropertyContainer(er);var tr,rr=this.data.ef.length,nr,sr=this.data.ef;for(tr=0;tr<rr;tr+=1){switch(nr=null,sr[tr].ty){case 0:nr=new SliderEffect(sr[tr],er,this);break;case 1:nr=new AngleEffect(sr[tr],er,this);break;case 2:nr=new ColorEffect(sr[tr],er,this);break;case 3:nr=new PointEffect(sr[tr],er,this);break;case 4:case 7:nr=new CheckboxEffect(sr[tr],er,this);break;case 10:nr=new LayerIndexEffect(sr[tr],er,this);break;case 11:nr=new MaskIndexEffect(sr[tr],er,this);break;case 5:nr=new EffectsManager(sr[tr],er,this);break;default:nr=new NoValueEffect(sr[tr],er,this);break}nr&&this.effectElements.push(nr)}},BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var ir=0,er=this.data.masksProperties.length;ir<er;){if(this.data.masksProperties[ir].mode!=="n"&&this.data.masksProperties[ir].cl!==!1)return!0;ir+=1}return!1},initExpressions:function(){this.layerInterface=LayerExpressionInterface(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var ir=EffectsExpressionInterface.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(ir),this.data.ty===0||this.data.xt?this.compInterface=CompExpressionInterface(this):this.data.ty===4?(this.layerInterface.shapeInterface=ShapeExpressionInterface(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=TextExpressionInterface(this),this.layerInterface.text=this.layerInterface.textInterface)},setBlendMode:function(){var ir=getBlendMode(this.data.bm),er=this.baseElement||this.layerElement;er.style["mix-blend-mode"]=ir},initBaseData:function(ir,er,tr){this.globalData=er,this.comp=tr,this.data=ir,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(ir,er){var tr,rr=this.dynamicProperties.length;for(tr=0;tr<rr;tr+=1)(er||this._isParent&&this.dynamicProperties[tr].propType==="transform")&&(this.dynamicProperties[tr].getValue(),this.dynamicProperties[tr]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(ir){this.dynamicProperties.indexOf(ir)===-1&&this.dynamicProperties.push(ir)}};const FootageInterface=function(){var ir=function(tr){var rr="",nr=tr.getFootageData();function sr(){return rr="",nr=tr.getFootageData(),ar}function ar(or){if(nr[or])return rr=or,nr=nr[or],typeof nr=="object"?ar:nr;var lr=or.indexOf(rr);if(lr!==-1){var cr=parseInt(or.substr(lr+rr.length),10);return nr=nr[cr],typeof nr=="object"?ar:nr}return""}return sr},er=function(tr){function rr(nr){return nr==="Outline"?rr.outlineInterface():null}return rr._name="Outline",rr.outlineInterface=ir(tr),rr};return function(tr){function rr(nr){return nr==="Data"?rr.dataInterface:null}return rr._name="Data",rr.dataInterface=er(tr),rr}}();FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){this.layerInterface=FootageInterface(this)},FootageElement.prototype.getFootageData=function(){return this.footageData},AudioElement.prototype.prepareFrame=function(ir){if(this.prepareRenderableFrame(ir,!0),this.prepareProperties(ir,!0),this.tm._placeholder)this._currentTime=ir/this.data.sr;else{var er=this.tm.v;this._currentTime=er}this._volume=this.lv.v[0];var tr=this._volume*this._volumeMultiplier;this._previousVolume!==tr&&(this._previousVolume=tr,this.audio.volume(tr))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(ir){this.audio.rate(ir)},AudioElement.prototype.volume=function(ir){this._volumeMultiplier=ir,this._previousVolume=ir*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){},BaseRenderer.prototype.checkLayers=function(ir){var er,tr=this.layers.length,rr;for(this.completeLayers=!0,er=tr-1;er>=0;er-=1)this.elements[er]||(rr=this.layers[er],rr.ip-rr.st<=ir-this.layers[er].st&&rr.op-rr.st>ir-this.layers[er].st&&this.buildItem(er)),this.completeLayers=this.elements[er]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(ir){switch(ir.ty){case 2:return this.createImage(ir);case 0:return this.createComp(ir);case 1:return this.createSolid(ir);case 3:return this.createNull(ir);case 4:return this.createShape(ir);case 5:return this.createText(ir);case 6:return this.createAudio(ir);case 13:return this.createCamera(ir);case 15:return this.createFootage(ir);default:return this.createNull(ir)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(ir){return new AudioElement(ir,this.globalData,this)},BaseRenderer.prototype.createFootage=function(ir){return new FootageElement(ir,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var ir,er=this.layers.length;for(ir=0;ir<er;ir+=1)this.buildItem(ir);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(ir){this.completeLayers=!1;var er,tr=ir.length,rr,nr=this.layers.length;for(er=0;er<tr;er+=1)for(rr=0;rr<nr;){if(this.layers[rr].id===ir[er].id){this.layers[rr]=ir[er];break}rr+=1}},BaseRenderer.prototype.setProjectInterface=function(ir){this.globalData.projectInterface=ir},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(ir,er,tr){for(var rr=this.elements,nr=this.layers,sr=0,ar=nr.length;sr<ar;)nr[sr].ind==er&&(!rr[sr]||rr[sr]===!0?(this.buildItem(sr),this.addPendingElement(ir)):(tr.push(rr[sr]),rr[sr].setAsParent(),nr[sr].parent!==void 0?this.buildElementParenting(ir,nr[sr].parent,tr):ir.setHierarchy(tr))),sr+=1},BaseRenderer.prototype.addPendingElement=function(ir){this.pendingElements.push(ir)},BaseRenderer.prototype.searchExtraCompositions=function(ir){var er,tr=ir.length;for(er=0;er<tr;er+=1)if(ir[er].xt){var rr=this.createComp(ir[er]);rr.initExpressions(),this.globalData.projectInterface.registerComposition(rr)}},BaseRenderer.prototype.getElementByPath=function(ir){var er=ir.shift(),tr;if(typeof er=="number")tr=this.elements[er];else{var rr,nr=this.elements.length;for(rr=0;rr<nr;rr+=1)if(this.elements[rr].data.nm===er){tr=this.elements[rr];break}}return ir.length===0?tr:tr.getElementByPath(ir)},BaseRenderer.prototype.setupGlobalData=function(ir,er){this.globalData.fontManager=new FontManager,this.globalData.fontManager.addChars(ir.chars),this.globalData.fontManager.addFonts(ir.fonts,er),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=ir.fr,this.globalData.nm=ir.nm,this.globalData.compSize={w:ir.w,h:ir.h}},TransformElement.prototype={initTransform:function(){this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_opMdf:!1,mat:new Matrix},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var ir,er=this.finalTransform.mat,tr=0,rr=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;tr<rr;){if(this.hierarchy[tr].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}tr+=1}if(this.finalTransform._matMdf)for(ir=this.finalTransform.mProp.v.props,er.cloneFromProps(ir),tr=0;tr<rr;tr+=1)ir=this.hierarchy[tr].finalTransform.mProp.v.props,er.transform(ir[0],ir[1],ir[2],ir[3],ir[4],ir[5],ir[6],ir[7],ir[8],ir[9],ir[10],ir[11],ir[12],ir[13],ir[14],ir[15])}},globalToLocal:function(ir){var er=[];er.push(this.finalTransform);for(var tr=!0,rr=this.comp;tr;)rr.finalTransform?(rr.data.hasMask&&er.splice(0,0,rr.finalTransform),rr=rr.comp):tr=!1;var nr,sr=er.length,ar;for(nr=0;nr<sr;nr+=1)ar=er[nr].mat.applyToPointArray(0,0,0),ir=[ir[0]-ar[0],ir[1]-ar[1],0];return ir},mHelper:new Matrix},MaskElement.prototype.getMaskProperty=function(ir){return this.viewData[ir].prop},MaskElement.prototype.renderFrame=function(ir){var er=this.element.finalTransform.mat,tr,rr=this.masksProperties.length;for(tr=0;tr<rr;tr+=1)if((this.viewData[tr].prop._mdf||ir)&&this.drawPath(this.masksProperties[tr],this.viewData[tr].prop.v,this.viewData[tr]),(this.viewData[tr].op._mdf||ir)&&this.viewData[tr].elem.setAttribute("fill-opacity",this.viewData[tr].op.v),this.masksProperties[tr].mode!=="n"&&(this.viewData[tr].invRect&&(this.element.finalTransform.mProp._mdf||ir)&&this.viewData[tr].invRect.setAttribute("transform",er.getInverseMatrix().to2dCSS()),this.storedData[tr].x&&(this.storedData[tr].x._mdf||ir))){var nr=this.storedData[tr].expan;this.storedData[tr].x.v<0?(this.storedData[tr].lastOperator!=="erode"&&(this.storedData[tr].lastOperator="erode",this.storedData[tr].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[tr].filterId+")")),nr.setAttribute("radius",-this.storedData[tr].x.v)):(this.storedData[tr].lastOperator!=="dilate"&&(this.storedData[tr].lastOperator="dilate",this.storedData[tr].elem.setAttribute("filter",null)),this.storedData[tr].elem.setAttribute("stroke-width",this.storedData[tr].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var ir="M0,0 ";return ir+=" h"+this.globalData.compSize.w,ir+=" v"+this.globalData.compSize.h,ir+=" h-"+this.globalData.compSize.w,ir+=" v-"+this.globalData.compSize.h+" ",ir},MaskElement.prototype.drawPath=function(ir,er,tr){var rr=" M"+er.v[0][0]+","+er.v[0][1],nr,sr;for(sr=er._length,nr=1;nr<sr;nr+=1)rr+=" C"+er.o[nr-1][0]+","+er.o[nr-1][1]+" "+er.i[nr][0]+","+er.i[nr][1]+" "+er.v[nr][0]+","+er.v[nr][1];if(er.c&&sr>1&&(rr+=" C"+er.o[nr-1][0]+","+er.o[nr-1][1]+" "+er.i[0][0]+","+er.i[0][1]+" "+er.v[0][0]+","+er.v[0][1]),tr.lastPath!==rr){var ar="";tr.elem&&(er.c&&(ar=ir.inv?this.solidPath+rr:rr),tr.elem.setAttribute("d",ar)),tr.lastPath=rr}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};const filtersFactory=function(){var ir={};ir.createFilter=er,ir.createAlphaToLuminanceFilter=tr;function er(rr,nr){var sr=createNS("filter");return sr.setAttribute("id",rr),nr!==!0&&(sr.setAttribute("filterUnits","objectBoundingBox"),sr.setAttribute("x","0%"),sr.setAttribute("y","0%"),sr.setAttribute("width","100%"),sr.setAttribute("height","100%")),sr}function tr(){var rr=createNS("feColorMatrix");return rr.setAttribute("type","matrix"),rr.setAttribute("color-interpolation-filters","sRGB"),rr.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),rr}return ir}(),featureSupport=function(){var ir={maskType:!0};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(ir.maskType=!1),ir}();var registeredEffects={},idPrefix="filter_result_";SVGEffects.prototype.renderFrame=function(ir){var er,tr=this.filters.length;for(er=0;er<tr;er+=1)this.filters[er].renderFrame(ir)},SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var ir=null,er,tr,rr;if(this.data.td){if(this.data.td==3||this.data.td==1){var nr=createNS("mask");nr.setAttribute("id",this.layerId),nr.setAttribute("mask-type",this.data.td==3?"luminance":"alpha"),nr.appendChild(this.layerElement),ir=nr,this.globalData.defs.appendChild(nr),!featureSupport.maskType&&this.data.td==1&&(nr.setAttribute("mask-type","luminance"),er=createElementID(),tr=filtersFactory.createFilter(er),this.globalData.defs.appendChild(tr),tr.appendChild(filtersFactory.createAlphaToLuminanceFilter()),rr=createNS("g"),rr.appendChild(this.layerElement),ir=rr,nr.appendChild(rr),rr.setAttribute("filter","url("+getLocationHref()+"#"+er+")"))}else if(this.data.td==2){var sr=createNS("mask");sr.setAttribute("id",this.layerId),sr.setAttribute("mask-type","alpha");var ar=createNS("g");sr.appendChild(ar),er=createElementID(),tr=filtersFactory.createFilter(er);var or=createNS("feComponentTransfer");or.setAttribute("in","SourceGraphic"),tr.appendChild(or);var lr=createNS("feFuncA");lr.setAttribute("type","table"),lr.setAttribute("tableValues","1.0 0.0"),or.appendChild(lr),this.globalData.defs.appendChild(tr);var cr=createNS("rect");cr.setAttribute("width",this.comp.data.w),cr.setAttribute("height",this.comp.data.h),cr.setAttribute("x","0"),cr.setAttribute("y","0"),cr.setAttribute("fill","#ffffff"),cr.setAttribute("opacity","0"),ar.setAttribute("filter","url("+getLocationHref()+"#"+er+")"),ar.appendChild(cr),ar.appendChild(this.layerElement),ir=ar,featureSupport.maskType||(sr.setAttribute("mask-type","luminance"),tr.appendChild(filtersFactory.createAlphaToLuminanceFilter()),rr=createNS("g"),ar.appendChild(cr),rr.appendChild(this.layerElement),ir=rr,ar.appendChild(rr)),this.globalData.defs.appendChild(sr)}}else this.data.tt?(this.matteElement.appendChild(this.layerElement),ir=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var hr=createNS("clipPath"),fr=createNS("path");fr.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var ur=createElementID();if(hr.setAttribute("id",ur),hr.appendChild(fr),this.globalData.defs.appendChild(hr),this.checkMasks()){var pr=createNS("g");pr.setAttribute("clip-path","url("+getLocationHref()+"#"+ur+")"),pr.appendChild(this.layerElement),this.transformedElement=pr,ir?ir.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+ur+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._matMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.mat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.mProp.o.v)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this)},setMatte:function(ir){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+ir+")")}},HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(ir){this.hierarchy=ir},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}},function(){var ir={initElement:function(er,tr,rr){this.initFrame(),this.initBaseData(er,tr,rr),this.initTransform(er,tr,rr),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var er=this.baseElement||this.layerElement;er.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var er=this.baseElement||this.layerElement;er.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(er){this._mdf=!1,this.prepareRenderableFrame(er),this.prepareProperties(er,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(ir)],RenderableDOMElement)}(),extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var ir=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",ir),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect},IShapeElement.prototype={addShapeToModifiers:function(ir){var er,tr=this.shapeModifiers.length;for(er=0;er<tr;er+=1)this.shapeModifiers[er].addShape(ir)},isShapeInAnimatedModifiers:function(ir){for(var er=0,tr=this.shapeModifiers.length;er<tr;)if(this.shapeModifiers[er].isAnimatedWithShape(ir))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var ir,er=this.shapes.length;for(ir=0;ir<er;ir+=1)this.shapes[ir].sh.reset();er=this.shapeModifiers.length;var tr;for(ir=er-1;ir>=0&&(tr=this.shapeModifiers[ir].processShapes(this._isFirstFrame),!tr);ir-=1);}},searchProcessedElement:function(ir){for(var er=this.processedElements,tr=0,rr=er.length;tr<rr;){if(er[tr].elem===ir)return er[tr].pos;tr+=1}return 0},addProcessedElement:function(ir,er){for(var tr=this.processedElements,rr=tr.length;rr;)if(rr-=1,tr[rr].elem===ir){tr[rr].pos=er;return}tr.push(new ProcessedElement(ir,er))},prepareFrame:function(ir){this.prepareRenderableFrame(ir),this.prepareProperties(ir,this.isInRange)}};const lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0},SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1},DashProperty.prototype.getValue=function(ir){if(!(this.elem.globalData.frameId===this.frameId&&!ir)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||ir,this._mdf)){var er=0,tr=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),er=0;er<tr;er+=1)this.dataProps[er].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[er].p.v:this.dashArray[er]=this.dataProps[er].p.v:this.dashoffset[0]=this.dataProps[er].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty),extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData),extendPrototype([DynamicPropertyContainer],SVGFillStyleData),extendPrototype([DynamicPropertyContainer],SVGNoStyleData),GradientProperty.prototype.comparePoints=function(ir,er){for(var tr=0,rr=this.o.length/2,nr;tr<rr;){if(nr=Math.abs(ir[tr*4]-ir[er*4+tr*2]),nr>.01)return!1;tr+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var ir=0,er=this.data.k.k.length;ir<er;){if(!this.comparePoints(this.data.k.k[ir].s,this.data.p))return!1;ir+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(ir){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||ir){var er,tr=this.data.p*4,rr,nr;for(er=0;er<tr;er+=1)rr=er%4===0?100:255,nr=Math.round(this.prop.v[er]*rr),this.c[er]!==nr&&(this.c[er]=nr,this._cmdf=!ir);if(this.o.length)for(tr=this.prop.v.length,er=this.data.p*4;er<tr;er+=1)rr=er%2===0?100:1,nr=er%2===0?Math.round(this.prop.v[er]*100):this.prop.v[er],this.o[er-this.data.p*4]!==nr&&(this.o[er-this.data.p*4]=nr,this._omdf=!ir);this._mdf=!ir}},extendPrototype([DynamicPropertyContainer],GradientProperty),SVGGradientFillStyleData.prototype.initGradientData=function(ir,er,tr){this.o=PropertyFactory.getProp(ir,er.o,0,.01,this),this.s=PropertyFactory.getProp(ir,er.s,1,null,this),this.e=PropertyFactory.getProp(ir,er.e,1,null,this),this.h=PropertyFactory.getProp(ir,er.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(ir,er.a||{k:0},0,degToRads,this),this.g=new GradientProperty(ir,er.g,this),this.style=tr,this.stops=[],this.setGradientData(tr.pElem,er),this.setGradientOpacity(er,tr),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(ir,er){var tr=createElementID(),rr=createNS(er.t===1?"linearGradient":"radialGradient");rr.setAttribute("id",tr),rr.setAttribute("spreadMethod","pad"),rr.setAttribute("gradientUnits","userSpaceOnUse");var nr=[],sr,ar,or;for(or=er.g.p*4,ar=0;ar<or;ar+=4)sr=createNS("stop"),rr.appendChild(sr),nr.push(sr);ir.setAttribute(er.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+tr+")"),this.gf=rr,this.cst=nr},SVGGradientFillStyleData.prototype.setGradientOpacity=function(ir,er){if(this.g._hasOpacity&&!this.g._collapsable){var tr,rr,nr,sr=createNS("mask"),ar=createNS("path");sr.appendChild(ar);var or=createElementID(),lr=createElementID();sr.setAttribute("id",lr);var cr=createNS(ir.t===1?"linearGradient":"radialGradient");cr.setAttribute("id",or),cr.setAttribute("spreadMethod","pad"),cr.setAttribute("gradientUnits","userSpaceOnUse"),nr=ir.g.k.k[0].s?ir.g.k.k[0].s.length:ir.g.k.k.length;var hr=this.stops;for(rr=ir.g.p*4;rr<nr;rr+=2)tr=createNS("stop"),tr.setAttribute("stop-color","rgb(255,255,255)"),cr.appendChild(tr),hr.push(tr);ar.setAttribute(ir.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+or+")"),ir.ty==="gs"&&(ar.setAttribute("stroke-linecap",lineCapEnum[ir.lc||2]),ar.setAttribute("stroke-linejoin",lineJoinEnum[ir.lj||2]),ir.lj===1&&ar.setAttribute("stroke-miterlimit",ir.ml)),this.of=cr,this.ms=sr,this.ost=hr,this.maskId=lr,er.msElem=ar}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData),extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);const buildShapeString=function(ir,er,tr,rr){if(er===0)return"";var nr=ir.o,sr=ir.i,ar=ir.v,or,lr=" M"+rr.applyToPointStringified(ar[0][0],ar[0][1]);for(or=1;or<er;or+=1)lr+=" C"+rr.applyToPointStringified(nr[or-1][0],nr[or-1][1])+" "+rr.applyToPointStringified(sr[or][0],sr[or][1])+" "+rr.applyToPointStringified(ar[or][0],ar[or][1]);return tr&&er&&(lr+=" C"+rr.applyToPointStringified(nr[or-1][0],nr[or-1][1])+" "+rr.applyToPointStringified(sr[0][0],sr[0][1])+" "+rr.applyToPointStringified(ar[0][0],ar[0][1]),lr+="z"),lr},SVGElementsRenderer=function(){var ir=new Matrix,er=new Matrix,tr={createRenderFunction:rr};function rr(fr){switch(fr.ty){case"fl":return or;case"gf":return cr;case"gs":return lr;case"st":return hr;case"sh":case"el":case"rc":case"sr":return ar;case"tr":return nr;case"no":return sr;default:return null}}function nr(fr,ur,pr){(pr||ur.transform.op._mdf)&&ur.transform.container.setAttribute("opacity",ur.transform.op.v),(pr||ur.transform.mProps._mdf)&&ur.transform.container.setAttribute("transform",ur.transform.mProps.v.to2dCSS())}function sr(){}function ar(fr,ur,pr){var gr,_r,mr,dr,vr,Ar,yr=ur.styles.length,wr=ur.lvl,br,Sr,xr,Cr,Ir;for(Ar=0;Ar<yr;Ar+=1){if(dr=ur.sh._mdf||pr,ur.styles[Ar].lvl<wr){for(Sr=er.reset(),Cr=wr-ur.styles[Ar].lvl,Ir=ur.transformers.length-1;!dr&&Cr>0;)dr=ur.transformers[Ir].mProps._mdf||dr,Cr-=1,Ir-=1;if(dr)for(Cr=wr-ur.styles[Ar].lvl,Ir=ur.transformers.length-1;Cr>0;)xr=ur.transformers[Ir].mProps.v.props,Sr.transform(xr[0],xr[1],xr[2],xr[3],xr[4],xr[5],xr[6],xr[7],xr[8],xr[9],xr[10],xr[11],xr[12],xr[13],xr[14],xr[15]),Cr-=1,Ir-=1}else Sr=ir;if(br=ur.sh.paths,_r=br._length,dr){for(mr="",gr=0;gr<_r;gr+=1)vr=br.shapes[gr],vr&&vr._length&&(mr+=buildShapeString(vr,vr._length,vr.c,Sr));ur.caches[Ar]=mr}else mr=ur.caches[Ar];ur.styles[Ar].d+=fr.hd===!0?"":mr,ur.styles[Ar]._mdf=dr||ur.styles[Ar]._mdf}}function or(fr,ur,pr){var gr=ur.style;(ur.c._mdf||pr)&&gr.pElem.setAttribute("fill","rgb("+bmFloor(ur.c.v[0])+","+bmFloor(ur.c.v[1])+","+bmFloor(ur.c.v[2])+")"),(ur.o._mdf||pr)&&gr.pElem.setAttribute("fill-opacity",ur.o.v)}function lr(fr,ur,pr){cr(fr,ur,pr),hr(fr,ur,pr)}function cr(fr,ur,pr){var gr=ur.gf,_r=ur.g._hasOpacity,mr=ur.s.v,dr=ur.e.v;if(ur.o._mdf||pr){var vr=fr.ty==="gf"?"fill-opacity":"stroke-opacity";ur.style.pElem.setAttribute(vr,ur.o.v)}if(ur.s._mdf||pr){var Ar=fr.t===1?"x1":"cx",yr=Ar==="x1"?"y1":"cy";gr.setAttribute(Ar,mr[0]),gr.setAttribute(yr,mr[1]),_r&&!ur.g._collapsable&&(ur.of.setAttribute(Ar,mr[0]),ur.of.setAttribute(yr,mr[1]))}var wr,br,Sr,xr;if(ur.g._cmdf||pr){wr=ur.cst;var Cr=ur.g.c;for(Sr=wr.length,br=0;br<Sr;br+=1)xr=wr[br],xr.setAttribute("offset",Cr[br*4]+"%"),xr.setAttribute("stop-color","rgb("+Cr[br*4+1]+","+Cr[br*4+2]+","+Cr[br*4+3]+")")}if(_r&&(ur.g._omdf||pr)){var Ir=ur.g.o;for(ur.g._collapsable?wr=ur.cst:wr=ur.ost,Sr=wr.length,br=0;br<Sr;br+=1)xr=wr[br],ur.g._collapsable||xr.setAttribute("offset",Ir[br*2]+"%"),xr.setAttribute("stop-opacity",Ir[br*2+1])}if(fr.t===1)(ur.e._mdf||pr)&&(gr.setAttribute("x2",dr[0]),gr.setAttribute("y2",dr[1]),_r&&!ur.g._collapsable&&(ur.of.setAttribute("x2",dr[0]),ur.of.setAttribute("y2",dr[1])));else{var Rr;if((ur.s._mdf||ur.e._mdf||pr)&&(Rr=Math.sqrt(Math.pow(mr[0]-dr[0],2)+Math.pow(mr[1]-dr[1],2)),gr.setAttribute("r",Rr),_r&&!ur.g._collapsable&&ur.of.setAttribute("r",Rr)),ur.e._mdf||ur.h._mdf||ur.a._mdf||pr){Rr||(Rr=Math.sqrt(Math.pow(mr[0]-dr[0],2)+Math.pow(mr[1]-dr[1],2)));var Pr=Math.atan2(dr[1]-mr[1],dr[0]-mr[0]),Fr=ur.h.v;Fr>=1?Fr=.99:Fr<=-1&&(Fr=-.99);var Nr=Rr*Fr,Ur=Math.cos(Pr+ur.a.v)*Nr+mr[0],Br=Math.sin(Pr+ur.a.v)*Nr+mr[1];gr.setAttribute("fx",Ur),gr.setAttribute("fy",Br),_r&&!ur.g._collapsable&&(ur.of.setAttribute("fx",Ur),ur.of.setAttribute("fy",Br))}}}function hr(fr,ur,pr){var gr=ur.style,_r=ur.d;_r&&(_r._mdf||pr)&&_r.dashStr&&(gr.pElem.setAttribute("stroke-dasharray",_r.dashStr),gr.pElem.setAttribute("stroke-dashoffset",_r.dashoffset[0])),ur.c&&(ur.c._mdf||pr)&&gr.pElem.setAttribute("stroke","rgb("+bmFloor(ur.c.v[0])+","+bmFloor(ur.c.v[1])+","+bmFloor(ur.c.v[2])+")"),(ur.o._mdf||pr)&&gr.pElem.setAttribute("stroke-opacity",ur.o.v),(ur.w._mdf||pr)&&(gr.pElem.setAttribute("stroke-width",ur.w.v),gr.msElem&&gr.msElem.setAttribute("stroke-width",ur.w.v))}return tr}();extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var ir,er=this.shapes.length,tr,rr,nr=this.stylesList.length,sr,ar=[],or=!1;for(rr=0;rr<nr;rr+=1){for(sr=this.stylesList[rr],or=!1,ar.length=0,ir=0;ir<er;ir+=1)tr=this.shapes[ir],tr.styles.indexOf(sr)!==-1&&(ar.push(tr),or=tr._isAnimated||or);ar.length>1&&or&&this.setShapesAsAnimated(ar)}},SVGShapeElement.prototype.setShapesAsAnimated=function(ir){var er,tr=ir.length;for(er=0;er<tr;er+=1)ir[er].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(ir,er){var tr,rr=new SVGStyleData(ir,er),nr=rr.pElem;if(ir.ty==="st")tr=new SVGStrokeStyleData(this,ir,rr);else if(ir.ty==="fl")tr=new SVGFillStyleData(this,ir,rr);else if(ir.ty==="gf"||ir.ty==="gs"){var sr=ir.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;tr=new sr(this,ir,rr),this.globalData.defs.appendChild(tr.gf),tr.maskId&&(this.globalData.defs.appendChild(tr.ms),this.globalData.defs.appendChild(tr.of),nr.setAttribute("mask","url("+getLocationHref()+"#"+tr.maskId+")"))}else ir.ty==="no"&&(tr=new SVGNoStyleData(this,ir,rr));return(ir.ty==="st"||ir.ty==="gs")&&(nr.setAttribute("stroke-linecap",lineCapEnum[ir.lc||2]),nr.setAttribute("stroke-linejoin",lineJoinEnum[ir.lj||2]),nr.setAttribute("fill-opacity","0"),ir.lj===1&&nr.setAttribute("stroke-miterlimit",ir.ml)),ir.r===2&&nr.setAttribute("fill-rule","evenodd"),ir.ln&&nr.setAttribute("id",ir.ln),ir.cl&&nr.setAttribute("class",ir.cl),ir.bm&&(nr.style["mix-blend-mode"]=getBlendMode(ir.bm)),this.stylesList.push(rr),this.addToAnimatedContents(ir,tr),tr},SVGShapeElement.prototype.createGroupElement=function(ir){var er=new ShapeGroupData;return ir.ln&&er.gr.setAttribute("id",ir.ln),ir.cl&&er.gr.setAttribute("class",ir.cl),ir.bm&&(er.gr.style["mix-blend-mode"]=getBlendMode(ir.bm)),er},SVGShapeElement.prototype.createTransformElement=function(ir,er){var tr=TransformPropertyFactory.getTransformProperty(this,ir,this),rr=new SVGTransformData(tr,tr.o,er);return this.addToAnimatedContents(ir,rr),rr},SVGShapeElement.prototype.createShapeElement=function(ir,er,tr){var rr=4;ir.ty==="rc"?rr=5:ir.ty==="el"?rr=6:ir.ty==="sr"&&(rr=7);var nr=ShapePropertyFactory.getShapeProp(this,ir,rr,this),sr=new SVGShapeData(er,tr,nr);return this.shapes.push(sr),this.addShapeToModifiers(sr),this.addToAnimatedContents(ir,sr),sr},SVGShapeElement.prototype.addToAnimatedContents=function(ir,er){for(var tr=0,rr=this.animatedContents.length;tr<rr;){if(this.animatedContents[tr].element===er)return;tr+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(ir),element:er,data:ir})},SVGShapeElement.prototype.setElementStyles=function(ir){var er=ir.styles,tr,rr=this.stylesList.length;for(tr=0;tr<rr;tr+=1)this.stylesList[tr].closed||er.push(this.stylesList[tr])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var ir,er=this.itemsData.length;for(ir=0;ir<er;ir+=1)this.prevViewData[ir]=this.itemsData[ir];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),er=this.dynamicProperties.length,ir=0;ir<er;ir+=1)this.dynamicProperties[ir].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(ir,er,tr,rr,nr,sr,ar){var or=[].concat(sr),lr,cr=ir.length-1,hr,fr,ur=[],pr=[],gr,_r,mr;for(lr=cr;lr>=0;lr-=1){if(mr=this.searchProcessedElement(ir[lr]),mr?er[lr]=tr[mr-1]:ir[lr]._render=ar,ir[lr].ty==="fl"||ir[lr].ty==="st"||ir[lr].ty==="gf"||ir[lr].ty==="gs"||ir[lr].ty==="no")mr?er[lr].style.closed=!1:er[lr]=this.createStyleElement(ir[lr],nr),ir[lr]._render&&er[lr].style.pElem.parentNode!==rr&&rr.appendChild(er[lr].style.pElem),ur.push(er[lr].style);else if(ir[lr].ty==="gr"){if(!mr)er[lr]=this.createGroupElement(ir[lr]);else for(fr=er[lr].it.length,hr=0;hr<fr;hr+=1)er[lr].prevViewData[hr]=er[lr].it[hr];this.searchShapes(ir[lr].it,er[lr].it,er[lr].prevViewData,er[lr].gr,nr+1,or,ar),ir[lr]._render&&er[lr].gr.parentNode!==rr&&rr.appendChild(er[lr].gr)}else ir[lr].ty==="tr"?(mr||(er[lr]=this.createTransformElement(ir[lr],rr)),gr=er[lr].transform,or.push(gr)):ir[lr].ty==="sh"||ir[lr].ty==="rc"||ir[lr].ty==="el"||ir[lr].ty==="sr"?(mr||(er[lr]=this.createShapeElement(ir[lr],or,nr)),this.setElementStyles(er[lr])):ir[lr].ty==="tm"||ir[lr].ty==="rd"||ir[lr].ty==="ms"||ir[lr].ty==="pb"?(mr?(_r=er[lr],_r.closed=!1):(_r=ShapeModifiers.getModifier(ir[lr].ty),_r.init(this,ir[lr]),er[lr]=_r,this.shapeModifiers.push(_r)),pr.push(_r)):ir[lr].ty==="rp"&&(mr?(_r=er[lr],_r.closed=!0):(_r=ShapeModifiers.getModifier(ir[lr].ty),er[lr]=_r,_r.init(this,ir,lr,er),this.shapeModifiers.push(_r),ar=!1),pr.push(_r));this.addProcessedElement(ir[lr],lr+1)}for(cr=ur.length,lr=0;lr<cr;lr+=1)ur[lr].closed=!0;for(cr=pr.length,lr=0;lr<cr;lr+=1)pr[lr].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var ir,er=this.stylesList.length;for(ir=0;ir<er;ir+=1)this.stylesList[ir].reset();for(this.renderShape(),ir=0;ir<er;ir+=1)(this.stylesList[ir]._mdf||this._isFirstFrame)&&(this.stylesList[ir].msElem&&(this.stylesList[ir].msElem.setAttribute("d",this.stylesList[ir].d),this.stylesList[ir].d="M0 0"+this.stylesList[ir].d),this.stylesList[ir].pElem.setAttribute("d",this.stylesList[ir].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var ir,er=this.animatedContents.length,tr;for(ir=0;ir<er;ir+=1)tr=this.animatedContents[ir],(this._isFirstFrame||tr.element._isAnimated)&&tr.data!==!0&&tr.fn(tr.data,tr.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},LetterProps.prototype.update=function(ir,er,tr,rr,nr,sr){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var ar=!1;return this.o!==ir&&(this.o=ir,this._mdf.o=!0,ar=!0),this.sw!==er&&(this.sw=er,this._mdf.sw=!0,ar=!0),this.sc!==tr&&(this.sc=tr,this._mdf.sc=!0,ar=!0),this.fc!==rr&&(this.fc=rr,this._mdf.fc=!0,ar=!0),this.m!==nr&&(this.m=nr,this._mdf.m=!0,ar=!0),sr.length&&(this.p[0]!==sr[0]||this.p[1]!==sr[1]||this.p[4]!==sr[4]||this.p[5]!==sr[5]||this.p[12]!==sr[12]||this.p[13]!==sr[13])&&(this.p=sr,this._mdf.p=!0,ar=!0),ar},TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(ir,er){for(var tr in er)Object.prototype.hasOwnProperty.call(er,tr)&&(ir[tr]=er[tr]);return ir},TextProperty.prototype.setCurrentData=function(ir){ir.__complete||this.completeTextData(ir),this.currentData=ir,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(ir){this.effectsSequence.push(ir),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(ir){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!ir)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var er=this.currentData,tr=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var rr,nr=this.effectsSequence.length,sr=ir||this.data.d.k[this.keysIndex].s;for(rr=0;rr<nr;rr+=1)tr!==this.keysIndex?sr=this.effectsSequence[rr](sr,sr.t):sr=this.effectsSequence[rr](this.currentData,sr.t);er!==sr&&this.setCurrentData(sr),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var ir=this.data.d.k,er=this.elem.comp.renderedFrame,tr=0,rr=ir.length;tr<=rr-1&&!(tr===rr-1||ir[tr+1].t>er);)tr+=1;return this.keysIndex!==tr&&(this.keysIndex=tr),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(ir){for(var er=[],tr=0,rr=ir.length,nr,sr,ar=!1;tr<rr;)nr=ir.charCodeAt(tr),FontManager.isCombinedCharacter(nr)?er[er.length-1]+=ir.charAt(tr):nr>=55296&&nr<=56319?(sr=ir.charCodeAt(tr+1),sr>=56320&&sr<=57343?(ar||FontManager.isModifier(nr,sr)?(er[er.length-1]+=ir.substr(tr,2),ar=!1):er.push(ir.substr(tr,2)),tr+=1):er.push(ir.charAt(tr))):nr>56319?(sr=ir.charCodeAt(tr+1),FontManager.isZeroWidthJoiner(nr,sr)?(ar=!0,er[er.length-1]+=ir.substr(tr,2),tr+=1):er.push(ir.charAt(tr))):FontManager.isZeroWidthJoiner(nr)?(er[er.length-1]+=ir.charAt(tr),ar=!0):er.push(ir.charAt(tr)),tr+=1;return er},TextProperty.prototype.completeTextData=function(ir){ir.__complete=!0;var er=this.elem.globalData.fontManager,tr=this.data,rr=[],nr,sr,ar,or=0,lr,cr=tr.m.g,hr=0,fr=0,ur=0,pr=[],gr=0,_r=0,mr,dr,vr=er.getFontByName(ir.f),Ar,yr=0,wr=getFontProperties(vr);ir.fWeight=wr.weight,ir.fStyle=wr.style,ir.finalSize=ir.s,ir.finalText=this.buildFinalText(ir.t),sr=ir.finalText.length,ir.finalLineHeight=ir.lh;var br=ir.tr/1e3*ir.finalSize,Sr;if(ir.sz)for(var xr=!0,Cr=ir.sz[0],Ir=ir.sz[1],Rr,Pr;xr;){Pr=this.buildFinalText(ir.t),Rr=0,gr=0,sr=Pr.length,br=ir.tr/1e3*ir.finalSize;var Fr=-1;for(nr=0;nr<sr;nr+=1)Sr=Pr[nr].charCodeAt(0),ar=!1,Pr[nr]===" "?Fr=nr:(Sr===13||Sr===3)&&(gr=0,ar=!0,Rr+=ir.finalLineHeight||ir.finalSize*1.2),er.chars?(Ar=er.getCharData(Pr[nr],vr.fStyle,vr.fFamily),yr=ar?0:Ar.w*ir.finalSize/100):yr=er.measureText(Pr[nr],ir.f,ir.finalSize),gr+yr>Cr&&Pr[nr]!==" "?(Fr===-1?sr+=1:nr=Fr,Rr+=ir.finalLineHeight||ir.finalSize*1.2,Pr.splice(nr,Fr===nr?1:0,"\r"),Fr=-1,gr=0):(gr+=yr,gr+=br);Rr+=vr.ascent*ir.finalSize/100,this.canResize&&ir.finalSize>this.minimumFontSize&&Ir<Rr?(ir.finalSize-=1,ir.finalLineHeight=ir.finalSize*ir.lh/ir.s):(ir.finalText=Pr,sr=ir.finalText.length,xr=!1)}gr=-br,yr=0;var Nr=0,Ur;for(nr=0;nr<sr;nr+=1)if(ar=!1,Ur=ir.finalText[nr],Sr=Ur.charCodeAt(0),Sr===13||Sr===3?(Nr=0,pr.push(gr),_r=gr>_r?gr:_r,gr=-2*br,lr="",ar=!0,ur+=1):lr=Ur,er.chars?(Ar=er.getCharData(Ur,vr.fStyle,er.getFontByName(ir.f).fFamily),yr=ar?0:Ar.w*ir.finalSize/100):yr=er.measureText(lr,ir.f,ir.finalSize),Ur===" "?Nr+=yr+br:(gr+=yr+br+Nr,Nr=0),rr.push({l:yr,an:yr,add:hr,n:ar,anIndexes:[],val:lr,line:ur,animatorJustifyOffset:0}),cr==2){if(hr+=yr,lr===""||lr===" "||nr===sr-1){for((lr===""||lr===" ")&&(hr-=yr);fr<=nr;)rr[fr].an=hr,rr[fr].ind=or,rr[fr].extra=yr,fr+=1;or+=1,hr=0}}else if(cr==3){if(hr+=yr,lr===""||nr===sr-1){for(lr===""&&(hr-=yr);fr<=nr;)rr[fr].an=hr,rr[fr].ind=or,rr[fr].extra=yr,fr+=1;hr=0,or+=1}}else rr[or].ind=or,rr[or].extra=0,or+=1;if(ir.l=rr,_r=gr>_r?gr:_r,pr.push(gr),ir.sz)ir.boxWidth=ir.sz[0],ir.justifyOffset=0;else switch(ir.boxWidth=_r,ir.j){case 1:ir.justifyOffset=-ir.boxWidth;break;case 2:ir.justifyOffset=-ir.boxWidth/2;break;default:ir.justifyOffset=0}ir.lineWidths=pr;var Br=tr.a,Or,Dr;dr=Br.length;var Wr,$r,Yr=[];for(mr=0;mr<dr;mr+=1){for(Or=Br[mr],Or.a.sc&&(ir.strokeColorAnim=!0),Or.a.sw&&(ir.strokeWidthAnim=!0),(Or.a.fc||Or.a.fh||Or.a.fs||Or.a.fb)&&(ir.fillColorAnim=!0),$r=0,Wr=Or.s.b,nr=0;nr<sr;nr+=1)Dr=rr[nr],Dr.anIndexes[mr]=$r,(Wr==1&&Dr.val!==""||Wr==2&&Dr.val!==""&&Dr.val!==" "||Wr==3&&(Dr.n||Dr.val==" "||nr==sr-1)||Wr==4&&(Dr.n||nr==sr-1))&&(Or.s.rn===1&&Yr.push($r),$r+=1);tr.a[mr].s.totalChars=$r;var Qi=-1,rs;if(Or.s.rn===1)for(nr=0;nr<sr;nr+=1)Dr=rr[nr],Qi!=Dr.anIndexes[mr]&&(Qi=Dr.anIndexes[mr],rs=Yr.splice(Math.floor(Math.random()*Yr.length),1)[0]),Dr.anIndexes[mr]=rs}ir.yOffset=ir.finalLineHeight||ir.finalSize*1.2,ir.ls=ir.ls||0,ir.ascent=vr.ascent*ir.finalSize/100},TextProperty.prototype.updateDocumentData=function(ir,er){er=er===void 0?this.keysIndex:er;var tr=this.copyData({},this.data.d.k[er].s);tr=this.copyData(tr,ir),this.data.d.k[er].s=tr,this.recalculate(er),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(ir){var er=this.data.d.k[ir].s;er.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(er)},TextProperty.prototype.canResizeFont=function(ir){this.canResize=ir,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(ir){this.minimumFontSize=Math.floor(ir)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};const TextSelectorProp=function(){var ir=Math.max,er=Math.min,tr=Math.floor;function rr(sr,ar){this._currentTextLength=-1,this.k=!1,this.data=ar,this.elem=sr,this.comp=sr.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(sr),this.s=PropertyFactory.getProp(sr,ar.s||{k:0},0,0,this),"e"in ar?this.e=PropertyFactory.getProp(sr,ar.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(sr,ar.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(sr,ar.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(sr,ar.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(sr,ar.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(sr,ar.a,0,.01,this),this.dynamicProperties.length||this.getValue()}rr.prototype={getMult:function(sr){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var ar=0,or=0,lr=1,cr=1;this.ne.v>0?ar=this.ne.v/100:or=-this.ne.v/100,this.xe.v>0?lr=1-this.xe.v/100:cr=1+this.xe.v/100;var hr=BezierFactory.getBezierEasing(ar,or,lr,cr).get,fr=0,ur=this.finalS,pr=this.finalE,gr=this.data.sh;if(gr===2)pr===ur?fr=sr>=pr?1:0:fr=ir(0,er(.5/(pr-ur)+(sr-ur)/(pr-ur),1)),fr=hr(fr);else if(gr===3)pr===ur?fr=sr>=pr?0:1:fr=1-ir(0,er(.5/(pr-ur)+(sr-ur)/(pr-ur),1)),fr=hr(fr);else if(gr===4)pr===ur?fr=0:(fr=ir(0,er(.5/(pr-ur)+(sr-ur)/(pr-ur),1)),fr<.5?fr*=2:fr=1-2*(fr-.5)),fr=hr(fr);else if(gr===5){if(pr===ur)fr=0;else{var _r=pr-ur;sr=er(ir(0,sr+.5-ur),pr-ur);var mr=-_r/2+sr,dr=_r/2;fr=Math.sqrt(1-mr*mr/(dr*dr))}fr=hr(fr)}else gr===6?(pr===ur?fr=0:(sr=er(ir(0,sr+.5-ur),pr-ur),fr=(1+Math.cos(Math.PI+Math.PI*2*sr/(pr-ur)))/2),fr=hr(fr)):(sr>=tr(ur)&&(sr-ur<0?fr=ir(0,er(er(pr,1)-(ur-sr),1)):fr=ir(0,er(pr-sr,1))),fr=hr(fr));if(this.sm.v!==100){var vr=this.sm.v*.01;vr===0&&(vr=1e-8);var Ar=.5-vr*.5;fr<Ar?fr=0:(fr=(fr-Ar)/vr,fr>1&&(fr=1))}return fr*this.a.v},getValue:function(sr){this.iterateDynamicProperties(),this._mdf=sr||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,sr&&this.data.r===2&&(this.e.v=this._currentTextLength);var ar=this.data.r===2?1:100/this.data.totalChars,or=this.o.v/ar,lr=this.s.v/ar+or,cr=this.e.v/ar+or;if(lr>cr){var hr=lr;lr=cr,cr=hr}this.finalS=lr,this.finalE=cr}},extendPrototype([DynamicPropertyContainer],rr);function nr(sr,ar,or){return new rr(sr,ar,or)}return{getTextSelectorProp:nr}}();TextAnimatorProperty.prototype.searchProperties=function(){var ir,er=this._textData.a.length,tr,rr=PropertyFactory.getProp;for(ir=0;ir<er;ir+=1)tr=this._textData.a[ir],this._animatorsData[ir]=new TextAnimatorDataProperty(this._elem,tr,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:rr(this._elem,this._textData.p.a,0,0,this),f:rr(this._elem,this._textData.p.f,0,0,this),l:rr(this._elem,this._textData.p.l,0,0,this),r:rr(this._elem,this._textData.p.r,0,0,this),p:rr(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=rr(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(ir,er){if(this.lettersChangedFlag=er,!(!this._mdf&&!this._isFirstFrame&&!er&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var tr=this._moreOptions.alignment.v,rr=this._animatorsData,nr=this._textData,sr=this.mHelper,ar=this._renderType,or=this.renderedLetters.length,lr,cr,hr,fr,ur=ir.l,pr,gr,_r,mr,dr,vr,Ar,yr,wr,br,Sr,xr,Cr,Ir,Rr;if(this._hasMaskedPath){if(Rr=this._pathData.m,!this._pathData.n||this._pathData._mdf){var Pr=Rr.v;this._pathData.r.v&&(Pr=Pr.reverse()),pr={tLength:0,segments:[]},fr=Pr._length-1;var Fr;for(xr=0,hr=0;hr<fr;hr+=1)Fr=bez.buildBezierData(Pr.v[hr],Pr.v[hr+1],[Pr.o[hr][0]-Pr.v[hr][0],Pr.o[hr][1]-Pr.v[hr][1]],[Pr.i[hr+1][0]-Pr.v[hr+1][0],Pr.i[hr+1][1]-Pr.v[hr+1][1]]),pr.tLength+=Fr.segmentLength,pr.segments.push(Fr),xr+=Fr.segmentLength;hr=fr,Rr.v.c&&(Fr=bez.buildBezierData(Pr.v[hr],Pr.v[0],[Pr.o[hr][0]-Pr.v[hr][0],Pr.o[hr][1]-Pr.v[hr][1]],[Pr.i[0][0]-Pr.v[0][0],Pr.i[0][1]-Pr.v[0][1]]),pr.tLength+=Fr.segmentLength,pr.segments.push(Fr),xr+=Fr.segmentLength),this._pathData.pi=pr}if(pr=this._pathData.pi,gr=this._pathData.f.v,Ar=0,vr=1,mr=0,dr=!0,br=pr.segments,gr<0&&Rr.v.c)for(pr.tLength<Math.abs(gr)&&(gr=-Math.abs(gr)%pr.tLength),Ar=br.length-1,wr=br[Ar].points,vr=wr.length-1;gr<0;)gr+=wr[vr].partialLength,vr-=1,vr<0&&(Ar-=1,wr=br[Ar].points,vr=wr.length-1);wr=br[Ar].points,yr=wr[vr-1],_r=wr[vr],Sr=_r.partialLength}fr=ur.length,lr=0,cr=0;var Nr=ir.finalSize*1.2*.714,Ur=!0,Br,Or,Dr,Wr,$r;Wr=rr.length;var Yr,Qi=-1,rs,Kr,Qr,Vr=gr,Gr=Ar,qr=vr,ji=-1,Zr,Zi,Yi,qi,Xr,ns,os,us,is="",Ji=this.defaultPropsArray,ms;if(ir.j===2||ir.j===1){var Ki=0,Ni=0,Ri=ir.j===2?-.5:-1,Jr=0,Xi=!0;for(hr=0;hr<fr;hr+=1)if(ur[hr].n){for(Ki&&(Ki+=Ni);Jr<hr;)ur[Jr].animatorJustifyOffset=Ki,Jr+=1;Ki=0,Xi=!0}else{for(Dr=0;Dr<Wr;Dr+=1)Br=rr[Dr].a,Br.t.propType&&(Xi&&ir.j===2&&(Ni+=Br.t.v*Ri),Or=rr[Dr].s,Yr=Or.getMult(ur[hr].anIndexes[Dr],nr.a[Dr].s.totalChars),Yr.length?Ki+=Br.t.v*Yr[0]*Ri:Ki+=Br.t.v*Yr*Ri);Xi=!1}for(Ki&&(Ki+=Ni);Jr<hr;)ur[Jr].animatorJustifyOffset=Ki,Jr+=1}for(hr=0;hr<fr;hr+=1){if(sr.reset(),Zr=1,ur[hr].n)lr=0,cr+=ir.yOffset,cr+=Ur?1:0,gr=Vr,Ur=!1,this._hasMaskedPath&&(Ar=Gr,vr=qr,wr=br[Ar].points,yr=wr[vr-1],_r=wr[vr],Sr=_r.partialLength,mr=0),is="",us="",ns="",ms="",Ji=this.defaultPropsArray;else{if(this._hasMaskedPath){if(ji!==ur[hr].line){switch(ir.j){case 1:gr+=xr-ir.lineWidths[ur[hr].line];break;case 2:gr+=(xr-ir.lineWidths[ur[hr].line])/2;break;default:break}ji=ur[hr].line}Qi!==ur[hr].ind&&(ur[Qi]&&(gr+=ur[Qi].extra),gr+=ur[hr].an/2,Qi=ur[hr].ind),gr+=tr[0]*ur[hr].an*.005;var ss=0;for(Dr=0;Dr<Wr;Dr+=1)Br=rr[Dr].a,Br.p.propType&&(Or=rr[Dr].s,Yr=Or.getMult(ur[hr].anIndexes[Dr],nr.a[Dr].s.totalChars),Yr.length?ss+=Br.p.v[0]*Yr[0]:ss+=Br.p.v[0]*Yr),Br.a.propType&&(Or=rr[Dr].s,Yr=Or.getMult(ur[hr].anIndexes[Dr],nr.a[Dr].s.totalChars),Yr.length?ss+=Br.a.v[0]*Yr[0]:ss+=Br.a.v[0]*Yr);for(dr=!0,this._pathData.a.v&&(gr=ur[0].an*.5+(xr-this._pathData.f.v-ur[0].an*.5-ur[ur.length-1].an*.5)*Qi/(fr-1),gr+=this._pathData.f.v);dr;)mr+Sr>=gr+ss||!wr?(Cr=(gr+ss-mr)/_r.partialLength,Kr=yr.point[0]+(_r.point[0]-yr.point[0])*Cr,Qr=yr.point[1]+(_r.point[1]-yr.point[1])*Cr,sr.translate(-tr[0]*ur[hr].an*.005,-(tr[1]*Nr)*.01),dr=!1):wr&&(mr+=_r.partialLength,vr+=1,vr>=wr.length&&(vr=0,Ar+=1,br[Ar]?wr=br[Ar].points:Rr.v.c?(vr=0,Ar=0,wr=br[Ar].points):(mr-=_r.partialLength,wr=null)),wr&&(yr=_r,_r=wr[vr],Sr=_r.partialLength));rs=ur[hr].an/2-ur[hr].add,sr.translate(-rs,0,0)}else rs=ur[hr].an/2-ur[hr].add,sr.translate(-rs,0,0),sr.translate(-tr[0]*ur[hr].an*.005,-tr[1]*Nr*.01,0);for(Dr=0;Dr<Wr;Dr+=1)Br=rr[Dr].a,Br.t.propType&&(Or=rr[Dr].s,Yr=Or.getMult(ur[hr].anIndexes[Dr],nr.a[Dr].s.totalChars),(lr!==0||ir.j!==0)&&(this._hasMaskedPath?Yr.length?gr+=Br.t.v*Yr[0]:gr+=Br.t.v*Yr:Yr.length?lr+=Br.t.v*Yr[0]:lr+=Br.t.v*Yr));for(ir.strokeWidthAnim&&(Yi=ir.sw||0),ir.strokeColorAnim&&(ir.sc?Zi=[ir.sc[0],ir.sc[1],ir.sc[2]]:Zi=[0,0,0]),ir.fillColorAnim&&ir.fc&&(qi=[ir.fc[0],ir.fc[1],ir.fc[2]]),Dr=0;Dr<Wr;Dr+=1)Br=rr[Dr].a,Br.a.propType&&(Or=rr[Dr].s,Yr=Or.getMult(ur[hr].anIndexes[Dr],nr.a[Dr].s.totalChars),Yr.length?sr.translate(-Br.a.v[0]*Yr[0],-Br.a.v[1]*Yr[1],Br.a.v[2]*Yr[2]):sr.translate(-Br.a.v[0]*Yr,-Br.a.v[1]*Yr,Br.a.v[2]*Yr));for(Dr=0;Dr<Wr;Dr+=1)Br=rr[Dr].a,Br.s.propType&&(Or=rr[Dr].s,Yr=Or.getMult(ur[hr].anIndexes[Dr],nr.a[Dr].s.totalChars),Yr.length?sr.scale(1+(Br.s.v[0]-1)*Yr[0],1+(Br.s.v[1]-1)*Yr[1],1):sr.scale(1+(Br.s.v[0]-1)*Yr,1+(Br.s.v[1]-1)*Yr,1));for(Dr=0;Dr<Wr;Dr+=1){if(Br=rr[Dr].a,Or=rr[Dr].s,Yr=Or.getMult(ur[hr].anIndexes[Dr],nr.a[Dr].s.totalChars),Br.sk.propType&&(Yr.length?sr.skewFromAxis(-Br.sk.v*Yr[0],Br.sa.v*Yr[1]):sr.skewFromAxis(-Br.sk.v*Yr,Br.sa.v*Yr)),Br.r.propType&&(Yr.length?sr.rotateZ(-Br.r.v*Yr[2]):sr.rotateZ(-Br.r.v*Yr)),Br.ry.propType&&(Yr.length?sr.rotateY(Br.ry.v*Yr[1]):sr.rotateY(Br.ry.v*Yr)),Br.rx.propType&&(Yr.length?sr.rotateX(Br.rx.v*Yr[0]):sr.rotateX(Br.rx.v*Yr)),Br.o.propType&&(Yr.length?Zr+=(Br.o.v*Yr[0]-Zr)*Yr[0]:Zr+=(Br.o.v*Yr-Zr)*Yr),ir.strokeWidthAnim&&Br.sw.propType&&(Yr.length?Yi+=Br.sw.v*Yr[0]:Yi+=Br.sw.v*Yr),ir.strokeColorAnim&&Br.sc.propType)for(Xr=0;Xr<3;Xr+=1)Yr.length?Zi[Xr]+=(Br.sc.v[Xr]-Zi[Xr])*Yr[0]:Zi[Xr]+=(Br.sc.v[Xr]-Zi[Xr])*Yr;if(ir.fillColorAnim&&ir.fc){if(Br.fc.propType)for(Xr=0;Xr<3;Xr+=1)Yr.length?qi[Xr]+=(Br.fc.v[Xr]-qi[Xr])*Yr[0]:qi[Xr]+=(Br.fc.v[Xr]-qi[Xr])*Yr;Br.fh.propType&&(Yr.length?qi=addHueToRGB(qi,Br.fh.v*Yr[0]):qi=addHueToRGB(qi,Br.fh.v*Yr)),Br.fs.propType&&(Yr.length?qi=addSaturationToRGB(qi,Br.fs.v*Yr[0]):qi=addSaturationToRGB(qi,Br.fs.v*Yr)),Br.fb.propType&&(Yr.length?qi=addBrightnessToRGB(qi,Br.fb.v*Yr[0]):qi=addBrightnessToRGB(qi,Br.fb.v*Yr))}}for(Dr=0;Dr<Wr;Dr+=1)Br=rr[Dr].a,Br.p.propType&&(Or=rr[Dr].s,Yr=Or.getMult(ur[hr].anIndexes[Dr],nr.a[Dr].s.totalChars),this._hasMaskedPath?Yr.length?sr.translate(0,Br.p.v[1]*Yr[0],-Br.p.v[2]*Yr[1]):sr.translate(0,Br.p.v[1]*Yr,-Br.p.v[2]*Yr):Yr.length?sr.translate(Br.p.v[0]*Yr[0],Br.p.v[1]*Yr[1],-Br.p.v[2]*Yr[2]):sr.translate(Br.p.v[0]*Yr,Br.p.v[1]*Yr,-Br.p.v[2]*Yr));if(ir.strokeWidthAnim&&(ns=Yi<0?0:Yi),ir.strokeColorAnim&&(os="rgb("+Math.round(Zi[0]*255)+","+Math.round(Zi[1]*255)+","+Math.round(Zi[2]*255)+")"),ir.fillColorAnim&&ir.fc&&(us="rgb("+Math.round(qi[0]*255)+","+Math.round(qi[1]*255)+","+Math.round(qi[2]*255)+")"),this._hasMaskedPath){if(sr.translate(0,-ir.ls),sr.translate(0,tr[1]*Nr*.01+cr,0),this._pathData.p.v){Ir=(_r.point[1]-yr.point[1])/(_r.point[0]-yr.point[0]);var ls=Math.atan(Ir)*180/Math.PI;_r.point[0]<yr.point[0]&&(ls+=180),sr.rotate(-ls*Math.PI/180)}sr.translate(Kr,Qr,0),gr-=tr[0]*ur[hr].an*.005,ur[hr+1]&&Qi!==ur[hr+1].ind&&(gr+=ur[hr].an/2,gr+=ir.tr*.001*ir.finalSize)}else{switch(sr.translate(lr,cr,0),ir.ps&&sr.translate(ir.ps[0],ir.ps[1]+ir.ascent,0),ir.j){case 1:sr.translate(ur[hr].animatorJustifyOffset+ir.justifyOffset+(ir.boxWidth-ir.lineWidths[ur[hr].line]),0,0);break;case 2:sr.translate(ur[hr].animatorJustifyOffset+ir.justifyOffset+(ir.boxWidth-ir.lineWidths[ur[hr].line])/2,0,0);break;default:break}sr.translate(0,-ir.ls),sr.translate(rs,0,0),sr.translate(tr[0]*ur[hr].an*.005,tr[1]*Nr*.01,0),lr+=ur[hr].l+ir.tr*.001*ir.finalSize}ar==="html"?is=sr.toCSS():ar==="svg"?is=sr.to2dCSS():Ji=[sr.props[0],sr.props[1],sr.props[2],sr.props[3],sr.props[4],sr.props[5],sr.props[6],sr.props[7],sr.props[8],sr.props[9],sr.props[10],sr.props[11],sr.props[12],sr.props[13],sr.props[14],sr.props[15]],ms=Zr}or<=hr?($r=new LetterProps(ms,ns,os,us,is,Ji),this.renderedLetters.push($r),or+=1,this.lettersChangedFlag=!0):($r=this.renderedLetters[hr],this.lettersChangedFlag=$r.update(ms,ns,os,us,is,Ji)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty),ITextElement.prototype.initElement=function(ir,er,tr){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(ir,er,tr),this.textProperty=new TextProperty(this,ir.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(ir.t,this.renderType,this),this.initTransform(ir,er,tr),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(ir){this._mdf=!1,this.prepareRenderableFrame(ir),this.prepareProperties(ir,this.isInRange),(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)},ITextElement.prototype.createPathShape=function(ir,er){var tr,rr=er.length,nr,sr="";for(tr=0;tr<rr;tr+=1)er[tr].ty==="sh"&&(nr=er[tr].ks.k,sr+=buildShapeString(nr,nr.i.length,!0,ir));return sr},ITextElement.prototype.updateDocumentData=function(ir,er){this.textProperty.updateDocumentData(ir,er)},ITextElement.prototype.canResizeFont=function(ir){this.textProperty.canResizeFont(ir)},ITextElement.prototype.setMinimumFontSize=function(ir){this.textProperty.setMinimumFontSize(ir)},ITextElement.prototype.applyTextPropertiesToMatrix=function(ir,er,tr,rr,nr){switch(ir.ps&&er.translate(ir.ps[0],ir.ps[1]+ir.ascent,0),er.translate(0,-ir.ls,0),ir.j){case 1:er.translate(ir.justifyOffset+(ir.boxWidth-ir.lineWidths[tr]),0,0);break;case 2:er.translate(ir.justifyOffset+(ir.boxWidth-ir.lineWidths[tr])/2,0,0);break;default:break}er.translate(rr,nr,0)},ITextElement.prototype.buildColor=function(ir){return"rgb("+Math.round(ir[0]*255)+","+Math.round(ir[1]*255)+","+Math.round(ir[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){};var emptyShapeData={shapes:[]};extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(ir){for(var er=0,tr=ir.length,rr=[],nr="";er<tr;)ir[er]==="\r"||ir[er]===""?(rr.push(nr),nr=""):nr+=ir[er],er+=1;return rr.push(nr),rr},SVGTextLottieElement.prototype.buildShapeData=function(ir,er){if(ir.shapes&&ir.shapes.length){var tr=ir.shapes[0];if(tr.it){var rr=tr.it[tr.it.length-1];rr.s&&(rr.s.k[0]=er,rr.s.k[1]=er)}}return ir},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var ir,er,tr=this.textProperty.currentData;this.renderedLetters=createSizedArray(tr?tr.l.length:0),tr.fc?this.layerElement.setAttribute("fill",this.buildColor(tr.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),tr.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(tr.sc)),this.layerElement.setAttribute("stroke-width",tr.sw)),this.layerElement.setAttribute("font-size",tr.finalSize);var rr=this.globalData.fontManager.getFontByName(tr.f);if(rr.fClass)this.layerElement.setAttribute("class",rr.fClass);else{this.layerElement.setAttribute("font-family",rr.fFamily);var nr=tr.fWeight,sr=tr.fStyle;this.layerElement.setAttribute("font-style",sr),this.layerElement.setAttribute("font-weight",nr)}this.layerElement.setAttribute("aria-label",tr.t);var ar=tr.l||[],or=!!this.globalData.fontManager.chars;er=ar.length;var lr,cr=this.mHelper,hr="",fr=this.data.singleShape,ur=0,pr=0,gr=!0,_r=tr.tr*.001*tr.finalSize;if(fr&&!or&&!tr.sz){var mr=this.textContainer,dr="start";switch(tr.j){case 1:dr="end";break;case 2:dr="middle";break;default:dr="start";break}mr.setAttribute("text-anchor",dr),mr.setAttribute("letter-spacing",_r);var vr=this.buildTextContents(tr.finalText);for(er=vr.length,pr=tr.ps?tr.ps[1]+tr.ascent:0,ir=0;ir<er;ir+=1)lr=this.textSpans[ir].span||createNS("tspan"),lr.textContent=vr[ir],lr.setAttribute("x",0),lr.setAttribute("y",pr),lr.style.display="inherit",mr.appendChild(lr),this.textSpans[ir]||(this.textSpans[ir]={span:null,glyph:null}),this.textSpans[ir].span=lr,pr+=tr.finalLineHeight;this.layerElement.appendChild(mr)}else{var Ar=this.textSpans.length,yr;for(ir=0;ir<er;ir+=1){if(this.textSpans[ir]||(this.textSpans[ir]={span:null,childSpan:null,glyph:null}),!or||!fr||ir===0){if(lr=Ar>ir?this.textSpans[ir].span:createNS(or?"g":"text"),Ar<=ir){if(lr.setAttribute("stroke-linecap","butt"),lr.setAttribute("stroke-linejoin","round"),lr.setAttribute("stroke-miterlimit","4"),this.textSpans[ir].span=lr,or){var wr=createNS("g");lr.appendChild(wr),this.textSpans[ir].childSpan=wr}this.textSpans[ir].span=lr,this.layerElement.appendChild(lr)}lr.style.display="inherit"}if(cr.reset(),fr&&(ar[ir].n&&(ur=-_r,pr+=tr.yOffset,pr+=gr?1:0,gr=!1),this.applyTextPropertiesToMatrix(tr,cr,ar[ir].line,ur,pr),ur+=ar[ir].l||0,ur+=_r),or){yr=this.globalData.fontManager.getCharData(tr.finalText[ir],rr.fStyle,this.globalData.fontManager.getFontByName(tr.f).fFamily);var br;if(yr.t===1)br=new SVGCompElement(yr.data,this.globalData,this);else{var Sr=emptyShapeData;yr.data&&yr.data.shapes&&(Sr=this.buildShapeData(yr.data,tr.finalSize)),br=new SVGShapeElement(Sr,this.globalData,this)}if(this.textSpans[ir].glyph){var xr=this.textSpans[ir].glyph;this.textSpans[ir].childSpan.removeChild(xr.layerElement),xr.destroy()}this.textSpans[ir].glyph=br,br._debug=!0,br.prepareFrame(0),br.renderFrame(),this.textSpans[ir].childSpan.appendChild(br.layerElement),yr.t===1&&this.textSpans[ir].childSpan.setAttribute("transform","scale("+tr.finalSize/100+","+tr.finalSize/100+")")}else fr&&lr.setAttribute("transform","translate("+cr.props[12]+","+cr.props[13]+")"),lr.textContent=ar[ir].val,lr.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}fr&&lr&&lr.setAttribute("d",hr)}for(;ir<this.textSpans.length;)this.textSpans[ir].span.style.display="none",ir+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var ir=this.layerElement.getBBox();this.bbox={top:ir.y,left:ir.x,width:ir.width,height:ir.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var ir,er=this.textSpans.length,tr;for(this.renderedFrame=this.comp.renderedFrame,ir=0;ir<er;ir+=1)tr=this.textSpans[ir].glyph,tr&&(tr.prepareFrame(this.comp.renderedFrame-this.data.st),tr._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if((!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var ir,er,tr=this.textAnimator.renderedLetters,rr=this.textProperty.currentData.l;er=rr.length;var nr,sr,ar;for(ir=0;ir<er;ir+=1)rr[ir].n||(nr=tr[ir],sr=this.textSpans[ir].span,ar=this.textSpans[ir].glyph,ar&&ar.renderFrame(),nr._mdf.m&&sr.setAttribute("transform",nr.m),nr._mdf.o&&sr.setAttribute("opacity",nr.o),nr._mdf.sw&&sr.setAttribute("stroke-width",nr.sw),nr._mdf.sc&&sr.setAttribute("stroke",nr.sc),nr._mdf.fc&&sr.setAttribute("fill",nr.fc))}},extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var ir=createNS("rect");ir.setAttribute("width",this.data.sw),ir.setAttribute("height",this.data.sh),ir.setAttribute("fill",this.data.sc),this.layerElement.appendChild(ir)},NullElement.prototype.prepareFrame=function(ir){this.prepareProperties(ir,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement),extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(ir){return new NullElement(ir,this.globalData,this)},SVGRendererBase.prototype.createShape=function(ir){return new SVGShapeElement(ir,this.globalData,this)},SVGRendererBase.prototype.createText=function(ir){return new SVGTextLottieElement(ir,this.globalData,this)},SVGRendererBase.prototype.createImage=function(ir){return new IImageElement(ir,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(ir){return new ISolidElement(ir,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(ir){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+ir.w+" "+ir.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",ir.w),this.svgElement.setAttribute("height",ir.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var er=this.globalData.defs;this.setupGlobalData(ir,er),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=ir;var tr=createNS("clipPath"),rr=createNS("rect");rr.setAttribute("width",ir.w),rr.setAttribute("height",ir.h),rr.setAttribute("x",0),rr.setAttribute("y",0);var nr=createElementID();tr.setAttribute("id",nr),tr.appendChild(rr),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+nr+")"),er.appendChild(tr),this.layers=ir.layers,this.elements=createSizedArray(ir.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var ir,er=this.layers?this.layers.length:0;for(ir=0;ir<er;ir+=1)this.elements[ir]&&this.elements[ir].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.buildItem=function(ir){var er=this.elements;if(!(er[ir]||this.layers[ir].ty===99)){er[ir]=!0;var tr=this.createItem(this.layers[ir]);er[ir]=tr,getExpressionsPlugin()&&(this.layers[ir].ty===0&&this.globalData.projectInterface.registerComposition(tr),tr.initExpressions()),this.appendElementInPos(tr,ir),this.layers[ir].tt&&(!this.elements[ir-1]||this.elements[ir-1]===!0?(this.buildItem(ir-1),this.addPendingElement(tr)):tr.setMatte(er[ir-1].layerId))}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var ir=this.pendingElements.pop();if(ir.checkParenting(),ir.data.tt)for(var er=0,tr=this.elements.length;er<tr;){if(this.elements[er]===ir){ir.setMatte(this.elements[er-1].layerId);break}er+=1}}},SVGRendererBase.prototype.renderFrame=function(ir){if(!(this.renderedFrame===ir||this.destroyed)){ir===null?ir=this.renderedFrame:this.renderedFrame=ir,this.globalData.frameNum=ir,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=ir,this.globalData._mdf=!1;var er,tr=this.layers.length;for(this.completeLayers||this.checkLayers(ir),er=tr-1;er>=0;er-=1)(this.completeLayers||this.elements[er])&&this.elements[er].prepareFrame(ir-this.layers[er].st);if(this.globalData._mdf)for(er=0;er<tr;er+=1)(this.completeLayers||this.elements[er])&&this.elements[er].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(ir,er){var tr=ir.getBaseElement();if(tr){for(var rr=0,nr;rr<er;)this.elements[rr]&&this.elements[rr]!==!0&&this.elements[rr].getBaseElement()&&(nr=this.elements[rr].getBaseElement()),rr+=1;nr?this.layerElement.insertBefore(tr,nr):this.layerElement.appendChild(tr)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(ir,er,tr){this.initFrame(),this.initBaseData(ir,er,tr),this.initTransform(ir,er,tr),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!er.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(ir){if(this._mdf=!1,this.prepareRenderableFrame(ir),this.prepareProperties(ir,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=ir/this.data.sr;else{var er=this.tm.v;er===this.data.op&&(er=this.data.op-1),this.renderedFrame=er}var tr,rr=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),tr=rr-1;tr>=0;tr-=1)(this.completeLayers||this.elements[tr])&&(this.elements[tr].prepareFrame(this.renderedFrame-this.layers[tr].st),this.elements[tr]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var ir,er=this.layers.length;for(ir=0;ir<er;ir+=1)(this.completeLayers||this.elements[ir])&&this.elements[ir].renderFrame()},ICompElement.prototype.setElements=function(ir){this.elements=ir},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var ir,er=this.layers.length;for(ir=0;ir<er;ir+=1)this.elements[ir]&&this.elements[ir].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(ir){return new SVGCompElement(ir,this.globalData,this)},extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(ir){return new SVGCompElement(ir,this.globalData,this)},CVContextData.prototype.duplicate=function(){var ir=this._length*2,er=this.savedOp;this.savedOp=createTypedArray("float32",ir),this.savedOp.set(er);var tr=0;for(tr=this._length;tr<ir;tr+=1)this.saved[tr]=createTypedArray("float32",16);this._length=ir},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.cO=1},ShapeTransformManager.prototype={addTransformSequence:function(ir){var er,tr=ir.length,rr="_";for(er=0;er<tr;er+=1)rr+=ir[er].transform.key+"_";var nr=this.sequences[rr];return nr||(nr={transforms:[].concat(ir),finalTransform:new Matrix,_mdf:!1},this.sequences[rr]=nr,this.sequenceList.push(nr)),nr},processSequence:function(ir,er){for(var tr=0,rr=ir.transforms.length,nr=er;tr<rr&&!er;){if(ir.transforms[tr].transform.mProps._mdf){nr=!0;break}tr+=1}if(nr){var sr;for(ir.finalTransform.reset(),tr=rr-1;tr>=0;tr-=1)sr=ir.transforms[tr].transform.mProps.v.props,ir.finalTransform.transform(sr[0],sr[1],sr[2],sr[3],sr[4],sr[5],sr[6],sr[7],sr[8],sr[9],sr[10],sr[11],sr[12],sr[13],sr[14],sr[15])}ir._mdf=nr},processSequences:function(ir){var er,tr=this.sequenceList.length;for(er=0;er<tr;er+=1)this.processSequence(this.sequenceList[er],ir)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}},CVEffects.prototype.renderFrame=function(){},CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var ir=this.element.finalTransform.mat,er=this.element.canvasContext,tr,rr=this.masksProperties.length,nr,sr,ar;for(er.beginPath(),tr=0;tr<rr;tr+=1)if(this.masksProperties[tr].mode!=="n"){this.masksProperties[tr].inv&&(er.moveTo(0,0),er.lineTo(this.element.globalData.compSize.w,0),er.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),er.lineTo(0,this.element.globalData.compSize.h),er.lineTo(0,0)),ar=this.viewData[tr].v,nr=ir.applyToPointArray(ar.v[0][0],ar.v[0][1],0),er.moveTo(nr[0],nr[1]);var or,lr=ar._length;for(or=1;or<lr;or+=1)sr=ir.applyToTriplePoints(ar.o[or-1],ar.i[or],ar.v[or]),er.bezierCurveTo(sr[0],sr[1],sr[2],sr[3],sr[4],sr[5]);sr=ir.applyToTriplePoints(ar.o[or-1],ar.i[0],ar.v[0]),er.bezierCurveTo(sr[0],sr[1],sr[2],sr[3],sr[4],sr[5])}this.element.globalData.renderer.save(!0),er.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null},CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){this.canvasContext=this.globalData.canvasContext,this.renderableEffectsManager=new CVEffects(this)},createContent:function(){},setBlendMode:function(){var ir=this.globalData;if(ir.blendMode!==this.data.bm){ir.blendMode=this.data.bm;var er=getBlendMode(this.data.bm);ir.canvasContext.globalCompositeOperation=er}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},renderFrame:function(){if(!(this.hidden||this.data.hd)){this.renderTransform(),this.renderRenderable(),this.setBlendMode();var ir=this.data.ty===0;this.globalData.renderer.save(ir),this.globalData.renderer.ctxTransform(this.finalTransform.mat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.mProp.o.v),this.renderInnerContent(),this.globalData.renderer.restore(ir),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement,CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated,extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(ir,er){var tr={data:ir,type:ir.ty,preTransforms:this.transformsManager.addTransformSequence(er),transforms:[],elements:[],closed:ir.hd===!0},rr={};if(ir.ty==="fl"||ir.ty==="st"?(rr.c=PropertyFactory.getProp(this,ir.c,1,255,this),rr.c.k||(tr.co="rgb("+bmFloor(rr.c.v[0])+","+bmFloor(rr.c.v[1])+","+bmFloor(rr.c.v[2])+")")):(ir.ty==="gf"||ir.ty==="gs")&&(rr.s=PropertyFactory.getProp(this,ir.s,1,null,this),rr.e=PropertyFactory.getProp(this,ir.e,1,null,this),rr.h=PropertyFactory.getProp(this,ir.h||{k:0},0,.01,this),rr.a=PropertyFactory.getProp(this,ir.a||{k:0},0,degToRads,this),rr.g=new GradientProperty(this,ir.g,this)),rr.o=PropertyFactory.getProp(this,ir.o,0,.01,this),ir.ty==="st"||ir.ty==="gs"){if(tr.lc=lineCapEnum[ir.lc||2],tr.lj=lineJoinEnum[ir.lj||2],ir.lj==1&&(tr.ml=ir.ml),rr.w=PropertyFactory.getProp(this,ir.w,0,null,this),rr.w.k||(tr.wi=rr.w.v),ir.d){var nr=new DashProperty(this,ir.d,"canvas",this);rr.d=nr,rr.d.k||(tr.da=rr.d.dashArray,tr.do=rr.d.dashoffset[0])}}else tr.r=ir.r===2?"evenodd":"nonzero";return this.stylesList.push(tr),rr.style=tr,rr},CVShapeElement.prototype.createGroupElement=function(){var ir={it:[],prevViewData:[]};return ir},CVShapeElement.prototype.createTransformElement=function(ir){var er={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,ir.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,ir,this)}};return er},CVShapeElement.prototype.createShapeElement=function(ir){var er=new CVShapeData(this,ir,this.stylesList,this.transformsManager);return this.shapes.push(er),this.addShapeToModifiers(er),er},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var ir,er=this.itemsData.length;for(ir=0;ir<er;ir+=1)this.prevViewData[ir]=this.itemsData[ir];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),er=this.dynamicProperties.length,ir=0;ir<er;ir+=1)this.dynamicProperties[ir].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(ir){var er,tr=this.stylesList.length;for(er=0;er<tr;er+=1)this.stylesList[er].closed||this.stylesList[er].transforms.push(ir)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var ir,er=this.stylesList.length;for(ir=0;ir<er;ir+=1)this.stylesList[ir].closed||this.stylesList[ir].transforms.pop()},CVShapeElement.prototype.closeStyles=function(ir){var er,tr=ir.length;for(er=0;er<tr;er+=1)ir[er].closed=!0},CVShapeElement.prototype.searchShapes=function(ir,er,tr,rr,nr){var sr,ar=ir.length-1,or,lr,cr=[],hr=[],fr,ur,pr,gr=[].concat(nr);for(sr=ar;sr>=0;sr-=1){if(fr=this.searchProcessedElement(ir[sr]),fr?er[sr]=tr[fr-1]:ir[sr]._shouldRender=rr,ir[sr].ty==="fl"||ir[sr].ty==="st"||ir[sr].ty==="gf"||ir[sr].ty==="gs")fr?er[sr].style.closed=!1:er[sr]=this.createStyleElement(ir[sr],gr),cr.push(er[sr].style);else if(ir[sr].ty==="gr"){if(!fr)er[sr]=this.createGroupElement(ir[sr]);else for(lr=er[sr].it.length,or=0;or<lr;or+=1)er[sr].prevViewData[or]=er[sr].it[or];this.searchShapes(ir[sr].it,er[sr].it,er[sr].prevViewData,rr,gr)}else ir[sr].ty==="tr"?(fr||(pr=this.createTransformElement(ir[sr]),er[sr]=pr),gr.push(er[sr]),this.addTransformToStyleList(er[sr])):ir[sr].ty==="sh"||ir[sr].ty==="rc"||ir[sr].ty==="el"||ir[sr].ty==="sr"?fr||(er[sr]=this.createShapeElement(ir[sr])):ir[sr].ty==="tm"||ir[sr].ty==="rd"||ir[sr].ty==="pb"?(fr?(ur=er[sr],ur.closed=!1):(ur=ShapeModifiers.getModifier(ir[sr].ty),ur.init(this,ir[sr]),er[sr]=ur,this.shapeModifiers.push(ur)),hr.push(ur)):ir[sr].ty==="rp"&&(fr?(ur=er[sr],ur.closed=!0):(ur=ShapeModifiers.getModifier(ir[sr].ty),er[sr]=ur,ur.init(this,ir,sr,er),this.shapeModifiers.push(ur),rr=!1),hr.push(ur));this.addProcessedElement(ir[sr],sr+1)}for(this.removeTransformFromStyleList(),this.closeStyles(cr),ar=hr.length,sr=0;sr<ar;sr+=1)hr[sr].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(ir,er){(ir._opMdf||er.op._mdf||this._isFirstFrame)&&(er.opacity=ir.opacity,er.opacity*=er.op.v,er._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var ir,er=this.stylesList.length,tr,rr,nr,sr,ar,or,lr=this.globalData.renderer,cr=this.globalData.canvasContext,hr,fr;for(ir=0;ir<er;ir+=1)if(fr=this.stylesList[ir],hr=fr.type,!((hr==="st"||hr==="gs")&&fr.wi===0||!fr.data._shouldRender||fr.coOp===0||this.globalData.currentGlobalAlpha===0)){for(lr.save(),ar=fr.elements,hr==="st"||hr==="gs"?(cr.strokeStyle=hr==="st"?fr.co:fr.grd,cr.lineWidth=fr.wi,cr.lineCap=fr.lc,cr.lineJoin=fr.lj,cr.miterLimit=fr.ml||0):cr.fillStyle=hr==="fl"?fr.co:fr.grd,lr.ctxOpacity(fr.coOp),hr!=="st"&&hr!=="gs"&&cr.beginPath(),lr.ctxTransform(fr.preTransforms.finalTransform.props),rr=ar.length,tr=0;tr<rr;tr+=1){for((hr==="st"||hr==="gs")&&(cr.beginPath(),fr.da&&(cr.setLineDash(fr.da),cr.lineDashOffset=fr.do)),or=ar[tr].trNodes,sr=or.length,nr=0;nr<sr;nr+=1)or[nr].t==="m"?cr.moveTo(or[nr].p[0],or[nr].p[1]):or[nr].t==="c"?cr.bezierCurveTo(or[nr].pts[0],or[nr].pts[1],or[nr].pts[2],or[nr].pts[3],or[nr].pts[4],or[nr].pts[5]):cr.closePath();(hr==="st"||hr==="gs")&&(cr.stroke(),fr.da&&cr.setLineDash(this.dashResetter))}hr!=="st"&&hr!=="gs"&&cr.fill(fr.r),lr.restore()}},CVShapeElement.prototype.renderShape=function(ir,er,tr,rr){var nr,sr=er.length-1,ar;for(ar=ir,nr=sr;nr>=0;nr-=1)er[nr].ty==="tr"?(ar=tr[nr].transform,this.renderShapeTransform(ir,ar)):er[nr].ty==="sh"||er[nr].ty==="el"||er[nr].ty==="rc"||er[nr].ty==="sr"?this.renderPath(er[nr],tr[nr]):er[nr].ty==="fl"?this.renderFill(er[nr],tr[nr],ar):er[nr].ty==="st"?this.renderStroke(er[nr],tr[nr],ar):er[nr].ty==="gf"||er[nr].ty==="gs"?this.renderGradientFill(er[nr],tr[nr],ar):er[nr].ty==="gr"?this.renderShape(ar,er[nr].it,tr[nr].it):er[nr].ty;rr&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(ir,er){if(this._isFirstFrame||er._mdf||ir.transforms._mdf){var tr=ir.trNodes,rr=er.paths,nr,sr,ar,or=rr._length;tr.length=0;var lr=ir.transforms.finalTransform;for(ar=0;ar<or;ar+=1){var cr=rr.shapes[ar];if(cr&&cr.v){for(sr=cr._length,nr=1;nr<sr;nr+=1)nr===1&&tr.push({t:"m",p:lr.applyToPointArray(cr.v[0][0],cr.v[0][1],0)}),tr.push({t:"c",pts:lr.applyToTriplePoints(cr.o[nr-1],cr.i[nr],cr.v[nr])});sr===1&&tr.push({t:"m",p:lr.applyToPointArray(cr.v[0][0],cr.v[0][1],0)}),cr.c&&sr&&(tr.push({t:"c",pts:lr.applyToTriplePoints(cr.o[nr-1],cr.i[0],cr.v[0])}),tr.push({t:"z"}))}}ir.trNodes=tr}},CVShapeElement.prototype.renderPath=function(ir,er){if(ir.hd!==!0&&ir._shouldRender){var tr,rr=er.styledShapes.length;for(tr=0;tr<rr;tr+=1)this.renderStyledShape(er.styledShapes[tr],er.sh)}},CVShapeElement.prototype.renderFill=function(ir,er,tr){var rr=er.style;(er.c._mdf||this._isFirstFrame)&&(rr.co="rgb("+bmFloor(er.c.v[0])+","+bmFloor(er.c.v[1])+","+bmFloor(er.c.v[2])+")"),(er.o._mdf||tr._opMdf||this._isFirstFrame)&&(rr.coOp=er.o.v*tr.opacity)},CVShapeElement.prototype.renderGradientFill=function(ir,er,tr){var rr=er.style,nr;if(!rr.grd||er.g._mdf||er.s._mdf||er.e._mdf||ir.t!==1&&(er.h._mdf||er.a._mdf)){var sr=this.globalData.canvasContext,ar=er.s.v,or=er.e.v;if(ir.t===1)nr=sr.createLinearGradient(ar[0],ar[1],or[0],or[1]);else{var lr=Math.sqrt(Math.pow(ar[0]-or[0],2)+Math.pow(ar[1]-or[1],2)),cr=Math.atan2(or[1]-ar[1],or[0]-ar[0]),hr=er.h.v;hr>=1?hr=.99:hr<=-1&&(hr=-.99);var fr=lr*hr,ur=Math.cos(cr+er.a.v)*fr+ar[0],pr=Math.sin(cr+er.a.v)*fr+ar[1];nr=sr.createRadialGradient(ur,pr,0,ar[0],ar[1],lr)}var gr,_r=ir.g.p,mr=er.g.c,dr=1;for(gr=0;gr<_r;gr+=1)er.g._hasOpacity&&er.g._collapsable&&(dr=er.g.o[gr*2+1]),nr.addColorStop(mr[gr*4]/100,"rgba("+mr[gr*4+1]+","+mr[gr*4+2]+","+mr[gr*4+3]+","+dr+")");rr.grd=nr}rr.coOp=er.o.v*tr.opacity},CVShapeElement.prototype.renderStroke=function(ir,er,tr){var rr=er.style,nr=er.d;nr&&(nr._mdf||this._isFirstFrame)&&(rr.da=nr.dashArray,rr.do=nr.dashoffset[0]),(er.c._mdf||this._isFirstFrame)&&(rr.co="rgb("+bmFloor(er.c.v[0])+","+bmFloor(er.c.v[1])+","+bmFloor(er.c.v[2])+")"),(er.o._mdf||tr._opMdf||this._isFirstFrame)&&(rr.coOp=er.o.v*tr.opacity),(er.w._mdf||this._isFirstFrame)&&(rr.wi=er.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var ir=this.textProperty.currentData;this.renderedLetters=createSizedArray(ir.l?ir.l.length:0);var er=!1;ir.fc?(er=!0,this.values.fill=this.buildColor(ir.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=er;var tr=!1;ir.sc&&(tr=!0,this.values.stroke=this.buildColor(ir.sc),this.values.sWidth=ir.sw);var rr=this.globalData.fontManager.getFontByName(ir.f),nr,sr,ar=ir.l,or=this.mHelper;this.stroke=tr,this.values.fValue=ir.finalSize+"px "+this.globalData.fontManager.getFontByName(ir.f).fFamily,sr=ir.finalText.length;var lr,cr,hr,fr,ur,pr,gr,_r,mr,dr,vr=this.data.singleShape,Ar=ir.tr*.001*ir.finalSize,yr=0,wr=0,br=!0,Sr=0;for(nr=0;nr<sr;nr+=1){lr=this.globalData.fontManager.getCharData(ir.finalText[nr],rr.fStyle,this.globalData.fontManager.getFontByName(ir.f).fFamily),cr=lr&&lr.data||{},or.reset(),vr&&ar[nr].n&&(yr=-Ar,wr+=ir.yOffset,wr+=br?1:0,br=!1),ur=cr.shapes?cr.shapes[0].it:[],gr=ur.length,or.scale(ir.finalSize/100,ir.finalSize/100),vr&&this.applyTextPropertiesToMatrix(ir,or,ar[nr].line,yr,wr),mr=createSizedArray(gr-1);var xr=0;for(pr=0;pr<gr;pr+=1)if(ur[pr].ty==="sh"){for(fr=ur[pr].ks.k.i.length,_r=ur[pr].ks.k,dr=[],hr=1;hr<fr;hr+=1)hr===1&&dr.push(or.applyToX(_r.v[0][0],_r.v[0][1],0),or.applyToY(_r.v[0][0],_r.v[0][1],0)),dr.push(or.applyToX(_r.o[hr-1][0],_r.o[hr-1][1],0),or.applyToY(_r.o[hr-1][0],_r.o[hr-1][1],0),or.applyToX(_r.i[hr][0],_r.i[hr][1],0),or.applyToY(_r.i[hr][0],_r.i[hr][1],0),or.applyToX(_r.v[hr][0],_r.v[hr][1],0),or.applyToY(_r.v[hr][0],_r.v[hr][1],0));dr.push(or.applyToX(_r.o[hr-1][0],_r.o[hr-1][1],0),or.applyToY(_r.o[hr-1][0],_r.o[hr-1][1],0),or.applyToX(_r.i[0][0],_r.i[0][1],0),or.applyToY(_r.i[0][0],_r.i[0][1],0),or.applyToX(_r.v[0][0],_r.v[0][1],0),or.applyToY(_r.v[0][0],_r.v[0][1],0)),mr[xr]=dr,xr+=1}vr&&(yr+=ar[nr].l,yr+=Ar),this.textSpans[Sr]?this.textSpans[Sr].elem=mr:this.textSpans[Sr]={elem:mr},Sr+=1}},CVTextElement.prototype.renderInnerContent=function(){var ir=this.canvasContext;ir.font=this.values.fValue,ir.lineCap="butt",ir.lineJoin="miter",ir.miterLimit=4,this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var er,tr,rr,nr,sr,ar,or=this.textAnimator.renderedLetters,lr=this.textProperty.currentData.l;tr=lr.length;var cr,hr=null,fr=null,ur=null,pr,gr;for(er=0;er<tr;er+=1)if(!lr[er].n){if(cr=or[er],cr&&(this.globalData.renderer.save(),this.globalData.renderer.ctxTransform(cr.p),this.globalData.renderer.ctxOpacity(cr.o)),this.fill){for(cr&&cr.fc?hr!==cr.fc&&(hr=cr.fc,ir.fillStyle=cr.fc):hr!==this.values.fill&&(hr=this.values.fill,ir.fillStyle=this.values.fill),pr=this.textSpans[er].elem,nr=pr.length,this.globalData.canvasContext.beginPath(),rr=0;rr<nr;rr+=1)for(gr=pr[rr],ar=gr.length,this.globalData.canvasContext.moveTo(gr[0],gr[1]),sr=2;sr<ar;sr+=6)this.globalData.canvasContext.bezierCurveTo(gr[sr],gr[sr+1],gr[sr+2],gr[sr+3],gr[sr+4],gr[sr+5]);this.globalData.canvasContext.closePath(),this.globalData.canvasContext.fill()}if(this.stroke){for(cr&&cr.sw?ur!==cr.sw&&(ur=cr.sw,ir.lineWidth=cr.sw):ur!==this.values.sWidth&&(ur=this.values.sWidth,ir.lineWidth=this.values.sWidth),cr&&cr.sc?fr!==cr.sc&&(fr=cr.sc,ir.strokeStyle=cr.sc):fr!==this.values.stroke&&(fr=this.values.stroke,ir.strokeStyle=this.values.stroke),pr=this.textSpans[er].elem,nr=pr.length,this.globalData.canvasContext.beginPath(),rr=0;rr<nr;rr+=1)for(gr=pr[rr],ar=gr.length,this.globalData.canvasContext.moveTo(gr[0],gr[1]),sr=2;sr<ar;sr+=6)this.globalData.canvasContext.bezierCurveTo(gr[sr],gr[sr+1],gr[sr+2],gr[sr+3],gr[sr+4],gr[sr+5]);this.globalData.canvasContext.closePath(),this.globalData.canvasContext.stroke()}cr&&this.globalData.renderer.restore()}},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var ir=createTag("canvas");ir.width=this.assetData.w,ir.height=this.assetData.h;var er=ir.getContext("2d"),tr=this.img.width,rr=this.img.height,nr=tr/rr,sr=this.assetData.w/this.assetData.h,ar,or,lr=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;nr>sr&&lr==="xMidYMid slice"||nr<sr&&lr!=="xMidYMid slice"?(or=rr,ar=or*sr):(ar=tr,or=ar/sr),er.drawImage(this.img,(tr-ar)/2,(rr-or)/2,ar,or,0,0,this.assetData.w,this.assetData.h),this.img=ir}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){var ir=this.canvasContext;ir.fillStyle=this.data.sc,ir.fillRect(0,0,this.data.sw,this.data.sh)},extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(ir){return new CVShapeElement(ir,this.globalData,this)},CanvasRendererBase.prototype.createText=function(ir){return new CVTextElement(ir,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(ir){return new CVImageElement(ir,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(ir){return new CVSolidElement(ir,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(ir){if(!(ir[0]===1&&ir[1]===0&&ir[4]===0&&ir[5]===1&&ir[12]===0&&ir[13]===0)){if(!this.renderConfig.clearCanvas){this.canvasContext.transform(ir[0],ir[1],ir[4],ir[5],ir[12],ir[13]);return}this.transformMat.cloneFromProps(ir);var er=this.contextData.cTr.props;this.transformMat.transform(er[0],er[1],er[2],er[3],er[4],er[5],er[6],er[7],er[8],er[9],er[10],er[11],er[12],er[13],er[14],er[15]),this.contextData.cTr.cloneFromProps(this.transformMat.props);var tr=this.contextData.cTr.props;this.canvasContext.setTransform(tr[0],tr[1],tr[4],tr[5],tr[12],tr[13])}},CanvasRendererBase.prototype.ctxOpacity=function(ir){if(!this.renderConfig.clearCanvas){this.canvasContext.globalAlpha*=ir<0?0:ir,this.globalData.currentGlobalAlpha=this.contextData.cO;return}this.contextData.cO*=ir<0?0:ir,this.globalData.currentGlobalAlpha!==this.contextData.cO&&(this.canvasContext.globalAlpha=this.contextData.cO,this.globalData.currentGlobalAlpha=this.contextData.cO)},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(ir){if(!this.renderConfig.clearCanvas){this.canvasContext.save();return}ir&&this.canvasContext.save();var er=this.contextData.cTr.props;this.contextData._length<=this.contextData.cArrPos&&this.contextData.duplicate();var tr,rr=this.contextData.saved[this.contextData.cArrPos];for(tr=0;tr<16;tr+=1)rr[tr]=er[tr];this.contextData.savedOp[this.contextData.cArrPos]=this.contextData.cO,this.contextData.cArrPos+=1},CanvasRendererBase.prototype.restore=function(ir){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}ir&&(this.canvasContext.restore(),this.globalData.blendMode="source-over"),this.contextData.cArrPos-=1;var er=this.contextData.saved[this.contextData.cArrPos],tr,rr=this.contextData.cTr.props;for(tr=0;tr<16;tr+=1)rr[tr]=er[tr];this.canvasContext.setTransform(er[0],er[1],er[4],er[5],er[12],er[13]),er=this.contextData.savedOp[this.contextData.cArrPos],this.contextData.cO=er,this.globalData.currentGlobalAlpha!==er&&(this.canvasContext.globalAlpha=er,this.globalData.currentGlobalAlpha=er)},CanvasRendererBase.prototype.configAnimation=function(ir){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var er=this.animationItem.container.style;er.width="100%",er.height="100%";var tr="0px 0px 0px";er.transformOrigin=tr,er.mozTransformOrigin=tr,er.webkitTransformOrigin=tr,er["-webkit-transform"]=tr,er.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.data=ir,this.layers=ir.layers,this.transformCanvas={w:ir.w,h:ir.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(ir,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(ir.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(){this.reset();var ir,er;this.animationItem.wrapper&&this.animationItem.container?(ir=this.animationItem.wrapper.offsetWidth,er=this.animationItem.wrapper.offsetHeight,this.animationItem.container.setAttribute("width",ir*this.renderConfig.dpr),this.animationItem.container.setAttribute("height",er*this.renderConfig.dpr)):(ir=this.canvasContext.canvas.width*this.renderConfig.dpr,er=this.canvasContext.canvas.height*this.renderConfig.dpr);var tr,rr;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var nr=this.renderConfig.preserveAspectRatio.split(" "),sr=nr[1]||"meet",ar=nr[0]||"xMidYMid",or=ar.substr(0,4),lr=ar.substr(4);tr=ir/er,rr=this.transformCanvas.w/this.transformCanvas.h,rr>tr&&sr==="meet"||rr<tr&&sr==="slice"?(this.transformCanvas.sx=ir/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=ir/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=er/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=er/(this.transformCanvas.h/this.renderConfig.dpr)),or==="xMid"&&(rr<tr&&sr==="meet"||rr>tr&&sr==="slice")?this.transformCanvas.tx=(ir-this.transformCanvas.w*(er/this.transformCanvas.h))/2*this.renderConfig.dpr:or==="xMax"&&(rr<tr&&sr==="meet"||rr>tr&&sr==="slice")?this.transformCanvas.tx=(ir-this.transformCanvas.w*(er/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,lr==="YMid"&&(rr>tr&&sr==="meet"||rr<tr&&sr==="slice")?this.transformCanvas.ty=(er-this.transformCanvas.h*(ir/this.transformCanvas.w))/2*this.renderConfig.dpr:lr==="YMax"&&(rr>tr&&sr==="meet"||rr<tr&&sr==="slice")?this.transformCanvas.ty=(er-this.transformCanvas.h*(ir/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=ir/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=er/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var ir,er=this.layers?this.layers.length:0;for(ir=er-1;ir>=0;ir-=1)this.elements[ir]&&this.elements[ir].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(ir,er){if(!(this.renderedFrame===ir&&this.renderConfig.clearCanvas===!0&&!er||this.destroyed||ir===-1)){this.renderedFrame=ir,this.globalData.frameNum=ir-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||er,this.globalData.projectInterface.currentFrame=ir;var tr,rr=this.layers.length;for(this.completeLayers||this.checkLayers(ir),tr=0;tr<rr;tr+=1)(this.completeLayers||this.elements[tr])&&this.elements[tr].prepareFrame(ir-this.layers[tr].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),tr=rr-1;tr>=0;tr-=1)(this.completeLayers||this.elements[tr])&&this.elements[tr].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(ir){var er=this.elements;if(!(er[ir]||this.layers[ir].ty===99)){var tr=this.createItem(this.layers[ir],this,this.globalData);er[ir]=tr,tr.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var ir=this.pendingElements.pop();ir.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"},extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var ir=this.canvasContext;ir.beginPath(),ir.moveTo(0,0),ir.lineTo(this.data.w,0),ir.lineTo(this.data.w,this.data.h),ir.lineTo(0,this.data.h),ir.lineTo(0,0),ir.clip();var er,tr=this.layers.length;for(er=tr-1;er>=0;er-=1)(this.completeLayers||this.elements[er])&&this.elements[er].renderFrame()},CVCompElement.prototype.destroy=function(){var ir,er=this.layers.length;for(ir=er-1;ir>=0;ir-=1)this.elements[ir]&&this.elements[ir].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(ir){return new CVCompElement(ir,this.globalData,this)},extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(ir){return new CVCompElement(ir,this.globalData,this)},registerRenderer("canvas",CanvasRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier);const Expressions=function(){var ir={};ir.initExpressions=er;function er(tr){var rr=0,nr=[];function sr(){rr+=1}function ar(){rr-=1,rr===0&&lr()}function or(cr){nr.indexOf(cr)===-1&&nr.push(cr)}function lr(){var cr,hr=nr.length;for(cr=0;cr<hr;cr+=1)nr[cr].release();nr.length=0}tr.renderer.compInterface=CompExpressionInterface(tr.renderer),tr.renderer.globalData.projectInterface.registerComposition(tr.renderer),tr.renderer.globalData.pushExpression=sr,tr.renderer.globalData.popExpression=ar,tr.renderer.globalData.registerExpressionProperty=or}return ir}();var propTypes={SHAPE:"shape"};const ExpressionManager=function(){"use strict";var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null;initialize$2(BMMath);function $bm_isInstanceOfArray(ir){return ir.constructor===Array||ir.constructor===Float32Array}function isNumerable(ir,er){return ir==="number"||ir==="boolean"||ir==="string"||er instanceof Number}function $bm_neg(ir){var er=typeof ir;if(er==="number"||er==="boolean"||ir instanceof Number)return-ir;if($bm_isInstanceOfArray(ir)){var tr,rr=ir.length,nr=[];for(tr=0;tr<rr;tr+=1)nr[tr]=-ir[tr];return nr}return ir.propType?ir.v:-ir}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(ir,er){var tr=typeof ir,rr=typeof er;if(tr==="string"||rr==="string"||isNumerable(tr,ir)&&isNumerable(rr,er))return ir+er;if($bm_isInstanceOfArray(ir)&&isNumerable(rr,er))return ir=ir.slice(0),ir[0]+=er,ir;if(isNumerable(tr,ir)&&$bm_isInstanceOfArray(er))return er=er.slice(0),er[0]=ir+er[0],er;if($bm_isInstanceOfArray(ir)&&$bm_isInstanceOfArray(er)){for(var nr=0,sr=ir.length,ar=er.length,or=[];nr<sr||nr<ar;)(typeof ir[nr]=="number"||ir[nr]instanceof Number)&&(typeof er[nr]=="number"||er[nr]instanceof Number)?or[nr]=ir[nr]+er[nr]:or[nr]=er[nr]===void 0?ir[nr]:ir[nr]||er[nr],nr+=1;return or}return 0}var add=sum;function sub(ir,er){var tr=typeof ir,rr=typeof er;if(isNumerable(tr,ir)&&isNumerable(rr,er))return tr==="string"&&(ir=parseInt(ir,10)),rr==="string"&&(er=parseInt(er,10)),ir-er;if($bm_isInstanceOfArray(ir)&&isNumerable(rr,er))return ir=ir.slice(0),ir[0]-=er,ir;if(isNumerable(tr,ir)&&$bm_isInstanceOfArray(er))return er=er.slice(0),er[0]=ir-er[0],er;if($bm_isInstanceOfArray(ir)&&$bm_isInstanceOfArray(er)){for(var nr=0,sr=ir.length,ar=er.length,or=[];nr<sr||nr<ar;)(typeof ir[nr]=="number"||ir[nr]instanceof Number)&&(typeof er[nr]=="number"||er[nr]instanceof Number)?or[nr]=ir[nr]-er[nr]:or[nr]=er[nr]===void 0?ir[nr]:ir[nr]||er[nr],nr+=1;return or}return 0}function mul(ir,er){var tr=typeof ir,rr=typeof er,nr;if(isNumerable(tr,ir)&&isNumerable(rr,er))return ir*er;var sr,ar;if($bm_isInstanceOfArray(ir)&&isNumerable(rr,er)){for(ar=ir.length,nr=createTypedArray("float32",ar),sr=0;sr<ar;sr+=1)nr[sr]=ir[sr]*er;return nr}if(isNumerable(tr,ir)&&$bm_isInstanceOfArray(er)){for(ar=er.length,nr=createTypedArray("float32",ar),sr=0;sr<ar;sr+=1)nr[sr]=ir*er[sr];return nr}return 0}function div(ir,er){var tr=typeof ir,rr=typeof er,nr;if(isNumerable(tr,ir)&&isNumerable(rr,er))return ir/er;var sr,ar;if($bm_isInstanceOfArray(ir)&&isNumerable(rr,er)){for(ar=ir.length,nr=createTypedArray("float32",ar),sr=0;sr<ar;sr+=1)nr[sr]=ir[sr]/er;return nr}if(isNumerable(tr,ir)&&$bm_isInstanceOfArray(er)){for(ar=er.length,nr=createTypedArray("float32",ar),sr=0;sr<ar;sr+=1)nr[sr]=ir/er[sr];return nr}return 0}function mod(ir,er){return typeof ir=="string"&&(ir=parseInt(ir,10)),typeof er=="string"&&(er=parseInt(er,10)),ir%er}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(ir,er,tr){if(er>tr){var rr=tr;tr=er,er=rr}return Math.min(Math.max(ir,er),tr)}function radiansToDegrees(ir){return ir/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(ir){return ir*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(ir,er){if(typeof ir=="number"||ir instanceof Number)return er=er||0,Math.abs(ir-er);er||(er=helperLengthArray);var tr,rr=Math.min(ir.length,er.length),nr=0;for(tr=0;tr<rr;tr+=1)nr+=Math.pow(er[tr]-ir[tr],2);return Math.sqrt(nr)}function normalize(ir){return div(ir,length(ir))}function rgbToHsl(ir){var er=ir[0],tr=ir[1],rr=ir[2],nr=Math.max(er,tr,rr),sr=Math.min(er,tr,rr),ar,or,lr=(nr+sr)/2;if(nr===sr)ar=0,or=0;else{var cr=nr-sr;switch(or=lr>.5?cr/(2-nr-sr):cr/(nr+sr),nr){case er:ar=(tr-rr)/cr+(tr<rr?6:0);break;case tr:ar=(rr-er)/cr+2;break;case rr:ar=(er-tr)/cr+4;break;default:break}ar/=6}return[ar,or,lr,ir[3]]}function hue2rgb(ir,er,tr){return tr<0&&(tr+=1),tr>1&&(tr-=1),tr<1/6?ir+(er-ir)*6*tr:tr<1/2?er:tr<2/3?ir+(er-ir)*(2/3-tr)*6:ir}function hslToRgb(ir){var er=ir[0],tr=ir[1],rr=ir[2],nr,sr,ar;if(tr===0)nr=rr,ar=rr,sr=rr;else{var or=rr<.5?rr*(1+tr):rr+tr-rr*tr,lr=2*rr-or;nr=hue2rgb(lr,or,er+1/3),sr=hue2rgb(lr,or,er),ar=hue2rgb(lr,or,er-1/3)}return[nr,sr,ar,ir[3]]}function linear(ir,er,tr,rr,nr){if((rr===void 0||nr===void 0)&&(rr=er,nr=tr,er=0,tr=1),tr<er){var sr=tr;tr=er,er=sr}if(ir<=er)return rr;if(ir>=tr)return nr;var ar=tr===er?0:(ir-er)/(tr-er);if(!rr.length)return rr+(nr-rr)*ar;var or,lr=rr.length,cr=createTypedArray("float32",lr);for(or=0;or<lr;or+=1)cr[or]=rr[or]+(nr[or]-rr[or])*ar;return cr}function random(ir,er){if(er===void 0&&(ir===void 0?(ir=0,er=1):(er=ir,ir=void 0)),er.length){var tr,rr=er.length;ir||(ir=createTypedArray("float32",rr));var nr=createTypedArray("float32",rr),sr=BMMath.random();for(tr=0;tr<rr;tr+=1)nr[tr]=ir[tr]+sr*(er[tr]-ir[tr]);return nr}ir===void 0&&(ir=0);var ar=BMMath.random();return ir+ar*(er-ir)}function createPath(ir,er,tr,rr){var nr,sr=ir.length,ar=shapePool.newElement();ar.setPathData(!!rr,sr);var or=[0,0],lr,cr;for(nr=0;nr<sr;nr+=1)lr=er&&er[nr]?er[nr]:or,cr=tr&&tr[nr]?tr[nr]:or,ar.setTripleAt(ir[nr][0],ir[nr][1],cr[0]+ir[nr][0],cr[1]+ir[nr][1],lr[0]+ir[nr][0],lr[1]+ir[nr][1],nr,!0);return ar}function initiateExpression(elem,data,property){var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=function ir(er,tr){var rr,nr,sr=this.pv.length?this.pv.length:1,ar=createTypedArray("float32",sr);er=5;var or=Math.floor(time*er);for(rr=0,nr=0;rr<or;){for(nr=0;nr<sr;nr+=1)ar[nr]+=-tr+tr*2*BMMath.random();rr+=1}var lr=time*er,cr=lr-Math.floor(lr),hr=createTypedArray("float32",sr);if(sr>1){for(nr=0;nr<sr;nr+=1)hr[nr]=this.pv[nr]+ar[nr]+(-tr+tr*2*BMMath.random())*cr;return hr}return this.pv+ar[0]+(-tr+tr*2*BMMath.random())*cr}.bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(ir,er){return loopIn(ir,er,!0)}function loopOutDuration(ir,er){return loopOut(ir,er,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(ir,er){var tr=[er[0]-ir[0],er[1]-ir[1],er[2]-ir[2]],rr=Math.atan2(tr[0],Math.sqrt(tr[1]*tr[1]+tr[2]*tr[2]))/degToRads,nr=-Math.atan2(tr[1],tr[2])/degToRads;return[nr,rr,0]}function easeOut(ir,er,tr,rr,nr){return applyEase(easeOutBez,ir,er,tr,rr,nr)}function easeIn(ir,er,tr,rr,nr){return applyEase(easeInBez,ir,er,tr,rr,nr)}function ease(ir,er,tr,rr,nr){return applyEase(easeInOutBez,ir,er,tr,rr,nr)}function applyEase(ir,er,tr,rr,nr,sr){nr===void 0?(nr=tr,sr=rr):er=(er-tr)/(rr-tr),er>1?er=1:er<0&&(er=0);var ar=ir(er);if($bm_isInstanceOfArray(nr)){var or,lr=nr.length,cr=createTypedArray("float32",lr);for(or=0;or<lr;or+=1)cr[or]=(sr[or]-nr[or])*ar+nr[or];return cr}return(sr-nr)*ar+nr}function nearestKey(ir){var er,tr=data.k.length,rr,nr;if(!data.k.length||typeof data.k[0]=="number")rr=0,nr=0;else if(rr=-1,ir*=elem.comp.globalData.frameRate,ir<data.k[0].t)rr=1,nr=data.k[0].t;else{for(er=0;er<tr-1;er+=1)if(ir===data.k[er].t){rr=er+1,nr=data.k[er].t;break}else if(ir>data.k[er].t&&ir<data.k[er+1].t){ir-data.k[er].t>data.k[er+1].t-ir?(rr=er+2,nr=data.k[er+1].t):(rr=er+1,nr=data.k[er].t);break}rr===-1&&(rr=er+1,nr=data.k[er].t)}var sr={};return sr.index=rr,sr.time=nr/elem.comp.globalData.frameRate,sr}function key(ir){var er,tr,rr;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+ir);ir-=1,er={time:data.k[ir].t/elem.comp.globalData.frameRate,value:[]};var nr=Object.prototype.hasOwnProperty.call(data.k[ir],"s")?data.k[ir].s:data.k[ir-1].e;for(rr=nr.length,tr=0;tr<rr;tr+=1)er[tr]=nr[tr],er.value[tr]=nr[tr];return er}function framesToTime(ir,er){return er||(er=elem.comp.globalData.frameRate),ir/er}function timeToFrames(ir,er){return!ir&&ir!==0&&(ir=time),er||(er=elem.comp.globalData.frameRate),ir*er}function seedRandom(ir){BMMath.seedrandom(randSeed+ir)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(ir,er){return typeof value=="string"?er===void 0?value.substring(ir):value.substring(ir,er):""}function substr(ir,er){return typeof value=="string"?er===void 0?value.substr(ir):value.substr(ir,er):""}function posterizeTime(ir){time=ir===0?0:Math.floor(time*ir)/ir,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(ir){return value=ir,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath],ob}(),expressionHelpers=function(){function ir(ar,or,lr){or.x&&(lr.k=!0,lr.x=!0,lr.initiateExpression=ExpressionManager.initiateExpression,lr.effectsSequence.push(lr.initiateExpression(ar,or,lr).bind(lr)))}function er(ar){return ar*=this.elem.globalData.frameRate,ar-=this.offsetTime,ar!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<ar?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(ar,this._cachingAtTime),this._cachingAtTime.lastFrame=ar),this._cachingAtTime.value}function tr(ar){var or=-.01,lr=this.getValueAtTime(ar),cr=this.getValueAtTime(ar+or),hr=0;if(lr.length){var fr;for(fr=0;fr<lr.length;fr+=1)hr+=Math.pow(cr[fr]-lr[fr],2);hr=Math.sqrt(hr)*100}else hr=0;return hr}function rr(ar){if(this.vel!==void 0)return this.vel;var or=-.001,lr=this.getValueAtTime(ar),cr=this.getValueAtTime(ar+or),hr;if(lr.length){hr=createTypedArray("float32",lr.length);var fr;for(fr=0;fr<lr.length;fr+=1)hr[fr]=(cr[fr]-lr[fr])/or}else hr=(cr-lr)/or;return hr}function nr(){return this.pv}function sr(ar){this.propertyGroup=ar}return{searchExpressions:ir,getSpeedAtTime:tr,getVelocityAtTime:rr,getValueAtTime:er,getStaticValueAtTime:nr,setGroupProperty:sr}}();setExpressionsPlugin(Expressions),initialize$1(),initialize()}class LottieLoader extends Loader{setQuality(er){this._quality=er}load(er,tr,rr,nr){const sr=this._quality||1,ar=new CanvasTexture;ar.minFilter=NearestFilter,ar.generateMipmaps=!1,ar.colorSpace=SRGBColorSpace;const or=new FileLoader(this.manager);return or.setPath(this.path),or.setWithCredentials(this.withCredentials),or.load(er,function(lr){const cr=JSON.parse(lr),hr=document.createElement("div");hr.style.width=cr.w+"px",hr.style.height=cr.h+"px",document.body.appendChild(hr);const fr=lottie.loadAnimation({container:hr,animType:"canvas",loop:!0,autoplay:!0,animationData:cr,rendererSettings:{dpr:sr}});ar.animation=fr,ar.image=fr.container,fr.addEventListener("enterFrame",function(){ar.needsUpdate=!0}),hr.style.display="none",tr!==void 0&&tr(ar)},rr,nr),ar}}const _normalData=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];class MD2Loader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr=new DataView(er),rr={},nr=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"];for(let yr=0;yr<nr.length;yr++)rr[nr[yr]]=tr.getInt32(yr*4,!0);if(rr.ident!==844121161||rr.version!==8){console.error("Not a valid MD2 file");return}if(rr.offset_end!==tr.byteLength){console.error("Corrupted MD2 file");return}const sr=new BufferGeometry,ar=[];let or=rr.offset_st;for(let yr=0,wr=rr.num_st;yr<wr;yr++){const br=tr.getInt16(or+0,!0),Sr=tr.getInt16(or+2,!0);ar.push(br/rr.skinwidth,1-Sr/rr.skinheight),or+=4}or=rr.offset_tris;const lr=[],cr=[];for(let yr=0,wr=rr.num_tris;yr<wr;yr++)lr.push(tr.getUint16(or+0,!0),tr.getUint16(or+2,!0),tr.getUint16(or+4,!0)),cr.push(tr.getUint16(or+6,!0),tr.getUint16(or+8,!0),tr.getUint16(or+10,!0)),or+=12;const hr=new Vector3$1,fr=new Vector3$1,ur=[];or=rr.offset_frames;for(let yr=0,wr=rr.num_frames;yr<wr;yr++){fr.set(tr.getFloat32(or+0,!0),tr.getFloat32(or+4,!0),tr.getFloat32(or+8,!0)),hr.set(tr.getFloat32(or+12,!0),tr.getFloat32(or+16,!0),tr.getFloat32(or+20,!0)),or+=24;const br=[];for(let xr=0;xr<16;xr++){const Cr=tr.getUint8(or+xr);if(Cr===0)break;br[xr]=Cr}const Sr={name:String.fromCharCode.apply(null,br),vertices:[],normals:[]};or+=16;for(let xr=0;xr<rr.num_vertices;xr++){let Cr=tr.getUint8(or++),Ir=tr.getUint8(or++),Rr=tr.getUint8(or++);const Pr=_normalData[tr.getUint8(or++)];Cr=Cr*fr.x+hr.x,Ir=Ir*fr.y+hr.y,Rr=Rr*fr.z+hr.z,Sr.vertices.push(Cr,Rr,Ir),Sr.normals.push(Pr[0],Pr[2],Pr[1])}ur.push(Sr)}const pr=[],gr=[],_r=[],mr=ur[0].vertices,dr=ur[0].normals;for(let yr=0,wr=lr.length;yr<wr;yr++){let Sr=lr[yr]*3;const xr=mr[Sr],Cr=mr[Sr+1],Ir=mr[Sr+2];pr.push(xr,Cr,Ir);const Rr=dr[Sr],Pr=dr[Sr+1],Fr=dr[Sr+2];gr.push(Rr,Pr,Fr),Sr=cr[yr]*2;const Ur=ar[Sr],Br=ar[Sr+1];_r.push(Ur,Br)}sr.setAttribute("position",new Float32BufferAttribute(pr,3)),sr.setAttribute("normal",new Float32BufferAttribute(gr,3)),sr.setAttribute("uv",new Float32BufferAttribute(_r,2));const vr=[],Ar=[];for(let yr=0,wr=ur.length;yr<wr;yr++){const br=ur[yr],Sr=br.name;if(br.vertices.length>0){const xr=[];for(let Ir=0,Rr=lr.length;Ir<Rr;Ir++){const Fr=lr[Ir]*3,Nr=br.vertices[Fr],Ur=br.vertices[Fr+1],Br=br.vertices[Fr+2];xr.push(Nr,Ur,Br)}const Cr=new Float32BufferAttribute(xr,3);Cr.name=Sr,vr.push(Cr)}if(br.normals.length>0){const xr=[];for(let Ir=0,Rr=lr.length;Ir<Rr;Ir++){const Fr=lr[Ir]*3,Nr=br.normals[Fr],Ur=br.normals[Fr+1],Br=br.normals[Fr+2];xr.push(Nr,Ur,Br)}const Cr=new Float32BufferAttribute(xr,3);Cr.name=Sr,Ar.push(Cr)}}return sr.morphAttributes.position=vr,sr.morphAttributes.normal=Ar,sr.morphTargetsRelative=!1,sr.animations=AnimationClip.CreateClipsFromMorphTargetSequences(ur,10),sr}}class MDDLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setResponseType("arraybuffer"),ar.load(er,function(or){tr(sr.parse(or))},rr,nr)}parse(er){const tr=new DataView(er),rr=tr.getUint32(0),nr=tr.getUint32(4);let sr=8;const ar=new Float32Array(rr),or=new Float32Array(rr*rr).fill(0);for(let fr=0;fr<rr;fr++)ar[fr]=tr.getFloat32(sr),sr+=4,or[rr*fr+fr]=1;const lr=new NumberKeyframeTrack(".morphTargetInfluences",ar,or),cr=new AnimationClip("default",ar[ar.length-1],[lr]),hr=[];for(let fr=0;fr<rr;fr++){const ur=new Float32Array(nr*3);for(let gr=0;gr<nr;gr++){const _r=gr*3;ur[_r+0]=tr.getFloat32(sr),sr+=4,ur[_r+1]=tr.getFloat32(sr),sr+=4,ur[_r+2]=tr.getFloat32(sr),sr+=4}const pr=new BufferAttribute(ur,3);pr.name="morph_"+fr,hr.push(pr)}return{morphTargets:hr,clip:cr}}}class MTLLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=this.path===""?LoaderUtils.extractUrlBase(er):this.path,or=new FileLoader(this.manager);or.setPath(this.path),or.setRequestHeader(this.requestHeader),or.setWithCredentials(this.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},rr,nr)}setMaterialOptions(er){return this.materialOptions=er,this}parse(er,tr){const rr=er.split(`
`);let nr={};const sr=/\s+/,ar={};for(let lr=0;lr<rr.length;lr++){let cr=rr[lr];if(cr=cr.trim(),cr.length===0||cr.charAt(0)==="#")continue;const hr=cr.indexOf(" ");let fr=hr>=0?cr.substring(0,hr):cr;fr=fr.toLowerCase();let ur=hr>=0?cr.substring(hr+1):"";if(ur=ur.trim(),fr==="newmtl")nr={name:ur},ar[ur]=nr;else if(fr==="ka"||fr==="kd"||fr==="ks"||fr==="ke"){const pr=ur.split(sr,3);nr[fr]=[parseFloat(pr[0]),parseFloat(pr[1]),parseFloat(pr[2])]}else nr[fr]=ur}const or=new MaterialCreator(this.resourcePath||tr,this.materialOptions);return or.setCrossOrigin(this.crossOrigin),or.setManager(this.manager),or.setMaterials(ar),or}}class MaterialCreator{constructor(er="",tr={}){this.baseUrl=er,this.options=tr,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:RepeatWrapping}setCrossOrigin(er){return this.crossOrigin=er,this}setManager(er){this.manager=er}setMaterials(er){this.materialsInfo=this.convert(er),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(er){if(!this.options)return er;const tr={};for(const rr in er){const nr=er[rr],sr={};tr[rr]=sr;for(const ar in nr){let or=!0,lr=nr[ar];const cr=ar.toLowerCase();switch(cr){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(lr=[lr[0]/255,lr[1]/255,lr[2]/255]),this.options&&this.options.ignoreZeroRGBs&&lr[0]===0&&lr[1]===0&&lr[2]===0&&(or=!1);break;default:break}or&&(sr[cr]=lr)}}return tr}preload(){for(const er in this.materialsInfo)this.create(er)}getIndex(er){return this.nameLookup[er]}getAsArray(){let er=0;for(const tr in this.materialsInfo)this.materialsArray[er]=this.create(tr),this.nameLookup[tr]=er,er++;return this.materialsArray}create(er){return this.materials[er]===void 0&&this.createMaterial_(er),this.materials[er]}createMaterial_(er){const tr=this,rr=this.materialsInfo[er],nr={name:er,side:this.side};function sr(or,lr){return typeof lr!="string"||lr===""?"":/^https?:\/\//i.test(lr)?lr:or+lr}function ar(or,lr){if(nr[or])return;const cr=tr.getTextureParams(lr,nr),hr=tr.loadTexture(sr(tr.baseUrl,cr.url));hr.repeat.copy(cr.scale),hr.offset.copy(cr.offset),hr.wrapS=tr.wrap,hr.wrapT=tr.wrap,(or==="map"||or==="emissiveMap")&&(hr.colorSpace=SRGBColorSpace),nr[or]=hr}for(const or in rr){const lr=rr[or];let cr;if(lr!=="")switch(or.toLowerCase()){case"kd":nr.color=ColorManagement.toWorkingColorSpace(new Color().fromArray(lr),SRGBColorSpace);break;case"ks":nr.specular=ColorManagement.toWorkingColorSpace(new Color().fromArray(lr),SRGBColorSpace);break;case"ke":nr.emissive=ColorManagement.toWorkingColorSpace(new Color().fromArray(lr),SRGBColorSpace);break;case"map_kd":ar("map",lr);break;case"map_ks":ar("specularMap",lr);break;case"map_ke":ar("emissiveMap",lr);break;case"norm":ar("normalMap",lr);break;case"map_bump":case"bump":ar("bumpMap",lr);break;case"map_d":ar("alphaMap",lr),nr.transparent=!0;break;case"ns":nr.shininess=parseFloat(lr);break;case"d":cr=parseFloat(lr),cr<1&&(nr.opacity=cr,nr.transparent=!0);break;case"tr":cr=parseFloat(lr),this.options&&this.options.invertTrProperty&&(cr=1-cr),cr>0&&(nr.opacity=1-cr,nr.transparent=!0);break;default:break}}return this.materials[er]=new MeshPhongMaterial(nr),this.materials[er]}getTextureParams(er,tr){const rr={scale:new Vector2(1,1),offset:new Vector2(0,0)},nr=er.split(/\s+/);let sr;return sr=nr.indexOf("-bm"),sr>=0&&(tr.bumpScale=parseFloat(nr[sr+1]),nr.splice(sr,2)),sr=nr.indexOf("-s"),sr>=0&&(rr.scale.set(parseFloat(nr[sr+1]),parseFloat(nr[sr+2])),nr.splice(sr,4)),sr=nr.indexOf("-o"),sr>=0&&(rr.offset.set(parseFloat(nr[sr+1]),parseFloat(nr[sr+2])),nr.splice(sr,4)),rr.url=nr.join(" ").trim(),rr}loadTexture(er,tr,rr,nr,sr){const ar=this.manager!==void 0?this.manager:DefaultLoadingManager;let or=ar.getHandler(er);or===null&&(or=new TextureLoader(ar)),or.setCrossOrigin&&or.setCrossOrigin(this.crossOrigin);const lr=or.load(er,rr,nr,sr);return tr!==void 0&&(lr.mapping=tr),lr}}class VolumeSlice{constructor(er,tr,rr){const nr=this;this.volume=er,tr=tr||0,Object.defineProperty(this,"index",{get:function(){return tr},set:function(or){return tr=or,nr.geometryNeedsUpdate=!0,tr}}),this.axis=rr||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();const sr=new Texture(this.canvas);sr.minFilter=LinearFilter,sr.generateMipmaps=!1,sr.wrapS=sr.wrapT=ClampToEdgeWrapping,sr.colorSpace=SRGBColorSpace;const ar=new MeshBasicMaterial({map:sr,side:DoubleSide,transparent:!0});this.mesh=new Mesh(this.geometry,ar),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()}repaint(){this.geometryNeedsUpdate&&this.updateGeometry();const er=this.iLength,tr=this.jLength,rr=this.sliceAccess,nr=this.volume,sr=this.canvasBuffer,ar=this.ctxBuffer,or=ar.getImageData(0,0,er,tr),lr=or.data,cr=nr.data,hr=nr.upperThreshold,fr=nr.lowerThreshold,ur=nr.windowLow,pr=nr.windowHigh;let gr=0;if(nr.dataType==="label")for(let _r=0;_r<tr;_r++)for(let mr=0;mr<er;mr++){let dr=cr[rr(mr,_r)];dr=dr>=this.colorMap.length?dr%this.colorMap.length+1:dr;const vr=this.colorMap[dr];lr[4*gr]=vr>>24&255,lr[4*gr+1]=vr>>16&255,lr[4*gr+2]=vr>>8&255,lr[4*gr+3]=vr&255,gr++}else for(let _r=0;_r<tr;_r++)for(let mr=0;mr<er;mr++){let dr=cr[rr(mr,_r)],vr=255;vr=hr>=dr&&fr<=dr?vr:0,dr=Math.floor(255*(dr-ur)/(pr-ur)),dr=dr>255?255:dr<0?0:dr|0,lr[4*gr]=dr,lr[4*gr+1]=dr,lr[4*gr+2]=dr,lr[4*gr+3]=vr,gr++}ar.putImageData(or,0,0),this.ctx.drawImage(sr,0,0,er,tr,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0}updateGeometry(){const er=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=er.sliceAccess,this.jLength=er.jLength,this.iLength=er.iLength,this.matrix=er.matrix,this.canvas.width=er.planeWidth,this.canvas.height=er.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new PlaneGeometry(er.planeWidth,er.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}}class Volume{constructor(er,tr,rr,nr,sr){if(er!==void 0){switch(this.xLength=Number(er)||1,this.yLength=Number(tr)||1,this.zLength=Number(rr)||1,this.axisOrder=["x","y","z"],nr){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(sr);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(sr);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(sr);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(sr);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(sr);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(sr);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw new Error("Error in Volume constructor : this type is not supported in JavaScript");case"Float32":case"float32":case"float":this.data=new Float32Array(sr);break;case"Float64":case"float64":case"double":this.data=new Float64Array(sr);break;default:this.data=new Uint8Array(sr)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw new Error("Error in Volume constructor, lengths are not matching arrayBuffer size")}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new Matrix3,this.matrix.identity();let ar=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return ar},set:function(lr){ar=lr,this.sliceList.forEach(function(cr){cr.geometryNeedsUpdate=!0})}});let or=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return or},set:function(lr){or=lr,this.sliceList.forEach(function(cr){cr.geometryNeedsUpdate=!0})}}),this.sliceList=[],this.segmentation=!1}getData(er,tr,rr){return this.data[rr*this.xLength*this.yLength+tr*this.xLength+er]}access(er,tr,rr){return rr*this.xLength*this.yLength+tr*this.xLength+er}reverseAccess(er){const tr=Math.floor(er/(this.yLength*this.xLength)),rr=Math.floor((er-tr*this.yLength*this.xLength)/this.xLength);return[er-tr*this.yLength*this.xLength-rr*this.xLength,rr,tr]}map(er,tr){const rr=this.data.length;tr=tr||this;for(let nr=0;nr<rr;nr++)this.data[nr]=er.call(tr,this.data[nr],nr,this.data);return this}extractPerpendicularPlane(er,tr){let rr,nr,sr,ar;const or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1,hr=new Matrix4().identity(),fr=this,ur=new Vector3$1(this.xLength,this.yLength,this.zLength);switch(er){case"x":or.set(1,0,0),lr.set(0,0,-1),cr.set(0,-1,0),rr=this.spacing[this.axisOrder.indexOf("z")],nr=this.spacing[this.axisOrder.indexOf("y")],ar=new Vector3$1(tr,0,0),hr.multiply(new Matrix4().makeRotationY(Math.PI/2)),sr=(fr.RASDimensions[0]-1)/2,hr.setPosition(new Vector3$1(tr-sr,0,0));break;case"y":or.set(0,1,0),lr.set(1,0,0),cr.set(0,0,1),rr=this.spacing[this.axisOrder.indexOf("x")],nr=this.spacing[this.axisOrder.indexOf("z")],ar=new Vector3$1(0,tr,0),hr.multiply(new Matrix4().makeRotationX(-Math.PI/2)),sr=(fr.RASDimensions[1]-1)/2,hr.setPosition(new Vector3$1(0,tr-sr,0));break;case"z":default:or.set(0,0,1),lr.set(1,0,0),cr.set(0,-1,0),rr=this.spacing[this.axisOrder.indexOf("x")],nr=this.spacing[this.axisOrder.indexOf("y")],ar=new Vector3$1(0,0,tr),sr=(fr.RASDimensions[2]-1)/2,hr.setPosition(new Vector3$1(0,0,tr-sr));break}this.segmentation||(lr.applyMatrix4(fr.inverseMatrix).normalize(),cr.applyMatrix4(fr.inverseMatrix).normalize(),or.applyMatrix4(fr.inverseMatrix).normalize()),lr.arglet="i",cr.arglet="j";const pr=Math.floor(Math.abs(lr.dot(ur))),gr=Math.floor(Math.abs(cr.dot(ur))),_r=Math.abs(pr*rr),mr=Math.abs(gr*nr);ar=Math.abs(Math.round(ar.applyMatrix4(fr.inverseMatrix).dot(or)));const dr=[new Vector3$1(1,0,0),new Vector3$1(0,1,0),new Vector3$1(0,0,1)],vr=[lr,cr,or].find(function(br){return Math.abs(br.dot(dr[0]))>.9}),Ar=[lr,cr,or].find(function(br){return Math.abs(br.dot(dr[1]))>.9}),yr=[lr,cr,or].find(function(br){return Math.abs(br.dot(dr[2]))>.9});function wr(br,Sr){const xr=vr===or?ar:vr.arglet==="i"?br:Sr,Cr=Ar===or?ar:Ar.arglet==="i"?br:Sr,Ir=yr===or?ar:yr.arglet==="i"?br:Sr,Rr=vr.dot(dr[0])>0?xr:fr.xLength-1-xr,Pr=Ar.dot(dr[1])>0?Cr:fr.yLength-1-Cr,Fr=yr.dot(dr[2])>0?Ir:fr.zLength-1-Ir;return fr.access(Rr,Pr,Fr)}return{iLength:pr,jLength:gr,sliceAccess:wr,matrix:hr,planeWidth:_r,planeHeight:mr}}extractSlice(er,tr){const rr=new VolumeSlice(this,tr,er);return this.sliceList.push(rr),rr}repaintAllSlices(){return this.sliceList.forEach(function(er){er.repaint()}),this}computeMinMax(){let er=1/0,tr=-1/0;const rr=this.data.length;let nr=0;for(nr=0;nr<rr;nr++)if(!isNaN(this.data[nr])){const sr=this.data[nr];er=Math.min(er,sr),tr=Math.max(tr,sr)}return this.min=er,this.max=tr,[er,tr]}}class NRRDLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}setSegmentation(er){this.segmentation=er}parse(er){let tr=er,rr=0;const nr=new Int8Array(new Int16Array([1]).buffer)[0]>0,sr=!0,ar={};function or(xr,Cr){let Ir=1,Rr=Uint8Array;switch(xr){case"uchar":break;case"schar":Rr=Int8Array;break;case"ushort":Rr=Uint16Array,Ir=2;break;case"sshort":Rr=Int16Array,Ir=2;break;case"uint":Rr=Uint32Array,Ir=4;break;case"sint":Rr=Int32Array,Ir=4;break;case"float":Rr=Float32Array,Ir=4;break;case"complex":Rr=Float64Array,Ir=8;break;case"double":Rr=Float64Array,Ir=8;break}let Pr=new Rr(tr.slice(rr,rr+=Cr*Ir));return nr!=sr&&(Pr=lr(Pr,Ir)),Pr}function lr(xr,Cr){const Ir=new Uint8Array(xr.buffer,xr.byteOffset,xr.byteLength);for(let Rr=0;Rr<xr.byteLength;Rr+=Cr)for(let Pr=Rr+Cr-1,Fr=Rr;Pr>Fr;Pr--,Fr++){const Nr=Ir[Fr];Ir[Fr]=Ir[Pr],Ir[Pr]=Nr}return xr}function cr(xr){let Cr,Ir,Rr,Pr,Fr,Nr,Ur,Br;const Or=xr.split(/\r?\n/);for(Ur=0,Br=Or.length;Ur<Br;Ur++)Fr=Or[Ur],Fr.match(/NRRD\d+/)?ar.isNrrd=!0:!Fr.match(/^#/)&&(Nr=Fr.match(/(.*):(.*)/))&&(Ir=Nr[1].trim(),Cr=Nr[2].trim(),Rr=_fieldFunctions[Ir],Rr?Rr.call(ar,Cr):ar[Ir]=Cr);if(!ar.isNrrd)throw new Error("Not an NRRD file");if(ar.encoding==="bz2"||ar.encoding==="bzip2")throw new Error("Bzip is not supported");if(!ar.vectors&&(ar.vectors=[],ar.vectors.push([1,0,0]),ar.vectors.push([0,1,0]),ar.vectors.push([0,0,1]),ar.spacings)){for(Pr=0;Pr<=2;Pr++)if(!isNaN(ar.spacings[Pr]))for(let Dr=0;Dr<=2;Dr++)ar.vectors[Pr][Dr]*=ar.spacings[Pr]}}function hr(xr,Cr,Ir){let Rr="";Cr=Cr||0,Ir=Ir||xr.length;let Pr;const Fr=ar.sizes.reduce(function(Dr,Wr){return Dr*Wr},1);let Nr=10;ar.encoding==="hex"&&(Nr=16);const Ur=new ar.__array(Fr);let Br=0,Or=parseInt;(ar.__array===Float32Array||ar.__array===Float64Array)&&(Or=parseFloat);for(let Dr=Cr;Dr<Ir;Dr++)Pr=xr[Dr],(Pr<9||Pr>13)&&Pr!==32?Rr+=String.fromCharCode(Pr):(Rr!==""&&(Ur[Br]=Or(Rr,Nr),Br++),Rr="");return Rr!==""&&(Ur[Br]=Or(Rr,Nr),Br++),Ur}const fr=or("uchar",er.byteLength),ur=fr.length;let pr=null,gr=0,_r;for(_r=1;_r<ur;_r++)if(fr[_r-1]==10&&fr[_r]==10){pr=this.parseChars(fr,0,_r-2),gr=_r+1;break}if(cr(pr),tr=fr.subarray(gr),ar.encoding.substring(0,2)==="gz")tr=gunzipSync(new Uint8Array(tr));else if(ar.encoding==="ascii"||ar.encoding==="text"||ar.encoding==="txt"||ar.encoding==="hex")tr=hr(tr);else if(ar.encoding==="raw"){const xr=new Uint8Array(tr.length);for(let Cr=0;Cr<tr.length;Cr++)xr[Cr]=tr[Cr];tr=xr}tr=tr.buffer;const mr=new Volume;mr.header=ar,mr.segmentation=this.segmentation,mr.data=new ar.__array(tr);const dr=mr.computeMinMax(),vr=dr[0],Ar=dr[1];if(mr.windowLow=vr,mr.windowHigh=Ar,mr.dimensions=[ar.sizes[0],ar.sizes[1],ar.sizes[2]],mr.xLength=mr.dimensions[0],mr.yLength=mr.dimensions[1],mr.zLength=mr.dimensions[2],ar.vectors){const xr=ar.vectors.findIndex(Pr=>Pr[0]!==0),Cr=ar.vectors.findIndex(Pr=>Pr[1]!==0),Ir=ar.vectors.findIndex(Pr=>Pr[2]!==0),Rr=[];xr!==Cr&&xr!==Ir&&Cr!==Ir?(Rr[xr]="x",Rr[Cr]="y",Rr[Ir]="z"):(Rr[0]="x",Rr[1]="y",Rr[2]="z"),mr.axisOrder=Rr}else mr.axisOrder=["x","y","z"];const yr=new Vector3$1().fromArray(ar.vectors[0]).length(),wr=new Vector3$1().fromArray(ar.vectors[1]).length(),br=new Vector3$1().fromArray(ar.vectors[2]).length();mr.spacing=[yr,wr,br],mr.matrix=new Matrix4;const Sr=new Matrix4;if(ar.space==="left-posterior-superior"?Sr.set(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1):ar.space==="left-anterior-superior"&&Sr.set(1,0,0,0,0,1,0,0,0,0,-1,0,0,0,0,1),!ar.vectors)mr.matrix.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);else{const xr=ar.vectors,Cr=new Matrix4().set(xr[0][0],xr[1][0],xr[2][0],0,xr[0][1],xr[1][1],xr[2][1],0,xr[0][2],xr[1][2],xr[2][2],0,0,0,0,1),Ir=new Matrix4().multiplyMatrices(Cr,Sr);mr.matrix=Ir}return mr.inverseMatrix=new Matrix4,mr.inverseMatrix.copy(mr.matrix).invert(),mr.RASDimensions=[Math.floor(mr.xLength*yr),Math.floor(mr.yLength*wr),Math.floor(mr.zLength*br)],mr.lowerThreshold===-1/0&&(mr.lowerThreshold=vr),mr.upperThreshold===1/0&&(mr.upperThreshold=Ar),mr}parseChars(er,tr,rr){tr===void 0&&(tr=0),rr===void 0&&(rr=er.length);let nr="",sr=0;for(sr=tr;sr<rr;++sr)nr+=String.fromCharCode(er[sr]);return nr}}const _fieldFunctions={type:function(ir){switch(ir){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+ir)}return this.type=ir},endian:function(ir){return this.endian=ir},encoding:function(ir){return this.encoding=ir},dimension:function(ir){return this.dim=parseInt(ir,10)},sizes:function(ir){let er;return this.sizes=function(){const tr=ir.split(/\s+/),rr=[];for(let nr=0,sr=tr.length;nr<sr;nr++)er=tr[nr],rr.push(parseInt(er,10));return rr}()},space:function(ir){return this.space=ir},"space origin":function(ir){return this.space_origin=ir.split("(")[1].split(")")[0].split(",")},"space directions":function(ir){let er,tr;const rr=ir.match(/\(.*?\)/g);return this.vectors=function(){const nr=[];for(let sr=0,ar=rr.length;sr<ar;sr++)tr=rr[sr],nr.push(function(){const or=tr.slice(1,-1).split(/,/),lr=[];for(let cr=0,hr=or.length;cr<hr;cr++)er=or[cr],lr.push(parseFloat(er));return lr}());return nr}()},spacings:function(ir){let er;const tr=ir.split(/\s+/);return this.spacings=function(){const rr=[];for(let nr=0,sr=tr.length;nr<sr;nr++)er=tr[nr],rr.push(parseFloat(er));return rr}()}},_object_pattern=/^[og]\s*(.+)?/,_material_library_pattern=/^mtllib /,_material_use_pattern=/^usemtl /,_map_use_pattern=/^usemap /,_face_vertex_data_separator_pattern=/\s+/,_vA=new Vector3$1,_vB=new Vector3$1,_vC=new Vector3$1,_ab$1=new Vector3$1,_cb$1=new Vector3$1,_color$3=new Color;function ParserState(){const ir={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(er,tr){if(this.object&&this.object.fromDeclaration===!1){this.object.name=er,this.object.fromDeclaration=tr!==!1;return}const rr=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:er||"",fromDeclaration:tr!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(nr,sr){const ar=this._finalize(!1);ar&&(ar.inherited||ar.groupCount<=0)&&this.materials.splice(ar.index,1);const or={index:this.materials.length,name:nr||"",mtllib:Array.isArray(sr)&&sr.length>0?sr[sr.length-1]:"",smooth:ar!==void 0?ar.smooth:this.smooth,groupStart:ar!==void 0?ar.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(lr){const cr={index:typeof lr=="number"?lr:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return cr.clone=this.clone.bind(cr),cr}};return this.materials.push(or),or},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(nr){const sr=this.currentMaterial();if(sr&&sr.groupEnd===-1&&(sr.groupEnd=this.geometry.vertices.length/3,sr.groupCount=sr.groupEnd-sr.groupStart,sr.inherited=!1),nr&&this.materials.length>1)for(let ar=this.materials.length-1;ar>=0;ar--)this.materials[ar].groupCount<=0&&this.materials.splice(ar,1);return nr&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),sr}},rr&&rr.name&&typeof rr.clone=="function"){const nr=rr.clone(0);nr.inherited=!0,this.object.materials.push(nr)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(er,tr){const rr=parseInt(er,10);return(rr>=0?rr-1:rr+tr/3)*3},parseNormalIndex:function(er,tr){const rr=parseInt(er,10);return(rr>=0?rr-1:rr+tr/3)*3},parseUVIndex:function(er,tr){const rr=parseInt(er,10);return(rr>=0?rr-1:rr+tr/2)*2},addVertex:function(er,tr,rr){const nr=this.vertices,sr=this.object.geometry.vertices;sr.push(nr[er+0],nr[er+1],nr[er+2]),sr.push(nr[tr+0],nr[tr+1],nr[tr+2]),sr.push(nr[rr+0],nr[rr+1],nr[rr+2])},addVertexPoint:function(er){const tr=this.vertices;this.object.geometry.vertices.push(tr[er+0],tr[er+1],tr[er+2])},addVertexLine:function(er){const tr=this.vertices;this.object.geometry.vertices.push(tr[er+0],tr[er+1],tr[er+2])},addNormal:function(er,tr,rr){const nr=this.normals,sr=this.object.geometry.normals;sr.push(nr[er+0],nr[er+1],nr[er+2]),sr.push(nr[tr+0],nr[tr+1],nr[tr+2]),sr.push(nr[rr+0],nr[rr+1],nr[rr+2])},addFaceNormal:function(er,tr,rr){const nr=this.vertices,sr=this.object.geometry.normals;_vA.fromArray(nr,er),_vB.fromArray(nr,tr),_vC.fromArray(nr,rr),_cb$1.subVectors(_vC,_vB),_ab$1.subVectors(_vA,_vB),_cb$1.cross(_ab$1),_cb$1.normalize(),sr.push(_cb$1.x,_cb$1.y,_cb$1.z),sr.push(_cb$1.x,_cb$1.y,_cb$1.z),sr.push(_cb$1.x,_cb$1.y,_cb$1.z)},addColor:function(er,tr,rr){const nr=this.colors,sr=this.object.geometry.colors;nr[er]!==void 0&&sr.push(nr[er+0],nr[er+1],nr[er+2]),nr[tr]!==void 0&&sr.push(nr[tr+0],nr[tr+1],nr[tr+2]),nr[rr]!==void 0&&sr.push(nr[rr+0],nr[rr+1],nr[rr+2])},addUV:function(er,tr,rr){const nr=this.uvs,sr=this.object.geometry.uvs;sr.push(nr[er+0],nr[er+1]),sr.push(nr[tr+0],nr[tr+1]),sr.push(nr[rr+0],nr[rr+1])},addDefaultUV:function(){const er=this.object.geometry.uvs;er.push(0,0),er.push(0,0),er.push(0,0)},addUVLine:function(er){const tr=this.uvs;this.object.geometry.uvs.push(tr[er+0],tr[er+1])},addFace:function(er,tr,rr,nr,sr,ar,or,lr,cr){const hr=this.vertices.length;let fr=this.parseVertexIndex(er,hr),ur=this.parseVertexIndex(tr,hr),pr=this.parseVertexIndex(rr,hr);if(this.addVertex(fr,ur,pr),this.addColor(fr,ur,pr),or!==void 0&&or!==""){const gr=this.normals.length;fr=this.parseNormalIndex(or,gr),ur=this.parseNormalIndex(lr,gr),pr=this.parseNormalIndex(cr,gr),this.addNormal(fr,ur,pr)}else this.addFaceNormal(fr,ur,pr);if(nr!==void 0&&nr!==""){const gr=this.uvs.length;fr=this.parseUVIndex(nr,gr),ur=this.parseUVIndex(sr,gr),pr=this.parseUVIndex(ar,gr),this.addUV(fr,ur,pr),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(er){this.object.geometry.type="Points";const tr=this.vertices.length;for(let rr=0,nr=er.length;rr<nr;rr++){const sr=this.parseVertexIndex(er[rr],tr);this.addVertexPoint(sr),this.addColor(sr)}},addLineGeometry:function(er,tr){this.object.geometry.type="Line";const rr=this.vertices.length,nr=this.uvs.length;for(let sr=0,ar=er.length;sr<ar;sr++)this.addVertexLine(this.parseVertexIndex(er[sr],rr));for(let sr=0,ar=tr.length;sr<ar;sr++)this.addUVLine(this.parseUVIndex(tr[sr],nr))}};return ir.startObject("",!1),ir}class OBJLoader extends Loader{constructor(er){super(er),this.materials=null}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}setMaterials(er){return this.materials=er,this}parse(er){const tr=new ParserState;er.indexOf(`\r
`)!==-1&&(er=er.replace(/\r\n/g,`
`)),er.indexOf(`\\
`)!==-1&&(er=er.replace(/\\\n/g,""));const rr=er.split(`
`);let nr=[];for(let or=0,lr=rr.length;or<lr;or++){const cr=rr[or].trimStart();if(cr.length===0)continue;const hr=cr.charAt(0);if(hr!=="#")if(hr==="v"){const fr=cr.split(_face_vertex_data_separator_pattern);switch(fr[0]){case"v":tr.vertices.push(parseFloat(fr[1]),parseFloat(fr[2]),parseFloat(fr[3])),fr.length>=7?(_color$3.setRGB(parseFloat(fr[4]),parseFloat(fr[5]),parseFloat(fr[6]),SRGBColorSpace),tr.colors.push(_color$3.r,_color$3.g,_color$3.b)):tr.colors.push(void 0,void 0,void 0);break;case"vn":tr.normals.push(parseFloat(fr[1]),parseFloat(fr[2]),parseFloat(fr[3]));break;case"vt":tr.uvs.push(parseFloat(fr[1]),parseFloat(fr[2]));break}}else if(hr==="f"){const ur=cr.slice(1).trim().split(_face_vertex_data_separator_pattern),pr=[];for(let _r=0,mr=ur.length;_r<mr;_r++){const dr=ur[_r];if(dr.length>0){const vr=dr.split("/");pr.push(vr)}}const gr=pr[0];for(let _r=1,mr=pr.length-1;_r<mr;_r++){const dr=pr[_r],vr=pr[_r+1];tr.addFace(gr[0],dr[0],vr[0],gr[1],dr[1],vr[1],gr[2],dr[2],vr[2])}}else if(hr==="l"){const fr=cr.substring(1).trim().split(" ");let ur=[];const pr=[];if(cr.indexOf("/")===-1)ur=fr;else for(let gr=0,_r=fr.length;gr<_r;gr++){const mr=fr[gr].split("/");mr[0]!==""&&ur.push(mr[0]),mr[1]!==""&&pr.push(mr[1])}tr.addLineGeometry(ur,pr)}else if(hr==="p"){const ur=cr.slice(1).trim().split(" ");tr.addPointGeometry(ur)}else if((nr=_object_pattern.exec(cr))!==null){const fr=(" "+nr[0].slice(1).trim()).slice(1);tr.startObject(fr)}else if(_material_use_pattern.test(cr))tr.object.startMaterial(cr.substring(7).trim(),tr.materialLibraries);else if(_material_library_pattern.test(cr))tr.materialLibraries.push(cr.substring(7).trim());else if(_map_use_pattern.test(cr))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(hr==="s"){if(nr=cr.split(" "),nr.length>1){const ur=nr[1].trim().toLowerCase();tr.object.smooth=ur!=="0"&&ur!=="off"}else tr.object.smooth=!0;const fr=tr.object.currentMaterial();fr&&(fr.smooth=tr.object.smooth)}else{if(cr==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+cr+'"')}}tr.finalize();const sr=new Group;if(sr.materialLibraries=[].concat(tr.materialLibraries),!(tr.objects.length===1&&tr.objects[0].geometry.vertices.length===0)===!0)for(let or=0,lr=tr.objects.length;or<lr;or++){const cr=tr.objects[or],hr=cr.geometry,fr=cr.materials,ur=hr.type==="Line",pr=hr.type==="Points";let gr=!1;if(hr.vertices.length===0)continue;const _r=new BufferGeometry;_r.setAttribute("position",new Float32BufferAttribute(hr.vertices,3)),hr.normals.length>0&&_r.setAttribute("normal",new Float32BufferAttribute(hr.normals,3)),hr.colors.length>0&&(gr=!0,_r.setAttribute("color",new Float32BufferAttribute(hr.colors,3))),hr.hasUVIndices===!0&&_r.setAttribute("uv",new Float32BufferAttribute(hr.uvs,2));const mr=[];for(let vr=0,Ar=fr.length;vr<Ar;vr++){const yr=fr[vr],wr=yr.name+"_"+yr.smooth+"_"+gr;let br=tr.materials[wr];if(this.materials!==null){if(br=this.materials.create(yr.name),ur&&br&&!(br instanceof LineBasicMaterial)){const Sr=new LineBasicMaterial;Material.prototype.copy.call(Sr,br),Sr.color.copy(br.color),br=Sr}else if(pr&&br&&!(br instanceof PointsMaterial)){const Sr=new PointsMaterial({size:10,sizeAttenuation:!1});Material.prototype.copy.call(Sr,br),Sr.color.copy(br.color),Sr.map=br.map,br=Sr}}br===void 0&&(ur?br=new LineBasicMaterial:pr?br=new PointsMaterial({size:1,sizeAttenuation:!1}):br=new MeshPhongMaterial,br.name=yr.name,br.flatShading=!yr.smooth,br.vertexColors=gr,tr.materials[wr]=br),mr.push(br)}let dr;if(mr.length>1){for(let vr=0,Ar=fr.length;vr<Ar;vr++){const yr=fr[vr];_r.addGroup(yr.groupStart,yr.groupCount,vr)}ur?dr=new LineSegments(_r,mr):pr?dr=new Points(_r,mr):dr=new Mesh(_r,mr)}else ur?dr=new LineSegments(_r,mr[0]):pr?dr=new Points(_r,mr[0]):dr=new Mesh(_r,mr[0]);dr.name=cr.name,sr.add(dr)}else if(tr.vertices.length>0){const or=new PointsMaterial({size:1,sizeAttenuation:!1}),lr=new BufferGeometry;lr.setAttribute("position",new Float32BufferAttribute(tr.vertices,3)),tr.colors.length>0&&tr.colors[0]!==void 0&&(lr.setAttribute("color",new Float32BufferAttribute(tr.colors,3)),or.vertexColors=!0);const cr=new Points(lr,or);sr.add(cr)}return sr}}class PCDLoader extends Loader{constructor(er){super(er),this.littleEndian=!0}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){function tr(gr,_r){const mr=gr.length,dr=new Uint8Array(_r);let vr=0,Ar=0,yr,wr,br;do if(yr=gr[vr++],yr<32){if(yr++,Ar+yr>_r)throw new Error("Output buffer is not large enough");if(vr+yr>mr)throw new Error("Invalid compressed data");do dr[Ar++]=gr[vr++];while(--yr)}else{if(wr=yr>>5,br=Ar-((yr&31)<<8)-1,vr>=mr)throw new Error("Invalid compressed data");if(wr===7&&(wr+=gr[vr++],vr>=mr))throw new Error("Invalid compressed data");if(br-=gr[vr++],Ar+wr+2>_r)throw new Error("Output buffer is not large enough");if(br<0)throw new Error("Invalid compressed data");if(br>=Ar)throw new Error("Invalid compressed data");do dr[Ar++]=dr[br++];while(--wr+2)}while(vr<mr);return dr}function rr(gr){const _r={},mr=gr.search(/[\r\n]DATA\s(\S*)\s/i),dr=/[\r\n]DATA\s(\S*)\s/i.exec(gr.slice(mr-1));if(_r.data=dr[1],_r.headerLen=dr[0].length+mr,_r.str=gr.slice(0,_r.headerLen),_r.str=_r.str.replace(/#.*/gi,""),_r.version=/^VERSION (.*)/im.exec(_r.str),_r.fields=/^FIELDS (.*)/im.exec(_r.str),_r.size=/^SIZE (.*)/im.exec(_r.str),_r.type=/^TYPE (.*)/im.exec(_r.str),_r.count=/^COUNT (.*)/im.exec(_r.str),_r.width=/^WIDTH (.*)/im.exec(_r.str),_r.height=/^HEIGHT (.*)/im.exec(_r.str),_r.viewpoint=/^VIEWPOINT (.*)/im.exec(_r.str),_r.points=/^POINTS (.*)/im.exec(_r.str),_r.version!==null&&(_r.version=parseFloat(_r.version[1])),_r.fields=_r.fields!==null?_r.fields[1].split(" "):[],_r.type!==null&&(_r.type=_r.type[1].split(" ")),_r.width!==null&&(_r.width=parseInt(_r.width[1])),_r.height!==null&&(_r.height=parseInt(_r.height[1])),_r.viewpoint!==null&&(_r.viewpoint=_r.viewpoint[1]),_r.points!==null&&(_r.points=parseInt(_r.points[1],10)),_r.points===null&&(_r.points=_r.width*_r.height),_r.size!==null&&(_r.size=_r.size[1].split(" ").map(function(Ar){return parseInt(Ar,10)})),_r.count!==null)_r.count=_r.count[1].split(" ").map(function(Ar){return parseInt(Ar,10)});else{_r.count=[];for(let Ar=0,yr=_r.fields.length;Ar<yr;Ar++)_r.count.push(1)}_r.offset={};let vr=0;for(let Ar=0,yr=_r.fields.length;Ar<yr;Ar++)_r.data==="ascii"?_r.offset[_r.fields[Ar]]=Ar:(_r.offset[_r.fields[Ar]]=vr,vr+=_r.size[Ar]*_r.count[Ar]);return _r.rowSize=vr,_r}const nr=new TextDecoder().decode(er),sr=rr(nr),ar=[],or=[],lr=[],cr=[],hr=[],fr=new Color;if(sr.data==="ascii"){const gr=sr.offset,mr=nr.slice(sr.headerLen).split(`
`);for(let dr=0,vr=mr.length;dr<vr;dr++){if(mr[dr]==="")continue;const Ar=mr[dr].split(" ");if(gr.x!==void 0&&(ar.push(parseFloat(Ar[gr.x])),ar.push(parseFloat(Ar[gr.y])),ar.push(parseFloat(Ar[gr.z]))),gr.rgb!==void 0){const yr=sr.fields.findIndex(Rr=>Rr==="rgb"),wr=sr.type[yr],br=parseFloat(Ar[gr.rgb]);let Sr=br;if(wr==="F"){const Rr=new Float32Array(1);Rr[0]=br,Sr=new Int32Array(Rr.buffer)[0]}const xr=(Sr>>16&255)/255,Cr=(Sr>>8&255)/255,Ir=(Sr>>0&255)/255;fr.setRGB(xr,Cr,Ir,SRGBColorSpace),lr.push(fr.r,fr.g,fr.b)}gr.normal_x!==void 0&&(or.push(parseFloat(Ar[gr.normal_x])),or.push(parseFloat(Ar[gr.normal_y])),or.push(parseFloat(Ar[gr.normal_z]))),gr.intensity!==void 0&&cr.push(parseFloat(Ar[gr.intensity])),gr.label!==void 0&&hr.push(parseInt(Ar[gr.label]))}}if(sr.data==="binary_compressed"){const gr=new Uint32Array(er.slice(sr.headerLen,sr.headerLen+8)),_r=gr[0],mr=gr[1],dr=tr(new Uint8Array(er,sr.headerLen+8,_r),mr),vr=new DataView(dr.buffer),Ar=sr.offset;for(let yr=0;yr<sr.points;yr++){if(Ar.x!==void 0){const wr=sr.fields.indexOf("x"),br=sr.fields.indexOf("y"),Sr=sr.fields.indexOf("z");ar.push(vr.getFloat32(sr.points*Ar.x+sr.size[wr]*yr,this.littleEndian)),ar.push(vr.getFloat32(sr.points*Ar.y+sr.size[br]*yr,this.littleEndian)),ar.push(vr.getFloat32(sr.points*Ar.z+sr.size[Sr]*yr,this.littleEndian))}if(Ar.rgb!==void 0){const wr=sr.fields.indexOf("rgb"),br=vr.getUint8(sr.points*Ar.rgb+sr.size[wr]*yr+2)/255,Sr=vr.getUint8(sr.points*Ar.rgb+sr.size[wr]*yr+1)/255,xr=vr.getUint8(sr.points*Ar.rgb+sr.size[wr]*yr+0)/255;fr.setRGB(br,Sr,xr,SRGBColorSpace),lr.push(fr.r,fr.g,fr.b)}if(Ar.normal_x!==void 0){const wr=sr.fields.indexOf("normal_x"),br=sr.fields.indexOf("normal_y"),Sr=sr.fields.indexOf("normal_z");or.push(vr.getFloat32(sr.points*Ar.normal_x+sr.size[wr]*yr,this.littleEndian)),or.push(vr.getFloat32(sr.points*Ar.normal_y+sr.size[br]*yr,this.littleEndian)),or.push(vr.getFloat32(sr.points*Ar.normal_z+sr.size[Sr]*yr,this.littleEndian))}if(Ar.intensity!==void 0){const wr=sr.fields.indexOf("intensity");cr.push(vr.getFloat32(sr.points*Ar.intensity+sr.size[wr]*yr,this.littleEndian))}if(Ar.label!==void 0){const wr=sr.fields.indexOf("label");hr.push(vr.getInt32(sr.points*Ar.label+sr.size[wr]*yr,this.littleEndian))}}}if(sr.data==="binary"){const gr=new DataView(er,sr.headerLen),_r=sr.offset;for(let mr=0,dr=0;mr<sr.points;mr++,dr+=sr.rowSize){if(_r.x!==void 0&&(ar.push(gr.getFloat32(dr+_r.x,this.littleEndian)),ar.push(gr.getFloat32(dr+_r.y,this.littleEndian)),ar.push(gr.getFloat32(dr+_r.z,this.littleEndian))),_r.rgb!==void 0){const vr=gr.getUint8(dr+_r.rgb+2)/255,Ar=gr.getUint8(dr+_r.rgb+1)/255,yr=gr.getUint8(dr+_r.rgb+0)/255;fr.setRGB(vr,Ar,yr,SRGBColorSpace),lr.push(fr.r,fr.g,fr.b)}_r.normal_x!==void 0&&(or.push(gr.getFloat32(dr+_r.normal_x,this.littleEndian)),or.push(gr.getFloat32(dr+_r.normal_y,this.littleEndian)),or.push(gr.getFloat32(dr+_r.normal_z,this.littleEndian))),_r.intensity!==void 0&&cr.push(gr.getFloat32(dr+_r.intensity,this.littleEndian)),_r.label!==void 0&&hr.push(gr.getInt32(dr+_r.label,this.littleEndian))}}const ur=new BufferGeometry;ar.length>0&&ur.setAttribute("position",new Float32BufferAttribute(ar,3)),or.length>0&&ur.setAttribute("normal",new Float32BufferAttribute(or,3)),lr.length>0&&ur.setAttribute("color",new Float32BufferAttribute(lr,3)),cr.length>0&&ur.setAttribute("intensity",new Float32BufferAttribute(cr,1)),hr.length>0&&ur.setAttribute("label",new Int32BufferAttribute(hr,1)),ur.computeBoundingSphere();const pr=new PointsMaterial({size:.005});return lr.length>0&&(pr.vertexColors=!0),new Points(ur,pr)}}class PDBLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){function tr(pr){return pr.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function rr(pr){return pr.charAt(0).toUpperCase()+pr.slice(1).toLowerCase()}function nr(pr,gr){return"s"+Math.min(pr,gr)+"e"+Math.max(pr,gr)}function sr(pr,gr,_r,mr){const dr=parseInt(ur[mr].slice(pr,pr+gr));if(dr){const vr=nr(_r,dr);hr[vr]===void 0&&(cr.push([_r-1,dr-1,1]),hr[vr]=cr.length-1)}}function ar(){const pr={geometryAtoms:new BufferGeometry,geometryBonds:new BufferGeometry,json:{atoms:lr}},gr=pr.geometryAtoms,_r=pr.geometryBonds,mr=[],dr=[],vr=[],Ar=new Color;for(let yr=0,wr=lr.length;yr<wr;yr++){const br=lr[yr],Sr=br[0],xr=br[1],Cr=br[2];mr.push(Sr,xr,Cr);const Ir=br[3][0]/255,Rr=br[3][1]/255,Pr=br[3][2]/255;Ar.setRGB(Ir,Rr,Pr,SRGBColorSpace),dr.push(Ar.r,Ar.g,Ar.b)}for(let yr=0,wr=cr.length;yr<wr;yr++){const br=cr[yr],Sr=br[0],xr=br[1],Cr=fr[Sr],Ir=fr[xr];let Rr=Cr[0],Pr=Cr[1],Fr=Cr[2];vr.push(Rr,Pr,Fr),Rr=Ir[0],Pr=Ir[1],Fr=Ir[2],vr.push(Rr,Pr,Fr)}return gr.setAttribute("position",new Float32BufferAttribute(mr,3)),gr.setAttribute("color",new Float32BufferAttribute(dr,3)),_r.setAttribute("position",new Float32BufferAttribute(vr,3)),pr}const or={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},lr=[],cr=[],hr={},fr={},ur=er.split(`
`);for(let pr=0,gr=ur.length;pr<gr;pr++)if(ur[pr].slice(0,4)==="ATOM"||ur[pr].slice(0,6)==="HETATM"){const _r=parseFloat(ur[pr].slice(30,37)),mr=parseFloat(ur[pr].slice(38,45)),dr=parseFloat(ur[pr].slice(46,53)),vr=parseInt(ur[pr].slice(6,11))-1;let Ar=tr(ur[pr].slice(76,78)).toLowerCase();Ar===""&&(Ar=tr(ur[pr].slice(12,14)).toLowerCase());const yr=[_r,mr,dr,or[Ar],rr(Ar)];lr.push(yr),fr[vr]=yr}else if(ur[pr].slice(0,6)==="CONECT"){const _r=parseInt(ur[pr].slice(6,11));sr(11,5,_r,pr),sr(16,5,_r,pr),sr(21,5,_r,pr),sr(26,5,_r,pr)}return ar()}}const _color$2=new Color;class PLYLoader extends Loader{constructor(er){super(er),this.propertyNameMapping={},this.customPropertyMapping={}}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}setPropertyNameMapping(er){this.propertyNameMapping=er}setCustomPropertyNameMapping(er){this.customPropertyMapping=er}parse(er){function tr(mr,dr=0){const vr=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let Ar="";const yr=vr.exec(mr);yr!==null&&(Ar=yr[1]);const wr={comments:[],elements:[],headerLength:dr,objInfo:""},br=Ar.split(/\r\n|\r|\n/);let Sr;function xr(Cr,Ir){const Rr={type:Cr[0]};return Rr.type==="list"?(Rr.name=Cr[3],Rr.countType=Cr[1],Rr.itemType=Cr[2]):Rr.name=Cr[1],Rr.name in Ir&&(Rr.name=Ir[Rr.name]),Rr}for(let Cr=0;Cr<br.length;Cr++){let Ir=br[Cr];if(Ir=Ir.trim(),Ir==="")continue;const Rr=Ir.split(/\s+/),Pr=Rr.shift();switch(Ir=Rr.join(" "),Pr){case"format":wr.format=Rr[0],wr.version=Rr[1];break;case"comment":wr.comments.push(Ir);break;case"element":Sr!==void 0&&wr.elements.push(Sr),Sr={},Sr.name=Rr[0],Sr.count=parseInt(Rr[1]),Sr.properties=[];break;case"property":Sr.properties.push(xr(Rr,_r.propertyNameMapping));break;case"obj_info":wr.objInfo=Ir;break;default:console.log("unhandled",Pr,Rr)}}return Sr!==void 0&&wr.elements.push(Sr),wr}function rr(mr,dr){switch(dr){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(mr);case"float":case"double":case"float32":case"float64":return parseFloat(mr)}}function nr(mr,dr){const vr={};for(let Ar=0;Ar<mr.length;Ar++){if(dr.empty())return null;if(mr[Ar].type==="list"){const yr=[],wr=rr(dr.next(),mr[Ar].countType);for(let br=0;br<wr;br++){if(dr.empty())return null;yr.push(rr(dr.next(),mr[Ar].itemType))}vr[mr[Ar].name]=yr}else vr[mr[Ar].name]=rr(dr.next(),mr[Ar].type)}return vr}function sr(){const mr={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const dr of Object.keys(_r.customPropertyMapping))mr[dr]=[];return mr}function ar(mr){const dr=mr.map(Ar=>Ar.name);function vr(Ar){for(let yr=0,wr=Ar.length;yr<wr;yr++){const br=Ar[yr];if(dr.includes(br))return br}return null}return{attrX:vr(["x","px","posx"])||"x",attrY:vr(["y","py","posy"])||"y",attrZ:vr(["z","pz","posz"])||"z",attrNX:vr(["nx","normalx"]),attrNY:vr(["ny","normaly"]),attrNZ:vr(["nz","normalz"]),attrS:vr(["s","u","texture_u","tx"]),attrT:vr(["t","v","texture_v","ty"]),attrR:vr(["red","diffuse_red","r","diffuse_r"]),attrG:vr(["green","diffuse_green","g","diffuse_g"]),attrB:vr(["blue","diffuse_blue","b","diffuse_b"])}}function or(mr,dr){const vr=sr(),Ar=/end_header\s+(\S[\s\S]*\S|\S)\s*$/;let yr,wr;(wr=Ar.exec(mr))!==null?yr=wr[1].split(/\s+/):yr=[];const br=new ArrayStream(yr);e:for(let Sr=0;Sr<dr.elements.length;Sr++){const xr=dr.elements[Sr],Cr=ar(xr.properties);for(let Ir=0;Ir<xr.count;Ir++){const Rr=nr(xr.properties,br);if(!Rr)break e;cr(vr,xr.name,Rr,Cr)}}return lr(vr)}function lr(mr){let dr=new BufferGeometry;mr.indices.length>0&&dr.setIndex(mr.indices),dr.setAttribute("position",new Float32BufferAttribute(mr.vertices,3)),mr.normals.length>0&&dr.setAttribute("normal",new Float32BufferAttribute(mr.normals,3)),mr.uvs.length>0&&dr.setAttribute("uv",new Float32BufferAttribute(mr.uvs,2)),mr.colors.length>0&&dr.setAttribute("color",new Float32BufferAttribute(mr.colors,3)),(mr.faceVertexUvs.length>0||mr.faceVertexColors.length>0)&&(dr=dr.toNonIndexed(),mr.faceVertexUvs.length>0&&dr.setAttribute("uv",new Float32BufferAttribute(mr.faceVertexUvs,2)),mr.faceVertexColors.length>0&&dr.setAttribute("color",new Float32BufferAttribute(mr.faceVertexColors,3)));for(const vr of Object.keys(_r.customPropertyMapping))mr[vr].length>0&&dr.setAttribute(vr,new Float32BufferAttribute(mr[vr],_r.customPropertyMapping[vr].length));return dr.computeBoundingSphere(),dr}function cr(mr,dr,vr,Ar){if(dr==="vertex"){mr.vertices.push(vr[Ar.attrX],vr[Ar.attrY],vr[Ar.attrZ]),Ar.attrNX!==null&&Ar.attrNY!==null&&Ar.attrNZ!==null&&mr.normals.push(vr[Ar.attrNX],vr[Ar.attrNY],vr[Ar.attrNZ]),Ar.attrS!==null&&Ar.attrT!==null&&mr.uvs.push(vr[Ar.attrS],vr[Ar.attrT]),Ar.attrR!==null&&Ar.attrG!==null&&Ar.attrB!==null&&(_color$2.setRGB(vr[Ar.attrR]/255,vr[Ar.attrG]/255,vr[Ar.attrB]/255,SRGBColorSpace),mr.colors.push(_color$2.r,_color$2.g,_color$2.b));for(const yr of Object.keys(_r.customPropertyMapping))for(const wr of _r.customPropertyMapping[yr])mr[yr].push(vr[wr])}else if(dr==="face"){const yr=vr.vertex_indices||vr.vertex_index,wr=vr.texcoord;yr.length===3?(mr.indices.push(yr[0],yr[1],yr[2]),wr&&wr.length===6&&(mr.faceVertexUvs.push(wr[0],wr[1]),mr.faceVertexUvs.push(wr[2],wr[3]),mr.faceVertexUvs.push(wr[4],wr[5]))):yr.length===4&&(mr.indices.push(yr[0],yr[1],yr[3]),mr.indices.push(yr[1],yr[2],yr[3])),Ar.attrR!==null&&Ar.attrG!==null&&Ar.attrB!==null&&(_color$2.setRGB(vr[Ar.attrR]/255,vr[Ar.attrG]/255,vr[Ar.attrB]/255,SRGBColorSpace),mr.faceVertexColors.push(_color$2.r,_color$2.g,_color$2.b),mr.faceVertexColors.push(_color$2.r,_color$2.g,_color$2.b),mr.faceVertexColors.push(_color$2.r,_color$2.g,_color$2.b))}}function hr(mr,dr){const vr={};let Ar=0;for(let yr=0;yr<dr.length;yr++){const wr=dr[yr],br=wr.valueReader;if(wr.type==="list"){const Sr=[],xr=wr.countReader.read(mr+Ar);Ar+=wr.countReader.size;for(let Cr=0;Cr<xr;Cr++)Sr.push(br.read(mr+Ar)),Ar+=br.size;vr[wr.name]=Sr}else vr[wr.name]=br.read(mr+Ar),Ar+=br.size}return[vr,Ar]}function fr(mr,dr,vr){function Ar(yr,wr,br){switch(wr){case"int8":case"char":return{read:Sr=>yr.getInt8(Sr),size:1};case"uint8":case"uchar":return{read:Sr=>yr.getUint8(Sr),size:1};case"int16":case"short":return{read:Sr=>yr.getInt16(Sr,br),size:2};case"uint16":case"ushort":return{read:Sr=>yr.getUint16(Sr,br),size:2};case"int32":case"int":return{read:Sr=>yr.getInt32(Sr,br),size:4};case"uint32":case"uint":return{read:Sr=>yr.getUint32(Sr,br),size:4};case"float32":case"float":return{read:Sr=>yr.getFloat32(Sr,br),size:4};case"float64":case"double":return{read:Sr=>yr.getFloat64(Sr,br),size:8}}}for(let yr=0,wr=mr.length;yr<wr;yr++){const br=mr[yr];br.type==="list"?(br.countReader=Ar(dr,br.countType,vr),br.valueReader=Ar(dr,br.itemType,vr)):br.valueReader=Ar(dr,br.type,vr)}}function ur(mr,dr){const vr=sr(),Ar=dr.format==="binary_little_endian",yr=new DataView(mr,dr.headerLength);let wr,br=0;for(let Sr=0;Sr<dr.elements.length;Sr++){const xr=dr.elements[Sr],Cr=xr.properties,Ir=ar(Cr);fr(Cr,yr,Ar);for(let Rr=0;Rr<xr.count;Rr++){wr=hr(br,Cr),br+=wr[1];const Pr=wr[0];cr(vr,xr.name,Pr,Ir)}}return lr(vr)}function pr(mr){let dr=0,vr=!0,Ar="";const yr=[],wr=new TextDecoder().decode(mr.subarray(0,5)),br=/^ply\r\n/.test(wr);do{const Sr=String.fromCharCode(mr[dr++]);Sr!==`
`&&Sr!=="\r"?Ar+=Sr:(Ar==="end_header"&&(vr=!1),Ar!==""&&(yr.push(Ar),Ar=""))}while(vr&&dr<mr.length);return br===!0&&dr++,{headerText:yr.join("\r")+"\r",headerLength:dr}}let gr;const _r=this;if(er instanceof ArrayBuffer){const mr=new Uint8Array(er),{headerText:dr,headerLength:vr}=pr(mr),Ar=tr(dr,vr);if(Ar.format==="ascii"){const yr=new TextDecoder().decode(mr);gr=or(yr,Ar)}else gr=ur(er,Ar)}else gr=or(er,tr(er));return gr}}class ArrayStream{constructor(er){this.arr=er,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}class PVRLoader extends CompressedTextureLoader{constructor(er){super(er)}parse(er,tr){const nr=new Uint32Array(er,0,13),sr={buffer:er,header:nr,loadMipmaps:tr};if(nr[0]===55727696)return _parseV3(sr);if(nr[11]===559044176)return _parseV2(sr);console.error("THREE.PVRLoader: Unknown PVR format.")}}function _parseV3(ir){const er=ir.header;let tr,rr;const nr=er[12],sr=er[2],ar=er[6],or=er[7],lr=er[10],cr=er[11];switch(sr){case 0:tr=2,rr=RGB_PVRTC_2BPPV1_Format;break;case 1:tr=2,rr=RGBA_PVRTC_2BPPV1_Format;break;case 2:tr=4,rr=RGB_PVRTC_4BPPV1_Format;break;case 3:tr=4,rr=RGBA_PVRTC_4BPPV1_Format;break;default:console.error("THREE.PVRLoader: Unsupported PVR format:",sr)}return ir.dataPtr=52+nr,ir.bpp=tr,ir.format=rr,ir.width=or,ir.height=ar,ir.numSurfaces=lr,ir.numMipmaps=cr,ir.isCubemap=lr===6,_extract(ir)}function _parseV2(ir){const er=ir.header,tr=er[0],rr=er[1],nr=er[2],sr=er[3],ar=er[4],or=er[10],lr=er[12],cr=255,hr=24,fr=25,ur=ar&cr;let pr,gr;const _r=or>0;return ur===fr?(gr=_r?RGBA_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,pr=4):ur===hr?(gr=_r?RGBA_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,pr=2):console.error("THREE.PVRLoader: Unknown PVR format:",ur),ir.dataPtr=tr,ir.bpp=pr,ir.format=gr,ir.width=nr,ir.height=rr,ir.numSurfaces=lr,ir.numMipmaps=sr+1,ir.isCubemap=lr===6,_extract(ir)}function _extract(ir){const er={mipmaps:[],width:ir.width,height:ir.height,format:ir.format,mipmapCount:ir.numMipmaps,isCubemap:ir.isCubemap},tr=ir.buffer;let rr=ir.dataPtr,nr=0,sr=0,ar=0,or=0,lr=0,cr=0;const hr=ir.bpp,fr=ir.numSurfaces;hr===2?(ar=8,or=4):(ar=4,or=4),sr=ar*or*hr/8,er.mipmaps.length=ir.numMipmaps*fr;let ur=0;for(;ur<ir.numMipmaps;){const pr=ir.width>>ur,gr=ir.height>>ur;lr=pr/ar,cr=gr/or,lr<2&&(lr=2),cr<2&&(cr=2),nr=lr*cr*sr;for(let _r=0;_r<fr;_r++){const dr={data:new Uint8Array(tr,rr,nr),width:pr,height:gr};er.mipmaps[_r*ir.numMipmaps+ur]=dr,rr+=nr}ur++}return er}const SRGB_TO_LINEAR=Array(1024).fill(0).map((ir,er)=>Math.pow(er/255*.9478672986+.0521327014,2.4));class UltraHDRLoader extends Loader{constructor(er){super(er),this.type=HalfFloatType}setDataType(er){return this.type=er,this}parse(er,tr){const rr={version:null,baseRenditionIsHDR:null,gainMapMin:null,gainMapMax:null,gamma:null,offsetSDR:null,offsetHDR:null,hdrCapacityMin:null,hdrCapacityMax:null},nr=new TextDecoder,sr=new DataView(er);let ar=0;const or=[];for(;ar<sr.byteLength;){const hr=sr.getUint8(ar);if(hr===255){const fr=sr.getUint8(ar+1);[216,224,225,226].includes(fr)?(or.push({sectionType:fr,section:[hr,fr],sectionOffset:ar+2}),ar+=2):(or[or.length-1].section.push(hr,fr),ar+=2)}else or[or.length-1].section.push(hr),ar++}let lr,cr;for(let hr=0;hr<or.length;hr++){const{sectionType:fr,section:ur,sectionOffset:pr}=or[hr];if(fr!==224){if(fr===225)this._parseXMPMetadata(nr.decode(new Uint8Array(ur)),rr);else if(fr===226){const gr=new DataView(new Uint8Array(ur.slice(2)).buffer);if(gr.getUint32(2,!1)===1297106432){const mr=gr.getUint32(6)===1229531648,dr=60,vr=gr.getUint32(dr,mr),Ar=gr.getUint32(dr+4,mr),yr=gr.getUint32(dr+16,mr),wr=gr.getUint32(dr+20,mr)+pr+6;lr=new Uint8Array(sr.buffer,Ar,vr),cr=new Uint8Array(sr.buffer,wr,yr)}}}}if(!rr.version)throw new Error("THREE.UltraHDRLoader: Not a valid UltraHDR image");if(lr&&cr)this._applyGainmapToSDR(rr,lr,cr,(hr,fr,ur)=>{tr({width:fr,height:ur,data:hr,format:RGBAFormat,type:this.type})},hr=>{throw new Error(hr)});else throw new Error("THREE.UltraHDRLoader: Could not parse UltraHDR images")}load(er,tr,rr,nr){const sr=new DataTexture(this.type===HalfFloatType?new Uint16Array:new Float32Array,0,0,RGBAFormat,this.type,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,LinearMipMapLinearFilter,1,LinearSRGBColorSpace);sr.generateMipmaps=!0,sr.flipY=!0;const ar=new FileLoader(this.manager);return ar.setResponseType("arraybuffer"),ar.setRequestHeader(this.requestHeader),ar.setPath(this.path),ar.setWithCredentials(this.withCredentials),ar.load(er,or=>{try{this.parse(or,lr=>{sr.image={data:lr.data,width:lr.width,height:lr.height},sr.needsUpdate=!0,tr&&tr(sr,lr)})}catch(lr){nr&&nr(lr),console.error(lr)}},rr,nr),sr}_parseXMPMetadata(er,tr){const nr=new DOMParser().parseFromString(er.substring(er.indexOf("<"),er.lastIndexOf(">")+1),"text/xml"),[sr]=nr.getElementsByTagName("Container:Directory");if(!sr){const[ar]=nr.getElementsByTagName("rdf:Description");tr.version=ar.getAttribute("hdrgm:Version"),tr.baseRenditionIsHDR=ar.getAttribute("hdrgm:BaseRenditionIsHDR")==="True",tr.gainMapMin=parseFloat(ar.getAttribute("hdrgm:GainMapMin")||0),tr.gainMapMax=parseFloat(ar.getAttribute("hdrgm:GainMapMax")||1),tr.gamma=parseFloat(ar.getAttribute("hdrgm:Gamma")||1),tr.offsetSDR=parseFloat(ar.getAttribute("hdrgm:OffsetSDR")/(1/64)),tr.offsetHDR=parseFloat(ar.getAttribute("hdrgm:OffsetHDR")/(1/64)),tr.hdrCapacityMin=parseFloat(ar.getAttribute("hdrgm:HDRCapacityMin")||0),tr.hdrCapacityMax=parseFloat(ar.getAttribute("hdrgm:HDRCapacityMax")||1)}}_srgbToLinear(er){return er/255<.04045?er/255*.0773993808:er<1024?SRGB_TO_LINEAR[~~er]:Math.pow(er/255*.9478672986+.0521327014,2.4)}_applyGainmapToSDR(er,tr,rr,nr,sr){const ar=or=>new Promise((lr,cr)=>{const hr=document.createElement("img");hr.onload=()=>{const fr={width:hr.naturalWidth,height:hr.naturalHeight,source:hr};URL.revokeObjectURL(hr.src),lr(fr)},hr.onerror=()=>{URL.revokeObjectURL(hr.src),cr()},hr.src=URL.createObjectURL(new Blob([or],{type:"image/jpeg"}))});Promise.all([ar(tr),ar(rr)]).then(([or,lr])=>{const cr=or.width/or.height,hr=lr.width/lr.height;if(cr!==hr){sr("THREE.UltraHDRLoader Error: Aspect ratio mismatch between SDR and Gainmap images");return}const fr=document.createElement("canvas"),ur=fr.getContext("2d",{willReadFrequently:!0,colorSpace:"srgb"});fr.width=or.width,fr.height=or.height,ur.drawImage(lr.source,0,0,lr.width,lr.height,0,0,or.width,or.height);const pr=ur.getImageData(0,0,or.width,or.height,{colorSpace:"srgb"});ur.drawImage(or.source,0,0);const gr=ur.getImageData(0,0,or.width,or.height,{colorSpace:"srgb"});let _r;this.type===HalfFloatType?_r=new Uint16Array(gr.data.length).fill(23544):_r=new Float32Array(gr.data.length).fill(255);const mr=Math.sqrt(Math.pow(1.8,er.hdrCapacityMax)),dr=(Math.log2(mr)-er.hdrCapacityMin)/(er.hdrCapacityMax-er.hdrCapacityMin),vr=Math.min(Math.max(dr,0),1),Ar=er.gamma===1;for(let yr=0;yr<gr.data.length;yr+=4){const wr=yr/4%or.width,br=Math.floor(yr/4/or.width);for(let Sr=0;Sr<3;Sr++){const xr=gr.data[yr+Sr],Cr=(br*or.width+wr)*4+Sr,Ir=pr.data[Cr]/255,Rr=Ar?Ir:Math.pow(Ir,1/er.gamma),Pr=er.gainMapMin*(1-Rr)+er.gainMapMax*Rr,Fr=(xr+er.offsetSDR)*(Pr*vr===0?1:Math.pow(2,Pr*vr))-er.offsetHDR,Nr=Math.min(Math.max(this._srgbToLinear(Fr),0),65504);_r[yr+Sr]=this.type===HalfFloatType?DataUtils.toHalfFloat(Nr):Nr}}nr(_r,or.width,or.height)}).catch(()=>{throw new Error("THREE.UltraHDRLoader Error: Could not parse UltraHDR images")})}}class RGBMLoader extends DataTextureLoader{constructor(er){super(er),this.type=HalfFloatType,this.maxRange=7}setDataType(er){return this.type=er,this}setMaxRange(er){return this.maxRange=er,this}loadCubemap(er,tr,rr,nr){const sr=new CubeTexture;for(let cr=0;cr<6;cr++)sr.images[cr]=void 0;let ar=0;const or=this;function lr(cr){or.load(er[cr],function(hr){sr.images[cr]=hr,ar++,ar===6&&(sr.needsUpdate=!0,tr&&tr(sr))},void 0,nr)}for(let cr=0;cr<er.length;++cr)lr(cr);return sr.type=this.type,sr.format=RGBAFormat,sr.minFilter=LinearFilter,sr.generateMipmaps=!1,sr}loadCubemapAsync(er,tr){return new Promise((rr,nr)=>{this.loadCubemap(er,rr,tr,nr)})}parse(er){const tr=UPNG.decode(er),rr=UPNG.toRGBA8(tr)[0],nr=new Uint8Array(rr),sr=tr.width*tr.height*4,ar=this.type===HalfFloatType?new Uint16Array(sr):new Float32Array(sr);for(let or=0;or<nr.length;or+=4){const lr=nr[or+0]/255,cr=nr[or+1]/255,hr=nr[or+2]/255,fr=nr[or+3]/255;this.type===HalfFloatType?(ar[or+0]=DataUtils.toHalfFloat(Math.min(lr*fr*this.maxRange,65504)),ar[or+1]=DataUtils.toHalfFloat(Math.min(cr*fr*this.maxRange,65504)),ar[or+2]=DataUtils.toHalfFloat(Math.min(hr*fr*this.maxRange,65504)),ar[or+3]=DataUtils.toHalfFloat(1)):(ar[or+0]=lr*fr*this.maxRange,ar[or+1]=cr*fr*this.maxRange,ar[or+2]=hr*fr*this.maxRange,ar[or+3]=1)}return{width:tr.width,height:tr.height,data:ar,format:RGBAFormat,type:this.type,flipY:!0}}}var UPNG={};UPNG.toRGBA8=function(ir){var er=ir.width,tr=ir.height;if(ir.tabs.acTL==null)return[UPNG.toRGBA8.decodeImage(ir.data,er,tr,ir).buffer];var rr=[];ir.frames[0].data==null&&(ir.frames[0].data=ir.data);for(var nr=er*tr*4,sr=new Uint8Array(nr),ar=new Uint8Array(nr),or=new Uint8Array(nr),lr=0;lr<ir.frames.length;lr++){var cr=ir.frames[lr],hr=cr.rect.x,fr=cr.rect.y,ur=cr.rect.width,pr=cr.rect.height,gr=UPNG.toRGBA8.decodeImage(cr.data,ur,pr,ir);if(lr!=0)for(var _r=0;_r<nr;_r++)or[_r]=sr[_r];if(cr.blend==0?UPNG._copyTile(gr,ur,pr,sr,er,tr,hr,fr,0):cr.blend==1&&UPNG._copyTile(gr,ur,pr,sr,er,tr,hr,fr,1),rr.push(sr.buffer.slice(0)),cr.dispose==1)UPNG._copyTile(ar,ur,pr,sr,er,tr,hr,fr,0);else if(cr.dispose==2)for(var _r=0;_r<nr;_r++)sr[_r]=or[_r]}return rr};UPNG.toRGBA8.decodeImage=function(ir,er,tr,rr){var nr=er*tr,sr=UPNG.decode._getBPP(rr),ar=Math.ceil(er*sr/8),or=new Uint8Array(nr*4),lr=new Uint32Array(or.buffer),cr=rr.ctype,hr=rr.depth,fr=UPNG._bin.readUshort;if(cr==6){var ur=nr<<2;if(hr==8)for(var pr=0;pr<ur;pr+=4)or[pr]=ir[pr],or[pr+1]=ir[pr+1],or[pr+2]=ir[pr+2],or[pr+3]=ir[pr+3];if(hr==16)for(var pr=0;pr<ur;pr++)or[pr]=ir[pr<<1]}else if(cr==2){var gr=rr.tabs.tRNS;if(gr==null){if(hr==8)for(var pr=0;pr<nr;pr++){var _r=pr*3;lr[pr]=255<<24|ir[_r+2]<<16|ir[_r+1]<<8|ir[_r]}if(hr==16)for(var pr=0;pr<nr;pr++){var _r=pr*6;lr[pr]=255<<24|ir[_r+4]<<16|ir[_r+2]<<8|ir[_r]}}else{var mr=gr[0],dr=gr[1],vr=gr[2];if(hr==8)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,_r=pr*3;lr[pr]=255<<24|ir[_r+2]<<16|ir[_r+1]<<8|ir[_r],ir[_r]==mr&&ir[_r+1]==dr&&ir[_r+2]==vr&&(or[Ar+3]=0)}if(hr==16)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,_r=pr*6;lr[pr]=255<<24|ir[_r+4]<<16|ir[_r+2]<<8|ir[_r],fr(ir,_r)==mr&&fr(ir,_r+2)==dr&&fr(ir,_r+4)==vr&&(or[Ar+3]=0)}}}else if(cr==3){var yr=rr.tabs.PLTE,wr=rr.tabs.tRNS,br=wr?wr.length:0;if(hr==1)for(var Sr=0;Sr<tr;Sr++)for(var xr=Sr*ar,Cr=Sr*er,pr=0;pr<er;pr++){var Ar=Cr+pr<<2,Ir=ir[xr+(pr>>3)]>>7-((pr&7)<<0)&1,Rr=3*Ir;or[Ar]=yr[Rr],or[Ar+1]=yr[Rr+1],or[Ar+2]=yr[Rr+2],or[Ar+3]=Ir<br?wr[Ir]:255}if(hr==2)for(var Sr=0;Sr<tr;Sr++)for(var xr=Sr*ar,Cr=Sr*er,pr=0;pr<er;pr++){var Ar=Cr+pr<<2,Ir=ir[xr+(pr>>2)]>>6-((pr&3)<<1)&3,Rr=3*Ir;or[Ar]=yr[Rr],or[Ar+1]=yr[Rr+1],or[Ar+2]=yr[Rr+2],or[Ar+3]=Ir<br?wr[Ir]:255}if(hr==4)for(var Sr=0;Sr<tr;Sr++)for(var xr=Sr*ar,Cr=Sr*er,pr=0;pr<er;pr++){var Ar=Cr+pr<<2,Ir=ir[xr+(pr>>1)]>>4-((pr&1)<<2)&15,Rr=3*Ir;or[Ar]=yr[Rr],or[Ar+1]=yr[Rr+1],or[Ar+2]=yr[Rr+2],or[Ar+3]=Ir<br?wr[Ir]:255}if(hr==8)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,Ir=ir[pr],Rr=3*Ir;or[Ar]=yr[Rr],or[Ar+1]=yr[Rr+1],or[Ar+2]=yr[Rr+2],or[Ar+3]=Ir<br?wr[Ir]:255}}else if(cr==4){if(hr==8)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,Pr=pr<<1,Fr=ir[Pr];or[Ar]=Fr,or[Ar+1]=Fr,or[Ar+2]=Fr,or[Ar+3]=ir[Pr+1]}if(hr==16)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,Pr=pr<<2,Fr=ir[Pr];or[Ar]=Fr,or[Ar+1]=Fr,or[Ar+2]=Fr,or[Ar+3]=ir[Pr+2]}}else if(cr==0)for(var mr=rr.tabs.tRNS?rr.tabs.tRNS:-1,Sr=0;Sr<tr;Sr++){var Nr=Sr*ar,Ur=Sr*er;if(hr==1)for(var Br=0;Br<er;Br++){var Fr=255*(ir[Nr+(Br>>>3)]>>>7-(Br&7)&1),Or=Fr==mr*255?0:255;lr[Ur+Br]=Or<<24|Fr<<16|Fr<<8|Fr}else if(hr==2)for(var Br=0;Br<er;Br++){var Fr=85*(ir[Nr+(Br>>>2)]>>>6-((Br&3)<<1)&3),Or=Fr==mr*85?0:255;lr[Ur+Br]=Or<<24|Fr<<16|Fr<<8|Fr}else if(hr==4)for(var Br=0;Br<er;Br++){var Fr=17*(ir[Nr+(Br>>>1)]>>>4-((Br&1)<<2)&15),Or=Fr==mr*17?0:255;lr[Ur+Br]=Or<<24|Fr<<16|Fr<<8|Fr}else if(hr==8)for(var Br=0;Br<er;Br++){var Fr=ir[Nr+Br],Or=Fr==mr?0:255;lr[Ur+Br]=Or<<24|Fr<<16|Fr<<8|Fr}else if(hr==16)for(var Br=0;Br<er;Br++){var Fr=ir[Nr+(Br<<1)],Or=fr(ir,Nr+(Br<<1))==mr?0:255;lr[Ur+Br]=Or<<24|Fr<<16|Fr<<8|Fr}}return or};UPNG.decode=function(ir){for(var er=new Uint8Array(ir),tr=8,rr=UPNG._bin,nr=rr.readUshort,sr=rr.readUint,ar={tabs:{},frames:[]},or=new Uint8Array(er.length),lr=0,cr,hr=0,fr,ur,pr,gr=[137,80,78,71,13,10,26,10],_r=0;_r<8;_r++)if(er[_r]!=gr[_r])throw new Error("The input is not a PNG file!");for(;tr<er.length;){var mr=rr.readUint(er,tr);tr+=4;var dr=rr.readASCII(er,tr,4);if(tr+=4,dr=="IHDR")UPNG.decode._IHDR(er,tr,ar);else if(dr=="CgBI")ar.tabs[dr]=er.slice(tr,tr+4);else if(dr=="IDAT"){for(var _r=0;_r<mr;_r++)or[lr+_r]=er[tr+_r];lr+=mr}else if(dr=="acTL")ar.tabs[dr]={num_frames:sr(er,tr),num_plays:sr(er,tr+4)},cr=new Uint8Array(er.length);else if(dr=="fcTL"){if(hr!=0){var vr=ar.frames[ar.frames.length-1];vr.data=UPNG.decode._decompress(ar,cr.slice(0,hr),vr.rect.width,vr.rect.height),hr=0}var Ar={x:sr(er,tr+12),y:sr(er,tr+16),width:sr(er,tr+4),height:sr(er,tr+8)},yr=nr(er,tr+22);yr=nr(er,tr+20)/(yr==0?100:yr);var wr={rect:Ar,delay:Math.round(yr*1e3),dispose:er[tr+24],blend:er[tr+25]};ar.frames.push(wr)}else if(dr=="fdAT"){for(var _r=0;_r<mr-4;_r++)cr[hr+_r]=er[tr+_r+4];hr+=mr-4}else if(dr=="pHYs")ar.tabs[dr]=[rr.readUint(er,tr),rr.readUint(er,tr+4),er[tr+8]];else if(dr=="cHRM"){ar.tabs[dr]=[];for(var _r=0;_r<8;_r++)ar.tabs[dr].push(rr.readUint(er,tr+_r*4))}else if(dr=="tEXt"||dr=="zTXt"){ar.tabs[dr]==null&&(ar.tabs[dr]={});var br=rr.nextZero(er,tr);ur=rr.readASCII(er,tr,br-tr);var Sr=tr+mr-br-1;dr=="tEXt"?fr=rr.readASCII(er,br+1,Sr):(pr=UPNG.decode._inflate(er.slice(br+2,br+2+Sr)),fr=rr.readUTF8(pr,0,pr.length)),ar.tabs[dr][ur]=fr}else if(dr=="iTXt"){ar.tabs[dr]==null&&(ar.tabs[dr]={});var br=0,xr=tr;br=rr.nextZero(er,xr),ur=rr.readASCII(er,xr,br-xr),xr=br+1;var Cr=er[xr];xr+=2,br=rr.nextZero(er,xr),rr.readASCII(er,xr,br-xr),xr=br+1,br=rr.nextZero(er,xr),rr.readUTF8(er,xr,br-xr),xr=br+1;var Sr=mr-(xr-tr);Cr==0?fr=rr.readUTF8(er,xr,Sr):(pr=UPNG.decode._inflate(er.slice(xr,xr+Sr)),fr=rr.readUTF8(pr,0,pr.length)),ar.tabs[dr][ur]=fr}else if(dr=="PLTE")ar.tabs[dr]=rr.readBytes(er,tr,mr);else if(dr=="hIST"){var Ir=ar.tabs.PLTE.length/3;ar.tabs[dr]=[];for(var _r=0;_r<Ir;_r++)ar.tabs[dr].push(nr(er,tr+_r*2))}else if(dr=="tRNS")ar.ctype==3?ar.tabs[dr]=rr.readBytes(er,tr,mr):ar.ctype==0?ar.tabs[dr]=nr(er,tr):ar.ctype==2&&(ar.tabs[dr]=[nr(er,tr),nr(er,tr+2),nr(er,tr+4)]);else if(dr=="gAMA")ar.tabs[dr]=rr.readUint(er,tr)/1e5;else if(dr=="sRGB")ar.tabs[dr]=er[tr];else if(dr=="bKGD")ar.ctype==0||ar.ctype==4?ar.tabs[dr]=[nr(er,tr)]:ar.ctype==2||ar.ctype==6?ar.tabs[dr]=[nr(er,tr),nr(er,tr+2),nr(er,tr+4)]:ar.ctype==3&&(ar.tabs[dr]=er[tr]);else if(dr=="IEND")break;tr+=mr,rr.readUint(er,tr),tr+=4}if(hr!=0){var vr=ar.frames[ar.frames.length-1];vr.data=UPNG.decode._decompress(ar,cr.slice(0,hr),vr.rect.width,vr.rect.height)}return ar.data=UPNG.decode._decompress(ar,or,ar.width,ar.height),delete ar.compress,delete ar.interlace,delete ar.filter,ar};UPNG.decode._decompress=function(ir,er,tr,rr){var nr=UPNG.decode._getBPP(ir),sr=Math.ceil(tr*nr/8),ar=new Uint8Array((sr+1+ir.interlace)*rr);return ir.tabs.CgBI?er=UPNG.inflateRaw(er,ar):er=UPNG.decode._inflate(er,ar),ir.interlace==0?er=UPNG.decode._filterZero(er,ir,0,tr,rr):ir.interlace==1&&(er=UPNG.decode._readInterlace(er,ir)),er};UPNG.decode._inflate=function(ir,er){var tr=UPNG.inflateRaw(new Uint8Array(ir.buffer,2,ir.length-6),er);return tr};UPNG.inflateRaw=function(){var ir={};return ir.H={},ir.H.N=function(er,tr){var rr=Uint8Array,nr=0,sr=0,ar=0,or=0,lr=0,cr=0,hr=0,fr=0,ur=0,pr,gr;if(er[0]==3&&er[1]==0)return tr||new rr(0);var _r=ir.H,mr=_r.b,dr=_r.e,vr=_r.R,Ar=_r.n,yr=_r.A,wr=_r.Z,br=_r.m,Sr=tr==null;for(Sr&&(tr=new rr(er.length>>>2<<5));nr==0;){if(nr=mr(er,ur,1),sr=mr(er,ur+1,2),ur+=3,sr==0){ur&7&&(ur+=8-(ur&7));var xr=(ur>>>3)+4,Cr=er[xr-4]|er[xr-3]<<8;Sr&&(tr=ir.H.W(tr,fr+Cr)),tr.set(new rr(er.buffer,er.byteOffset+xr,Cr),fr),ur=xr+Cr<<3,fr+=Cr;continue}if(Sr&&(tr=ir.H.W(tr,fr+(1<<17))),sr==1&&(pr=br.J,gr=br.h,cr=511,hr=31),sr==2){ar=dr(er,ur,5)+257,or=dr(er,ur+5,5)+1,lr=dr(er,ur+10,4)+4,ur+=14;for(var Ir=1,Rr=0;Rr<38;Rr+=2)br.Q[Rr]=0,br.Q[Rr+1]=0;for(var Rr=0;Rr<lr;Rr++){var Pr=dr(er,ur+Rr*3,3);br.Q[(br.X[Rr]<<1)+1]=Pr,Pr>Ir&&(Ir=Pr)}ur+=3*lr,Ar(br.Q,Ir),yr(br.Q,Ir,br.u),pr=br.w,gr=br.d,ur=vr(br.u,(1<<Ir)-1,ar+or,er,ur,br.v);var Fr=_r.V(br.v,0,ar,br.C);cr=(1<<Fr)-1;var Nr=_r.V(br.v,ar,or,br.D);hr=(1<<Nr)-1,Ar(br.C,Fr),yr(br.C,Fr,pr),Ar(br.D,Nr),yr(br.D,Nr,gr)}for(;;){var Ur=pr[wr(er,ur)&cr];ur+=Ur&15;var Br=Ur>>>4;if(!(Br>>>8))tr[fr++]=Br;else{if(Br==256)break;var Or=fr+Br-254;if(Br>264){var Dr=br.q[Br-257];Or=fr+(Dr>>>3)+dr(er,ur,Dr&7),ur+=Dr&7}var Wr=gr[wr(er,ur)&hr];ur+=Wr&15;var $r=Wr>>>4,Yr=br.c[$r],Qi=(Yr>>>4)+mr(er,ur,Yr&15);for(ur+=Yr&15;fr<Or;)tr[fr]=tr[fr++-Qi],tr[fr]=tr[fr++-Qi],tr[fr]=tr[fr++-Qi],tr[fr]=tr[fr++-Qi];fr=Or}}}return tr.length==fr?tr:tr.slice(0,fr)},ir.H.W=function(er,tr){var rr=er.length;if(tr<=rr)return er;var nr=new Uint8Array(rr<<1);return nr.set(er,0),nr},ir.H.R=function(er,tr,rr,nr,sr,ar){for(var or=ir.H.e,lr=ir.H.Z,cr=0;cr<rr;){var hr=er[lr(nr,sr)&tr];sr+=hr&15;var fr=hr>>>4;if(fr<=15)ar[cr]=fr,cr++;else{var ur=0,pr=0;fr==16?(pr=3+or(nr,sr,2),sr+=2,ur=ar[cr-1]):fr==17?(pr=3+or(nr,sr,3),sr+=3):fr==18&&(pr=11+or(nr,sr,7),sr+=7);for(var gr=cr+pr;cr<gr;)ar[cr]=ur,cr++}}return sr},ir.H.V=function(er,tr,rr,nr){for(var sr=0,ar=0,or=nr.length>>>1;ar<rr;){var lr=er[ar+tr];nr[ar<<1]=0,nr[(ar<<1)+1]=lr,lr>sr&&(sr=lr),ar++}for(;ar<or;)nr[ar<<1]=0,nr[(ar<<1)+1]=0,ar++;return sr},ir.H.n=function(er,tr){for(var rr=ir.H.m,nr=er.length,sr,ar,or,lr,cr,hr=rr.j,lr=0;lr<=tr;lr++)hr[lr]=0;for(lr=1;lr<nr;lr+=2)hr[er[lr]]++;var fr=rr.K;for(sr=0,hr[0]=0,ar=1;ar<=tr;ar++)sr=sr+hr[ar-1]<<1,fr[ar]=sr;for(or=0;or<nr;or+=2)cr=er[or+1],cr!=0&&(er[or]=fr[cr],fr[cr]++)},ir.H.A=function(er,tr,rr){for(var nr=er.length,sr=ir.H.m,ar=sr.r,or=0;or<nr;or+=2)if(er[or+1]!=0)for(var lr=or>>1,cr=er[or+1],hr=lr<<4|cr,fr=tr-cr,ur=er[or]<<fr,pr=ur+(1<<fr);ur!=pr;){var gr=ar[ur]>>>15-tr;rr[gr]=hr,ur++}},ir.H.l=function(er,tr){for(var rr=ir.H.m.r,nr=15-tr,sr=0;sr<er.length;sr+=2){var ar=er[sr]<<tr-er[sr+1];er[sr]=rr[ar]>>>nr}},ir.H.M=function(er,tr,rr){rr=rr<<(tr&7);var nr=tr>>>3;er[nr]|=rr,er[nr+1]|=rr>>>8},ir.H.I=function(er,tr,rr){rr=rr<<(tr&7);var nr=tr>>>3;er[nr]|=rr,er[nr+1]|=rr>>>8,er[nr+2]|=rr>>>16},ir.H.e=function(er,tr,rr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8)>>>(tr&7)&(1<<rr)-1},ir.H.b=function(er,tr,rr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16)>>>(tr&7)&(1<<rr)-1},ir.H.Z=function(er,tr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16)>>>(tr&7)},ir.H.i=function(er,tr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16|er[(tr>>>3)+3]<<24)>>>(tr&7)},ir.H.m=function(){var er=Uint16Array,tr=Uint32Array;return{K:new er(16),j:new er(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new er(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new tr(32),J:new er(512),_:[],h:new er(32),$:[],w:new er(32768),C:[],v:[],d:new er(32768),D:[],u:new er(512),Q:[],r:new er(32768),s:new tr(286),Y:new tr(30),a:new tr(19),t:new tr(15e3),k:new er(65536),g:new er(32768)}}(),function(){for(var er=ir.H.m,tr=32768,rr=0;rr<tr;rr++){var nr=rr;nr=(nr&2863311530)>>>1|(nr&1431655765)<<1,nr=(nr&3435973836)>>>2|(nr&858993459)<<2,nr=(nr&4042322160)>>>4|(nr&252645135)<<4,nr=(nr&4278255360)>>>8|(nr&16711935)<<8,er.r[rr]=(nr>>>16|nr<<16)>>>17}function sr(ar,or,lr){for(;or--!=0;)ar.push(0,lr)}for(var rr=0;rr<32;rr++)er.q[rr]=er.S[rr]<<3|er.T[rr],er.c[rr]=er.p[rr]<<4|er.z[rr];sr(er._,144,8),sr(er._,112,9),sr(er._,24,7),sr(er._,8,8),ir.H.n(er._,9),ir.H.A(er._,9,er.J),ir.H.l(er._,9),sr(er.$,32,5),ir.H.n(er.$,5),ir.H.A(er.$,5,er.h),ir.H.l(er.$,5),sr(er.Q,19,0),sr(er.C,286,0),sr(er.D,30,0),sr(er.v,320,0)}(),ir.H.N}();UPNG.decode._readInterlace=function(ir,er){for(var tr=er.width,rr=er.height,nr=UPNG.decode._getBPP(er),sr=nr>>3,ar=Math.ceil(tr*nr/8),or=new Uint8Array(rr*ar),lr=0,cr=[0,0,4,0,2,0,1],hr=[0,4,0,2,0,1,0],fr=[8,8,8,4,4,2,2],ur=[8,8,4,4,2,2,1],pr=0;pr<7;){for(var gr=fr[pr],_r=ur[pr],mr=0,dr=0,vr=cr[pr];vr<rr;)vr+=gr,dr++;for(var Ar=hr[pr];Ar<tr;)Ar+=_r,mr++;var yr=Math.ceil(mr*nr/8);UPNG.decode._filterZero(ir,er,lr,mr,dr);for(var wr=0,br=cr[pr],Sr;br<rr;){for(var xr=hr[pr],Cr=lr+wr*yr<<3;xr<tr;){if(nr==1&&(Sr=ir[Cr>>3],Sr=Sr>>7-(Cr&7)&1,or[br*ar+(xr>>3)]|=Sr<<7-((xr&7)<<0)),nr==2&&(Sr=ir[Cr>>3],Sr=Sr>>6-(Cr&7)&3,or[br*ar+(xr>>2)]|=Sr<<6-((xr&3)<<1)),nr==4&&(Sr=ir[Cr>>3],Sr=Sr>>4-(Cr&7)&15,or[br*ar+(xr>>1)]|=Sr<<4-((xr&1)<<2)),nr>=8)for(var Ir=br*ar+xr*sr,Rr=0;Rr<sr;Rr++)or[Ir+Rr]=ir[(Cr>>3)+Rr];Cr+=nr,xr+=_r}wr++,br+=gr}mr*dr!=0&&(lr+=dr*(1+yr)),pr=pr+1}return or};UPNG.decode._getBPP=function(ir){var er=[1,null,3,1,2,null,4][ir.ctype];return er*ir.depth};UPNG.decode._filterZero=function(ir,er,tr,rr,nr){var sr=UPNG.decode._getBPP(er),ar=Math.ceil(rr*sr/8),or=UPNG.decode._paeth;sr=Math.ceil(sr/8);var lr,cr,hr=ir[tr],fr=0;if(hr>1&&(ir[tr]=[0,0,1][hr-2]),hr==3)for(fr=sr;fr<ar;fr++)ir[fr+1]=ir[fr+1]+(ir[fr+1-sr]>>>1)&255;for(var ur=0;ur<nr;ur++)if(lr=tr+ur*ar,cr=lr+ur+1,hr=ir[cr-1],fr=0,hr==0)for(;fr<ar;fr++)ir[lr+fr]=ir[cr+fr];else if(hr==1){for(;fr<sr;fr++)ir[lr+fr]=ir[cr+fr];for(;fr<ar;fr++)ir[lr+fr]=ir[cr+fr]+ir[lr+fr-sr]}else if(hr==2)for(;fr<ar;fr++)ir[lr+fr]=ir[cr+fr]+ir[lr+fr-ar];else if(hr==3){for(;fr<sr;fr++)ir[lr+fr]=ir[cr+fr]+(ir[lr+fr-ar]>>>1);for(;fr<ar;fr++)ir[lr+fr]=ir[cr+fr]+(ir[lr+fr-ar]+ir[lr+fr-sr]>>>1)}else{for(;fr<sr;fr++)ir[lr+fr]=ir[cr+fr]+or(0,ir[lr+fr-ar],0);for(;fr<ar;fr++)ir[lr+fr]=ir[cr+fr]+or(ir[lr+fr-sr],ir[lr+fr-ar],ir[lr+fr-sr-ar])}return ir};UPNG.decode._paeth=function(ir,er,tr){var rr=ir+er-tr,nr=rr-ir,sr=rr-er,ar=rr-tr;return nr*nr<=sr*sr&&nr*nr<=ar*ar?ir:sr*sr<=ar*ar?er:tr};UPNG.decode._IHDR=function(ir,er,tr){var rr=UPNG._bin;tr.width=rr.readUint(ir,er),er+=4,tr.height=rr.readUint(ir,er),er+=4,tr.depth=ir[er],er++,tr.ctype=ir[er],er++,tr.compress=ir[er],er++,tr.filter=ir[er],er++,tr.interlace=ir[er],er++};UPNG._bin={nextZero:function(ir,er){for(;ir[er]!=0;)er++;return er},readUshort:function(ir,er){return ir[er]<<8|ir[er+1]},writeUshort:function(ir,er,tr){ir[er]=tr>>8&255,ir[er+1]=tr&255},readUint:function(ir,er){return ir[er]*(256*256*256)+(ir[er+1]<<16|ir[er+2]<<8|ir[er+3])},writeUint:function(ir,er,tr){ir[er]=tr>>24&255,ir[er+1]=tr>>16&255,ir[er+2]=tr>>8&255,ir[er+3]=tr&255},readASCII:function(ir,er,tr){for(var rr="",nr=0;nr<tr;nr++)rr+=String.fromCharCode(ir[er+nr]);return rr},writeASCII:function(ir,er,tr){for(var rr=0;rr<tr.length;rr++)ir[er+rr]=tr.charCodeAt(rr)},readBytes:function(ir,er,tr){for(var rr=[],nr=0;nr<tr;nr++)rr.push(ir[er+nr]);return rr},pad:function(ir){return ir.length<2?"0"+ir:ir},readUTF8:function(ir,er,tr){for(var rr="",nr,sr=0;sr<tr;sr++)rr+="%"+UPNG._bin.pad(ir[er+sr].toString(16));try{nr=decodeURIComponent(rr)}catch{return UPNG._bin.readASCII(ir,er,tr)}return nr}};UPNG._copyTile=function(ir,er,tr,rr,nr,sr,ar,or,lr){for(var cr=Math.min(er,nr),hr=Math.min(tr,sr),fr=0,ur=0,pr=0;pr<hr;pr++)for(var gr=0;gr<cr;gr++)if(ar>=0&&or>=0?(fr=pr*er+gr<<2,ur=(or+pr)*nr+ar+gr<<2):(fr=(-or+pr)*er-ar+gr<<2,ur=pr*nr+gr<<2),lr==0)rr[ur]=ir[fr],rr[ur+1]=ir[fr+1],rr[ur+2]=ir[fr+2],rr[ur+3]=ir[fr+3];else if(lr==1){var _r=ir[fr+3]*.00392156862745098,mr=ir[fr]*_r,dr=ir[fr+1]*_r,vr=ir[fr+2]*_r,Ar=rr[ur+3]*(1/255),yr=rr[ur]*Ar,wr=rr[ur+1]*Ar,br=rr[ur+2]*Ar,Sr=1-_r,xr=_r+Ar*Sr,Cr=xr==0?0:1/xr;rr[ur+3]=255*xr,rr[ur+0]=(mr+yr*Sr)*Cr,rr[ur+1]=(dr+wr*Sr)*Cr,rr[ur+2]=(vr+br*Sr)*Cr}else if(lr==2){var _r=ir[fr+3],mr=ir[fr],dr=ir[fr+1],vr=ir[fr+2],Ar=rr[ur+3],yr=rr[ur],wr=rr[ur+1],br=rr[ur+2];_r==Ar&&mr==yr&&dr==wr&&vr==br?(rr[ur]=0,rr[ur+1]=0,rr[ur+2]=0,rr[ur+3]=0):(rr[ur]=mr,rr[ur+1]=dr,rr[ur+2]=vr,rr[ur+3]=_r)}else if(lr==3){var _r=ir[fr+3],mr=ir[fr],dr=ir[fr+1],vr=ir[fr+2],Ar=rr[ur+3],yr=rr[ur],wr=rr[ur+1],br=rr[ur+2];if(_r==Ar&&mr==yr&&dr==wr&&vr==br)continue;if(_r<220&&Ar>20)return!1}return!0};class STLLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){function tr(cr){const hr=new DataView(cr),fr=32/8*3+32/8*3*3+16/8,ur=hr.getUint32(80,!0);if(80+32/8+ur*fr===hr.byteLength)return!0;const gr=[115,111,108,105,100];for(let _r=0;_r<5;_r++)if(rr(gr,hr,_r))return!1;return!0}function rr(cr,hr,fr){for(let ur=0,pr=cr.length;ur<pr;ur++)if(cr[ur]!==hr.getUint8(fr+ur))return!1;return!0}function nr(cr){const hr=new DataView(cr),fr=hr.getUint32(80,!0);let ur,pr,gr,_r=!1,mr,dr,vr,Ar,yr;for(let Rr=0;Rr<70;Rr++)hr.getUint32(Rr,!1)==1129270351&&hr.getUint8(Rr+4)==82&&hr.getUint8(Rr+5)==61&&(_r=!0,mr=new Float32Array(fr*3*3),dr=hr.getUint8(Rr+6)/255,vr=hr.getUint8(Rr+7)/255,Ar=hr.getUint8(Rr+8)/255,yr=hr.getUint8(Rr+9)/255);const wr=84,br=12*4+2,Sr=new BufferGeometry,xr=new Float32Array(fr*3*3),Cr=new Float32Array(fr*3*3),Ir=new Color;for(let Rr=0;Rr<fr;Rr++){const Pr=wr+Rr*br,Fr=hr.getFloat32(Pr,!0),Nr=hr.getFloat32(Pr+4,!0),Ur=hr.getFloat32(Pr+8,!0);if(_r){const Br=hr.getUint16(Pr+48,!0);Br&32768?(ur=dr,pr=vr,gr=Ar):(ur=(Br&31)/31,pr=(Br>>5&31)/31,gr=(Br>>10&31)/31)}for(let Br=1;Br<=3;Br++){const Or=Pr+Br*12,Dr=Rr*3*3+(Br-1)*3;xr[Dr]=hr.getFloat32(Or,!0),xr[Dr+1]=hr.getFloat32(Or+4,!0),xr[Dr+2]=hr.getFloat32(Or+8,!0),Cr[Dr]=Fr,Cr[Dr+1]=Nr,Cr[Dr+2]=Ur,_r&&(Ir.setRGB(ur,pr,gr,SRGBColorSpace),mr[Dr]=Ir.r,mr[Dr+1]=Ir.g,mr[Dr+2]=Ir.b)}}return Sr.setAttribute("position",new BufferAttribute(xr,3)),Sr.setAttribute("normal",new BufferAttribute(Cr,3)),_r&&(Sr.setAttribute("color",new BufferAttribute(mr,3)),Sr.hasColors=!0,Sr.alpha=yr),Sr}function sr(cr){const hr=new BufferGeometry,fr=/solid([\s\S]*?)endsolid/g,ur=/facet([\s\S]*?)endfacet/g,pr=/solid\s(.+)/;let gr=0;const _r=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,mr=new RegExp("vertex"+_r+_r+_r,"g"),dr=new RegExp("normal"+_r+_r+_r,"g"),vr=[],Ar=[],yr=[],wr=new Vector3$1;let br,Sr=0,xr=0,Cr=0;for(;(br=fr.exec(cr))!==null;){xr=Cr;const Ir=br[0],Rr=(br=pr.exec(Ir))!==null?br[1]:"";for(yr.push(Rr);(br=ur.exec(Ir))!==null;){let Nr=0,Ur=0;const Br=br[0];for(;(br=dr.exec(Br))!==null;)wr.x=parseFloat(br[1]),wr.y=parseFloat(br[2]),wr.z=parseFloat(br[3]),Ur++;for(;(br=mr.exec(Br))!==null;)vr.push(parseFloat(br[1]),parseFloat(br[2]),parseFloat(br[3])),Ar.push(wr.x,wr.y,wr.z),Nr++,Cr++;Ur!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+gr),Nr!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+gr),gr++}const Pr=xr,Fr=Cr-xr;hr.userData.groupNames=yr,hr.addGroup(Pr,Fr,Sr),Sr++}return hr.setAttribute("position",new Float32BufferAttribute(vr,3)),hr.setAttribute("normal",new Float32BufferAttribute(Ar,3)),hr}function ar(cr){return typeof cr!="string"?new TextDecoder().decode(cr):cr}function or(cr){if(typeof cr=="string"){const hr=new Uint8Array(cr.length);for(let fr=0;fr<cr.length;fr++)hr[fr]=cr.charCodeAt(fr)&255;return hr.buffer||hr}else return cr}const lr=or(er);return tr(lr)?nr(lr):sr(ar(er))}}const COLOR_SPACE_SVG=SRGBColorSpace;class SVGLoader extends Loader{constructor(er){super(er),this.defaultDPI=90,this.defaultUnit="px"}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr=this;function rr(Kr,Qr){if(Kr.nodeType!==1)return;const Vr=yr(Kr);let Gr=!1,qr=null;switch(Kr.nodeName){case"svg":Qr=gr(Kr,Qr);break;case"style":sr(Kr);break;case"g":Qr=gr(Kr,Qr);break;case"path":Qr=gr(Kr,Qr),Kr.hasAttribute("d")&&(qr=nr(Kr));break;case"rect":Qr=gr(Kr,Qr),qr=lr(Kr);break;case"polygon":Qr=gr(Kr,Qr),qr=cr(Kr);break;case"polyline":Qr=gr(Kr,Qr),qr=hr(Kr);break;case"circle":Qr=gr(Kr,Qr),qr=fr(Kr);break;case"ellipse":Qr=gr(Kr,Qr),qr=ur(Kr);break;case"line":Qr=gr(Kr,Qr),qr=pr(Kr);break;case"defs":Gr=!0;break;case"use":Qr=gr(Kr,Qr);const Zi=(Kr.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Yi=Kr.viewportElement.getElementById(Zi);Yi?rr(Yi,Qr):console.warn("SVGLoader: 'use node' references non-existent node id: "+Zi);break;default:}qr&&(Qr.fill!==void 0&&Qr.fill!=="none"&&qr.color.setStyle(Qr.fill,COLOR_SPACE_SVG),br(qr,Yr),Pr.push(qr),qr.userData={node:Kr,style:Qr});const ji=Kr.childNodes;for(let Zr=0;Zr<ji.length;Zr++){const Zi=ji[Zr];Gr&&Zi.nodeName!=="style"&&Zi.nodeName!=="defs"||rr(Zi,Qr)}Vr&&(Nr.pop(),Nr.length>0?Yr.copy(Nr[Nr.length-1]):Yr.identity())}function nr(Kr){const Qr=new ShapePath,Vr=new Vector2,Gr=new Vector2,qr=new Vector2;let ji=!0,Zr=!1;const Zi=Kr.getAttribute("d");if(Zi===""||Zi==="none")return null;const Yi=Zi.match(/[a-df-z][^a-df-z]*/ig);for(let qi=0,Xr=Yi.length;qi<Xr;qi++){const ns=Yi[qi],os=ns.charAt(0),us=ns.slice(1).trim();ji===!0&&(Zr=!0,ji=!1);let is;switch(os){case"M":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=2)Vr.x=is[Ji+0],Vr.y=is[Ji+1],Gr.x=Vr.x,Gr.y=Vr.y,Ji===0?Qr.moveTo(Vr.x,Vr.y):Qr.lineTo(Vr.x,Vr.y),Ji===0&&qr.copy(Vr);break;case"H":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji++)Vr.x=is[Ji],Gr.x=Vr.x,Gr.y=Vr.y,Qr.lineTo(Vr.x,Vr.y),Ji===0&&Zr===!0&&qr.copy(Vr);break;case"V":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji++)Vr.y=is[Ji],Gr.x=Vr.x,Gr.y=Vr.y,Qr.lineTo(Vr.x,Vr.y),Ji===0&&Zr===!0&&qr.copy(Vr);break;case"L":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=2)Vr.x=is[Ji+0],Vr.y=is[Ji+1],Gr.x=Vr.x,Gr.y=Vr.y,Qr.lineTo(Vr.x,Vr.y),Ji===0&&Zr===!0&&qr.copy(Vr);break;case"C":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=6)Qr.bezierCurveTo(is[Ji+0],is[Ji+1],is[Ji+2],is[Ji+3],is[Ji+4],is[Ji+5]),Gr.x=is[Ji+2],Gr.y=is[Ji+3],Vr.x=is[Ji+4],Vr.y=is[Ji+5],Ji===0&&Zr===!0&&qr.copy(Vr);break;case"S":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=4)Qr.bezierCurveTo(_r(Vr.x,Gr.x),_r(Vr.y,Gr.y),is[Ji+0],is[Ji+1],is[Ji+2],is[Ji+3]),Gr.x=is[Ji+0],Gr.y=is[Ji+1],Vr.x=is[Ji+2],Vr.y=is[Ji+3],Ji===0&&Zr===!0&&qr.copy(Vr);break;case"Q":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=4)Qr.quadraticCurveTo(is[Ji+0],is[Ji+1],is[Ji+2],is[Ji+3]),Gr.x=is[Ji+0],Gr.y=is[Ji+1],Vr.x=is[Ji+2],Vr.y=is[Ji+3],Ji===0&&Zr===!0&&qr.copy(Vr);break;case"T":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=2){const Ki=_r(Vr.x,Gr.x),Ni=_r(Vr.y,Gr.y);Qr.quadraticCurveTo(Ki,Ni,is[Ji+0],is[Ji+1]),Gr.x=Ki,Gr.y=Ni,Vr.x=is[Ji+0],Vr.y=is[Ji+1],Ji===0&&Zr===!0&&qr.copy(Vr)}break;case"A":is=mr(us,[3,4],7);for(let Ji=0,ms=is.length;Ji<ms;Ji+=7){if(is[Ji+5]==Vr.x&&is[Ji+6]==Vr.y)continue;const Ki=Vr.clone();Vr.x=is[Ji+5],Vr.y=is[Ji+6],Gr.x=Vr.x,Gr.y=Vr.y,ar(Qr,is[Ji],is[Ji+1],is[Ji+2],is[Ji+3],is[Ji+4],Ki,Vr),Ji===0&&Zr===!0&&qr.copy(Vr)}break;case"m":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=2)Vr.x+=is[Ji+0],Vr.y+=is[Ji+1],Gr.x=Vr.x,Gr.y=Vr.y,Ji===0?Qr.moveTo(Vr.x,Vr.y):Qr.lineTo(Vr.x,Vr.y),Ji===0&&qr.copy(Vr);break;case"h":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji++)Vr.x+=is[Ji],Gr.x=Vr.x,Gr.y=Vr.y,Qr.lineTo(Vr.x,Vr.y),Ji===0&&Zr===!0&&qr.copy(Vr);break;case"v":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji++)Vr.y+=is[Ji],Gr.x=Vr.x,Gr.y=Vr.y,Qr.lineTo(Vr.x,Vr.y),Ji===0&&Zr===!0&&qr.copy(Vr);break;case"l":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=2)Vr.x+=is[Ji+0],Vr.y+=is[Ji+1],Gr.x=Vr.x,Gr.y=Vr.y,Qr.lineTo(Vr.x,Vr.y),Ji===0&&Zr===!0&&qr.copy(Vr);break;case"c":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=6)Qr.bezierCurveTo(Vr.x+is[Ji+0],Vr.y+is[Ji+1],Vr.x+is[Ji+2],Vr.y+is[Ji+3],Vr.x+is[Ji+4],Vr.y+is[Ji+5]),Gr.x=Vr.x+is[Ji+2],Gr.y=Vr.y+is[Ji+3],Vr.x+=is[Ji+4],Vr.y+=is[Ji+5],Ji===0&&Zr===!0&&qr.copy(Vr);break;case"s":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=4)Qr.bezierCurveTo(_r(Vr.x,Gr.x),_r(Vr.y,Gr.y),Vr.x+is[Ji+0],Vr.y+is[Ji+1],Vr.x+is[Ji+2],Vr.y+is[Ji+3]),Gr.x=Vr.x+is[Ji+0],Gr.y=Vr.y+is[Ji+1],Vr.x+=is[Ji+2],Vr.y+=is[Ji+3],Ji===0&&Zr===!0&&qr.copy(Vr);break;case"q":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=4)Qr.quadraticCurveTo(Vr.x+is[Ji+0],Vr.y+is[Ji+1],Vr.x+is[Ji+2],Vr.y+is[Ji+3]),Gr.x=Vr.x+is[Ji+0],Gr.y=Vr.y+is[Ji+1],Vr.x+=is[Ji+2],Vr.y+=is[Ji+3],Ji===0&&Zr===!0&&qr.copy(Vr);break;case"t":is=mr(us);for(let Ji=0,ms=is.length;Ji<ms;Ji+=2){const Ki=_r(Vr.x,Gr.x),Ni=_r(Vr.y,Gr.y);Qr.quadraticCurveTo(Ki,Ni,Vr.x+is[Ji+0],Vr.y+is[Ji+1]),Gr.x=Ki,Gr.y=Ni,Vr.x=Vr.x+is[Ji+0],Vr.y=Vr.y+is[Ji+1],Ji===0&&Zr===!0&&qr.copy(Vr)}break;case"a":is=mr(us,[3,4],7);for(let Ji=0,ms=is.length;Ji<ms;Ji+=7){if(is[Ji+5]==0&&is[Ji+6]==0)continue;const Ki=Vr.clone();Vr.x+=is[Ji+5],Vr.y+=is[Ji+6],Gr.x=Vr.x,Gr.y=Vr.y,ar(Qr,is[Ji],is[Ji+1],is[Ji+2],is[Ji+3],is[Ji+4],Ki,Vr),Ji===0&&Zr===!0&&qr.copy(Vr)}break;case"Z":case"z":Qr.currentPath.autoClose=!0,Qr.currentPath.curves.length>0&&(Vr.copy(qr),Qr.currentPath.currentPoint.copy(Vr),ji=!0);break;default:console.warn(ns)}Zr=!1}return Qr}function sr(Kr){if(!(!Kr.sheet||!Kr.sheet.cssRules||!Kr.sheet.cssRules.length))for(let Qr=0;Qr<Kr.sheet.cssRules.length;Qr++){const Vr=Kr.sheet.cssRules[Qr];if(Vr.type!==1)continue;const Gr=Vr.selectorText.split(/,/gm).filter(Boolean).map(qr=>qr.trim());for(let qr=0;qr<Gr.length;qr++){const ji=Object.fromEntries(Object.entries(Vr.style).filter(([,Zr])=>Zr!==""));Fr[Gr[qr]]=Object.assign(Fr[Gr[qr]]||{},ji)}}}function ar(Kr,Qr,Vr,Gr,qr,ji,Zr,Zi){if(Qr==0||Vr==0){Kr.lineTo(Zi.x,Zi.y);return}Gr=Gr*Math.PI/180,Qr=Math.abs(Qr),Vr=Math.abs(Vr);const Yi=(Zr.x-Zi.x)/2,qi=(Zr.y-Zi.y)/2,Xr=Math.cos(Gr)*Yi+Math.sin(Gr)*qi,ns=-Math.sin(Gr)*Yi+Math.cos(Gr)*qi;let os=Qr*Qr,us=Vr*Vr;const is=Xr*Xr,Ji=ns*ns,ms=is/os+Ji/us;if(ms>1){const vs=Math.sqrt(ms);Qr=vs*Qr,Vr=vs*Vr,os=Qr*Qr,us=Vr*Vr}const Ki=os*Ji+us*is,Ni=(os*us-Ki)/Ki;let Ri=Math.sqrt(Math.max(0,Ni));qr===ji&&(Ri=-Ri);const Jr=Ri*Qr*ns/Vr,Xi=-Ri*Vr*Xr/Qr,ss=Math.cos(Gr)*Jr-Math.sin(Gr)*Xi+(Zr.x+Zi.x)/2,ls=Math.sin(Gr)*Jr+Math.cos(Gr)*Xi+(Zr.y+Zi.y)/2,gs=or(1,0,(Xr-Jr)/Qr,(ns-Xi)/Vr),_s=or((Xr-Jr)/Qr,(ns-Xi)/Vr,(-Xr-Jr)/Qr,(-ns-Xi)/Vr)%(Math.PI*2);Kr.currentPath.absellipse(ss,ls,Qr,Vr,gs,gs+_s,ji===0,Gr)}function or(Kr,Qr,Vr,Gr){const qr=Kr*Vr+Qr*Gr,ji=Math.sqrt(Kr*Kr+Qr*Qr)*Math.sqrt(Vr*Vr+Gr*Gr);let Zr=Math.acos(Math.max(-1,Math.min(1,qr/ji)));return Kr*Gr-Qr*Vr<0&&(Zr=-Zr),Zr}function lr(Kr){const Qr=Ar(Kr.getAttribute("x")||0),Vr=Ar(Kr.getAttribute("y")||0),Gr=Ar(Kr.getAttribute("rx")||Kr.getAttribute("ry")||0),qr=Ar(Kr.getAttribute("ry")||Kr.getAttribute("rx")||0),ji=Ar(Kr.getAttribute("width")),Zr=Ar(Kr.getAttribute("height")),Zi=1-.551915024494,Yi=new ShapePath;return Yi.moveTo(Qr+Gr,Vr),Yi.lineTo(Qr+ji-Gr,Vr),(Gr!==0||qr!==0)&&Yi.bezierCurveTo(Qr+ji-Gr*Zi,Vr,Qr+ji,Vr+qr*Zi,Qr+ji,Vr+qr),Yi.lineTo(Qr+ji,Vr+Zr-qr),(Gr!==0||qr!==0)&&Yi.bezierCurveTo(Qr+ji,Vr+Zr-qr*Zi,Qr+ji-Gr*Zi,Vr+Zr,Qr+ji-Gr,Vr+Zr),Yi.lineTo(Qr+Gr,Vr+Zr),(Gr!==0||qr!==0)&&Yi.bezierCurveTo(Qr+Gr*Zi,Vr+Zr,Qr,Vr+Zr-qr*Zi,Qr,Vr+Zr-qr),Yi.lineTo(Qr,Vr+qr),(Gr!==0||qr!==0)&&Yi.bezierCurveTo(Qr,Vr+qr*Zi,Qr+Gr*Zi,Vr,Qr+Gr,Vr),Yi}function cr(Kr){function Qr(ji,Zr,Zi){const Yi=Ar(Zr),qi=Ar(Zi);qr===0?Gr.moveTo(Yi,qi):Gr.lineTo(Yi,qi),qr++}const Vr=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,Gr=new ShapePath;let qr=0;return Kr.getAttribute("points").replace(Vr,Qr),Gr.currentPath.autoClose=!0,Gr}function hr(Kr){function Qr(ji,Zr,Zi){const Yi=Ar(Zr),qi=Ar(Zi);qr===0?Gr.moveTo(Yi,qi):Gr.lineTo(Yi,qi),qr++}const Vr=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,Gr=new ShapePath;let qr=0;return Kr.getAttribute("points").replace(Vr,Qr),Gr.currentPath.autoClose=!1,Gr}function fr(Kr){const Qr=Ar(Kr.getAttribute("cx")||0),Vr=Ar(Kr.getAttribute("cy")||0),Gr=Ar(Kr.getAttribute("r")||0),qr=new Path$1;qr.absarc(Qr,Vr,Gr,0,Math.PI*2);const ji=new ShapePath;return ji.subPaths.push(qr),ji}function ur(Kr){const Qr=Ar(Kr.getAttribute("cx")||0),Vr=Ar(Kr.getAttribute("cy")||0),Gr=Ar(Kr.getAttribute("rx")||0),qr=Ar(Kr.getAttribute("ry")||0),ji=new Path$1;ji.absellipse(Qr,Vr,Gr,qr,0,Math.PI*2);const Zr=new ShapePath;return Zr.subPaths.push(ji),Zr}function pr(Kr){const Qr=Ar(Kr.getAttribute("x1")||0),Vr=Ar(Kr.getAttribute("y1")||0),Gr=Ar(Kr.getAttribute("x2")||0),qr=Ar(Kr.getAttribute("y2")||0),ji=new ShapePath;return ji.moveTo(Qr,Vr),ji.lineTo(Gr,qr),ji.currentPath.autoClose=!1,ji}function gr(Kr,Qr){Qr=Object.assign({},Qr);let Vr={};if(Kr.hasAttribute("class")){const Zr=Kr.getAttribute("class").split(/\s/).filter(Boolean).map(Zi=>Zi.trim());for(let Zi=0;Zi<Zr.length;Zi++)Vr=Object.assign(Vr,Fr["."+Zr[Zi]])}Kr.hasAttribute("id")&&(Vr=Object.assign(Vr,Fr["#"+Kr.getAttribute("id")]));function Gr(Zr,Zi,Yi){Yi===void 0&&(Yi=function(Xr){return Xr.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),Xr}),Kr.hasAttribute(Zr)&&(Qr[Zi]=Yi(Kr.getAttribute(Zr))),Vr[Zr]&&(Qr[Zi]=Yi(Vr[Zr])),Kr.style&&Kr.style[Zr]!==""&&(Qr[Zi]=Yi(Kr.style[Zr]))}function qr(Zr){return Math.max(0,Math.min(1,Ar(Zr)))}function ji(Zr){return Math.max(0,Ar(Zr))}return Gr("fill","fill"),Gr("fill-opacity","fillOpacity",qr),Gr("fill-rule","fillRule"),Gr("opacity","opacity",qr),Gr("stroke","stroke"),Gr("stroke-opacity","strokeOpacity",qr),Gr("stroke-width","strokeWidth",ji),Gr("stroke-linejoin","strokeLineJoin"),Gr("stroke-linecap","strokeLineCap"),Gr("stroke-miterlimit","strokeMiterLimit",ji),Gr("visibility","visibility"),Qr}function _r(Kr,Qr){return Kr-(Qr-Kr)}function mr(Kr,Qr,Vr){if(typeof Kr!="string")throw new TypeError("Invalid input: "+typeof Kr);const Gr={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},qr=0,ji=1,Zr=2,Zi=3;let Yi=qr,qi=!0,Xr="",ns="";const os=[];function us(Ki,Ni,Ri){const Jr=new SyntaxError('Unexpected character "'+Ki+'" at index '+Ni+".");throw Jr.partial=Ri,Jr}function is(){Xr!==""&&(ns===""?os.push(Number(Xr)):os.push(Number(Xr)*Math.pow(10,Number(ns)))),Xr="",ns=""}let Ji;const ms=Kr.length;for(let Ki=0;Ki<ms;Ki++){if(Ji=Kr[Ki],Array.isArray(Qr)&&Qr.includes(os.length%Vr)&&Gr.FLAGS.test(Ji)){Yi=ji,Xr=Ji,is();continue}if(Yi===qr){if(Gr.WHITESPACE.test(Ji))continue;if(Gr.DIGIT.test(Ji)||Gr.SIGN.test(Ji)){Yi=ji,Xr=Ji;continue}if(Gr.POINT.test(Ji)){Yi=Zr,Xr=Ji;continue}Gr.COMMA.test(Ji)&&(qi&&us(Ji,Ki,os),qi=!0)}if(Yi===ji){if(Gr.DIGIT.test(Ji)){Xr+=Ji;continue}if(Gr.POINT.test(Ji)){Xr+=Ji,Yi=Zr;continue}if(Gr.EXP.test(Ji)){Yi=Zi;continue}Gr.SIGN.test(Ji)&&Xr.length===1&&Gr.SIGN.test(Xr[0])&&us(Ji,Ki,os)}if(Yi===Zr){if(Gr.DIGIT.test(Ji)){Xr+=Ji;continue}if(Gr.EXP.test(Ji)){Yi=Zi;continue}Gr.POINT.test(Ji)&&Xr[Xr.length-1]==="."&&us(Ji,Ki,os)}if(Yi===Zi){if(Gr.DIGIT.test(Ji)){ns+=Ji;continue}if(Gr.SIGN.test(Ji)){if(ns===""){ns+=Ji;continue}ns.length===1&&Gr.SIGN.test(ns)&&us(Ji,Ki,os)}}Gr.WHITESPACE.test(Ji)?(is(),Yi=qr,qi=!1):Gr.COMMA.test(Ji)?(is(),Yi=qr,qi=!0):Gr.SIGN.test(Ji)?(is(),Yi=ji,Xr=Ji):Gr.POINT.test(Ji)?(is(),Yi=Zr,Xr=Ji):us(Ji,Ki,os)}return is(),os}const dr=["mm","cm","in","pt","pc","px"],vr={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function Ar(Kr){let Qr="px";if(typeof Kr=="string"||Kr instanceof String)for(let Gr=0,qr=dr.length;Gr<qr;Gr++){const ji=dr[Gr];if(Kr.endsWith(ji)){Qr=ji,Kr=Kr.substring(0,Kr.length-ji.length);break}}let Vr;return Qr==="px"&&tr.defaultUnit!=="px"?Vr=vr.in[tr.defaultUnit]/tr.defaultDPI:(Vr=vr[Qr][tr.defaultUnit],Vr<0&&(Vr=vr[Qr].in*tr.defaultDPI)),Vr*parseFloat(Kr)}function yr(Kr){if(!(Kr.hasAttribute("transform")||Kr.nodeName==="use"&&(Kr.hasAttribute("x")||Kr.hasAttribute("y"))))return null;const Qr=wr(Kr);return Nr.length>0&&Qr.premultiply(Nr[Nr.length-1]),Yr.copy(Qr),Nr.push(Qr),Qr}function wr(Kr){const Qr=new Matrix3,Vr=Ur;if(Kr.nodeName==="use"&&(Kr.hasAttribute("x")||Kr.hasAttribute("y"))){const Gr=Ar(Kr.getAttribute("x")),qr=Ar(Kr.getAttribute("y"));Qr.translate(Gr,qr)}if(Kr.hasAttribute("transform")){const Gr=Kr.getAttribute("transform").split(")");for(let qr=Gr.length-1;qr>=0;qr--){const ji=Gr[qr].trim();if(ji==="")continue;const Zr=ji.indexOf("("),Zi=ji.length;if(Zr>0&&Zr<Zi){const Yi=ji.slice(0,Zr),qi=mr(ji.slice(Zr+1));switch(Vr.identity(),Yi){case"translate":if(qi.length>=1){const Xr=qi[0];let ns=0;qi.length>=2&&(ns=qi[1]),Vr.translate(Xr,ns)}break;case"rotate":if(qi.length>=1){let Xr=0,ns=0,os=0;Xr=qi[0]*Math.PI/180,qi.length>=3&&(ns=qi[1],os=qi[2]),Br.makeTranslation(-ns,-os),Or.makeRotation(Xr),Dr.multiplyMatrices(Or,Br),Br.makeTranslation(ns,os),Vr.multiplyMatrices(Br,Dr)}break;case"scale":if(qi.length>=1){const Xr=qi[0];let ns=Xr;qi.length>=2&&(ns=qi[1]),Vr.scale(Xr,ns)}break;case"skewX":qi.length===1&&Vr.set(1,Math.tan(qi[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":qi.length===1&&Vr.set(1,0,0,Math.tan(qi[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":qi.length===6&&Vr.set(qi[0],qi[2],qi[4],qi[1],qi[3],qi[5],0,0,1);break}}Qr.premultiply(Vr)}}return Qr}function br(Kr,Qr){function Vr(Zr){$r.set(Zr.x,Zr.y,1).applyMatrix3(Qr),Zr.set($r.x,$r.y)}function Gr(Zr){const Zi=Zr.xRadius,Yi=Zr.yRadius,qi=Math.cos(Zr.aRotation),Xr=Math.sin(Zr.aRotation),ns=new Vector3$1(Zi*qi,Zi*Xr,0),os=new Vector3$1(-Yi*Xr,Yi*qi,0),us=ns.applyMatrix3(Qr),is=os.applyMatrix3(Qr),Ji=Ur.set(us.x,is.x,0,us.y,is.y,0,0,0,1),ms=Br.copy(Ji).invert(),Ri=Or.copy(ms).transpose().multiply(ms).elements,Jr=Rr(Ri[0],Ri[1],Ri[4]),Xi=Math.sqrt(Jr.rt1),ss=Math.sqrt(Jr.rt2);if(Zr.xRadius=1/Xi,Zr.yRadius=1/ss,Zr.aRotation=Math.atan2(Jr.sn,Jr.cs),!((Zr.aEndAngle-Zr.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const gs=Br.set(Xi,0,0,0,ss,0,0,0,1),_s=Or.set(Jr.cs,Jr.sn,0,-Jr.sn,Jr.cs,0,0,0,1),vs=gs.multiply(_s).multiply(Ji),As=Ss=>{const{x:Is,y:Fs}=new Vector3$1(Math.cos(Ss),Math.sin(Ss),0).applyMatrix3(vs);return Math.atan2(Fs,Is)};Zr.aStartAngle=As(Zr.aStartAngle),Zr.aEndAngle=As(Zr.aEndAngle),Sr(Qr)&&(Zr.aClockwise=!Zr.aClockwise)}}function qr(Zr){const Zi=Cr(Qr),Yi=Ir(Qr);Zr.xRadius*=Zi,Zr.yRadius*=Yi;const qi=Zi>Number.EPSILON?Math.atan2(Qr.elements[1],Qr.elements[0]):Math.atan2(-Qr.elements[3],Qr.elements[4]);Zr.aRotation+=qi,Sr(Qr)&&(Zr.aStartAngle*=-1,Zr.aEndAngle*=-1,Zr.aClockwise=!Zr.aClockwise)}const ji=Kr.subPaths;for(let Zr=0,Zi=ji.length;Zr<Zi;Zr++){const qi=ji[Zr].curves;for(let Xr=0;Xr<qi.length;Xr++){const ns=qi[Xr];ns.isLineCurve?(Vr(ns.v1),Vr(ns.v2)):ns.isCubicBezierCurve?(Vr(ns.v0),Vr(ns.v1),Vr(ns.v2),Vr(ns.v3)):ns.isQuadraticBezierCurve?(Vr(ns.v0),Vr(ns.v1),Vr(ns.v2)):ns.isEllipseCurve&&(Wr.set(ns.aX,ns.aY),Vr(Wr),ns.aX=Wr.x,ns.aY=Wr.y,xr(Qr)?Gr(ns):qr(ns))}}}function Sr(Kr){const Qr=Kr.elements;return Qr[0]*Qr[4]-Qr[1]*Qr[3]<0}function xr(Kr){const Qr=Kr.elements,Vr=Qr[0]*Qr[3]+Qr[1]*Qr[4];if(Vr===0)return!1;const Gr=Cr(Kr),qr=Ir(Kr);return Math.abs(Vr/(Gr*qr))>Number.EPSILON}function Cr(Kr){const Qr=Kr.elements;return Math.sqrt(Qr[0]*Qr[0]+Qr[1]*Qr[1])}function Ir(Kr){const Qr=Kr.elements;return Math.sqrt(Qr[3]*Qr[3]+Qr[4]*Qr[4])}function Rr(Kr,Qr,Vr){let Gr,qr,ji,Zr,Zi;const Yi=Kr+Vr,qi=Kr-Vr,Xr=Math.sqrt(qi*qi+4*Qr*Qr);return Yi>0?(Gr=.5*(Yi+Xr),Zi=1/Gr,qr=Kr*Zi*Vr-Qr*Zi*Qr):Yi<0?qr=.5*(Yi-Xr):(Gr=.5*Xr,qr=-.5*Xr),qi>0?ji=qi+Xr:ji=qi-Xr,Math.abs(ji)>2*Math.abs(Qr)?(Zi=-2*Qr/ji,Zr=1/Math.sqrt(1+Zi*Zi),ji=Zi*Zr):Math.abs(Qr)===0?(ji=1,Zr=0):(Zi=-.5*ji/Qr,ji=1/Math.sqrt(1+Zi*Zi),Zr=Zi*ji),qi>0&&(Zi=ji,ji=-Zr,Zr=Zi),{rt1:Gr,rt2:qr,cs:ji,sn:Zr}}const Pr=[],Fr={},Nr=[],Ur=new Matrix3,Br=new Matrix3,Or=new Matrix3,Dr=new Matrix3,Wr=new Vector2,$r=new Vector3$1,Yr=new Matrix3,Qi=new DOMParser().parseFromString(er,"image/svg+xml");return rr(Qi.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:Pr,xml:Qi.documentElement}}static createShapes(er){const rr={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},nr={loc:rr.ORIGIN,t:0};function sr(_r,mr,dr,vr){const Ar=_r.x,yr=mr.x,wr=dr.x,br=vr.x,Sr=_r.y,xr=mr.y,Cr=dr.y,Ir=vr.y,Rr=(br-wr)*(Sr-Cr)-(Ir-Cr)*(Ar-wr),Pr=(yr-Ar)*(Sr-Cr)-(xr-Sr)*(Ar-wr),Fr=(Ir-Cr)*(yr-Ar)-(br-wr)*(xr-Sr),Nr=Rr/Fr,Ur=Pr/Fr;if(Fr===0&&Rr!==0||Nr<=0||Nr>=1||Ur<0||Ur>1)return null;if(Rr===0&&Fr===0){for(let Br=0;Br<2;Br++)if(ar(Br===0?dr:vr,_r,mr),nr.loc==rr.ORIGIN){const Or=Br===0?dr:vr;return{x:Or.x,y:Or.y,t:nr.t}}else if(nr.loc==rr.BETWEEN){const Or=+(Ar+nr.t*(yr-Ar)).toPrecision(10),Dr=+(Sr+nr.t*(xr-Sr)).toPrecision(10);return{x:Or,y:Dr,t:nr.t}}return null}else{for(let Dr=0;Dr<2;Dr++)if(ar(Dr===0?dr:vr,_r,mr),nr.loc==rr.ORIGIN){const Wr=Dr===0?dr:vr;return{x:Wr.x,y:Wr.y,t:nr.t}}const Br=+(Ar+Nr*(yr-Ar)).toPrecision(10),Or=+(Sr+Nr*(xr-Sr)).toPrecision(10);return{x:Br,y:Or,t:Nr}}}function ar(_r,mr,dr){const vr=dr.x-mr.x,Ar=dr.y-mr.y,yr=_r.x-mr.x,wr=_r.y-mr.y,br=vr*wr-yr*Ar;if(_r.x===mr.x&&_r.y===mr.y){nr.loc=rr.ORIGIN,nr.t=0;return}if(_r.x===dr.x&&_r.y===dr.y){nr.loc=rr.DESTINATION,nr.t=1;return}if(br<-Number.EPSILON){nr.loc=rr.LEFT;return}if(br>Number.EPSILON){nr.loc=rr.RIGHT;return}if(vr*yr<0||Ar*wr<0){nr.loc=rr.BEHIND;return}if(Math.sqrt(vr*vr+Ar*Ar)<Math.sqrt(yr*yr+wr*wr)){nr.loc=rr.BEYOND;return}let Sr;vr!==0?Sr=yr/vr:Sr=wr/Ar,nr.loc=rr.BETWEEN,nr.t=Sr}function or(_r,mr){const dr=[],vr=[];for(let Ar=1;Ar<_r.length;Ar++){const yr=_r[Ar-1],wr=_r[Ar];for(let br=1;br<mr.length;br++){const Sr=mr[br-1],xr=mr[br],Cr=sr(yr,wr,Sr,xr);Cr!==null&&dr.find(Ir=>Ir.t<=Cr.t+Number.EPSILON&&Ir.t>=Cr.t-Number.EPSILON)===void 0&&(dr.push(Cr),vr.push(new Vector2(Cr.x,Cr.y)))}}return vr}function lr(_r,mr,dr){const vr=new Vector2;mr.getCenter(vr);const Ar=[];return dr.forEach(yr=>{yr.boundingBox.containsPoint(vr)&&or(_r,yr.points).forEach(br=>{Ar.push({identifier:yr.identifier,isCW:yr.isCW,point:br})})}),Ar.sort((yr,wr)=>yr.point.x-wr.point.x),Ar}function cr(_r,mr,dr,vr,Ar){(Ar==null||Ar==="")&&(Ar="nonzero");const yr=new Vector2;_r.boundingBox.getCenter(yr);const wr=[new Vector2(dr,yr.y),new Vector2(vr,yr.y)],br=lr(wr,_r.boundingBox,mr);br.sort((Pr,Fr)=>Pr.point.x-Fr.point.x);const Sr=[],xr=[];br.forEach(Pr=>{Pr.identifier===_r.identifier?Sr.push(Pr):xr.push(Pr)});const Cr=Sr[0].point.x,Ir=[];let Rr=0;for(;Rr<xr.length&&xr[Rr].point.x<Cr;)Ir.length>0&&Ir[Ir.length-1]===xr[Rr].identifier?Ir.pop():Ir.push(xr[Rr].identifier),Rr++;if(Ir.push(_r.identifier),Ar==="evenodd"){const Pr=Ir.length%2===0,Fr=Ir[Ir.length-2];return{identifier:_r.identifier,isHole:Pr,for:Fr}}else if(Ar==="nonzero"){let Pr=!0,Fr=null,Nr=null;for(let Ur=0;Ur<Ir.length;Ur++){const Br=Ir[Ur];Pr?(Nr=mr[Br].isCW,Pr=!1,Fr=Br):Nr!==mr[Br].isCW&&(Nr=mr[Br].isCW,Pr=!0)}return{identifier:_r.identifier,isHole:Pr,for:Fr}}else console.warn('fill-rule: "'+Ar+'" is currently not implemented.')}let hr=999999999,fr=-999999999,ur=er.subPaths.map(_r=>{const mr=_r.getPoints();let dr=-999999999,vr=999999999,Ar=-999999999,yr=999999999;for(let wr=0;wr<mr.length;wr++){const br=mr[wr];br.y>dr&&(dr=br.y),br.y<vr&&(vr=br.y),br.x>Ar&&(Ar=br.x),br.x<yr&&(yr=br.x)}return fr<=Ar&&(fr=Ar+1),hr>=yr&&(hr=yr-1),{curves:_r.curves,points:mr,isCW:ShapeUtils.isClockWise(mr),identifier:-1,boundingBox:new Box2(new Vector2(yr,vr),new Vector2(Ar,dr))}});ur=ur.filter(_r=>_r.points.length>1);for(let _r=0;_r<ur.length;_r++)ur[_r].identifier=_r;const pr=ur.map(_r=>cr(_r,ur,hr,fr,er.userData?er.userData.style.fillRule:void 0)),gr=[];return ur.forEach(_r=>{if(!pr[_r.identifier].isHole){const dr=new Shape$1;dr.curves=_r.curves,pr.filter(Ar=>Ar.isHole&&Ar.for===_r.identifier).forEach(Ar=>{const yr=ur[Ar.identifier],wr=new Path$1;wr.curves=yr.curves,dr.holes.push(wr)}),gr.push(dr)}}),gr}static getStrokeStyle(er,tr,rr,nr,sr){return er=er!==void 0?er:1,tr=tr!==void 0?tr:"#000",rr=rr!==void 0?rr:"miter",nr=nr!==void 0?nr:"butt",sr=sr!==void 0?sr:4,{strokeColor:tr,strokeWidth:er,strokeLineJoin:rr,strokeLineCap:nr,strokeMiterLimit:sr}}static pointsToStroke(er,tr,rr,nr){const sr=[],ar=[],or=[];if(SVGLoader.pointsToStrokeWithBuffers(er,tr,rr,nr,sr,ar,or)===0)return null;const lr=new BufferGeometry;return lr.setAttribute("position",new Float32BufferAttribute(sr,3)),lr.setAttribute("normal",new Float32BufferAttribute(ar,3)),lr.setAttribute("uv",new Float32BufferAttribute(or,2)),lr}static pointsToStrokeWithBuffers(er,tr,rr,nr,sr,ar,or,lr){const cr=new Vector2,hr=new Vector2,fr=new Vector2,ur=new Vector2,pr=new Vector2,gr=new Vector2,_r=new Vector2,mr=new Vector2,dr=new Vector2,vr=new Vector2,Ar=new Vector2,yr=new Vector2,wr=new Vector2,br=new Vector2,Sr=new Vector2,xr=new Vector2,Cr=new Vector2;rr=rr!==void 0?rr:12,nr=nr!==void 0?nr:.001,lr=lr!==void 0?lr:0,er=qi(er);const Ir=er.length;if(Ir<2)return 0;const Rr=er[0].equals(er[Ir-1]);let Pr,Fr=er[0],Nr;const Ur=tr.strokeWidth/2,Br=1/(Ir-1);let Or=0,Dr,Wr,$r,Yr,Qi=!1,rs=0,Kr=lr*3,Qr=lr*2;Vr(er[0],er[1],cr).multiplyScalar(Ur),mr.copy(er[0]).sub(cr),dr.copy(er[0]).add(cr),vr.copy(mr),Ar.copy(dr);for(let Xr=1;Xr<Ir;Xr++){Pr=er[Xr],Xr===Ir-1?Rr?Nr=er[1]:Nr=void 0:Nr=er[Xr+1];const ns=cr;if(Vr(Fr,Pr,ns),fr.copy(ns).multiplyScalar(Ur),yr.copy(Pr).sub(fr),wr.copy(Pr).add(fr),Dr=Or+Br,Wr=!1,Nr!==void 0){Vr(Pr,Nr,hr),fr.copy(hr).multiplyScalar(Ur),br.copy(Pr).sub(fr),Sr.copy(Pr).add(fr),$r=!0,fr.subVectors(Nr,Fr),ns.dot(fr)<0&&($r=!1),Xr===1&&(Qi=$r),fr.subVectors(Nr,Pr),fr.normalize();const os=Math.abs(ns.dot(fr));if(os>Number.EPSILON){const us=Ur/os;fr.multiplyScalar(-us),ur.subVectors(Pr,Fr),pr.copy(ur).setLength(us).add(fr),xr.copy(pr).negate();const is=pr.length(),Ji=ur.length();ur.divideScalar(Ji),gr.subVectors(Nr,Pr);const ms=gr.length();switch(gr.divideScalar(ms),ur.dot(xr)<Ji&&gr.dot(xr)<ms&&(Wr=!0),Cr.copy(pr).add(Pr),xr.add(Pr),Yr=!1,Wr?$r?(Sr.copy(xr),wr.copy(xr)):(br.copy(xr),yr.copy(xr)):ji(),tr.strokeLineJoin){case"bevel":Zr($r,Wr,Dr);break;case"round":Zi($r,Wr),$r?qr(Pr,yr,br,Dr,0):qr(Pr,Sr,wr,Dr,1);break;case"miter":case"miter-clip":default:const Ki=Ur*tr.strokeMiterLimit/is;if(Ki<1)if(tr.strokeLineJoin!=="miter-clip"){Zr($r,Wr,Dr);break}else Zi($r,Wr),$r?(gr.subVectors(Cr,yr).multiplyScalar(Ki).add(yr),_r.subVectors(Cr,br).multiplyScalar(Ki).add(br),Gr(yr,Dr,0),Gr(gr,Dr,0),Gr(Pr,Dr,.5),Gr(Pr,Dr,.5),Gr(gr,Dr,0),Gr(_r,Dr,0),Gr(Pr,Dr,.5),Gr(_r,Dr,0),Gr(br,Dr,0)):(gr.subVectors(Cr,wr).multiplyScalar(Ki).add(wr),_r.subVectors(Cr,Sr).multiplyScalar(Ki).add(Sr),Gr(wr,Dr,1),Gr(gr,Dr,1),Gr(Pr,Dr,.5),Gr(Pr,Dr,.5),Gr(gr,Dr,1),Gr(_r,Dr,1),Gr(Pr,Dr,.5),Gr(_r,Dr,1),Gr(Sr,Dr,1));else Wr?($r?(Gr(dr,Or,1),Gr(mr,Or,0),Gr(Cr,Dr,0),Gr(dr,Or,1),Gr(Cr,Dr,0),Gr(xr,Dr,1)):(Gr(dr,Or,1),Gr(mr,Or,0),Gr(Cr,Dr,1),Gr(mr,Or,0),Gr(xr,Dr,0),Gr(Cr,Dr,1)),$r?br.copy(Cr):Sr.copy(Cr)):$r?(Gr(yr,Dr,0),Gr(Cr,Dr,0),Gr(Pr,Dr,.5),Gr(Pr,Dr,.5),Gr(Cr,Dr,0),Gr(br,Dr,0)):(Gr(wr,Dr,1),Gr(Cr,Dr,1),Gr(Pr,Dr,.5),Gr(Pr,Dr,.5),Gr(Cr,Dr,1),Gr(Sr,Dr,1)),Yr=!0;break}}else ji()}else ji();!Rr&&Xr===Ir-1&&Yi(er[0],vr,Ar,$r,!0,Or),Or=Dr,Fr=Pr,mr.copy(br),dr.copy(Sr)}if(!Rr)Yi(Pr,yr,wr,$r,!1,Dr);else if(Wr&&sr){let Xr=Cr,ns=xr;Qi!==$r&&(Xr=xr,ns=Cr),$r?(Yr||Qi)&&(ns.toArray(sr,0*3),ns.toArray(sr,3*3),Yr&&Xr.toArray(sr,1*3)):(Yr||!Qi)&&(ns.toArray(sr,1*3),ns.toArray(sr,3*3),Yr&&Xr.toArray(sr,0*3))}return rs;function Vr(Xr,ns,os){return os.subVectors(ns,Xr),os.set(-os.y,os.x).normalize()}function Gr(Xr,ns,os){sr&&(sr[Kr]=Xr.x,sr[Kr+1]=Xr.y,sr[Kr+2]=0,ar&&(ar[Kr]=0,ar[Kr+1]=0,ar[Kr+2]=1),Kr+=3,or&&(or[Qr]=ns,or[Qr+1]=os,Qr+=2)),rs+=3}function qr(Xr,ns,os,us,is){cr.copy(ns).sub(Xr).normalize(),hr.copy(os).sub(Xr).normalize();let Ji=Math.PI;const ms=cr.dot(hr);Math.abs(ms)<1&&(Ji=Math.abs(Math.acos(ms))),Ji/=rr,fr.copy(ns);for(let Ki=0,Ni=rr-1;Ki<Ni;Ki++)ur.copy(fr).rotateAround(Xr,Ji),Gr(fr,us,is),Gr(ur,us,is),Gr(Xr,us,.5),fr.copy(ur);Gr(ur,us,is),Gr(os,us,is),Gr(Xr,us,.5)}function ji(){Gr(dr,Or,1),Gr(mr,Or,0),Gr(yr,Dr,0),Gr(dr,Or,1),Gr(yr,Dr,0),Gr(wr,Dr,1)}function Zr(Xr,ns,os){ns?Xr?(Gr(dr,Or,1),Gr(mr,Or,0),Gr(yr,Dr,0),Gr(dr,Or,1),Gr(yr,Dr,0),Gr(xr,Dr,1),Gr(yr,os,0),Gr(br,os,0),Gr(xr,os,.5)):(Gr(dr,Or,1),Gr(mr,Or,0),Gr(wr,Dr,1),Gr(mr,Or,0),Gr(xr,Dr,0),Gr(wr,Dr,1),Gr(wr,os,1),Gr(xr,os,0),Gr(Sr,os,1)):Xr?(Gr(yr,os,0),Gr(br,os,0),Gr(Pr,os,.5)):(Gr(wr,os,1),Gr(Sr,os,0),Gr(Pr,os,.5))}function Zi(Xr,ns){ns&&(Xr?(Gr(dr,Or,1),Gr(mr,Or,0),Gr(yr,Dr,0),Gr(dr,Or,1),Gr(yr,Dr,0),Gr(xr,Dr,1),Gr(yr,Or,0),Gr(Pr,Dr,.5),Gr(xr,Dr,1),Gr(Pr,Dr,.5),Gr(br,Or,0),Gr(xr,Dr,1)):(Gr(dr,Or,1),Gr(mr,Or,0),Gr(wr,Dr,1),Gr(mr,Or,0),Gr(xr,Dr,0),Gr(wr,Dr,1),Gr(wr,Or,1),Gr(xr,Dr,0),Gr(Pr,Dr,.5),Gr(Pr,Dr,.5),Gr(xr,Dr,0),Gr(Sr,Or,1)))}function Yi(Xr,ns,os,us,is,Ji){switch(tr.strokeLineCap){case"round":is?qr(Xr,os,ns,Ji,.5):qr(Xr,ns,os,Ji,.5);break;case"square":if(is)cr.subVectors(ns,Xr),hr.set(cr.y,-cr.x),fr.addVectors(cr,hr).add(Xr),ur.subVectors(hr,cr).add(Xr),us?(fr.toArray(sr,1*3),ur.toArray(sr,0*3),ur.toArray(sr,3*3)):(fr.toArray(sr,1*3),or[3*2+1]===1?ur.toArray(sr,3*3):fr.toArray(sr,3*3),ur.toArray(sr,0*3));else{cr.subVectors(os,Xr),hr.set(cr.y,-cr.x),fr.addVectors(cr,hr).add(Xr),ur.subVectors(hr,cr).add(Xr);const ms=sr.length;us?(fr.toArray(sr,ms-1*3),ur.toArray(sr,ms-2*3),ur.toArray(sr,ms-4*3)):(ur.toArray(sr,ms-2*3),fr.toArray(sr,ms-1*3),ur.toArray(sr,ms-4*3))}break;case"butt":default:break}}function qi(Xr){let ns=!1;for(let us=1,is=Xr.length-1;us<is;us++)if(Xr[us].distanceTo(Xr[us+1])<nr){ns=!0;break}if(!ns)return Xr;const os=[];os.push(Xr[0]);for(let us=1,is=Xr.length-1;us<is;us++)Xr[us].distanceTo(Xr[us+1])>=nr&&os.push(Xr[us]);return os.push(Xr[Xr.length-1]),os}}}class TDSLoader extends Loader{constructor(er){super(er),this.debug=!1,this.group=null,this.materials=[],this.meshes=[]}load(er,tr,rr,nr){const sr=this,ar=this.path===""?LoaderUtils.extractUrlBase(er):this.path,or=new FileLoader(this.manager);or.setPath(this.path),or.setResponseType("arraybuffer"),or.setRequestHeader(this.requestHeader),or.setWithCredentials(this.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},rr,nr)}parse(er,tr){this.group=new Group,this.materials=[],this.meshes=[],this.readFile(er,tr);for(let rr=0;rr<this.meshes.length;rr++)this.group.add(this.meshes[rr]);return this.group}readFile(er,tr){const rr=new DataView(er),nr=new Chunk(rr,0,this.debugMessage);if(nr.id===MLIBMAGIC||nr.id===CMAGIC||nr.id===M3DMAGIC){let sr=nr.readChunk();for(;sr;){if(sr.id===M3D_VERSION){const ar=sr.readDWord();this.debugMessage("3DS file version: "+ar)}else sr.id===MDATA?this.readMeshData(sr,tr):this.debugMessage("Unknown main chunk: "+sr.hexId);sr=nr.readChunk()}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(er,tr){let rr=er.readChunk();for(;rr;){if(rr.id===MESH_VERSION){const nr=+rr.readDWord();this.debugMessage("Mesh Version: "+nr)}else if(rr.id===MASTER_SCALE){const nr=rr.readFloat();this.debugMessage("Master scale: "+nr),this.group.scale.set(nr,nr,nr)}else rr.id===NAMED_OBJECT?(this.debugMessage("Named Object"),this.readNamedObject(rr)):rr.id===MAT_ENTRY?(this.debugMessage("Material"),this.readMaterialEntry(rr,tr)):this.debugMessage("Unknown MDATA chunk: "+rr.hexId);rr=er.readChunk()}}readNamedObject(er){const tr=er.readString();let rr=er.readChunk();for(;rr;){if(rr.id===N_TRI_OBJECT){const nr=this.readMesh(rr);nr.name=tr,this.meshes.push(nr)}else this.debugMessage("Unknown named object chunk: "+rr.hexId);rr=er.readChunk()}}readMaterialEntry(er,tr){let rr=er.readChunk();const nr=new MeshPhongMaterial;for(;rr;){if(rr.id===MAT_NAME)nr.name=rr.readString(),this.debugMessage("   Name: "+nr.name);else if(rr.id===MAT_WIRE)this.debugMessage("   Wireframe"),nr.wireframe=!0;else if(rr.id===MAT_WIRE_SIZE){const sr=rr.readByte();nr.wireframeLinewidth=sr,this.debugMessage("   Wireframe Thickness: "+sr)}else if(rr.id===MAT_TWO_SIDE)nr.side=DoubleSide,this.debugMessage("   DoubleSided");else if(rr.id===MAT_ADDITIVE)this.debugMessage("   Additive Blending"),nr.blending=AdditiveBlending;else if(rr.id===MAT_DIFFUSE)this.debugMessage("   Diffuse Color"),nr.color=this.readColor(rr);else if(rr.id===MAT_SPECULAR)this.debugMessage("   Specular Color"),nr.specular=this.readColor(rr);else if(rr.id===MAT_AMBIENT)this.debugMessage("   Ambient color"),nr.color=this.readColor(rr);else if(rr.id===MAT_SHININESS){const sr=this.readPercentage(rr);nr.shininess=sr*100,this.debugMessage("   Shininess : "+sr)}else if(rr.id===MAT_TRANSPARENCY){const sr=this.readPercentage(rr);nr.opacity=1-sr,this.debugMessage("  Transparency : "+sr),nr.transparent=nr.opacity<1}else rr.id===MAT_TEXMAP?(this.debugMessage("   ColorMap"),nr.map=this.readMap(rr,tr)):rr.id===MAT_BUMPMAP?(this.debugMessage("   BumpMap"),nr.bumpMap=this.readMap(rr,tr)):rr.id===MAT_OPACMAP?(this.debugMessage("   OpacityMap"),nr.alphaMap=this.readMap(rr,tr)):rr.id===MAT_SPECMAP?(this.debugMessage("   SpecularMap"),nr.specularMap=this.readMap(rr,tr)):this.debugMessage("   Unknown material chunk: "+rr.hexId);rr=er.readChunk()}this.materials[nr.name]=nr}readMesh(er){let tr=er.readChunk();const rr=new BufferGeometry,nr=new MeshPhongMaterial,sr=new Mesh(rr,nr);for(sr.name="mesh";tr;){if(tr.id===POINT_ARRAY){const ar=tr.readWord();this.debugMessage("   Vertex: "+ar);const or=[];for(let lr=0;lr<ar;lr++)or.push(tr.readFloat()),or.push(tr.readFloat()),or.push(tr.readFloat());rr.setAttribute("position",new Float32BufferAttribute(or,3))}else if(tr.id===FACE_ARRAY)this.readFaceArray(tr,sr);else if(tr.id===TEX_VERTS){const ar=tr.readWord();this.debugMessage("   UV: "+ar);const or=[];for(let lr=0;lr<ar;lr++)or.push(tr.readFloat()),or.push(tr.readFloat());rr.setAttribute("uv",new Float32BufferAttribute(or,2))}else if(tr.id===MESH_MATRIX){this.debugMessage("   Transformation Matrix (TODO)");const ar=[];for(let cr=0;cr<12;cr++)ar[cr]=tr.readFloat();const or=new Matrix4;or.elements[0]=ar[0],or.elements[1]=ar[6],or.elements[2]=ar[3],or.elements[3]=ar[9],or.elements[4]=ar[2],or.elements[5]=ar[8],or.elements[6]=ar[5],or.elements[7]=ar[11],or.elements[8]=ar[1],or.elements[9]=ar[7],or.elements[10]=ar[4],or.elements[11]=ar[10],or.elements[12]=0,or.elements[13]=0,or.elements[14]=0,or.elements[15]=1,or.transpose();const lr=new Matrix4;lr.copy(or).invert(),rr.applyMatrix4(lr),or.decompose(sr.position,sr.quaternion,sr.scale)}else this.debugMessage("   Unknown mesh chunk: "+tr.hexId);tr=er.readChunk()}return rr.computeVertexNormals(),sr}readFaceArray(er,tr){const rr=er.readWord();this.debugMessage("   Faces: "+rr);const nr=[];for(let or=0;or<rr;++or)nr.push(er.readWord(),er.readWord(),er.readWord()),er.readWord();tr.geometry.setIndex(nr);let sr=0,ar=0;for(;!er.endOfChunk;){const or=er.readChunk();if(or.id===MSH_MAT_GROUP){this.debugMessage("      Material Group");const lr=this.readMaterialGroup(or),cr=lr.index.length*3;tr.geometry.addGroup(ar,cr,sr),ar+=cr,sr++;const hr=this.materials[lr.name];Array.isArray(tr.material)===!1&&(tr.material=[]),hr!==void 0&&tr.material.push(hr)}else this.debugMessage("      Unknown face array chunk: "+or.hexId)}tr.material.length===1&&(tr.material=tr.material[0])}readMap(er,tr){let rr=er.readChunk(),nr={};const sr=new TextureLoader(this.manager);for(sr.setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin);rr;){if(rr.id===MAT_MAPNAME){const ar=rr.readString();nr=sr.load(ar),this.debugMessage("      File: "+tr+ar)}else rr.id===MAT_MAP_UOFFSET?(nr.offset.x=rr.readFloat(),this.debugMessage("      OffsetX: "+nr.offset.x)):rr.id===MAT_MAP_VOFFSET?(nr.offset.y=rr.readFloat(),this.debugMessage("      OffsetY: "+nr.offset.y)):rr.id===MAT_MAP_USCALE?(nr.repeat.x=rr.readFloat(),this.debugMessage("      RepeatX: "+nr.repeat.x)):rr.id===MAT_MAP_VSCALE?(nr.repeat.y=rr.readFloat(),this.debugMessage("      RepeatY: "+nr.repeat.y)):this.debugMessage("      Unknown map chunk: "+rr.hexId);rr=er.readChunk()}return nr}readMaterialGroup(er){const tr=er.readString(),rr=er.readWord();this.debugMessage("         Name: "+tr),this.debugMessage("         Faces: "+rr);const nr=[];for(let sr=0;sr<rr;++sr)nr.push(er.readWord());return{name:tr,index:nr}}readColor(er){const tr=er.readChunk(),rr=new Color;if(tr.id===COLOR_24||tr.id===LIN_COLOR_24){const nr=tr.readByte(),sr=tr.readByte(),ar=tr.readByte();rr.setRGB(nr/255,sr/255,ar/255),this.debugMessage("      Color: "+rr.r+", "+rr.g+", "+rr.b)}else if(tr.id===COLOR_F||tr.id===LIN_COLOR_F){const nr=tr.readFloat(),sr=tr.readFloat(),ar=tr.readFloat();rr.setRGB(nr,sr,ar),this.debugMessage("      Color: "+rr.r+", "+rr.g+", "+rr.b)}else this.debugMessage("      Unknown color chunk: "+tr.hexId);return rr}readPercentage(er){const tr=er.readChunk();switch(tr.id){case INT_PERCENTAGE:return tr.readShort()/100;case FLOAT_PERCENTAGE:return tr.readFloat();default:return this.debugMessage("      Unknown percentage chunk: "+tr.hexId),0}}debugMessage(er){this.debug&&console.log(er)}}class Chunk{constructor(er,tr,rr){this.data=er,this.offset=tr,this.position=tr,this.debugMessage=rr,this.debugMessage instanceof Function&&(this.debugMessage=function(){}),this.id=this.readWord(),this.size=this.readDWord(),this.end=this.offset+this.size,this.end>er.byteLength&&this.debugMessage("Bad chunk size for chunk at "+tr)}readChunk(){if(this.endOfChunk)return null;try{const er=new Chunk(this.data,this.position,this.debugMessage);return this.position+=er.size,er}catch{return this.debugMessage("Unable to read chunk at "+this.position),null}}get hexId(){return this.id.toString(16)}get endOfChunk(){return this.position>=this.end}readByte(){const er=this.data.getUint8(this.position,!0);return this.position+=1,er}readFloat(){try{const er=this.data.getFloat32(this.position,!0);return this.position+=4,er}catch(er){return this.debugMessage(er+" "+this.position+" "+this.data.byteLength),0}}readInt(){const er=this.data.getInt32(this.position,!0);return this.position+=4,er}readShort(){const er=this.data.getInt16(this.position,!0);return this.position+=2,er}readDWord(){const er=this.data.getUint32(this.position,!0);return this.position+=4,er}readWord(){const er=this.data.getUint16(this.position,!0);return this.position+=2,er}readString(){let er="",tr=this.readByte();for(;tr;)er+=String.fromCharCode(tr),tr=this.readByte();return er}}const M3DMAGIC=19789,MLIBMAGIC=15786,CMAGIC=49725,M3D_VERSION=2,COLOR_F=16,COLOR_24=17,LIN_COLOR_24=18,LIN_COLOR_F=19,INT_PERCENTAGE=48,FLOAT_PERCENTAGE=49,MDATA=15677,MESH_VERSION=15678,MASTER_SCALE=256,MAT_ENTRY=45055,MAT_NAME=40960,MAT_AMBIENT=40976,MAT_DIFFUSE=40992,MAT_SPECULAR=41008,MAT_SHININESS=41024,MAT_TRANSPARENCY=41040,MAT_TWO_SIDE=41089,MAT_ADDITIVE=41091,MAT_WIRE=41093,MAT_WIRE_SIZE=41095,MAT_TEXMAP=41472,MAT_OPACMAP=41488,MAT_BUMPMAP=41520,MAT_SPECMAP=41476,MAT_MAPNAME=41728,MAT_MAP_USCALE=41812,MAT_MAP_VSCALE=41814,MAT_MAP_UOFFSET=41816,MAT_MAP_VOFFSET=41818,NAMED_OBJECT=16384,N_TRI_OBJECT=16640,POINT_ARRAY=16656,FACE_ARRAY=16672,MSH_MAT_GROUP=16688,TEX_VERTS=16704,MESH_MATRIX=16736;var UTIF={};(function(){"use strict";var ir=function(){function ar(or){this.message="JPEG error: "+or}return ar.prototype=new Error,ar.prototype.name="JpegError",ar.constructor=ar,ar}(),er=function(){var ar=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),or=4017,lr=799,cr=3406,hr=2276,fr=1567,ur=3784,pr=5793,gr=2896;function _r(br){br==null&&(br={}),br.w==null&&(br.w=-1),this.V=br.n,this.N=br.w}function mr(br,Sr){for(var xr=0,Cr=[],Ir,Rr,Pr=16,Fr;Pr>0&&!br[Pr-1];)Pr--;Cr.push({children:[],index:0});var Nr=Cr[0];for(Ir=0;Ir<Pr;Ir++){for(Rr=0;Rr<br[Ir];Rr++){for(Nr=Cr.pop(),Nr.children[Nr.index]=Sr[xr];Nr.index>0;)Nr=Cr.pop();for(Nr.index++,Cr.push(Nr);Cr.length<=Ir;)Cr.push(Fr={children:[],index:0}),Nr.children[Nr.index]=Fr.children,Nr=Fr;xr++}Ir+1<Pr&&(Cr.push(Fr={children:[],index:0}),Nr.children[Nr.index]=Fr.children,Nr=Fr)}return Cr[0].children}function dr(br,Sr,xr){return 64*((br.P+1)*Sr+xr)}function vr(br,Sr,xr,Cr,Ir,Rr,Pr,Fr,Nr,Ur){Ur==null&&(Ur=!1);var Br=xr.m,Or=xr.Z,Dr=Sr,Wr=0,$r=0,Yr=0,Qi=0,rs,Kr=0,Qr,Vr,Gr,qr,ji,Zr,Zi=0,Yi,qi,Xr,ns;function os(){if($r>0)return $r--,Wr>>$r&1;if(Wr=br[Sr++],Wr===255){var vs=br[Sr++];if(vs){if(vs===220&&Ur){Sr+=2;var As=rr(br,Sr);if(Sr+=2,As>0&&As!==xr.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",As)}else if(vs===217){if(Ur){var Ss=Kr*8;if(Ss>0&&Ss<xr.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",Ss)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new ir("unexpected marker")}}return $r=7,Wr>>>7}function us(vs){for(var As=vs;;){switch(As=As[os()],typeof As){case"number":return As;case"object":continue}throw new ir("invalid huffman sequence")}}function is(vs){for(var As=0;vs>0;)As=As<<1|os(),vs--;return As}function Ji(vs){if(vs===1)return os()===1?1:-1;var As=is(vs);return As>=1<<vs-1?As:As+(-1<<vs)+1}function ms(vs,As){var Ss=us(vs.J),Is=Ss===0?0:Ji(Ss),Fs=1;for(vs.D[As]=vs.Q+=Is;Fs<64;){var Ns=us(vs.i),Ws=Ns&15,ks=Ns>>4;if(Ws===0){if(ks<15)break;Fs+=16;continue}Fs+=ks;var Vs=ar[Fs];vs.D[As+Vs]=Ji(Ws),Fs++}}function Ki(vs,As){var Ss=us(vs.J),Is=Ss===0?0:Ji(Ss)<<Nr;vs.D[As]=vs.Q+=Is}function Ni(vs,As){vs.D[As]|=os()<<Nr}function Ri(vs,As){if(Yr>0){Yr--;return}for(var Ss=Rr,Is=Pr;Ss<=Is;){var Fs=us(vs.i),Ns=Fs&15,Ws=Fs>>4;if(Ns===0){if(Ws<15){Yr=is(Ws)+(1<<Ws)-1;break}Ss+=16;continue}Ss+=Ws;var ks=ar[Ss];vs.D[As+ks]=Ji(Ns)*(1<<Nr),Ss++}}function Jr(vs,As){for(var Ss=Rr,Is=Pr,Fs=0,Ns,Ws;Ss<=Is;){var ks=As+ar[Ss],Vs=vs.D[ks]<0?-1:1;switch(Qi){case 0:if(Ws=us(vs.i),Ns=Ws&15,Fs=Ws>>4,Ns===0)Fs<15?(Yr=is(Fs)+(1<<Fs),Qi=4):(Fs=16,Qi=1);else{if(Ns!==1)throw new ir("invalid ACn encoding");rs=Ji(Ns),Qi=Fs?2:3}continue;case 1:case 2:vs.D[ks]?vs.D[ks]+=Vs*(os()<<Nr):(Fs--,Fs===0&&(Qi=Qi===2?3:0));break;case 3:vs.D[ks]?vs.D[ks]+=Vs*(os()<<Nr):(vs.D[ks]=rs<<Nr,Qi=0);break;case 4:vs.D[ks]&&(vs.D[ks]+=Vs*(os()<<Nr));break}Ss++}Qi===4&&(Yr--,Yr===0&&(Qi=0))}function Xi(vs,As,Ss,Is,Fs){var Ns=Ss/Br|0,Ws=Ss%Br;Kr=Ns*vs.A+Is;var ks=Ws*vs.h+Fs,Vs=dr(vs,Kr,ks);As(vs,Vs)}function ss(vs,As,Ss){Kr=Ss/vs.P|0;var Is=Ss%vs.P,Fs=dr(vs,Kr,Is);As(vs,Fs)}var ls=Cr.length;for(Or?Rr===0?Zr=Fr===0?Ki:Ni:Zr=Fr===0?Ri:Jr:Zr=ms,ls===1?qi=Cr[0].P*Cr[0].c:qi=Br*xr.R;Zi<=qi;){var gs=Ir?Math.min(qi-Zi,Ir):qi;if(gs>0){for(Vr=0;Vr<ls;Vr++)Cr[Vr].Q=0;if(Yr=0,ls===1)for(Qr=Cr[0],ji=0;ji<gs;ji++)ss(Qr,Zr,Zi),Zi++;else for(ji=0;ji<gs;ji++){for(Vr=0;Vr<ls;Vr++)for(Qr=Cr[Vr],Xr=Qr.h,ns=Qr.A,Gr=0;Gr<ns;Gr++)for(qr=0;qr<Xr;qr++)Xi(Qr,Zr,Zi,Gr,qr);Zi++}}if($r=0,Yi=wr(br,Sr),!Yi)break;if(Yi.u){var _s=gs>0?"unexpected":"excessive";Sr=Yi.offset}if(Yi.M>=65488&&Yi.M<=65495)Sr+=2;else break}return Sr-Dr}function Ar(br,Sr,xr){var Cr=br.$,Ir=br.D,Rr,Pr,Fr,Nr,Ur,Br,Or,Dr,Wr,$r,Yr,Qi,rs,Kr,Qr,Vr,Gr;if(!Cr)throw new ir("missing required Quantization Table.");for(var qr=0;qr<64;qr+=8){if(Wr=Ir[Sr+qr],$r=Ir[Sr+qr+1],Yr=Ir[Sr+qr+2],Qi=Ir[Sr+qr+3],rs=Ir[Sr+qr+4],Kr=Ir[Sr+qr+5],Qr=Ir[Sr+qr+6],Vr=Ir[Sr+qr+7],Wr*=Cr[qr],!($r|Yr|Qi|rs|Kr|Qr|Vr)){Gr=pr*Wr+512>>10,xr[qr]=Gr,xr[qr+1]=Gr,xr[qr+2]=Gr,xr[qr+3]=Gr,xr[qr+4]=Gr,xr[qr+5]=Gr,xr[qr+6]=Gr,xr[qr+7]=Gr;continue}$r*=Cr[qr+1],Yr*=Cr[qr+2],Qi*=Cr[qr+3],rs*=Cr[qr+4],Kr*=Cr[qr+5],Qr*=Cr[qr+6],Vr*=Cr[qr+7],Rr=pr*Wr+128>>8,Pr=pr*rs+128>>8,Fr=Yr,Nr=Qr,Ur=gr*($r-Vr)+128>>8,Dr=gr*($r+Vr)+128>>8,Br=Qi<<4,Or=Kr<<4,Rr=Rr+Pr+1>>1,Pr=Rr-Pr,Gr=Fr*ur+Nr*fr+128>>8,Fr=Fr*fr-Nr*ur+128>>8,Nr=Gr,Ur=Ur+Or+1>>1,Or=Ur-Or,Dr=Dr+Br+1>>1,Br=Dr-Br,Rr=Rr+Nr+1>>1,Nr=Rr-Nr,Pr=Pr+Fr+1>>1,Fr=Pr-Fr,Gr=Ur*hr+Dr*cr+2048>>12,Ur=Ur*cr-Dr*hr+2048>>12,Dr=Gr,Gr=Br*lr+Or*or+2048>>12,Br=Br*or-Or*lr+2048>>12,Or=Gr,xr[qr]=Rr+Dr,xr[qr+7]=Rr-Dr,xr[qr+1]=Pr+Or,xr[qr+6]=Pr-Or,xr[qr+2]=Fr+Br,xr[qr+5]=Fr-Br,xr[qr+3]=Nr+Ur,xr[qr+4]=Nr-Ur}for(var ji=0;ji<8;++ji){if(Wr=xr[ji],$r=xr[ji+8],Yr=xr[ji+16],Qi=xr[ji+24],rs=xr[ji+32],Kr=xr[ji+40],Qr=xr[ji+48],Vr=xr[ji+56],!($r|Yr|Qi|rs|Kr|Qr|Vr)){Gr=pr*Wr+8192>>14,Gr<-2040?Gr=0:Gr>=2024?Gr=255:Gr=Gr+2056>>4,Ir[Sr+ji]=Gr,Ir[Sr+ji+8]=Gr,Ir[Sr+ji+16]=Gr,Ir[Sr+ji+24]=Gr,Ir[Sr+ji+32]=Gr,Ir[Sr+ji+40]=Gr,Ir[Sr+ji+48]=Gr,Ir[Sr+ji+56]=Gr;continue}Rr=pr*Wr+2048>>12,Pr=pr*rs+2048>>12,Fr=Yr,Nr=Qr,Ur=gr*($r-Vr)+2048>>12,Dr=gr*($r+Vr)+2048>>12,Br=Qi,Or=Kr,Rr=(Rr+Pr+1>>1)+4112,Pr=Rr-Pr,Gr=Fr*ur+Nr*fr+2048>>12,Fr=Fr*fr-Nr*ur+2048>>12,Nr=Gr,Ur=Ur+Or+1>>1,Or=Ur-Or,Dr=Dr+Br+1>>1,Br=Dr-Br,Rr=Rr+Nr+1>>1,Nr=Rr-Nr,Pr=Pr+Fr+1>>1,Fr=Pr-Fr,Gr=Ur*hr+Dr*cr+2048>>12,Ur=Ur*cr-Dr*hr+2048>>12,Dr=Gr,Gr=Br*lr+Or*or+2048>>12,Br=Br*or-Or*lr+2048>>12,Or=Gr,Wr=Rr+Dr,Vr=Rr-Dr,$r=Pr+Or,Qr=Pr-Or,Yr=Fr+Br,Kr=Fr-Br,Qi=Nr+Ur,rs=Nr-Ur,Wr<16?Wr=0:Wr>=4080?Wr=255:Wr>>=4,$r<16?$r=0:$r>=4080?$r=255:$r>>=4,Yr<16?Yr=0:Yr>=4080?Yr=255:Yr>>=4,Qi<16?Qi=0:Qi>=4080?Qi=255:Qi>>=4,rs<16?rs=0:rs>=4080?rs=255:rs>>=4,Kr<16?Kr=0:Kr>=4080?Kr=255:Kr>>=4,Qr<16?Qr=0:Qr>=4080?Qr=255:Qr>>=4,Vr<16?Vr=0:Vr>=4080?Vr=255:Vr>>=4,Ir[Sr+ji]=Wr,Ir[Sr+ji+8]=$r,Ir[Sr+ji+16]=Yr,Ir[Sr+ji+24]=Qi,Ir[Sr+ji+32]=rs,Ir[Sr+ji+40]=Kr,Ir[Sr+ji+48]=Qr,Ir[Sr+ji+56]=Vr}}function yr(br,Sr){for(var xr=Sr.P,Cr=Sr.c,Ir=new Int16Array(64),Rr=0;Rr<Cr;Rr++)for(var Pr=0;Pr<xr;Pr++){var Fr=dr(Sr,Rr,Pr);Ar(Sr,Fr,Ir)}return Sr.D}function wr(br,Sr,xr){xr==null&&(xr=Sr);var Cr=br.length-1,Ir=xr<Sr?xr:Sr;if(Sr>=Cr)return null;var Rr=rr(br,Sr);if(Rr>=65472&&Rr<=65534)return{u:null,M:Rr,offset:Sr};for(var Pr=rr(br,Ir);!(Pr>=65472&&Pr<=65534);){if(++Ir>=Cr)return null;Pr=rr(br,Ir)}return{u:Rr.toString(16),M:Pr,offset:Ir}}return _r.prototype={parse(br,Sr){Sr==null&&(Sr={});var xr=Sr.F,Cr=0,Ir=null,Rr=null,Pr,Fr,Nr=0;function Ur(){var Ws=rr(br,Cr);Cr+=2;var ks=Cr+Ws-2,Vs=wr(br,ks,Cr);Vs&&Vs.u&&(ks=Vs.offset);var bs=br.subarray(Cr,ks);return Cr+=bs.length,bs}function Br(Ws){for(var ks=Math.ceil(Ws.o/8/Ws.X),Vs=Math.ceil(Ws.s/8/Ws.B),bs=0;bs<Ws.W.length;bs++){Jr=Ws.W[bs];var Ms=Math.ceil(Math.ceil(Ws.o/8)*Jr.h/Ws.X),Cs=Math.ceil(Math.ceil(Ws.s/8)*Jr.A/Ws.B),Ps=ks*Jr.h,Qs=Vs*Jr.A,Hs=64*Qs*(Ps+1);Jr.D=new Int16Array(Hs),Jr.P=Ms,Jr.c=Cs}Ws.m=ks,Ws.R=Vs}var Or=[],Dr=[],Wr=[],$r=rr(br,Cr);if(Cr+=2,$r!==65496)throw new ir("SOI not found");$r=rr(br,Cr),Cr+=2;e:for(;$r!==65497;){var Yr,Qi,rs;switch($r){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Kr=Ur();$r===65504&&Kr[0]===74&&Kr[1]===70&&Kr[2]===73&&Kr[3]===70&&Kr[4]===0&&(Ir={version:{d:Kr[5],T:Kr[6]},K:Kr[7],j:Kr[8]<<8|Kr[9],H:Kr[10]<<8|Kr[11],S:Kr[12],I:Kr[13],C:Kr.subarray(14,14+3*Kr[12]*Kr[13])}),$r===65518&&Kr[0]===65&&Kr[1]===100&&Kr[2]===111&&Kr[3]===98&&Kr[4]===101&&(Rr={version:Kr[5]<<8|Kr[6],k:Kr[7]<<8|Kr[8],q:Kr[9]<<8|Kr[10],a:Kr[11]});break;case 65499:var Qr=rr(br,Cr),Vr;Cr+=2;for(var Gr=Qr+Cr-2;Cr<Gr;){var qr=br[Cr++],ji=new Uint16Array(64);if(qr>>4)if(qr>>4===1)for(Qi=0;Qi<64;Qi++)Vr=ar[Qi],ji[Vr]=rr(br,Cr),Cr+=2;else throw new ir("DQT - invalid table spec");else for(Qi=0;Qi<64;Qi++)Vr=ar[Qi],ji[Vr]=br[Cr++];Or[qr&15]=ji}break;case 65472:case 65473:case 65474:if(Pr)throw new ir("Only single frame JPEGs supported");Cr+=2,Pr={},Pr.G=$r===65473,Pr.Z=$r===65474,Pr.precision=br[Cr++];var Zr=rr(br,Cr),Zi,Yi=0,qi=0;Cr+=2,Pr.s=xr||Zr,Pr.o=rr(br,Cr),Cr+=2,Pr.W=[],Pr._={};var Xr=br[Cr++];for(Yr=0;Yr<Xr;Yr++){Zi=br[Cr];var ns=br[Cr+1]>>4,os=br[Cr+1]&15;Yi<ns&&(Yi=ns),qi<os&&(qi=os);var us=br[Cr+2];rs=Pr.W.push({h:ns,A:os,L:us,$:null}),Pr._[Zi]=rs-1,Cr+=3}Pr.X=Yi,Pr.B=qi,Br(Pr);break;case 65476:var is=rr(br,Cr);for(Cr+=2,Yr=2;Yr<is;){var Ji=br[Cr++],ms=new Uint8Array(16),Ki=0;for(Qi=0;Qi<16;Qi++,Cr++)Ki+=ms[Qi]=br[Cr];var Ni=new Uint8Array(Ki);for(Qi=0;Qi<Ki;Qi++,Cr++)Ni[Qi]=br[Cr];Yr+=17+Ki,(Ji>>4?Dr:Wr)[Ji&15]=mr(ms,Ni)}break;case 65501:Cr+=2,Fr=rr(br,Cr),Cr+=2;break;case 65498:var Ri=++Nr===1&&!xr,Jr;Cr+=2;var Xi=br[Cr++],ss=[];for(Yr=0;Yr<Xi;Yr++){var ls=br[Cr++],gs=Pr._[ls];Jr=Pr.W[gs],Jr.index=ls;var _s=br[Cr++];Jr.J=Wr[_s>>4],Jr.i=Dr[_s&15],ss.push(Jr)}var vs=br[Cr++],As=br[Cr++],Ss=br[Cr++];try{var Is=vr(br,Cr,Pr,ss,Fr,vs,As,Ss>>4,Ss&15,Ri);Cr+=Is}catch(Ws){if(Ws instanceof DNLMarkerError)return this.parse(br,{F:Ws.s});if(Ws instanceof EOIMarkerError)break e;throw Ws}break;case 65500:Cr+=4;break;case 65535:br[Cr]!==255&&Cr--;break;default:var Fs=wr(br,Cr-2,Cr-3);if(Fs&&Fs.u){Cr=Fs.offset;break}if(Cr>=br.length-1)break e;throw new ir("JpegImage.parse - unknown marker: "+$r.toString(16))}$r=rr(br,Cr),Cr+=2}for(this.width=Pr.o,this.height=Pr.s,this.g=Ir,this.b=Rr,this.W=[],Yr=0;Yr<Pr.W.length;Yr++){Jr=Pr.W[Yr];var Ns=Or[Jr.L];Ns&&(Jr.$=Ns),this.W.push({index:Jr.index,e:yr(Pr,Jr),l:Jr.h/Pr.X,t:Jr.A/Pr.B,P:Jr.P,c:Jr.c})}this.p=this.W.length},Y(br,Sr,xr){xr==null&&(xr=!1);var Cr=this.width/br,Ir=this.height/Sr,Rr,Pr,Fr,Nr,Ur,Br,Or,Dr,Wr,$r,Yr=0,Qi,rs=this.W.length,Kr=br*Sr*rs,Qr=new Uint8ClampedArray(Kr),Vr=new Uint32Array(br),Gr=4294967288,qr;for(Or=0;Or<rs;Or++){if(Rr=this.W[Or],Pr=Rr.l*Cr,Fr=Rr.t*Ir,Yr=Or,Qi=Rr.e,Nr=Rr.P+1<<3,Pr!==qr){for(Ur=0;Ur<br;Ur++)Dr=0|Ur*Pr,Vr[Ur]=(Dr&Gr)<<3|Dr&7;qr=Pr}for(Br=0;Br<Sr;Br++)for(Dr=0|Br*Fr,$r=Nr*(Dr&Gr)|(Dr&7)<<3,Ur=0;Ur<br;Ur++)Qr[Yr]=Qi[$r+Vr[Ur]],Yr+=rs}var ji=this.V;if(!xr&&rs===4&&!ji&&(ji=new Int32Array([-256,255,-256,255,-256,255,-256,255])),ji)for(Or=0;Or<Kr;)for(Dr=0,Wr=0;Dr<rs;Dr++,Or++,Wr+=2)Qr[Or]=(Qr[Or]*ji[Wr]>>8)+ji[Wr+1];return Qr},get f(){return this.b?!!this.b.a:this.p===3?this.N===0?!1:!(this.W[0].index===82&&this.W[1].index===71&&this.W[2].index===66):this.N===1},z:function(Sr){for(var xr,Cr,Ir,Rr=0,Pr=Sr.length;Rr<Pr;Rr+=3)xr=Sr[Rr],Cr=Sr[Rr+1],Ir=Sr[Rr+2],Sr[Rr]=xr-179.456+1.402*Ir,Sr[Rr+1]=xr+135.459-.344*Cr-.714*Ir,Sr[Rr+2]=xr-226.816+1.772*Cr;return Sr},O:function(Sr){for(var xr,Cr,Ir,Rr,Pr=0,Fr=0,Nr=Sr.length;Fr<Nr;Fr+=4)xr=Sr[Fr],Cr=Sr[Fr+1],Ir=Sr[Fr+2],Rr=Sr[Fr+3],Sr[Pr++]=-122.67195406894+Cr*(-660635669420364e-19*Cr+.000437130475926232*Ir-54080610064599e-18*xr+.00048449797120281*Rr-.154362151871126)+Ir*(-.000957964378445773*Ir+.000817076911346625*xr-.00477271405408747*Rr+1.53380253221734)+xr*(.000961250184130688*xr-.00266257332283933*Rr+.48357088451265)+Rr*(-.000336197177618394*Rr+.484791561490776),Sr[Pr++]=107.268039397724+Cr*(219927104525741e-19*Cr-.000640992018297945*Ir+.000659397001245577*xr+.000426105652938837*Rr-.176491792462875)+Ir*(-.000778269941513683*Ir+.00130872261408275*xr+.000770482631801132*Rr-.151051492775562)+xr*(.00126935368114843*xr-.00265090189010898*Rr+.25802910206845)+Rr*(-.000318913117588328*Rr-.213742400323665),Sr[Pr++]=-20.810012546947+Cr*(-.000570115196973677*Cr-263409051004589e-19*Ir+.0020741088115012*xr-.00288260236853442*Rr+.814272968359295)+Ir*(-153496057440975e-19*Ir-.000132689043961446*xr+.000560833691242812*Rr-.195152027534049)+xr*(.00174418132927582*xr-.00255243321439347*Rr+.116935020465145)+Rr*(-.000343531996510555*Rr+.24165260232407);return Sr.subarray(0,Pr)},r:function(Sr){for(var xr,Cr,Ir,Rr=0,Pr=Sr.length;Rr<Pr;Rr+=4)xr=Sr[Rr],Cr=Sr[Rr+1],Ir=Sr[Rr+2],Sr[Rr]=434.456-xr-1.402*Ir,Sr[Rr+1]=119.541-xr+.344*Cr+.714*Ir,Sr[Rr+2]=481.816-xr-1.772*Cr;return Sr},U:function(Sr){for(var xr,Cr,Ir,Rr,Pr=0,Fr=0,Nr=Sr.length;Fr<Nr;Fr+=4)xr=Sr[Fr],Cr=Sr[Fr+1],Ir=Sr[Fr+2],Rr=Sr[Fr+3],Sr[Pr++]=255+xr*(-6747147073602441e-20*xr+.0008379262121013727*Cr+.0002894718188643294*Ir+.003264231057537806*Rr-1.1185611867203937)+Cr*(26374107616089405e-21*Cr-8626949158638572e-20*Ir-.0002748769067499491*Rr-.02155688794978967)+Ir*(-3878099212869363e-20*Ir-.0003267808279485286*Rr+.0686742238595345)-Rr*(.0003361971776183937*Rr+.7430659151342254),Sr[Pr++]=255+xr*(.00013596372813588848*xr+.000924537132573585*Cr+.00010567359618683593*Ir+.0004791864687436512*Rr-.3109689587515875)+Cr*(-.00023545346108370344*Cr+.0002702845253534714*Ir+.0020200308977307156*Rr-.7488052167015494)+Ir*(6834815998235662e-20*Ir+.00015168452363460973*Rr-.09751927774728933)-Rr*(.0003189131175883281*Rr+.7364883807733168),Sr[Pr++]=255+xr*(13598650411385307e-21*xr+.00012423956175490851*Cr+.0004751985097583589*Ir-36729317476630422e-22*Rr-.05562186980264034)+Cr*(.00016141380598724676*Cr+.0009692239130725186*Ir+.0007782692450036253*Rr-.44015232367526463)+Ir*(5068882914068769e-22*Ir+.0017778369011375071*Rr-.7591454649749609)-Rr*(.0003435319965105553*Rr+.7063770186160144);return Sr.subarray(0,Pr)},getData:function(br){var Sr=br.width,xr=br.height,Cr=br.forceRGB,Ir=br.isSourcePDF;if(this.p>4)throw new ir("Unsupported color mode");var Rr=this.Y(Sr,xr,Ir);if(this.p===1&&Cr){for(var Pr=Rr.length,Fr=new Uint8ClampedArray(Pr*3),Nr=0,Ur=0;Ur<Pr;Ur++){var Br=Rr[Ur];Fr[Nr++]=Br,Fr[Nr++]=Br,Fr[Nr++]=Br}return Fr}else{if(this.p===3&&this.f)return this.z(Rr);if(this.p===4){if(this.f)return Cr?this.O(Rr):this.r(Rr);if(Cr)return this.U(Rr)}}return Rr}},_r}();function tr(sr,ar){return sr[ar]<<24>>24}function rr(sr,ar){return sr[ar]<<8|sr[ar+1]}function nr(sr,ar){return(sr[ar]<<24|sr[ar+1]<<16|sr[ar+2]<<8|sr[ar+3])>>>0}UTIF.JpegDecoder=er})();UTIF.encodeImage=function(ir,er,tr,rr){var nr={t256:[er],t257:[tr],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[tr],t279:[er*tr*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(rr)for(var sr in rr)nr[sr]=rr[sr];for(var ar=new Uint8Array(UTIF.encode([nr])),or=new Uint8Array(ir),lr=new Uint8Array(1e3+er*tr*4),sr=0;sr<ar.length;sr++)lr[sr]=ar[sr];for(var sr=0;sr<or.length;sr++)lr[1e3+sr]=or[sr];return lr.buffer};UTIF.encode=function(ir){var er=!1,tr=new Uint8Array(2e4),rr=4,nr=er?UTIF._binLE:UTIF._binBE;tr[0]=tr[1]=er?73:77,nr.writeUshort(tr,2,42);var sr=8;nr.writeUint(tr,rr,sr),rr+=4;for(var ar=0;ar<ir.length;ar++){var or=UTIF._writeIFD(nr,UTIF._types.basic,tr,sr,ir[ar]);sr=or[1],ar<ir.length-1&&(sr&3&&(sr+=4-(sr&3)),nr.writeUint(tr,or[0],sr))}return tr.slice(0,sr).buffer};UTIF.decode=function(ir,er){er==null&&(er={parseMN:!0,debug:!1});var tr=new Uint8Array(ir),rr=0,nr=UTIF._binBE.readASCII(tr,rr,2);rr+=2;var sr=nr=="II"?UTIF._binLE:UTIF._binBE,ar=sr.readUshort(tr,rr);rr+=2;var or=sr.readUint(tr,rr);rr+=4;for(var lr=[];;){var cr=sr.readUshort(tr,or),hr=sr.readUshort(tr,or+4);if(cr!=0&&(hr<1||13<hr)){log("error in TIFF");break}if(UTIF._readIFD(sr,tr,or,lr,0,er),or=sr.readUint(tr,or+2+cr*12),or==0)break}return lr};UTIF.decodeImage=function(ir,er,tr){if(!er.data){var rr=new Uint8Array(ir),nr=UTIF._binBE.readASCII(rr,0,2);if(er.t256!=null){er.isLE=nr=="II",er.width=er.t256[0],er.height=er.t257[0];var sr=er.t259?er.t259[0]:1,ar=er.t266?er.t266[0]:1;er.t284&&er.t284[0]==2&&log("PlanarConfiguration 2 should not be used!"),sr==7&&er.t258&&er.t258.length>3&&(er.t258=er.t258.slice(0,3));var or=er.t277?er.t277[0]:1,lr=er.t258?er.t258[0]:1,cr=lr*or;sr==1&&er.t279!=null&&er.t278&&er.t262[0]==32803&&(cr=Math.round(er.t279[0]*8/(er.width*er.t278[0]))),er.t50885&&er.t50885[0]==4&&(cr=er.t258[0]*3);var hr=Math.ceil(er.width*cr/8)*8,fr=er.t273;(fr==null||er.t322)&&(fr=er.t324);var ur=er.t279;sr==1&&fr.length==1&&(ur=[er.height*(hr>>>3)]),(ur==null||er.t322)&&(ur=er.t325);var pr=new Uint8Array(er.height*(hr>>>3)),gr=0;if(er.t322!=null){var _r=er.t322[0],mr=er.t323[0],dr=Math.floor((er.width+_r-1)/_r),vr=Math.floor((er.height+mr-1)/mr),Ar=new Uint8Array(Math.ceil(_r*mr*cr/8)|0);console.log("====",dr,vr);for(var yr=0;yr<vr;yr++)for(var wr=0;wr<dr;wr++){var br=yr*dr+wr;Ar.fill(0),UTIF.decode._decompress(er,tr,rr,fr[br],ur[br],sr,Ar,0,ar,_r,mr),sr==6?pr=Ar:UTIF._copyTile(Ar,Math.ceil(_r*cr/8)|0,mr,pr,Math.ceil(er.width*cr/8)|0,er.height,Math.ceil(wr*_r*cr/8)|0,yr*mr)}gr=pr.length*8}else{if(fr==null)return;var Sr=er.t278?er.t278[0]:er.height;Sr=Math.min(Sr,er.height);for(var br=0;br<fr.length;br++)UTIF.decode._decompress(er,tr,rr,fr[br],ur[br],sr,pr,Math.ceil(gr/8)|0,ar,er.width,Sr),gr+=hr*Sr;gr=Math.min(gr,pr.length*8)}er.data=new Uint8Array(pr.buffer,0,Math.ceil(gr/8)|0)}}};UTIF.decode._decompress=function(ir,er,tr,rr,nr,sr,ar,or,lr,cr,hr){if(ir.t271&&ir.t271[0]=="Panasonic"&&ir.t45&&ir.t45[0]==6&&(sr=34316),sr==1)for(var fr=0;fr<nr;fr++)ar[or+fr]=tr[rr+fr];else if(sr==2)UTIF.decode._decodeG2(tr,rr,nr,ar,or,cr,lr);else if(sr==3)UTIF.decode._decodeG3(tr,rr,nr,ar,or,cr,lr,ir.t292?(ir.t292[0]&1)==1:!1);else if(sr==4)UTIF.decode._decodeG4(tr,rr,nr,ar,or,cr,lr);else if(sr==5)UTIF.decode._decodeLZW(tr,rr,nr,ar,or,8);else if(sr==6)UTIF.decode._decodeOldJPEG(ir,tr,rr,nr,ar,or);else if(sr==7||sr==34892)UTIF.decode._decodeNewJPEG(ir,tr,rr,nr,ar,or);else if(sr==8||sr==32946){var ur=new Uint8Array(tr.buffer,rr+2,nr-6),pr=UTIF._inflateRaw(ur);or+pr.length<=ar.length&&ar.set(pr,or)}else sr==9?UTIF.decode._decodeVC5(tr,rr,nr,ar,or,ir.t33422):sr==32767?UTIF.decode._decodeARW(ir,tr,rr,nr,ar,or):sr==32773?UTIF.decode._decodePackBits(tr,rr,nr,ar,or):sr==32809?UTIF.decode._decodeThunder(tr,rr,nr,ar,or):sr==34316?UTIF.decode._decodePanasonic(ir,tr,rr,nr,ar,or):sr==34713?UTIF.decode._decodeNikon(ir,er,tr,rr,nr,ar,or):sr==34676?UTIF.decode._decodeLogLuv32(ir,tr,rr,nr,ar,or):log("Unknown compression",sr);var gr=ir.t258?Math.min(32,ir.t258[0]):1,_r=ir.t277?ir.t277[0]:1,mr=gr*_r>>>3,dr=Math.ceil(gr*_r*cr/8);if(gr==16&&!ir.isLE&&ir.t33422==null)for(var vr=0;vr<hr;vr++)for(var Ar=or+vr*dr,yr=1;yr<dr;yr+=2){var wr=ar[Ar+yr];ar[Ar+yr]=ar[Ar+yr-1],ar[Ar+yr-1]=wr}if(ir.t317&&ir.t317[0]==2)for(var vr=0;vr<hr;vr++){var br=or+vr*dr;if(gr==16)for(var fr=mr;fr<dr;fr+=2){var Sr=(ar[br+fr+1]<<8|ar[br+fr])+(ar[br+fr-mr+1]<<8|ar[br+fr-mr]);ar[br+fr]=Sr&255,ar[br+fr+1]=Sr>>>8&255}else if(_r==3)for(var fr=3;fr<dr;fr+=3)ar[br+fr]=ar[br+fr]+ar[br+fr-3]&255,ar[br+fr+1]=ar[br+fr+1]+ar[br+fr-2]&255,ar[br+fr+2]=ar[br+fr+2]+ar[br+fr-1]&255;else for(var fr=mr;fr<dr;fr++)ar[br+fr]=ar[br+fr]+ar[br+fr-mr]&255}};UTIF.decode._decodePanasonic=function(ir,er,tr,rr,nr,sr){var ar=er.buffer,or=ir.t2[0],lr=ir.t3[0],cr=ir.t10[0],hr=ir.t45[0],fr=0,ur=0,pr=0,gr=0,_r,mr,dr=hr==6?new Uint32Array(18):new Uint8Array(16),vr,Ar,yr,wr=[0,0],br=[0,0],Sr,xr=0,Cr,Ir,Rr,Pr,Fr=new Uint8Array(16384),Nr=new Uint16Array(nr.buffer);function Ur(os){if(pr==0){var us=new Uint8Array(ar,tr+ur+8184,8200),is=new Uint8Array(ar,tr+ur,8184);Fr.set(us),Fr.set(is,us.length),ur+=16384}if(hr==5)for(vr=0;vr<16;vr++)dr[vr]=Fr[pr++],pr&=16383;else return pr=pr-os&131071,gr=pr>>3^16368,(Fr[gr]|Fr[gr+1]<<8)>>(pr&7)&~(-1<<os)}function Br(os){return Fr[pr+15-os]}function Or(){dr[0]=Br(0)<<6|Br(1)>>2,dr[1]=((Br(1)&3)<<12|Br(2)<<4|Br(3)>>4)&16383,dr[2]=Br(3)>>2&3,dr[3]=(Br(3)&3)<<8|Br(4),dr[4]=Br(5)<<2|Br(6)>>6,dr[5]=(Br(6)&63)<<4|Br(7)>>4,dr[6]=Br(7)>>2&3,dr[7]=(Br(7)&3)<<8|Br(8),dr[8]=Br(9)<<2&1020|Br(10)>>6,dr[9]=(Br(10)<<4|Br(11)>>4)&1023,dr[10]=Br(11)>>2&3,dr[11]=(Br(11)&3)<<8|Br(12),dr[12]=(Br(13)<<2&1020|Br(14)>>6)&1023,dr[13]=(Br(14)<<4|Br(15)>>4)&1023,pr+=16,gr=0}function Dr(){dr[0]=Br(0)<<4|Br(1)>>4,dr[1]=((Br(1)&15)<<8|Br(2))&4095,dr[2]=Br(3)>>6&3,dr[3]=(Br(3)&63)<<2|Br(4)>>6,dr[4]=(Br(4)&63)<<2|Br(5)>>6,dr[5]=(Br(5)&63)<<2|Br(6)>>6,dr[6]=Br(6)>>4&3,dr[7]=(Br(6)&15)<<4|Br(7)>>4,dr[8]=(Br(7)&15)<<4|Br(8)>>4,dr[9]=(Br(8)&15)<<4|Br(9)>>4,dr[10]=Br(9)>>2&3,dr[11]=(Br(9)&3)<<6|Br(10)>>2,dr[12]=(Br(10)&3)<<6|Br(11)>>2,dr[13]=(Br(11)&3)<<6|Br(12)>>2,dr[14]=Br(12)&3,dr[15]=Br(13),dr[16]=Br(14),dr[17]=Br(15),pr+=16,gr=0}function Wr(){wr[0]=0,wr[1]=0,br[0]=0,br[1]=0}if(hr==7)throw hr;if(hr==6){var $r=cr==12,Yr=$r?Dr:Or,Qi=$r?14:11,rs=$r?128:512,Kr=$r?2048:8192,Qr=$r?16383:65535,Vr=$r?4095:16383,Gr=or/Qi,qr=Gr*16,ji=$r?18:14;for(Ir=0;Ir<lr-15;Ir+=16){var Zr=Math.min(16,lr-Ir),Zi=qr*Zr;for(Fr=new Uint8Array(ar,tr+fr,Zi),pr=0,fr+=Zi,Pr=0,Rr=0;Pr<Zr;Pr++,Rr=0){xr=(Ir+Pr)*or;for(var Yi=0;Yi<Gr;Yi++)for(Yr(),Wr(),yr=0,Cr=0,vr=0;vr<Qi;vr++){if(Sr=vr&1,vr%3==2){var qi=gr<ji?dr[gr++]:0;qi==3&&(qi=4),Cr=rs<<qi,yr=1<<qi}var Xr=gr<ji?dr[gr++]:0;wr[Sr]?(Xr*=yr,Cr<Kr&&br[Sr]>Cr&&(Xr+=br[Sr]-Cr),br[Sr]=Xr):(wr[Sr]=Xr,Xr?br[Sr]=Xr:Xr=br[Sr]),Nr[xr+Rr++]=Xr-15<=Qr?Xr-15&Qr:Xr+2147483633>>31&Vr}}}}else if(hr==5){var ns=cr==12?10:9;for(Ir=0;Ir<lr;Ir++)for(Rr=0;Rr<or;Rr+=ns)Ur(0),cr==12?(Nr[xr++]=((dr[1]&15)<<8)+dr[0],Nr[xr++]=16*dr[2]+(dr[1]>>4),Nr[xr++]=((dr[4]&15)<<8)+dr[3],Nr[xr++]=16*dr[5]+(dr[4]>>4),Nr[xr++]=((dr[7]&15)<<8)+dr[6],Nr[xr++]=16*dr[8]+(dr[7]>>4),Nr[xr++]=((dr[10]&15)<<8)+dr[9],Nr[xr++]=16*dr[11]+(dr[10]>>4),Nr[xr++]=((dr[13]&15)<<8)+dr[12],Nr[xr++]=16*dr[14]+(dr[13]>>4)):cr==14&&(Nr[xr++]=dr[0]+((dr[1]&63)<<8),Nr[xr++]=(dr[1]>>6)+4*dr[2]+((dr[3]&15)<<10),Nr[xr++]=(dr[3]>>4)+16*dr[4]+((dr[5]&3)<<12),Nr[xr++]=((dr[5]&252)>>2)+(dr[6]<<6),Nr[xr++]=dr[7]+((dr[8]&63)<<8),Nr[xr++]=(dr[8]>>6)+4*dr[9]+((dr[10]&15)<<10),Nr[xr++]=(dr[10]>>4)+16*dr[11]+((dr[12]&3)<<12),Nr[xr++]=((dr[12]&252)>>2)+(dr[13]<<6),Nr[xr++]=dr[14]+((dr[15]&63)<<8))}else if(hr==4)for(Ir=0;Ir<lr;Ir++)for(Rr=0;Rr<or;Rr++)vr=Rr%14,Sr=vr&1,vr==0&&Wr(),vr%3==2&&(yr=4>>3-Ur(2)),br[Sr]?(Ar=Ur(8),Ar!=0&&(wr[Sr]-=128<<yr,(wr[Sr]<0||yr==4)&&(wr[Sr]&=~(-1<<yr)),wr[Sr]+=Ar<<yr)):(br[Sr]=Ur(8),(br[Sr]||vr>11)&&(wr[Sr]=br[Sr]<<4|Ur(4))),Nr[xr++]=wr[Rr&1];else throw hr};UTIF.decode._decodeVC5=function(){var ir=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],er,tr,rr,nr=[3,3,3,3,2,2,2,1,1,1],sr=24576,ar=16384,or=8192,lr=ar|or;function cr(vr){var Ar=vr[1],yr=vr[0][Ar>>>3]>>>7-(Ar&7)&1;return vr[1]++,yr}function hr(vr,Ar){if(er==null){er={};for(var yr=0;yr<ir.length;yr+=4)er[ir[yr+1]]=ir.slice(yr,yr+4)}for(var wr=cr(vr),br=er[wr];br==null;)wr=wr<<1|cr(vr),br=er[wr];var Sr=br[3];Sr!=0&&(Sr=cr(vr)==0?Sr:-Sr),Ar[0]=br[2],Ar[1]=Sr}function fr(vr,Ar){for(var yr=0;yr<Ar;yr++)(vr&1)==1&&vr++,vr=vr>>>1;return vr}function ur(vr,Ar){return vr>>Ar}function pr(vr,Ar,yr,wr,br,Sr){Ar[yr]=ur(ur(11*vr[br]-4*vr[br+Sr]+vr[br+Sr+Sr]+4,3)+vr[wr],1),Ar[yr+Sr]=ur(ur(5*vr[br]+4*vr[br+Sr]-vr[br+Sr+Sr]+4,3)-vr[wr],1)}function gr(vr,Ar,yr,wr,br,Sr){var xr=vr[br-Sr]-vr[br+Sr],Cr=vr[br],Ir=vr[wr];Ar[yr]=ur(ur(xr+4,3)+Cr+Ir,1),Ar[yr+Sr]=ur(ur(-xr+4,3)+Cr-Ir,1)}function _r(vr,Ar,yr,wr,br,Sr){Ar[yr]=ur(ur(5*vr[br]+4*vr[br-Sr]-vr[br-Sr-Sr]+4,3)+vr[wr],1),Ar[yr+Sr]=ur(ur(11*vr[br]-4*vr[br-Sr]+vr[br-Sr-Sr]+4,3)-vr[wr],1)}function mr(vr){return vr=vr<0?0:vr>4095?4095:vr,vr=rr[vr]>>>2,vr}function dr(vr,Ar,yr,wr,br,Sr){wr=new Uint16Array(wr.buffer);var xr=Date.now(),Cr=UTIF._binBE,Ir=Ar+yr,Rr,Pr,Fr,Nr,Ur,Br,Or,Dr,Wr,$r,Yr,Qi,rs,Kr,Qr,Vr,Gr,qr;Ar+=4;for(var ji=Sr[0]==1;Ar<Ir;){var Zr=Cr.readShort(vr,Ar),Zi=Cr.readUshort(vr,Ar+2);if(Ar+=4,Zr==12)Rr=Zi;else if(Zr==20)Pr=Zi;else if(Zr==21)Fr=Zi;else if(Zr==48)Nr=Zi;else if(Zr==53)Ur=Zi;else if(Zr==35)Br=Zi;else if(Zr==62)Or=Zi;else if(Zr==101)Dr=Zi;else if(Zr==109)Wr=Zi;else if(Zr==84)$r=Zi;else if(Zr==106)Yr=Zi;else if(Zr==107)Qi=Zi;else if(Zr==108)rs=Zi;else if(Zr==102)Kr=Zi;else if(Zr==104)Qr=Zi;else if(Zr==105)Vr=Zi;else{var Yi=Zr<0?-Zr:Zr,qi=Yi&65280,Xr=0;if(Yi&lr&&(Yi&or?(Xr=Zi&65535,Xr+=(Yi&255)<<16):Xr=Zi&65535),(Yi&sr)==sr){if(Gr==null){Gr=[];for(var ns=0;ns<4;ns++)Gr[ns]=new Int16Array((Pr>>>1)*(Fr>>>1));qr=new Int16Array((Pr>>>1)*(Fr>>>1)),tr=new Int16Array(1024);for(var ns=0;ns<1024;ns++){var os=ns-512,us=Math.abs(os),Rr=Math.floor(768*us*us*us/(255*255*255))+us;tr[ns]=Math.sign(os)*Rr}rr=new Uint16Array(4096);for(var is=65535,ns=0;ns<4096;ns++){var Ji=ns,ms=is*(Math.pow(113,Ji/4095)-1)/112;rr[ns]=Math.min(ms,is)}}var Ki=Gr[Or],Ni=fr(Pr,1+nr[Nr]),Ri=fr(Fr,1+nr[Nr]);if(Nr==0)for(var Jr=0;Jr<Ri;Jr++)for(var Xi=0;Xi<Ni;Xi++){var ss=Ar+(Jr*Ni+Xi)*2;Ki[Jr*(Pr>>>1)+Xi]=vr[ss]<<8|vr[ss+1]}else{for(var ls=[vr,Ar*8],gs=[],_s=0,vs=Ni*Ri,As=[0,0],Ss=0,Zi=0;_s<vs;)for(hr(ls,As),Ss=As[0],Zi=As[1];Ss>0;)gs[_s++]=Zi,Ss--;for(var Is=(Nr-1)%3,Fs=Is!=1?Ni:0,Ns=Is!=0?Ri:0,Jr=0;Jr<Ri;Jr++)for(var Ws=(Jr+Ns)*(Pr>>>1)+Fs,ks=Jr*Ni,Xi=0;Xi<Ni;Xi++)Ki[Ws+Xi]=tr[gs[ks+Xi]+512]*Ur;if(Is==2){for(var Qr=Pr>>>1,Vs=Ni*2,bs=Ri*2,Jr=0;Jr<Ri;Jr++)for(var Xi=0;Xi<Vs;Xi++){var ns=Jr*2*Qr+Xi,Ms=Jr*Qr+Xi,Cs=Ri*Qr+Ms;Jr==0?pr(Ki,qr,ns,Cs,Ms,Qr):Jr==Ri-1?_r(Ki,qr,ns,Cs,Ms,Qr):gr(Ki,qr,ns,Cs,Ms,Qr)}var Ps=Ki;Ki=qr,qr=Ps;for(var Jr=0;Jr<bs;Jr++)for(var Xi=0;Xi<Ni;Xi++){var ns=Jr*Qr+2*Xi,Ms=Jr*Qr+Xi,Cs=Ni+Ms;Xi==0?pr(Ki,qr,ns,Cs,Ms,1):Xi==Ni-1?_r(Ki,qr,ns,Cs,Ms,1):gr(Ki,qr,ns,Cs,Ms,1)}var Ps=Ki;Ki=qr,qr=Ps;for(var Qs=[],Hs=2-~~((Nr-1)/3),ta=0;ta<3;ta++)Qs[ta]=Wr>>14-ta*2&3;var Sa=Qs[Hs];if(Sa!=0)for(var Jr=0;Jr<bs;Jr++)for(var Xi=0;Xi<Vs;Xi++){var ns=Jr*Qr+Xi;Ki[ns]=Ki[ns]<<Sa}}}if(Nr==9&&Or==3)for(var ga=Gr[0],$s=Gr[1],Ks=Gr[2],qs=Gr[3],Jr=0;Jr<Fr;Jr+=2)for(var Xi=0;Xi<Pr;Xi+=2){var Zs=Jr*Pr+Xi,ss=(Jr>>>1)*(Pr>>>1)+(Xi>>>1),ha=ga[ss],Ta=$s[ss]-2048,$a=Ks[ss]-2048,Wa=qs[ss]-2048,Qa=(Ta<<1)+ha,Xa=($a<<1)+ha,Ka=ha+Wa,qa=ha-Wa;ji?(wr[Zs]=mr(Ka),wr[Zs+1]=mr(Xa),wr[Zs+Pr]=mr(Qa),wr[Zs+Pr+1]=mr(qa)):(wr[Zs]=mr(Qa),wr[Zs+1]=mr(Ka),wr[Zs+Pr]=mr(qa),wr[Zs+Pr+1]=mr(Xa))}Ar+=Xr*4}else if(Yi==16388)Ar+=Xr*4;else if(!(qi==8192||qi==8448||qi==9216))throw Yi.toString(16)}}console.log(Date.now()-xr)}return dr}();UTIF.decode._decodeLogLuv32=function(ir,er,tr,rr,nr,sr){for(var ar=ir.width,or=ar*4,lr=0,cr=new Uint8Array(or);lr<rr;){for(var hr=0;hr<or;){var fr=er[tr+lr];if(lr++,fr<128){for(var ur=0;ur<fr;ur++)cr[hr+ur]=er[tr+lr+ur];hr+=fr,lr+=fr}else{fr=fr-126;for(var ur=0;ur<fr;ur++)cr[hr+ur]=er[tr+lr];hr+=fr,lr++}}for(var pr=0;pr<ar;pr++)nr[sr+0]=cr[pr],nr[sr+1]=cr[pr+ar],nr[sr+2]=cr[pr+ar*2],nr[sr+4]=cr[pr+ar*3],sr+=6}};UTIF.decode._ljpeg_diff=function(ir,er,tr){var rr=UTIF.decode._getbithuff,nr,sr;return nr=rr(ir,er,tr[0],tr),sr=rr(ir,er,nr,0),sr&1<<nr-1||(sr-=(1<<nr)-1),sr};UTIF.decode._decodeARW=function(ir,er,tr,rr,nr,sr){var ar=ir.t256[0],or=ir.t257[0],lr=ir.t258[0],cr=ir.isLE?UTIF._binLE:UTIF._binBE,hr=ar*or==rr||ar*or*1.5==rr;if(!hr){or+=8;var fr=[tr,0,0,0],ur=new Uint16Array(32770),pr=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],Or,gr,_r,Cr,xr,mr=0,dr=UTIF.decode._ljpeg_diff;for(ur[0]=15,_r=Or=0;Or<18;Or++)for(var vr=32768>>>(pr[Or]>>>8),gr=0;gr<vr;gr++)ur[++_r]=pr[Or];for(Cr=ar;Cr--;)for(xr=0;xr<or+1;xr+=2)if(xr==or&&(xr=1),mr+=dr(er,fr,ur),xr<or){var Ar=mr&4095;UTIF.decode._putsF(nr,(xr*ar+Cr)*lr,Ar<<16-lr)}return}if(ar*or*1.5==rr){for(var Or=0;Or<rr;Or+=3){var yr=er[tr+Or+0],wr=er[tr+Or+1],br=er[tr+Or+2];nr[sr+Or]=wr<<4|yr>>>4,nr[sr+Or+1]=yr<<4|br>>>4,nr[sr+Or+2]=br<<4|wr>>>4}return}var Sr=new Uint16Array(16),xr,Cr,Ir,Rr,Pr,Fr,Nr,Ur,Br,Or,Dr,Wr=new Uint8Array(ar+1);for(xr=0;xr<or;xr++){for(var $r=0;$r<ar;$r++)Wr[$r]=er[tr++];for(Dr=0,Cr=0;Cr<ar-30;Dr+=16){for(Rr=2047&(Ir=cr.readUint(Wr,Dr)),Pr=2047&Ir>>>11,Fr=15&Ir>>>22,Nr=15&Ir>>>26,Ur=0;Ur<4&&128<<Ur<=Rr-Pr;Ur++);for(Br=30,Or=0;Or<16;Or++)Or==Fr?Sr[Or]=Rr:Or==Nr?Sr[Or]=Pr:(Sr[Or]=((cr.readUshort(Wr,Dr+(Br>>3))>>>(Br&7)&127)<<Ur)+Pr,Sr[Or]>2047&&(Sr[Or]=2047),Br+=7);for(Or=0;Or<16;Or++,Cr+=2){var Ar=Sr[Or]<<1;UTIF.decode._putsF(nr,(xr*ar+Cr)*lr,Ar<<16-lr)}Cr-=Cr&1?1:31}}};UTIF.decode._decodeNikon=function(ir,er,tr,rr,nr,sr,ar){var or=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],lr=ir.t256[0],cr=ir.t257[0],hr=ir.t258[0],fr=0,ur=0,pr=UTIF.decode._make_decoder,gr=UTIF.decode._getbithuff,_r=er[0].exifIFD.makerNote,mr=_r.t150?_r.t150:_r.t140,dr=0,vr=mr[dr++],Ar=mr[dr++];(vr==73||Ar==88)&&(dr+=2110),vr==70&&(fr=2),hr==14&&(fr+=3);for(var yr=[[0,0],[0,0]],wr=ir.isLE?UTIF._binLE:UTIF._binBE,Ir=0;Ir<2;Ir++)for(var br=0;br<2;br++)yr[Ir][br]=wr.readShort(mr,dr),dr+=2;var Sr=1<<hr&32767,xr=0,Cr=wr.readShort(mr,dr);dr+=2,Cr>1&&(xr=Math.floor(Sr/(Cr-1))),vr==68&&Ar==32&&xr>0&&(ur=wr.readShort(mr,562));var Ir,Rr,Pr,Fr,Nr,Ur,Br=0,Or=[0,0],Dr=pr(or[fr]),Wr=[rr,0,0,0];for(Br=Rr=0;Rr<cr;Rr++)for(ur&&Rr==ur&&(Dr=pr(or[fr+1])),Pr=0;Pr<lr;Pr++){Ir=gr(tr,Wr,Dr[0],Dr),Fr=Ir&15,Nr=Ir>>>4,Ur=(gr(tr,Wr,Fr-Nr,0)<<1)+1<<Nr>>>1,Ur&1<<Fr-1||(Ur-=(1<<Fr)-(Nr==0?1:0)),Pr<2?Or[Pr]=yr[Rr&1][Pr]+=Ur:Or[Pr&1]+=Ur;var $r=Math.min(Math.max(Or[Pr&1],0),(1<<hr)-1),Yr=(Rr*lr+Pr)*hr;UTIF.decode._putsF(sr,Yr,$r<<16-hr)}};UTIF.decode._putsF=function(ir,er,tr){tr=tr<<8-(er&7);var rr=er>>>3;ir[rr]|=tr>>>16,ir[rr+1]|=tr>>>8,ir[rr+2]|=tr};UTIF.decode._getbithuff=function(ir,er,tr,rr){var nr=0,sr=UTIF.decode._get_byte,ar,or=er[0],lr=er[1],cr=er[2],hr=er[3];if(tr==0||cr<0)return 0;for(;!hr&&cr<tr&&(ar=ir[or++])!=-1&&!(hr=nr&&ar==255&&ir[or++]);)lr=(lr<<8)+ar,cr+=8;if(ar=lr<<32-cr>>>32-tr,rr?(cr-=rr[ar+1]>>>8,ar=rr[ar+1]&255):cr-=tr,cr<0)throw"e";return er[0]=or,er[1]=lr,er[2]=cr,er[3]=hr,ar};UTIF.decode._make_decoder=function(ir){var er,tr,rr,nr,sr,ar=[];for(er=16;er!=0&&!ir[er];er--);var or=17;for(ar[0]=er,rr=tr=1;tr<=er;tr++)for(nr=0;nr<ir[tr];nr++,++or)for(sr=0;sr<1<<er-tr;sr++)rr<=1<<er&&(ar[rr++]=tr<<8|ir[or]);return ar};UTIF.decode._decodeNewJPEG=function(ir,er,tr,rr,nr,sr){rr=Math.min(rr,er.length-tr);var ar=ir.t347,or=ar?ar.length:0,lr=new Uint8Array(or+rr);if(ar){for(var cr=216,hr=217,fr=0,ur=0;ur<or-1&&!(ar[ur]==255&&ar[ur+1]==hr);ur++)lr[fr++]=ar[ur];var pr=er[tr],gr=er[tr+1];(pr!=255||gr!=cr)&&(lr[fr++]=pr,lr[fr++]=gr);for(var ur=2;ur<rr;ur++)lr[fr++]=er[tr+ur]}else for(var ur=0;ur<rr;ur++)lr[ur]=er[tr+ur];if(ir.t262[0]==32803||ir.t259[0]==7&&ir.t262[0]==34892){var _r=ir.t258[0],mr=UTIF.LosslessJpegDecode(lr),dr=mr.length;if(_r==16)if(ir.isLE)for(var ur=0;ur<dr;ur++)nr[sr+(ur<<1)]=mr[ur]&255,nr[sr+(ur<<1)+1]=mr[ur]>>>8;else for(var ur=0;ur<dr;ur++)nr[sr+(ur<<1)]=mr[ur]>>>8,nr[sr+(ur<<1)+1]=mr[ur]&255;else if(_r==14||_r==12||_r==10)for(var vr=16-_r,ur=0;ur<dr;ur++)UTIF.decode._putsF(nr,ur*_r,mr[ur]<<vr);else if(_r==8)for(var ur=0;ur<dr;ur++)nr[sr+ur]=mr[ur];else throw new Error("unsupported bit depth "+_r)}else{var Ar=new UTIF.JpegDecoder;Ar.parse(lr);for(var yr=Ar.getData({width:Ar.width,height:Ar.height,forceRGB:!0,isSourcePDF:!1}),ur=0;ur<yr.length;ur++)nr[sr+ur]=yr[ur]}ir.t262[0]==6&&(ir.t262[0]=2)};UTIF.decode._decodeOldJPEGInit=function(ir,er,tr,rr){var nr=216,sr=217,ar=219,or=196,lr=221,cr=192,hr=218,fr=0,ur=0,pr,gr,_r=!1,mr,dr,vr,Ar=ir.t513,yr=Ar?Ar[0]:0,wr=ir.t514,br=wr?wr[0]:0,Sr=ir.t324||ir.t273||Ar,xr=ir.t530,Cr=0,Ir=0,Rr=ir.t277?ir.t277[0]:1,Pr=ir.t515;if(Sr&&(ur=Sr[0],_r=Sr.length>1),!_r){if(er[tr]==255&&er[tr+1]==nr)return{jpegOffset:tr};if(Ar!=null&&(er[tr+yr]==255&&er[tr+yr+1]==nr?fr=tr+yr:log("JPEGInterchangeFormat does not point to SOI"),wr==null?log("JPEGInterchangeFormatLength field is missing"):(yr>=ur||yr+br<=ur)&&log("JPEGInterchangeFormatLength field value is invalid"),fr!=null))return{jpegOffset:fr}}if(xr!=null&&(Cr=xr[0],Ir=xr[1]),Ar!=null&&wr!=null)if(br>=2&&yr+br<=ur){for(er[tr+yr+br-2]==255&&er[tr+yr+br-1]==nr?pr=new Uint8Array(br-2):pr=new Uint8Array(br),mr=0;mr<pr.length;mr++)pr[mr]=er[tr+yr+mr];log("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else log("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(pr==null){var Fr=0,Nr=[];Nr[Fr++]=255,Nr[Fr++]=nr;var Ur=ir.t519;if(Ur==null)throw new Error("JPEGQTables tag is missing");for(mr=0;mr<Ur.length;mr++)for(Nr[Fr++]=255,Nr[Fr++]=ar,Nr[Fr++]=0,Nr[Fr++]=67,Nr[Fr++]=mr,dr=0;dr<64;dr++)Nr[Fr++]=er[tr+Ur[mr]+dr];for(vr=0;vr<2;vr++){var Br=ir[vr==0?"t520":"t521"];if(Br==null)throw new Error((vr==0?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(mr=0;mr<Br.length;mr++){Nr[Fr++]=255,Nr[Fr++]=or;var Or=19;for(dr=0;dr<16;dr++)Or+=er[tr+Br[mr]+dr];for(Nr[Fr++]=Or>>>8,Nr[Fr++]=Or&255,Nr[Fr++]=mr|vr<<4,dr=0;dr<16;dr++)Nr[Fr++]=er[tr+Br[mr]+dr];for(dr=0;dr<Or;dr++)Nr[Fr++]=er[tr+Br[mr]+16+dr]}}if(Nr[Fr++]=255,Nr[Fr++]=cr,Nr[Fr++]=0,Nr[Fr++]=8+3*Rr,Nr[Fr++]=8,Nr[Fr++]=ir.height>>>8&255,Nr[Fr++]=ir.height&255,Nr[Fr++]=ir.width>>>8&255,Nr[Fr++]=ir.width&255,Nr[Fr++]=Rr,Rr==1)Nr[Fr++]=1,Nr[Fr++]=17,Nr[Fr++]=0;else for(mr=0;mr<3;mr++)Nr[Fr++]=mr+1,Nr[Fr++]=mr!=0?17:(Cr&15)<<4|Ir&15,Nr[Fr++]=mr;Pr!=null&&Pr[0]!=0&&(Nr[Fr++]=255,Nr[Fr++]=lr,Nr[Fr++]=0,Nr[Fr++]=4,Nr[Fr++]=Pr[0]>>>8&255,Nr[Fr++]=Pr[0]&255),pr=new Uint8Array(Nr)}var Dr=-1;for(mr=0;mr<pr.length-1;){if(pr[mr]==255&&pr[mr+1]==cr){Dr=mr;break}mr++}if(Dr==-1){var Wr=new Uint8Array(pr.length+10+3*Rr);Wr.set(pr);var $r=pr.length;if(Dr=pr.length,pr=Wr,pr[$r++]=255,pr[$r++]=cr,pr[$r++]=0,pr[$r++]=8+3*Rr,pr[$r++]=8,pr[$r++]=ir.height>>>8&255,pr[$r++]=ir.height&255,pr[$r++]=ir.width>>>8&255,pr[$r++]=ir.width&255,pr[$r++]=Rr,Rr==1)pr[$r++]=1,pr[$r++]=17,pr[$r++]=0;else for(mr=0;mr<3;mr++)pr[$r++]=mr+1,pr[$r++]=mr!=0?17:(Cr&15)<<4|Ir&15,pr[$r++]=mr}if(er[ur]==255&&er[ur+1]==hr){var Yr=er[ur+2]<<8|er[ur+3];for(gr=new Uint8Array(Yr+2),gr[0]=er[ur],gr[1]=er[ur+1],gr[2]=er[ur+2],gr[3]=er[ur+3],mr=0;mr<Yr-2;mr++)gr[mr+4]=er[ur+mr+4]}else{gr=new Uint8Array(8+2*Rr);var Qi=0;if(gr[Qi++]=255,gr[Qi++]=hr,gr[Qi++]=0,gr[Qi++]=6+2*Rr,gr[Qi++]=Rr,Rr==1)gr[Qi++]=1,gr[Qi++]=0;else for(mr=0;mr<3;mr++)gr[Qi++]=mr+1,gr[Qi++]=mr<<4|mr;gr[Qi++]=0,gr[Qi++]=63,gr[Qi++]=0}return{jpegOffset:tr,tables:pr,sosMarker:gr,sofPosition:Dr}};UTIF.decode._decodeOldJPEG=function(ir,er,tr,rr,nr,sr){var ar,or,lr,cr,hr,fr=UTIF.decode._decodeOldJPEGInit(ir,er,tr,rr);if(fr.jpegOffset!=null)for(or=tr+rr-fr.jpegOffset,cr=new Uint8Array(or),ar=0;ar<or;ar++)cr[ar]=er[fr.jpegOffset+ar];else{for(lr=fr.tables.length,cr=new Uint8Array(lr+fr.sosMarker.length+rr+2),cr.set(fr.tables),hr=lr,cr[fr.sofPosition+5]=ir.height>>>8&255,cr[fr.sofPosition+6]=ir.height&255,cr[fr.sofPosition+7]=ir.width>>>8&255,cr[fr.sofPosition+8]=ir.width&255,(er[tr]!=255||er[tr+1]!=SOS)&&(cr.set(fr.sosMarker,hr),hr+=sosMarker.length),ar=0;ar<rr;ar++)cr[hr++]=er[tr+ar];cr[hr++]=255,cr[hr++]=EOI}var ur=new UTIF.JpegDecoder;ur.parse(cr);for(var pr=ur.getData({width:ur.width,height:ur.height,forceRGB:!0,isSourcePDF:!1}),ar=0;ar<pr.length;ar++)nr[sr+ar]=pr[ar];ir.t262&&ir.t262[0]==6&&(ir.t262[0]=2)};UTIF.decode._decodePackBits=function(ir,er,tr,rr,nr){for(var sr=new Int8Array(ir.buffer),ar=new Int8Array(rr.buffer),or=er+tr;er<or;){var lr=sr[er];if(er++,lr>=0&&lr<128)for(var cr=0;cr<lr+1;cr++)ar[nr]=sr[er],nr++,er++;if(lr>=-127&&lr<0){for(var cr=0;cr<-lr+1;cr++)ar[nr]=sr[er],nr++;er++}}return nr};UTIF.decode._decodeThunder=function(ir,er,tr,rr,nr){for(var sr=[0,1,0,-1],ar=[0,1,2,3,0,-3,-2,-1],or=er+tr,lr=nr*2,cr=0;er<or;){var hr=ir[er],fr=hr>>>6,ur=hr&63;if(er++,fr==3&&(cr=ur&15,rr[lr>>>1]|=cr<<4*(1-lr&1),lr++),fr==0)for(var pr=0;pr<ur;pr++)rr[lr>>>1]|=cr<<4*(1-lr&1),lr++;if(fr==2)for(var pr=0;pr<2;pr++){var gr=ur>>>3*(1-pr)&7;gr!=4&&(cr+=ar[gr],rr[lr>>>1]|=cr<<4*(1-lr&1),lr++)}if(fr==1)for(var pr=0;pr<3;pr++){var gr=ur>>>2*(2-pr)&3;gr!=2&&(cr+=sr[gr],rr[lr>>>1]|=cr<<4*(1-lr&1),lr++)}}};UTIF.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3};UTIF.decode._lens=function(){var ir=function(lr,cr,hr,fr){for(var ur=0;ur<cr.length;ur++)lr[cr[ur]]=hr+ur*fr},er="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",tr="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",rr="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",nr="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",sr="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";er=er.split(","),tr=tr.split(","),rr=rr.split(","),nr=nr.split(","),sr=sr.split(",");var ar={},or={};return ir(ar,er,0,1),ir(ar,rr,64,64),ir(ar,sr,1792,64),ir(or,tr,0,1),ir(or,nr,64,64),ir(or,sr,1792,64),[ar,or]}();UTIF.decode._decodeG4=function(ir,er,tr,rr,nr,sr,ar){for(var or=UTIF.decode,lr=er<<3,cr=0,hr="",fr=[],ur=[],pr=0;pr<sr;pr++)ur.push(0);ur=or._makeDiff(ur);for(var gr=0,_r=0,mr=0,dr=0,vr=0,Ar=0,yr=0,wr="",br=0,Sr=Math.ceil(sr/8)*8;lr>>>3<er+tr;){dr=or._findDiff(ur,gr+(gr==0?0:1),1-Ar),vr=or._findDiff(ur,dr,Ar);var xr=0;if(ar==1&&(xr=ir[lr>>>3]>>>7-(lr&7)&1),ar==2&&(xr=ir[lr>>>3]>>>(lr&7)&1),lr++,hr+=xr,wr=="H"){if(or._lens[Ar][hr]!=null){var Cr=or._lens[Ar][hr];hr="",cr+=Cr,Cr<64&&(or._addNtimes(fr,cr,Ar),gr+=cr,Ar=1-Ar,cr=0,br--,br==0&&(wr=""))}}else hr=="0001"&&(hr="",or._addNtimes(fr,vr-gr,Ar),gr=vr),hr=="001"&&(hr="",wr="H",br=2),or._dmap[hr]!=null&&(_r=dr+or._dmap[hr],or._addNtimes(fr,_r-gr,Ar),gr=_r,hr="",Ar=1-Ar);fr.length==sr&&wr==""&&(or._writeBits(fr,rr,nr*8+yr*Sr),Ar=0,yr++,gr=0,ur=or._makeDiff(fr),fr=[])}};UTIF.decode._findDiff=function(ir,er,tr){for(var rr=0;rr<ir.length;rr+=2)if(ir[rr]>=er&&ir[rr+1]==tr)return ir[rr]};UTIF.decode._makeDiff=function(ir){var er=[];ir[0]==1&&er.push(0,1);for(var tr=1;tr<ir.length;tr++)ir[tr-1]!=ir[tr]&&er.push(tr,ir[tr]);return er.push(ir.length,0,ir.length,1),er};UTIF.decode._decodeG2=function(ir,er,tr,rr,nr,sr,ar){for(var or=UTIF.decode,lr=er<<3,cr=0,hr="",fr=[],ur=0,pr=0,gr=Math.ceil(sr/8)*8;lr>>>3<er+tr;){var _r=0;ar==1&&(_r=ir[lr>>>3]>>>7-(lr&7)&1),ar==2&&(_r=ir[lr>>>3]>>>(lr&7)&1),lr++,hr+=_r,cr=or._lens[ur][hr],cr!=null&&(or._addNtimes(fr,cr,ur),hr="",cr<64&&(ur=1-ur),fr.length==sr&&(or._writeBits(fr,rr,nr*8+pr*gr),fr=[],pr++,ur=0,lr&7&&(lr+=8-(lr&7)),cr>=64&&(lr+=8)))}};UTIF.decode._decodeG3=function(ir,er,tr,rr,nr,sr,ar,or){for(var lr=UTIF.decode,cr=er<<3,hr=0,fr="",ur=[],pr=[],gr=0;gr<sr;gr++)ur.push(0);for(var _r=0,mr=0,dr=0,vr=0,Ar=0,yr=0,wr=-1,br="",Sr=0,xr=!0,Cr=Math.ceil(sr/8)*8;cr>>>3<er+tr;){vr=lr._findDiff(pr,_r+(_r==0?0:1),1-yr),Ar=lr._findDiff(pr,vr,yr);var Ir=0;if(ar==1&&(Ir=ir[cr>>>3]>>>7-(cr&7)&1),ar==2&&(Ir=ir[cr>>>3]>>>(cr&7)&1),cr++,fr+=Ir,xr){if(lr._lens[yr][fr]!=null){var Rr=lr._lens[yr][fr];fr="",hr+=Rr,Rr<64&&(lr._addNtimes(ur,hr,yr),yr=1-yr,hr=0)}}else if(br=="H"){if(lr._lens[yr][fr]!=null){var Rr=lr._lens[yr][fr];fr="",hr+=Rr,Rr<64&&(lr._addNtimes(ur,hr,yr),_r+=hr,yr=1-yr,hr=0,Sr--,Sr==0&&(br=""))}}else fr=="0001"&&(fr="",lr._addNtimes(ur,Ar-_r,yr),_r=Ar),fr=="001"&&(fr="",br="H",Sr=2),lr._dmap[fr]!=null&&(mr=vr+lr._dmap[fr],lr._addNtimes(ur,mr-_r,yr),_r=mr,fr="",yr=1-yr);fr.endsWith("000000000001")&&(wr>=0&&lr._writeBits(ur,rr,nr*8+wr*Cr),or&&(ar==1&&(xr=(ir[cr>>>3]>>>7-(cr&7)&1)==1),ar==2&&(xr=(ir[cr>>>3]>>>(cr&7)&1)==1),cr++),fr="",yr=0,wr++,_r=0,pr=lr._makeDiff(ur),ur=[])}ur.length==sr&&lr._writeBits(ur,rr,nr*8+wr*Cr)};UTIF.decode._addNtimes=function(ir,er,tr){for(var rr=0;rr<er;rr++)ir.push(tr)};UTIF.decode._writeBits=function(ir,er,tr){for(var rr=0;rr<ir.length;rr++)er[tr+rr>>>3]|=ir[rr]<<7-(tr+rr&7)};UTIF.decode._decodeLZW=UTIF.decode._decodeLZW=function(){var ir,er,tr,rr,nr=0,sr=0,ar=0,or=0,lr=function(){var mr=ir>>>3,dr=er[mr]<<16|er[mr+1]<<8|er[mr+2],vr=dr>>>24-(ir&7)-sr&(1<<sr)-1;return ir+=sr,vr},cr=new Uint32Array(4096*4),hr=0,fr=function(mr){if(mr!=hr){hr=mr,ar=1<<mr,or=ar+1;for(var dr=0;dr<or+1;dr++)cr[4*dr]=cr[4*dr+3]=dr,cr[4*dr+1]=65535,cr[4*dr+2]=1}},ur=function(mr){sr=mr+1,nr=or+1},pr=function(mr){for(var dr=mr<<2,vr=cr[dr+2],Ar=rr+vr-1;dr!=65535;)tr[Ar--]=cr[dr],dr=cr[dr+1];rr+=vr},gr=function(mr,dr){var vr=nr<<2,Ar=mr<<2;cr[vr]=cr[(dr<<2)+3],cr[vr+1]=Ar,cr[vr+2]=cr[Ar+2]+1,cr[vr+3]=cr[Ar+3],nr++,nr+1==1<<sr&&sr!=12&&sr++},_r=function(mr,dr,vr,Ar,yr,wr){ir=dr<<3,er=mr,tr=Ar,rr=yr;var br=dr+vr<<3,Sr=0,xr=0;for(fr(wr),ur(wr);ir<br&&(Sr=lr())!=or;){if(Sr==ar){if(ur(wr),Sr=lr(),Sr==or)break;pr(Sr)}else Sr<nr?(pr(Sr),gr(xr,Sr)):(gr(xr,xr),pr(nr-1));xr=Sr}return rr};return _r}();UTIF.tags={};UTIF._types=function(){var ir=new Array(250);ir.fill(0),ir=ir.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);var er={33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7};return{basic:{main:ir,rest:er},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}}();UTIF._readIFD=function(ir,er,tr,rr,nr,sr){var ar=ir.readUshort(er,tr);tr+=2;var or={};sr.debug&&log("   ".repeat(nr),rr.length-1,">>>----------------");for(var lr=0;lr<ar;lr++){var cr=ir.readUshort(er,tr);tr+=2;var hr=ir.readUshort(er,tr);tr+=2;var fr=ir.readUint(er,tr);tr+=4;var ur=ir.readUint(er,tr);tr+=4;var pr=[];if(hr==1||hr==7){var gr=fr<5?tr-4:ur;gr+fr>er.buffer.byteLength&&(fr=er.buffer.byteLength-gr),pr=new Uint8Array(er.buffer,gr,fr)}if(hr==2){var _r=fr<5?tr-4:ur,mr=er[_r],dr=Math.max(0,Math.min(fr-1,er.length-_r));mr<128||dr==0?pr.push(ir.readASCII(er,_r,dr)):pr=new Uint8Array(er.buffer,_r,dr)}if(hr==3)for(var vr=0;vr<fr;vr++)pr.push(ir.readUshort(er,(fr<3?tr-4:ur)+2*vr));if(hr==4||hr==13)for(var vr=0;vr<fr;vr++)pr.push(ir.readUint(er,(fr<2?tr-4:ur)+4*vr));if(hr==5||hr==10)for(var Ar=hr==5?ir.readUint:ir.readInt,vr=0;vr<fr;vr++)pr.push([Ar(er,ur+vr*8),Ar(er,ur+vr*8+4)]);if(hr==8)for(var vr=0;vr<fr;vr++)pr.push(ir.readShort(er,(fr<3?tr-4:ur)+2*vr));if(hr==9)for(var vr=0;vr<fr;vr++)pr.push(ir.readInt(er,(fr<2?tr-4:ur)+4*vr));if(hr==11)for(var vr=0;vr<fr;vr++)pr.push(ir.readFloat(er,ur+vr*4));if(hr==12)for(var vr=0;vr<fr;vr++)pr.push(ir.readDouble(er,ur+vr*8));if(fr!=0&&pr.length==0){if(log(cr,"unknown TIFF tag type: ",hr,"num:",fr),lr==0)return;continue}if(sr.debug&&log("   ".repeat(nr),cr,hr,UTIF.tags[cr],pr),or["t"+cr]=pr,!(cr==330&&or.t272&&or.t272[0]=="DSLR-A100")){if(cr==330||cr==34665||cr==34853||cr==50740&&ir.readUshort(er,ir.readUint(pr,0))<300||cr==61440){for(var yr=cr==50740?[ir.readUint(pr,0)]:pr,wr=[],vr=0;vr<yr.length;vr++)UTIF._readIFD(ir,er,yr[vr],wr,nr+1,sr);cr==330&&(or.subIFD=wr),cr==34665&&(or.exifIFD=wr[0]),cr==34853&&(or.gpsiIFD=wr[0]),cr==50740&&(or.dngPrvt=wr[0]),cr==61440&&(or.fujiIFD=wr[0])}}if(cr==37500&&sr.parseMN){var br=pr;if(ir.readASCII(br,0,5)=="Nikon")or.makerNote=UTIF.decode(br.slice(10).buffer)[0];else if(ir.readASCII(br,0,5)=="OLYMP"||ir.readASCII(br,0,9)=="OM SYSTEM"){var Sr=[8208,8224,8240,8256,8272],xr=[];UTIF._readIFD(ir,br,br[1]==77?16:br[5]==85?12:8,xr,nr+1,sr);for(var Cr=or.makerNote=xr.pop(),vr=0;vr<Sr.length;vr++){var Ir="t"+Sr[vr];Cr[Ir]!=null&&(UTIF._readIFD(ir,br,Cr[Ir][0],xr,nr+1,sr),Cr[Ir]=xr.pop())}Cr.t12288&&(UTIF._readIFD(ir,Cr.t12288,0,xr,nr+1,sr),Cr.t12288=xr.pop())}else if(ir.readUshort(er,ur)<300&&ir.readUshort(er,ur+4)<=12){var xr=[];UTIF._readIFD(ir,er,ur,xr,nr+1,sr),or.makerNote=xr[0]}}}return rr.push(or),sr.debug&&log("   ".repeat(nr),"<<<---------------"),tr};UTIF._writeIFD=function(ir,er,tr,rr,nr){var sr=Object.keys(nr),ar=sr.length;nr.exifIFD&&ar--,nr.gpsiIFD&&ar--,ir.writeUshort(tr,rr,ar),rr+=2;for(var or=rr+ar*12+4,lr=0;lr<sr.length;lr++){var cr=sr[lr];if(!(cr=="t34665"||cr=="t34853")){cr=="exifIFD"&&(cr="t34665"),cr=="gpsiIFD"&&(cr="t34853");var hr=parseInt(cr.slice(1)),fr=er.main[hr];if(fr==null&&(fr=er.rest[hr]),fr==null||fr==0)throw new Error("unknown type of tag: "+hr);var ur=nr[cr];if(hr==34665){var pr=UTIF._writeIFD(ir,er,tr,or,nr.exifIFD);ur=[or],or=pr[1]}if(hr==34853){var pr=UTIF._writeIFD(ir,UTIF._types.gps,tr,or,nr.gpsiIFD);ur=[or],or=pr[1]}fr==2&&(ur=ur[0]+"\0");var gr=ur.length;ir.writeUshort(tr,rr,hr),rr+=2,ir.writeUshort(tr,rr,fr),rr+=2,ir.writeUint(tr,rr,gr),rr+=4;var _r=[-1,1,1,2,4,8,0,1,0,4,8,0,8][fr]*gr,mr=rr;if(_r>4&&(ir.writeUint(tr,rr,or),mr=or),fr==1||fr==7)for(var dr=0;dr<gr;dr++)tr[mr+dr]=ur[dr];else if(fr==2)ir.writeASCII(tr,mr,ur);else if(fr==3)for(var dr=0;dr<gr;dr++)ir.writeUshort(tr,mr+2*dr,ur[dr]);else if(fr==4)for(var dr=0;dr<gr;dr++)ir.writeUint(tr,mr+4*dr,ur[dr]);else if(fr==5||fr==10)for(var vr=fr==5?ir.writeUint:ir.writeInt,dr=0;dr<gr;dr++){var Ar=ur[dr],yr=Ar[0],wr=Ar[1];if(yr==null)throw"e";vr(tr,mr+8*dr,yr),vr(tr,mr+8*dr+4,wr)}else if(fr==9)for(var dr=0;dr<gr;dr++)ir.writeInt(tr,mr+4*dr,ur[dr]);else if(fr==12)for(var dr=0;dr<gr;dr++)ir.writeDouble(tr,mr+8*dr,ur[dr]);else throw fr;_r>4&&(_r+=_r&1,or+=_r),rr+=4}}return[rr,or]};UTIF.toRGBA8=function(ir,er){function tr(Ki){return Ki<.0031308?12.92*Ki:1.055*Math.pow(Ki,1/2.4)-.055}var rr=ir.width,nr=ir.height,sr=rr*nr,ar=sr*4,or=ir.data,lr=new Uint8Array(sr*4),cr=ir.t262?ir.t262[0]:2,hr=ir.t258?Math.min(32,ir.t258[0]):1;ir.t262==null&&hr==1&&(cr=0);var fr=ir.t277?ir.t277[0]:ir.t258?ir.t258.length:[1,1,3,1,1,4,3][cr],ur=ir.t339?ir.t339[0]:null;if(cr==1&&hr==32&&ur!=3)throw"e";var pr=Math.ceil(fr*hr*rr/8);if(cr==0){er=1/256;for(var gr=0;gr<nr;gr++){var _r=gr*pr,mr=gr*rr;if(hr==1)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,Ar=or[_r+(dr>>3)]>>7-(dr&7)&1;lr[vr]=lr[vr+1]=lr[vr+2]=(1-Ar)*255,lr[vr+3]=255}if(hr==4)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,Ar=or[_r+(dr>>1)]>>4-4*(dr&1)&15;lr[vr]=lr[vr+1]=lr[vr+2]=(15-Ar)*17,lr[vr+3]=255}if(hr==8)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,Ar=or[_r+dr];lr[vr]=lr[vr+1]=lr[vr+2]=255-Ar,lr[vr+3]=255}if(hr==16)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,yr=_r+2*dr,Ar=or[yr+1]<<8|or[yr];lr[vr]=lr[vr+1]=lr[vr+2]=Math.min(255,255-~~(Ar*er)),lr[vr+3]=255}}}else if(cr==1){er==null&&(er=1/256);for(var wr=or.length&3?null:new Float32Array(or.buffer),gr=0;gr<nr;gr++){var _r=gr*pr,mr=gr*rr;if(hr==1)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,Ar=or[_r+(dr>>3)]>>7-(dr&7)&1;lr[vr]=lr[vr+1]=lr[vr+2]=Ar*255,lr[vr+3]=255}if(hr==2)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,Ar=or[_r+(dr>>2)]>>6-2*(dr&3)&3;lr[vr]=lr[vr+1]=lr[vr+2]=Ar*85,lr[vr+3]=255}if(hr==8)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,Ar=or[_r+dr*fr];lr[vr]=lr[vr+1]=lr[vr+2]=Ar,lr[vr+3]=255}if(hr==16)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,yr=_r+2*dr,Ar=or[yr+1]<<8|or[yr];lr[vr]=lr[vr+1]=lr[vr+2]=Math.min(255,~~(Ar*er)),lr[vr+3]=255}if(hr==32)for(var dr=0;dr<rr;dr++){var vr=mr+dr<<2,yr=(_r>>>2)+dr,Ar=wr[yr];lr[vr]=lr[vr+1]=lr[vr+2]=~~(.5+255*Ar),lr[vr+3]=255}}}else if(cr==2)if(hr==8){if(fr==1)for(var dr=0;dr<sr;dr++)lr[4*dr]=lr[4*dr+1]=lr[4*dr+2]=or[dr],lr[4*dr+3]=255;if(fr==3)for(var dr=0;dr<sr;dr++){var vr=dr<<2,br=dr*3;lr[vr]=or[br],lr[vr+1]=or[br+1],lr[vr+2]=or[br+2],lr[vr+3]=255}if(fr>=4)for(var dr=0;dr<sr;dr++){var vr=dr<<2,br=dr*fr;lr[vr]=or[br],lr[vr+1]=or[br+1],lr[vr+2]=or[br+2],lr[vr+3]=or[br+3]}}else if(hr==16){if(fr==4)for(var dr=0;dr<sr;dr++){var vr=dr<<2,br=dr*8+1;lr[vr]=or[br],lr[vr+1]=or[br+2],lr[vr+2]=or[br+4],lr[vr+3]=or[br+6]}if(fr==3)for(var dr=0;dr<sr;dr++){var vr=dr<<2,br=dr*6+1;lr[vr]=or[br],lr[vr+1]=or[br+2],lr[vr+2]=or[br+4],lr[vr+3]=255}}else if(hr==32){for(var Sr=new Float32Array(or.buffer),xr=0,dr=0;dr<Sr.length;dr++)xr=Math.min(xr,Sr[dr]);if(xr<0)for(var dr=0;dr<or.length;dr+=4){var Cr=or[dr];or[dr]=or[dr+3],or[dr+3]=Cr,Cr=or[dr+1],or[dr+1]=or[dr+2],or[dr+2]=Cr}for(var Ir=[],dr=0;dr<65536;dr++)Ir.push(tr(dr/65535));for(var dr=0;dr<Sr.length;dr++){var Rr=Math.max(0,Math.min(1,Sr[dr]));Sr[dr]=Ir[~~(.5+Rr*65535)]}if(fr==3)for(var dr=0;dr<sr;dr++){var vr=dr<<2,br=dr*3;lr[vr]=~~(.5+Sr[br]*255),lr[vr+1]=~~(.5+Sr[br+1]*255),lr[vr+2]=~~(.5+Sr[br+2]*255),lr[vr+3]=255}else if(fr==4)for(var dr=0;dr<sr;dr++){var vr=dr<<2,br=dr*4;lr[vr]=~~(.5+Sr[br]*255),lr[vr+1]=~~(.5+Sr[br+1]*255),lr[vr+2]=~~(.5+Sr[br+2]*255),lr[vr+3]=~~(.5+Sr[br+3]*255)}else throw fr}else throw hr;else if(cr==3)for(var Pr=ir.t320,Fr=1<<hr,Nr=hr==8&&fr>1&&ir.t338&&ir.t338[0]!=0,gr=0;gr<nr;gr++)for(var Ur=0;Ur<rr;Ur++){var dr=gr*rr+Ur,vr=dr<<2,Br=0,Or=gr*pr;if(hr==1)Br=or[Or+(Ur>>>3)]>>>7-(Ur&7)&1;else if(hr==2)Br=or[Or+(Ur>>>2)]>>>6-2*(Ur&3)&3;else if(hr==4)Br=or[Or+(Ur>>>1)]>>>4-4*(Ur&1)&15;else if(hr==8)Br=or[Or+Ur*fr];else throw hr;lr[vr]=Pr[Br]>>8,lr[vr+1]=Pr[Fr+Br]>>8,lr[vr+2]=Pr[Fr+Fr+Br]>>8,lr[vr+3]=Nr?or[Or+Ur*fr+1]:255}else if(cr==5)for(var Dr=fr>4?1:0,dr=0;dr<sr;dr++){var vr=dr<<2,Wr=dr*fr;if(window.UDOC){var $r=or[Wr],Yr=or[Wr+1],Qi=or[Wr+2],rs=or[Wr+3],Kr=UDOC.C.cmykToRgb([$r*(1/255),Yr*(1/255),Qi*(1/255),rs*(1/255)]);lr[vr]=~~(.5+255*Kr[0]),lr[vr+1]=~~(.5+255*Kr[1]),lr[vr+2]=~~(.5+255*Kr[2])}else{var $r=255-or[Wr],Yr=255-or[Wr+1],Qi=255-or[Wr+2],rs=(255-or[Wr+3])*(1/255);lr[vr]=~~($r*rs+.5),lr[vr+1]=~~(Yr*rs+.5),lr[vr+2]=~~(Qi*rs+.5)}lr[vr+3]=255*(1-Dr)+or[Wr+4]*Dr}else if(cr==6&&ir.t278)for(var Qr=ir.t278[0],gr=0;gr<nr;gr+=Qr)for(var dr=gr*rr,Vr=Qr*rr,Gr=0;Gr<Vr;Gr++){var vr=4*(dr+Gr),Wr=3*dr+4*(Gr>>>1),Qi=or[Wr+(Gr&1)],qr=or[Wr+2]-128,ji=or[Wr+3]-128,Zr=Qi+((ji>>2)+(ji>>3)+(ji>>5)),Zi=Qi-((qr>>2)+(qr>>4)+(qr>>5))-((ji>>1)+(ji>>3)+(ji>>4)+(ji>>5)),Yi=Qi+(qr+(qr>>1)+(qr>>2)+(qr>>6));lr[vr]=Math.max(0,Math.min(255,Zr)),lr[vr+1]=Math.max(0,Math.min(255,Zi)),lr[vr+2]=Math.max(0,Math.min(255,Yi)),lr[vr+3]=255}else if(cr==32845)for(var gr=0;gr<nr;gr++)for(var Ur=0;Ur<rr;Ur++){var Wr=(gr*rr+Ur)*6,vr=(gr*rr+Ur)*4,qi=or[Wr+1]<<8|or[Wr],qi=Math.pow(2,(qi+.5)/256-64),Xr=(or[Wr+3]+.5)/410,ns=(or[Wr+5]+.5)/410,os=9*Xr/(6*Xr-16*ns+12),us=4*ns/(6*Xr-16*ns+12),is=qi,Ji=os*is/us,Qi=is,ms=(1-os-us)*is/us,Zr=2.69*Ji-1.276*Qi-.414*ms,Zi=-1.022*Ji+1.978*Qi+.044*ms,Yi=.061*Ji-.224*Qi+1.163*ms;lr[vr]=tr(Math.min(Zr,1))*255,lr[vr+1]=tr(Math.min(Zi,1))*255,lr[vr+2]=tr(Math.min(Yi,1))*255,lr[vr+3]=255}else log("Unknown Photometric interpretation: "+cr);return lr};UTIF.replaceIMG=function(ir){ir==null&&(ir=document.getElementsByTagName("img"));for(var er=["tif","tiff","dng","cr2","nef"],tr=0;tr<ir.length;tr++){var rr=ir[tr],nr=rr.getAttribute("src");if(nr!=null){var sr=nr.split(".").pop().toLowerCase();if(er.indexOf(sr)!=-1){var ar=new XMLHttpRequest;UTIF._xhrs.push(ar),UTIF._imgs.push(rr),ar.open("GET",nr),ar.responseType="arraybuffer",ar.onload=UTIF._imgLoaded,ar.send()}}}};UTIF._xhrs=[];UTIF._imgs=[];UTIF._imgLoaded=function(ir){var er=UTIF._xhrs.indexOf(ir.target),tr=UTIF._imgs[er];UTIF._xhrs.splice(er,1),UTIF._imgs.splice(er,1),tr.setAttribute("src",UTIF.bufferToURI(ir.target.response))};UTIF.bufferToURI=function(ir){var er=UTIF.decode(ir),tr=er,rr=0,nr=tr[0];er[0].subIFD&&(tr=tr.concat(er[0].subIFD));for(var sr=0;sr<tr.length;sr++){var ar=tr[sr];if(!(ar.t258==null||ar.t258.length<3)){var or=ar.t256*ar.t257;or>rr&&(rr=or,nr=ar)}}UTIF.decodeImage(ir,nr,er);var lr=UTIF.toRGBA8(nr),cr=nr.width,hr=nr.height,fr=document.createElement("canvas");fr.width=cr,fr.height=hr;var ur=fr.getContext("2d"),pr=new ImageData(new Uint8ClampedArray(lr.buffer),cr,hr);return ur.putImageData(pr,0,0),fr.toDataURL()};UTIF._binBE={nextZero:function(ir,er){for(;ir[er]!=0;)er++;return er},readUshort:function(ir,er){return ir[er]<<8|ir[er+1]},readShort:function(ir,er){var tr=UTIF._binBE.ui8;return tr[0]=ir[er+1],tr[1]=ir[er+0],UTIF._binBE.i16[0]},readInt:function(ir,er){var tr=UTIF._binBE.ui8;return tr[0]=ir[er+3],tr[1]=ir[er+2],tr[2]=ir[er+1],tr[3]=ir[er+0],UTIF._binBE.i32[0]},readUint:function(ir,er){var tr=UTIF._binBE.ui8;return tr[0]=ir[er+3],tr[1]=ir[er+2],tr[2]=ir[er+1],tr[3]=ir[er+0],UTIF._binBE.ui32[0]},readASCII:function(ir,er,tr){for(var rr="",nr=0;nr<tr;nr++)rr+=String.fromCharCode(ir[er+nr]);return rr},readFloat:function(ir,er){for(var tr=UTIF._binBE.ui8,rr=0;rr<4;rr++)tr[rr]=ir[er+3-rr];return UTIF._binBE.fl32[0]},readDouble:function(ir,er){for(var tr=UTIF._binBE.ui8,rr=0;rr<8;rr++)tr[rr]=ir[er+7-rr];return UTIF._binBE.fl64[0]},writeUshort:function(ir,er,tr){ir[er]=tr>>8&255,ir[er+1]=tr&255},writeInt:function(ir,er,tr){var rr=UTIF._binBE.ui8;UTIF._binBE.i32[0]=tr,ir[er+3]=rr[0],ir[er+2]=rr[1],ir[er+1]=rr[2],ir[er+0]=rr[3]},writeUint:function(ir,er,tr){ir[er]=tr>>24&255,ir[er+1]=tr>>16&255,ir[er+2]=tr>>8&255,ir[er+3]=tr>>0&255},writeASCII:function(ir,er,tr){for(var rr=0;rr<tr.length;rr++)ir[er+rr]=tr.charCodeAt(rr)},writeDouble:function(ir,er,tr){UTIF._binBE.fl64[0]=tr;for(var rr=0;rr<8;rr++)ir[er+rr]=UTIF._binBE.ui8[7-rr]}};UTIF._binBE.ui8=new Uint8Array(8);UTIF._binBE.i16=new Int16Array(UTIF._binBE.ui8.buffer);UTIF._binBE.i32=new Int32Array(UTIF._binBE.ui8.buffer);UTIF._binBE.ui32=new Uint32Array(UTIF._binBE.ui8.buffer);UTIF._binBE.fl32=new Float32Array(UTIF._binBE.ui8.buffer);UTIF._binBE.fl64=new Float64Array(UTIF._binBE.ui8.buffer);UTIF._binLE={nextZero:UTIF._binBE.nextZero,readUshort:function(ir,er){return ir[er+1]<<8|ir[er]},readShort:function(ir,er){var tr=UTIF._binBE.ui8;return tr[0]=ir[er+0],tr[1]=ir[er+1],UTIF._binBE.i16[0]},readInt:function(ir,er){var tr=UTIF._binBE.ui8;return tr[0]=ir[er+0],tr[1]=ir[er+1],tr[2]=ir[er+2],tr[3]=ir[er+3],UTIF._binBE.i32[0]},readUint:function(ir,er){var tr=UTIF._binBE.ui8;return tr[0]=ir[er+0],tr[1]=ir[er+1],tr[2]=ir[er+2],tr[3]=ir[er+3],UTIF._binBE.ui32[0]},readASCII:UTIF._binBE.readASCII,readFloat:function(ir,er){for(var tr=UTIF._binBE.ui8,rr=0;rr<4;rr++)tr[rr]=ir[er+rr];return UTIF._binBE.fl32[0]},readDouble:function(ir,er){for(var tr=UTIF._binBE.ui8,rr=0;rr<8;rr++)tr[rr]=ir[er+rr];return UTIF._binBE.fl64[0]},writeUshort:function(ir,er,tr){ir[er]=tr&255,ir[er+1]=tr>>8&255},writeInt:function(ir,er,tr){var rr=UTIF._binBE.ui8;UTIF._binBE.i32[0]=tr,ir[er+0]=rr[0],ir[er+1]=rr[1],ir[er+2]=rr[2],ir[er+3]=rr[3]},writeUint:function(ir,er,tr){ir[er]=tr>>>0&255,ir[er+1]=tr>>>8&255,ir[er+2]=tr>>>16&255,ir[er+3]=tr>>>24&255},writeASCII:UTIF._binBE.writeASCII};UTIF._copyTile=function(ir,er,tr,rr,nr,sr,ar,or){for(var lr=Math.min(er,nr-ar),cr=Math.min(tr,sr-or),hr=0;hr<cr;hr++)for(var fr=(or+hr)*nr+ar,ur=hr*er,pr=0;pr<lr;pr++)rr[fr+pr]=ir[ur+pr]};UTIF._inflateRaw=function(){var ir={};return ir.H={},ir.H.N=function(er,tr){var rr=Uint8Array,nr=0,sr=0,ar=0,or=0,lr=0,cr=0,hr=0,fr=0,ur=0,pr,gr;if(er[0]==3&&er[1]==0)return tr||new rr(0);var _r=ir.H,mr=_r.b,dr=_r.e,vr=_r.R,Ar=_r.n,yr=_r.A,wr=_r.Z,br=_r.m,Sr=tr==null;for(Sr&&(tr=new rr(er.length>>>2<<5));nr==0;){if(nr=mr(er,ur,1),sr=mr(er,ur+1,2),ur+=3,sr==0){ur&7&&(ur+=8-(ur&7));var xr=(ur>>>3)+4,Cr=er[xr-4]|er[xr-3]<<8;Sr&&(tr=ir.H.W(tr,fr+Cr)),tr.set(new rr(er.buffer,er.byteOffset+xr,Cr),fr),ur=xr+Cr<<3,fr+=Cr;continue}if(Sr&&(tr=ir.H.W(tr,fr+(1<<17))),sr==1&&(pr=br.J,gr=br.h,cr=511,hr=31),sr==2){ar=dr(er,ur,5)+257,or=dr(er,ur+5,5)+1,lr=dr(er,ur+10,4)+4,ur+=14;for(var Ir=ur,Rr=1,Pr=0;Pr<38;Pr+=2)br.Q[Pr]=0,br.Q[Pr+1]=0;for(var Pr=0;Pr<lr;Pr++){var Fr=dr(er,ur+Pr*3,3);br.Q[(br.X[Pr]<<1)+1]=Fr,Fr>Rr&&(Rr=Fr)}ur+=3*lr,Ar(br.Q,Rr),yr(br.Q,Rr,br.u),pr=br.w,gr=br.d,ur=vr(br.u,(1<<Rr)-1,ar+or,er,ur,br.v);var Nr=_r.V(br.v,0,ar,br.C);cr=(1<<Nr)-1;var Ur=_r.V(br.v,ar,or,br.D);hr=(1<<Ur)-1,Ar(br.C,Nr),yr(br.C,Nr,pr),Ar(br.D,Ur),yr(br.D,Ur,gr)}for(;;){var Br=pr[wr(er,ur)&cr];ur+=Br&15;var Or=Br>>>4;if(!(Or>>>8))tr[fr++]=Or;else{if(Or==256)break;var Dr=fr+Or-254;if(Or>264){var Wr=br.q[Or-257];Dr=fr+(Wr>>>3)+dr(er,ur,Wr&7),ur+=Wr&7}var $r=gr[wr(er,ur)&hr];ur+=$r&15;var Yr=$r>>>4,Qi=br.c[Yr],rs=(Qi>>>4)+mr(er,ur,Qi&15);for(ur+=Qi&15;fr<Dr;)tr[fr]=tr[fr++-rs],tr[fr]=tr[fr++-rs],tr[fr]=tr[fr++-rs],tr[fr]=tr[fr++-rs];fr=Dr}}}return tr.length==fr?tr:tr.slice(0,fr)},ir.H.W=function(er,tr){var rr=er.length;if(tr<=rr)return er;var nr=new Uint8Array(rr<<1);return nr.set(er,0),nr},ir.H.R=function(er,tr,rr,nr,sr,ar){for(var or=ir.H.e,lr=ir.H.Z,cr=0;cr<rr;){var hr=er[lr(nr,sr)&tr];sr+=hr&15;var fr=hr>>>4;if(fr<=15)ar[cr]=fr,cr++;else{var ur=0,pr=0;fr==16?(pr=3+or(nr,sr,2),sr+=2,ur=ar[cr-1]):fr==17?(pr=3+or(nr,sr,3),sr+=3):fr==18&&(pr=11+or(nr,sr,7),sr+=7);for(var gr=cr+pr;cr<gr;)ar[cr]=ur,cr++}}return sr},ir.H.V=function(er,tr,rr,nr){for(var sr=0,ar=0,or=nr.length>>>1;ar<rr;){var lr=er[ar+tr];nr[ar<<1]=0,nr[(ar<<1)+1]=lr,lr>sr&&(sr=lr),ar++}for(;ar<or;)nr[ar<<1]=0,nr[(ar<<1)+1]=0,ar++;return sr},ir.H.n=function(er,tr){for(var rr=ir.H.m,nr=er.length,sr,ar,or,lr,cr,hr=rr.j,lr=0;lr<=tr;lr++)hr[lr]=0;for(lr=1;lr<nr;lr+=2)hr[er[lr]]++;var fr=rr.K;for(sr=0,hr[0]=0,ar=1;ar<=tr;ar++)sr=sr+hr[ar-1]<<1,fr[ar]=sr;for(or=0;or<nr;or+=2)cr=er[or+1],cr!=0&&(er[or]=fr[cr],fr[cr]++)},ir.H.A=function(er,tr,rr){for(var nr=er.length,sr=ir.H.m,ar=sr.r,or=0;or<nr;or+=2)if(er[or+1]!=0)for(var lr=or>>1,cr=er[or+1],hr=lr<<4|cr,fr=tr-cr,ur=er[or]<<fr,pr=ur+(1<<fr);ur!=pr;){var gr=ar[ur]>>>15-tr;rr[gr]=hr,ur++}},ir.H.l=function(er,tr){for(var rr=ir.H.m.r,nr=15-tr,sr=0;sr<er.length;sr+=2){var ar=er[sr]<<tr-er[sr+1];er[sr]=rr[ar]>>>nr}},ir.H.M=function(er,tr,rr){rr=rr<<(tr&7);var nr=tr>>>3;er[nr]|=rr,er[nr+1]|=rr>>>8},ir.H.I=function(er,tr,rr){rr=rr<<(tr&7);var nr=tr>>>3;er[nr]|=rr,er[nr+1]|=rr>>>8,er[nr+2]|=rr>>>16},ir.H.e=function(er,tr,rr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8)>>>(tr&7)&(1<<rr)-1},ir.H.b=function(er,tr,rr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16)>>>(tr&7)&(1<<rr)-1},ir.H.Z=function(er,tr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16)>>>(tr&7)},ir.H.i=function(er,tr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16|er[(tr>>>3)+3]<<24)>>>(tr&7)},ir.H.m=function(){var er=Uint16Array,tr=Uint32Array;return{K:new er(16),j:new er(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new er(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new tr(32),J:new er(512),_:[],h:new er(32),$:[],w:new er(32768),C:[],v:[],d:new er(32768),D:[],u:new er(512),Q:[],r:new er(32768),s:new tr(286),Y:new tr(30),a:new tr(19),t:new tr(15e3),k:new er(65536),g:new er(32768)}}(),function(){for(var er=ir.H.m,tr=32768,rr=0;rr<tr;rr++){var nr=rr;nr=(nr&2863311530)>>>1|(nr&1431655765)<<1,nr=(nr&3435973836)>>>2|(nr&858993459)<<2,nr=(nr&4042322160)>>>4|(nr&252645135)<<4,nr=(nr&4278255360)>>>8|(nr&16711935)<<8,er.r[rr]=(nr>>>16|nr<<16)>>>17}function sr(ar,or,lr){for(;or--!=0;)ar.push(0,lr)}for(var rr=0;rr<32;rr++)er.q[rr]=er.S[rr]<<3|er.T[rr],er.c[rr]=er.p[rr]<<4|er.z[rr];sr(er._,144,8),sr(er._,112,9),sr(er._,24,7),sr(er._,8,8),ir.H.n(er._,9),ir.H.A(er._,9,er.J),ir.H.l(er._,9),sr(er.$,32,5),ir.H.n(er.$,5),ir.H.A(er.$,5,er.h),ir.H.l(er.$,5),sr(er.Q,19,0),sr(er.C,286,0),sr(er.D,30,0),sr(er.v,320,0)}(),ir.H.N}();UTIF.LosslessJpegDecode=function(){var ir,er;function tr(){return ir[er++]}function rr(){return ir[er++]<<8|ir[er++]}function nr(mr){for(var dr=tr(),vr=[0,0,0,255],Ar=[],yr=8,wr=0;wr<16;wr++)Ar[wr]=tr();for(var wr=0;wr<16;wr++)for(var br=0;br<Ar[wr];br++){var Sr=sr(vr,0,wr+1,1);vr[Sr+3]=tr()}var xr=new Uint8Array(1<<yr);mr[dr]=[new Uint8Array(vr),xr];for(var wr=0;wr<1<<yr;wr++){for(var Cr=yr,Ir=wr,Rr=0,Pr=0;vr[Rr+3]==255&&Cr!=0;)Pr=Ir>>--Cr&1,Rr=vr[Rr+Pr];xr[wr]=Rr}}function sr(mr,dr,vr,Ar){if(mr[dr+3]!=255)return 0;if(vr==0)return dr;for(var yr=0;yr<2;yr++){mr[dr+yr]==0&&(mr[dr+yr]=mr.length,mr.push(0,0,Ar,255));var wr=sr(mr,mr[dr+yr],vr-1,Ar+1);if(wr!=0)return wr}return 0}function ar(mr){for(var dr=mr.b,vr=mr.f;dr<25&&mr.a<mr.d;){var Ar=mr.data[mr.a++];Ar==255&&!mr.c&&mr.a++,vr=vr<<8|Ar,dr+=8}if(dr<0)throw"e";mr.b=dr,mr.f=vr}function or(mr,dr){return dr.b<mr&&ar(dr),dr.f>>(dr.b-=mr)&65535>>16-mr}function lr(mr,dr){var vr=mr[0],Ar=0,yr=255,wr=0;dr.b<16&&ar(dr);var br=dr.f>>dr.b-8&255;for(Ar=mr[1][br],yr=vr[Ar+3],dr.b-=vr[Ar+2];yr==255;)wr=dr.f>>--dr.b&1,Ar=vr[Ar+wr],yr=vr[Ar+3];return yr}function cr(mr,dr){return mr<32768>>16-dr&&(mr+=-(1<<dr)+1),mr}function hr(mr,dr){var vr=lr(mr,dr);if(vr==0)return 0;if(vr==16)return-32768;var Ar=or(vr,dr);return cr(Ar,vr)}function fr(mr,dr,vr,Ar,yr,wr){for(var br=0,Sr=0;Sr<wr;Sr++){for(var xr=Sr*dr,Cr=0;Cr<dr;Cr+=yr){br++;for(var Ir=0;Ir<yr;Ir++)mr[xr+Cr+Ir]=hr(Ar[Ir],vr)}if(vr.e!=0&&br%vr.e==0&&Sr!=0){for(var Rr=vr.a,Pr=vr.data;Pr[Rr]!=255||!(208<=Pr[Rr+1]&&Pr[Rr+1]<=215);)Rr--;vr.a=Rr+2,vr.f=0,vr.b=0}}}function ur(mr,dr){return cr(or(mr,dr),mr)}function pr(mr,dr,vr,Ar,yr){for(var wr=ir.length-er,br=0;br<wr;br+=4){var Sr=ir[er+br];ir[er+br]=ir[er+br+3],ir[er+br+3]=Sr;var Sr=ir[er+br+1];ir[er+br+1]=ir[er+br+2],ir[er+br+2]=Sr}for(var xr=0;xr<yr;xr++)for(var Cr=32768,Ir=32768,Rr=0;Rr<dr;Rr+=2){var Pr=lr(Ar,vr),Fr=lr(Ar,vr);Pr!=0&&(Cr+=ur(Pr,vr)),Fr!=0&&(Ir+=ur(Fr,vr)),mr[xr*dr+Rr]=Cr&65535,mr[xr*dr+Rr+1]=Ir&65535}}function gr(mr){if(ir=mr,er=0,rr()!=65496)throw"e";for(var dr=[],vr=0,Ar=0,yr=0,wr=[],br=[],Sr=[],xr=0,Cr=0,Ir=0;;){var Rr=rr();if(Rr==65535){er--;continue}var Pr=rr();if(Rr==65475){Ar=tr(),Cr=rr(),Ir=rr(),xr=tr();for(var Fr=0;Fr<xr;Fr++){var Nr=tr(),Ur=tr(),Br=tr();if(Br!=0)throw"e";dr[Nr]=[Fr,Ur>>4,Ur&15]}}else if(Rr==65476)for(var Or=er+Pr-2;er<Or;)nr(br);else if(Rr==65498){er++;for(var Fr=0;Fr<xr;Fr++){var Dr=tr(),Wr=dr[Dr];Sr[Wr[0]]=br[tr()>>>4],wr[Wr[0]]=Wr.slice(1)}vr=tr(),er+=2;break}else Rr==65501?yr=rr():er+=Pr-2}var $r=Ar>8?Uint16Array:Uint8Array,Yr=new $r(Cr*Ir*xr),Qi={b:0,f:0,c:vr==8,a:er,data:ir,d:ir.length,e:yr};if(Qi.c)pr(Yr,Ir*xr,Qi,Sr[0],Cr);else{for(var rs=[],Kr=0,Qr=0,Fr=0;Fr<xr;Fr++){var Vr=wr[Fr],Gr=Vr[0],qr=Vr[1];Gr>Kr&&(Kr=Gr),qr>Qr&&(Qr=qr),rs.push(Gr*qr)}if(Kr!=1||Qr!=1){if(xr!=3||rs[1]!=1||rs[2]!=1||Kr!=2||Qr!=1&&Qr!=2)throw"e";for(var ji=[],Zr=0,Fr=0;Fr<xr;Fr++){for(var Zi=0;Zi<rs[Fr];Zi++)ji.push(Sr[Fr]);Zr+=rs[Fr]}var Yi=Ir/Kr,qi=Cr/Qr,Xr=Yi*qi;fr(Yr,Yi*Zr,Qi,ji,Zr,qi),_r(Yr,vr,Yi,qi,Zr-2,Zr,Zr,Ar);var ns=new Uint16Array(Xr*rs[0]);if(Kr==2&&Qr==2){for(var Fr=0;Fr<Xr;Fr++)ns[4*Fr]=Yr[6*Fr],ns[4*Fr+1]=Yr[6*Fr+1],ns[4*Fr+2]=Yr[6*Fr+2],ns[4*Fr+3]=Yr[6*Fr+3];_r(ns,vr,Yi*4,qi,0,1,1,Ar);for(var Fr=0;Fr<Xr;Fr++)Yr[6*Fr]=ns[4*Fr],Yr[6*Fr+1]=ns[4*Fr+1],Yr[6*Fr+2]=ns[4*Fr+2],Yr[6*Fr+3]=ns[4*Fr+3]}if(Kr==2&&Qr==1){for(var Fr=0;Fr<Xr;Fr++)ns[2*Fr]=Yr[4*Fr],ns[2*Fr+1]=Yr[4*Fr+1];_r(ns,vr,Yi*2,qi,0,1,1,Ar);for(var Fr=0;Fr<Xr;Fr++)Yr[4*Fr]=ns[2*Fr],Yr[4*Fr+1]=ns[2*Fr+1]}for(var os=Yr.slice(0),qr=0;qr<Cr;qr++)if(Qr==2)for(var Gr=0;Gr<Ir;Gr++){var us=(qr*Ir+Gr)*xr,is=((qr>>>1)*Yi+(Gr>>>1))*Zr,Ji=(qr&1)*2+(Gr&1);Yr[us]=os[is+Ji],Yr[us+1]=os[is+4],Yr[us+2]=os[is+5]}else for(var Gr=0;Gr<Ir;Gr++){var us=(qr*Ir+Gr)*xr,is=(qr*Yi+(Gr>>>1))*Zr,Ji=Gr&1;Yr[us]=os[is+Ji],Yr[us+1]=os[is+2],Yr[us+2]=os[is+3]}}else if(fr(Yr,Ir*xr,Qi,Sr,xr,Cr),yr==0)_r(Yr,vr,Ir,Cr,0,xr,xr,Ar);else for(var ms=Math.floor(yr/Ir),qr=0;qr<Cr;qr+=ms){var Ki=Yr.slice(qr*Ir*xr,(qr+ms)*Ir*xr);_r(Ki,vr,Ir,ms,0,xr,xr,Ar),Yr.set(Ki,qr*Ir*xr)}}return Yr}function _r(mr,dr,vr,Ar,yr,wr,br,Sr){for(var xr=vr*br,Cr=yr;Cr<wr;Cr++)mr[Cr]+=1<<Sr-1;for(var Ir=br;Ir<xr;Ir+=br)for(var Cr=yr;Cr<wr;Cr++)mr[Ir+Cr]+=mr[Ir+Cr-br];for(var Rr=1;Rr<Ar;Rr++){for(var Pr=Rr*xr,Cr=yr;Cr<wr;Cr++)mr[Pr+Cr]+=mr[Pr+Cr-xr];for(var Ir=br;Ir<xr;Ir+=br)for(var Cr=yr;Cr<wr;Cr++){var Fr=Pr+Ir+Cr,Nr=Fr-xr,Ur=mr[Fr-br],Br=0;if(dr==0)Br=0;else if(dr==1)Br=Ur;else if(dr==2)Br=mr[Nr];else if(dr==3)Br=mr[Nr-br];else if(dr==4)Br=Ur+(mr[Nr]-mr[Nr-br]);else if(dr==5)Br=Ur+(mr[Nr]-mr[Nr-br]>>>1);else if(dr==6)Br=mr[Nr]+(Ur-mr[Nr-br]>>>1);else if(dr==7)Br=Ur+mr[Nr]>>>1;else throw dr;mr[Fr]+=Br}}}return gr}();(function(){var ir=0,er=1,tr=2,rr=3,nr=4,sr=5,ar=6,or=7,lr=8,cr=9,hr=10,fr=11,ur=12,pr=13,gr=14,_r=15,mr=16,dr=17,vr=18;function Ar(Dr){var Wr=UTIF._binBE.readUshort,$r={b:Wr(Dr,0),i:Dr[2],C:Dr[3],u:Dr[4],q:Wr(Dr,5),k:Wr(Dr,7),e:Wr(Dr,9),l:Wr(Dr,11),s:Dr[13],d:Wr(Dr,14)};if($r.b!=18771||$r.i>1||$r.q<6||$r.q%6||$r.e<768||$r.e%24||$r.l!=768||$r.k<$r.l||$r.k%$r.l||$r.k-$r.e>=$r.l||$r.s>16||$r.s!=$r.k/$r.l||$r.s!=Math.ceil($r.e/$r.l)||$r.d!=$r.q/6||$r.u!=12&&$r.u!=14&&$r.u!=16||$r.C!=16&&$r.C!=0)throw"Invalid data";if($r.i==0)throw"Not implemented. We need this file!";return $r.h=$r.C==16,$r.m=($r.h?$r.l*2/3:$r.l>>>1)|0,$r.A=$r.m+2,$r.f=64,$r.g=(1<<$r.u)-1,$r.n=4*$r.u,$r}function yr(Dr,Wr){var $r=new Array(Wr.s),Yr=4*Wr.s,Qi=16+Yr;Yr&12&&(Qi+=16-(Yr&12));for(var rs=0,Kr=16;rs<Wr.s;Kr+=4){var Qr=UTIF._binBE.readUint(Dr,Kr);$r[rs]=Dr.slice(Qi,Qi+Qr),$r[rs].j=0,$r[rs].a=0,Qi+=Qr,rs++}if(Qi!=Dr.length)throw"Invalid data";return $r}function wr(Dr,Wr){for(var $r=-Wr[4],Yr=0;$r<=Wr[4];Yr++,$r++)Dr[Yr]=$r<=-Wr[3]?-4:$r<=-Wr[2]?-3:$r<=-Wr[1]?-2:$r<-Wr[0]?-1:$r<=Wr[0]?0:$r<Wr[1]?1:$r<Wr[2]?2:$r<Wr[3]?3:4}function br(Dr,Wr,$r){var Yr=[Wr,3*Wr+18,5*Wr+67,7*Wr+276,$r];Dr.o=Wr,Dr.w=(Yr[4]+2*Wr)/(2*Wr+1)+1|0,Dr.v=Math.ceil(Math.log2(Dr.w)),Dr.t=9,wr(Dr.c,Yr)}function Sr(Dr){var Wr={c:new Int8Array(2<<Dr.u)};return br(Wr,0,Dr.g),Wr}function xr(Dr){for(var Wr=[[],[],[]],$r=Math.max(2,Dr.w+32>>>6),Yr=0;Yr<3;Yr++)for(var Qi=0;Qi<41;Qi++)Wr[Yr][Qi]=[$r,1];return Wr}function Cr(Dr){for(var Wr=-1,$r=0;!$r;Wr++)$r=Dr[Dr.j]>>>7-Dr.a&1,Dr.a++,Dr.a&=7,Dr.a||Dr.j++;return Wr}function Ir(Dr,Wr){var $r=0,Yr=8-Dr.a,Qi=Dr.j,rs=Dr.a;if(Wr){if(Wr>=Yr)do $r<<=Yr,Wr-=Yr,$r|=Dr[Dr.j]&(1<<Yr)-1,Dr.j++,Yr=8;while(Wr>=8);Wr&&($r<<=Wr,Yr-=Wr,$r|=Dr[Dr.j]>>>Yr&(1<<Wr)-1),Dr.a=8-Yr}return $r}function Rr(Dr,Wr){var $r=0;if(Wr<Dr)for(;$r<=14&&Wr<<++$r<Dr;);return $r}function Pr(Dr,Wr,$r,Yr,Qi,rs,Kr,Qr){Qr==null&&(Qr=0);var Vr=rs+1,Gr=Vr%2,qr=0,ji=0,Zr=0,Zi,Yi,qi=Yr[Qi],Xr=Yr[Qi-1],ns=Yr[Qi-2][Vr],os=Xr[Vr-1],us=Xr[Vr],is=Xr[Vr+1],Ji=qi[Vr-1],ms=qi[Vr+1],Ki=Math.abs,Ni,Ri,Jr,Xi;if(Gr&&(Ni=Ki(is-us),Ri=Ki(ns-us),Jr=Ki(os-us)),Gr){if(Xi=Ni>Jr&&Ri<Ni?ns+os:Ni<Jr&&Ri<Jr?ns+is:is+os,Xi=Xi+2*us>>>2,Qr){qi[Vr]=Xi;return}Zi=Wr.t*Wr.c[Dr.g+us-ns]+Wr.c[Dr.g+os-us]}else Xi=us>os&&us>is||us<os&&us<is?ms+Ji+2*us>>>2:Ji+ms>>>1,Zi=Wr.t*Wr.c[Dr.g+us-os]+Wr.c[Dr.g+os-Ji];Yi=Ki(Zi);var ss=Cr($r);if(ss<Dr.n-Wr.v-1){var ls=Rr(Kr[Yi][0],Kr[Yi][1]);Zr=Ir($r,ls)+(ss<<ls)}else Zr=Ir($r,Wr.v)+1;Zr=Zr&1?-1-(Zr>>>1):Zr>>>1,Kr[Yi][0]+=Ki(Zr),Kr[Yi][1]==Dr.f&&(Kr[Yi][0]>>>=1,Kr[Yi][1]>>>=1),Kr[Yi][1]++,Xi=Zi<0?Xi-Zr:Xi+Zr,Dr.i&&(Xi<0?Xi+=Wr.w:Xi>Dr.g&&(Xi-=Wr.w)),qi[Vr]=Xi>=0?Math.min(Xi,Dr.g):0}function Fr(Dr,Wr,$r){for(var Yr=Dr[0].length,Qi=Wr;Qi<=$r;Qi++)Dr[Qi][0]=Dr[Qi-1][1],Dr[Qi][Yr-1]=Dr[Qi-1][Yr-2]}function Nr(Dr){Fr(Dr,or,ur),Fr(Dr,tr,nr),Fr(Dr,_r,dr)}function Ur(Dr,Wr,$r,Yr,Qi,rs,Kr,Qr,Vr,Gr,qr,ji,Zr){for(var Zi=0,Yi=1,qi=Qi<pr&&Qi>nr;Yi<Dr.m;)Zi<Dr.m&&(Pr(Dr,Wr,$r,Yr,Qi,Zi,Kr[Vr],Dr.h&&(qi&&Gr||!qi&&(qr||(Zi&ji)==Zr))),Pr(Dr,Wr,$r,Yr,rs,Zi,Kr[Vr],Dr.h&&(!qi&&Gr||qi&&(qr||(Zi&ji)==Zr))),Zi+=2),Zi>8&&(Pr(Dr,Wr,$r,Yr,Qi,Yi,Qr[Vr]),Pr(Dr,Wr,$r,Yr,rs,Yi,Qr[Vr]),Yi+=2);Nr(Yr)}function Br(Dr,Wr,$r,Yr,Qi,rs){Ur(Dr,Wr,$r,Yr,tr,or,Qi,rs,0,0,1,0,8),Ur(Dr,Wr,$r,Yr,lr,_r,Qi,rs,1,0,1,0,8),Ur(Dr,Wr,$r,Yr,rr,cr,Qi,rs,2,1,0,3,0),Ur(Dr,Wr,$r,Yr,hr,mr,Qi,rs,0,0,0,3,2),Ur(Dr,Wr,$r,Yr,nr,fr,Qi,rs,1,0,0,3,2),Ur(Dr,Wr,$r,Yr,ur,dr,Qi,rs,2,1,0,3,0)}function Or(Dr,Wr,$r,Yr,Qi,rs){var Kr=rs.length,Qr=Dr.l;Qi+1==Dr.s&&(Qr=Dr.e-Qi*Dr.l);for(var Vr=6*Dr.e*Yr+Qi*Dr.l,Gr=0;Gr<6;Gr++){for(var qr=0;qr<Qr;qr++){var ji=rs[Gr%Kr][qr%Kr],Zr;ji==0?Zr=tr+(Gr>>>1):ji==2?Zr=_r+(Gr>>>1):Zr=or+Gr;var Zi=Dr.h?(qr*2/3&2147483646|qr%3&1)+(qr%3>>>1):qr>>>1;Wr[Vr+qr]=$r[Zr][Zi+1]}Vr+=Dr.e}}UTIF._decompressRAF=function(Dr,Wr){var $r=Ar(Dr),Yr=yr(Dr,$r),Qi=Sr($r),rs=new Int16Array($r.e*$r.q);Wr==null&&(Wr=$r.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var Kr=[[ir,rr],[er,nr],[sr,fr],[ar,ur],[pr,mr],[gr,dr]],Qr=[],Vr=0;Vr<vr;Vr++)Qr[Vr]=new Uint16Array($r.A);for(var Gr=0;Gr<$r.s;Gr++){for(var qr=xr(Qi),ji=xr(Qi),Vr=0;Vr<vr;Vr++)for(var Zr=0;Zr<$r.A;Zr++)Qr[Vr][Zr]=0;for(var Zi=0;Zi<$r.d;Zi++){Br($r,Qi,Yr[Gr],Qr,qr,ji);for(var Vr=0;Vr<6;Vr++)for(var Zr=0;Zr<$r.A;Zr++)Qr[Kr[Vr][0]][Zr]=Qr[Kr[Vr][1]][Zr];Or($r,rs,Qr,Zi,Gr,Wr);for(var Vr=tr;Vr<vr;Vr++)if([sr,ar,pr,gr].indexOf(Vr)==-1)for(var Zr=0;Zr<$r.A;Zr++)Qr[Vr][Zr]=0;Nr(Qr)}}return rs}})();class TIFFLoader extends DataTextureLoader{constructor(er){super(er)}parse(er){const tr=UTIF.decode(er);UTIF.decodeImage(er,tr[0]);const rr=UTIF.toRGBA8(tr[0]);return{width:tr[0].width,height:tr[0].height,data:rr,flipY:!0,magFilter:LinearFilter,minFilter:LinearMipmapLinearFilter}}}/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var ir=function(){try{var tr={},rr=Object.defineProperty,nr=rr(tr,tr,tr)&&rr}catch{}return nr}(),er=function(tr){if(this==null)throw TypeError();var rr=String(this),nr=rr.length,sr=tr?Number(tr):0;if(sr!=sr&&(sr=0),!(sr<0||sr>=nr)){var ar=rr.charCodeAt(sr),or;return ar>=55296&&ar<=56319&&nr>sr+1&&(or=rr.charCodeAt(sr+1),or>=56320&&or<=57343)?(ar-55296)*1024+or-56320+65536:ar}};ir?ir(String.prototype,"codePointAt",{value:er,configurable:!0,writable:!0}):String.prototype.codePointAt=er}();var TINF_OK=0,TINF_DATA_ERROR=-3;function Tree(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Data(ir,er){this.source=ir,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=er,this.destLen=0,this.ltree=new Tree,this.dtree=new Tree}var sltree=new Tree,sdtree=new Tree,length_bits=new Uint8Array(30),length_base=new Uint16Array(30),dist_bits=new Uint8Array(30),dist_base=new Uint16Array(30),clcidx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),code_tree=new Tree,lengths=new Uint8Array(320);function tinf_build_bits_base(ir,er,tr,rr){var nr,sr;for(nr=0;nr<tr;++nr)ir[nr]=0;for(nr=0;nr<30-tr;++nr)ir[nr+tr]=nr/tr|0;for(sr=rr,nr=0;nr<30;++nr)er[nr]=sr,sr+=1<<ir[nr]}function tinf_build_fixed_trees(ir,er){var tr;for(tr=0;tr<7;++tr)ir.table[tr]=0;for(ir.table[7]=24,ir.table[8]=152,ir.table[9]=112,tr=0;tr<24;++tr)ir.trans[tr]=256+tr;for(tr=0;tr<144;++tr)ir.trans[24+tr]=tr;for(tr=0;tr<8;++tr)ir.trans[168+tr]=280+tr;for(tr=0;tr<112;++tr)ir.trans[176+tr]=144+tr;for(tr=0;tr<5;++tr)er.table[tr]=0;for(er.table[5]=32,tr=0;tr<32;++tr)er.trans[tr]=tr}var offs=new Uint16Array(16);function tinf_build_tree(ir,er,tr,rr){var nr,sr;for(nr=0;nr<16;++nr)ir.table[nr]=0;for(nr=0;nr<rr;++nr)ir.table[er[tr+nr]]++;for(ir.table[0]=0,sr=0,nr=0;nr<16;++nr)offs[nr]=sr,sr+=ir.table[nr];for(nr=0;nr<rr;++nr)er[tr+nr]&&(ir.trans[offs[er[tr+nr]]++]=nr)}function tinf_getbit(ir){ir.bitcount--||(ir.tag=ir.source[ir.sourceIndex++],ir.bitcount=7);var er=ir.tag&1;return ir.tag>>>=1,er}function tinf_read_bits(ir,er,tr){if(!er)return tr;for(;ir.bitcount<24;)ir.tag|=ir.source[ir.sourceIndex++]<<ir.bitcount,ir.bitcount+=8;var rr=ir.tag&65535>>>16-er;return ir.tag>>>=er,ir.bitcount-=er,rr+tr}function tinf_decode_symbol(ir,er){for(;ir.bitcount<24;)ir.tag|=ir.source[ir.sourceIndex++]<<ir.bitcount,ir.bitcount+=8;var tr=0,rr=0,nr=0,sr=ir.tag;do rr=2*rr+(sr&1),sr>>>=1,++nr,tr+=er.table[nr],rr-=er.table[nr];while(rr>=0);return ir.tag=sr,ir.bitcount-=nr,er.trans[tr+rr]}function tinf_decode_trees(ir,er,tr){var rr,nr,sr,ar,or,lr;for(rr=tinf_read_bits(ir,5,257),nr=tinf_read_bits(ir,5,1),sr=tinf_read_bits(ir,4,4),ar=0;ar<19;++ar)lengths[ar]=0;for(ar=0;ar<sr;++ar){var cr=tinf_read_bits(ir,3,0);lengths[clcidx[ar]]=cr}for(tinf_build_tree(code_tree,lengths,0,19),or=0;or<rr+nr;){var hr=tinf_decode_symbol(ir,code_tree);switch(hr){case 16:var fr=lengths[or-1];for(lr=tinf_read_bits(ir,2,3);lr;--lr)lengths[or++]=fr;break;case 17:for(lr=tinf_read_bits(ir,3,3);lr;--lr)lengths[or++]=0;break;case 18:for(lr=tinf_read_bits(ir,7,11);lr;--lr)lengths[or++]=0;break;default:lengths[or++]=hr;break}}tinf_build_tree(er,lengths,0,rr),tinf_build_tree(tr,lengths,rr,nr)}function tinf_inflate_block_data(ir,er,tr){for(;;){var rr=tinf_decode_symbol(ir,er);if(rr===256)return TINF_OK;if(rr<256)ir.dest[ir.destLen++]=rr;else{var nr,sr,ar,or;for(rr-=257,nr=tinf_read_bits(ir,length_bits[rr],length_base[rr]),sr=tinf_decode_symbol(ir,tr),ar=ir.destLen-tinf_read_bits(ir,dist_bits[sr],dist_base[sr]),or=ar;or<ar+nr;++or)ir.dest[ir.destLen++]=ir.dest[or]}}}function tinf_inflate_uncompressed_block(ir){for(var er,tr,rr;ir.bitcount>8;)ir.sourceIndex--,ir.bitcount-=8;if(er=ir.source[ir.sourceIndex+1],er=256*er+ir.source[ir.sourceIndex],tr=ir.source[ir.sourceIndex+3],tr=256*tr+ir.source[ir.sourceIndex+2],er!==(~tr&65535))return TINF_DATA_ERROR;for(ir.sourceIndex+=4,rr=er;rr;--rr)ir.dest[ir.destLen++]=ir.source[ir.sourceIndex++];return ir.bitcount=0,TINF_OK}function tinf_uncompress(ir,er){var tr=new Data(ir,er),rr,nr,sr;do{switch(rr=tinf_getbit(tr),nr=tinf_read_bits(tr,2,0),nr){case 0:sr=tinf_inflate_uncompressed_block(tr);break;case 1:sr=tinf_inflate_block_data(tr,sltree,sdtree);break;case 2:tinf_decode_trees(tr,tr.ltree,tr.dtree),sr=tinf_inflate_block_data(tr,tr.ltree,tr.dtree);break;default:sr=TINF_DATA_ERROR}if(sr!==TINF_OK)throw new Error("Data error")}while(!rr);return tr.destLen<tr.dest.length?typeof tr.dest.slice=="function"?tr.dest.slice(0,tr.destLen):tr.dest.subarray(0,tr.destLen):tr.dest}tinf_build_fixed_trees(sltree,sdtree);tinf_build_bits_base(length_bits,length_base,4,3);tinf_build_bits_base(dist_bits,dist_base,2,1);length_bits[28]=0;length_base[28]=258;var tinyInflate=tinf_uncompress;function derive(ir,er,tr,rr,nr){return Math.pow(1-nr,3)*ir+3*Math.pow(1-nr,2)*nr*er+3*(1-nr)*Math.pow(nr,2)*tr+Math.pow(nr,3)*rr}function BoundingBox(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}BoundingBox.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};BoundingBox.prototype.addPoint=function(ir,er){typeof ir=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=ir,this.x2=ir),ir<this.x1&&(this.x1=ir),ir>this.x2&&(this.x2=ir)),typeof er=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=er,this.y2=er),er<this.y1&&(this.y1=er),er>this.y2&&(this.y2=er))};BoundingBox.prototype.addX=function(ir){this.addPoint(ir,null)};BoundingBox.prototype.addY=function(ir){this.addPoint(null,ir)};BoundingBox.prototype.addBezier=function(ir,er,tr,rr,nr,sr,ar,or){var lr=[ir,er],cr=[tr,rr],hr=[nr,sr],fr=[ar,or];this.addPoint(ir,er),this.addPoint(ar,or);for(var ur=0;ur<=1;ur++){var pr=6*lr[ur]-12*cr[ur]+6*hr[ur],gr=-3*lr[ur]+9*cr[ur]-9*hr[ur]+3*fr[ur],_r=3*cr[ur]-3*lr[ur];if(gr===0){if(pr===0)continue;var mr=-_r/pr;0<mr&&mr<1&&(ur===0&&this.addX(derive(lr[ur],cr[ur],hr[ur],fr[ur],mr)),ur===1&&this.addY(derive(lr[ur],cr[ur],hr[ur],fr[ur],mr)));continue}var dr=Math.pow(pr,2)-4*_r*gr;if(!(dr<0)){var vr=(-pr+Math.sqrt(dr))/(2*gr);0<vr&&vr<1&&(ur===0&&this.addX(derive(lr[ur],cr[ur],hr[ur],fr[ur],vr)),ur===1&&this.addY(derive(lr[ur],cr[ur],hr[ur],fr[ur],vr)));var Ar=(-pr-Math.sqrt(dr))/(2*gr);0<Ar&&Ar<1&&(ur===0&&this.addX(derive(lr[ur],cr[ur],hr[ur],fr[ur],Ar)),ur===1&&this.addY(derive(lr[ur],cr[ur],hr[ur],fr[ur],Ar)))}}};BoundingBox.prototype.addQuad=function(ir,er,tr,rr,nr,sr){var ar=ir+.6666666666666666*(tr-ir),or=er+2/3*(rr-er),lr=ar+1/3*(nr-ir),cr=or+1/3*(sr-er);this.addBezier(ir,er,ar,or,lr,cr,nr,sr)};function Path(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Path.prototype.moveTo=function(ir,er){this.commands.push({type:"M",x:ir,y:er})};Path.prototype.lineTo=function(ir,er){this.commands.push({type:"L",x:ir,y:er})};Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(ir,er,tr,rr,nr,sr){this.commands.push({type:"C",x1:ir,y1:er,x2:tr,y2:rr,x:nr,y:sr})};Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(ir,er,tr,rr){this.commands.push({type:"Q",x1:ir,y1:er,x:tr,y:rr})};Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})};Path.prototype.extend=function(ir){if(ir.commands)ir=ir.commands;else if(ir instanceof BoundingBox){var er=ir;this.moveTo(er.x1,er.y1),this.lineTo(er.x2,er.y1),this.lineTo(er.x2,er.y2),this.lineTo(er.x1,er.y2),this.close();return}Array.prototype.push.apply(this.commands,ir)};Path.prototype.getBoundingBox=function(){for(var ir=new BoundingBox,er=0,tr=0,rr=0,nr=0,sr=0;sr<this.commands.length;sr++){var ar=this.commands[sr];switch(ar.type){case"M":ir.addPoint(ar.x,ar.y),er=rr=ar.x,tr=nr=ar.y;break;case"L":ir.addPoint(ar.x,ar.y),rr=ar.x,nr=ar.y;break;case"Q":ir.addQuad(rr,nr,ar.x1,ar.y1,ar.x,ar.y),rr=ar.x,nr=ar.y;break;case"C":ir.addBezier(rr,nr,ar.x1,ar.y1,ar.x2,ar.y2,ar.x,ar.y),rr=ar.x,nr=ar.y;break;case"Z":rr=er,nr=tr;break;default:throw new Error("Unexpected path command "+ar.type)}}return ir.isEmpty()&&ir.addPoint(0,0),ir};Path.prototype.draw=function(ir){ir.beginPath();for(var er=0;er<this.commands.length;er+=1){var tr=this.commands[er];tr.type==="M"?ir.moveTo(tr.x,tr.y):tr.type==="L"?ir.lineTo(tr.x,tr.y):tr.type==="C"?ir.bezierCurveTo(tr.x1,tr.y1,tr.x2,tr.y2,tr.x,tr.y):tr.type==="Q"?ir.quadraticCurveTo(tr.x1,tr.y1,tr.x,tr.y):tr.type==="Z"&&ir.closePath()}this.fill&&(ir.fillStyle=this.fill,ir.fill()),this.stroke&&(ir.strokeStyle=this.stroke,ir.lineWidth=this.strokeWidth,ir.stroke())};Path.prototype.toPathData=function(ir){ir=ir!==void 0?ir:2;function er(ar){return Math.round(ar)===ar?""+Math.round(ar):ar.toFixed(ir)}function tr(){for(var ar=arguments,or="",lr=0;lr<arguments.length;lr+=1){var cr=ar[lr];cr>=0&&lr>0&&(or+=" "),or+=er(cr)}return or}for(var rr="",nr=0;nr<this.commands.length;nr+=1){var sr=this.commands[nr];sr.type==="M"?rr+="M"+tr(sr.x,sr.y):sr.type==="L"?rr+="L"+tr(sr.x,sr.y):sr.type==="C"?rr+="C"+tr(sr.x1,sr.y1,sr.x2,sr.y2,sr.x,sr.y):sr.type==="Q"?rr+="Q"+tr(sr.x1,sr.y1,sr.x,sr.y):sr.type==="Z"&&(rr+="Z")}return rr};Path.prototype.toSVG=function(ir){var er='<path d="';return er+=this.toPathData(ir),er+='"',this.fill&&this.fill!=="black"&&(this.fill===null?er+=' fill="none"':er+=' fill="'+this.fill+'"'),this.stroke&&(er+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),er+="/>",er};Path.prototype.toDOMElement=function(ir){var er=this.toPathData(ir),tr=document.createElementNS("http://www.w3.org/2000/svg","path");return tr.setAttribute("d",er),tr};function fail(ir){throw new Error(ir)}function argument(ir,er){ir||fail(er)}var check={fail,argument,assert:argument},LIMIT16=32768,LIMIT32=2147483648,decode={},encode={},sizeOf={};function constant(ir){return function(){return ir}}encode.BYTE=function(ir){return check.argument(ir>=0&&ir<=255,"Byte value should be between 0 and 255."),[ir]};sizeOf.BYTE=constant(1);encode.CHAR=function(ir){return[ir.charCodeAt(0)]};sizeOf.CHAR=constant(1);encode.CHARARRAY=function(ir){typeof ir>"u"&&(ir="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var er=[],tr=0;tr<ir.length;tr+=1)er[tr]=ir.charCodeAt(tr);return er};sizeOf.CHARARRAY=function(ir){return typeof ir>"u"?0:ir.length};encode.USHORT=function(ir){return[ir>>8&255,ir&255]};sizeOf.USHORT=constant(2);encode.SHORT=function(ir){return ir>=LIMIT16&&(ir=-(2*LIMIT16-ir)),[ir>>8&255,ir&255]};sizeOf.SHORT=constant(2);encode.UINT24=function(ir){return[ir>>16&255,ir>>8&255,ir&255]};sizeOf.UINT24=constant(3);encode.ULONG=function(ir){return[ir>>24&255,ir>>16&255,ir>>8&255,ir&255]};sizeOf.ULONG=constant(4);encode.LONG=function(ir){return ir>=LIMIT32&&(ir=-(2*LIMIT32-ir)),[ir>>24&255,ir>>16&255,ir>>8&255,ir&255]};sizeOf.LONG=constant(4);encode.FIXED=encode.ULONG;sizeOf.FIXED=sizeOf.ULONG;encode.FWORD=encode.SHORT;sizeOf.FWORD=sizeOf.SHORT;encode.UFWORD=encode.USHORT;sizeOf.UFWORD=sizeOf.USHORT;encode.LONGDATETIME=function(ir){return[0,0,0,0,ir>>24&255,ir>>16&255,ir>>8&255,ir&255]};sizeOf.LONGDATETIME=constant(8);encode.TAG=function(ir){return check.argument(ir.length===4,"Tag should be exactly 4 ASCII characters."),[ir.charCodeAt(0),ir.charCodeAt(1),ir.charCodeAt(2),ir.charCodeAt(3)]};sizeOf.TAG=constant(4);encode.Card8=encode.BYTE;sizeOf.Card8=sizeOf.BYTE;encode.Card16=encode.USHORT;sizeOf.Card16=sizeOf.USHORT;encode.OffSize=encode.BYTE;sizeOf.OffSize=sizeOf.BYTE;encode.SID=encode.USHORT;sizeOf.SID=sizeOf.USHORT;encode.NUMBER=function(ir){return ir>=-107&&ir<=107?[ir+139]:ir>=108&&ir<=1131?(ir=ir-108,[(ir>>8)+247,ir&255]):ir>=-1131&&ir<=-108?(ir=-ir-108,[(ir>>8)+251,ir&255]):ir>=-32768&&ir<=32767?encode.NUMBER16(ir):encode.NUMBER32(ir)};sizeOf.NUMBER=function(ir){return encode.NUMBER(ir).length};encode.NUMBER16=function(ir){return[28,ir>>8&255,ir&255]};sizeOf.NUMBER16=constant(3);encode.NUMBER32=function(ir){return[29,ir>>24&255,ir>>16&255,ir>>8&255,ir&255]};sizeOf.NUMBER32=constant(5);encode.REAL=function(ir){var er=ir.toString(),tr=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(er);if(tr){var rr=parseFloat("1e"+((tr[2]?+tr[2]:0)+tr[1].length));er=(Math.round(ir*rr)/rr).toString()}for(var nr="",sr=0,ar=er.length;sr<ar;sr+=1){var or=er[sr];or==="e"?nr+=er[++sr]==="-"?"c":"b":or==="."?nr+="a":or==="-"?nr+="e":nr+=or}nr+=nr.length&1?"f":"ff";for(var lr=[30],cr=0,hr=nr.length;cr<hr;cr+=2)lr.push(parseInt(nr.substr(cr,2),16));return lr};sizeOf.REAL=function(ir){return encode.REAL(ir).length};encode.NAME=encode.CHARARRAY;sizeOf.NAME=sizeOf.CHARARRAY;encode.STRING=encode.CHARARRAY;sizeOf.STRING=sizeOf.CHARARRAY;decode.UTF8=function(ir,er,tr){for(var rr=[],nr=tr,sr=0;sr<nr;sr++,er+=1)rr[sr]=ir.getUint8(er);return String.fromCharCode.apply(null,rr)};decode.UTF16=function(ir,er,tr){for(var rr=[],nr=tr/2,sr=0;sr<nr;sr++,er+=2)rr[sr]=ir.getUint16(er);return String.fromCharCode.apply(null,rr)};encode.UTF16=function(ir){for(var er=[],tr=0;tr<ir.length;tr+=1){var rr=ir.charCodeAt(tr);er[er.length]=rr>>8&255,er[er.length]=rr&255}return er};sizeOf.UTF16=function(ir){return ir.length*2};var eightBitMacEncodings={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};decode.MACSTRING=function(ir,er,tr,rr){var nr=eightBitMacEncodings[rr];if(nr!==void 0){for(var sr="",ar=0;ar<tr;ar++){var or=ir.getUint8(er+ar);or<=127?sr+=String.fromCharCode(or):sr+=nr[or&127]}return sr}};var macEncodingTableCache=typeof WeakMap=="function"&&new WeakMap,macEncodingCacheKeys,getMacEncodingTable=function(ir){if(!macEncodingCacheKeys){macEncodingCacheKeys={};for(var er in eightBitMacEncodings)macEncodingCacheKeys[er]=new String(er)}var tr=macEncodingCacheKeys[ir];if(tr!==void 0){if(macEncodingTableCache){var rr=macEncodingTableCache.get(tr);if(rr!==void 0)return rr}var nr=eightBitMacEncodings[ir];if(nr!==void 0){for(var sr={},ar=0;ar<nr.length;ar++)sr[nr.charCodeAt(ar)]=ar+128;return macEncodingTableCache&&macEncodingTableCache.set(tr,sr),sr}}};encode.MACSTRING=function(ir,er){var tr=getMacEncodingTable(er);if(tr!==void 0){for(var rr=[],nr=0;nr<ir.length;nr++){var sr=ir.charCodeAt(nr);if(sr>=128&&(sr=tr[sr],sr===void 0))return;rr[nr]=sr}return rr}};sizeOf.MACSTRING=function(ir,er){var tr=encode.MACSTRING(ir,er);return tr!==void 0?tr.length:0};function isByteEncodable(ir){return ir>=-128&&ir<=127}function encodeVarDeltaRunAsZeroes(ir,er,tr){for(var rr=0,nr=ir.length;er<nr&&rr<64&&ir[er]===0;)++er,++rr;return tr.push(128|rr-1),er}function encodeVarDeltaRunAsBytes(ir,er,tr){for(var rr=0,nr=ir.length,sr=er;sr<nr&&rr<64;){var ar=ir[sr];if(!isByteEncodable(ar)||ar===0&&sr+1<nr&&ir[sr+1]===0)break;++sr,++rr}tr.push(rr-1);for(var or=er;or<sr;++or)tr.push(ir[or]+256&255);return sr}function encodeVarDeltaRunAsWords(ir,er,tr){for(var rr=0,nr=ir.length,sr=er;sr<nr&&rr<64;){var ar=ir[sr];if(ar===0||isByteEncodable(ar)&&sr+1<nr&&isByteEncodable(ir[sr+1]))break;++sr,++rr}tr.push(64|rr-1);for(var or=er;or<sr;++or){var lr=ir[or];tr.push(lr+65536>>8&255,lr+256&255)}return sr}encode.VARDELTAS=function(ir){for(var er=0,tr=[];er<ir.length;){var rr=ir[er];rr===0?er=encodeVarDeltaRunAsZeroes(ir,er,tr):rr>=-128&&rr<=127?er=encodeVarDeltaRunAsBytes(ir,er,tr):er=encodeVarDeltaRunAsWords(ir,er,tr)}return tr};encode.INDEX=function(ir){for(var er=1,tr=[er],rr=[],nr=0;nr<ir.length;nr+=1){var sr=encode.OBJECT(ir[nr]);Array.prototype.push.apply(rr,sr),er+=sr.length,tr.push(er)}if(rr.length===0)return[0,0];for(var ar=[],or=1+Math.floor(Math.log(er)/Math.log(2))/8|0,lr=[void 0,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][or],cr=0;cr<tr.length;cr+=1){var hr=lr(tr[cr]);Array.prototype.push.apply(ar,hr)}return Array.prototype.concat(encode.Card16(ir.length),encode.OffSize(or),ar,rr)};sizeOf.INDEX=function(ir){return encode.INDEX(ir).length};encode.DICT=function(ir){for(var er=[],tr=Object.keys(ir),rr=tr.length,nr=0;nr<rr;nr+=1){var sr=parseInt(tr[nr],0),ar=ir[sr];er=er.concat(encode.OPERAND(ar.value,ar.type)),er=er.concat(encode.OPERATOR(sr))}return er};sizeOf.DICT=function(ir){return encode.DICT(ir).length};encode.OPERATOR=function(ir){return ir<1200?[ir]:[12,ir-1200]};encode.OPERAND=function(ir,er){var tr=[];if(Array.isArray(er))for(var rr=0;rr<er.length;rr+=1)check.argument(ir.length===er.length,"Not enough arguments given for type"+er),tr=tr.concat(encode.OPERAND(ir[rr],er[rr]));else if(er==="SID")tr=tr.concat(encode.NUMBER(ir));else if(er==="offset")tr=tr.concat(encode.NUMBER32(ir));else if(er==="number")tr=tr.concat(encode.NUMBER(ir));else if(er==="real")tr=tr.concat(encode.REAL(ir));else throw new Error("Unknown operand type "+er);return tr};encode.OP=encode.BYTE;sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap=="function"&&new WeakMap;encode.CHARSTRING=function(ir){if(wmm){var er=wmm.get(ir);if(er!==void 0)return er}for(var tr=[],rr=ir.length,nr=0;nr<rr;nr+=1){var sr=ir[nr];tr=tr.concat(encode[sr.type](sr.value))}return wmm&&wmm.set(ir,tr),tr};sizeOf.CHARSTRING=function(ir){return encode.CHARSTRING(ir).length};encode.OBJECT=function(ir){var er=encode[ir.type];return check.argument(er!==void 0,"No encoding function for type "+ir.type),er(ir.value)};sizeOf.OBJECT=function(ir){var er=sizeOf[ir.type];return check.argument(er!==void 0,"No sizeOf function for type "+ir.type),er(ir.value)};encode.TABLE=function(ir){for(var er=[],tr=ir.fields.length,rr=[],nr=[],sr=0;sr<tr;sr+=1){var ar=ir.fields[sr],or=encode[ar.type];check.argument(or!==void 0,"No encoding function for field type "+ar.type+" ("+ar.name+")");var lr=ir[ar.name];lr===void 0&&(lr=ar.value);var cr=or(lr);ar.type==="TABLE"?(nr.push(er.length),er=er.concat([0,0]),rr.push(cr)):er=er.concat(cr)}for(var hr=0;hr<rr.length;hr+=1){var fr=nr[hr],ur=er.length;check.argument(ur<65536,"Table "+ir.tableName+" too big."),er[fr]=ur>>8,er[fr+1]=ur&255,er=er.concat(rr[hr])}return er};sizeOf.TABLE=function(ir){for(var er=0,tr=ir.fields.length,rr=0;rr<tr;rr+=1){var nr=ir.fields[rr],sr=sizeOf[nr.type];check.argument(sr!==void 0,"No sizeOf function for field type "+nr.type+" ("+nr.name+")");var ar=ir[nr.name];ar===void 0&&(ar=nr.value),er+=sr(ar),nr.type==="TABLE"&&(er+=2)}return er};encode.RECORD=encode.TABLE;sizeOf.RECORD=sizeOf.TABLE;encode.LITERAL=function(ir){return ir};sizeOf.LITERAL=function(ir){return ir.length};function Table(ir,er,tr){if(er.length&&(er[0].name!=="coverageFormat"||er[0].value===1))for(var rr=0;rr<er.length;rr+=1){var nr=er[rr];this[nr.name]=nr.value}if(this.tableName=ir,this.fields=er,tr)for(var sr=Object.keys(tr),ar=0;ar<sr.length;ar+=1){var or=sr[ar],lr=tr[or];this[or]!==void 0&&(this[or]=lr)}}Table.prototype.encode=function(){return encode.TABLE(this)};Table.prototype.sizeOf=function(){return sizeOf.TABLE(this)};function ushortList(ir,er,tr){tr===void 0&&(tr=er.length);var rr=new Array(er.length+1);rr[0]={name:ir+"Count",type:"USHORT",value:tr};for(var nr=0;nr<er.length;nr++)rr[nr+1]={name:ir+nr,type:"USHORT",value:er[nr]};return rr}function tableList(ir,er,tr){var rr=er.length,nr=new Array(rr+1);nr[0]={name:ir+"Count",type:"USHORT",value:rr};for(var sr=0;sr<rr;sr++)nr[sr+1]={name:ir+sr,type:"TABLE",value:tr(er[sr],sr)};return nr}function recordList(ir,er,tr){var rr=er.length,nr=[];nr[0]={name:ir+"Count",type:"USHORT",value:rr};for(var sr=0;sr<rr;sr++)nr=nr.concat(tr(er[sr],sr));return nr}function Coverage(ir){ir.format===1?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(ushortList("glyph",ir.glyphs))):ir.format===2?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(recordList("rangeRecord",ir.ranges,function(er){return[{name:"startGlyphID",type:"USHORT",value:er.start},{name:"endGlyphID",type:"USHORT",value:er.end},{name:"startCoverageIndex",type:"USHORT",value:er.index}]}))):check.assert(!1,"Coverage format must be 1 or 2.")}Coverage.prototype=Object.create(Table.prototype);Coverage.prototype.constructor=Coverage;function ScriptList(ir){Table.call(this,"scriptListTable",recordList("scriptRecord",ir,function(er,tr){var rr=er.script,nr=rr.defaultLangSys;return check.assert(!!nr,"Unable to write GSUB: script "+er.tag+" has no default language system."),[{name:"scriptTag"+tr,type:"TAG",value:er.tag},{name:"script"+tr,type:"TABLE",value:new Table("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Table("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:nr.reqFeatureIndex}].concat(ushortList("featureIndex",nr.featureIndexes)))}].concat(recordList("langSys",rr.langSysRecords,function(sr,ar){var or=sr.langSys;return[{name:"langSysTag"+ar,type:"TAG",value:sr.tag},{name:"langSys"+ar,type:"TABLE",value:new Table("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:or.reqFeatureIndex}].concat(ushortList("featureIndex",or.featureIndexes)))}]})))}]}))}ScriptList.prototype=Object.create(Table.prototype);ScriptList.prototype.constructor=ScriptList;function FeatureList(ir){Table.call(this,"featureListTable",recordList("featureRecord",ir,function(er,tr){var rr=er.feature;return[{name:"featureTag"+tr,type:"TAG",value:er.tag},{name:"feature"+tr,type:"TABLE",value:new Table("featureTable",[{name:"featureParams",type:"USHORT",value:rr.featureParams}].concat(ushortList("lookupListIndex",rr.lookupListIndexes)))}]}))}FeatureList.prototype=Object.create(Table.prototype);FeatureList.prototype.constructor=FeatureList;function LookupList(ir,er){Table.call(this,"lookupListTable",tableList("lookup",ir,function(tr){var rr=er[tr.lookupType];return check.assert(!!rr,"Unable to write GSUB lookup type "+tr.lookupType+" tables."),new Table("lookupTable",[{name:"lookupType",type:"USHORT",value:tr.lookupType},{name:"lookupFlag",type:"USHORT",value:tr.lookupFlag}].concat(tableList("subtable",tr.subtables,rr)))}))}LookupList.prototype=Object.create(Table.prototype);LookupList.prototype.constructor=LookupList;var table={Table,Record:Table,Coverage,ScriptList,FeatureList,LookupList,ushortList,tableList,recordList};function getByte(ir,er){return ir.getUint8(er)}function getUShort(ir,er){return ir.getUint16(er,!1)}function getShort(ir,er){return ir.getInt16(er,!1)}function getULong(ir,er){return ir.getUint32(er,!1)}function getFixed(ir,er){var tr=ir.getInt16(er,!1),rr=ir.getUint16(er+2,!1);return tr+rr/65535}function getTag(ir,er){for(var tr="",rr=er;rr<er+4;rr+=1)tr+=String.fromCharCode(ir.getInt8(rr));return tr}function getOffset(ir,er,tr){for(var rr=0,nr=0;nr<tr;nr+=1)rr<<=8,rr+=ir.getUint8(er+nr);return rr}function getBytes(ir,er,tr){for(var rr=[],nr=er;nr<tr;nr+=1)rr.push(ir.getUint8(nr));return rr}function bytesToString(ir){for(var er="",tr=0;tr<ir.length;tr+=1)er+=String.fromCharCode(ir[tr]);return er}var typeOffsets={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(ir,er){this.data=ir,this.offset=er,this.relativeOffset=0}Parser.prototype.parseByte=function(){var ir=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,ir};Parser.prototype.parseChar=function(){var ir=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,ir};Parser.prototype.parseCard8=Parser.prototype.parseByte;Parser.prototype.parseUShort=function(){var ir=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,ir};Parser.prototype.parseCard16=Parser.prototype.parseUShort;Parser.prototype.parseSID=Parser.prototype.parseUShort;Parser.prototype.parseOffset16=Parser.prototype.parseUShort;Parser.prototype.parseShort=function(){var ir=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,ir};Parser.prototype.parseF2Dot14=function(){var ir=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,ir};Parser.prototype.parseULong=function(){var ir=getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,ir};Parser.prototype.parseOffset32=Parser.prototype.parseULong;Parser.prototype.parseFixed=function(){var ir=getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,ir};Parser.prototype.parseString=function(ir){var er=this.data,tr=this.offset+this.relativeOffset,rr="";this.relativeOffset+=ir;for(var nr=0;nr<ir;nr++)rr+=String.fromCharCode(er.getUint8(tr+nr));return rr};Parser.prototype.parseTag=function(){return this.parseString(4)};Parser.prototype.parseLongDateTime=function(){var ir=getULong(this.data,this.offset+this.relativeOffset+4);return ir-=2082844800,this.relativeOffset+=8,ir};Parser.prototype.parseVersion=function(ir){var er=getUShort(this.data,this.offset+this.relativeOffset),tr=getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,ir===void 0&&(ir=4096),er+tr/ir/10};Parser.prototype.skip=function(ir,er){er===void 0&&(er=1),this.relativeOffset+=typeOffsets[ir]*er};Parser.prototype.parseULongList=function(ir){ir===void 0&&(ir=this.parseULong());for(var er=new Array(ir),tr=this.data,rr=this.offset+this.relativeOffset,nr=0;nr<ir;nr++)er[nr]=tr.getUint32(rr),rr+=4;return this.relativeOffset+=ir*4,er};Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(ir){ir===void 0&&(ir=this.parseUShort());for(var er=new Array(ir),tr=this.data,rr=this.offset+this.relativeOffset,nr=0;nr<ir;nr++)er[nr]=tr.getUint16(rr),rr+=2;return this.relativeOffset+=ir*2,er};Parser.prototype.parseShortList=function(ir){for(var er=new Array(ir),tr=this.data,rr=this.offset+this.relativeOffset,nr=0;nr<ir;nr++)er[nr]=tr.getInt16(rr),rr+=2;return this.relativeOffset+=ir*2,er};Parser.prototype.parseByteList=function(ir){for(var er=new Array(ir),tr=this.data,rr=this.offset+this.relativeOffset,nr=0;nr<ir;nr++)er[nr]=tr.getUint8(rr++);return this.relativeOffset+=ir,er};Parser.prototype.parseList=function(ir,er){er||(er=ir,ir=this.parseUShort());for(var tr=new Array(ir),rr=0;rr<ir;rr++)tr[rr]=er.call(this);return tr};Parser.prototype.parseList32=function(ir,er){er||(er=ir,ir=this.parseULong());for(var tr=new Array(ir),rr=0;rr<ir;rr++)tr[rr]=er.call(this);return tr};Parser.prototype.parseRecordList=function(ir,er){er||(er=ir,ir=this.parseUShort());for(var tr=new Array(ir),rr=Object.keys(er),nr=0;nr<ir;nr++){for(var sr={},ar=0;ar<rr.length;ar++){var or=rr[ar],lr=er[or];sr[or]=lr.call(this)}tr[nr]=sr}return tr};Parser.prototype.parseRecordList32=function(ir,er){er||(er=ir,ir=this.parseULong());for(var tr=new Array(ir),rr=Object.keys(er),nr=0;nr<ir;nr++){for(var sr={},ar=0;ar<rr.length;ar++){var or=rr[ar],lr=er[or];sr[or]=lr.call(this)}tr[nr]=sr}return tr};Parser.prototype.parseStruct=function(ir){if(typeof ir=="function")return ir.call(this);for(var er=Object.keys(ir),tr={},rr=0;rr<er.length;rr++){var nr=er[rr],sr=ir[nr];tr[nr]=sr.call(this)}return tr};Parser.prototype.parseValueRecord=function(ir){if(ir===void 0&&(ir=this.parseUShort()),ir!==0){var er={};return ir&1&&(er.xPlacement=this.parseShort()),ir&2&&(er.yPlacement=this.parseShort()),ir&4&&(er.xAdvance=this.parseShort()),ir&8&&(er.yAdvance=this.parseShort()),ir&16&&(er.xPlaDevice=void 0,this.parseShort()),ir&32&&(er.yPlaDevice=void 0,this.parseShort()),ir&64&&(er.xAdvDevice=void 0,this.parseShort()),ir&128&&(er.yAdvDevice=void 0,this.parseShort()),er}};Parser.prototype.parseValueRecordList=function(){for(var ir=this.parseUShort(),er=this.parseUShort(),tr=new Array(er),rr=0;rr<er;rr++)tr[rr]=this.parseValueRecord(ir);return tr};Parser.prototype.parsePointer=function(ir){var er=this.parseOffset16();if(er>0)return new Parser(this.data,this.offset+er).parseStruct(ir)};Parser.prototype.parsePointer32=function(ir){var er=this.parseOffset32();if(er>0)return new Parser(this.data,this.offset+er).parseStruct(ir)};Parser.prototype.parseListOfLists=function(ir){for(var er=this.parseOffset16List(),tr=er.length,rr=this.relativeOffset,nr=new Array(tr),sr=0;sr<tr;sr++){var ar=er[sr];if(ar===0){nr[sr]=void 0;continue}if(this.relativeOffset=ar,ir){for(var or=this.parseOffset16List(),lr=new Array(or.length),cr=0;cr<or.length;cr++)this.relativeOffset=ar+or[cr],lr[cr]=ir.call(this);nr[sr]=lr}else nr[sr]=this.parseUShortList()}return this.relativeOffset=rr,nr};Parser.prototype.parseCoverage=function(){var ir=this.offset+this.relativeOffset,er=this.parseUShort(),tr=this.parseUShort();if(er===1)return{format:1,glyphs:this.parseUShortList(tr)};if(er===2){for(var rr=new Array(tr),nr=0;nr<tr;nr++)rr[nr]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:rr}}throw new Error("0x"+ir.toString(16)+": Coverage format must be 1 or 2.")};Parser.prototype.parseClassDef=function(){var ir=this.offset+this.relativeOffset,er=this.parseUShort();if(er===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(er===2)return{format:2,ranges:this.parseRecordList({start:Parser.uShort,end:Parser.uShort,classId:Parser.uShort})};throw new Error("0x"+ir.toString(16)+": ClassDef format must be 1 or 2.")};Parser.list=function(ir,er){return function(){return this.parseList(ir,er)}};Parser.list32=function(ir,er){return function(){return this.parseList32(ir,er)}};Parser.recordList=function(ir,er){return function(){return this.parseRecordList(ir,er)}};Parser.recordList32=function(ir,er){return function(){return this.parseRecordList32(ir,er)}};Parser.pointer=function(ir){return function(){return this.parsePointer(ir)}};Parser.pointer32=function(ir){return function(){return this.parsePointer32(ir)}};Parser.tag=Parser.prototype.parseTag;Parser.byte=Parser.prototype.parseByte;Parser.uShort=Parser.offset16=Parser.prototype.parseUShort;Parser.uShortList=Parser.prototype.parseUShortList;Parser.uLong=Parser.offset32=Parser.prototype.parseULong;Parser.uLongList=Parser.prototype.parseULongList;Parser.struct=Parser.prototype.parseStruct;Parser.coverage=Parser.prototype.parseCoverage;Parser.classDef=Parser.prototype.parseClassDef;var langSysTable={reserved:Parser.uShort,reqFeatureIndex:Parser.uShort,featureIndexes:Parser.uShortList};Parser.prototype.parseScriptList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,script:Parser.pointer({defaultLangSys:Parser.pointer(langSysTable),langSysRecords:Parser.recordList({tag:Parser.tag,langSys:Parser.pointer(langSysTable)})})}))||[]};Parser.prototype.parseFeatureList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,feature:Parser.pointer({featureParams:Parser.offset16,lookupListIndexes:Parser.uShortList})}))||[]};Parser.prototype.parseLookupList=function(ir){return this.parsePointer(Parser.list(Parser.pointer(function(){var er=this.parseUShort();check.argument(1<=er&&er<=9,"GPOS/GSUB lookup type "+er+" unknown.");var tr=this.parseUShort(),rr=tr&16;return{lookupType:er,lookupFlag:tr,subtables:this.parseList(Parser.pointer(ir[er])),markFilteringSet:rr?this.parseUShort():void 0}})))||[]};Parser.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var ir=this.parseUShort(),er=this.parseUShort();check.argument(ir===1&&er<1,"GPOS/GSUB feature variations table unknown.");var tr=this.parseRecordList32({conditionSetOffset:Parser.offset32,featureTableSubstitutionOffset:Parser.offset32});return tr})||[]};var parse={getByte,getCard8:getByte,getUShort,getCard16:getUShort,getShort,getULong,getFixed,getTag,getOffset,getBytes,bytesToString,Parser};function parseCmapTableFormat12(ir,er){er.parseUShort(),ir.length=er.parseULong(),ir.language=er.parseULong();var tr;ir.groupCount=tr=er.parseULong(),ir.glyphIndexMap={};for(var rr=0;rr<tr;rr+=1)for(var nr=er.parseULong(),sr=er.parseULong(),ar=er.parseULong(),or=nr;or<=sr;or+=1)ir.glyphIndexMap[or]=ar,ar++}function parseCmapTableFormat4(ir,er,tr,rr,nr){ir.length=er.parseUShort(),ir.language=er.parseUShort();var sr;ir.segCount=sr=er.parseUShort()>>1,er.skip("uShort",3),ir.glyphIndexMap={};for(var ar=new parse.Parser(tr,rr+nr+14),or=new parse.Parser(tr,rr+nr+16+sr*2),lr=new parse.Parser(tr,rr+nr+16+sr*4),cr=new parse.Parser(tr,rr+nr+16+sr*6),hr=rr+nr+16+sr*8,fr=0;fr<sr-1;fr+=1)for(var ur=void 0,pr=ar.parseUShort(),gr=or.parseUShort(),_r=lr.parseShort(),mr=cr.parseUShort(),dr=gr;dr<=pr;dr+=1)mr!==0?(hr=cr.offset+cr.relativeOffset-2,hr+=mr,hr+=(dr-gr)*2,ur=parse.getUShort(tr,hr),ur!==0&&(ur=ur+_r&65535)):ur=dr+_r&65535,ir.glyphIndexMap[dr]=ur}function parseCmapTable(ir,er){var tr={};tr.version=parse.getUShort(ir,er),check.argument(tr.version===0,"cmap table version should be 0."),tr.numTables=parse.getUShort(ir,er+2);for(var rr=-1,nr=tr.numTables-1;nr>=0;nr-=1){var sr=parse.getUShort(ir,er+4+nr*8),ar=parse.getUShort(ir,er+4+nr*8+2);if(sr===3&&(ar===0||ar===1||ar===10)||sr===0&&(ar===0||ar===1||ar===2||ar===3||ar===4)){rr=parse.getULong(ir,er+4+nr*8+4);break}}if(rr===-1)throw new Error("No valid cmap sub-tables found.");var or=new parse.Parser(ir,er+rr);if(tr.format=or.parseUShort(),tr.format===12)parseCmapTableFormat12(tr,or);else if(tr.format===4)parseCmapTableFormat4(tr,or,ir,er,rr);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+tr.format+").");return tr}function addSegment(ir,er,tr){ir.segments.push({end:er,start:er,delta:-(er-tr),offset:0,glyphIndex:tr})}function addTerminatorSegment(ir){ir.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(ir){var er=!0,tr;for(tr=ir.length-1;tr>0;tr-=1){var rr=ir.get(tr);if(rr.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),er=!1;break}}var nr=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:er?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:er?12:20}];er||(nr=nr.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),nr=nr.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var sr=new table.Table("cmap",nr);for(sr.segments=[],tr=0;tr<ir.length;tr+=1){for(var ar=ir.get(tr),or=0;or<ar.unicodes.length;or+=1)addSegment(sr,ar.unicodes[or],tr);sr.segments=sr.segments.sort(function(vr,Ar){return vr.start-Ar.start})}addTerminatorSegment(sr);var lr=sr.segments.length,cr=0,hr=[],fr=[],ur=[],pr=[],gr=[],_r=[];for(tr=0;tr<lr;tr+=1){var mr=sr.segments[tr];mr.end<=65535&&mr.start<=65535?(hr=hr.concat({name:"end_"+tr,type:"USHORT",value:mr.end}),fr=fr.concat({name:"start_"+tr,type:"USHORT",value:mr.start}),ur=ur.concat({name:"idDelta_"+tr,type:"SHORT",value:mr.delta}),pr=pr.concat({name:"idRangeOffset_"+tr,type:"USHORT",value:mr.offset}),mr.glyphId!==void 0&&(gr=gr.concat({name:"glyph_"+tr,type:"USHORT",value:mr.glyphId}))):cr+=1,!er&&mr.glyphIndex!==void 0&&(_r=_r.concat({name:"cmap12Start_"+tr,type:"ULONG",value:mr.start}),_r=_r.concat({name:"cmap12End_"+tr,type:"ULONG",value:mr.end}),_r=_r.concat({name:"cmap12Glyph_"+tr,type:"ULONG",value:mr.glyphIndex}))}if(sr.segCountX2=(lr-cr)*2,sr.searchRange=Math.pow(2,Math.floor(Math.log(lr-cr)/Math.log(2)))*2,sr.entrySelector=Math.log(sr.searchRange/2)/Math.log(2),sr.rangeShift=sr.segCountX2-sr.searchRange,sr.fields=sr.fields.concat(hr),sr.fields.push({name:"reservedPad",type:"USHORT",value:0}),sr.fields=sr.fields.concat(fr),sr.fields=sr.fields.concat(ur),sr.fields=sr.fields.concat(pr),sr.fields=sr.fields.concat(gr),sr.cmap4Length=14+hr.length*2+2+fr.length*2+ur.length*2+pr.length*2+gr.length*2,!er){var dr=16+_r.length*4;sr.cmap12Offset=12+2*2+4+sr.cmap4Length,sr.fields=sr.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:dr},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:_r.length/3}]),sr.fields=sr.fields.concat(_r)}return sr}var cmap={parse:parseCmapTable,make:makeCmapTable},cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(ir){this.font=ir}DefaultEncoding.prototype.charToGlyphIndex=function(ir){var er=ir.codePointAt(0),tr=this.font.glyphs;if(tr){for(var rr=0;rr<tr.length;rr+=1)for(var nr=tr.get(rr),sr=0;sr<nr.unicodes.length;sr+=1)if(nr.unicodes[sr]===er)return rr}return null};function CmapEncoding(ir){this.cmap=ir}CmapEncoding.prototype.charToGlyphIndex=function(ir){return this.cmap.glyphIndexMap[ir.codePointAt(0)]||0};function CffEncoding(ir,er){this.encoding=ir,this.charset=er}CffEncoding.prototype.charToGlyphIndex=function(ir){var er=ir.codePointAt(0),tr=this.encoding[er];return this.charset.indexOf(tr)};function GlyphNames(ir){switch(ir.version){case 1:this.names=standardNames.slice();break;case 2:this.names=new Array(ir.numberOfGlyphs);for(var er=0;er<ir.numberOfGlyphs;er++)ir.glyphNameIndex[er]<standardNames.length?this.names[er]=standardNames[ir.glyphNameIndex[er]]:this.names[er]=ir.names[ir.glyphNameIndex[er]-standardNames.length];break;case 2.5:this.names=new Array(ir.numberOfGlyphs);for(var tr=0;tr<ir.numberOfGlyphs;tr++)this.names[tr]=standardNames[tr+ir.glyphNameIndex[tr]];break;case 3:this.names=[];break;default:this.names=[];break}}GlyphNames.prototype.nameToGlyphIndex=function(ir){return this.names.indexOf(ir)};GlyphNames.prototype.glyphIndexToName=function(ir){return this.names[ir]};function addGlyphNamesAll(ir){for(var er,tr=ir.tables.cmap.glyphIndexMap,rr=Object.keys(tr),nr=0;nr<rr.length;nr+=1){var sr=rr[nr],ar=tr[sr];er=ir.glyphs.get(ar),er.addUnicode(parseInt(sr))}for(var or=0;or<ir.glyphs.length;or+=1)er=ir.glyphs.get(or),ir.cffEncoding?ir.isCIDFont?er.name="gid"+or:er.name=ir.cffEncoding.charset[or]:ir.glyphNames.names&&(er.name=ir.glyphNames.glyphIndexToName(or))}function addGlyphNamesToUnicodeMap(ir){ir._IndexToUnicodeMap={};for(var er=ir.tables.cmap.glyphIndexMap,tr=Object.keys(er),rr=0;rr<tr.length;rr+=1){var nr=tr[rr],sr=er[nr];ir._IndexToUnicodeMap[sr]===void 0?ir._IndexToUnicodeMap[sr]={unicodes:[parseInt(nr)]}:ir._IndexToUnicodeMap[sr].unicodes.push(parseInt(nr))}}function addGlyphNames(ir,er){er.lowMemory?addGlyphNamesToUnicodeMap(ir):addGlyphNamesAll(ir)}function line(ir,er,tr,rr,nr){ir.beginPath(),ir.moveTo(er,tr),ir.lineTo(rr,nr),ir.stroke()}var draw={line};function getPathDefinition(ir,er){var tr=er||new Path;return{configurable:!0,get:function(){return typeof tr=="function"&&(tr=tr()),tr},set:function(rr){tr=rr}}}function Glyph(ir){this.bindConstructorValues(ir)}Glyph.prototype.bindConstructorValues=function(ir){this.index=ir.index||0,this.name=ir.name||null,this.unicode=ir.unicode||void 0,this.unicodes=ir.unicodes||ir.unicode!==void 0?[ir.unicode]:[],"xMin"in ir&&(this.xMin=ir.xMin),"yMin"in ir&&(this.yMin=ir.yMin),"xMax"in ir&&(this.xMax=ir.xMax),"yMax"in ir&&(this.yMax=ir.yMax),"advanceWidth"in ir&&(this.advanceWidth=ir.advanceWidth),Object.defineProperty(this,"path",getPathDefinition(this,ir.path))};Glyph.prototype.addUnicode=function(ir){this.unicodes.length===0&&(this.unicode=ir),this.unicodes.push(ir)};Glyph.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Glyph.prototype.getPath=function(ir,er,tr,rr,nr){ir=ir!==void 0?ir:0,er=er!==void 0?er:0,tr=tr!==void 0?tr:72;var sr,ar;rr||(rr={});var or=rr.xScale,lr=rr.yScale;if(rr.hinting&&nr&&nr.hinting&&(ar=this.path&&nr.hinting.exec(this,tr)),ar)sr=nr.hinting.getCommands(ar),ir=Math.round(ir),er=Math.round(er),or=lr=1;else{sr=this.path.commands;var cr=1/(this.path.unitsPerEm||1e3)*tr;or===void 0&&(or=cr),lr===void 0&&(lr=cr)}for(var hr=new Path,fr=0;fr<sr.length;fr+=1){var ur=sr[fr];ur.type==="M"?hr.moveTo(ir+ur.x*or,er+-ur.y*lr):ur.type==="L"?hr.lineTo(ir+ur.x*or,er+-ur.y*lr):ur.type==="Q"?hr.quadraticCurveTo(ir+ur.x1*or,er+-ur.y1*lr,ir+ur.x*or,er+-ur.y*lr):ur.type==="C"?hr.curveTo(ir+ur.x1*or,er+-ur.y1*lr,ir+ur.x2*or,er+-ur.y2*lr,ir+ur.x*or,er+-ur.y*lr):ur.type==="Z"&&hr.closePath()}return hr};Glyph.prototype.getContours=function(){if(this.points===void 0)return[];for(var ir=[],er=[],tr=0;tr<this.points.length;tr+=1){var rr=this.points[tr];er.push(rr),rr.lastPointOfContour&&(ir.push(er),er=[])}return check.argument(er.length===0,"There are still points left in the current contour."),ir};Glyph.prototype.getMetrics=function(){for(var ir=this.path.commands,er=[],tr=[],rr=0;rr<ir.length;rr+=1){var nr=ir[rr];nr.type!=="Z"&&(er.push(nr.x),tr.push(nr.y)),(nr.type==="Q"||nr.type==="C")&&(er.push(nr.x1),tr.push(nr.y1)),nr.type==="C"&&(er.push(nr.x2),tr.push(nr.y2))}var sr={xMin:Math.min.apply(null,er),yMin:Math.min.apply(null,tr),xMax:Math.max.apply(null,er),yMax:Math.max.apply(null,tr),leftSideBearing:this.leftSideBearing};return isFinite(sr.xMin)||(sr.xMin=0),isFinite(sr.xMax)||(sr.xMax=this.advanceWidth),isFinite(sr.yMin)||(sr.yMin=0),isFinite(sr.yMax)||(sr.yMax=0),sr.rightSideBearing=this.advanceWidth-sr.leftSideBearing-(sr.xMax-sr.xMin),sr};Glyph.prototype.draw=function(ir,er,tr,rr,nr){this.getPath(er,tr,rr,nr).draw(ir)};Glyph.prototype.drawPoints=function(ir,er,tr,rr){function nr(fr,ur,pr,gr){ir.beginPath();for(var _r=0;_r<fr.length;_r+=1)ir.moveTo(ur+fr[_r].x*gr,pr+fr[_r].y*gr),ir.arc(ur+fr[_r].x*gr,pr+fr[_r].y*gr,2,0,Math.PI*2,!1);ir.closePath(),ir.fill()}er=er!==void 0?er:0,tr=tr!==void 0?tr:0,rr=rr!==void 0?rr:24;for(var sr=1/this.path.unitsPerEm*rr,ar=[],or=[],lr=this.path,cr=0;cr<lr.commands.length;cr+=1){var hr=lr.commands[cr];hr.x!==void 0&&ar.push({x:hr.x,y:-hr.y}),hr.x1!==void 0&&or.push({x:hr.x1,y:-hr.y1}),hr.x2!==void 0&&or.push({x:hr.x2,y:-hr.y2})}ir.fillStyle="blue",nr(ar,er,tr,sr),ir.fillStyle="red",nr(or,er,tr,sr)};Glyph.prototype.drawMetrics=function(ir,er,tr,rr){var nr;er=er!==void 0?er:0,tr=tr!==void 0?tr:0,rr=rr!==void 0?rr:24,nr=1/this.path.unitsPerEm*rr,ir.lineWidth=1,ir.strokeStyle="black",draw.line(ir,er,-1e4,er,1e4),draw.line(ir,-1e4,tr,1e4,tr);var sr=this.xMin||0,ar=this.yMin||0,or=this.xMax||0,lr=this.yMax||0,cr=this.advanceWidth||0;ir.strokeStyle="blue",draw.line(ir,er+sr*nr,-1e4,er+sr*nr,1e4),draw.line(ir,er+or*nr,-1e4,er+or*nr,1e4),draw.line(ir,-1e4,tr+-ar*nr,1e4,tr+-ar*nr),draw.line(ir,-1e4,tr+-lr*nr,1e4,tr+-lr*nr),ir.strokeStyle="green",draw.line(ir,er+cr*nr,-1e4,er+cr*nr,1e4)};function defineDependentProperty(ir,er,tr){Object.defineProperty(ir,er,{get:function(){return ir.path,ir[tr]},set:function(rr){ir[tr]=rr},enumerable:!0,configurable:!0})}function GlyphSet(ir,er){if(this.font=ir,this.glyphs={},Array.isArray(er))for(var tr=0;tr<er.length;tr++){var rr=er[tr];rr.path.unitsPerEm=ir.unitsPerEm,this.glyphs[tr]=rr}this.length=er&&er.length||0}GlyphSet.prototype.get=function(ir){if(this.glyphs[ir]===void 0){this.font._push(ir),typeof this.glyphs[ir]=="function"&&(this.glyphs[ir]=this.glyphs[ir]());var er=this.glyphs[ir],tr=this.font._IndexToUnicodeMap[ir];if(tr)for(var rr=0;rr<tr.unicodes.length;rr++)er.addUnicode(tr.unicodes[rr]);this.font.cffEncoding?this.font.isCIDFont?er.name="gid"+ir:er.name=this.font.cffEncoding.charset[ir]:this.font.glyphNames.names&&(er.name=this.font.glyphNames.glyphIndexToName(ir)),this.glyphs[ir].advanceWidth=this.font._hmtxTableData[ir].advanceWidth,this.glyphs[ir].leftSideBearing=this.font._hmtxTableData[ir].leftSideBearing}else typeof this.glyphs[ir]=="function"&&(this.glyphs[ir]=this.glyphs[ir]());return this.glyphs[ir]};GlyphSet.prototype.push=function(ir,er){this.glyphs[ir]=er,this.length++};function glyphLoader(ir,er){return new Glyph({index:er,font:ir})}function ttfGlyphLoader(ir,er,tr,rr,nr,sr){return function(){var ar=new Glyph({index:er,font:ir});return ar.path=function(){tr(ar,rr,nr);var or=sr(ir.glyphs,ar);return or.unitsPerEm=ir.unitsPerEm,or},defineDependentProperty(ar,"xMin","_xMin"),defineDependentProperty(ar,"xMax","_xMax"),defineDependentProperty(ar,"yMin","_yMin"),defineDependentProperty(ar,"yMax","_yMax"),ar}}function cffGlyphLoader(ir,er,tr,rr){return function(){var nr=new Glyph({index:er,font:ir});return nr.path=function(){var sr=tr(ir,nr,rr);return sr.unitsPerEm=ir.unitsPerEm,sr},nr}}var glyphset={GlyphSet,glyphLoader,ttfGlyphLoader,cffGlyphLoader};function equals(ir,er){if(ir===er)return!0;if(Array.isArray(ir)&&Array.isArray(er)){if(ir.length!==er.length)return!1;for(var tr=0;tr<ir.length;tr+=1)if(!equals(ir[tr],er[tr]))return!1;return!0}else return!1}function calcCFFSubroutineBias(ir){var er;return ir.length<1240?er=107:ir.length<33900?er=1131:er=32768,er}function parseCFFIndex(ir,er,tr){var rr=[],nr=[],sr=parse.getCard16(ir,er),ar,or;if(sr!==0){var lr=parse.getByte(ir,er+2);ar=er+(sr+1)*lr+2;for(var cr=er+3,hr=0;hr<sr+1;hr+=1)rr.push(parse.getOffset(ir,cr,lr)),cr+=lr;or=ar+rr[sr]}else or=er+2;for(var fr=0;fr<rr.length-1;fr+=1){var ur=parse.getBytes(ir,ar+rr[fr],ar+rr[fr+1]);tr&&(ur=tr(ur)),nr.push(ur)}return{objects:nr,startOffset:er,endOffset:or}}function parseCFFIndexLowMemory(ir,er){var tr=[],rr=parse.getCard16(ir,er),nr,sr;if(rr!==0){var ar=parse.getByte(ir,er+2);nr=er+(rr+1)*ar+2;for(var or=er+3,lr=0;lr<rr+1;lr+=1)tr.push(parse.getOffset(ir,or,ar)),or+=ar;sr=nr+tr[rr]}else sr=er+2;return{offsets:tr,startOffset:er,endOffset:sr}}function getCffIndexObject(ir,er,tr,rr,nr){var sr=parse.getCard16(tr,rr),ar=0;if(sr!==0){var or=parse.getByte(tr,rr+2);ar=rr+(sr+1)*or+2}var lr=parse.getBytes(tr,ar+er[ir],ar+er[ir+1]);return nr&&(lr=nr(lr)),lr}function parseFloatOperand(ir){for(var er="",tr=15,rr=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var nr=ir.parseByte(),sr=nr>>4,ar=nr&15;if(sr===tr||(er+=rr[sr],ar===tr))break;er+=rr[ar]}return parseFloat(er)}function parseOperand(ir,er){var tr,rr,nr,sr;if(er===28)return tr=ir.parseByte(),rr=ir.parseByte(),tr<<8|rr;if(er===29)return tr=ir.parseByte(),rr=ir.parseByte(),nr=ir.parseByte(),sr=ir.parseByte(),tr<<24|rr<<16|nr<<8|sr;if(er===30)return parseFloatOperand(ir);if(er>=32&&er<=246)return er-139;if(er>=247&&er<=250)return tr=ir.parseByte(),(er-247)*256+tr+108;if(er>=251&&er<=254)return tr=ir.parseByte(),-(er-251)*256-tr-108;throw new Error("Invalid b0 "+er)}function entriesToObject(ir){for(var er={},tr=0;tr<ir.length;tr+=1){var rr=ir[tr][0],nr=ir[tr][1],sr=void 0;if(nr.length===1?sr=nr[0]:sr=nr,er.hasOwnProperty(rr)&&!isNaN(er[rr]))throw new Error("Object "+er+" already has key "+rr);er[rr]=sr}return er}function parseCFFDict(ir,er,tr){er=er!==void 0?er:0;var rr=new parse.Parser(ir,er),nr=[],sr=[];for(tr=tr!==void 0?tr:ir.length;rr.relativeOffset<tr;){var ar=rr.parseByte();ar<=21?(ar===12&&(ar=1200+rr.parseByte()),nr.push([ar,sr]),sr=[]):sr.push(parseOperand(rr,ar))}return entriesToObject(nr)}function getCFFString(ir,er){return er<=390?er=cffStandardStrings[er]:er=ir[er-391],er}function interpretDict(ir,er,tr){for(var rr={},nr,sr=0;sr<er.length;sr+=1){var ar=er[sr];if(Array.isArray(ar.type)){var or=[];or.length=ar.type.length;for(var lr=0;lr<ar.type.length;lr++)nr=ir[ar.op]!==void 0?ir[ar.op][lr]:void 0,nr===void 0&&(nr=ar.value!==void 0&&ar.value[lr]!==void 0?ar.value[lr]:null),ar.type[lr]==="SID"&&(nr=getCFFString(tr,nr)),or[lr]=nr;rr[ar.name]=or}else nr=ir[ar.op],nr===void 0&&(nr=ar.value!==void 0?ar.value:null),ar.type==="SID"&&(nr=getCFFString(tr,nr)),rr[ar.name]=nr}return rr}function parseCFFHeader(ir,er){var tr={};return tr.formatMajor=parse.getCard8(ir,er),tr.formatMinor=parse.getCard8(ir,er+1),tr.size=parse.getCard8(ir,er+2),tr.offsetSize=parse.getCard8(ir,er+3),tr.startOffset=er,tr.endOffset=er+4,tr}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(ir,er){var tr=parseCFFDict(ir,0,ir.byteLength);return interpretDict(tr,TOP_DICT_META,er)}function parseCFFPrivateDict(ir,er,tr,rr){var nr=parseCFFDict(ir,er,tr);return interpretDict(nr,PRIVATE_DICT_META,rr)}function gatherCFFTopDicts(ir,er,tr,rr){for(var nr=[],sr=0;sr<tr.length;sr+=1){var ar=new DataView(new Uint8Array(tr[sr]).buffer),or=parseCFFTopDict(ar,rr);or._subrs=[],or._subrsBias=0,or._defaultWidthX=0,or._nominalWidthX=0;var lr=or.private[0],cr=or.private[1];if(lr!==0&&cr!==0){var hr=parseCFFPrivateDict(ir,cr+er,lr,rr);if(or._defaultWidthX=hr.defaultWidthX,or._nominalWidthX=hr.nominalWidthX,hr.subrs!==0){var fr=cr+hr.subrs,ur=parseCFFIndex(ir,fr+er);or._subrs=ur.objects,or._subrsBias=calcCFFSubroutineBias(or._subrs)}or._privateDict=hr}nr.push(or)}return nr}function parseCFFCharset(ir,er,tr,rr){var nr,sr,ar=new parse.Parser(ir,er);tr-=1;var or=[".notdef"],lr=ar.parseCard8();if(lr===0)for(var cr=0;cr<tr;cr+=1)nr=ar.parseSID(),or.push(getCFFString(rr,nr));else if(lr===1)for(;or.length<=tr;){nr=ar.parseSID(),sr=ar.parseCard8();for(var hr=0;hr<=sr;hr+=1)or.push(getCFFString(rr,nr)),nr+=1}else if(lr===2)for(;or.length<=tr;){nr=ar.parseSID(),sr=ar.parseCard16();for(var fr=0;fr<=sr;fr+=1)or.push(getCFFString(rr,nr)),nr+=1}else throw new Error("Unknown charset format "+lr);return or}function parseCFFEncoding(ir,er,tr){var rr,nr={},sr=new parse.Parser(ir,er),ar=sr.parseCard8();if(ar===0)for(var or=sr.parseCard8(),lr=0;lr<or;lr+=1)rr=sr.parseCard8(),nr[rr]=lr;else if(ar===1){var cr=sr.parseCard8();rr=1;for(var hr=0;hr<cr;hr+=1)for(var fr=sr.parseCard8(),ur=sr.parseCard8(),pr=fr;pr<=fr+ur;pr+=1)nr[pr]=rr,rr+=1}else throw new Error("Unknown encoding format "+ar);return new CffEncoding(nr,tr)}function parseCFFCharstring(ir,er,tr){var rr,nr,sr,ar,or=new Path,lr=[],cr=0,hr=!1,fr=!1,ur=0,pr=0,gr,_r,mr,dr;if(ir.isCIDFont){var vr=ir.tables.cff.topDict._fdSelect[er.index],Ar=ir.tables.cff.topDict._fdArray[vr];gr=Ar._subrs,_r=Ar._subrsBias,mr=Ar._defaultWidthX,dr=Ar._nominalWidthX}else gr=ir.tables.cff.topDict._subrs,_r=ir.tables.cff.topDict._subrsBias,mr=ir.tables.cff.topDict._defaultWidthX,dr=ir.tables.cff.topDict._nominalWidthX;var yr=mr;function wr(xr,Cr){fr&&or.closePath(),or.moveTo(xr,Cr),fr=!0}function br(){var xr;xr=lr.length%2!==0,xr&&!hr&&(yr=lr.shift()+dr),cr+=lr.length>>1,lr.length=0,hr=!0}function Sr(xr){for(var Cr,Ir,Rr,Pr,Fr,Nr,Ur,Br,Or,Dr,Wr,$r,Yr=0;Yr<xr.length;){var Qi=xr[Yr];switch(Yr+=1,Qi){case 1:br();break;case 3:br();break;case 4:lr.length>1&&!hr&&(yr=lr.shift()+dr,hr=!0),pr+=lr.pop(),wr(ur,pr);break;case 5:for(;lr.length>0;)ur+=lr.shift(),pr+=lr.shift(),or.lineTo(ur,pr);break;case 6:for(;lr.length>0&&(ur+=lr.shift(),or.lineTo(ur,pr),lr.length!==0);)pr+=lr.shift(),or.lineTo(ur,pr);break;case 7:for(;lr.length>0&&(pr+=lr.shift(),or.lineTo(ur,pr),lr.length!==0);)ur+=lr.shift(),or.lineTo(ur,pr);break;case 8:for(;lr.length>0;)rr=ur+lr.shift(),nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),ur=sr+lr.shift(),pr=ar+lr.shift(),or.curveTo(rr,nr,sr,ar,ur,pr);break;case 10:Fr=lr.pop()+_r,Nr=gr[Fr],Nr&&Sr(Nr);break;case 11:return;case 12:switch(Qi=xr[Yr],Yr+=1,Qi){case 35:rr=ur+lr.shift(),nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),Ur=sr+lr.shift(),Br=ar+lr.shift(),Or=Ur+lr.shift(),Dr=Br+lr.shift(),Wr=Or+lr.shift(),$r=Dr+lr.shift(),ur=Wr+lr.shift(),pr=$r+lr.shift(),lr.shift(),or.curveTo(rr,nr,sr,ar,Ur,Br),or.curveTo(Or,Dr,Wr,$r,ur,pr);break;case 34:rr=ur+lr.shift(),nr=pr,sr=rr+lr.shift(),ar=nr+lr.shift(),Ur=sr+lr.shift(),Br=ar,Or=Ur+lr.shift(),Dr=ar,Wr=Or+lr.shift(),$r=pr,ur=Wr+lr.shift(),or.curveTo(rr,nr,sr,ar,Ur,Br),or.curveTo(Or,Dr,Wr,$r,ur,pr);break;case 36:rr=ur+lr.shift(),nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),Ur=sr+lr.shift(),Br=ar,Or=Ur+lr.shift(),Dr=ar,Wr=Or+lr.shift(),$r=Dr+lr.shift(),ur=Wr+lr.shift(),or.curveTo(rr,nr,sr,ar,Ur,Br),or.curveTo(Or,Dr,Wr,$r,ur,pr);break;case 37:rr=ur+lr.shift(),nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),Ur=sr+lr.shift(),Br=ar+lr.shift(),Or=Ur+lr.shift(),Dr=Br+lr.shift(),Wr=Or+lr.shift(),$r=Dr+lr.shift(),Math.abs(Wr-ur)>Math.abs($r-pr)?ur=Wr+lr.shift():pr=$r+lr.shift(),or.curveTo(rr,nr,sr,ar,Ur,Br),or.curveTo(Or,Dr,Wr,$r,ur,pr);break;default:console.log("Glyph "+er.index+": unknown operator 1200"+Qi),lr.length=0}break;case 14:lr.length>0&&!hr&&(yr=lr.shift()+dr,hr=!0),fr&&(or.closePath(),fr=!1);break;case 18:br();break;case 19:case 20:br(),Yr+=cr+7>>3;break;case 21:lr.length>2&&!hr&&(yr=lr.shift()+dr,hr=!0),pr+=lr.pop(),ur+=lr.pop(),wr(ur,pr);break;case 22:lr.length>1&&!hr&&(yr=lr.shift()+dr,hr=!0),ur+=lr.pop(),wr(ur,pr);break;case 23:br();break;case 24:for(;lr.length>2;)rr=ur+lr.shift(),nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),ur=sr+lr.shift(),pr=ar+lr.shift(),or.curveTo(rr,nr,sr,ar,ur,pr);ur+=lr.shift(),pr+=lr.shift(),or.lineTo(ur,pr);break;case 25:for(;lr.length>6;)ur+=lr.shift(),pr+=lr.shift(),or.lineTo(ur,pr);rr=ur+lr.shift(),nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),ur=sr+lr.shift(),pr=ar+lr.shift(),or.curveTo(rr,nr,sr,ar,ur,pr);break;case 26:for(lr.length%2&&(ur+=lr.shift());lr.length>0;)rr=ur,nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),ur=sr,pr=ar+lr.shift(),or.curveTo(rr,nr,sr,ar,ur,pr);break;case 27:for(lr.length%2&&(pr+=lr.shift());lr.length>0;)rr=ur+lr.shift(),nr=pr,sr=rr+lr.shift(),ar=nr+lr.shift(),ur=sr+lr.shift(),pr=ar,or.curveTo(rr,nr,sr,ar,ur,pr);break;case 28:Cr=xr[Yr],Ir=xr[Yr+1],lr.push((Cr<<24|Ir<<16)>>16),Yr+=2;break;case 29:Fr=lr.pop()+ir.gsubrsBias,Nr=ir.gsubrs[Fr],Nr&&Sr(Nr);break;case 30:for(;lr.length>0&&(rr=ur,nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),ur=sr+lr.shift(),pr=ar+(lr.length===1?lr.shift():0),or.curveTo(rr,nr,sr,ar,ur,pr),lr.length!==0);)rr=ur+lr.shift(),nr=pr,sr=rr+lr.shift(),ar=nr+lr.shift(),pr=ar+lr.shift(),ur=sr+(lr.length===1?lr.shift():0),or.curveTo(rr,nr,sr,ar,ur,pr);break;case 31:for(;lr.length>0&&(rr=ur+lr.shift(),nr=pr,sr=rr+lr.shift(),ar=nr+lr.shift(),pr=ar+lr.shift(),ur=sr+(lr.length===1?lr.shift():0),or.curveTo(rr,nr,sr,ar,ur,pr),lr.length!==0);)rr=ur,nr=pr+lr.shift(),sr=rr+lr.shift(),ar=nr+lr.shift(),ur=sr+lr.shift(),pr=ar+(lr.length===1?lr.shift():0),or.curveTo(rr,nr,sr,ar,ur,pr);break;default:Qi<32?console.log("Glyph "+er.index+": unknown operator "+Qi):Qi<247?lr.push(Qi-139):Qi<251?(Cr=xr[Yr],Yr+=1,lr.push((Qi-247)*256+Cr+108)):Qi<255?(Cr=xr[Yr],Yr+=1,lr.push(-(Qi-251)*256-Cr-108)):(Cr=xr[Yr],Ir=xr[Yr+1],Rr=xr[Yr+2],Pr=xr[Yr+3],Yr+=4,lr.push((Cr<<24|Ir<<16|Rr<<8|Pr)/65536))}}}return Sr(tr),er.advanceWidth=yr,or}function parseCFFFDSelect(ir,er,tr,rr){var nr=[],sr,ar=new parse.Parser(ir,er),or=ar.parseCard8();if(or===0)for(var lr=0;lr<tr;lr++){if(sr=ar.parseCard8(),sr>=rr)throw new Error("CFF table CID Font FDSelect has bad FD index value "+sr+" (FD count "+rr+")");nr.push(sr)}else if(or===3){var cr=ar.parseCard16(),hr=ar.parseCard16();if(hr!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+hr);for(var fr,ur=0;ur<cr;ur++){if(sr=ar.parseCard8(),fr=ar.parseCard16(),sr>=rr)throw new Error("CFF table CID Font FDSelect has bad FD index value "+sr+" (FD count "+rr+")");if(fr>tr)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+fr);for(;hr<fr;hr++)nr.push(sr);hr=fr}if(fr!==tr)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+fr)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+or);return nr}function parseCFFTable(ir,er,tr,rr){tr.tables.cff={};var nr=parseCFFHeader(ir,er),sr=parseCFFIndex(ir,nr.endOffset,parse.bytesToString),ar=parseCFFIndex(ir,sr.endOffset),or=parseCFFIndex(ir,ar.endOffset,parse.bytesToString),lr=parseCFFIndex(ir,or.endOffset);tr.gsubrs=lr.objects,tr.gsubrsBias=calcCFFSubroutineBias(tr.gsubrs);var cr=gatherCFFTopDicts(ir,er,ar.objects,or.objects);if(cr.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+cr.length);var hr=cr[0];if(tr.tables.cff.topDict=hr,hr._privateDict&&(tr.defaultWidthX=hr._privateDict.defaultWidthX,tr.nominalWidthX=hr._privateDict.nominalWidthX),hr.ros[0]!==void 0&&hr.ros[1]!==void 0&&(tr.isCIDFont=!0),tr.isCIDFont){var fr=hr.fdArray,ur=hr.fdSelect;if(fr===0||ur===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");fr+=er;var pr=parseCFFIndex(ir,fr),gr=gatherCFFTopDicts(ir,er,pr.objects,or.objects);hr._fdArray=gr,ur+=er,hr._fdSelect=parseCFFFDSelect(ir,ur,tr.numGlyphs,gr.length)}var _r=er+hr.private[1],mr=parseCFFPrivateDict(ir,_r,hr.private[0],or.objects);if(tr.defaultWidthX=mr.defaultWidthX,tr.nominalWidthX=mr.nominalWidthX,mr.subrs!==0){var dr=_r+mr.subrs,vr=parseCFFIndex(ir,dr);tr.subrs=vr.objects,tr.subrsBias=calcCFFSubroutineBias(tr.subrs)}else tr.subrs=[],tr.subrsBias=0;var Ar;rr.lowMemory?(Ar=parseCFFIndexLowMemory(ir,er+hr.charStrings),tr.nGlyphs=Ar.offsets.length):(Ar=parseCFFIndex(ir,er+hr.charStrings),tr.nGlyphs=Ar.objects.length);var yr=parseCFFCharset(ir,er+hr.charset,tr.nGlyphs,or.objects);if(hr.encoding===0?tr.cffEncoding=new CffEncoding(cffStandardEncoding,yr):hr.encoding===1?tr.cffEncoding=new CffEncoding(cffExpertEncoding,yr):tr.cffEncoding=parseCFFEncoding(ir,er+hr.encoding,yr),tr.encoding=tr.encoding||tr.cffEncoding,tr.glyphs=new glyphset.GlyphSet(tr),rr.lowMemory)tr._push=function(Sr){var xr=getCffIndexObject(Sr,Ar.offsets,ir,er+hr.charStrings);tr.glyphs.push(Sr,glyphset.cffGlyphLoader(tr,Sr,parseCFFCharstring,xr))};else for(var wr=0;wr<tr.nGlyphs;wr+=1){var br=Ar.objects[wr];tr.glyphs.push(wr,glyphset.cffGlyphLoader(tr,wr,parseCFFCharstring,br))}}function encodeString(ir,er){var tr,rr=cffStandardStrings.indexOf(ir);return rr>=0&&(tr=rr),rr=er.indexOf(ir),rr>=0?tr=rr+cffStandardStrings.length:(tr=cffStandardStrings.length+er.length,er.push(ir)),tr}function makeHeader(){return new table.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(ir){var er=new table.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);er.names=[];for(var tr=0;tr<ir.length;tr+=1)er.names.push({name:"name_"+tr,type:"NAME",value:ir[tr]});return er}function makeDict(ir,er,tr){for(var rr={},nr=0;nr<ir.length;nr+=1){var sr=ir[nr],ar=er[sr.name];ar!==void 0&&!equals(ar,sr.value)&&(sr.type==="SID"&&(ar=encodeString(ar,tr)),rr[sr.op]={name:sr.name,type:sr.type,value:ar})}return rr}function makeTopDict(ir,er){var tr=new table.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return tr.dict=makeDict(TOP_DICT_META,ir,er),tr}function makeTopDictIndex(ir){var er=new table.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return er.topDicts=[{name:"topDict_0",type:"TABLE",value:ir}],er}function makeStringIndex(ir){var er=new table.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);er.strings=[];for(var tr=0;tr<ir.length;tr+=1)er.strings.push({name:"string_"+tr,type:"STRING",value:ir[tr]});return er}function makeGlobalSubrIndex(){return new table.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(ir,er){for(var tr=new table.Record("Charsets",[{name:"format",type:"Card8",value:0}]),rr=0;rr<ir.length;rr+=1){var nr=ir[rr],sr=encodeString(nr,er);tr.fields.push({name:"glyph_"+rr,type:"SID",value:sr})}return tr}function glyphToOps(ir){var er=[],tr=ir.path;er.push({name:"width",type:"NUMBER",value:ir.advanceWidth});for(var rr=0,nr=0,sr=0;sr<tr.commands.length;sr+=1){var ar=void 0,or=void 0,lr=tr.commands[sr];if(lr.type==="Q"){var cr=.3333333333333333,hr=2/3;lr={type:"C",x:lr.x,y:lr.y,x1:Math.round(cr*rr+hr*lr.x1),y1:Math.round(cr*nr+hr*lr.y1),x2:Math.round(cr*lr.x+hr*lr.x1),y2:Math.round(cr*lr.y+hr*lr.y1)}}if(lr.type==="M")ar=Math.round(lr.x-rr),or=Math.round(lr.y-nr),er.push({name:"dx",type:"NUMBER",value:ar}),er.push({name:"dy",type:"NUMBER",value:or}),er.push({name:"rmoveto",type:"OP",value:21}),rr=Math.round(lr.x),nr=Math.round(lr.y);else if(lr.type==="L")ar=Math.round(lr.x-rr),or=Math.round(lr.y-nr),er.push({name:"dx",type:"NUMBER",value:ar}),er.push({name:"dy",type:"NUMBER",value:or}),er.push({name:"rlineto",type:"OP",value:5}),rr=Math.round(lr.x),nr=Math.round(lr.y);else if(lr.type==="C"){var fr=Math.round(lr.x1-rr),ur=Math.round(lr.y1-nr),pr=Math.round(lr.x2-lr.x1),gr=Math.round(lr.y2-lr.y1);ar=Math.round(lr.x-lr.x2),or=Math.round(lr.y-lr.y2),er.push({name:"dx1",type:"NUMBER",value:fr}),er.push({name:"dy1",type:"NUMBER",value:ur}),er.push({name:"dx2",type:"NUMBER",value:pr}),er.push({name:"dy2",type:"NUMBER",value:gr}),er.push({name:"dx",type:"NUMBER",value:ar}),er.push({name:"dy",type:"NUMBER",value:or}),er.push({name:"rrcurveto",type:"OP",value:8}),rr=Math.round(lr.x),nr=Math.round(lr.y)}}return er.push({name:"endchar",type:"OP",value:14}),er}function makeCharStringsIndex(ir){for(var er=new table.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),tr=0;tr<ir.length;tr+=1){var rr=ir.get(tr),nr=glyphToOps(rr);er.charStrings.push({name:rr.name,type:"CHARSTRING",value:nr})}return er}function makePrivateDict(ir,er){var tr=new table.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return tr.dict=makeDict(PRIVATE_DICT_META,ir,er),tr}function makeCFFTable(ir,er){for(var tr=new table.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),rr=1/er.unitsPerEm,nr={version:er.version,fullName:er.fullName,familyName:er.familyName,weight:er.weightName,fontBBox:er.fontBBox||[0,0,0,0],fontMatrix:[rr,0,0,rr,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},sr={},ar=[],or,lr=1;lr<ir.length;lr+=1)or=ir.get(lr),ar.push(or.name);var cr=[];tr.header=makeHeader(),tr.nameIndex=makeNameIndex([er.postScriptName]);var hr=makeTopDict(nr,cr);tr.topDictIndex=makeTopDictIndex(hr),tr.globalSubrIndex=makeGlobalSubrIndex(),tr.charsets=makeCharsets(ar,cr),tr.charStringsIndex=makeCharStringsIndex(ir),tr.privateDict=makePrivateDict(sr,cr),tr.stringIndex=makeStringIndex(cr);var fr=tr.header.sizeOf()+tr.nameIndex.sizeOf()+tr.topDictIndex.sizeOf()+tr.stringIndex.sizeOf()+tr.globalSubrIndex.sizeOf();return nr.charset=fr,nr.encoding=0,nr.charStrings=nr.charset+tr.charsets.sizeOf(),nr.private[1]=nr.charStrings+tr.charStringsIndex.sizeOf(),hr=makeTopDict(nr,cr),tr.topDictIndex=makeTopDictIndex(hr),tr}var cff={parse:parseCFFTable,make:makeCFFTable};function parseHeadTable(ir,er){var tr={},rr=new parse.Parser(ir,er);return tr.version=rr.parseVersion(),tr.fontRevision=Math.round(rr.parseFixed()*1e3)/1e3,tr.checkSumAdjustment=rr.parseULong(),tr.magicNumber=rr.parseULong(),check.argument(tr.magicNumber===1594834165,"Font header has wrong magic number."),tr.flags=rr.parseUShort(),tr.unitsPerEm=rr.parseUShort(),tr.created=rr.parseLongDateTime(),tr.modified=rr.parseLongDateTime(),tr.xMin=rr.parseShort(),tr.yMin=rr.parseShort(),tr.xMax=rr.parseShort(),tr.yMax=rr.parseShort(),tr.macStyle=rr.parseUShort(),tr.lowestRecPPEM=rr.parseUShort(),tr.fontDirectionHint=rr.parseShort(),tr.indexToLocFormat=rr.parseShort(),tr.glyphDataFormat=rr.parseShort(),tr}function makeHeadTable(ir){var er=Math.round(new Date().getTime()/1e3)+2082844800,tr=er;return ir.createdTimestamp&&(tr=ir.createdTimestamp+2082844800),new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:tr},{name:"modified",type:"LONGDATETIME",value:er},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],ir)}var head={parse:parseHeadTable,make:makeHeadTable};function parseHheaTable(ir,er){var tr={},rr=new parse.Parser(ir,er);return tr.version=rr.parseVersion(),tr.ascender=rr.parseShort(),tr.descender=rr.parseShort(),tr.lineGap=rr.parseShort(),tr.advanceWidthMax=rr.parseUShort(),tr.minLeftSideBearing=rr.parseShort(),tr.minRightSideBearing=rr.parseShort(),tr.xMaxExtent=rr.parseShort(),tr.caretSlopeRise=rr.parseShort(),tr.caretSlopeRun=rr.parseShort(),tr.caretOffset=rr.parseShort(),rr.relativeOffset+=8,tr.metricDataFormat=rr.parseShort(),tr.numberOfHMetrics=rr.parseUShort(),tr}function makeHheaTable(ir){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],ir)}var hhea={parse:parseHheaTable,make:makeHheaTable};function parseHmtxTableAll(ir,er,tr,rr,nr){for(var sr,ar,or=new parse.Parser(ir,er),lr=0;lr<rr;lr+=1){lr<tr&&(sr=or.parseUShort(),ar=or.parseShort());var cr=nr.get(lr);cr.advanceWidth=sr,cr.leftSideBearing=ar}}function parseHmtxTableOnLowMemory(ir,er,tr,rr,nr){ir._hmtxTableData={};for(var sr,ar,or=new parse.Parser(er,tr),lr=0;lr<nr;lr+=1)lr<rr&&(sr=or.parseUShort(),ar=or.parseShort()),ir._hmtxTableData[lr]={advanceWidth:sr,leftSideBearing:ar}}function parseHmtxTable(ir,er,tr,rr,nr,sr,ar){ar.lowMemory?parseHmtxTableOnLowMemory(ir,er,tr,rr,nr):parseHmtxTableAll(er,tr,rr,nr,sr)}function makeHmtxTable(ir){for(var er=new table.Table("hmtx",[]),tr=0;tr<ir.length;tr+=1){var rr=ir.get(tr),nr=rr.advanceWidth||0,sr=rr.leftSideBearing||0;er.fields.push({name:"advanceWidth_"+tr,type:"USHORT",value:nr}),er.fields.push({name:"leftSideBearing_"+tr,type:"SHORT",value:sr})}return er}var hmtx={parse:parseHmtxTable,make:makeHmtxTable};function makeLtagTable(ir){for(var er=new table.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:ir.length}]),tr="",rr=12+ir.length*4,nr=0;nr<ir.length;++nr){var sr=tr.indexOf(ir[nr]);sr<0&&(sr=tr.length,tr+=ir[nr]),er.fields.push({name:"offset "+nr,type:"USHORT",value:rr+sr}),er.fields.push({name:"length "+nr,type:"USHORT",value:ir[nr].length})}return er.fields.push({name:"stringPool",type:"CHARARRAY",value:tr}),er}function parseLtagTable(ir,er){var tr=new parse.Parser(ir,er),rr=tr.parseULong();check.argument(rr===1,"Unsupported ltag table version."),tr.skip("uLong",1);for(var nr=tr.parseULong(),sr=[],ar=0;ar<nr;ar++){for(var or="",lr=er+tr.parseUShort(),cr=tr.parseUShort(),hr=lr;hr<lr+cr;++hr)or+=String.fromCharCode(ir.getInt8(hr));sr.push(or)}return sr}var ltag={make:makeLtagTable,parse:parseLtagTable};function parseMaxpTable(ir,er){var tr={},rr=new parse.Parser(ir,er);return tr.version=rr.parseVersion(),tr.numGlyphs=rr.parseUShort(),tr.version===1&&(tr.maxPoints=rr.parseUShort(),tr.maxContours=rr.parseUShort(),tr.maxCompositePoints=rr.parseUShort(),tr.maxCompositeContours=rr.parseUShort(),tr.maxZones=rr.parseUShort(),tr.maxTwilightPoints=rr.parseUShort(),tr.maxStorage=rr.parseUShort(),tr.maxFunctionDefs=rr.parseUShort(),tr.maxInstructionDefs=rr.parseUShort(),tr.maxStackElements=rr.parseUShort(),tr.maxSizeOfInstructions=rr.parseUShort(),tr.maxComponentElements=rr.parseUShort(),tr.maxComponentDepth=rr.parseUShort()),tr}function makeMaxpTable(ir){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:ir}])}var maxp={parse:parseMaxpTable,make:makeMaxpTable},nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],macLanguages={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},macLanguageToScript={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},windowsLanguages={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function getLanguageCode(ir,er,tr){switch(ir){case 0:if(er===65535)return"und";if(tr)return tr[er];break;case 1:return macLanguages[er];case 3:return windowsLanguages[er]}}var utf16="utf-16",macScriptEncodings={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},macLanguageEncodings={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function getEncoding(ir,er,tr){switch(ir){case 0:return utf16;case 1:return macLanguageEncodings[tr]||macScriptEncodings[er];case 3:if(er===1||er===10)return utf16;break}}function parseNameTable(ir,er,tr){for(var rr={},nr=new parse.Parser(ir,er),sr=nr.parseUShort(),ar=nr.parseUShort(),or=nr.offset+nr.parseUShort(),lr=0;lr<ar;lr++){var cr=nr.parseUShort(),hr=nr.parseUShort(),fr=nr.parseUShort(),ur=nr.parseUShort(),pr=nameTableNames[ur]||ur,gr=nr.parseUShort(),_r=nr.parseUShort(),mr=getLanguageCode(cr,fr,tr),dr=getEncoding(cr,hr,fr);if(dr!==void 0&&mr!==void 0){var vr=void 0;if(dr===utf16?vr=decode.UTF16(ir,or+_r,gr):vr=decode.MACSTRING(ir,or+_r,gr,dr),vr){var Ar=rr[pr];Ar===void 0&&(Ar=rr[pr]={}),Ar[mr]=vr}}}var yr=0;return sr===1&&(yr=nr.parseUShort()),rr}function reverseDict(ir){var er={};for(var tr in ir)er[ir[tr]]=parseInt(tr);return er}function makeNameRecord(ir,er,tr,rr,nr,sr){return new table.Record("NameRecord",[{name:"platformID",type:"USHORT",value:ir},{name:"encodingID",type:"USHORT",value:er},{name:"languageID",type:"USHORT",value:tr},{name:"nameID",type:"USHORT",value:rr},{name:"length",type:"USHORT",value:nr},{name:"offset",type:"USHORT",value:sr}])}function findSubArray(ir,er){var tr=ir.length,rr=er.length-tr+1;e:for(var nr=0;nr<rr;nr++)for(;nr<rr;nr++){for(var sr=0;sr<tr;sr++)if(er[nr+sr]!==ir[sr])continue e;return nr}return-1}function addStringToPool(ir,er){var tr=findSubArray(ir,er);if(tr<0){tr=er.length;for(var rr=0,nr=ir.length;rr<nr;++rr)er.push(ir[rr])}return tr}function makeNameTable(ir,er){var tr,rr=[],nr={},sr=reverseDict(nameTableNames);for(var ar in ir){var or=sr[ar];if(or===void 0&&(or=ar),tr=parseInt(or),isNaN(tr))throw new Error('Name table entry "'+ar+'" does not exist, see nameTableNames for complete list.');nr[tr]=ir[ar],rr.push(tr)}for(var lr=reverseDict(macLanguages),cr=reverseDict(windowsLanguages),hr=[],fr=[],ur=0;ur<rr.length;ur++){tr=rr[ur];var pr=nr[tr];for(var gr in pr){var _r=pr[gr],mr=1,dr=lr[gr],vr=macLanguageToScript[dr],Ar=getEncoding(mr,vr,dr),yr=encode.MACSTRING(_r,Ar);yr===void 0&&(mr=0,dr=er.indexOf(gr),dr<0&&(dr=er.length,er.push(gr)),vr=4,yr=encode.UTF16(_r));var wr=addStringToPool(yr,fr);hr.push(makeNameRecord(mr,vr,dr,tr,yr.length,wr));var br=cr[gr];if(br!==void 0){var Sr=encode.UTF16(_r),xr=addStringToPool(Sr,fr);hr.push(makeNameRecord(3,1,br,tr,Sr.length,xr))}}}hr.sort(function(Rr,Pr){return Rr.platformID-Pr.platformID||Rr.encodingID-Pr.encodingID||Rr.languageID-Pr.languageID||Rr.nameID-Pr.nameID});for(var Cr=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:hr.length},{name:"stringOffset",type:"USHORT",value:6+hr.length*12}]),Ir=0;Ir<hr.length;Ir++)Cr.fields.push({name:"record_"+Ir,type:"RECORD",value:hr[Ir]});return Cr.fields.push({name:"strings",type:"LITERAL",value:fr}),Cr}var _name={parse:parseNameTable,make:makeNameTable},unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(ir){for(var er=0;er<unicodeRanges.length;er+=1){var tr=unicodeRanges[er];if(ir>=tr.begin&&ir<tr.end)return er}return-1}function parseOS2Table(ir,er){var tr={},rr=new parse.Parser(ir,er);tr.version=rr.parseUShort(),tr.xAvgCharWidth=rr.parseShort(),tr.usWeightClass=rr.parseUShort(),tr.usWidthClass=rr.parseUShort(),tr.fsType=rr.parseUShort(),tr.ySubscriptXSize=rr.parseShort(),tr.ySubscriptYSize=rr.parseShort(),tr.ySubscriptXOffset=rr.parseShort(),tr.ySubscriptYOffset=rr.parseShort(),tr.ySuperscriptXSize=rr.parseShort(),tr.ySuperscriptYSize=rr.parseShort(),tr.ySuperscriptXOffset=rr.parseShort(),tr.ySuperscriptYOffset=rr.parseShort(),tr.yStrikeoutSize=rr.parseShort(),tr.yStrikeoutPosition=rr.parseShort(),tr.sFamilyClass=rr.parseShort(),tr.panose=[];for(var nr=0;nr<10;nr++)tr.panose[nr]=rr.parseByte();return tr.ulUnicodeRange1=rr.parseULong(),tr.ulUnicodeRange2=rr.parseULong(),tr.ulUnicodeRange3=rr.parseULong(),tr.ulUnicodeRange4=rr.parseULong(),tr.achVendID=String.fromCharCode(rr.parseByte(),rr.parseByte(),rr.parseByte(),rr.parseByte()),tr.fsSelection=rr.parseUShort(),tr.usFirstCharIndex=rr.parseUShort(),tr.usLastCharIndex=rr.parseUShort(),tr.sTypoAscender=rr.parseShort(),tr.sTypoDescender=rr.parseShort(),tr.sTypoLineGap=rr.parseShort(),tr.usWinAscent=rr.parseUShort(),tr.usWinDescent=rr.parseUShort(),tr.version>=1&&(tr.ulCodePageRange1=rr.parseULong(),tr.ulCodePageRange2=rr.parseULong()),tr.version>=2&&(tr.sxHeight=rr.parseShort(),tr.sCapHeight=rr.parseShort(),tr.usDefaultChar=rr.parseUShort(),tr.usBreakChar=rr.parseUShort(),tr.usMaxContent=rr.parseUShort()),tr}function makeOS2Table(ir){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],ir)}var os2={parse:parseOS2Table,make:makeOS2Table,unicodeRanges,getUnicodeRange};function parsePostTable(ir,er){var tr={},rr=new parse.Parser(ir,er);switch(tr.version=rr.parseVersion(),tr.italicAngle=rr.parseFixed(),tr.underlinePosition=rr.parseShort(),tr.underlineThickness=rr.parseShort(),tr.isFixedPitch=rr.parseULong(),tr.minMemType42=rr.parseULong(),tr.maxMemType42=rr.parseULong(),tr.minMemType1=rr.parseULong(),tr.maxMemType1=rr.parseULong(),tr.version){case 1:tr.names=standardNames.slice();break;case 2:tr.numberOfGlyphs=rr.parseUShort(),tr.glyphNameIndex=new Array(tr.numberOfGlyphs);for(var nr=0;nr<tr.numberOfGlyphs;nr++)tr.glyphNameIndex[nr]=rr.parseUShort();tr.names=[];for(var sr=0;sr<tr.numberOfGlyphs;sr++)if(tr.glyphNameIndex[sr]>=standardNames.length){var ar=rr.parseChar();tr.names.push(rr.parseString(ar))}break;case 2.5:tr.numberOfGlyphs=rr.parseUShort(),tr.offset=new Array(tr.numberOfGlyphs);for(var or=0;or<tr.numberOfGlyphs;or++)tr.offset[or]=rr.parseChar();break}return tr}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var post={parse:parsePostTable,make:makePostTable},subtableParsers=new Array(9);subtableParsers[1]=function ir(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();if(tr===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),deltaGlyphId:this.parseUShort()};if(tr===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),substitute:this.parseOffset16List()};check.assert(!1,"0x"+er.toString(16)+": lookup type 1 format must be 1 or 2.")};subtableParsers[2]=function ir(){var er=this.parseUShort();return check.argument(er===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:er,coverage:this.parsePointer(Parser.coverage),sequences:this.parseListOfLists()}};subtableParsers[3]=function ir(){var er=this.parseUShort();return check.argument(er===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:er,coverage:this.parsePointer(Parser.coverage),alternateSets:this.parseListOfLists()}};subtableParsers[4]=function ir(){var er=this.parseUShort();return check.argument(er===1,"GSUB ligature table identifier-format must be 1"),{substFormat:er,coverage:this.parsePointer(Parser.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var lookupRecordDesc={sequenceIndex:Parser.uShort,lookupListIndex:Parser.uShort};subtableParsers[5]=function ir(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();if(tr===1)return{substFormat:tr,coverage:this.parsePointer(Parser.coverage),ruleSets:this.parseListOfLists(function(){var sr=this.parseUShort(),ar=this.parseUShort();return{input:this.parseUShortList(sr-1),lookupRecords:this.parseRecordList(ar,lookupRecordDesc)}})};if(tr===2)return{substFormat:tr,coverage:this.parsePointer(Parser.coverage),classDef:this.parsePointer(Parser.classDef),classSets:this.parseListOfLists(function(){var sr=this.parseUShort(),ar=this.parseUShort();return{classes:this.parseUShortList(sr-1),lookupRecords:this.parseRecordList(ar,lookupRecordDesc)}})};if(tr===3){var rr=this.parseUShort(),nr=this.parseUShort();return{substFormat:tr,coverages:this.parseList(rr,Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(nr,lookupRecordDesc)}}check.assert(!1,"0x"+er.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};subtableParsers[6]=function ir(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();if(tr===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(tr===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),backtrackClassDef:this.parsePointer(Parser.classDef),inputClassDef:this.parsePointer(Parser.classDef),lookaheadClassDef:this.parsePointer(Parser.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(tr===3)return{substFormat:3,backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),inputCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(lookupRecordDesc)};check.assert(!1,"0x"+er.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};subtableParsers[7]=function ir(){var er=this.parseUShort();check.argument(er===1,"GSUB Extension Substitution subtable identifier-format must be 1");var tr=this.parseUShort(),rr=new Parser(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:tr,extension:subtableParsers[tr].call(rr)}};subtableParsers[8]=function ir(){var er=this.parseUShort();return check.argument(er===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:er,coverage:this.parsePointer(Parser.coverage),backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),substitutes:this.parseUShortList()}};function parseGsubTable(ir,er){er=er||0;var tr=new Parser(ir,er),rr=tr.parseVersion(1);return check.argument(rr===1||rr===1.1,"Unsupported GSUB table version."),rr===1?{version:rr,scripts:tr.parseScriptList(),features:tr.parseFeatureList(),lookups:tr.parseLookupList(subtableParsers)}:{version:rr,scripts:tr.parseScriptList(),features:tr.parseFeatureList(),lookups:tr.parseLookupList(subtableParsers),variations:tr.parseFeatureVariationsList()}}var subtableMakers=new Array(9);subtableMakers[1]=function ir(er){return er.substFormat===1?new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)},{name:"deltaGlyphID",type:"USHORT",value:er.deltaGlyphId}]):new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.ushortList("substitute",er.substitute)))};subtableMakers[2]=function ir(er){return check.assert(er.substFormat===1,"Lookup type 2 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.tableList("seqSet",er.sequences,function(tr){return new table.Table("sequenceSetTable",table.ushortList("sequence",tr))})))};subtableMakers[3]=function ir(er){return check.assert(er.substFormat===1,"Lookup type 3 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.tableList("altSet",er.alternateSets,function(tr){return new table.Table("alternateSetTable",table.ushortList("alternate",tr))})))};subtableMakers[4]=function ir(er){return check.assert(er.substFormat===1,"Lookup type 4 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.tableList("ligSet",er.ligatureSets,function(tr){return new table.Table("ligatureSetTable",table.tableList("ligature",tr,function(rr){return new table.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:rr.ligGlyph}].concat(table.ushortList("component",rr.components,rr.components.length+1)))}))})))};subtableMakers[6]=function ir(er){if(er.substFormat===1){var tr=new table.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:er.substFormat},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.tableList("chainRuleSet",er.chainRuleSets,function(sr){return new table.Table("chainRuleSetTable",table.tableList("chainRule",sr,function(ar){var or=table.ushortList("backtrackGlyph",ar.backtrack,ar.backtrack.length).concat(table.ushortList("inputGlyph",ar.input,ar.input.length+1)).concat(table.ushortList("lookaheadGlyph",ar.lookahead,ar.lookahead.length)).concat(table.ushortList("substitution",[],ar.lookupRecords.length));return ar.lookupRecords.forEach(function(lr,cr){or=or.concat({name:"sequenceIndex"+cr,type:"USHORT",value:lr.sequenceIndex}).concat({name:"lookupListIndex"+cr,type:"USHORT",value:lr.lookupListIndex})}),new table.Table("chainRuleTable",or)}))})));return tr}else if(er.substFormat===2)check.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(er.substFormat===3){var rr=[{name:"substFormat",type:"USHORT",value:er.substFormat}];rr.push({name:"backtrackGlyphCount",type:"USHORT",value:er.backtrackCoverage.length}),er.backtrackCoverage.forEach(function(sr,ar){rr.push({name:"backtrackCoverage"+ar,type:"TABLE",value:new table.Coverage(sr)})}),rr.push({name:"inputGlyphCount",type:"USHORT",value:er.inputCoverage.length}),er.inputCoverage.forEach(function(sr,ar){rr.push({name:"inputCoverage"+ar,type:"TABLE",value:new table.Coverage(sr)})}),rr.push({name:"lookaheadGlyphCount",type:"USHORT",value:er.lookaheadCoverage.length}),er.lookaheadCoverage.forEach(function(sr,ar){rr.push({name:"lookaheadCoverage"+ar,type:"TABLE",value:new table.Coverage(sr)})}),rr.push({name:"substitutionCount",type:"USHORT",value:er.lookupRecords.length}),er.lookupRecords.forEach(function(sr,ar){rr=rr.concat({name:"sequenceIndex"+ar,type:"USHORT",value:sr.sequenceIndex}).concat({name:"lookupListIndex"+ar,type:"USHORT",value:sr.lookupListIndex})});var nr=new table.Table("chainContextTable",rr);return nr}check.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function makeGsubTable(ir){return new table.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(ir.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(ir.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(ir.lookups,subtableMakers)}])}var gsub={parse:parseGsubTable,make:makeGsubTable};function parseMetaTable(ir,er){var tr=new parse.Parser(ir,er),rr=tr.parseULong();check.argument(rr===1,"Unsupported META table version."),tr.parseULong(),tr.parseULong();for(var nr=tr.parseULong(),sr={},ar=0;ar<nr;ar++){var or=tr.parseTag(),lr=tr.parseULong(),cr=tr.parseULong(),hr=decode.UTF8(ir,er+lr,cr);sr[or]=hr}return sr}function makeMetaTable(ir){var er=Object.keys(ir).length,tr="",rr=16+er*12,nr=new table.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:rr},{name:"numTags",type:"ULONG",value:er}]);for(var sr in ir){var ar=tr.length;tr+=ir[sr],nr.fields.push({name:"tag "+sr,type:"TAG",value:sr}),nr.fields.push({name:"offset "+sr,type:"ULONG",value:rr+ar}),nr.fields.push({name:"length "+sr,type:"ULONG",value:ir[sr].length})}return nr.fields.push({name:"stringPool",type:"CHARARRAY",value:tr}),nr}var meta={parse:parseMetaTable,make:makeMetaTable};function parseColrTable(ir,er){var tr=new Parser(ir,er),rr=tr.parseUShort();check.argument(rr===0,"Only COLRv0 supported.");var nr=tr.parseUShort(),sr=tr.parseOffset32(),ar=tr.parseOffset32(),or=tr.parseUShort();tr.relativeOffset=sr;var lr=tr.parseRecordList(nr,{glyphID:Parser.uShort,firstLayerIndex:Parser.uShort,numLayers:Parser.uShort});tr.relativeOffset=ar;var cr=tr.parseRecordList(or,{glyphID:Parser.uShort,paletteIndex:Parser.uShort});return{version:rr,baseGlyphRecords:lr,layerRecords:cr}}function makeColrTable(ir){var er=ir.version;er===void 0&&(er=0);var tr=ir.baseGlyphRecords;tr===void 0&&(tr=[]);var rr=ir.layerRecords;rr===void 0&&(rr=[]),check.argument(er===0,"Only COLRv0 supported.");var nr=14,sr=nr+tr.length*6;return new table.Table("COLR",[{name:"version",type:"USHORT",value:er},{name:"numBaseGlyphRecords",type:"USHORT",value:tr.length},{name:"baseGlyphRecordsOffset",type:"ULONG",value:nr},{name:"layerRecordsOffset",type:"ULONG",value:sr},{name:"numLayerRecords",type:"USHORT",value:rr.length}].concat(tr.map(function(ar,or){return[{name:"glyphID_"+or,type:"USHORT",value:ar.glyphID},{name:"firstLayerIndex_"+or,type:"USHORT",value:ar.firstLayerIndex},{name:"numLayers_"+or,type:"USHORT",value:ar.numLayers}]}).flat(),rr.map(function(ar,or){return[{name:"LayerGlyphID_"+or,type:"USHORT",value:ar.glyphID},{name:"paletteIndex_"+or,type:"USHORT",value:ar.paletteIndex}]}).flat()))}var colr={parse:parseColrTable,make:makeColrTable};function parseCpalTable(ir,er){var tr=new Parser(ir,er),rr=tr.parseShort(),nr=tr.parseShort(),sr=tr.parseShort(),ar=tr.parseShort(),or=tr.parseOffset32(),lr=tr.parseUShortList(sr);tr.relativeOffset=or;var cr=tr.parseULongList(ar);return{version:rr,numPaletteEntries:nr,colorRecords:cr,colorRecordIndices:lr}}function makeCpalTable(ir){var er=ir.version;er===void 0&&(er=0);var tr=ir.numPaletteEntries;tr===void 0&&(tr=0);var rr=ir.colorRecords;rr===void 0&&(rr=[]);var nr=ir.colorRecordIndices;return nr===void 0&&(nr=[0]),check.argument(er===0,"Only CPALv0 are supported."),check.argument(rr.length,"No colorRecords given."),check.argument(nr.length,"No colorRecordIndices given."),check.argument(!tr&&nr.length==1,"Can't infer numPaletteEntries on multiple colorRecordIndices"),new table.Table("CPAL",[{name:"version",type:"USHORT",value:er},{name:"numPaletteEntries",type:"USHORT",value:tr||rr.length},{name:"numPalettes",type:"USHORT",value:nr.length},{name:"numColorRecords",type:"USHORT",value:rr.length},{name:"colorRecordsArrayOffset",type:"ULONG",value:12+2*nr.length}].concat(nr.map(function(sr,ar){return{name:"colorRecordIndices_"+ar,type:"USHORT",value:sr}}),rr.map(function(sr,ar){return{name:"colorRecords_"+ar,type:"ULONG",value:sr}})))}var cpal={parse:parseCpalTable,make:makeCpalTable};function log2(ir){return Math.log(ir)/Math.log(2)|0}function computeCheckSum(ir){for(;ir.length%4!==0;)ir.push(0);for(var er=0,tr=0;tr<ir.length;tr+=4)er+=(ir[tr]<<24)+(ir[tr+1]<<16)+(ir[tr+2]<<8)+ir[tr+3];return er%=Math.pow(2,32),er}function makeTableRecord(ir,er,tr,rr){return new table.Record("Table Record",[{name:"tag",type:"TAG",value:ir!==void 0?ir:""},{name:"checkSum",type:"ULONG",value:er!==void 0?er:0},{name:"offset",type:"ULONG",value:tr!==void 0?tr:0},{name:"length",type:"ULONG",value:rr!==void 0?rr:0}])}function makeSfntTable(ir){var er=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);er.tables=ir,er.numTables=ir.length;var tr=Math.pow(2,log2(er.numTables));er.searchRange=16*tr,er.entrySelector=log2(tr),er.rangeShift=er.numTables*16-er.searchRange;for(var rr=[],nr=[],sr=er.sizeOf()+makeTableRecord().sizeOf()*er.numTables;sr%4!==0;)sr+=1,nr.push({name:"padding",type:"BYTE",value:0});for(var ar=0;ar<ir.length;ar+=1){var or=ir[ar];check.argument(or.tableName.length===4,"Table name"+or.tableName+" is invalid.");var lr=or.sizeOf(),cr=makeTableRecord(or.tableName,computeCheckSum(or.encode()),sr,lr);for(rr.push({name:cr.tag+" Table Record",type:"RECORD",value:cr}),nr.push({name:or.tableName+" table",type:"RECORD",value:or}),sr+=lr,check.argument(!isNaN(sr),"Something went wrong calculating the offset.");sr%4!==0;)sr+=1,nr.push({name:"padding",type:"BYTE",value:0})}return rr.sort(function(hr,fr){return hr.value.tag>fr.value.tag?1:-1}),er.fields=er.fields.concat(rr),er.fields=er.fields.concat(nr),er}function metricsForChar(ir,er,tr){for(var rr=0;rr<er.length;rr+=1){var nr=ir.charToGlyphIndex(er[rr]);if(nr>0){var sr=ir.glyphs.get(nr);return sr.getMetrics()}}return tr}function average(ir){for(var er=0,tr=0;tr<ir.length;tr+=1)er+=ir[tr];return er/ir.length}function fontToSfntTable(ir){for(var er=[],tr=[],rr=[],nr=[],sr=[],ar=[],or=[],lr,cr=0,hr=0,fr=0,ur=0,pr=0,gr=0;gr<ir.glyphs.length;gr+=1){var _r=ir.glyphs.get(gr),mr=_r.unicode|0;if(isNaN(_r.advanceWidth))throw new Error("Glyph "+_r.name+" ("+gr+"): advanceWidth is not a number.");(lr>mr||lr===void 0)&&mr>0&&(lr=mr),cr<mr&&(cr=mr);var dr=os2.getUnicodeRange(mr);if(dr<32)hr|=1<<dr;else if(dr<64)fr|=1<<dr-32;else if(dr<96)ur|=1<<dr-64;else if(dr<123)pr|=1<<dr-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(_r.name!==".notdef"){var vr=_r.getMetrics();er.push(vr.xMin),tr.push(vr.yMin),rr.push(vr.xMax),nr.push(vr.yMax),ar.push(vr.leftSideBearing),or.push(vr.rightSideBearing),sr.push(_r.advanceWidth)}}var Ar={xMin:Math.min.apply(null,er),yMin:Math.min.apply(null,tr),xMax:Math.max.apply(null,rr),yMax:Math.max.apply(null,nr),advanceWidthMax:Math.max.apply(null,sr),advanceWidthAvg:average(sr),minLeftSideBearing:Math.min.apply(null,ar),maxLeftSideBearing:Math.max.apply(null,ar),minRightSideBearing:Math.min.apply(null,or)};Ar.ascender=ir.ascender,Ar.descender=ir.descender;var yr=head.make({flags:3,unitsPerEm:ir.unitsPerEm,xMin:Ar.xMin,yMin:Ar.yMin,xMax:Ar.xMax,yMax:Ar.yMax,lowestRecPPEM:3,createdTimestamp:ir.createdTimestamp}),wr=hhea.make({ascender:Ar.ascender,descender:Ar.descender,advanceWidthMax:Ar.advanceWidthMax,minLeftSideBearing:Ar.minLeftSideBearing,minRightSideBearing:Ar.minRightSideBearing,xMaxExtent:Ar.maxLeftSideBearing+(Ar.xMax-Ar.xMin),numberOfHMetrics:ir.glyphs.length}),br=maxp.make(ir.glyphs.length),Sr=os2.make(Object.assign({xAvgCharWidth:Math.round(Ar.advanceWidthAvg),usFirstCharIndex:lr,usLastCharIndex:cr,ulUnicodeRange1:hr,ulUnicodeRange2:fr,ulUnicodeRange3:ur,ulUnicodeRange4:pr,sTypoAscender:Ar.ascender,sTypoDescender:Ar.descender,sTypoLineGap:0,usWinAscent:Ar.yMax,usWinDescent:Math.abs(Ar.yMin),ulCodePageRange1:1,sxHeight:metricsForChar(ir,"xyvw",{yMax:Math.round(Ar.ascender/2)}).yMax,sCapHeight:metricsForChar(ir,"HIKLEFJMNTZBDPRAGOQSUVWXY",Ar).yMax,usDefaultChar:ir.hasChar(" ")?32:0,usBreakChar:ir.hasChar(" ")?32:0},ir.tables.os2)),xr=hmtx.make(ir.glyphs),Cr=cmap.make(ir.glyphs),Ir=ir.getEnglishName("fontFamily"),Rr=ir.getEnglishName("fontSubfamily"),Pr=Ir+" "+Rr,Fr=ir.getEnglishName("postScriptName");Fr||(Fr=Ir.replace(/\s/g,"")+"-"+Rr);var Nr={};for(var Ur in ir.names)Nr[Ur]=ir.names[Ur];Nr.uniqueID||(Nr.uniqueID={en:ir.getEnglishName("manufacturer")+":"+Pr}),Nr.postScriptName||(Nr.postScriptName={en:Fr}),Nr.preferredFamily||(Nr.preferredFamily=ir.names.fontFamily),Nr.preferredSubfamily||(Nr.preferredSubfamily=ir.names.fontSubfamily);var Br=[],Or=_name.make(Nr,Br),Dr=Br.length>0?ltag.make(Br):void 0,Wr=post.make(),$r=cff.make(ir.glyphs,{version:ir.getEnglishName("version"),fullName:Pr,familyName:Ir,weightName:Rr,postScriptName:Fr,unitsPerEm:ir.unitsPerEm,fontBBox:[0,Ar.yMin,Ar.ascender,Ar.advanceWidthMax]}),Yr=ir.metas&&Object.keys(ir.metas).length>0?meta.make(ir.metas):void 0,Qi=[yr,wr,br,Sr,Or,Cr,Wr,$r,xr];Dr&&Qi.push(Dr),ir.tables.gsub&&Qi.push(gsub.make(ir.tables.gsub)),ir.tables.cpal&&Qi.push(cpal.make(ir.tables.cpal)),ir.tables.colr&&Qi.push(colr.make(ir.tables.colr)),Yr&&Qi.push(Yr);for(var rs=makeSfntTable(Qi),Kr=rs.encode(),Qr=computeCheckSum(Kr),Vr=rs.fields,Gr=!1,qr=0;qr<Vr.length;qr+=1)if(Vr[qr].name==="head table"){Vr[qr].value.checkSumAdjustment=2981146554-Qr,Gr=!0;break}if(!Gr)throw new Error("Could not find head table with checkSum to adjust.");return rs}var sfnt={make:makeSfntTable,fontToTable:fontToSfntTable,computeCheckSum};function searchTag(ir,er){for(var tr=0,rr=ir.length-1;tr<=rr;){var nr=tr+rr>>>1,sr=ir[nr].tag;if(sr===er)return nr;sr<er?tr=nr+1:rr=nr-1}return-tr-1}function binSearch(ir,er){for(var tr=0,rr=ir.length-1;tr<=rr;){var nr=tr+rr>>>1,sr=ir[nr];if(sr===er)return nr;sr<er?tr=nr+1:rr=nr-1}return-tr-1}function searchRange(ir,er){for(var tr,rr=0,nr=ir.length-1;rr<=nr;){var sr=rr+nr>>>1;tr=ir[sr];var ar=tr.start;if(ar===er)return tr;ar<er?rr=sr+1:nr=sr-1}if(rr>0)return tr=ir[rr-1],er>tr.end?0:tr}function Layout(ir,er){this.font=ir,this.tableName=er}Layout.prototype={searchTag,binSearch,getTable:function(ir){var er=this.font.tables[this.tableName];return!er&&ir&&(er=this.font.tables[this.tableName]=this.createDefaultTable()),er},getScriptNames:function(){var ir=this.getTable();return ir?ir.scripts.map(function(er){return er.tag}):[]},getDefaultScriptName:function(){var ir=this.getTable();if(ir){for(var er=!1,tr=0;tr<ir.scripts.length;tr++){var rr=ir.scripts[tr].tag;if(rr==="DFLT")return rr;rr==="latn"&&(er=!0)}if(er)return"latn"}},getScriptTable:function(ir,er){var tr=this.getTable(er);if(tr){ir=ir||"DFLT";var rr=tr.scripts,nr=searchTag(tr.scripts,ir);if(nr>=0)return rr[nr].script;if(er){var sr={tag:ir,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return rr.splice(-1-nr,0,sr),sr.script}}},getLangSysTable:function(ir,er,tr){var rr=this.getScriptTable(ir,tr);if(rr){if(!er||er==="dflt"||er==="DFLT")return rr.defaultLangSys;var nr=searchTag(rr.langSysRecords,er);if(nr>=0)return rr.langSysRecords[nr].langSys;if(tr){var sr={tag:er,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return rr.langSysRecords.splice(-1-nr,0,sr),sr.langSys}}},getFeatureTable:function(ir,er,tr,rr){var nr=this.getLangSysTable(ir,er,rr);if(nr){for(var sr,ar=nr.featureIndexes,or=this.font.tables[this.tableName].features,lr=0;lr<ar.length;lr++)if(sr=or[ar[lr]],sr.tag===tr)return sr.feature;if(rr){var cr=or.length;return check.assert(cr===0||tr>=or[cr-1].tag,"Features must be added in alphabetical order."),sr={tag:tr,feature:{params:0,lookupListIndexes:[]}},or.push(sr),ar.push(cr),sr.feature}}},getLookupTables:function(ir,er,tr,rr,nr){var sr=this.getFeatureTable(ir,er,tr,nr),ar=[];if(sr){for(var or,lr=sr.lookupListIndexes,cr=this.font.tables[this.tableName].lookups,hr=0;hr<lr.length;hr++)or=cr[lr[hr]],or.lookupType===rr&&ar.push(or);if(ar.length===0&&nr){or={lookupType:rr,lookupFlag:0,subtables:[],markFilteringSet:void 0};var fr=cr.length;return cr.push(or),lr.push(fr),[or]}}return ar},getGlyphClass:function(ir,er){switch(ir.format){case 1:return ir.startGlyph<=er&&er<ir.startGlyph+ir.classes.length?ir.classes[er-ir.startGlyph]:0;case 2:var tr=searchRange(ir.ranges,er);return tr?tr.classId:0}},getCoverageIndex:function(ir,er){switch(ir.format){case 1:var tr=binSearch(ir.glyphs,er);return tr>=0?tr:-1;case 2:var rr=searchRange(ir.ranges,er);return rr?rr.index+er-rr.start:-1}},expandCoverage:function(ir){if(ir.format===1)return ir.glyphs;for(var er=[],tr=ir.ranges,rr=0;rr<tr.length;rr++)for(var nr=tr[rr],sr=nr.start,ar=nr.end,or=sr;or<=ar;or++)er.push(or);return er}};function Position(ir){Layout.call(this,ir,"gpos")}Position.prototype=Layout.prototype;Position.prototype.init=function(){var ir=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(ir)};Position.prototype.getKerningValue=function(ir,er,tr){for(var rr=0;rr<ir.length;rr++)for(var nr=ir[rr].subtables,sr=0;sr<nr.length;sr++){var ar=nr[sr],or=this.getCoverageIndex(ar.coverage,er);if(!(or<0))switch(ar.posFormat){case 1:for(var lr=ar.pairSets[or],cr=0;cr<lr.length;cr++){var hr=lr[cr];if(hr.secondGlyph===tr)return hr.value1&&hr.value1.xAdvance||0}break;case 2:var fr=this.getGlyphClass(ar.classDef1,er),ur=this.getGlyphClass(ar.classDef2,tr),pr=ar.classRecords[fr][ur];return pr.value1&&pr.value1.xAdvance||0}}return 0};Position.prototype.getKerningTables=function(ir,er){if(this.font.tables.gpos)return this.getLookupTables(ir,er,"kern",2)};function Substitution(ir){Layout.call(this,ir,"gsub")}function arraysEqual(ir,er){var tr=ir.length;if(tr!==er.length)return!1;for(var rr=0;rr<tr;rr++)if(ir[rr]!==er[rr])return!1;return!0}function getSubstFormat(ir,er,tr){for(var rr=ir.subtables,nr=0;nr<rr.length;nr++){var sr=rr[nr];if(sr.substFormat===er)return sr}if(tr)return rr.push(tr),tr}Substitution.prototype=Layout.prototype;Substitution.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};Substitution.prototype.getSingle=function(ir,er,tr){for(var rr=[],nr=this.getLookupTables(er,tr,ir,1),sr=0;sr<nr.length;sr++)for(var ar=nr[sr].subtables,or=0;or<ar.length;or++){var lr=ar[or],cr=this.expandCoverage(lr.coverage),hr=void 0;if(lr.substFormat===1){var fr=lr.deltaGlyphId;for(hr=0;hr<cr.length;hr++){var ur=cr[hr];rr.push({sub:ur,by:ur+fr})}}else{var pr=lr.substitute;for(hr=0;hr<cr.length;hr++)rr.push({sub:cr[hr],by:pr[hr]})}}return rr};Substitution.prototype.getMultiple=function(ir,er,tr){for(var rr=[],nr=this.getLookupTables(er,tr,ir,2),sr=0;sr<nr.length;sr++)for(var ar=nr[sr].subtables,or=0;or<ar.length;or++){var lr=ar[or],cr=this.expandCoverage(lr.coverage),hr=void 0;for(hr=0;hr<cr.length;hr++){var fr=cr[hr],ur=lr.sequences[hr];rr.push({sub:fr,by:ur})}}return rr};Substitution.prototype.getAlternates=function(ir,er,tr){for(var rr=[],nr=this.getLookupTables(er,tr,ir,3),sr=0;sr<nr.length;sr++)for(var ar=nr[sr].subtables,or=0;or<ar.length;or++)for(var lr=ar[or],cr=this.expandCoverage(lr.coverage),hr=lr.alternateSets,fr=0;fr<cr.length;fr++)rr.push({sub:cr[fr],by:hr[fr]});return rr};Substitution.prototype.getLigatures=function(ir,er,tr){for(var rr=[],nr=this.getLookupTables(er,tr,ir,4),sr=0;sr<nr.length;sr++)for(var ar=nr[sr].subtables,or=0;or<ar.length;or++)for(var lr=ar[or],cr=this.expandCoverage(lr.coverage),hr=lr.ligatureSets,fr=0;fr<cr.length;fr++)for(var ur=cr[fr],pr=hr[fr],gr=0;gr<pr.length;gr++){var _r=pr[gr];rr.push({sub:[ur].concat(_r.components),by:_r.ligGlyph})}return rr};Substitution.prototype.addSingle=function(ir,er,tr,rr){var nr=this.getLookupTables(tr,rr,ir,1,!0)[0],sr=getSubstFormat(nr,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});check.assert(sr.coverage.format===1,"Single: unable to modify coverage table format "+sr.coverage.format);var ar=er.sub,or=this.binSearch(sr.coverage.glyphs,ar);or<0&&(or=-1-or,sr.coverage.glyphs.splice(or,0,ar),sr.substitute.splice(or,0,0)),sr.substitute[or]=er.by};Substitution.prototype.addMultiple=function(ir,er,tr,rr){check.assert(er.by instanceof Array&&er.by.length>1,'Multiple: "by" must be an array of two or more ids');var nr=this.getLookupTables(tr,rr,ir,2,!0)[0],sr=getSubstFormat(nr,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});check.assert(sr.coverage.format===1,"Multiple: unable to modify coverage table format "+sr.coverage.format);var ar=er.sub,or=this.binSearch(sr.coverage.glyphs,ar);or<0&&(or=-1-or,sr.coverage.glyphs.splice(or,0,ar),sr.sequences.splice(or,0,0)),sr.sequences[or]=er.by};Substitution.prototype.addAlternate=function(ir,er,tr,rr){var nr=this.getLookupTables(tr,rr,ir,3,!0)[0],sr=getSubstFormat(nr,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});check.assert(sr.coverage.format===1,"Alternate: unable to modify coverage table format "+sr.coverage.format);var ar=er.sub,or=this.binSearch(sr.coverage.glyphs,ar);or<0&&(or=-1-or,sr.coverage.glyphs.splice(or,0,ar),sr.alternateSets.splice(or,0,0)),sr.alternateSets[or]=er.by};Substitution.prototype.addLigature=function(ir,er,tr,rr){var nr=this.getLookupTables(tr,rr,ir,4,!0)[0],sr=nr.subtables[0];sr||(sr={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},nr.subtables[0]=sr),check.assert(sr.coverage.format===1,"Ligature: unable to modify coverage table format "+sr.coverage.format);var ar=er.sub[0],or=er.sub.slice(1),lr={ligGlyph:er.by,components:or},cr=this.binSearch(sr.coverage.glyphs,ar);if(cr>=0){for(var hr=sr.ligatureSets[cr],fr=0;fr<hr.length;fr++)if(arraysEqual(hr[fr].components,or))return;hr.push(lr)}else cr=-1-cr,sr.coverage.glyphs.splice(cr,0,ar),sr.ligatureSets.splice(cr,0,[lr])};Substitution.prototype.getFeature=function(ir,er,tr){if(/ss\d\d/.test(ir))return this.getSingle(ir,er,tr);switch(ir){case"aalt":case"salt":return this.getSingle(ir,er,tr).concat(this.getAlternates(ir,er,tr));case"dlig":case"liga":case"rlig":return this.getLigatures(ir,er,tr);case"ccmp":return this.getMultiple(ir,er,tr).concat(this.getLigatures(ir,er,tr));case"stch":return this.getMultiple(ir,er,tr)}};Substitution.prototype.add=function(ir,er,tr,rr){if(/ss\d\d/.test(ir))return this.addSingle(ir,er,tr,rr);switch(ir){case"aalt":case"salt":return typeof er.by=="number"?this.addSingle(ir,er,tr,rr):this.addAlternate(ir,er,tr,rr);case"dlig":case"liga":case"rlig":return this.addLigature(ir,er,tr,rr);case"ccmp":return er.by instanceof Array?this.addMultiple(ir,er,tr,rr):this.addLigature(ir,er,tr,rr)}};function checkArgument(ir,er){if(!ir)throw er}function parseGlyphCoordinate(ir,er,tr,rr,nr){var sr;return(er&rr)>0?(sr=ir.parseByte(),er&nr||(sr=-sr),sr=tr+sr):(er&nr)>0?sr=tr:sr=tr+ir.parseShort(),sr}function parseGlyph(ir,er,tr){var rr=new parse.Parser(er,tr);ir.numberOfContours=rr.parseShort(),ir._xMin=rr.parseShort(),ir._yMin=rr.parseShort(),ir._xMax=rr.parseShort(),ir._yMax=rr.parseShort();var nr,sr;if(ir.numberOfContours>0){for(var ar=ir.endPointIndices=[],or=0;or<ir.numberOfContours;or+=1)ar.push(rr.parseUShort());ir.instructionLength=rr.parseUShort(),ir.instructions=[];for(var lr=0;lr<ir.instructionLength;lr+=1)ir.instructions.push(rr.parseByte());var cr=ar[ar.length-1]+1;nr=[];for(var hr=0;hr<cr;hr+=1)if(sr=rr.parseByte(),nr.push(sr),(sr&8)>0)for(var fr=rr.parseByte(),ur=0;ur<fr;ur+=1)nr.push(sr),hr+=1;if(check.argument(nr.length===cr,"Bad flags."),ar.length>0){var pr=[],gr;if(cr>0){for(var _r=0;_r<cr;_r+=1)sr=nr[_r],gr={},gr.onCurve=!!(sr&1),gr.lastPointOfContour=ar.indexOf(_r)>=0,pr.push(gr);for(var mr=0,dr=0;dr<cr;dr+=1)sr=nr[dr],gr=pr[dr],gr.x=parseGlyphCoordinate(rr,sr,mr,2,16),mr=gr.x;for(var vr=0,Ar=0;Ar<cr;Ar+=1)sr=nr[Ar],gr=pr[Ar],gr.y=parseGlyphCoordinate(rr,sr,vr,4,32),vr=gr.y}ir.points=pr}else ir.points=[]}else if(ir.numberOfContours===0)ir.points=[];else{ir.isComposite=!0,ir.points=[],ir.components=[];for(var yr=!0;yr;){nr=rr.parseUShort();var wr={glyphIndex:rr.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(nr&1)>0?(nr&2)>0?(wr.dx=rr.parseShort(),wr.dy=rr.parseShort()):wr.matchedPoints=[rr.parseUShort(),rr.parseUShort()]:(nr&2)>0?(wr.dx=rr.parseChar(),wr.dy=rr.parseChar()):wr.matchedPoints=[rr.parseByte(),rr.parseByte()],(nr&8)>0?wr.xScale=wr.yScale=rr.parseF2Dot14():(nr&64)>0?(wr.xScale=rr.parseF2Dot14(),wr.yScale=rr.parseF2Dot14()):(nr&128)>0&&(wr.xScale=rr.parseF2Dot14(),wr.scale01=rr.parseF2Dot14(),wr.scale10=rr.parseF2Dot14(),wr.yScale=rr.parseF2Dot14()),ir.components.push(wr),yr=!!(nr&32)}if(nr&256){ir.instructionLength=rr.parseUShort(),ir.instructions=[];for(var br=0;br<ir.instructionLength;br+=1)ir.instructions.push(rr.parseByte())}}}function transformPoints(ir,er){for(var tr=[],rr=0;rr<ir.length;rr+=1){var nr=ir[rr],sr={x:er.xScale*nr.x+er.scale01*nr.y+er.dx,y:er.scale10*nr.x+er.yScale*nr.y+er.dy,onCurve:nr.onCurve,lastPointOfContour:nr.lastPointOfContour};tr.push(sr)}return tr}function getContours(ir){for(var er=[],tr=[],rr=0;rr<ir.length;rr+=1){var nr=ir[rr];tr.push(nr),nr.lastPointOfContour&&(er.push(tr),tr=[])}return check.argument(tr.length===0,"There are still points left in the current contour."),er}function getPath(ir){var er=new Path;if(!ir)return er;for(var tr=getContours(ir),rr=0;rr<tr.length;++rr){var nr=tr[rr],sr=null,ar=nr[nr.length-1],or=nr[0];if(ar.onCurve)er.moveTo(ar.x,ar.y);else if(or.onCurve)er.moveTo(or.x,or.y);else{var lr={x:(ar.x+or.x)*.5,y:(ar.y+or.y)*.5};er.moveTo(lr.x,lr.y)}for(var cr=0;cr<nr.length;++cr)if(sr=ar,ar=or,or=nr[(cr+1)%nr.length],ar.onCurve)er.lineTo(ar.x,ar.y);else{var hr=sr,fr=or;sr.onCurve||(hr={x:(ar.x+sr.x)*.5,y:(ar.y+sr.y)*.5}),or.onCurve||(fr={x:(ar.x+or.x)*.5,y:(ar.y+or.y)*.5}),er.quadraticCurveTo(ar.x,ar.y,fr.x,fr.y)}er.closePath()}return er}function buildPath(ir,er){if(er.isComposite)for(var tr=0;tr<er.components.length;tr+=1){var rr=er.components[tr],nr=ir.get(rr.glyphIndex);if(nr.getPath(),nr.points){var sr=void 0;if(rr.matchedPoints===void 0)sr=transformPoints(nr.points,rr);else{if(rr.matchedPoints[0]>er.points.length-1||rr.matchedPoints[1]>nr.points.length-1)throw Error("Matched points out of range in "+er.name);var ar=er.points[rr.matchedPoints[0]],or=nr.points[rr.matchedPoints[1]],lr={xScale:rr.xScale,scale01:rr.scale01,scale10:rr.scale10,yScale:rr.yScale,dx:0,dy:0};or=transformPoints([or],lr)[0],lr.dx=ar.x-or.x,lr.dy=ar.y-or.y,sr=transformPoints(nr.points,lr)}er.points=er.points.concat(sr)}}return getPath(er.points)}function parseGlyfTableAll(ir,er,tr,rr){for(var nr=new glyphset.GlyphSet(rr),sr=0;sr<tr.length-1;sr+=1){var ar=tr[sr],or=tr[sr+1];ar!==or?nr.push(sr,glyphset.ttfGlyphLoader(rr,sr,parseGlyph,ir,er+ar,buildPath)):nr.push(sr,glyphset.glyphLoader(rr,sr))}return nr}function parseGlyfTableOnLowMemory(ir,er,tr,rr){var nr=new glyphset.GlyphSet(rr);return rr._push=function(sr){var ar=tr[sr],or=tr[sr+1];ar!==or?nr.push(sr,glyphset.ttfGlyphLoader(rr,sr,parseGlyph,ir,er+ar,buildPath)):nr.push(sr,glyphset.glyphLoader(rr,sr))},nr}function parseGlyfTable(ir,er,tr,rr,nr){return nr.lowMemory?parseGlyfTableOnLowMemory(ir,er,tr,rr):parseGlyfTableAll(ir,er,tr,rr)}var glyf={getPath,parse:parseGlyfTable},instructionTable,exec,execGlyph,execComponent;function Hinting(ir){this.font=ir,this.getCommands=function(er){return glyf.getPath(er).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function roundOff(ir){return ir}function roundToGrid(ir){return Math.sign(ir)*Math.round(Math.abs(ir))}function roundToDoubleGrid(ir){return Math.sign(ir)*Math.round(Math.abs(ir*2))/2}function roundToHalfGrid(ir){return Math.sign(ir)*(Math.round(Math.abs(ir)+.5)-.5)}function roundUpToGrid(ir){return Math.sign(ir)*Math.ceil(Math.abs(ir))}function roundDownToGrid(ir){return Math.sign(ir)*Math.floor(Math.abs(ir))}var roundSuper=function(ir){var er=this.srPeriod,tr=this.srPhase,rr=this.srThreshold,nr=1;return ir<0&&(ir=-ir,nr=-1),ir+=rr-tr,ir=Math.trunc(ir/er)*er,ir+=tr,ir<0?tr*nr:ir*nr},xUnitVector={x:1,y:0,axis:"x",distance:function(ir,er,tr,rr){return(tr?ir.xo:ir.x)-(rr?er.xo:er.x)},interpolate:function(ir,er,tr,rr){var nr,sr,ar,or,lr,cr,hr;if(!rr||rr===this){if(nr=ir.xo-er.xo,sr=ir.xo-tr.xo,lr=er.x-er.xo,cr=tr.x-tr.xo,ar=Math.abs(nr),or=Math.abs(sr),hr=ar+or,hr===0){ir.x=ir.xo+(lr+cr)/2;return}ir.x=ir.xo+(lr*or+cr*ar)/hr;return}if(nr=rr.distance(ir,er,!0,!0),sr=rr.distance(ir,tr,!0,!0),lr=rr.distance(er,er,!1,!0),cr=rr.distance(tr,tr,!1,!0),ar=Math.abs(nr),or=Math.abs(sr),hr=ar+or,hr===0){xUnitVector.setRelative(ir,ir,(lr+cr)/2,rr,!0);return}xUnitVector.setRelative(ir,ir,(lr*or+cr*ar)/hr,rr,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(ir,er,tr,rr,nr){if(!rr||rr===this){ir.x=(nr?er.xo:er.x)+tr;return}var sr=nr?er.xo:er.x,ar=nr?er.yo:er.y,or=sr+tr*rr.x,lr=ar+tr*rr.y;ir.x=or+(ir.y-lr)/rr.normalSlope},slope:0,touch:function(ir){ir.xTouched=!0},touched:function(ir){return ir.xTouched},untouch:function(ir){ir.xTouched=!1}},yUnitVector={x:0,y:1,axis:"y",distance:function(ir,er,tr,rr){return(tr?ir.yo:ir.y)-(rr?er.yo:er.y)},interpolate:function(ir,er,tr,rr){var nr,sr,ar,or,lr,cr,hr;if(!rr||rr===this){if(nr=ir.yo-er.yo,sr=ir.yo-tr.yo,lr=er.y-er.yo,cr=tr.y-tr.yo,ar=Math.abs(nr),or=Math.abs(sr),hr=ar+or,hr===0){ir.y=ir.yo+(lr+cr)/2;return}ir.y=ir.yo+(lr*or+cr*ar)/hr;return}if(nr=rr.distance(ir,er,!0,!0),sr=rr.distance(ir,tr,!0,!0),lr=rr.distance(er,er,!1,!0),cr=rr.distance(tr,tr,!1,!0),ar=Math.abs(nr),or=Math.abs(sr),hr=ar+or,hr===0){yUnitVector.setRelative(ir,ir,(lr+cr)/2,rr,!0);return}yUnitVector.setRelative(ir,ir,(lr*or+cr*ar)/hr,rr,!0)},normalSlope:0,setRelative:function(ir,er,tr,rr,nr){if(!rr||rr===this){ir.y=(nr?er.yo:er.y)+tr;return}var sr=nr?er.xo:er.x,ar=nr?er.yo:er.y,or=sr+tr*rr.x,lr=ar+tr*rr.y;ir.y=lr+rr.normalSlope*(ir.x-or)},slope:Number.POSITIVE_INFINITY,touch:function(ir){ir.yTouched=!0},touched:function(ir){return ir.yTouched},untouch:function(ir){ir.yTouched=!1}};Object.freeze(xUnitVector);Object.freeze(yUnitVector);function UnitVector(ir,er){this.x=ir,this.y=er,this.axis=void 0,this.slope=er/ir,this.normalSlope=-ir/er,Object.freeze(this)}UnitVector.prototype.distance=function(ir,er,tr,rr){return this.x*xUnitVector.distance(ir,er,tr,rr)+this.y*yUnitVector.distance(ir,er,tr,rr)};UnitVector.prototype.interpolate=function(ir,er,tr,rr){var nr,sr,ar,or,lr,cr,hr;if(ar=rr.distance(ir,er,!0,!0),or=rr.distance(ir,tr,!0,!0),nr=rr.distance(er,er,!1,!0),sr=rr.distance(tr,tr,!1,!0),lr=Math.abs(ar),cr=Math.abs(or),hr=lr+cr,hr===0){this.setRelative(ir,ir,(nr+sr)/2,rr,!0);return}this.setRelative(ir,ir,(nr*cr+sr*lr)/hr,rr,!0)};UnitVector.prototype.setRelative=function(ir,er,tr,rr,nr){rr=rr||this;var sr=nr?er.xo:er.x,ar=nr?er.yo:er.y,or=sr+tr*rr.x,lr=ar+tr*rr.y,cr=rr.normalSlope,hr=this.slope,fr=ir.x,ur=ir.y;ir.x=(hr*fr-cr*or+lr-ur)/(hr-cr),ir.y=hr*(ir.x-fr)+ur};UnitVector.prototype.touch=function(ir){ir.xTouched=!0,ir.yTouched=!0};function getUnitVector(ir,er){var tr=Math.sqrt(ir*ir+er*er);return ir/=tr,er/=tr,ir===1&&er===0?xUnitVector:ir===0&&er===1?yUnitVector:new UnitVector(ir,er)}function HPoint(ir,er,tr,rr){this.x=this.xo=Math.round(ir*64)/64,this.y=this.yo=Math.round(er*64)/64,this.lastPointOfContour=tr,this.onCurve=rr,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}HPoint.prototype.nextTouched=function(ir){for(var er=this.nextPointOnContour;!ir.touched(er)&&er!==this;)er=er.nextPointOnContour;return er};HPoint.prototype.prevTouched=function(ir){for(var er=this.prevPointOnContour;!ir.touched(er)&&er!==this;)er=er.prevPointOnContour;return er};var HPZero=Object.freeze(new HPoint(0,0)),defaultState={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function State(ir,er){switch(this.env=ir,this.stack=[],this.prog=er,ir){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=xUnitVector,this.round=roundToGrid}}Hinting.prototype.exec=function(ir,er){if(typeof er!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var tr=this.font,rr=this._prepState;if(!rr||rr.ppem!==er){var nr=this._fpgmState;if(!nr){State.prototype=defaultState,nr=this._fpgmState=new State("fpgm",tr.tables.fpgm),nr.funcs=[],nr.font=tr,exports.DEBUG&&(console.log("---EXEC FPGM---"),nr.step=-1);try{exec(nr)}catch(cr){console.log("Hinting error in FPGM:"+cr),this._errorState=3;return}}State.prototype=nr,rr=this._prepState=new State("prep",tr.tables.prep),rr.ppem=er;var sr=tr.tables.cvt;if(sr)for(var ar=rr.cvt=new Array(sr.length),or=er/tr.unitsPerEm,lr=0;lr<sr.length;lr++)ar[lr]=sr[lr]*or;else rr.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),rr.step=-1);try{exec(rr)}catch(cr){this._errorState<2&&console.log("Hinting error in PREP:"+cr),this._errorState=2}}if(!(this._errorState>1))try{return execGlyph(ir,rr)}catch(cr){this._errorState<1&&(console.log("Hinting error:"+cr),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};execGlyph=function(ir,er){var tr=er.ppem/er.font.unitsPerEm,rr=tr,nr=ir.components,sr,ar,or;if(State.prototype=er,!nr)or=new State("glyf",ir.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),or.step=-1),execComponent(ir,or,tr,rr),ar=or.gZone;else{var lr=er.font;ar=[],sr=[];for(var cr=0;cr<nr.length;cr++){var hr=nr[cr],fr=lr.glyphs.get(hr.glyphIndex);or=new State("glyf",fr.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+cr+"---"),or.step=-1),execComponent(fr,or,tr,rr);for(var ur=Math.round(hr.dx*tr),pr=Math.round(hr.dy*rr),gr=or.gZone,_r=or.contours,mr=0;mr<gr.length;mr++){var dr=gr[mr];dr.xTouched=dr.yTouched=!1,dr.xo=dr.x=dr.x+ur,dr.yo=dr.y=dr.y+pr}var vr=ar.length;ar.push.apply(ar,gr);for(var Ar=0;Ar<_r.length;Ar++)sr.push(_r[Ar]+vr)}ir.instructions&&!or.inhibitGridFit&&(or=new State("glyf",ir.instructions),or.gZone=or.z0=or.z1=or.z2=ar,or.contours=sr,ar.push(new HPoint(0,0),new HPoint(Math.round(ir.advanceWidth*tr),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),or.step=-1),exec(or),ar.length-=2)}return ar};execComponent=function(ir,er,tr,rr){for(var nr=ir.points||[],sr=nr.length,ar=er.gZone=er.z0=er.z1=er.z2=[],or=er.contours=[],lr,cr=0;cr<sr;cr++)lr=nr[cr],ar[cr]=new HPoint(lr.x*tr,lr.y*rr,lr.lastPointOfContour,lr.onCurve);for(var hr,fr,ur=0;ur<sr;ur++)lr=ar[ur],hr||(hr=lr,or.push(ur)),lr.lastPointOfContour?(lr.nextPointOnContour=hr,hr.prevPointOnContour=lr,hr=void 0):(fr=ar[ur+1],lr.nextPointOnContour=fr,fr.prevPointOnContour=lr);if(!er.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",er.stack);for(var pr=0;pr<sr;pr++)console.log(pr,ar[pr].x,ar[pr].y)}if(ar.push(new HPoint(0,0),new HPoint(Math.round(ir.advanceWidth*tr),0)),exec(er),ar.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",er.stack);for(var gr=0;gr<sr;gr++)console.log(gr,ar[gr].x,ar[gr].y)}}};exec=function(ir){var er=ir.prog;if(er){var tr=er.length,rr;for(ir.ip=0;ir.ip<tr;ir.ip++){if(exports.DEBUG&&ir.step++,rr=instructionTable[er[ir.ip]],!rr)throw new Error("unknown instruction: 0x"+Number(er[ir.ip]).toString(16));rr(ir)}}};function initTZone(ir){for(var er=ir.tZone=new Array(ir.gZone.length),tr=0;tr<er.length;tr++)er[tr]=new HPoint(0,0)}function skip(ir,er){var tr=ir.prog,rr=ir.ip,nr=1,sr;do if(sr=tr[++rr],sr===88)nr++;else if(sr===89)nr--;else if(sr===64)rr+=tr[rr+1]+1;else if(sr===65)rr+=2*tr[rr+1]+1;else if(sr>=176&&sr<=183)rr+=sr-176+1;else if(sr>=184&&sr<=191)rr+=(sr-184+1)*2;else if(er&&nr===1&&sr===27)break;while(nr>0);ir.ip=rr}function SVTCA(ir,er){exports.DEBUG&&console.log(er.step,"SVTCA["+ir.axis+"]"),er.fv=er.pv=er.dpv=ir}function SPVTCA(ir,er){exports.DEBUG&&console.log(er.step,"SPVTCA["+ir.axis+"]"),er.pv=er.dpv=ir}function SFVTCA(ir,er){exports.DEBUG&&console.log(er.step,"SFVTCA["+ir.axis+"]"),er.fv=ir}function SPVTL(ir,er){var tr=er.stack,rr=tr.pop(),nr=tr.pop(),sr=er.z2[rr],ar=er.z1[nr];exports.DEBUG&&console.log("SPVTL["+ir+"]",rr,nr);var or,lr;ir?(or=sr.y-ar.y,lr=ar.x-sr.x):(or=ar.x-sr.x,lr=ar.y-sr.y),er.pv=er.dpv=getUnitVector(or,lr)}function SFVTL(ir,er){var tr=er.stack,rr=tr.pop(),nr=tr.pop(),sr=er.z2[rr],ar=er.z1[nr];exports.DEBUG&&console.log("SFVTL["+ir+"]",rr,nr);var or,lr;ir?(or=sr.y-ar.y,lr=ar.x-sr.x):(or=ar.x-sr.x,lr=ar.y-sr.y),er.fv=getUnitVector(or,lr)}function SPVFS(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"SPVFS[]",tr,rr),ir.pv=ir.dpv=getUnitVector(rr,tr)}function SFVFS(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"SPVFS[]",tr,rr),ir.fv=getUnitVector(rr,tr)}function GPV(ir){var er=ir.stack,tr=ir.pv;exports.DEBUG&&console.log(ir.step,"GPV[]"),er.push(tr.x*16384),er.push(tr.y*16384)}function GFV(ir){var er=ir.stack,tr=ir.fv;exports.DEBUG&&console.log(ir.step,"GFV[]"),er.push(tr.x*16384),er.push(tr.y*16384)}function SFVTPV(ir){ir.fv=ir.pv,exports.DEBUG&&console.log(ir.step,"SFVTPV[]")}function ISECT(ir){var er=ir.stack,tr=er.pop(),rr=er.pop(),nr=er.pop(),sr=er.pop(),ar=er.pop(),or=ir.z0,lr=ir.z1,cr=or[tr],hr=or[rr],fr=lr[nr],ur=lr[sr],pr=ir.z2[ar];exports.DEBUG&&console.log("ISECT[], ",tr,rr,nr,sr,ar);var gr=cr.x,_r=cr.y,mr=hr.x,dr=hr.y,vr=fr.x,Ar=fr.y,yr=ur.x,wr=ur.y,br=(gr-mr)*(Ar-wr)-(_r-dr)*(vr-yr),Sr=gr*dr-_r*mr,xr=vr*wr-Ar*yr;pr.x=(Sr*(vr-yr)-xr*(gr-mr))/br,pr.y=(Sr*(Ar-wr)-xr*(_r-dr))/br}function SRP0(ir){ir.rp0=ir.stack.pop(),exports.DEBUG&&console.log(ir.step,"SRP0[]",ir.rp0)}function SRP1(ir){ir.rp1=ir.stack.pop(),exports.DEBUG&&console.log(ir.step,"SRP1[]",ir.rp1)}function SRP2(ir){ir.rp2=ir.stack.pop(),exports.DEBUG&&console.log(ir.step,"SRP2[]",ir.rp2)}function SZP0(ir){var er=ir.stack.pop();switch(exports.DEBUG&&console.log(ir.step,"SZP0[]",er),ir.zp0=er,er){case 0:ir.tZone||initTZone(ir),ir.z0=ir.tZone;break;case 1:ir.z0=ir.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP1(ir){var er=ir.stack.pop();switch(exports.DEBUG&&console.log(ir.step,"SZP1[]",er),ir.zp1=er,er){case 0:ir.tZone||initTZone(ir),ir.z1=ir.tZone;break;case 1:ir.z1=ir.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP2(ir){var er=ir.stack.pop();switch(exports.DEBUG&&console.log(ir.step,"SZP2[]",er),ir.zp2=er,er){case 0:ir.tZone||initTZone(ir),ir.z2=ir.tZone;break;case 1:ir.z2=ir.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZPS(ir){var er=ir.stack.pop();switch(exports.DEBUG&&console.log(ir.step,"SZPS[]",er),ir.zp0=ir.zp1=ir.zp2=er,er){case 0:ir.tZone||initTZone(ir),ir.z0=ir.z1=ir.z2=ir.tZone;break;case 1:ir.z0=ir.z1=ir.z2=ir.gZone;break;default:throw new Error("Invalid zone pointer")}}function SLOOP(ir){ir.loop=ir.stack.pop(),exports.DEBUG&&console.log(ir.step,"SLOOP[]",ir.loop)}function RTG(ir){exports.DEBUG&&console.log(ir.step,"RTG[]"),ir.round=roundToGrid}function RTHG(ir){exports.DEBUG&&console.log(ir.step,"RTHG[]"),ir.round=roundToHalfGrid}function SMD(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"SMD[]",er),ir.minDis=er/64}function ELSE(ir){exports.DEBUG&&console.log(ir.step,"ELSE[]"),skip(ir,!1)}function JMPR(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"JMPR[]",er),ir.ip+=er-1}function SCVTCI(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"SCVTCI[]",er),ir.cvCutIn=er/64}function DUP(ir){var er=ir.stack;exports.DEBUG&&console.log(ir.step,"DUP[]"),er.push(er[er.length-1])}function POP(ir){exports.DEBUG&&console.log(ir.step,"POP[]"),ir.stack.pop()}function CLEAR(ir){exports.DEBUG&&console.log(ir.step,"CLEAR[]"),ir.stack.length=0}function SWAP(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"SWAP[]"),er.push(tr),er.push(rr)}function DEPTH(ir){var er=ir.stack;exports.DEBUG&&console.log(ir.step,"DEPTH[]"),er.push(er.length)}function LOOPCALL(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"LOOPCALL[]",tr,rr);var nr=ir.ip,sr=ir.prog;ir.prog=ir.funcs[tr];for(var ar=0;ar<rr;ar++)exec(ir),exports.DEBUG&&console.log(++ir.step,ar+1<rr?"next loopcall":"done loopcall",ar);ir.ip=nr,ir.prog=sr}function CALL(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"CALL[]",er);var tr=ir.ip,rr=ir.prog;ir.prog=ir.funcs[er],exec(ir),ir.ip=tr,ir.prog=rr,exports.DEBUG&&console.log(++ir.step,"returning from",er)}function CINDEX(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"CINDEX[]",tr),er.push(er[er.length-tr])}function MINDEX(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"MINDEX[]",tr),er.push(er.splice(er.length-tr,1)[0])}function FDEF(ir){if(ir.env!=="fpgm")throw new Error("FDEF not allowed here");var er=ir.stack,tr=ir.prog,rr=ir.ip,nr=er.pop(),sr=rr;for(exports.DEBUG&&console.log(ir.step,"FDEF[]",nr);tr[++rr]!==45;);ir.ip=rr,ir.funcs[nr]=tr.slice(sr+1,rr)}function MDAP(ir,er){var tr=er.stack.pop(),rr=er.z0[tr],nr=er.fv,sr=er.pv;exports.DEBUG&&console.log(er.step,"MDAP["+ir+"]",tr);var ar=sr.distance(rr,HPZero);ir&&(ar=er.round(ar)),nr.setRelative(rr,HPZero,ar,sr),nr.touch(rr),er.rp0=er.rp1=tr}function IUP(ir,er){var tr=er.z2,rr=tr.length-2,nr,sr,ar;exports.DEBUG&&console.log(er.step,"IUP["+ir.axis+"]");for(var or=0;or<rr;or++)nr=tr[or],!ir.touched(nr)&&(sr=nr.prevTouched(ir),sr!==nr&&(ar=nr.nextTouched(ir),sr===ar&&ir.setRelative(nr,nr,ir.distance(sr,sr,!1,!0),ir,!0),ir.interpolate(nr,sr,ar,ir)))}function SHP(ir,er){for(var tr=er.stack,rr=ir?er.rp1:er.rp2,nr=(ir?er.z0:er.z1)[rr],sr=er.fv,ar=er.pv,or=er.loop,lr=er.z2;or--;){var cr=tr.pop(),hr=lr[cr],fr=ar.distance(nr,nr,!1,!0);sr.setRelative(hr,hr,fr,ar),sr.touch(hr),exports.DEBUG&&console.log(er.step,(er.loop>1?"loop "+(er.loop-or)+": ":"")+"SHP["+(ir?"rp1":"rp2")+"]",cr)}er.loop=1}function SHC(ir,er){var tr=er.stack,rr=ir?er.rp1:er.rp2,nr=(ir?er.z0:er.z1)[rr],sr=er.fv,ar=er.pv,or=tr.pop(),lr=er.z2[er.contours[or]],cr=lr;exports.DEBUG&&console.log(er.step,"SHC["+ir+"]",or);var hr=ar.distance(nr,nr,!1,!0);do cr!==nr&&sr.setRelative(cr,cr,hr,ar),cr=cr.nextPointOnContour;while(cr!==lr)}function SHZ(ir,er){var tr=er.stack,rr=ir?er.rp1:er.rp2,nr=(ir?er.z0:er.z1)[rr],sr=er.fv,ar=er.pv,or=tr.pop();exports.DEBUG&&console.log(er.step,"SHZ["+ir+"]",or);var lr;switch(or){case 0:lr=er.tZone;break;case 1:lr=er.gZone;break;default:throw new Error("Invalid zone")}for(var cr,hr=ar.distance(nr,nr,!1,!0),fr=lr.length-2,ur=0;ur<fr;ur++)cr=lr[ur],sr.setRelative(cr,cr,hr,ar)}function SHPIX(ir){for(var er=ir.stack,tr=ir.loop,rr=ir.fv,nr=er.pop()/64,sr=ir.z2;tr--;){var ar=er.pop(),or=sr[ar];exports.DEBUG&&console.log(ir.step,(ir.loop>1?"loop "+(ir.loop-tr)+": ":"")+"SHPIX[]",ar,nr),rr.setRelative(or,or,nr),rr.touch(or)}ir.loop=1}function IP(ir){for(var er=ir.stack,tr=ir.rp1,rr=ir.rp2,nr=ir.loop,sr=ir.z0[tr],ar=ir.z1[rr],or=ir.fv,lr=ir.dpv,cr=ir.z2;nr--;){var hr=er.pop(),fr=cr[hr];exports.DEBUG&&console.log(ir.step,(ir.loop>1?"loop "+(ir.loop-nr)+": ":"")+"IP[]",hr,tr,"<->",rr),or.interpolate(fr,sr,ar,lr),or.touch(fr)}ir.loop=1}function MSIRP(ir,er){var tr=er.stack,rr=tr.pop()/64,nr=tr.pop(),sr=er.z1[nr],ar=er.z0[er.rp0],or=er.fv,lr=er.pv;or.setRelative(sr,ar,rr,lr),or.touch(sr),exports.DEBUG&&console.log(er.step,"MSIRP["+ir+"]",rr,nr),er.rp1=er.rp0,er.rp2=nr,ir&&(er.rp0=nr)}function ALIGNRP(ir){for(var er=ir.stack,tr=ir.rp0,rr=ir.z0[tr],nr=ir.loop,sr=ir.fv,ar=ir.pv,or=ir.z1;nr--;){var lr=er.pop(),cr=or[lr];exports.DEBUG&&console.log(ir.step,(ir.loop>1?"loop "+(ir.loop-nr)+": ":"")+"ALIGNRP[]",lr),sr.setRelative(cr,rr,0,ar),sr.touch(cr)}ir.loop=1}function RTDG(ir){exports.DEBUG&&console.log(ir.step,"RTDG[]"),ir.round=roundToDoubleGrid}function MIAP(ir,er){var tr=er.stack,rr=tr.pop(),nr=tr.pop(),sr=er.z0[nr],ar=er.fv,or=er.pv,lr=er.cvt[rr];exports.DEBUG&&console.log(er.step,"MIAP["+ir+"]",rr,"(",lr,")",nr);var cr=or.distance(sr,HPZero);ir&&(Math.abs(cr-lr)<er.cvCutIn&&(cr=lr),cr=er.round(cr)),ar.setRelative(sr,HPZero,cr,or),er.zp0===0&&(sr.xo=sr.x,sr.yo=sr.y),ar.touch(sr),er.rp0=er.rp1=nr}function NPUSHB(ir){var er=ir.prog,tr=ir.ip,rr=ir.stack,nr=er[++tr];exports.DEBUG&&console.log(ir.step,"NPUSHB[]",nr);for(var sr=0;sr<nr;sr++)rr.push(er[++tr]);ir.ip=tr}function NPUSHW(ir){var er=ir.ip,tr=ir.prog,rr=ir.stack,nr=tr[++er];exports.DEBUG&&console.log(ir.step,"NPUSHW[]",nr);for(var sr=0;sr<nr;sr++){var ar=tr[++er]<<8|tr[++er];ar&32768&&(ar=-((ar^65535)+1)),rr.push(ar)}ir.ip=er}function WS(ir){var er=ir.stack,tr=ir.store;tr||(tr=ir.store=[]);var rr=er.pop(),nr=er.pop();exports.DEBUG&&console.log(ir.step,"WS",rr,nr),tr[nr]=rr}function RS(ir){var er=ir.stack,tr=ir.store,rr=er.pop();exports.DEBUG&&console.log(ir.step,"RS",rr);var nr=tr&&tr[rr]||0;er.push(nr)}function WCVTP(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"WCVTP",tr,rr),ir.cvt[rr]=tr/64}function RCVT(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"RCVT",tr),er.push(ir.cvt[tr]*64)}function GC(ir,er){var tr=er.stack,rr=tr.pop(),nr=er.z2[rr];exports.DEBUG&&console.log(er.step,"GC["+ir+"]",rr),tr.push(er.dpv.distance(nr,HPZero,ir,!1)*64)}function MD(ir,er){var tr=er.stack,rr=tr.pop(),nr=tr.pop(),sr=er.z1[rr],ar=er.z0[nr],or=er.dpv.distance(ar,sr,ir,ir);exports.DEBUG&&console.log(er.step,"MD["+ir+"]",rr,nr,"->",or),er.stack.push(Math.round(or*64))}function MPPEM(ir){exports.DEBUG&&console.log(ir.step,"MPPEM[]"),ir.stack.push(ir.ppem)}function FLIPON(ir){exports.DEBUG&&console.log(ir.step,"FLIPON[]"),ir.autoFlip=!0}function LT(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"LT[]",tr,rr),er.push(rr<tr?1:0)}function LTEQ(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"LTEQ[]",tr,rr),er.push(rr<=tr?1:0)}function GT(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"GT[]",tr,rr),er.push(rr>tr?1:0)}function GTEQ(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"GTEQ[]",tr,rr),er.push(rr>=tr?1:0)}function EQ(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"EQ[]",tr,rr),er.push(tr===rr?1:0)}function NEQ(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"NEQ[]",tr,rr),er.push(tr!==rr?1:0)}function ODD(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"ODD[]",tr),er.push(Math.trunc(tr)%2?1:0)}function EVEN(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"EVEN[]",tr),er.push(Math.trunc(tr)%2?0:1)}function IF(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"IF[]",er),er||(skip(ir,!0),exports.DEBUG&&console.log(ir.step,"EIF[]"))}function EIF(ir){exports.DEBUG&&console.log(ir.step,"EIF[]")}function AND(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"AND[]",tr,rr),er.push(tr&&rr?1:0)}function OR(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"OR[]",tr,rr),er.push(tr||rr?1:0)}function NOT(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"NOT[]",tr),er.push(tr?0:1)}function DELTAP123(ir,er){var tr=er.stack,rr=tr.pop(),nr=er.fv,sr=er.pv,ar=er.ppem,or=er.deltaBase+(ir-1)*16,lr=er.deltaShift,cr=er.z0;exports.DEBUG&&console.log(er.step,"DELTAP["+ir+"]",rr,tr);for(var hr=0;hr<rr;hr++){var fr=tr.pop(),ur=tr.pop(),pr=or+((ur&240)>>4);if(pr===ar){var gr=(ur&15)-8;gr>=0&&gr++,exports.DEBUG&&console.log(er.step,"DELTAPFIX",fr,"by",gr*lr);var _r=cr[fr];nr.setRelative(_r,_r,gr*lr,sr)}}}function SDB(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"SDB[]",tr),ir.deltaBase=tr}function SDS(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"SDS[]",tr),ir.deltaShift=Math.pow(.5,tr)}function ADD(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"ADD[]",tr,rr),er.push(rr+tr)}function SUB(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"SUB[]",tr,rr),er.push(rr-tr)}function DIV(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"DIV[]",tr,rr),er.push(rr*64/tr)}function MUL(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"MUL[]",tr,rr),er.push(rr*tr/64)}function ABS(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"ABS[]",tr),er.push(Math.abs(tr))}function NEG(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"NEG[]",tr),er.push(-tr)}function FLOOR(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"FLOOR[]",tr),er.push(Math.floor(tr/64)*64)}function CEILING(ir){var er=ir.stack,tr=er.pop();exports.DEBUG&&console.log(ir.step,"CEILING[]",tr),er.push(Math.ceil(tr/64)*64)}function ROUND(ir,er){var tr=er.stack,rr=tr.pop();exports.DEBUG&&console.log(er.step,"ROUND[]"),tr.push(er.round(rr/64)*64)}function WCVTF(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"WCVTF[]",tr,rr),ir.cvt[rr]=tr*ir.ppem/ir.font.unitsPerEm}function DELTAC123(ir,er){var tr=er.stack,rr=tr.pop(),nr=er.ppem,sr=er.deltaBase+(ir-1)*16,ar=er.deltaShift;exports.DEBUG&&console.log(er.step,"DELTAC["+ir+"]",rr,tr);for(var or=0;or<rr;or++){var lr=tr.pop(),cr=tr.pop(),hr=sr+((cr&240)>>4);if(hr===nr){var fr=(cr&15)-8;fr>=0&&fr++;var ur=fr*ar;exports.DEBUG&&console.log(er.step,"DELTACFIX",lr,"by",ur),er.cvt[lr]+=ur}}}function SROUND(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"SROUND[]",er),ir.round=roundSuper;var tr;switch(er&192){case 0:tr=.5;break;case 64:tr=1;break;case 128:tr=2;break;default:throw new Error("invalid SROUND value")}switch(ir.srPeriod=tr,er&48){case 0:ir.srPhase=0;break;case 16:ir.srPhase=.25*tr;break;case 32:ir.srPhase=.5*tr;break;case 48:ir.srPhase=.75*tr;break;default:throw new Error("invalid SROUND value")}er&=15,er===0?ir.srThreshold=0:ir.srThreshold=(er/8-.5)*tr}function S45ROUND(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"S45ROUND[]",er),ir.round=roundSuper;var tr;switch(er&192){case 0:tr=Math.sqrt(2)/2;break;case 64:tr=Math.sqrt(2);break;case 128:tr=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(ir.srPeriod=tr,er&48){case 0:ir.srPhase=0;break;case 16:ir.srPhase=.25*tr;break;case 32:ir.srPhase=.5*tr;break;case 48:ir.srPhase=.75*tr;break;default:throw new Error("invalid S45ROUND value")}er&=15,er===0?ir.srThreshold=0:ir.srThreshold=(er/8-.5)*tr}function ROFF(ir){exports.DEBUG&&console.log(ir.step,"ROFF[]"),ir.round=roundOff}function RUTG(ir){exports.DEBUG&&console.log(ir.step,"RUTG[]"),ir.round=roundUpToGrid}function RDTG(ir){exports.DEBUG&&console.log(ir.step,"RDTG[]"),ir.round=roundDownToGrid}function SCANCTRL(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"SCANCTRL[]",er)}function SDPVTL(ir,er){var tr=er.stack,rr=tr.pop(),nr=tr.pop(),sr=er.z2[rr],ar=er.z1[nr];exports.DEBUG&&console.log(er.step,"SDPVTL["+ir+"]",rr,nr);var or,lr;ir?(or=sr.y-ar.y,lr=ar.x-sr.x):(or=ar.x-sr.x,lr=ar.y-sr.y),er.dpv=getUnitVector(or,lr)}function GETINFO(ir){var er=ir.stack,tr=er.pop(),rr=0;exports.DEBUG&&console.log(ir.step,"GETINFO[]",tr),tr&1&&(rr=35),tr&32&&(rr|=4096),er.push(rr)}function ROLL(ir){var er=ir.stack,tr=er.pop(),rr=er.pop(),nr=er.pop();exports.DEBUG&&console.log(ir.step,"ROLL[]"),er.push(rr),er.push(tr),er.push(nr)}function MAX(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"MAX[]",tr,rr),er.push(Math.max(rr,tr))}function MIN(ir){var er=ir.stack,tr=er.pop(),rr=er.pop();exports.DEBUG&&console.log(ir.step,"MIN[]",tr,rr),er.push(Math.min(rr,tr))}function SCANTYPE(ir){var er=ir.stack.pop();exports.DEBUG&&console.log(ir.step,"SCANTYPE[]",er)}function INSTCTRL(ir){var er=ir.stack.pop(),tr=ir.stack.pop();switch(exports.DEBUG&&console.log(ir.step,"INSTCTRL[]",er,tr),er){case 1:ir.inhibitGridFit=!!tr;return;case 2:ir.ignoreCvt=!!tr;return;default:throw new Error("invalid INSTCTRL[] selector")}}function PUSHB(ir,er){var tr=er.stack,rr=er.prog,nr=er.ip;exports.DEBUG&&console.log(er.step,"PUSHB["+ir+"]");for(var sr=0;sr<ir;sr++)tr.push(rr[++nr]);er.ip=nr}function PUSHW(ir,er){var tr=er.ip,rr=er.prog,nr=er.stack;exports.DEBUG&&console.log(er.ip,"PUSHW["+ir+"]");for(var sr=0;sr<ir;sr++){var ar=rr[++tr]<<8|rr[++tr];ar&32768&&(ar=-((ar^65535)+1)),nr.push(ar)}er.ip=tr}function MDRP_MIRP(ir,er,tr,rr,nr,sr){var ar=sr.stack,or=ir&&ar.pop(),lr=ar.pop(),cr=sr.rp0,hr=sr.z0[cr],fr=sr.z1[lr],ur=sr.minDis,pr=sr.fv,gr=sr.dpv,_r,mr,dr,vr;mr=_r=gr.distance(fr,hr,!0,!0),dr=mr>=0?1:-1,mr=Math.abs(mr),ir&&(vr=sr.cvt[or],rr&&Math.abs(mr-vr)<sr.cvCutIn&&(mr=vr)),tr&&mr<ur&&(mr=ur),rr&&(mr=sr.round(mr)),pr.setRelative(fr,hr,dr*mr,gr),pr.touch(fr),exports.DEBUG&&console.log(sr.step,(ir?"MIRP[":"MDRP[")+(er?"M":"m")+(tr?">":"_")+(rr?"R":"_")+(nr===0?"Gr":nr===1?"Bl":nr===2?"Wh":"")+"]",ir?or+"("+sr.cvt[or]+","+vr+")":"",lr,"(d =",_r,"->",dr*mr,")"),sr.rp1=sr.rp0,sr.rp2=lr,er&&(sr.rp0=lr)}instructionTable=[SVTCA.bind(void 0,yUnitVector),SVTCA.bind(void 0,xUnitVector),SPVTCA.bind(void 0,yUnitVector),SPVTCA.bind(void 0,xUnitVector),SFVTCA.bind(void 0,yUnitVector),SFVTCA.bind(void 0,xUnitVector),SPVTL.bind(void 0,0),SPVTL.bind(void 0,1),SFVTL.bind(void 0,0),SFVTL.bind(void 0,1),SPVFS,SFVFS,GPV,GFV,SFVTPV,ISECT,SRP0,SRP1,SRP2,SZP0,SZP1,SZP2,SZPS,SLOOP,RTG,RTHG,SMD,ELSE,JMPR,SCVTCI,void 0,void 0,DUP,POP,CLEAR,SWAP,DEPTH,CINDEX,MINDEX,void 0,void 0,void 0,LOOPCALL,CALL,FDEF,void 0,MDAP.bind(void 0,0),MDAP.bind(void 0,1),IUP.bind(void 0,yUnitVector),IUP.bind(void 0,xUnitVector),SHP.bind(void 0,0),SHP.bind(void 0,1),SHC.bind(void 0,0),SHC.bind(void 0,1),SHZ.bind(void 0,0),SHZ.bind(void 0,1),SHPIX,IP,MSIRP.bind(void 0,0),MSIRP.bind(void 0,1),ALIGNRP,RTDG,MIAP.bind(void 0,0),MIAP.bind(void 0,1),NPUSHB,NPUSHW,WS,RS,WCVTP,RCVT,GC.bind(void 0,0),GC.bind(void 0,1),void 0,MD.bind(void 0,0),MD.bind(void 0,1),MPPEM,void 0,FLIPON,void 0,void 0,LT,LTEQ,GT,GTEQ,EQ,NEQ,ODD,EVEN,IF,EIF,AND,OR,NOT,DELTAP123.bind(void 0,1),SDB,SDS,ADD,SUB,DIV,MUL,ABS,NEG,FLOOR,CEILING,ROUND.bind(void 0,0),ROUND.bind(void 0,1),ROUND.bind(void 0,2),ROUND.bind(void 0,3),void 0,void 0,void 0,void 0,WCVTF,DELTAP123.bind(void 0,2),DELTAP123.bind(void 0,3),DELTAC123.bind(void 0,1),DELTAC123.bind(void 0,2),DELTAC123.bind(void 0,3),SROUND,S45ROUND,void 0,void 0,ROFF,void 0,RUTG,RDTG,POP,POP,void 0,void 0,void 0,void 0,void 0,SCANCTRL,SDPVTL.bind(void 0,0),SDPVTL.bind(void 0,1),GETINFO,void 0,ROLL,MAX,MIN,SCANTYPE,INSTCTRL,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,PUSHB.bind(void 0,1),PUSHB.bind(void 0,2),PUSHB.bind(void 0,3),PUSHB.bind(void 0,4),PUSHB.bind(void 0,5),PUSHB.bind(void 0,6),PUSHB.bind(void 0,7),PUSHB.bind(void 0,8),PUSHW.bind(void 0,1),PUSHW.bind(void 0,2),PUSHW.bind(void 0,3),PUSHW.bind(void 0,4),PUSHW.bind(void 0,5),PUSHW.bind(void 0,6),PUSHW.bind(void 0,7),PUSHW.bind(void 0,8),MDRP_MIRP.bind(void 0,0,0,0,0,0),MDRP_MIRP.bind(void 0,0,0,0,0,1),MDRP_MIRP.bind(void 0,0,0,0,0,2),MDRP_MIRP.bind(void 0,0,0,0,0,3),MDRP_MIRP.bind(void 0,0,0,0,1,0),MDRP_MIRP.bind(void 0,0,0,0,1,1),MDRP_MIRP.bind(void 0,0,0,0,1,2),MDRP_MIRP.bind(void 0,0,0,0,1,3),MDRP_MIRP.bind(void 0,0,0,1,0,0),MDRP_MIRP.bind(void 0,0,0,1,0,1),MDRP_MIRP.bind(void 0,0,0,1,0,2),MDRP_MIRP.bind(void 0,0,0,1,0,3),MDRP_MIRP.bind(void 0,0,0,1,1,0),MDRP_MIRP.bind(void 0,0,0,1,1,1),MDRP_MIRP.bind(void 0,0,0,1,1,2),MDRP_MIRP.bind(void 0,0,0,1,1,3),MDRP_MIRP.bind(void 0,0,1,0,0,0),MDRP_MIRP.bind(void 0,0,1,0,0,1),MDRP_MIRP.bind(void 0,0,1,0,0,2),MDRP_MIRP.bind(void 0,0,1,0,0,3),MDRP_MIRP.bind(void 0,0,1,0,1,0),MDRP_MIRP.bind(void 0,0,1,0,1,1),MDRP_MIRP.bind(void 0,0,1,0,1,2),MDRP_MIRP.bind(void 0,0,1,0,1,3),MDRP_MIRP.bind(void 0,0,1,1,0,0),MDRP_MIRP.bind(void 0,0,1,1,0,1),MDRP_MIRP.bind(void 0,0,1,1,0,2),MDRP_MIRP.bind(void 0,0,1,1,0,3),MDRP_MIRP.bind(void 0,0,1,1,1,0),MDRP_MIRP.bind(void 0,0,1,1,1,1),MDRP_MIRP.bind(void 0,0,1,1,1,2),MDRP_MIRP.bind(void 0,0,1,1,1,3),MDRP_MIRP.bind(void 0,1,0,0,0,0),MDRP_MIRP.bind(void 0,1,0,0,0,1),MDRP_MIRP.bind(void 0,1,0,0,0,2),MDRP_MIRP.bind(void 0,1,0,0,0,3),MDRP_MIRP.bind(void 0,1,0,0,1,0),MDRP_MIRP.bind(void 0,1,0,0,1,1),MDRP_MIRP.bind(void 0,1,0,0,1,2),MDRP_MIRP.bind(void 0,1,0,0,1,3),MDRP_MIRP.bind(void 0,1,0,1,0,0),MDRP_MIRP.bind(void 0,1,0,1,0,1),MDRP_MIRP.bind(void 0,1,0,1,0,2),MDRP_MIRP.bind(void 0,1,0,1,0,3),MDRP_MIRP.bind(void 0,1,0,1,1,0),MDRP_MIRP.bind(void 0,1,0,1,1,1),MDRP_MIRP.bind(void 0,1,0,1,1,2),MDRP_MIRP.bind(void 0,1,0,1,1,3),MDRP_MIRP.bind(void 0,1,1,0,0,0),MDRP_MIRP.bind(void 0,1,1,0,0,1),MDRP_MIRP.bind(void 0,1,1,0,0,2),MDRP_MIRP.bind(void 0,1,1,0,0,3),MDRP_MIRP.bind(void 0,1,1,0,1,0),MDRP_MIRP.bind(void 0,1,1,0,1,1),MDRP_MIRP.bind(void 0,1,1,0,1,2),MDRP_MIRP.bind(void 0,1,1,0,1,3),MDRP_MIRP.bind(void 0,1,1,1,0,0),MDRP_MIRP.bind(void 0,1,1,1,0,1),MDRP_MIRP.bind(void 0,1,1,1,0,2),MDRP_MIRP.bind(void 0,1,1,1,0,3),MDRP_MIRP.bind(void 0,1,1,1,1,0),MDRP_MIRP.bind(void 0,1,1,1,1,1),MDRP_MIRP.bind(void 0,1,1,1,1,2),MDRP_MIRP.bind(void 0,1,1,1,1,3)];function Token(ir){this.char=ir,this.state={},this.activeState=null}function ContextRange(ir,er,tr){this.contextName=tr,this.startIndex=ir,this.endOffset=er}function ContextChecker(ir,er,tr){this.contextName=ir,this.openRange=null,this.ranges=[],this.checkStart=er,this.checkEnd=tr}function ContextParams(ir,er){this.context=ir,this.index=er,this.length=ir.length,this.current=ir[er],this.backtrack=ir.slice(0,er),this.lookahead=ir.slice(er+1)}function Event$1(ir){this.eventId=ir,this.subscribers=[]}function initializeCoreEvents(ir){var er=this,tr=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];tr.forEach(function(nr){Object.defineProperty(er.events,nr,{value:new Event$1(nr)})}),ir&&tr.forEach(function(nr){var sr=ir[nr];typeof sr=="function"&&er.events[nr].subscribe(sr)});var rr=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];rr.forEach(function(nr){er.events[nr].subscribe(er.updateContextsRanges)})}function Tokenizer(ir){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],initializeCoreEvents.call(this,ir)}Token.prototype.setState=function(ir,er){return this.state[ir]=er,this.activeState={key:ir,value:this.state[ir]},this.activeState};Token.prototype.getState=function(ir){return this.state[ir]||null};Tokenizer.prototype.inboundIndex=function(ir){return ir>=0&&ir<this.tokens.length};Tokenizer.prototype.composeRUD=function(ir){var er=this,tr=!0,rr=ir.map(function(sr){return er[sr[0]].apply(er,sr.slice(1).concat(tr))}),nr=function(sr){return typeof sr=="object"&&sr.hasOwnProperty("FAIL")};if(rr.every(nr))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:rr.filter(nr)};this.dispatch("composeRUD",[rr.filter(function(sr){return!nr(sr)})])};Tokenizer.prototype.replaceRange=function(ir,er,tr,rr){er=er!==null?er:this.tokens.length;var nr=tr.every(function(ar){return ar instanceof Token});if(!isNaN(ir)&&this.inboundIndex(ir)&&nr){var sr=this.tokens.splice.apply(this.tokens,[ir,er].concat(tr));return rr||this.dispatch("replaceToken",[ir,er,tr]),[sr,tr]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Tokenizer.prototype.replaceToken=function(ir,er,tr){if(!isNaN(ir)&&this.inboundIndex(ir)&&er instanceof Token){var rr=this.tokens.splice(ir,1,er);return tr||this.dispatch("replaceToken",[ir,er]),[rr[0],er]}else return{FAIL:"replaceToken: invalid token or index."}};Tokenizer.prototype.removeRange=function(ir,er,tr){er=isNaN(er)?this.tokens.length:er;var rr=this.tokens.splice(ir,er);return tr||this.dispatch("removeRange",[rr,ir,er]),rr};Tokenizer.prototype.removeToken=function(ir,er){if(!isNaN(ir)&&this.inboundIndex(ir)){var tr=this.tokens.splice(ir,1);return er||this.dispatch("removeToken",[tr,ir]),tr}else return{FAIL:"removeToken: invalid token index."}};Tokenizer.prototype.insertToken=function(ir,er,tr){var rr=ir.every(function(nr){return nr instanceof Token});return rr?(this.tokens.splice.apply(this.tokens,[er,0].concat(ir)),tr||this.dispatch("insertToken",[ir,er]),ir):{FAIL:"insertToken: invalid token(s)."}};Tokenizer.prototype.registerModifier=function(ir,er,tr){this.events.newToken.subscribe(function(rr,nr){var sr=[rr,nr],ar=er===null||er.apply(this,sr)===!0,or=[rr,nr];if(ar){var lr=tr.apply(this,or);rr.setState(ir,lr)}}),this.registeredModifiers.push(ir)};Event$1.prototype.subscribe=function(ir){return typeof ir=="function"?this.subscribers.push(ir)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Event$1.prototype.unsubscribe=function(ir){this.subscribers.splice(ir,1)};ContextParams.prototype.setCurrentIndex=function(ir){this.index=ir,this.current=this.context[ir],this.backtrack=this.context.slice(0,ir),this.lookahead=this.context.slice(ir+1)};ContextParams.prototype.get=function(ir){switch(!0){case ir===0:return this.current;case(ir<0&&Math.abs(ir)<=this.backtrack.length):return this.backtrack.slice(ir)[0];case(ir>0&&ir<=this.lookahead.length):return this.lookahead[ir-1];default:return null}};Tokenizer.prototype.rangeToText=function(ir){if(ir instanceof ContextRange)return this.getRangeTokens(ir).map(function(er){return er.char}).join("")};Tokenizer.prototype.getText=function(){return this.tokens.map(function(ir){return ir.char}).join("")};Tokenizer.prototype.getContext=function(ir){var er=this.registeredContexts[ir];return er||null};Tokenizer.prototype.on=function(ir,er){var tr=this.events[ir];return tr?tr.subscribe(er):null};Tokenizer.prototype.dispatch=function(ir,er){var tr=this,rr=this.events[ir];rr instanceof Event$1&&rr.subscribers.forEach(function(nr){nr.apply(tr,er||[])})};Tokenizer.prototype.registerContextChecker=function(ir,er,tr){if(this.getContext(ir))return{FAIL:"context name '"+ir+"' is already registered."};if(typeof er!="function")return{FAIL:"missing context start check."};if(typeof tr!="function")return{FAIL:"missing context end check."};var rr=new ContextChecker(ir,er,tr);return this.registeredContexts[ir]=rr,this.contextCheckers.push(rr),rr};Tokenizer.prototype.getRangeTokens=function(ir){var er=ir.startIndex+ir.endOffset;return[].concat(this.tokens.slice(ir.startIndex,er))};Tokenizer.prototype.getContextRanges=function(ir){var er=this.getContext(ir);return er?er.ranges:{FAIL:"context checker '"+ir+"' is not registered."}};Tokenizer.prototype.resetContextsRanges=function(){var ir=this.registeredContexts;for(var er in ir)if(ir.hasOwnProperty(er)){var tr=ir[er];tr.ranges=[]}};Tokenizer.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var ir=this.tokens.map(function(rr){return rr.char}),er=0;er<ir.length;er++){var tr=new ContextParams(ir,er);this.runContextCheck(tr)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Tokenizer.prototype.setEndOffset=function(ir,er){var tr=this.getContext(er).openRange.startIndex,rr=new ContextRange(tr,ir,er),nr=this.getContext(er).ranges;return rr.rangeId=er+"."+nr.length,nr.push(rr),this.getContext(er).openRange=null,rr};Tokenizer.prototype.runContextCheck=function(ir){var er=this,tr=ir.index;this.contextCheckers.forEach(function(rr){var nr=rr.contextName,sr=er.getContext(nr).openRange;if(!sr&&rr.checkStart(ir)&&(sr=new ContextRange(tr,null,nr),er.getContext(nr).openRange=sr,er.dispatch("contextStart",[nr,tr])),sr&&rr.checkEnd(ir)){var ar=tr-sr.startIndex+1,or=er.setEndOffset(ar,nr);er.dispatch("contextEnd",[nr,or])}})};Tokenizer.prototype.tokenize=function(ir){this.tokens=[],this.resetContextsRanges();var er=Array.from(ir);this.dispatch("start");for(var tr=0;tr<er.length;tr++){var rr=er[tr],nr=new ContextParams(er,tr);this.dispatch("next",[nr]),this.runContextCheck(nr);var sr=new Token(rr);this.tokens.push(sr),this.dispatch("newToken",[sr,nr])}return this.dispatch("end",[this.tokens]),this.tokens};function isArabicChar(ir){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(ir)}function isIsolatedArabicChar(ir){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(ir)}function isTashkeelArabicChar(ir){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(ir)}function isLatinChar(ir){return/[A-z]/.test(ir)}function isWhiteSpace(ir){return/\s/.test(ir)}function FeatureQuery(ir){this.font=ir,this.features={}}function SubstitutionAction(ir){this.id=ir.id,this.tag=ir.tag,this.substitution=ir.substitution}function lookupCoverage(ir,er){if(!ir)return-1;switch(er.format){case 1:return er.glyphs.indexOf(ir);case 2:for(var tr=er.ranges,rr=0;rr<tr.length;rr++){var nr=tr[rr];if(ir>=nr.start&&ir<=nr.end){var sr=ir-nr.start;return nr.index+sr}}break;default:return-1}return-1}function singleSubstitutionFormat1(ir,er){var tr=lookupCoverage(ir,er.coverage);return tr===-1?null:ir+er.deltaGlyphId}function singleSubstitutionFormat2(ir,er){var tr=lookupCoverage(ir,er.coverage);return tr===-1?null:er.substitute[tr]}function lookupCoverageList(ir,er){for(var tr=[],rr=0;rr<ir.length;rr++){var nr=ir[rr],sr=er.current;sr=Array.isArray(sr)?sr[0]:sr;var ar=lookupCoverage(sr,nr);ar!==-1&&tr.push(ar)}return tr.length!==ir.length?-1:tr}function chainingSubstitutionFormat3(ir,er){var tr=er.inputCoverage.length+er.lookaheadCoverage.length+er.backtrackCoverage.length;if(ir.context.length<tr)return[];var rr=lookupCoverageList(er.inputCoverage,ir);if(rr===-1)return[];var nr=er.inputCoverage.length-1;if(ir.lookahead.length<er.lookaheadCoverage.length)return[];for(var sr=ir.lookahead.slice(nr);sr.length&&isTashkeelArabicChar(sr[0].char);)sr.shift();var ar=new ContextParams(sr,0),or=lookupCoverageList(er.lookaheadCoverage,ar),lr=[].concat(ir.backtrack);for(lr.reverse();lr.length&&isTashkeelArabicChar(lr[0].char);)lr.shift();if(lr.length<er.backtrackCoverage.length)return[];var cr=new ContextParams(lr,0),hr=lookupCoverageList(er.backtrackCoverage,cr),fr=rr.length===er.inputCoverage.length&&or.length===er.lookaheadCoverage.length&&hr.length===er.backtrackCoverage.length,ur=[];if(fr)for(var pr=0;pr<er.lookupRecords.length;pr++)for(var gr=er.lookupRecords[pr],_r=gr.lookupListIndex,mr=this.getLookupByIndex(_r),dr=0;dr<mr.subtables.length;dr++){var vr=mr.subtables[dr],Ar=this.getLookupMethod(mr,vr),yr=this.getSubstitutionType(mr,vr);if(yr==="12")for(var wr=0;wr<rr.length;wr++){var br=ir.get(wr),Sr=Ar(br);Sr&&ur.push(Sr)}}return ur}function ligatureSubstitutionFormat1(ir,er){var tr=ir.current,rr=lookupCoverage(tr,er.coverage);if(rr===-1)return null;for(var nr,sr=er.ligatureSets[rr],ar=0;ar<sr.length;ar++){nr=sr[ar];for(var or=0;or<nr.components.length;or++){var lr=ir.lookahead[or],cr=nr.components[or];if(lr!==cr)break;if(or===nr.components.length-1)return nr}}return null}function decompositionSubstitutionFormat1(ir,er){var tr=lookupCoverage(ir,er.coverage);return tr===-1?null:er.sequences[tr]}FeatureQuery.prototype.getDefaultScriptFeaturesIndexes=function(){for(var ir=this.font.tables.gsub.scripts,er=0;er<ir.length;er++){var tr=ir[er];if(tr.tag==="DFLT")return tr.script.defaultLangSys.featureIndexes}return[]};FeatureQuery.prototype.getScriptFeaturesIndexes=function(ir){var er=this.font.tables;if(!er.gsub)return[];if(!ir)return this.getDefaultScriptFeaturesIndexes();for(var tr=this.font.tables.gsub.scripts,rr=0;rr<tr.length;rr++){var nr=tr[rr];if(nr.tag===ir&&nr.script.defaultLangSys)return nr.script.defaultLangSys.featureIndexes;var sr=nr.langSysRecords;if(sr)for(var ar=0;ar<sr.length;ar++){var or=sr[ar];if(or.tag===ir){var lr=or.langSys;return lr.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};FeatureQuery.prototype.mapTagsToFeatures=function(ir,er){for(var tr={},rr=0;rr<ir.length;rr++){var nr=ir[rr].tag,sr=ir[rr].feature;tr[nr]=sr}this.features[er].tags=tr};FeatureQuery.prototype.getScriptFeatures=function(ir){var er=this.features[ir];if(this.features.hasOwnProperty(ir))return er;var tr=this.getScriptFeaturesIndexes(ir);if(!tr)return null;var rr=this.font.tables.gsub;return er=tr.map(function(nr){return rr.features[nr]}),this.features[ir]=er,this.mapTagsToFeatures(er,ir),er};FeatureQuery.prototype.getSubstitutionType=function(ir,er){var tr=ir.lookupType.toString(),rr=er.substFormat.toString();return tr+rr};FeatureQuery.prototype.getLookupMethod=function(ir,er){var tr=this,rr=this.getSubstitutionType(ir,er);switch(rr){case"11":return function(nr){return singleSubstitutionFormat1.apply(tr,[nr,er])};case"12":return function(nr){return singleSubstitutionFormat2.apply(tr,[nr,er])};case"63":return function(nr){return chainingSubstitutionFormat3.apply(tr,[nr,er])};case"41":return function(nr){return ligatureSubstitutionFormat1.apply(tr,[nr,er])};case"21":return function(nr){return decompositionSubstitutionFormat1.apply(tr,[nr,er])};default:throw new Error("lookupType: "+ir.lookupType+" - substFormat: "+er.substFormat+" is not yet supported")}};FeatureQuery.prototype.lookupFeature=function(ir){var er=ir.contextParams,tr=er.index,rr=this.getFeature({tag:ir.tag,script:ir.script});if(!rr)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+ir.tag+"' for script '"+ir.script+"'.");for(var nr=this.getFeatureLookups(rr),sr=[].concat(er.context),ar=0;ar<nr.length;ar++)for(var or=nr[ar],lr=this.getLookupSubtables(or),cr=0;cr<lr.length;cr++){var hr=lr[cr],fr=this.getSubstitutionType(or,hr),ur=this.getLookupMethod(or,hr),pr=void 0;switch(fr){case"11":pr=ur(er.current),pr&&sr.splice(tr,1,new SubstitutionAction({id:11,tag:ir.tag,substitution:pr}));break;case"12":pr=ur(er.current),pr&&sr.splice(tr,1,new SubstitutionAction({id:12,tag:ir.tag,substitution:pr}));break;case"63":pr=ur(er),Array.isArray(pr)&&pr.length&&sr.splice(tr,1,new SubstitutionAction({id:63,tag:ir.tag,substitution:pr}));break;case"41":pr=ur(er),pr&&sr.splice(tr,1,new SubstitutionAction({id:41,tag:ir.tag,substitution:pr}));break;case"21":pr=ur(er.current),pr&&sr.splice(tr,1,new SubstitutionAction({id:21,tag:ir.tag,substitution:pr}));break}er=new ContextParams(sr,tr),!(Array.isArray(pr)&&!pr.length)&&(pr=null)}return sr.length?sr:null};FeatureQuery.prototype.supports=function(ir){if(!ir.script)return!1;this.getScriptFeatures(ir.script);var er=this.features.hasOwnProperty(ir.script);if(!ir.tag)return er;var tr=this.features[ir.script].some(function(rr){return rr.tag===ir.tag});return er&&tr};FeatureQuery.prototype.getLookupSubtables=function(ir){return ir.subtables||null};FeatureQuery.prototype.getLookupByIndex=function(ir){var er=this.font.tables.gsub.lookups;return er[ir]||null};FeatureQuery.prototype.getFeatureLookups=function(ir){return ir.lookupListIndexes.map(this.getLookupByIndex.bind(this))};FeatureQuery.prototype.getFeature=function ir(er){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(er.script)||this.getScriptFeatures(er.script);var tr=this.features[er.script];return tr?tr.tags[er.tag]?this.features[er.script].tags[er.tag]:null:{FAIL:"No feature for script "+er.script}};function arabicWordStartCheck(ir){var er=ir.current,tr=ir.get(-1);return tr===null&&isArabicChar(er)||!isArabicChar(tr)&&isArabicChar(er)}function arabicWordEndCheck(ir){var er=ir.get(1);return er===null||!isArabicChar(er)}var arabicWordCheck={startCheck:arabicWordStartCheck,endCheck:arabicWordEndCheck};function arabicSentenceStartCheck(ir){var er=ir.current,tr=ir.get(-1);return(isArabicChar(er)||isTashkeelArabicChar(er))&&!isArabicChar(tr)}function arabicSentenceEndCheck(ir){var er=ir.get(1);switch(!0){case er===null:return!0;case(!isArabicChar(er)&&!isTashkeelArabicChar(er)):var tr=isWhiteSpace(er);if(!tr)return!0;if(tr){var rr=!1;if(rr=ir.lookahead.some(function(nr){return isArabicChar(nr)||isTashkeelArabicChar(nr)}),!rr)return!0}break;default:return!1}}var arabicSentenceCheck={startCheck:arabicSentenceStartCheck,endCheck:arabicSentenceEndCheck};function singleSubstitutionFormat1$1(ir,er,tr){er[tr].setState(ir.tag,ir.substitution)}function singleSubstitutionFormat2$1(ir,er,tr){er[tr].setState(ir.tag,ir.substitution)}function chainingSubstitutionFormat3$1(ir,er,tr){ir.substitution.forEach(function(rr,nr){var sr=er[tr+nr];sr.setState(ir.tag,rr)})}function ligatureSubstitutionFormat1$1(ir,er,tr){var rr=er[tr];rr.setState(ir.tag,ir.substitution.ligGlyph);for(var nr=ir.substitution.components.length,sr=0;sr<nr;sr++)rr=er[tr+sr+1],rr.setState("deleted",!0)}var SUBSTITUTIONS={11:singleSubstitutionFormat1$1,12:singleSubstitutionFormat2$1,63:chainingSubstitutionFormat3$1,41:ligatureSubstitutionFormat1$1};function applySubstitution(ir,er,tr){ir instanceof SubstitutionAction&&SUBSTITUTIONS[ir.id]&&SUBSTITUTIONS[ir.id](ir,er,tr)}function willConnectPrev(ir){for(var er=[].concat(ir.backtrack),tr=er.length-1;tr>=0;tr--){var rr=er[tr],nr=isIsolatedArabicChar(rr),sr=isTashkeelArabicChar(rr);if(!nr&&!sr)return!0;if(nr)return!1}return!1}function willConnectNext(ir){if(isIsolatedArabicChar(ir.current))return!1;for(var er=0;er<ir.lookahead.length;er++){var tr=ir.lookahead[er],rr=isTashkeelArabicChar(tr);if(!rr)return!0}return!1}function arabicPresentationForms(ir){var er=this,tr="arab",rr=this.featuresTags[tr],nr=this.tokenizer.getRangeTokens(ir);if(nr.length!==1){var sr=new ContextParams(nr.map(function(or){return or.getState("glyphIndex")}),0),ar=new ContextParams(nr.map(function(or){return or.char}),0);nr.forEach(function(or,lr){if(!isTashkeelArabicChar(or.char)){sr.setCurrentIndex(lr),ar.setCurrentIndex(lr);var cr=0;willConnectPrev(ar)&&(cr|=1),willConnectNext(ar)&&(cr|=2);var hr;switch(cr){case 1:hr="fina";break;case 2:hr="init";break;case 3:hr="medi";break}if(rr.indexOf(hr)!==-1){var fr=er.query.lookupFeature({tag:hr,script:tr,contextParams:sr});if(fr instanceof Error)return console.info(fr.message);fr.forEach(function(ur,pr){ur instanceof SubstitutionAction&&(applySubstitution(ur,nr,pr),sr.context[pr]=ur.substitution)})}}})}}function getContextParams(ir,er){var tr=ir.map(function(rr){return rr.activeState.value});return new ContextParams(tr,er||0)}function arabicRequiredLigatures(ir){var er=this,tr="arab",rr=this.tokenizer.getRangeTokens(ir),nr=getContextParams(rr);nr.context.forEach(function(sr,ar){nr.setCurrentIndex(ar);var or=er.query.lookupFeature({tag:"rlig",script:tr,contextParams:nr});or.length&&(or.forEach(function(lr){return applySubstitution(lr,rr,ar)}),nr=getContextParams(rr))})}function latinWordStartCheck(ir){var er=ir.current,tr=ir.get(-1);return tr===null&&isLatinChar(er)||!isLatinChar(tr)&&isLatinChar(er)}function latinWordEndCheck(ir){var er=ir.get(1);return er===null||!isLatinChar(er)}var latinWordCheck={startCheck:latinWordStartCheck,endCheck:latinWordEndCheck};function getContextParams$1(ir,er){var tr=ir.map(function(rr){return rr.activeState.value});return new ContextParams(tr,er||0)}function latinLigature(ir){var er=this,tr="latn",rr=this.tokenizer.getRangeTokens(ir),nr=getContextParams$1(rr);nr.context.forEach(function(sr,ar){nr.setCurrentIndex(ar);var or=er.query.lookupFeature({tag:"liga",script:tr,contextParams:nr});or.length&&(or.forEach(function(lr){return applySubstitution(lr,rr,ar)}),nr=getContextParams$1(rr))})}function Bidi(ir){this.baseDir=ir||"ltr",this.tokenizer=new Tokenizer,this.featuresTags={}}Bidi.prototype.setText=function(ir){this.text=ir};Bidi.prototype.contextChecks={latinWordCheck,arabicWordCheck,arabicSentenceCheck};function registerContextChecker(ir){var er=this.contextChecks[ir+"Check"];return this.tokenizer.registerContextChecker(ir,er.startCheck,er.endCheck)}function tokenizeText(){return registerContextChecker.call(this,"latinWord"),registerContextChecker.call(this,"arabicWord"),registerContextChecker.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function reverseArabicSentences(){var ir=this,er=this.tokenizer.getContextRanges("arabicSentence");er.forEach(function(tr){var rr=ir.tokenizer.getRangeTokens(tr);ir.tokenizer.replaceRange(tr.startIndex,tr.endOffset,rr.reverse())})}Bidi.prototype.registerFeatures=function(ir,er){var tr=this,rr=er.filter(function(nr){return tr.query.supports({script:ir,tag:nr})});this.featuresTags.hasOwnProperty(ir)?this.featuresTags[ir]=this.featuresTags[ir].concat(rr):this.featuresTags[ir]=rr};Bidi.prototype.applyFeatures=function(ir,er){if(!ir)throw new Error("No valid font was provided to apply features");this.query||(this.query=new FeatureQuery(ir));for(var tr=0;tr<er.length;tr++){var rr=er[tr];this.query.supports({script:rr.script})&&this.registerFeatures(rr.script,rr.tags)}};Bidi.prototype.registerModifier=function(ir,er,tr){this.tokenizer.registerModifier(ir,er,tr)};function checkGlyphIndexStatus(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function applyArabicPresentationForms(){var ir=this,er="arab";if(this.featuresTags.hasOwnProperty(er)){checkGlyphIndexStatus.call(this);var tr=this.tokenizer.getContextRanges("arabicWord");tr.forEach(function(rr){arabicPresentationForms.call(ir,rr)})}}function applyArabicRequireLigatures(){var ir=this,er="arab";if(this.featuresTags.hasOwnProperty(er)){var tr=this.featuresTags[er];if(tr.indexOf("rlig")!==-1){checkGlyphIndexStatus.call(this);var rr=this.tokenizer.getContextRanges("arabicWord");rr.forEach(function(nr){arabicRequiredLigatures.call(ir,nr)})}}}function applyLatinLigatures(){var ir=this,er="latn";if(this.featuresTags.hasOwnProperty(er)){var tr=this.featuresTags[er];if(tr.indexOf("liga")!==-1){checkGlyphIndexStatus.call(this);var rr=this.tokenizer.getContextRanges("latinWord");rr.forEach(function(nr){latinLigature.call(ir,nr)})}}}Bidi.prototype.checkContextReady=function(ir){return!!this.tokenizer.getContext(ir)};Bidi.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(applyArabicPresentationForms.call(this),applyArabicRequireLigatures.call(this)),this.checkContextReady("latinWord")&&applyLatinLigatures.call(this),this.checkContextReady("arabicSentence")&&reverseArabicSentences.call(this)};Bidi.prototype.processText=function(ir){(!this.text||this.text!==ir)&&(this.setText(ir),tokenizeText.call(this),this.applyFeaturesToContexts())};Bidi.prototype.getBidiText=function(ir){return this.processText(ir),this.tokenizer.getText()};Bidi.prototype.getTextGlyphs=function(ir){this.processText(ir);for(var er=[],tr=0;tr<this.tokenizer.tokens.length;tr++){var rr=this.tokenizer.tokens[tr];if(!rr.state.deleted){var nr=rr.activeState.value;er.push(Array.isArray(nr)?nr[0]:nr)}}return er};function Font(ir){ir=ir||{},ir.tables=ir.tables||{},ir.empty||(checkArgument(ir.familyName,"When creating a new Font object, familyName is required."),checkArgument(ir.styleName,"When creating a new Font object, styleName is required."),checkArgument(ir.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),checkArgument(ir.ascender,"When creating a new Font object, ascender is required."),checkArgument(ir.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:ir.familyName||" "},fontSubfamily:{en:ir.styleName||" "},fullName:{en:ir.fullName||ir.familyName+" "+ir.styleName},postScriptName:{en:ir.postScriptName||(ir.familyName+ir.styleName).replace(/\s/g,"")},designer:{en:ir.designer||" "},designerURL:{en:ir.designerURL||" "},manufacturer:{en:ir.manufacturer||" "},manufacturerURL:{en:ir.manufacturerURL||" "},license:{en:ir.license||" "},licenseURL:{en:ir.licenseURL||" "},version:{en:ir.version||"Version 0.1"},description:{en:ir.description||" "},copyright:{en:ir.copyright||" "},trademark:{en:ir.trademark||" "}},this.unitsPerEm=ir.unitsPerEm||1e3,this.ascender=ir.ascender,this.descender=ir.descender,this.createdTimestamp=ir.createdTimestamp,this.tables=Object.assign(ir.tables,{os2:Object.assign({usWeightClass:ir.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:ir.widthClass||this.usWidthClasses.MEDIUM,fsSelection:ir.fsSelection||this.fsSelectionValues.REGULAR},ir.tables.os2)})),this.supported=!0,this.glyphs=new glyphset.GlyphSet(this,ir.glyphs||[]),this.encoding=new DefaultEncoding(this),this.position=new Position(this),this.substitution=new Substitution(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Hinting(this)}})}Font.prototype.hasChar=function(ir){return this.encoding.charToGlyphIndex(ir)!==null};Font.prototype.charToGlyphIndex=function(ir){return this.encoding.charToGlyphIndex(ir)};Font.prototype.charToGlyph=function(ir){var er=this.charToGlyphIndex(ir),tr=this.glyphs.get(er);return tr||(tr=this.glyphs.get(0)),tr};Font.prototype.updateFeatures=function(ir){return this.defaultRenderOptions.features.map(function(er){return er.script==="latn"?{script:"latn",tags:er.tags.filter(function(tr){return ir[tr]})}:er})};Font.prototype.stringToGlyphs=function(ir,er){var tr=this,rr=new Bidi,nr=function(fr){return tr.charToGlyphIndex(fr.char)};rr.registerModifier("glyphIndex",null,nr);var sr=er?this.updateFeatures(er.features):this.defaultRenderOptions.features;rr.applyFeatures(this,sr);for(var ar=rr.getTextGlyphs(ir),or=ar.length,lr=new Array(or),cr=this.glyphs.get(0),hr=0;hr<or;hr+=1)lr[hr]=this.glyphs.get(ar[hr])||cr;return lr};Font.prototype.nameToGlyphIndex=function(ir){return this.glyphNames.nameToGlyphIndex(ir)};Font.prototype.nameToGlyph=function(ir){var er=this.nameToGlyphIndex(ir),tr=this.glyphs.get(er);return tr||(tr=this.glyphs.get(0)),tr};Font.prototype.glyphIndexToName=function(ir){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(ir):""};Font.prototype.getKerningValue=function(ir,er){ir=ir.index||ir,er=er.index||er;var tr=this.position.defaultKerningTables;return tr?this.position.getKerningValue(tr,ir,er):this.kerningPairs[ir+","+er]||0};Font.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Font.prototype.forEachGlyph=function(ir,er,tr,rr,nr,sr){er=er!==void 0?er:0,tr=tr!==void 0?tr:0,rr=rr!==void 0?rr:72,nr=Object.assign({},this.defaultRenderOptions,nr);var ar=1/this.unitsPerEm*rr,or=this.stringToGlyphs(ir,nr),lr;if(nr.kerning){var cr=nr.script||this.position.getDefaultScriptName();lr=this.position.getKerningTables(cr,nr.language)}for(var hr=0;hr<or.length;hr+=1){var fr=or[hr];if(sr.call(this,fr,er,tr,rr,nr),fr.advanceWidth&&(er+=fr.advanceWidth*ar),nr.kerning&&hr<or.length-1){var ur=lr?this.position.getKerningValue(lr,fr.index,or[hr+1].index):this.getKerningValue(fr,or[hr+1]);er+=ur*ar}nr.letterSpacing?er+=nr.letterSpacing*rr:nr.tracking&&(er+=nr.tracking/1e3*rr)}return er};Font.prototype.getPath=function(ir,er,tr,rr,nr){var sr=new Path;return this.forEachGlyph(ir,er,tr,rr,nr,function(ar,or,lr,cr){var hr=ar.getPath(or,lr,cr,nr,this);sr.extend(hr)}),sr};Font.prototype.getPaths=function(ir,er,tr,rr,nr){var sr=[];return this.forEachGlyph(ir,er,tr,rr,nr,function(ar,or,lr,cr){var hr=ar.getPath(or,lr,cr,nr,this);sr.push(hr)}),sr};Font.prototype.getAdvanceWidth=function(ir,er,tr){return this.forEachGlyph(ir,0,0,er,tr,function(){})};Font.prototype.draw=function(ir,er,tr,rr,nr,sr){this.getPath(er,tr,rr,nr,sr).draw(ir)};Font.prototype.drawPoints=function(ir,er,tr,rr,nr,sr){this.forEachGlyph(er,tr,rr,nr,sr,function(ar,or,lr,cr){ar.drawPoints(ir,or,lr,cr)})};Font.prototype.drawMetrics=function(ir,er,tr,rr,nr,sr){this.forEachGlyph(er,tr,rr,nr,sr,function(ar,or,lr,cr){ar.drawMetrics(ir,or,lr,cr)})};Font.prototype.getEnglishName=function(ir){var er=this.names[ir];if(er)return er.en};Font.prototype.validate=function(){var ir=this;function er(rr,nr){}function tr(rr){var nr=ir.getEnglishName(rr);nr&&nr.trim().length>0}tr("fontFamily"),tr("weightName"),tr("manufacturer"),tr("copyright"),tr("version"),this.unitsPerEm>0};Font.prototype.toTables=function(){return sfnt.fontToTable(this)};Font.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Font.prototype.toArrayBuffer=function(){for(var ir=this.toTables(),er=ir.encode(),tr=new ArrayBuffer(er.length),rr=new Uint8Array(tr),nr=0;nr<er.length;nr++)rr[nr]=er[nr];return tr};Font.prototype.download=function(ir){var er=this.getEnglishName("fontFamily"),tr=this.getEnglishName("fontSubfamily");ir=ir||er.replace(/\s/g,"")+"-"+tr+".otf";var rr=this.toArrayBuffer();if(window.URL=window.URL||window.webkitURL,window.URL){var nr=new DataView(rr),sr=new Blob([nr],{type:"font/opentype"}),ar=document.createElement("a");ar.href=window.URL.createObjectURL(sr),ar.download=ir;var or=document.createEvent("MouseEvents");or.initEvent("click",!0,!1),ar.dispatchEvent(or)}else console.warn("Font file could not be downloaded. Try using a different browser.")};Font.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Font.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Font.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function addName(ir,er){var tr=JSON.stringify(ir),rr=256;for(var nr in er){var sr=parseInt(nr);if(!(!sr||sr<256)){if(JSON.stringify(er[nr])===tr)return sr;rr<=sr&&(rr=sr+1)}}return er[rr]=ir,rr}function makeFvarAxis(ir,er,tr){var rr=addName(er.name,tr);return[{name:"tag_"+ir,type:"TAG",value:er.tag},{name:"minValue_"+ir,type:"FIXED",value:er.minValue<<16},{name:"defaultValue_"+ir,type:"FIXED",value:er.defaultValue<<16},{name:"maxValue_"+ir,type:"FIXED",value:er.maxValue<<16},{name:"flags_"+ir,type:"USHORT",value:0},{name:"nameID_"+ir,type:"USHORT",value:rr}]}function parseFvarAxis(ir,er,tr){var rr={},nr=new parse.Parser(ir,er);return rr.tag=nr.parseTag(),rr.minValue=nr.parseFixed(),rr.defaultValue=nr.parseFixed(),rr.maxValue=nr.parseFixed(),nr.skip("uShort",1),rr.name=tr[nr.parseUShort()]||{},rr}function makeFvarInstance(ir,er,tr,rr){for(var nr=addName(er.name,rr),sr=[{name:"nameID_"+ir,type:"USHORT",value:nr},{name:"flags_"+ir,type:"USHORT",value:0}],ar=0;ar<tr.length;++ar){var or=tr[ar].tag;sr.push({name:"axis_"+ir+" "+or,type:"FIXED",value:er.coordinates[or]<<16})}return sr}function parseFvarInstance(ir,er,tr,rr){var nr={},sr=new parse.Parser(ir,er);nr.name=rr[sr.parseUShort()]||{},sr.skip("uShort",1),nr.coordinates={};for(var ar=0;ar<tr.length;++ar)nr.coordinates[tr[ar].tag]=sr.parseFixed();return nr}function makeFvarTable(ir,er){var tr=new table.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:ir.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:ir.instances.length},{name:"instanceSize",type:"USHORT",value:4+ir.axes.length*4}]);tr.offsetToData=tr.sizeOf();for(var rr=0;rr<ir.axes.length;rr++)tr.fields=tr.fields.concat(makeFvarAxis(rr,ir.axes[rr],er));for(var nr=0;nr<ir.instances.length;nr++)tr.fields=tr.fields.concat(makeFvarInstance(nr,ir.instances[nr],ir.axes,er));return tr}function parseFvarTable(ir,er,tr){var rr=new parse.Parser(ir,er),nr=rr.parseULong();check.argument(nr===65536,"Unsupported fvar table version.");var sr=rr.parseOffset16();rr.skip("uShort",1);for(var ar=rr.parseUShort(),or=rr.parseUShort(),lr=rr.parseUShort(),cr=rr.parseUShort(),hr=[],fr=0;fr<ar;fr++)hr.push(parseFvarAxis(ir,er+sr+fr*or,tr));for(var ur=[],pr=er+sr+ar*or,gr=0;gr<lr;gr++)ur.push(parseFvarInstance(ir,pr+gr*cr,hr,tr));return{axes:hr,instances:ur}}var fvar={make:makeFvarTable,parse:parseFvarTable},attachList=function(){return{coverage:this.parsePointer(Parser.coverage),attachPoints:this.parseList(Parser.pointer(Parser.uShortList))}},caretValue=function(){var ir=this.parseUShort();if(check.argument(ir===1||ir===2||ir===3,"Unsupported CaretValue table version."),ir===1)return{coordinate:this.parseShort()};if(ir===2)return{pointindex:this.parseShort()};if(ir===3)return{coordinate:this.parseShort()}},ligGlyph=function(){return this.parseList(Parser.pointer(caretValue))},ligCaretList=function(){return{coverage:this.parsePointer(Parser.coverage),ligGlyphs:this.parseList(Parser.pointer(ligGlyph))}},markGlyphSets=function(){return this.parseUShort(),this.parseList(Parser.pointer(Parser.coverage))};function parseGDEFTable(ir,er){er=er||0;var tr=new Parser(ir,er),rr=tr.parseVersion(1);check.argument(rr===1||rr===1.2||rr===1.3,"Unsupported GDEF table version.");var nr={version:rr,classDef:tr.parsePointer(Parser.classDef),attachList:tr.parsePointer(attachList),ligCaretList:tr.parsePointer(ligCaretList),markAttachClassDef:tr.parsePointer(Parser.classDef)};return rr>=1.2&&(nr.markGlyphSets=tr.parsePointer(markGlyphSets)),nr}var gdef={parse:parseGDEFTable},subtableParsers$1=new Array(10);subtableParsers$1[1]=function ir(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();if(tr===1)return{posFormat:1,coverage:this.parsePointer(Parser.coverage),value:this.parseValueRecord()};if(tr===2)return{posFormat:2,coverage:this.parsePointer(Parser.coverage),values:this.parseValueRecordList()};check.assert(!1,"0x"+er.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};subtableParsers$1[2]=function ir(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();check.assert(tr===1||tr===2,"0x"+er.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var rr=this.parsePointer(Parser.coverage),nr=this.parseUShort(),sr=this.parseUShort();if(tr===1)return{posFormat:tr,coverage:rr,valueFormat1:nr,valueFormat2:sr,pairSets:this.parseList(Parser.pointer(Parser.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(nr),value2:this.parseValueRecord(sr)}})))};if(tr===2){var ar=this.parsePointer(Parser.classDef),or=this.parsePointer(Parser.classDef),lr=this.parseUShort(),cr=this.parseUShort();return{posFormat:tr,coverage:rr,valueFormat1:nr,valueFormat2:sr,classDef1:ar,classDef2:or,class1Count:lr,class2Count:cr,classRecords:this.parseList(lr,Parser.list(cr,function(){return{value1:this.parseValueRecord(nr),value2:this.parseValueRecord(sr)}}))}}};subtableParsers$1[3]=function ir(){return{error:"GPOS Lookup 3 not supported"}};subtableParsers$1[4]=function ir(){return{error:"GPOS Lookup 4 not supported"}};subtableParsers$1[5]=function ir(){return{error:"GPOS Lookup 5 not supported"}};subtableParsers$1[6]=function ir(){return{error:"GPOS Lookup 6 not supported"}};subtableParsers$1[7]=function ir(){return{error:"GPOS Lookup 7 not supported"}};subtableParsers$1[8]=function ir(){return{error:"GPOS Lookup 8 not supported"}};subtableParsers$1[9]=function ir(){return{error:"GPOS Lookup 9 not supported"}};function parseGposTable(ir,er){er=er||0;var tr=new Parser(ir,er),rr=tr.parseVersion(1);return check.argument(rr===1||rr===1.1,"Unsupported GPOS table version "+rr),rr===1?{version:rr,scripts:tr.parseScriptList(),features:tr.parseFeatureList(),lookups:tr.parseLookupList(subtableParsers$1)}:{version:rr,scripts:tr.parseScriptList(),features:tr.parseFeatureList(),lookups:tr.parseLookupList(subtableParsers$1),variations:tr.parseFeatureVariationsList()}}var subtableMakers$1=new Array(10);function makeGposTable(ir){return new table.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(ir.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(ir.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(ir.lookups,subtableMakers$1)}])}var gpos={parse:parseGposTable,make:makeGposTable};function parseWindowsKernTable(ir){var er={};ir.skip("uShort");var tr=ir.parseUShort();check.argument(tr===0,"Unsupported kern sub-table version."),ir.skip("uShort",2);var rr=ir.parseUShort();ir.skip("uShort",3);for(var nr=0;nr<rr;nr+=1){var sr=ir.parseUShort(),ar=ir.parseUShort(),or=ir.parseShort();er[sr+","+ar]=or}return er}function parseMacKernTable(ir){var er={};ir.skip("uShort");var tr=ir.parseULong();tr>1&&console.warn("Only the first kern subtable is supported."),ir.skip("uLong");var rr=ir.parseUShort(),nr=rr&255;if(ir.skip("uShort"),nr===0){var sr=ir.parseUShort();ir.skip("uShort",3);for(var ar=0;ar<sr;ar+=1){var or=ir.parseUShort(),lr=ir.parseUShort(),cr=ir.parseShort();er[or+","+lr]=cr}}return er}function parseKernTable(ir,er){var tr=new parse.Parser(ir,er),rr=tr.parseUShort();if(rr===0)return parseWindowsKernTable(tr);if(rr===1)return parseMacKernTable(tr);throw new Error("Unsupported kern table version ("+rr+").")}var kern={parse:parseKernTable};function parseLocaTable(ir,er,tr,rr){for(var nr=new parse.Parser(ir,er),sr=rr?nr.parseUShort:nr.parseULong,ar=[],or=0;or<tr+1;or+=1){var lr=sr.call(nr);rr&&(lr*=2),ar.push(lr)}return ar}var loca={parse:parseLocaTable};function loadFromUrl(ir,er){var tr=new XMLHttpRequest;tr.open("get",ir,!0),tr.responseType="arraybuffer",tr.onload=function(){return tr.response?er(null,tr.response):er("Font could not be loaded: "+tr.statusText)},tr.onerror=function(){er("Font could not be loaded")},tr.send()}function parseOpenTypeTableEntries(ir,er){for(var tr=[],rr=12,nr=0;nr<er;nr+=1){var sr=parse.getTag(ir,rr),ar=parse.getULong(ir,rr+4),or=parse.getULong(ir,rr+8),lr=parse.getULong(ir,rr+12);tr.push({tag:sr,checksum:ar,offset:or,length:lr,compression:!1}),rr+=16}return tr}function parseWOFFTableEntries(ir,er){for(var tr=[],rr=44,nr=0;nr<er;nr+=1){var sr=parse.getTag(ir,rr),ar=parse.getULong(ir,rr+4),or=parse.getULong(ir,rr+8),lr=parse.getULong(ir,rr+12),cr=void 0;or<lr?cr="WOFF":cr=!1,tr.push({tag:sr,offset:ar,compression:cr,compressedLength:or,length:lr}),rr+=20}return tr}function uncompressTable(ir,er){if(er.compression==="WOFF"){var tr=new Uint8Array(ir.buffer,er.offset+2,er.compressedLength-2),rr=new Uint8Array(er.length);if(tinyInflate(tr,rr),rr.byteLength!==er.length)throw new Error("Decompression error: "+er.tag+" decompressed length doesn't match recorded length");var nr=new DataView(rr.buffer,0);return{data:nr,offset:0}}else return{data:ir,offset:er.offset}}function parseBuffer(ir,er){er=er??{};var tr,rr,nr=new Font({empty:!0}),sr=new DataView(ir,0),ar,or=[],lr=parse.getTag(sr,0);if(lr==="\0\0\0"||lr==="true"||lr==="typ1")nr.outlinesFormat="truetype",ar=parse.getUShort(sr,4),or=parseOpenTypeTableEntries(sr,ar);else if(lr==="OTTO")nr.outlinesFormat="cff",ar=parse.getUShort(sr,4),or=parseOpenTypeTableEntries(sr,ar);else if(lr==="wOFF"){var cr=parse.getTag(sr,4);if(cr==="\0\0\0")nr.outlinesFormat="truetype";else if(cr==="OTTO")nr.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+lr);ar=parse.getUShort(sr,12),or=parseWOFFTableEntries(sr,ar)}else throw new Error("Unsupported OpenType signature "+lr);for(var hr,fr,ur,pr,gr,_r,mr,dr,vr,Ar,yr,wr,br=0;br<ar;br+=1){var Sr=or[br],xr=void 0;switch(Sr.tag){case"cmap":xr=uncompressTable(sr,Sr),nr.tables.cmap=cmap.parse(xr.data,xr.offset),nr.encoding=new CmapEncoding(nr.tables.cmap);break;case"cvt ":xr=uncompressTable(sr,Sr),wr=new parse.Parser(xr.data,xr.offset),nr.tables.cvt=wr.parseShortList(Sr.length/2);break;case"fvar":fr=Sr;break;case"fpgm":xr=uncompressTable(sr,Sr),wr=new parse.Parser(xr.data,xr.offset),nr.tables.fpgm=wr.parseByteList(Sr.length);break;case"head":xr=uncompressTable(sr,Sr),nr.tables.head=head.parse(xr.data,xr.offset),nr.unitsPerEm=nr.tables.head.unitsPerEm,tr=nr.tables.head.indexToLocFormat;break;case"hhea":xr=uncompressTable(sr,Sr),nr.tables.hhea=hhea.parse(xr.data,xr.offset),nr.ascender=nr.tables.hhea.ascender,nr.descender=nr.tables.hhea.descender,nr.numberOfHMetrics=nr.tables.hhea.numberOfHMetrics;break;case"hmtx":mr=Sr;break;case"ltag":xr=uncompressTable(sr,Sr),rr=ltag.parse(xr.data,xr.offset);break;case"COLR":xr=uncompressTable(sr,Sr),nr.tables.colr=colr.parse(xr.data,xr.offset);break;case"CPAL":xr=uncompressTable(sr,Sr),nr.tables.cpal=cpal.parse(xr.data,xr.offset);break;case"maxp":xr=uncompressTable(sr,Sr),nr.tables.maxp=maxp.parse(xr.data,xr.offset),nr.numGlyphs=nr.tables.maxp.numGlyphs;break;case"name":Ar=Sr;break;case"OS/2":xr=uncompressTable(sr,Sr),nr.tables.os2=os2.parse(xr.data,xr.offset);break;case"post":xr=uncompressTable(sr,Sr),nr.tables.post=post.parse(xr.data,xr.offset),nr.glyphNames=new GlyphNames(nr.tables.post);break;case"prep":xr=uncompressTable(sr,Sr),wr=new parse.Parser(xr.data,xr.offset),nr.tables.prep=wr.parseByteList(Sr.length);break;case"glyf":ur=Sr;break;case"loca":vr=Sr;break;case"CFF ":hr=Sr;break;case"kern":dr=Sr;break;case"GDEF":pr=Sr;break;case"GPOS":gr=Sr;break;case"GSUB":_r=Sr;break;case"meta":yr=Sr;break}}var Cr=uncompressTable(sr,Ar);if(nr.tables.name=_name.parse(Cr.data,Cr.offset,rr),nr.names=nr.tables.name,ur&&vr){var Ir=tr===0,Rr=uncompressTable(sr,vr),Pr=loca.parse(Rr.data,Rr.offset,nr.numGlyphs,Ir),Fr=uncompressTable(sr,ur);nr.glyphs=glyf.parse(Fr.data,Fr.offset,Pr,nr,er)}else if(hr){var Nr=uncompressTable(sr,hr);cff.parse(Nr.data,Nr.offset,nr,er)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var Ur=uncompressTable(sr,mr);if(hmtx.parse(nr,Ur.data,Ur.offset,nr.numberOfHMetrics,nr.numGlyphs,nr.glyphs,er),addGlyphNames(nr,er),dr){var Br=uncompressTable(sr,dr);nr.kerningPairs=kern.parse(Br.data,Br.offset)}else nr.kerningPairs={};if(pr){var Or=uncompressTable(sr,pr);nr.tables.gdef=gdef.parse(Or.data,Or.offset)}if(gr){var Dr=uncompressTable(sr,gr);nr.tables.gpos=gpos.parse(Dr.data,Dr.offset),nr.position.init()}if(_r){var Wr=uncompressTable(sr,_r);nr.tables.gsub=gsub.parse(Wr.data,Wr.offset)}if(fr){var $r=uncompressTable(sr,fr);nr.tables.fvar=fvar.parse($r.data,$r.offset,nr.names)}if(yr){var Yr=uncompressTable(sr,yr);nr.tables.meta=meta.parse(Yr.data,Yr.offset),nr.metas=nr.tables.meta}return nr}function load(ir,er,tr){return tr=tr??{},new Promise(function(rr,nr){loadFromUrl(ir,function(sr,ar){if(sr){if(er)return er(sr);nr(sr)}var or;try{or=parseBuffer(ar,tr)}catch(lr){if(er)return er(lr,null);nr(lr)}if(er)return er(null,or);rr(or)})})}var opentype=Object.freeze({__proto__:null,Font,Glyph,Path,BoundingBox,_parse:parse,parse:parseBuffer,load});class TTFLoader extends Loader{constructor(er){super(er),this.reversed=!1}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){function tr(nr,sr){const ar=Math.round,or={},lr=1e5/((nr.unitsPerEm||2048)*72),cr=nr.encoding.cmap.glyphIndexMap,hr=Object.keys(cr);for(let fr=0;fr<hr.length;fr++){const ur=hr[fr],pr=nr.glyphs.glyphs[cr[ur]];if(ur!==void 0){const gr={ha:ar(pr.advanceWidth*lr),x_min:ar(pr.xMin*lr),x_max:ar(pr.xMax*lr),o:""};sr&&(pr.path.commands=rr(pr.path.commands)),pr.path.commands.forEach(function(_r){_r.type.toLowerCase()==="c"&&(_r.type="b"),gr.o+=_r.type.toLowerCase()+" ",_r.x!==void 0&&_r.y!==void 0&&(gr.o+=ar(_r.x*lr)+" "+ar(_r.y*lr)+" "),_r.x1!==void 0&&_r.y1!==void 0&&(gr.o+=ar(_r.x1*lr)+" "+ar(_r.y1*lr)+" "),_r.x2!==void 0&&_r.y2!==void 0&&(gr.o+=ar(_r.x2*lr)+" "+ar(_r.y2*lr)+" ")}),or[String.fromCodePoint(pr.unicode)]=gr}}return{glyphs:or,familyName:nr.getEnglishName("fullName"),ascender:ar(nr.ascender*lr),descender:ar(nr.descender*lr),underlinePosition:nr.tables.post.underlinePosition,underlineThickness:nr.tables.post.underlineThickness,boundingBox:{xMin:nr.tables.head.xMin,xMax:nr.tables.head.xMax,yMin:nr.tables.head.yMin,yMax:nr.tables.head.yMax},resolution:1e3,original_font_information:nr.tables.name}}function rr(nr){const sr=[];let ar;nr.forEach(function(lr){lr.type.toLowerCase()==="m"?(ar=[lr],sr.push(ar)):lr.type.toLowerCase()!=="z"&&ar.push(lr)});const or=[];return sr.forEach(function(lr){const cr={type:"m",x:lr[lr.length-1].x,y:lr[lr.length-1].y};or.push(cr);for(let hr=lr.length-1;hr>0;hr--){const fr=lr[hr],ur={type:fr.type};fr.x2!==void 0&&fr.y2!==void 0?(ur.x1=fr.x2,ur.y1=fr.y2,ur.x2=fr.x1,ur.y2=fr.y1):fr.x1!==void 0&&fr.y1!==void 0&&(ur.x1=fr.x1,ur.y1=fr.y1),ur.x=lr[hr-1].x,ur.y=lr[hr-1].y,or.push(ur)}}),or}return tr(opentype.parse(er),this.reversed)}}class USDAParser{parse(er){const tr={},rr=er.split(`
`);let nr=null,sr=tr;const ar=[tr];for(const or of rr)if(or.includes("=")){const lr=or.split("="),cr=lr[0].trim(),hr=lr[1].trim();if(hr.endsWith("{")){const fr={};ar.push(fr),sr[cr]=fr,sr=fr}else if(hr.endsWith("(")){const fr=hr.slice(0,-1);sr[cr]=fr;const ur={};ar.push(ur),sr=ur}else sr[cr]=hr}else if(or.endsWith("{")){const lr=sr[nr]||{};ar.push(lr),sr[nr]=lr,sr=lr}else if(or.endsWith("}")){if(ar.pop(),ar.length===0)continue;sr=ar[ar.length-1]}else if(or.endsWith("(")){const lr={};ar.push(lr),nr=or.split("(")[0].trim()||nr,sr[nr]=lr,sr=lr}else or.endsWith(")")?(ar.pop(),sr=ar[ar.length-1]):nr=or.trim();return tr}}class USDZLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr=new USDAParser;function rr(Cr){const Ir={};new FileLoader().setResponseType("arraybuffer");for(const Pr in Cr){if(Pr.endsWith("png")){const Fr=new Blob([Cr[Pr]],{type:{type:"image/png"}});Ir[Pr]=URL.createObjectURL(Fr)}if(Pr.endsWith("usd")||Pr.endsWith("usda")){if(nr(Cr[Pr]))throw Error("THREE.USDZLoader: Crate files (.usdc or binary .usd) are not supported.");const Fr=strFromU8(Cr[Pr]);Ir[Pr]=tr.parse(Fr)}}return Ir}function nr(Cr){const Ir=Cr.slice(0,7),Rr=new Uint8Array([80,88,82,45,85,83,68,67]);return Ir.every((Pr,Fr)=>Pr===Rr[Fr])}function sr(Cr){if(Cr.length<1)return;const Ir=Object.keys(Cr)[0];let Rr=!1;if(Ir.endsWith("usda"))return Cr[Ir];if(Ir.endsWith("usdc"))Rr=!0;else if(Ir.endsWith("usd"))if(nr(Cr[Ir]))Rr=!0;else return Cr[Ir];if(Rr)throw Error("THREE.USDZLoader: Crate files (.usdc or binary .usd) are not supported.")}const ar=unzipSync(new Uint8Array(er)),or=rr(ar),lr=sr(ar),cr=strFromU8(lr),hr=tr.parse(cr);function fr(Cr){if(Cr){if("prepend references"in Cr){const Rr=Cr["prepend references"].split("@"),Pr=Rr[1].replace(/^.\//,""),Fr=Rr[2].replace(/^<\//,"").replace(/>$/,"");return ur(or[Pr],Fr)}return ur(Cr)}}function ur(Cr,Ir){if(Cr){if(Ir!==void 0){const Rr=`def Mesh "${Ir}"`;if(Rr in Cr)return Cr[Rr]}for(const Rr in Cr){const Pr=Cr[Rr];if(Rr.startsWith("def Mesh"))return Pr;if(typeof Pr=="object"){const Fr=ur(Pr);if(Fr)return Fr}}}}function pr(Cr){if(!Cr)return;const Ir=new BufferGeometry;let Rr=null,Pr=null,Fr=null,Nr=-1;if("int[] faceVertexIndices"in Cr&&(Rr=JSON.parse(Cr["int[] faceVertexIndices"])),"int[] faceVertexCounts"in Cr&&(Pr=JSON.parse(Cr["int[] faceVertexCounts"]),Rr=gr(Rr,Pr)),"point3f[] points"in Cr){const Ur=JSON.parse(Cr["point3f[] points"].replace(/[()]*/g,""));Nr=Ur.length;let Br=new BufferAttribute(new Float32Array(Ur),3);Rr!==null&&(Br=_r(Br,Rr)),Ir.setAttribute("position",Br)}if("float2[] primvars:st"in Cr&&(Cr["texCoord2f[] primvars:st"]=Cr["float2[] primvars:st"]),"texCoord2f[] primvars:st"in Cr){Fr=JSON.parse(Cr["texCoord2f[] primvars:st"].replace(/[()]*/g,""));let Ur=new BufferAttribute(new Float32Array(Fr),2);Rr!==null&&(Ur=_r(Ur,Rr)),Ir.setAttribute("uv",Ur)}if("int[] primvars:st:indices"in Cr&&Fr!==null){const Ur=new BufferAttribute(new Float32Array(Fr),2);let Br=JSON.parse(Cr["int[] primvars:st:indices"]);Br=gr(Br,Pr),Ir.setAttribute("uv",_r(Ur,Br))}if("normal3f[] normals"in Cr){const Ur=JSON.parse(Cr["normal3f[] normals"].replace(/[()]*/g,""));let Br=new BufferAttribute(new Float32Array(Ur),3);if(Ur.length===Nr)Rr!==null&&(Br=_r(Br,Rr));else{let Or=Array.from(Array(Ur.length/3).keys());Or=gr(Or,Pr),Br=_r(Br,Or)}Ir.setAttribute("normal",Br)}else Ir.computeVertexNormals();return Ir}function gr(Cr,Ir){const Rr=[];for(let Pr=0;Pr<Ir.length;Pr++){const Fr=Ir[Pr],Nr=Pr*Fr;if(Fr===3){const Ur=Cr[Nr+0],Br=Cr[Nr+1],Or=Cr[Nr+2];Rr.push(Ur,Br,Or)}else if(Fr===4){const Ur=Cr[Nr+0],Br=Cr[Nr+1],Or=Cr[Nr+2],Dr=Cr[Nr+3];Rr.push(Ur,Br,Or),Rr.push(Ur,Or,Dr)}else console.warn("THREE.USDZLoader: Face vertex count of %s unsupported.",Fr)}return Rr}function _r(Cr,Ir){const Rr=Cr.array,Pr=Cr.itemSize,Fr=new Rr.constructor(Ir.length*Pr);let Nr=0,Ur=0;for(let Br=0,Or=Ir.length;Br<Or;Br++){Nr=Ir[Br]*Pr;for(let Dr=0;Dr<Pr;Dr++)Fr[Ur++]=Rr[Nr++]}return new BufferAttribute(Fr,Pr)}function mr(Cr){if(Cr){if("rel material:binding"in Cr){const Pr=Cr["rel material:binding"].replace(/^<\//,"").replace(/>$/,"").split("/");return dr(hr,` "${Pr[1]}"`)}return dr(Cr)}}function dr(Cr,Ir=""){for(const Rr in Cr){const Pr=Cr[Rr];if(Rr.startsWith("def Material"+Ir))return Pr;if(typeof Pr=="object"){const Fr=dr(Pr,Ir);if(Fr)return Fr}}}function vr(Cr,Ir){Ir["float inputs:rotation"]&&(Cr.rotation=parseFloat(Ir["float inputs:rotation"])),Ir["float2 inputs:scale"]&&(Cr.repeat=new Vector2().fromArray(JSON.parse("["+Ir["float2 inputs:scale"].replace(/[()]*/g,"")+"]"))),Ir["float2 inputs:translation"]&&(Cr.offset=new Vector2().fromArray(JSON.parse("["+Ir["float2 inputs:translation"].replace(/[()]*/g,"")+"]")))}function Ar(Cr){const Ir=new MeshPhysicalMaterial;if(Cr!==void 0){const Rr=Cr["token outputs:surface.connect"],Pr=/(\w+).output/.exec(Rr)[1],Fr=Cr[`def Shader "${Pr}"`];if(Fr!==void 0){if("color3f inputs:diffuseColor.connect"in Fr){const Nr=Fr["color3f inputs:diffuseColor.connect"],Ur=yr(hr,/(\w+).output/.exec(Nr)[1]);Ir.map=wr(Ur),Ir.map.colorSpace=SRGBColorSpace,'def Shader "Transform2d_diffuse"'in Cr&&vr(Ir.map,Cr['def Shader "Transform2d_diffuse"'])}else if("color3f inputs:diffuseColor"in Fr){const Nr=Fr["color3f inputs:diffuseColor"].replace(/[()]*/g,"");Ir.color.fromArray(JSON.parse("["+Nr+"]"))}if("color3f inputs:emissiveColor.connect"in Fr){const Nr=Fr["color3f inputs:emissiveColor.connect"],Ur=yr(hr,/(\w+).output/.exec(Nr)[1]);Ir.emissiveMap=wr(Ur),Ir.emissiveMap.colorSpace=SRGBColorSpace,Ir.emissive.set(16777215),'def Shader "Transform2d_emissive"'in Cr&&vr(Ir.emissiveMap,Cr['def Shader "Transform2d_emissive"'])}else if("color3f inputs:emissiveColor"in Fr){const Nr=Fr["color3f inputs:emissiveColor"].replace(/[()]*/g,"");Ir.emissive.fromArray(JSON.parse("["+Nr+"]"))}if("normal3f inputs:normal.connect"in Fr){const Nr=Fr["normal3f inputs:normal.connect"],Ur=yr(hr,/(\w+).output/.exec(Nr)[1]);Ir.normalMap=wr(Ur),Ir.normalMap.colorSpace=NoColorSpace,'def Shader "Transform2d_normal"'in Cr&&vr(Ir.normalMap,Cr['def Shader "Transform2d_normal"'])}if("float inputs:roughness.connect"in Fr){const Nr=Fr["float inputs:roughness.connect"],Ur=yr(hr,/(\w+).output/.exec(Nr)[1]);Ir.roughness=1,Ir.roughnessMap=wr(Ur),Ir.roughnessMap.colorSpace=NoColorSpace,'def Shader "Transform2d_roughness"'in Cr&&vr(Ir.roughnessMap,Cr['def Shader "Transform2d_roughness"'])}else"float inputs:roughness"in Fr&&(Ir.roughness=parseFloat(Fr["float inputs:roughness"]));if("float inputs:metallic.connect"in Fr){const Nr=Fr["float inputs:metallic.connect"],Ur=yr(hr,/(\w+).output/.exec(Nr)[1]);Ir.metalness=1,Ir.metalnessMap=wr(Ur),Ir.metalnessMap.colorSpace=NoColorSpace,'def Shader "Transform2d_metallic"'in Cr&&vr(Ir.metalnessMap,Cr['def Shader "Transform2d_metallic"'])}else"float inputs:metallic"in Fr&&(Ir.metalness=parseFloat(Fr["float inputs:metallic"]));if("float inputs:clearcoat.connect"in Fr){const Nr=Fr["float inputs:clearcoat.connect"],Ur=yr(hr,/(\w+).output/.exec(Nr)[1]);Ir.clearcoat=1,Ir.clearcoatMap=wr(Ur),Ir.clearcoatMap.colorSpace=NoColorSpace,'def Shader "Transform2d_clearcoat"'in Cr&&vr(Ir.clearcoatMap,Cr['def Shader "Transform2d_clearcoat"'])}else"float inputs:clearcoat"in Fr&&(Ir.clearcoat=parseFloat(Fr["float inputs:clearcoat"]));if("float inputs:clearcoatRoughness.connect"in Fr){const Nr=Fr["float inputs:clearcoatRoughness.connect"],Ur=yr(hr,/(\w+).output/.exec(Nr)[1]);Ir.clearcoatRoughness=1,Ir.clearcoatRoughnessMap=wr(Ur),Ir.clearcoatRoughnessMap.colorSpace=NoColorSpace,'def Shader "Transform2d_clearcoatRoughness"'in Cr&&vr(Ir.clearcoatRoughnessMap,Cr['def Shader "Transform2d_clearcoatRoughness"'])}else"float inputs:clearcoatRoughness"in Fr&&(Ir.clearcoatRoughness=parseFloat(Fr["float inputs:clearcoatRoughness"]));if("float inputs:ior"in Fr&&(Ir.ior=parseFloat(Fr["float inputs:ior"])),"float inputs:occlusion.connect"in Fr){const Nr=Fr["float inputs:occlusion.connect"],Ur=yr(hr,/(\w+).output/.exec(Nr)[1]);Ir.aoMap=wr(Ur),Ir.aoMap.colorSpace=NoColorSpace,'def Shader "Transform2d_occlusion"'in Cr&&vr(Ir.aoMap,Cr['def Shader "Transform2d_occlusion"'])}}}return Ir}function yr(Cr,Ir){for(const Rr in Cr){const Pr=Cr[Rr];if(Rr.startsWith(`def Shader "${Ir}"`))return Pr;if(typeof Pr=="object"){const Fr=yr(Pr,Ir);if(Fr)return Fr}}}function wr(Cr){if("asset inputs:file"in Cr){const Ir=Cr["asset inputs:file"].replace(/@*/g,"").trim(),Pr=new TextureLoader().load(or[Ir]),Fr={'"clamp"':ClampToEdgeWrapping,'"mirror"':MirroredRepeatWrapping,'"repeat"':RepeatWrapping};return"token inputs:wrapS"in Cr&&(Pr.wrapS=Fr[Cr["token inputs:wrapS"]]),"token inputs:wrapT"in Cr&&(Pr.wrapT=Fr[Cr["token inputs:wrapT"]]),Pr}return null}function br(Cr){const Ir=pr(fr(Cr)),Rr=Ar(mr(Cr)),Pr=Ir?new Mesh(Ir,Rr):new Object3D;if("matrix4d xformOp:transform"in Cr){const Fr=JSON.parse("["+Cr["matrix4d xformOp:transform"].replace(/[()]*/g,"")+"]");Pr.matrix.fromArray(Fr),Pr.matrix.decompose(Pr.position,Pr.quaternion,Pr.scale)}return Pr}function Sr(Cr,Ir){for(const Rr in Cr)if(Rr.startsWith("def Scope"))Sr(Cr[Rr],Ir);else if(Rr.startsWith("def Xform")){const Pr=br(Cr[Rr]);/def Xform "(\w+)"/.test(Rr)&&(Pr.name=/def Xform "(\w+)"/.exec(Rr)[1]),Ir.add(Pr),Sr(Cr[Rr],Pr)}}const xr=new Group;return Sr(hr,xr),xr}}class VOXLoader extends Loader{load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr=new DataView(er),rr=tr.getUint32(0,!0),nr=tr.getUint32(4,!0);if(rr!==542658390){console.error("THREE.VOXLoader: Invalid VOX file.");return}if(nr!==150){console.error("THREE.VOXLoader: Invalid VOX file. Unsupported version:",nr);return}const sr=[0,4294967295,4291624959,4288282623,4284940287,4281597951,4278255615,4294954239,4291611903,4288269567,4284927231,4281584895,4278242559,4294941183,4291598847,4288256511,4284914175,4281571839,4278229503,4294928127,4291585791,4288243455,4284901119,4281558783,4278216447,4294915071,4291572735,4288230399,4284888063,4281545727,4278203391,4294902015,4291559679,4288217343,4284875007,4281532671,4278190335,4294967244,4291624908,4288282572,4284940236,4281597900,4278255564,4294954188,4291611852,4288269516,4284927180,4281584844,4278242508,4294941132,4291598796,4288256460,4284914124,4281571788,4278229452,4294928076,4291585740,4288243404,4284901068,4281558732,4278216396,4294915020,4291572684,4288230348,4284888012,4281545676,4278203340,4294901964,4291559628,4288217292,4284874956,4281532620,4278190284,4294967193,4291624857,4288282521,4284940185,4281597849,4278255513,4294954137,4291611801,4288269465,4284927129,4281584793,4278242457,4294941081,4291598745,4288256409,4284914073,4281571737,4278229401,4294928025,4291585689,4288243353,4284901017,4281558681,4278216345,4294914969,4291572633,4288230297,4284887961,4281545625,4278203289,4294901913,4291559577,4288217241,4284874905,4281532569,4278190233,4294967142,4291624806,4288282470,4284940134,4281597798,4278255462,4294954086,4291611750,4288269414,4284927078,4281584742,4278242406,4294941030,4291598694,4288256358,4284914022,4281571686,4278229350,4294927974,4291585638,4288243302,4284900966,4281558630,4278216294,4294914918,4291572582,4288230246,4284887910,4281545574,4278203238,4294901862,4291559526,4288217190,4284874854,4281532518,4278190182,4294967091,4291624755,4288282419,4284940083,4281597747,4278255411,4294954035,4291611699,4288269363,4284927027,4281584691,4278242355,4294940979,4291598643,4288256307,4284913971,4281571635,4278229299,4294927923,4291585587,4288243251,4284900915,4281558579,4278216243,4294914867,4291572531,4288230195,4284887859,4281545523,4278203187,4294901811,4291559475,4288217139,4284874803,4281532467,4278190131,4294967040,4291624704,4288282368,4284940032,4281597696,4278255360,4294953984,4291611648,4288269312,4284926976,4281584640,4278242304,4294940928,4291598592,4288256256,4284913920,4281571584,4278229248,4294927872,4291585536,4288243200,4284900864,4281558528,4278216192,4294914816,4291572480,4288230144,4284887808,4281545472,4278203136,4294901760,4291559424,4288217088,4284874752,4281532416,4278190318,4278190301,4278190267,4278190250,4278190216,4278190199,4278190165,4278190148,4278190114,4278190097,4278251008,4278246656,4278237952,4278233600,4278224896,4278220544,4278211840,4278207488,4278198784,4278194432,4293787648,4292673536,4290445312,4289331200,4287102976,4285988864,4283760640,4282646528,4280418304,4279304192,4293848814,4292730333,4290493371,4289374890,4287137928,4286019447,4283782485,4282664004,4280427042,4279308561];let ar=8,or;const lr=[];for(;ar<tr.byteLength;){let cr="";for(let fr=0;fr<4;fr++)cr+=String.fromCharCode(tr.getUint8(ar++));const hr=tr.getUint32(ar,!0);if(ar+=4,ar+=4,cr==="SIZE"){const fr=tr.getUint32(ar,!0);ar+=4;const ur=tr.getUint32(ar,!0);ar+=4;const pr=tr.getUint32(ar,!0);ar+=4,or={palette:sr,size:{x:fr,y:ur,z:pr}},lr.push(or),ar+=hr-3*4}else if(cr==="XYZI"){const fr=tr.getUint32(ar,!0);ar+=4,or.data=new Uint8Array(er,ar,fr*4),ar+=fr*4}else if(cr==="RGBA"){const fr=[0];for(let ur=0;ur<256;ur++)fr[ur+1]=tr.getUint32(ar,!0),ar+=4;or.palette=fr}else ar+=hr}return lr}}class VOXMesh extends Mesh{constructor(er){const tr=er.data,rr=er.size,nr=er.palette,sr=[],ar=[],or=[0,0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,0,1],lr=[1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0],cr=[0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1],hr=[0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,0,1,0],fr=[0,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,0,0],ur=[0,1,1,1,1,1,0,1,0,1,1,0,0,1,0,1,1,1],pr=new Color;function gr(wr,br,Sr,xr,Cr,Ir,Rr){br-=rr.x/2,Sr-=rr.z/2,xr+=rr.y/2;for(let Pr=0;Pr<18;Pr+=3)pr.setRGB(Cr,Ir,Rr,SRGBColorSpace),sr.push(wr[Pr+0]+br,wr[Pr+1]+Sr,wr[Pr+2]+xr),ar.push(pr.r,pr.g,pr.b)}const _r=rr.x,mr=rr.x*rr.y,dr=new Uint8Array(rr.x*rr.y*rr.z);for(let wr=0;wr<tr.length;wr+=4){const br=tr[wr+0],Sr=tr[wr+1],xr=tr[wr+2],Cr=br+Sr*_r+xr*mr;dr[Cr]=255}let vr=!1;for(let wr=0;wr<tr.length;wr+=4){const br=tr[wr+0],Sr=tr[wr+1],xr=tr[wr+2],Cr=tr[wr+3],Ir=nr[Cr],Rr=(Ir>>0&255)/255,Pr=(Ir>>8&255)/255,Fr=(Ir>>16&255)/255;(Rr>0||Pr>0||Fr>0)&&(vr=!0);const Nr=br+Sr*_r+xr*mr;(dr[Nr+1]===0||br===rr.x-1)&&gr(lr,br,xr,-Sr,Rr,Pr,Fr),(dr[Nr-1]===0||br===0)&&gr(or,br,xr,-Sr,Rr,Pr,Fr),(dr[Nr+_r]===0||Sr===rr.y-1)&&gr(hr,br,xr,-Sr,Rr,Pr,Fr),(dr[Nr-_r]===0||Sr===0)&&gr(cr,br,xr,-Sr,Rr,Pr,Fr),(dr[Nr+mr]===0||xr===rr.z-1)&&gr(ur,br,xr,-Sr,Rr,Pr,Fr),(dr[Nr-mr]===0||xr===0)&&gr(fr,br,xr,-Sr,Rr,Pr,Fr)}const Ar=new BufferGeometry;Ar.setAttribute("position",new Float32BufferAttribute(sr,3)),Ar.computeVertexNormals();const yr=new MeshStandardMaterial;vr&&(Ar.setAttribute("color",new Float32BufferAttribute(ar,3)),yr.vertexColors=!0),super(Ar,yr)}}class VOXData3DTexture extends Data3DTexture{constructor(er){const tr=er.data,rr=er.size,nr=rr.x,sr=rr.x*rr.y,ar=new Uint8Array(rr.x*rr.y*rr.z);for(let or=0;or<tr.length;or+=4){const lr=tr[or+0],cr=tr[or+1],hr=tr[or+2],fr=lr+cr*nr+hr*sr;ar[fr]=255}super(ar,rr.x,rr.y,rr.z),this.format=RedFormat,this.minFilter=NearestFilter,this.magFilter=LinearFilter,this.unpackAlignment=1,this.needsUpdate=!0}}/*! chevrotain - v9.0.1 */var R$1=(ir,er)=>()=>(er||(er={exports:{}},ir(er.exports,er)),er.exports),Er=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.VERSION=void 0,ir.VERSION="9.0.1"}),k=R$1((exports,module)=>{"use strict";var __spreadArray=exports&&exports.__spreadArray||function(ir,er){for(var tr=0,rr=er.length,nr=ir.length;tr<rr;tr++,nr++)ir[nr]=er[tr];return ir};Object.defineProperty(exports,"__esModule",{value:!0}),exports.toFastProperties=exports.timer=exports.peek=exports.isES2015MapSupported=exports.PRINT_WARNING=exports.PRINT_ERROR=exports.packArray=exports.IDENTITY=exports.NOOP=exports.merge=exports.groupBy=exports.defaults=exports.assignNoOverwrite=exports.assign=exports.zipObject=exports.sortBy=exports.indexOf=exports.some=exports.difference=exports.every=exports.isObject=exports.isRegExp=exports.isArray=exports.partial=exports.uniq=exports.compact=exports.reduce=exports.findAll=exports.find=exports.cloneObj=exports.cloneArr=exports.contains=exports.has=exports.pick=exports.reject=exports.filter=exports.dropRight=exports.drop=exports.isFunction=exports.isUndefined=exports.isString=exports.forEach=exports.last=exports.first=exports.flatten=exports.map=exports.mapValues=exports.values=exports.keys=exports.isEmpty=void 0;function isEmpty(ir){return ir&&ir.length===0}exports.isEmpty=isEmpty;function keys(ir){return ir==null?[]:Object.keys(ir)}exports.keys=keys;function values(ir){for(var er=[],tr=Object.keys(ir),rr=0;rr<tr.length;rr++)er.push(ir[tr[rr]]);return er}exports.values=values;function mapValues(ir,er){for(var tr=[],rr=keys(ir),nr=0;nr<rr.length;nr++){var sr=rr[nr];tr.push(er.call(null,ir[sr],sr))}return tr}exports.mapValues=mapValues;function map(ir,er){for(var tr=[],rr=0;rr<ir.length;rr++)tr.push(er.call(null,ir[rr],rr));return tr}exports.map=map;function flatten(ir){for(var er=[],tr=0;tr<ir.length;tr++){var rr=ir[tr];Array.isArray(rr)?er=er.concat(flatten(rr)):er.push(rr)}return er}exports.flatten=flatten;function first(ir){return isEmpty(ir)?void 0:ir[0]}exports.first=first;function last(ir){var er=ir&&ir.length;return er?ir[er-1]:void 0}exports.last=last;function forEach(ir,er){if(Array.isArray(ir))for(var tr=0;tr<ir.length;tr++)er.call(null,ir[tr],tr);else if(isObject(ir))for(var rr=keys(ir),tr=0;tr<rr.length;tr++){var nr=rr[tr],sr=ir[nr];er.call(null,sr,nr)}else throw Error("non exhaustive match")}exports.forEach=forEach;function isString(ir){return typeof ir=="string"}exports.isString=isString;function isUndefined(ir){return ir===void 0}exports.isUndefined=isUndefined;function isFunction(ir){return ir instanceof Function}exports.isFunction=isFunction;function drop(ir,er){return er===void 0&&(er=1),ir.slice(er,ir.length)}exports.drop=drop;function dropRight(ir,er){return er===void 0&&(er=1),ir.slice(0,ir.length-er)}exports.dropRight=dropRight;function filter(ir,er){var tr=[];if(Array.isArray(ir))for(var rr=0;rr<ir.length;rr++){var nr=ir[rr];er.call(null,nr)&&tr.push(nr)}return tr}exports.filter=filter;function reject(ir,er){return filter(ir,function(tr){return!er(tr)})}exports.reject=reject;function pick(ir,er){for(var tr=Object.keys(ir),rr={},nr=0;nr<tr.length;nr++){var sr=tr[nr],ar=ir[sr];er(ar)&&(rr[sr]=ar)}return rr}exports.pick=pick;function has(ir,er){return isObject(ir)?ir.hasOwnProperty(er):!1}exports.has=has;function contains(ir,er){return find(ir,function(tr){return tr===er})!==void 0}exports.contains=contains;function cloneArr(ir){for(var er=[],tr=0;tr<ir.length;tr++)er.push(ir[tr]);return er}exports.cloneArr=cloneArr;function cloneObj(ir){var er={};for(var tr in ir)Object.prototype.hasOwnProperty.call(ir,tr)&&(er[tr]=ir[tr]);return er}exports.cloneObj=cloneObj;function find(ir,er){for(var tr=0;tr<ir.length;tr++){var rr=ir[tr];if(er.call(null,rr))return rr}}exports.find=find;function findAll(ir,er){for(var tr=[],rr=0;rr<ir.length;rr++){var nr=ir[rr];er.call(null,nr)&&tr.push(nr)}return tr}exports.findAll=findAll;function reduce(ir,er,tr){for(var rr=Array.isArray(ir),nr=rr?ir:values(ir),sr=rr?[]:keys(ir),ar=tr,or=0;or<nr.length;or++)ar=er.call(null,ar,nr[or],rr?or:sr[or]);return ar}exports.reduce=reduce;function compact(ir){return reject(ir,function(er){return er==null})}exports.compact=compact;function uniq(ir,er){er===void 0&&(er=function(rr){return rr});var tr=[];return reduce(ir,function(rr,nr){var sr=er(nr);return contains(tr,sr)?rr:(tr.push(sr),rr.concat(nr))},[])}exports.uniq=uniq;function partial(ir){for(var er=[],tr=1;tr<arguments.length;tr++)er[tr-1]=arguments[tr];var rr=[null],nr=rr.concat(er);return Function.bind.apply(ir,nr)}exports.partial=partial;function isArray(ir){return Array.isArray(ir)}exports.isArray=isArray;function isRegExp(ir){return ir instanceof RegExp}exports.isRegExp=isRegExp;function isObject(ir){return ir instanceof Object}exports.isObject=isObject;function every(ir,er){for(var tr=0;tr<ir.length;tr++)if(!er(ir[tr],tr))return!1;return!0}exports.every=every;function difference(ir,er){return reject(ir,function(tr){return contains(er,tr)})}exports.difference=difference;function some(ir,er){for(var tr=0;tr<ir.length;tr++)if(er(ir[tr]))return!0;return!1}exports.some=some;function indexOf(ir,er){for(var tr=0;tr<ir.length;tr++)if(ir[tr]===er)return tr;return-1}exports.indexOf=indexOf;function sortBy(ir,er){var tr=cloneArr(ir);return tr.sort(function(rr,nr){return er(rr)-er(nr)}),tr}exports.sortBy=sortBy;function zipObject(ir,er){if(ir.length!==er.length)throw Error("can't zipObject with different number of keys and values!");for(var tr={},rr=0;rr<ir.length;rr++)tr[ir[rr]]=er[rr];return tr}exports.zipObject=zipObject;function assign(ir){for(var er=[],tr=1;tr<arguments.length;tr++)er[tr-1]=arguments[tr];for(var rr=0;rr<er.length;rr++)for(var nr=er[rr],sr=keys(nr),ar=0;ar<sr.length;ar++){var or=sr[ar];ir[or]=nr[or]}return ir}exports.assign=assign;function assignNoOverwrite(ir){for(var er=[],tr=1;tr<arguments.length;tr++)er[tr-1]=arguments[tr];for(var rr=0;rr<er.length;rr++)for(var nr=er[rr],sr=keys(nr),ar=0;ar<sr.length;ar++){var or=sr[ar];has(ir,or)||(ir[or]=nr[or])}return ir}exports.assignNoOverwrite=assignNoOverwrite;function defaults(){for(var ir=[],er=0;er<arguments.length;er++)ir[er]=arguments[er];return assignNoOverwrite.apply(void 0,__spreadArray([{}],ir))}exports.defaults=defaults;function groupBy(ir,er){var tr={};return forEach(ir,function(rr){var nr=er(rr),sr=tr[nr];sr?sr.push(rr):tr[nr]=[rr]}),tr}exports.groupBy=groupBy;function merge(ir,er){for(var tr=cloneObj(ir),rr=keys(er),nr=0;nr<rr.length;nr++){var sr=rr[nr],ar=er[sr];tr[sr]=ar}return tr}exports.merge=merge;function NOOP(){}exports.NOOP=NOOP;function IDENTITY(ir){return ir}exports.IDENTITY=IDENTITY;function packArray(ir){for(var er=[],tr=0;tr<ir.length;tr++){var rr=ir[tr];er.push(rr!==void 0?rr:void 0)}return er}exports.packArray=packArray;function PRINT_ERROR(ir){console&&console.error&&console.error("Error: "+ir)}exports.PRINT_ERROR=PRINT_ERROR;function PRINT_WARNING(ir){console&&console.warn&&console.warn("Warning: "+ir)}exports.PRINT_WARNING=PRINT_WARNING;function isES2015MapSupported(){return typeof Map=="function"}exports.isES2015MapSupported=isES2015MapSupported;function peek(ir){return ir[ir.length-1]}exports.peek=peek;function timer(ir){var er=new Date().getTime(),tr=ir(),rr=new Date().getTime(),nr=rr-er;return{time:nr,value:tr}}exports.timer=timer;function toFastProperties(toBecomeFast){function FakeConstructor(){}FakeConstructor.prototype=toBecomeFast;var fakeInstance=new FakeConstructor;function fakeAccess(){return typeof fakeInstance.bar}return fakeAccess(),fakeAccess(),toBecomeFast}exports.toFastProperties=toFastProperties}),xt=R$1((ir,er)=>{(function(tr,rr){typeof define=="function"&&define.amd?define([],rr):typeof er=="object"&&er.exports?er.exports=rr():tr.regexpToAst=rr()})(typeof self<"u"?self:ir,function(){function tr(){}tr.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},tr.prototype.restoreState=function(mr){this.idx=mr.idx,this.input=mr.input,this.groupIdx=mr.groupIdx},tr.prototype.pattern=function(mr){this.idx=0,this.input=mr,this.groupIdx=0,this.consumeChar("/");var dr=this.disjunction();this.consumeChar("/");for(var vr={type:"Flags",loc:{begin:this.idx,end:mr.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":lr(vr,"global");break;case"i":lr(vr,"ignoreCase");break;case"m":lr(vr,"multiLine");break;case"u":lr(vr,"unicode");break;case"y":lr(vr,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:vr,value:dr,loc:this.loc(0)}},tr.prototype.disjunction=function(){var mr=[],dr=this.idx;for(mr.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),mr.push(this.alternative());return{type:"Disjunction",value:mr,loc:this.loc(dr)}},tr.prototype.alternative=function(){for(var mr=[],dr=this.idx;this.isTerm();)mr.push(this.term());return{type:"Alternative",value:mr,loc:this.loc(dr)}},tr.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},tr.prototype.assertion=function(){var mr=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(mr)};case"$":return{type:"EndAnchor",loc:this.loc(mr)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(mr)};case"B":return{type:"NonWordBoundary",loc:this.loc(mr)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var dr;switch(this.popChar()){case"=":dr="Lookahead";break;case"!":dr="NegativeLookahead";break}cr(dr);var vr=this.disjunction();return this.consumeChar(")"),{type:dr,value:vr,loc:this.loc(mr)}}hr()},tr.prototype.quantifier=function(mr){var dr,vr=this.idx;switch(this.popChar()){case"*":dr={atLeast:0,atMost:1/0};break;case"+":dr={atLeast:1,atMost:1/0};break;case"?":dr={atLeast:0,atMost:1};break;case"{":var Ar=this.integerIncludingZero();switch(this.popChar()){case"}":dr={atLeast:Ar,atMost:Ar};break;case",":var yr;this.isDigit()?(yr=this.integerIncludingZero(),dr={atLeast:Ar,atMost:yr}):dr={atLeast:Ar,atMost:1/0},this.consumeChar("}");break}if(mr===!0&&dr===void 0)return;cr(dr);break}if(!(mr===!0&&dr===void 0))return cr(dr),this.peekChar(0)==="?"?(this.consumeChar("?"),dr.greedy=!1):dr.greedy=!0,dr.type="Quantifier",dr.loc=this.loc(vr),dr},tr.prototype.atom=function(){var mr,dr=this.idx;switch(this.peekChar()){case".":mr=this.dotAll();break;case"\\":mr=this.atomEscape();break;case"[":mr=this.characterClass();break;case"(":mr=this.group();break}return mr===void 0&&this.isPatternCharacter()&&(mr=this.patternCharacter()),cr(mr),mr.loc=this.loc(dr),this.isQuantifier()&&(mr.quantifier=this.quantifier()),mr},tr.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[ar(`
`),ar("\r"),ar("\u2028"),ar("\u2029")]}},tr.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},tr.prototype.decimalEscapeAtom=function(){var mr=this.positiveInteger();return{type:"GroupBackReference",value:mr}},tr.prototype.characterClassEscape=function(){var mr,dr=!1;switch(this.popChar()){case"d":mr=ur;break;case"D":mr=ur,dr=!0;break;case"s":mr=gr;break;case"S":mr=gr,dr=!0;break;case"w":mr=pr;break;case"W":mr=pr,dr=!0;break}return cr(mr),{type:"Set",value:mr,complement:dr}},tr.prototype.controlEscapeAtom=function(){var mr;switch(this.popChar()){case"f":mr=ar("\f");break;case"n":mr=ar(`
`);break;case"r":mr=ar("\r");break;case"t":mr=ar("	");break;case"v":mr=ar("\v");break}return cr(mr),{type:"Character",value:mr}},tr.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var mr=this.popChar();if(/[a-zA-Z]/.test(mr)===!1)throw Error("Invalid ");var dr=mr.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:dr}},tr.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:ar("\0")}},tr.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},tr.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},tr.prototype.identityEscapeAtom=function(){var mr=this.popChar();return{type:"Character",value:ar(mr)}},tr.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var mr=this.popChar();return{type:"Character",value:ar(mr)}}},tr.prototype.characterClass=function(){var mr=[],dr=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),dr=!0);this.isClassAtom();){var vr=this.classAtom(),Ar=vr.type==="Character";if(Ar&&this.isRangeDash()){this.consumeChar("-");var yr=this.classAtom(),wr=yr.type==="Character";if(wr){if(yr.value<vr.value)throw Error("Range out of order in character class");mr.push({from:vr.value,to:yr.value})}else or(vr.value,mr),mr.push(ar("-")),or(yr.value,mr)}else or(vr.value,mr)}return this.consumeChar("]"),{type:"Set",complement:dr,value:mr}},tr.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},tr.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:ar("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},tr.prototype.group=function(){var mr=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),mr=!1;break;default:this.groupIdx++;break}var dr=this.disjunction();this.consumeChar(")");var vr={type:"Group",capturing:mr,value:dr};return mr&&(vr.idx=this.groupIdx),vr},tr.prototype.positiveInteger=function(){var mr=this.popChar();if(sr.test(mr)===!1)throw Error("Expecting a positive integer");for(;nr.test(this.peekChar(0));)mr+=this.popChar();return parseInt(mr,10)},tr.prototype.integerIncludingZero=function(){var mr=this.popChar();if(nr.test(mr)===!1)throw Error("Expecting an integer");for(;nr.test(this.peekChar(0));)mr+=this.popChar();return parseInt(mr,10)},tr.prototype.patternCharacter=function(){var mr=this.popChar();switch(mr){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:ar(mr)}}},tr.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},tr.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},tr.prototype.isDigit=function(){return nr.test(this.peekChar(0))},tr.prototype.isClassAtom=function(mr){switch(mr===void 0&&(mr=0),this.peekChar(mr)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},tr.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},tr.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},tr.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},tr.prototype.isQuantifier=function(){var mr=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(mr)}},tr.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},tr.prototype.parseHexDigits=function(mr){for(var dr="",vr=0;vr<mr;vr++){var Ar=this.popChar();if(rr.test(Ar)===!1)throw Error("Expecting a HexDecimal digits");dr+=Ar}var yr=parseInt(dr,16);return{type:"Character",value:yr}},tr.prototype.peekChar=function(mr){return mr===void 0&&(mr=0),this.input[this.idx+mr]},tr.prototype.popChar=function(){var mr=this.peekChar(0);return this.consumeChar(),mr},tr.prototype.consumeChar=function(mr){if(mr!==void 0&&this.input[this.idx]!==mr)throw Error("Expected: '"+mr+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++},tr.prototype.loc=function(mr){return{begin:mr,end:this.idx}};var rr=/[0-9a-fA-F]/,nr=/[0-9]/,sr=/[1-9]/;function ar(mr){return mr.charCodeAt(0)}function or(mr,dr){mr.length!==void 0?mr.forEach(function(vr){dr.push(vr)}):dr.push(mr)}function lr(mr,dr){if(mr[dr]===!0)throw"duplicate flag "+dr;mr[dr]=!0}function cr(mr){if(mr===void 0)throw Error("Internal Error - Should never get here!")}function hr(){throw Error("Internal Error - Should never get here!")}var fr,ur=[];for(fr=ar("0");fr<=ar("9");fr++)ur.push(fr);var pr=[ar("_")].concat(ur);for(fr=ar("a");fr<=ar("z");fr++)pr.push(fr);for(fr=ar("A");fr<=ar("Z");fr++)pr.push(fr);var gr=[ar(" "),ar("\f"),ar(`
`),ar("\r"),ar("	"),ar("\v"),ar("	"),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar("\u2028"),ar("\u2029"),ar(""),ar(""),ar(""),ar("\uFEFF")];function _r(){}return _r.prototype.visitChildren=function(mr){for(var dr in mr){var vr=mr[dr];mr.hasOwnProperty(dr)&&(vr.type!==void 0?this.visit(vr):Array.isArray(vr)&&vr.forEach(function(Ar){this.visit(Ar)},this))}},_r.prototype.visit=function(mr){switch(mr.type){case"Pattern":this.visitPattern(mr);break;case"Flags":this.visitFlags(mr);break;case"Disjunction":this.visitDisjunction(mr);break;case"Alternative":this.visitAlternative(mr);break;case"StartAnchor":this.visitStartAnchor(mr);break;case"EndAnchor":this.visitEndAnchor(mr);break;case"WordBoundary":this.visitWordBoundary(mr);break;case"NonWordBoundary":this.visitNonWordBoundary(mr);break;case"Lookahead":this.visitLookahead(mr);break;case"NegativeLookahead":this.visitNegativeLookahead(mr);break;case"Character":this.visitCharacter(mr);break;case"Set":this.visitSet(mr);break;case"Group":this.visitGroup(mr);break;case"GroupBackReference":this.visitGroupBackReference(mr);break;case"Quantifier":this.visitQuantifier(mr);break}this.visitChildren(mr)},_r.prototype.visitPattern=function(mr){},_r.prototype.visitFlags=function(mr){},_r.prototype.visitDisjunction=function(mr){},_r.prototype.visitAlternative=function(mr){},_r.prototype.visitStartAnchor=function(mr){},_r.prototype.visitEndAnchor=function(mr){},_r.prototype.visitWordBoundary=function(mr){},_r.prototype.visitNonWordBoundary=function(mr){},_r.prototype.visitLookahead=function(mr){},_r.prototype.visitNegativeLookahead=function(mr){},_r.prototype.visitCharacter=function(mr){},_r.prototype.visitSet=function(mr){},_r.prototype.visitGroup=function(mr){},_r.prototype.visitGroupBackReference=function(mr){},_r.prototype.visitQuantifier=function(mr){},{RegExpParser:tr,BaseRegExpVisitor:_r,VERSION:"0.5.0"}})}),Lt=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.clearRegExpParserCache=ir.getRegExpAst=void 0;var er=xt(),tr={},rr=new er.RegExpParser;function nr(ar){var or=ar.toString();if(tr.hasOwnProperty(or))return tr[or];var lr=rr.pattern(or);return tr[or]=lr,lr}ir.getRegExpAst=nr;function sr(){tr={}}ir.clearRegExpParserCache=sr}),pn=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var _r=function(mr,dr){return _r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(vr,Ar){vr.__proto__=Ar}||function(vr,Ar){for(var yr in Ar)Object.prototype.hasOwnProperty.call(Ar,yr)&&(vr[yr]=Ar[yr])},_r(mr,dr)};return function(mr,dr){if(typeof dr!="function"&&dr!==null)throw new TypeError("Class extends value "+String(dr)+" is not a constructor or null");_r(mr,dr);function vr(){this.constructor=mr}mr.prototype=dr===null?Object.create(dr):(vr.prototype=dr.prototype,new vr)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.canMatchCharCode=ir.firstCharOptimizedIndices=ir.getOptimizedStartCodesIndices=ir.failedOptimizationPrefixMsg=void 0;var tr=xt(),rr=k(),nr=Lt(),sr=Tr(),ar="Complement Sets are not supported for first char optimization";ir.failedOptimizationPrefixMsg=`Unable to use "first char" lexer optimizations:
`;function or(_r,mr){mr===void 0&&(mr=!1);try{var dr=nr.getRegExpAst(_r),vr=lr(dr.value,{},dr.flags.ignoreCase);return vr}catch(yr){if(yr.message===ar)mr&&rr.PRINT_WARNING(""+ir.failedOptimizationPrefixMsg+("	Unable to optimize: < "+_r.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var Ar="";mr&&(Ar=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),rr.PRINT_ERROR(ir.failedOptimizationPrefixMsg+`
`+("	Failed parsing: < "+_r.toString()+` >
`)+("	Using the regexp-to-ast library version: "+tr.VERSION+`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+Ar)}}return[]}ir.getOptimizedStartCodesIndices=or;function lr(_r,mr,dr){switch(_r.type){case"Disjunction":for(var vr=0;vr<_r.value.length;vr++)lr(_r.value[vr],mr,dr);break;case"Alternative":for(var Ar=_r.value,vr=0;vr<Ar.length;vr++){var yr=Ar[vr];switch(yr.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var wr=yr;switch(wr.type){case"Character":cr(wr.value,mr,dr);break;case"Set":if(wr.complement===!0)throw Error(ar);rr.forEach(wr.value,function(xr){if(typeof xr=="number")cr(xr,mr,dr);else{var Cr=xr;if(dr===!0)for(var Ir=Cr.from;Ir<=Cr.to;Ir++)cr(Ir,mr,dr);else{for(var Ir=Cr.from;Ir<=Cr.to&&Ir<sr.minOptimizationVal;Ir++)cr(Ir,mr,dr);if(Cr.to>=sr.minOptimizationVal)for(var Rr=Cr.from>=sr.minOptimizationVal?Cr.from:sr.minOptimizationVal,Pr=Cr.to,Fr=sr.charCodeToOptimizedIndex(Rr),Nr=sr.charCodeToOptimizedIndex(Pr),Ur=Fr;Ur<=Nr;Ur++)mr[Ur]=Ur}}});break;case"Group":lr(wr.value,mr,dr);break;default:throw Error("Non Exhaustive Match")}var br=wr.quantifier!==void 0&&wr.quantifier.atLeast===0;if(wr.type==="Group"&&ur(wr)===!1||wr.type!=="Group"&&br===!1)break}break;default:throw Error("non exhaustive match!")}return rr.values(mr)}ir.firstCharOptimizedIndices=lr;function cr(_r,mr,dr){var vr=sr.charCodeToOptimizedIndex(_r);mr[vr]=vr,dr===!0&&hr(_r,mr)}function hr(_r,mr){var dr=String.fromCharCode(_r),vr=dr.toUpperCase();if(vr!==dr){var Ar=sr.charCodeToOptimizedIndex(vr.charCodeAt(0));mr[Ar]=Ar}else{var yr=dr.toLowerCase();if(yr!==dr){var Ar=sr.charCodeToOptimizedIndex(yr.charCodeAt(0));mr[Ar]=Ar}}}function fr(_r,mr){return rr.find(_r.value,function(dr){if(typeof dr=="number")return rr.contains(mr,dr);var vr=dr;return rr.find(mr,function(Ar){return vr.from<=Ar&&Ar<=vr.to})!==void 0})}function ur(_r){return _r.quantifier&&_r.quantifier.atLeast===0?!0:_r.value?rr.isArray(_r.value)?rr.every(_r.value,ur):ur(_r.value):!1}var pr=function(_r){er(mr,_r);function mr(dr){var vr=_r.call(this)||this;return vr.targetCharCodes=dr,vr.found=!1,vr}return mr.prototype.visitChildren=function(dr){if(this.found!==!0){switch(dr.type){case"Lookahead":this.visitLookahead(dr);return;case"NegativeLookahead":this.visitNegativeLookahead(dr);return}_r.prototype.visitChildren.call(this,dr)}},mr.prototype.visitCharacter=function(dr){rr.contains(this.targetCharCodes,dr.value)&&(this.found=!0)},mr.prototype.visitSet=function(dr){dr.complement?fr(dr,this.targetCharCodes)===void 0&&(this.found=!0):fr(dr,this.targetCharCodes)!==void 0&&(this.found=!0)},mr}(tr.BaseRegExpVisitor);function gr(_r,mr){if(mr instanceof RegExp){var dr=nr.getRegExpAst(mr),vr=new pr(_r);return vr.visit(dr),vr.found}else return rr.find(mr,function(Ar){return rr.contains(_r,Ar.charCodeAt(0))})!==void 0}ir.canMatchCharCode=gr}),Tr=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var Qr=function(Vr,Gr){return Qr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(qr,ji){qr.__proto__=ji}||function(qr,ji){for(var Zr in ji)Object.prototype.hasOwnProperty.call(ji,Zr)&&(qr[Zr]=ji[Zr])},Qr(Vr,Gr)};return function(Vr,Gr){if(typeof Gr!="function"&&Gr!==null)throw new TypeError("Class extends value "+String(Gr)+" is not a constructor or null");Qr(Vr,Gr);function qr(){this.constructor=Vr}Vr.prototype=Gr===null?Object.create(Gr):(qr.prototype=Gr.prototype,new qr)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.charCodeToOptimizedIndex=ir.minOptimizationVal=ir.buildLineBreakIssueMessage=ir.LineTerminatorOptimizedTester=ir.isShortPattern=ir.isCustomPattern=ir.cloneEmptyGroups=ir.performWarningRuntimeChecks=ir.performRuntimeChecks=ir.addStickyFlag=ir.addStartOfInput=ir.findUnreachablePatterns=ir.findModesThatDoNotExist=ir.findInvalidGroupType=ir.findDuplicatePatterns=ir.findUnsupportedFlags=ir.findStartOfInputAnchor=ir.findEmptyMatchRegExps=ir.findEndOfInputAnchor=ir.findInvalidPatterns=ir.findMissingPatterns=ir.validatePatterns=ir.analyzeTokenTypes=ir.enableSticky=ir.disableSticky=ir.SUPPORT_STICKY=ir.MODES=ir.DEFAULT_MODE=void 0;var tr=xt(),rr=ft(),nr=k(),sr=pn(),ar=Lt(),or="PATTERN";ir.DEFAULT_MODE="defaultMode",ir.MODES="modes",ir.SUPPORT_STICKY=typeof new RegExp("(?:)").sticky=="boolean";function lr(){ir.SUPPORT_STICKY=!1}ir.disableSticky=lr;function cr(){ir.SUPPORT_STICKY=!0}ir.enableSticky=cr;function hr(Qr,Vr){Vr=nr.defaults(Vr,{useSticky:ir.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(Ri,Jr){return Jr()}});var Gr=Vr.tracer;Gr("initCharCodeToOptimizedIndexMap",function(){Kr()});var qr;Gr("Reject Lexer.NA",function(){qr=nr.reject(Qr,function(Ri){return Ri[or]===rr.Lexer.NA})});var ji=!1,Zr;Gr("Transform Patterns",function(){ji=!1,Zr=nr.map(qr,function(Ri){var Jr=Ri[or];if(nr.isRegExp(Jr)){var Xi=Jr.source;return Xi.length===1&&Xi!=="^"&&Xi!=="$"&&Xi!=="."&&!Jr.ignoreCase?Xi:Xi.length===2&&Xi[0]==="\\"&&!nr.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],Xi[1])?Xi[1]:Vr.useSticky?Pr(Jr):Rr(Jr)}else{if(nr.isFunction(Jr))return ji=!0,{exec:Jr};if(nr.has(Jr,"exec"))return ji=!0,Jr;if(typeof Jr=="string"){if(Jr.length===1)return Jr;var ss=Jr.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),ls=new RegExp(ss);return Vr.useSticky?Pr(ls):Rr(ls)}else throw Error("non exhaustive match")}})});var Zi,Yi,qi,Xr,ns;Gr("misc mapping",function(){Zi=nr.map(qr,function(Ri){return Ri.tokenTypeIdx}),Yi=nr.map(qr,function(Ri){var Jr=Ri.GROUP;if(Jr!==rr.Lexer.SKIPPED){if(nr.isString(Jr))return Jr;if(nr.isUndefined(Jr))return!1;throw Error("non exhaustive match")}}),qi=nr.map(qr,function(Ri){var Jr=Ri.LONGER_ALT;if(Jr){var Xi=nr.indexOf(qr,Jr);return Xi}}),Xr=nr.map(qr,function(Ri){return Ri.PUSH_MODE}),ns=nr.map(qr,function(Ri){return nr.has(Ri,"POP_MODE")})});var os;Gr("Line Terminator Handling",function(){var Ri=$r(Vr.lineTerminatorCharacters);os=nr.map(qr,function(Jr){return!1}),Vr.positionTracking!=="onlyOffset"&&(os=nr.map(qr,function(Jr){if(nr.has(Jr,"LINE_BREAKS"))return Jr.LINE_BREAKS;if(Dr(Jr,Ri)===!1)return sr.canMatchCharCode(Ri,Jr.PATTERN)}))});var us,is,Ji,ms;Gr("Misc Mapping #2",function(){us=nr.map(qr,Br),is=nr.map(Zr,Or),Ji=nr.reduce(qr,function(Ri,Jr){var Xi=Jr.GROUP;return nr.isString(Xi)&&Xi!==rr.Lexer.SKIPPED&&(Ri[Xi]=[]),Ri},{}),ms=nr.map(Zr,function(Ri,Jr){return{pattern:Zr[Jr],longerAlt:qi[Jr],canLineTerminator:os[Jr],isCustom:us[Jr],short:is[Jr],group:Yi[Jr],push:Xr[Jr],pop:ns[Jr],tokenTypeIdx:Zi[Jr],tokenType:qr[Jr]}})});var Ki=!0,Ni=[];return Vr.safeMode||Gr("First Char Optimization",function(){Ni=nr.reduce(qr,function(Ri,Jr,Xi){if(typeof Jr.PATTERN=="string"){var ss=Jr.PATTERN.charCodeAt(0),ls=rs(ss);Yr(Ri,ls,ms[Xi])}else if(nr.isArray(Jr.START_CHARS_HINT)){var gs;nr.forEach(Jr.START_CHARS_HINT,function(vs){var As=typeof vs=="string"?vs.charCodeAt(0):vs,Ss=rs(As);gs!==Ss&&(gs=Ss,Yr(Ri,Ss,ms[Xi]))})}else if(nr.isRegExp(Jr.PATTERN))if(Jr.PATTERN.unicode)Ki=!1,Vr.ensureOptimizations&&nr.PRINT_ERROR(""+sr.failedOptimizationPrefixMsg+("	Unable to analyze < "+Jr.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var _s=sr.getOptimizedStartCodesIndices(Jr.PATTERN,Vr.ensureOptimizations);nr.isEmpty(_s)&&(Ki=!1),nr.forEach(_s,function(vs){Yr(Ri,vs,ms[Xi])})}else Vr.ensureOptimizations&&nr.PRINT_ERROR(""+sr.failedOptimizationPrefixMsg+("	TokenType: <"+Jr.name+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),Ki=!1;return Ri},[])}),Gr("ArrayPacking",function(){Ni=nr.packArray(Ni)}),{emptyGroups:Ji,patternIdxToConfig:ms,charCodeToPatternIdxToConfig:Ni,hasCustom:ji,canBeOptimized:Ki}}ir.analyzeTokenTypes=hr;function fr(Qr,Vr){var Gr=[],qr=pr(Qr);Gr=Gr.concat(qr.errors);var ji=gr(qr.valid),Zr=ji.valid;return Gr=Gr.concat(ji.errors),Gr=Gr.concat(ur(Zr)),Gr=Gr.concat(br(Zr)),Gr=Gr.concat(Sr(Zr,Vr)),Gr=Gr.concat(xr(Zr)),Gr}ir.validatePatterns=fr;function ur(Qr){var Vr=[],Gr=nr.filter(Qr,function(qr){return nr.isRegExp(qr[or])});return Vr=Vr.concat(mr(Gr)),Vr=Vr.concat(Ar(Gr)),Vr=Vr.concat(yr(Gr)),Vr=Vr.concat(wr(Gr)),Vr=Vr.concat(dr(Gr)),Vr}function pr(Qr){var Vr=nr.filter(Qr,function(ji){return!nr.has(ji,or)}),Gr=nr.map(Vr,function(ji){return{message:"Token Type: ->"+ji.name+"<- missing static 'PATTERN' property",type:rr.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[ji]}}),qr=nr.difference(Qr,Vr);return{errors:Gr,valid:qr}}ir.findMissingPatterns=pr;function gr(Qr){var Vr=nr.filter(Qr,function(ji){var Zr=ji[or];return!nr.isRegExp(Zr)&&!nr.isFunction(Zr)&&!nr.has(Zr,"exec")&&!nr.isString(Zr)}),Gr=nr.map(Vr,function(ji){return{message:"Token Type: ->"+ji.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:rr.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[ji]}}),qr=nr.difference(Qr,Vr);return{errors:Gr,valid:qr}}ir.findInvalidPatterns=gr;var _r=/[^\\][\$]/;function mr(Qr){var Vr=function(ji){er(Zr,ji);function Zr(){var Zi=ji!==null&&ji.apply(this,arguments)||this;return Zi.found=!1,Zi}return Zr.prototype.visitEndAnchor=function(Zi){this.found=!0},Zr}(tr.BaseRegExpVisitor),Gr=nr.filter(Qr,function(ji){var Zr=ji[or];try{var Zi=ar.getRegExpAst(Zr),Yi=new Vr;return Yi.visit(Zi),Yi.found}catch{return _r.test(Zr.source)}}),qr=nr.map(Gr,function(ji){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+ji.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:rr.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[ji]}});return qr}ir.findEndOfInputAnchor=mr;function dr(Qr){var Vr=nr.filter(Qr,function(qr){var ji=qr[or];return ji.test("")}),Gr=nr.map(Vr,function(qr){return{message:"Token Type: ->"+qr.name+"<- static 'PATTERN' must not match an empty string",type:rr.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[qr]}});return Gr}ir.findEmptyMatchRegExps=dr;var vr=/[^\\[][\^]|^\^/;function Ar(Qr){var Vr=function(ji){er(Zr,ji);function Zr(){var Zi=ji!==null&&ji.apply(this,arguments)||this;return Zi.found=!1,Zi}return Zr.prototype.visitStartAnchor=function(Zi){this.found=!0},Zr}(tr.BaseRegExpVisitor),Gr=nr.filter(Qr,function(ji){var Zr=ji[or];try{var Zi=ar.getRegExpAst(Zr),Yi=new Vr;return Yi.visit(Zi),Yi.found}catch{return vr.test(Zr.source)}}),qr=nr.map(Gr,function(ji){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+ji.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:rr.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[ji]}});return qr}ir.findStartOfInputAnchor=Ar;function yr(Qr){var Vr=nr.filter(Qr,function(qr){var ji=qr[or];return ji instanceof RegExp&&(ji.multiline||ji.global)}),Gr=nr.map(Vr,function(qr){return{message:"Token Type: ->"+qr.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:rr.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[qr]}});return Gr}ir.findUnsupportedFlags=yr;function wr(Qr){var Vr=[],Gr=nr.map(Qr,function(Zr){return nr.reduce(Qr,function(Zi,Yi){return Zr.PATTERN.source===Yi.PATTERN.source&&!nr.contains(Vr,Yi)&&Yi.PATTERN!==rr.Lexer.NA&&(Vr.push(Yi),Zi.push(Yi)),Zi},[])});Gr=nr.compact(Gr);var qr=nr.filter(Gr,function(Zr){return Zr.length>1}),ji=nr.map(qr,function(Zr){var Zi=nr.map(Zr,function(qi){return qi.name}),Yi=nr.first(Zr).PATTERN;return{message:"The same RegExp pattern ->"+Yi+"<-"+("has been used in all of the following Token Types: "+Zi.join(", ")+" <-"),type:rr.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:Zr}});return ji}ir.findDuplicatePatterns=wr;function br(Qr){var Vr=nr.filter(Qr,function(qr){if(!nr.has(qr,"GROUP"))return!1;var ji=qr.GROUP;return ji!==rr.Lexer.SKIPPED&&ji!==rr.Lexer.NA&&!nr.isString(ji)}),Gr=nr.map(Vr,function(qr){return{message:"Token Type: ->"+qr.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:rr.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[qr]}});return Gr}ir.findInvalidGroupType=br;function Sr(Qr,Vr){var Gr=nr.filter(Qr,function(ji){return ji.PUSH_MODE!==void 0&&!nr.contains(Vr,ji.PUSH_MODE)}),qr=nr.map(Gr,function(ji){var Zr="Token Type: ->"+ji.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+ji.PUSH_MODE+"<-which does not exist";return{message:Zr,type:rr.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[ji]}});return qr}ir.findModesThatDoNotExist=Sr;function xr(Qr){var Vr=[],Gr=nr.reduce(Qr,function(qr,ji,Zr){var Zi=ji.PATTERN;return Zi===rr.Lexer.NA||(nr.isString(Zi)?qr.push({str:Zi,idx:Zr,tokenType:ji}):nr.isRegExp(Zi)&&Ir(Zi)&&qr.push({str:Zi.source,idx:Zr,tokenType:ji})),qr},[]);return nr.forEach(Qr,function(qr,ji){nr.forEach(Gr,function(Zr){var Zi=Zr.str,Yi=Zr.idx,qi=Zr.tokenType;if(ji<Yi&&Cr(Zi,qr.PATTERN)){var Xr="Token: ->"+qi.name+`<- can never be matched.
`+("Because it appears AFTER the Token Type ->"+qr.name+"<-")+`in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;Vr.push({message:Xr,type:rr.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[qr,qi]})}})}),Vr}ir.findUnreachablePatterns=xr;function Cr(Qr,Vr){if(nr.isRegExp(Vr)){var Gr=Vr.exec(Qr);return Gr!==null&&Gr.index===0}else{if(nr.isFunction(Vr))return Vr(Qr,0,[],{});if(nr.has(Vr,"exec"))return Vr.exec(Qr,0,[],{});if(typeof Vr=="string")return Vr===Qr;throw Error("non exhaustive match")}}function Ir(Qr){var Vr=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return nr.find(Vr,function(Gr){return Qr.source.indexOf(Gr)!==-1})===void 0}function Rr(Qr){var Vr=Qr.ignoreCase?"i":"";return new RegExp("^(?:"+Qr.source+")",Vr)}ir.addStartOfInput=Rr;function Pr(Qr){var Vr=Qr.ignoreCase?"iy":"y";return new RegExp(""+Qr.source,Vr)}ir.addStickyFlag=Pr;function Fr(Qr,Vr,Gr){var qr=[];return nr.has(Qr,ir.DEFAULT_MODE)||qr.push({message:"A MultiMode Lexer cannot be initialized without a <"+ir.DEFAULT_MODE+`> property in its definition
`,type:rr.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),nr.has(Qr,ir.MODES)||qr.push({message:"A MultiMode Lexer cannot be initialized without a <"+ir.MODES+`> property in its definition
`,type:rr.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),nr.has(Qr,ir.MODES)&&nr.has(Qr,ir.DEFAULT_MODE)&&!nr.has(Qr.modes,Qr.defaultMode)&&qr.push({message:"A MultiMode Lexer cannot be initialized with a "+ir.DEFAULT_MODE+": <"+Qr.defaultMode+`>which does not exist
`,type:rr.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),nr.has(Qr,ir.MODES)&&nr.forEach(Qr.modes,function(ji,Zr){nr.forEach(ji,function(Zi,Yi){nr.isUndefined(Zi)&&qr.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+("<"+Zr+"> at index: <"+Yi+`>
`),type:rr.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),qr}ir.performRuntimeChecks=Fr;function Nr(Qr,Vr,Gr){var qr=[],ji=!1,Zr=nr.compact(nr.flatten(nr.mapValues(Qr.modes,function(qi){return qi}))),Zi=nr.reject(Zr,function(qi){return qi[or]===rr.Lexer.NA}),Yi=$r(Gr);return Vr&&nr.forEach(Zi,function(qi){var Xr=Dr(qi,Yi);if(Xr!==!1){var ns=Wr(qi,Xr),os={message:ns,type:Xr.issue,tokenType:qi};qr.push(os)}else nr.has(qi,"LINE_BREAKS")?qi.LINE_BREAKS===!0&&(ji=!0):sr.canMatchCharCode(Yi,qi.PATTERN)&&(ji=!0)}),Vr&&!ji&&qr.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS
	for details.`,type:rr.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),qr}ir.performWarningRuntimeChecks=Nr;function Ur(Qr){var Vr={},Gr=nr.keys(Qr);return nr.forEach(Gr,function(qr){var ji=Qr[qr];if(nr.isArray(ji))Vr[qr]=[];else throw Error("non exhaustive match")}),Vr}ir.cloneEmptyGroups=Ur;function Br(Qr){var Vr=Qr.PATTERN;if(nr.isRegExp(Vr))return!1;if(nr.isFunction(Vr)||nr.has(Vr,"exec"))return!0;if(nr.isString(Vr))return!1;throw Error("non exhaustive match")}ir.isCustomPattern=Br;function Or(Qr){return nr.isString(Qr)&&Qr.length===1?Qr.charCodeAt(0):!1}ir.isShortPattern=Or,ir.LineTerminatorOptimizedTester={test:function(Qr){for(var Vr=Qr.length,Gr=this.lastIndex;Gr<Vr;Gr++){var qr=Qr.charCodeAt(Gr);if(qr===10)return this.lastIndex=Gr+1,!0;if(qr===13)return Qr.charCodeAt(Gr+1)===10?this.lastIndex=Gr+2:this.lastIndex=Gr+1,!0}return!1},lastIndex:0};function Dr(Qr,Vr){if(nr.has(Qr,"LINE_BREAKS"))return!1;if(nr.isRegExp(Qr.PATTERN)){try{sr.canMatchCharCode(Vr,Qr.PATTERN)}catch(Gr){return{issue:rr.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:Gr.message}}return!1}else{if(nr.isString(Qr.PATTERN))return!1;if(Br(Qr))return{issue:rr.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function Wr(Qr,Vr){if(Vr.issue===rr.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+("	The problem is in the <"+Qr.name+`> Token Type
`)+("	 Root cause: "+Vr.errMsg+`.
`)+"	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(Vr.issue===rr.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+("	The problem is in the <"+Qr.name+`> Token Type
`)+"	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}ir.buildLineBreakIssueMessage=Wr;function $r(Qr){var Vr=nr.map(Qr,function(Gr){return nr.isString(Gr)&&Gr.length>0?Gr.charCodeAt(0):Gr});return Vr}function Yr(Qr,Vr,Gr){Qr[Vr]===void 0?Qr[Vr]=[Gr]:Qr[Vr].push(Gr)}ir.minOptimizationVal=256;var Qi=[];function rs(Qr){return Qr<ir.minOptimizationVal?Qr:Qi[Qr]}ir.charCodeToOptimizedIndex=rs;function Kr(){if(nr.isEmpty(Qi)){Qi=new Array(65536);for(var Qr=0;Qr<65536;Qr++)Qi[Qr]=Qr>255?255+~~(Qr/255):Qr}}}),Xe=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.isTokenType=ir.hasExtendingTokensTypesMapProperty=ir.hasExtendingTokensTypesProperty=ir.hasCategoriesProperty=ir.hasShortKeyProperty=ir.singleAssignCategoriesToksMap=ir.assignCategoriesMapProp=ir.assignCategoriesTokensProp=ir.assignTokenDefaultProps=ir.expandCategories=ir.augmentTokenTypes=ir.tokenIdxToClass=ir.tokenShortNameIdx=ir.tokenStructuredMatcherNoCategories=ir.tokenStructuredMatcher=void 0;var er=k();function tr(_r,mr){var dr=_r.tokenTypeIdx;return dr===mr.tokenTypeIdx?!0:mr.isParent===!0&&mr.categoryMatchesMap[dr]===!0}ir.tokenStructuredMatcher=tr;function rr(_r,mr){return _r.tokenTypeIdx===mr.tokenTypeIdx}ir.tokenStructuredMatcherNoCategories=rr,ir.tokenShortNameIdx=1,ir.tokenIdxToClass={};function nr(_r){var mr=sr(_r);ar(mr),lr(mr),or(mr),er.forEach(mr,function(dr){dr.isParent=dr.categoryMatches.length>0})}ir.augmentTokenTypes=nr;function sr(_r){for(var mr=er.cloneArr(_r),dr=_r,vr=!0;vr;){dr=er.compact(er.flatten(er.map(dr,function(yr){return yr.CATEGORIES})));var Ar=er.difference(dr,mr);mr=mr.concat(Ar),er.isEmpty(Ar)?vr=!1:dr=Ar}return mr}ir.expandCategories=sr;function ar(_r){er.forEach(_r,function(mr){hr(mr)||(ir.tokenIdxToClass[ir.tokenShortNameIdx]=mr,mr.tokenTypeIdx=ir.tokenShortNameIdx++),fr(mr)&&!er.isArray(mr.CATEGORIES)&&(mr.CATEGORIES=[mr.CATEGORIES]),fr(mr)||(mr.CATEGORIES=[]),ur(mr)||(mr.categoryMatches=[]),pr(mr)||(mr.categoryMatchesMap={})})}ir.assignTokenDefaultProps=ar;function or(_r){er.forEach(_r,function(mr){mr.categoryMatches=[],er.forEach(mr.categoryMatchesMap,function(dr,vr){mr.categoryMatches.push(ir.tokenIdxToClass[vr].tokenTypeIdx)})})}ir.assignCategoriesTokensProp=or;function lr(_r){er.forEach(_r,function(mr){cr([],mr)})}ir.assignCategoriesMapProp=lr;function cr(_r,mr){er.forEach(_r,function(dr){mr.categoryMatchesMap[dr.tokenTypeIdx]=!0}),er.forEach(mr.CATEGORIES,function(dr){var vr=_r.concat(mr);er.contains(vr,dr)||cr(vr,dr)})}ir.singleAssignCategoriesToksMap=cr;function hr(_r){return er.has(_r,"tokenTypeIdx")}ir.hasShortKeyProperty=hr;function fr(_r){return er.has(_r,"CATEGORIES")}ir.hasCategoriesProperty=fr;function ur(_r){return er.has(_r,"categoryMatches")}ir.hasExtendingTokensTypesProperty=ur;function pr(_r){return er.has(_r,"categoryMatchesMap")}ir.hasExtendingTokensTypesMapProperty=pr;function gr(_r){return er.has(_r,"tokenTypeIdx")}ir.isTokenType=gr}),kr=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.defaultLexerErrorProvider=void 0,ir.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(er){return"Unable to pop Lexer Mode after encountering Token ->"+er.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(er,tr,rr,nr,sr){return"unexpected character: ->"+er.charAt(tr)+"<- at offset: "+tr+","+(" skipped "+rr+" characters.")}}}),ft=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.Lexer=ir.LexerDefinitionErrorType=void 0;var er=Tr(),tr=k(),rr=Xe(),nr=kr(),sr=Lt(),ar;(function(cr){cr[cr.MISSING_PATTERN=0]="MISSING_PATTERN",cr[cr.INVALID_PATTERN=1]="INVALID_PATTERN",cr[cr.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",cr[cr.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",cr[cr.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",cr[cr.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",cr[cr.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",cr[cr.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",cr[cr.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",cr[cr.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",cr[cr.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",cr[cr.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",cr[cr.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",cr[cr.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",cr[cr.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",cr[cr.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",cr[cr.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"})(ar=ir.LexerDefinitionErrorType||(ir.LexerDefinitionErrorType={}));var or={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:nr.defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1};Object.freeze(or);var lr=function(){function cr(hr,fr){var ur=this;if(fr===void 0&&(fr=or),this.lexerDefinition=hr,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof fr=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=tr.merge(or,fr);var pr=this.config.traceInitPerf;pr===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof pr=="number"&&(this.traceInitMaxIdent=pr,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var gr,_r=!0;ur.TRACE_INIT("Lexer Config handling",function(){if(ur.config.lineTerminatorsPattern===or.lineTerminatorsPattern)ur.config.lineTerminatorsPattern=er.LineTerminatorOptimizedTester;else if(ur.config.lineTerminatorCharacters===or.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(fr.safeMode&&fr.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');ur.trackStartLines=/full|onlyStart/i.test(ur.config.positionTracking),ur.trackEndLines=/full/i.test(ur.config.positionTracking),tr.isArray(hr)?(gr={modes:{}},gr.modes[er.DEFAULT_MODE]=tr.cloneArr(hr),gr[er.DEFAULT_MODE]=er.DEFAULT_MODE):(_r=!1,gr=tr.cloneObj(hr))}),ur.config.skipValidations===!1&&(ur.TRACE_INIT("performRuntimeChecks",function(){ur.lexerDefinitionErrors=ur.lexerDefinitionErrors.concat(er.performRuntimeChecks(gr,ur.trackStartLines,ur.config.lineTerminatorCharacters))}),ur.TRACE_INIT("performWarningRuntimeChecks",function(){ur.lexerDefinitionWarning=ur.lexerDefinitionWarning.concat(er.performWarningRuntimeChecks(gr,ur.trackStartLines,ur.config.lineTerminatorCharacters))})),gr.modes=gr.modes?gr.modes:{},tr.forEach(gr.modes,function(Ar,yr){gr.modes[yr]=tr.reject(Ar,function(wr){return tr.isUndefined(wr)})});var mr=tr.keys(gr.modes);if(tr.forEach(gr.modes,function(Ar,yr){ur.TRACE_INIT("Mode: <"+yr+"> processing",function(){if(ur.modes.push(yr),ur.config.skipValidations===!1&&ur.TRACE_INIT("validatePatterns",function(){ur.lexerDefinitionErrors=ur.lexerDefinitionErrors.concat(er.validatePatterns(Ar,mr))}),tr.isEmpty(ur.lexerDefinitionErrors)){rr.augmentTokenTypes(Ar);var wr;ur.TRACE_INIT("analyzeTokenTypes",function(){wr=er.analyzeTokenTypes(Ar,{lineTerminatorCharacters:ur.config.lineTerminatorCharacters,positionTracking:fr.positionTracking,ensureOptimizations:fr.ensureOptimizations,safeMode:fr.safeMode,tracer:ur.TRACE_INIT.bind(ur)})}),ur.patternIdxToConfig[yr]=wr.patternIdxToConfig,ur.charCodeToPatternIdxToConfig[yr]=wr.charCodeToPatternIdxToConfig,ur.emptyGroups=tr.merge(ur.emptyGroups,wr.emptyGroups),ur.hasCustom=wr.hasCustom||ur.hasCustom,ur.canModeBeOptimized[yr]=wr.canBeOptimized}})}),ur.defaultMode=gr.defaultMode,!tr.isEmpty(ur.lexerDefinitionErrors)&&!ur.config.deferDefinitionErrorsHandling){var dr=tr.map(ur.lexerDefinitionErrors,function(Ar){return Ar.message}),vr=dr.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+vr)}tr.forEach(ur.lexerDefinitionWarning,function(Ar){tr.PRINT_WARNING(Ar.message)}),ur.TRACE_INIT("Choosing sub-methods implementations",function(){if(er.SUPPORT_STICKY?(ur.chopInput=tr.IDENTITY,ur.match=ur.matchWithTest):(ur.updateLastIndex=tr.NOOP,ur.match=ur.matchWithExec),_r&&(ur.handleModes=tr.NOOP),ur.trackStartLines===!1&&(ur.computeNewColumn=tr.IDENTITY),ur.trackEndLines===!1&&(ur.updateTokenEndLineColumnLocation=tr.NOOP),/full/i.test(ur.config.positionTracking))ur.createTokenInstance=ur.createFullToken;else if(/onlyStart/i.test(ur.config.positionTracking))ur.createTokenInstance=ur.createStartOnlyToken;else if(/onlyOffset/i.test(ur.config.positionTracking))ur.createTokenInstance=ur.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'+ur.config.positionTracking+'"');ur.hasCustom?(ur.addToken=ur.addTokenUsingPush,ur.handlePayload=ur.handlePayloadWithCustom):(ur.addToken=ur.addTokenUsingMemberAccess,ur.handlePayload=ur.handlePayloadNoCustom)}),ur.TRACE_INIT("Failed Optimization Warnings",function(){var Ar=tr.reduce(ur.canModeBeOptimized,function(yr,wr,br){return wr===!1&&yr.push(br),yr},[]);if(fr.ensureOptimizations&&!tr.isEmpty(Ar))throw Error("Lexer Modes: < "+Ar.join(", ")+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),ur.TRACE_INIT("clearRegExpParserCache",function(){sr.clearRegExpParserCache()}),ur.TRACE_INIT("toFastProperties",function(){tr.toFastProperties(ur)})})}return cr.prototype.tokenize=function(hr,fr){if(fr===void 0&&(fr=this.defaultMode),!tr.isEmpty(this.lexerDefinitionErrors)){var ur=tr.map(this.lexerDefinitionErrors,function(_r){return _r.message}),pr=ur.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+pr)}var gr=this.tokenizeInternal(hr,fr);return gr},cr.prototype.tokenizeInternal=function(hr,fr){var ur=this,pr,gr,_r,mr,dr,vr,Ar,yr,wr,br,Sr,xr,Cr,Ir,Rr,Pr=hr,Fr=Pr.length,Nr=0,Ur=0,Br=this.hasCustom?0:Math.floor(hr.length/10),Or=new Array(Br),Dr=[],Wr=this.trackStartLines?1:void 0,$r=this.trackStartLines?1:void 0,Yr=er.cloneEmptyGroups(this.emptyGroups),Qi=this.trackStartLines,rs=this.config.lineTerminatorsPattern,Kr=0,Qr=[],Vr=[],Gr=[],qr=[];Object.freeze(qr);var ji=void 0;function Zr(){return Qr}function Zi(vs){var As=er.charCodeToOptimizedIndex(vs),Ss=Vr[As];return Ss===void 0?qr:Ss}var Yi=function(vs){if(Gr.length===1&&vs.tokenType.PUSH_MODE===void 0){var As=ur.config.errorMessageProvider.buildUnableToPopLexerModeMessage(vs);Dr.push({offset:vs.startOffset,line:vs.startLine!==void 0?vs.startLine:void 0,column:vs.startColumn!==void 0?vs.startColumn:void 0,length:vs.image.length,message:As})}else{Gr.pop();var Ss=tr.last(Gr);Qr=ur.patternIdxToConfig[Ss],Vr=ur.charCodeToPatternIdxToConfig[Ss],Kr=Qr.length;var Is=ur.canModeBeOptimized[Ss]&&ur.config.safeMode===!1;Vr&&Is?ji=Zi:ji=Zr}};function qi(vs){Gr.push(vs),Vr=this.charCodeToPatternIdxToConfig[vs],Qr=this.patternIdxToConfig[vs],Kr=Qr.length,Kr=Qr.length;var As=this.canModeBeOptimized[vs]&&this.config.safeMode===!1;Vr&&As?ji=Zi:ji=Zr}qi.call(this,fr);for(var Xr;Nr<Fr;){dr=null;var ns=Pr.charCodeAt(Nr),os=ji(ns),us=os.length;for(pr=0;pr<us;pr++){Xr=os[pr];var is=Xr.pattern;vr=null;var Ji=Xr.short;if(Ji!==!1?ns===Ji&&(dr=is):Xr.isCustom===!0?(Rr=is.exec(Pr,Nr,Or,Yr),Rr!==null?(dr=Rr[0],Rr.payload!==void 0&&(vr=Rr.payload)):dr=null):(this.updateLastIndex(is,Nr),dr=this.match(is,hr,Nr)),dr!==null){if(mr=Xr.longerAlt,mr!==void 0){var ms=Qr[mr],Ki=ms.pattern;Ar=null,ms.isCustom===!0?(Rr=Ki.exec(Pr,Nr,Or,Yr),Rr!==null?(_r=Rr[0],Rr.payload!==void 0&&(Ar=Rr.payload)):_r=null):(this.updateLastIndex(Ki,Nr),_r=this.match(Ki,hr,Nr)),_r&&_r.length>dr.length&&(dr=_r,vr=Ar,Xr=ms)}break}}if(dr!==null){if(yr=dr.length,wr=Xr.group,wr!==void 0&&(br=Xr.tokenTypeIdx,Sr=this.createTokenInstance(dr,Nr,br,Xr.tokenType,Wr,$r,yr),this.handlePayload(Sr,vr),wr===!1?Ur=this.addToken(Or,Ur,Sr):Yr[wr].push(Sr)),hr=this.chopInput(hr,yr),Nr=Nr+yr,$r=this.computeNewColumn($r,yr),Qi===!0&&Xr.canLineTerminator===!0){var Ni=0,Ri=void 0,Jr=void 0;rs.lastIndex=0;do Ri=rs.test(dr),Ri===!0&&(Jr=rs.lastIndex-1,Ni++);while(Ri===!0);Ni!==0&&(Wr=Wr+Ni,$r=yr-Jr,this.updateTokenEndLineColumnLocation(Sr,wr,Jr,Ni,Wr,$r,yr))}this.handleModes(Xr,Yi,qi,Sr)}else{for(var Xi=Nr,ss=Wr,ls=$r,gs=!1;!gs&&Nr<Fr;)for(Cr=Pr.charCodeAt(Nr),hr=this.chopInput(hr,1),Nr++,gr=0;gr<Kr;gr++){var _s=Qr[gr],is=_s.pattern,Ji=_s.short;if(Ji!==!1?Pr.charCodeAt(Nr)===Ji&&(gs=!0):_s.isCustom===!0?gs=is.exec(Pr,Nr,Or,Yr)!==null:(this.updateLastIndex(is,Nr),gs=is.exec(hr)!==null),gs===!0)break}xr=Nr-Xi,Ir=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(Pr,Xi,xr,ss,ls),Dr.push({offset:Xi,line:ss,column:ls,length:xr,message:Ir})}}return this.hasCustom||(Or.length=Ur),{tokens:Or,groups:Yr,errors:Dr}},cr.prototype.handleModes=function(hr,fr,ur,pr){if(hr.pop===!0){var gr=hr.push;fr(pr),gr!==void 0&&ur.call(this,gr)}else hr.push!==void 0&&ur.call(this,hr.push)},cr.prototype.chopInput=function(hr,fr){return hr.substring(fr)},cr.prototype.updateLastIndex=function(hr,fr){hr.lastIndex=fr},cr.prototype.updateTokenEndLineColumnLocation=function(hr,fr,ur,pr,gr,_r,mr){var dr,vr;fr!==void 0&&(dr=ur===mr-1,vr=dr?-1:0,pr===1&&dr===!0||(hr.endLine=gr+vr,hr.endColumn=_r-1+-vr))},cr.prototype.computeNewColumn=function(hr,fr){return hr+fr},cr.prototype.createTokenInstance=function(){for(var hr=[],fr=0;fr<arguments.length;fr++)hr[fr]=arguments[fr];return null},cr.prototype.createOffsetOnlyToken=function(hr,fr,ur,pr){return{image:hr,startOffset:fr,tokenTypeIdx:ur,tokenType:pr}},cr.prototype.createStartOnlyToken=function(hr,fr,ur,pr,gr,_r){return{image:hr,startOffset:fr,startLine:gr,startColumn:_r,tokenTypeIdx:ur,tokenType:pr}},cr.prototype.createFullToken=function(hr,fr,ur,pr,gr,_r,mr){return{image:hr,startOffset:fr,endOffset:fr+mr-1,startLine:gr,endLine:gr,startColumn:_r,endColumn:_r+mr-1,tokenTypeIdx:ur,tokenType:pr}},cr.prototype.addToken=function(hr,fr,ur){return 666},cr.prototype.addTokenUsingPush=function(hr,fr,ur){return hr.push(ur),fr},cr.prototype.addTokenUsingMemberAccess=function(hr,fr,ur){return hr[fr]=ur,fr++,fr},cr.prototype.handlePayload=function(hr,fr){},cr.prototype.handlePayloadNoCustom=function(hr,fr){},cr.prototype.handlePayloadWithCustom=function(hr,fr){fr!==null&&(hr.payload=fr)},cr.prototype.match=function(hr,fr,ur){return null},cr.prototype.matchWithTest=function(hr,fr,ur){var pr=hr.test(fr);return pr===!0?fr.substring(ur,hr.lastIndex):null},cr.prototype.matchWithExec=function(hr,fr){var ur=hr.exec(fr);return ur!==null?ur[0]:ur},cr.prototype.TRACE_INIT=function(hr,fr){if(this.traceInitPerf===!0){this.traceInitIndent++;var ur=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(ur+"--> <"+hr+">");var pr=tr.timer(fr),gr=pr.time,_r=pr.value,mr=gr>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&mr(ur+"<-- <"+hr+"> time: "+gr+"ms"),this.traceInitIndent--,_r}else return fr()},cr.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",cr.NA=/NOT_APPLICABLE/,cr}();ir.Lexer=lr}),Ue=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.tokenMatcher=ir.createTokenInstance=ir.EOF=ir.createToken=ir.hasTokenLabel=ir.tokenName=ir.tokenLabel=void 0;var er=k(),tr=ft(),rr=Xe();function nr(yr){return ar(yr)?yr.LABEL:yr.name}ir.tokenLabel=nr;function sr(yr){return yr.name}ir.tokenName=sr;function ar(yr){return er.isString(yr.LABEL)&&yr.LABEL!==""}ir.hasTokenLabel=ar;var or="parent",lr="categories",cr="label",hr="group",fr="push_mode",ur="pop_mode",pr="longer_alt",gr="line_breaks",_r="start_chars_hint";function mr(yr){return dr(yr)}ir.createToken=mr;function dr(yr){var wr=yr.pattern,br={};if(br.name=yr.name,er.isUndefined(wr)||(br.PATTERN=wr),er.has(yr,or))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return er.has(yr,lr)&&(br.CATEGORIES=yr[lr]),rr.augmentTokenTypes([br]),er.has(yr,cr)&&(br.LABEL=yr[cr]),er.has(yr,hr)&&(br.GROUP=yr[hr]),er.has(yr,ur)&&(br.POP_MODE=yr[ur]),er.has(yr,fr)&&(br.PUSH_MODE=yr[fr]),er.has(yr,pr)&&(br.LONGER_ALT=yr[pr]),er.has(yr,gr)&&(br.LINE_BREAKS=yr[gr]),er.has(yr,_r)&&(br.START_CHARS_HINT=yr[_r]),br}ir.EOF=mr({name:"EOF",pattern:tr.Lexer.NA}),rr.augmentTokenTypes([ir.EOF]);function vr(yr,wr,br,Sr,xr,Cr,Ir,Rr){return{image:wr,startOffset:br,endOffset:Sr,startLine:xr,endLine:Cr,startColumn:Ir,endColumn:Rr,tokenTypeIdx:yr.tokenTypeIdx,tokenType:yr}}ir.createTokenInstance=vr;function Ar(yr,wr){return rr.tokenStructuredMatcher(yr,wr)}ir.tokenMatcher=Ar}),ne=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var dr=function(vr,Ar){return dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(yr,wr){yr.__proto__=wr}||function(yr,wr){for(var br in wr)Object.prototype.hasOwnProperty.call(wr,br)&&(yr[br]=wr[br])},dr(vr,Ar)};return function(vr,Ar){if(typeof Ar!="function"&&Ar!==null)throw new TypeError("Class extends value "+String(Ar)+" is not a constructor or null");dr(vr,Ar);function yr(){this.constructor=vr}vr.prototype=Ar===null?Object.create(Ar):(yr.prototype=Ar.prototype,new yr)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.serializeProduction=ir.serializeGrammar=ir.Terminal=ir.Alternation=ir.RepetitionWithSeparator=ir.Repetition=ir.RepetitionMandatoryWithSeparator=ir.RepetitionMandatory=ir.Option=ir.Alternative=ir.Rule=ir.NonTerminal=ir.AbstractProduction=void 0;var tr=k(),rr=Ue(),nr=function(){function dr(vr){this._definition=vr}return Object.defineProperty(dr.prototype,"definition",{get:function(){return this._definition},set:function(vr){this._definition=vr},enumerable:!1,configurable:!0}),dr.prototype.accept=function(vr){vr.visit(this),tr.forEach(this.definition,function(Ar){Ar.accept(vr)})},dr}();ir.AbstractProduction=nr;var sr=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,[])||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return Object.defineProperty(vr.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(Ar){},enumerable:!1,configurable:!0}),vr.prototype.accept=function(Ar){Ar.visit(this)},vr}(nr);ir.NonTerminal=sr;var ar=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,Ar.definition)||this;return yr.orgText="",tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return vr}(nr);ir.Rule=ar;var or=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,Ar.definition)||this;return yr.ignoreAmbiguities=!1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return vr}(nr);ir.Alternative=or;var lr=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return vr}(nr);ir.Option=lr;var cr=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return vr}(nr);ir.RepetitionMandatory=cr;var hr=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return vr}(nr);ir.RepetitionMandatoryWithSeparator=hr;var fr=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return vr}(nr);ir.Repetition=fr;var ur=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return vr}(nr);ir.RepetitionWithSeparator=ur;var pr=function(dr){er(vr,dr);function vr(Ar){var yr=dr.call(this,Ar.definition)||this;return yr.idx=1,yr.ignoreAmbiguities=!1,yr.hasPredicates=!1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return Object.defineProperty(vr.prototype,"definition",{get:function(){return this._definition},set:function(Ar){this._definition=Ar},enumerable:!1,configurable:!0}),vr}(nr);ir.Alternation=pr;var gr=function(){function dr(vr){this.idx=1,tr.assign(this,tr.pick(vr,function(Ar){return Ar!==void 0}))}return dr.prototype.accept=function(vr){vr.visit(this)},dr}();ir.Terminal=gr;function _r(dr){return tr.map(dr,mr)}ir.serializeGrammar=_r;function mr(dr){function vr(wr){return tr.map(wr,mr)}if(dr instanceof sr)return{type:"NonTerminal",name:dr.nonTerminalName,idx:dr.idx};if(dr instanceof or)return{type:"Alternative",definition:vr(dr.definition)};if(dr instanceof lr)return{type:"Option",idx:dr.idx,definition:vr(dr.definition)};if(dr instanceof cr)return{type:"RepetitionMandatory",idx:dr.idx,definition:vr(dr.definition)};if(dr instanceof hr)return{type:"RepetitionMandatoryWithSeparator",idx:dr.idx,separator:mr(new gr({terminalType:dr.separator})),definition:vr(dr.definition)};if(dr instanceof ur)return{type:"RepetitionWithSeparator",idx:dr.idx,separator:mr(new gr({terminalType:dr.separator})),definition:vr(dr.definition)};if(dr instanceof fr)return{type:"Repetition",idx:dr.idx,definition:vr(dr.definition)};if(dr instanceof pr)return{type:"Alternation",idx:dr.idx,definition:vr(dr.definition)};if(dr instanceof gr){var Ar={type:"Terminal",name:dr.terminalType.name,label:rr.tokenLabel(dr.terminalType),idx:dr.idx},yr=dr.terminalType.PATTERN;return dr.terminalType.PATTERN&&(Ar.pattern=tr.isRegExp(yr)?yr.source:yr),Ar}else{if(dr instanceof ar)return{type:"Rule",name:dr.name,orgText:dr.orgText,definition:vr(dr.definition)};throw Error("non exhaustive match")}}ir.serializeProduction=mr}),Gt=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.RestWalker=void 0;var er=k(),tr=ne(),rr=function(){function sr(){}return sr.prototype.walk=function(ar,or){var lr=this;or===void 0&&(or=[]),er.forEach(ar.definition,function(cr,hr){var fr=er.drop(ar.definition,hr+1);if(cr instanceof tr.NonTerminal)lr.walkProdRef(cr,fr,or);else if(cr instanceof tr.Terminal)lr.walkTerminal(cr,fr,or);else if(cr instanceof tr.Alternative)lr.walkFlat(cr,fr,or);else if(cr instanceof tr.Option)lr.walkOption(cr,fr,or);else if(cr instanceof tr.RepetitionMandatory)lr.walkAtLeastOne(cr,fr,or);else if(cr instanceof tr.RepetitionMandatoryWithSeparator)lr.walkAtLeastOneSep(cr,fr,or);else if(cr instanceof tr.RepetitionWithSeparator)lr.walkManySep(cr,fr,or);else if(cr instanceof tr.Repetition)lr.walkMany(cr,fr,or);else if(cr instanceof tr.Alternation)lr.walkOr(cr,fr,or);else throw Error("non exhaustive match")})},sr.prototype.walkTerminal=function(ar,or,lr){},sr.prototype.walkProdRef=function(ar,or,lr){},sr.prototype.walkFlat=function(ar,or,lr){var cr=or.concat(lr);this.walk(ar,cr)},sr.prototype.walkOption=function(ar,or,lr){var cr=or.concat(lr);this.walk(ar,cr)},sr.prototype.walkAtLeastOne=function(ar,or,lr){var cr=[new tr.Option({definition:ar.definition})].concat(or,lr);this.walk(ar,cr)},sr.prototype.walkAtLeastOneSep=function(ar,or,lr){var cr=nr(ar,or,lr);this.walk(ar,cr)},sr.prototype.walkMany=function(ar,or,lr){var cr=[new tr.Option({definition:ar.definition})].concat(or,lr);this.walk(ar,cr)},sr.prototype.walkManySep=function(ar,or,lr){var cr=nr(ar,or,lr);this.walk(ar,cr)},sr.prototype.walkOr=function(ar,or,lr){var cr=this,hr=or.concat(lr);er.forEach(ar.definition,function(fr){var ur=new tr.Alternative({definition:[fr]});cr.walk(ur,hr)})},sr}();ir.RestWalker=rr;function nr(sr,ar,or){var lr=[new tr.Option({definition:[new tr.Terminal({terminalType:sr.separator})].concat(sr.definition)})],cr=lr.concat(ar,or);return cr}}),$e=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.GAstVisitor=void 0;var er=ne(),tr=function(){function rr(){}return rr.prototype.visit=function(nr){var sr=nr;switch(sr.constructor){case er.NonTerminal:return this.visitNonTerminal(sr);case er.Alternative:return this.visitAlternative(sr);case er.Option:return this.visitOption(sr);case er.RepetitionMandatory:return this.visitRepetitionMandatory(sr);case er.RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(sr);case er.RepetitionWithSeparator:return this.visitRepetitionWithSeparator(sr);case er.Repetition:return this.visitRepetition(sr);case er.Alternation:return this.visitAlternation(sr);case er.Terminal:return this.visitTerminal(sr);case er.Rule:return this.visitRule(sr);default:throw Error("non exhaustive match")}},rr.prototype.visitNonTerminal=function(nr){},rr.prototype.visitAlternative=function(nr){},rr.prototype.visitOption=function(nr){},rr.prototype.visitRepetition=function(nr){},rr.prototype.visitRepetitionMandatory=function(nr){},rr.prototype.visitRepetitionMandatoryWithSeparator=function(nr){},rr.prototype.visitRepetitionWithSeparator=function(nr){},rr.prototype.visitAlternation=function(nr){},rr.prototype.visitTerminal=function(nr){},rr.prototype.visitRule=function(nr){},rr}();ir.GAstVisitor=tr}),vt=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var ur=function(pr,gr){return ur=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_r,mr){_r.__proto__=mr}||function(_r,mr){for(var dr in mr)Object.prototype.hasOwnProperty.call(mr,dr)&&(_r[dr]=mr[dr])},ur(pr,gr)};return function(pr,gr){if(typeof gr!="function"&&gr!==null)throw new TypeError("Class extends value "+String(gr)+" is not a constructor or null");ur(pr,gr);function _r(){this.constructor=pr}pr.prototype=gr===null?Object.create(gr):(_r.prototype=gr.prototype,new _r)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.collectMethods=ir.DslMethodsCollectorVisitor=ir.getProductionDslName=ir.isBranchingProd=ir.isOptionalProd=ir.isSequenceProd=void 0;var tr=k(),rr=ne(),nr=$e();function sr(ur){return ur instanceof rr.Alternative||ur instanceof rr.Option||ur instanceof rr.Repetition||ur instanceof rr.RepetitionMandatory||ur instanceof rr.RepetitionMandatoryWithSeparator||ur instanceof rr.RepetitionWithSeparator||ur instanceof rr.Terminal||ur instanceof rr.Rule}ir.isSequenceProd=sr;function ar(ur,pr){pr===void 0&&(pr=[]);var gr=ur instanceof rr.Option||ur instanceof rr.Repetition||ur instanceof rr.RepetitionWithSeparator;return gr?!0:ur instanceof rr.Alternation?tr.some(ur.definition,function(_r){return ar(_r,pr)}):ur instanceof rr.NonTerminal&&tr.contains(pr,ur)?!1:ur instanceof rr.AbstractProduction?(ur instanceof rr.NonTerminal&&pr.push(ur),tr.every(ur.definition,function(_r){return ar(_r,pr)})):!1}ir.isOptionalProd=ar;function or(ur){return ur instanceof rr.Alternation}ir.isBranchingProd=or;function lr(ur){if(ur instanceof rr.NonTerminal)return"SUBRULE";if(ur instanceof rr.Option)return"OPTION";if(ur instanceof rr.Alternation)return"OR";if(ur instanceof rr.RepetitionMandatory)return"AT_LEAST_ONE";if(ur instanceof rr.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(ur instanceof rr.RepetitionWithSeparator)return"MANY_SEP";if(ur instanceof rr.Repetition)return"MANY";if(ur instanceof rr.Terminal)return"CONSUME";throw Error("non exhaustive match")}ir.getProductionDslName=lr;var cr=function(ur){er(pr,ur);function pr(){var gr=ur!==null&&ur.apply(this,arguments)||this;return gr.separator="-",gr.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},gr}return pr.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},pr.prototype.visitTerminal=function(gr){var _r=gr.terminalType.name+this.separator+"Terminal";tr.has(this.dslMethods,_r)||(this.dslMethods[_r]=[]),this.dslMethods[_r].push(gr)},pr.prototype.visitNonTerminal=function(gr){var _r=gr.nonTerminalName+this.separator+"Terminal";tr.has(this.dslMethods,_r)||(this.dslMethods[_r]=[]),this.dslMethods[_r].push(gr)},pr.prototype.visitOption=function(gr){this.dslMethods.option.push(gr)},pr.prototype.visitRepetitionWithSeparator=function(gr){this.dslMethods.repetitionWithSeparator.push(gr)},pr.prototype.visitRepetitionMandatory=function(gr){this.dslMethods.repetitionMandatory.push(gr)},pr.prototype.visitRepetitionMandatoryWithSeparator=function(gr){this.dslMethods.repetitionMandatoryWithSeparator.push(gr)},pr.prototype.visitRepetition=function(gr){this.dslMethods.repetition.push(gr)},pr.prototype.visitAlternation=function(gr){this.dslMethods.alternation.push(gr)},pr}(nr.GAstVisitor);ir.DslMethodsCollectorVisitor=cr;var hr=new cr;function fr(ur){hr.reset(),ur.accept(hr);var pr=hr.dslMethods;return hr.reset(),pr}ir.collectMethods=fr}),Lr=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.firstForTerminal=ir.firstForBranching=ir.firstForSequence=ir.first=void 0;var er=k(),tr=ne(),rr=vt();function nr(lr){if(lr instanceof tr.NonTerminal)return nr(lr.referencedRule);if(lr instanceof tr.Terminal)return or(lr);if(rr.isSequenceProd(lr))return sr(lr);if(rr.isBranchingProd(lr))return ar(lr);throw Error("non exhaustive match")}ir.first=nr;function sr(lr){for(var cr=[],hr=lr.definition,fr=0,ur=hr.length>fr,pr,gr=!0;ur&&gr;)pr=hr[fr],gr=rr.isOptionalProd(pr),cr=cr.concat(nr(pr)),fr=fr+1,ur=hr.length>fr;return er.uniq(cr)}ir.firstForSequence=sr;function ar(lr){var cr=er.map(lr.definition,function(hr){return nr(hr)});return er.uniq(er.flatten(cr))}ir.firstForBranching=ar;function or(lr){return[lr.terminalType]}ir.firstForTerminal=or}),Mr=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.IN=void 0,ir.IN="_~IN~_"}),pi=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var fr=function(ur,pr){return fr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(gr,_r){gr.__proto__=_r}||function(gr,_r){for(var mr in _r)Object.prototype.hasOwnProperty.call(_r,mr)&&(gr[mr]=_r[mr])},fr(ur,pr)};return function(ur,pr){if(typeof pr!="function"&&pr!==null)throw new TypeError("Class extends value "+String(pr)+" is not a constructor or null");fr(ur,pr);function gr(){this.constructor=ur}ur.prototype=pr===null?Object.create(pr):(gr.prototype=pr.prototype,new gr)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.buildInProdFollowPrefix=ir.buildBetweenProdsFollowPrefix=ir.computeAllProdsFollows=ir.ResyncFollowsWalker=void 0;var tr=Gt(),rr=Lr(),nr=k(),sr=Mr(),ar=ne(),or=function(fr){er(ur,fr);function ur(pr){var gr=fr.call(this)||this;return gr.topProd=pr,gr.follows={},gr}return ur.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},ur.prototype.walkTerminal=function(pr,gr,_r){},ur.prototype.walkProdRef=function(pr,gr,_r){var mr=cr(pr.referencedRule,pr.idx)+this.topProd.name,dr=gr.concat(_r),vr=new ar.Alternative({definition:dr}),Ar=rr.first(vr);this.follows[mr]=Ar},ur}(tr.RestWalker);ir.ResyncFollowsWalker=or;function lr(fr){var ur={};return nr.forEach(fr,function(pr){var gr=new or(pr).startWalking();nr.assign(ur,gr)}),ur}ir.computeAllProdsFollows=lr;function cr(fr,ur){return fr.name+ur+sr.IN}ir.buildBetweenProdsFollowPrefix=cr;function hr(fr){var ur=fr.terminalType.name;return ur+fr.idx+sr.IN}ir.buildInProdFollowPrefix=hr}),mt=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.defaultGrammarValidatorErrorProvider=ir.defaultGrammarResolverErrorProvider=ir.defaultParserErrorProvider=void 0;var er=Ue(),tr=k(),rr=k(),nr=ne(),sr=vt();ir.defaultParserErrorProvider={buildMismatchTokenMessage:function(ar){var or=ar.expected,lr=ar.actual,cr=ar.previous,hr=ar.ruleName,fr=er.hasTokenLabel(or),ur=fr?"--> "+er.tokenLabel(or)+" <--":"token of type --> "+or.name+" <--",pr="Expecting "+ur+" but found --> '"+lr.image+"' <--";return pr},buildNotAllInputParsedMessage:function(ar){var or=ar.firstRedundant,lr=ar.ruleName;return"Redundant input, expecting EOF but found: "+or.image},buildNoViableAltMessage:function(ar){var or=ar.expectedPathsPerAlt,lr=ar.actual,cr=ar.previous,hr=ar.customUserDescription,fr=ar.ruleName,ur="Expecting: ",pr=rr.first(lr).image,gr=`
but found: '`+pr+"'";if(hr)return ur+hr+gr;var _r=rr.reduce(or,function(Ar,yr){return Ar.concat(yr)},[]),mr=rr.map(_r,function(Ar){return"["+rr.map(Ar,function(yr){return er.tokenLabel(yr)}).join(", ")+"]"}),dr=rr.map(mr,function(Ar,yr){return"  "+(yr+1)+". "+Ar}),vr=`one of these possible Token sequences:
`+dr.join(`
`);return ur+vr+gr},buildEarlyExitMessage:function(ar){var or=ar.expectedIterationPaths,lr=ar.actual,cr=ar.customUserDescription,hr=ar.ruleName,fr="Expecting: ",ur=rr.first(lr).image,pr=`
but found: '`+ur+"'";if(cr)return fr+cr+pr;var gr=rr.map(or,function(mr){return"["+rr.map(mr,function(dr){return er.tokenLabel(dr)}).join(",")+"]"}),_r=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+("<"+gr.join(" ,")+">");return fr+_r+pr}},Object.freeze(ir.defaultParserErrorProvider),ir.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(ar,or){var lr="Invalid grammar, reference to a rule which is not defined: ->"+or.nonTerminalName+`<-
inside top level rule: ->`+ar.name+"<-";return lr}},ir.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(ar,or){function lr(mr){return mr instanceof nr.Terminal?mr.terminalType.name:mr instanceof nr.NonTerminal?mr.nonTerminalName:""}var cr=ar.name,hr=rr.first(or),fr=hr.idx,ur=sr.getProductionDslName(hr),pr=lr(hr),gr=fr>0,_r="->"+ur+(gr?fr:"")+"<- "+(pr?"with argument: ->"+pr+"<-":"")+`
                  appears more than once (`+or.length+" times) in the top level rule: ->"+cr+`<-.
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES
                  `;return _r=_r.replace(/[ \t]+/g," "),_r=_r.replace(/\s\s+/g,`
`),_r},buildNamespaceConflictError:function(ar){var or=`Namespace conflict found in grammar.
`+("The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+ar.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return or},buildAlternationPrefixAmbiguityError:function(ar){var or=rr.map(ar.prefixPath,function(hr){return er.tokenLabel(hr)}).join(", "),lr=ar.alternation.idx===0?"":ar.alternation.idx,cr="Ambiguous alternatives: <"+ar.ambiguityIndices.join(" ,")+`> due to common lookahead prefix
`+("in <OR"+lr+"> inside <"+ar.topLevelRule.name+`> Rule,
`)+("<"+or+`> may appears as a prefix path in all these alternatives.
`)+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return cr},buildAlternationAmbiguityError:function(ar){var or=rr.map(ar.prefixPath,function(hr){return er.tokenLabel(hr)}).join(", "),lr=ar.alternation.idx===0?"":ar.alternation.idx,cr="Ambiguous Alternatives Detected: <"+ar.ambiguityIndices.join(" ,")+"> in <OR"+lr+">"+(" inside <"+ar.topLevelRule.name+`> Rule,
`)+("<"+or+`> may appears as a prefix path in all these alternatives.
`);return cr=cr+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,cr},buildEmptyRepetitionError:function(ar){var or=sr.getProductionDslName(ar.repetition);ar.repetition.idx!==0&&(or+=ar.repetition.idx);var lr="The repetition <"+or+"> within Rule <"+ar.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`;return lr},buildTokenNameError:function(ar){return"deprecated"},buildEmptyAlternationError:function(ar){var or="Ambiguous empty alternative: <"+(ar.emptyChoiceIdx+1)+">"+(" in <OR"+ar.alternation.idx+"> inside <"+ar.topLevelRule.name+`> Rule.
`)+"Only the last alternative may be an empty alternative.";return or},buildTooManyAlternativesError:function(ar){var or=`An Alternation cannot have more than 256 alternatives:
`+("<OR"+ar.alternation.idx+"> inside <"+ar.topLevelRule.name+`> Rule.
 has `+(ar.alternation.definition.length+1)+" alternatives.");return or},buildLeftRecursionError:function(ar){var or=ar.topLevelRule.name,lr=tr.map(ar.leftRecursionPath,function(fr){return fr.name}),cr=or+" --> "+lr.concat([or]).join(" --> "),hr=`Left Recursion found in grammar.
`+("rule: <"+or+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is:
 `+cr+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`;return hr},buildInvalidRuleNameError:function(ar){return"deprecated"},buildDuplicateRuleNameError:function(ar){var or;ar.topLevelRule instanceof nr.Rule?or=ar.topLevelRule.name:or=ar.topLevelRule;var lr="Duplicate definition, rule: ->"+or+"<- is already defined in the grammar: ->"+ar.grammarName+"<-";return lr}}}),mi=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var or=function(lr,cr){return or=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(hr,fr){hr.__proto__=fr}||function(hr,fr){for(var ur in fr)Object.prototype.hasOwnProperty.call(fr,ur)&&(hr[ur]=fr[ur])},or(lr,cr)};return function(lr,cr){if(typeof cr!="function"&&cr!==null)throw new TypeError("Class extends value "+String(cr)+" is not a constructor or null");or(lr,cr);function hr(){this.constructor=lr}lr.prototype=cr===null?Object.create(cr):(hr.prototype=cr.prototype,new hr)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.GastRefResolverVisitor=ir.resolveGrammar=void 0;var tr=ce(),rr=k(),nr=$e();function sr(or,lr){var cr=new ar(or,lr);return cr.resolveRefs(),cr.errors}ir.resolveGrammar=sr;var ar=function(or){er(lr,or);function lr(cr,hr){var fr=or.call(this)||this;return fr.nameToTopRule=cr,fr.errMsgProvider=hr,fr.errors=[],fr}return lr.prototype.resolveRefs=function(){var cr=this;rr.forEach(rr.values(this.nameToTopRule),function(hr){cr.currTopLevel=hr,hr.accept(cr)})},lr.prototype.visitNonTerminal=function(cr){var hr=this.nameToTopRule[cr.nonTerminalName];if(hr)cr.referencedRule=hr;else{var fr=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,cr);this.errors.push({message:fr,type:tr.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:cr.nonTerminalName})}},lr}(nr.GAstVisitor);ir.GastRefResolverVisitor=ar}),Tt=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var mr=function(dr,vr){return mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Ar,yr){Ar.__proto__=yr}||function(Ar,yr){for(var wr in yr)Object.prototype.hasOwnProperty.call(yr,wr)&&(Ar[wr]=yr[wr])},mr(dr,vr)};return function(dr,vr){if(typeof vr!="function"&&vr!==null)throw new TypeError("Class extends value "+String(vr)+" is not a constructor or null");mr(dr,vr);function Ar(){this.constructor=dr}dr.prototype=vr===null?Object.create(vr):(Ar.prototype=vr.prototype,new Ar)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.nextPossibleTokensAfter=ir.possiblePathsFrom=ir.NextTerminalAfterAtLeastOneSepWalker=ir.NextTerminalAfterAtLeastOneWalker=ir.NextTerminalAfterManySepWalker=ir.NextTerminalAfterManyWalker=ir.AbstractNextTerminalAfterProductionWalker=ir.NextAfterTokenWalker=ir.AbstractNextPossibleTokensWalker=void 0;var tr=Gt(),rr=k(),nr=Lr(),sr=ne(),ar=function(mr){er(dr,mr);function dr(vr,Ar){var yr=mr.call(this)||this;return yr.topProd=vr,yr.path=Ar,yr.possibleTokTypes=[],yr.nextProductionName="",yr.nextProductionOccurrence=0,yr.found=!1,yr.isAtEndOfPath=!1,yr}return dr.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=rr.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=rr.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},dr.prototype.walk=function(vr,Ar){Ar===void 0&&(Ar=[]),this.found||mr.prototype.walk.call(this,vr,Ar)},dr.prototype.walkProdRef=function(vr,Ar,yr){if(vr.referencedRule.name===this.nextProductionName&&vr.idx===this.nextProductionOccurrence){var wr=Ar.concat(yr);this.updateExpectedNext(),this.walk(vr.referencedRule,wr)}},dr.prototype.updateExpectedNext=function(){rr.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},dr}(tr.RestWalker);ir.AbstractNextPossibleTokensWalker=ar;var or=function(mr){er(dr,mr);function dr(vr,Ar){var yr=mr.call(this,vr,Ar)||this;return yr.path=Ar,yr.nextTerminalName="",yr.nextTerminalOccurrence=0,yr.nextTerminalName=yr.path.lastTok.name,yr.nextTerminalOccurrence=yr.path.lastTokOccurrence,yr}return dr.prototype.walkTerminal=function(vr,Ar,yr){if(this.isAtEndOfPath&&vr.terminalType.name===this.nextTerminalName&&vr.idx===this.nextTerminalOccurrence&&!this.found){var wr=Ar.concat(yr),br=new sr.Alternative({definition:wr});this.possibleTokTypes=nr.first(br),this.found=!0}},dr}(ar);ir.NextAfterTokenWalker=or;var lr=function(mr){er(dr,mr);function dr(vr,Ar){var yr=mr.call(this)||this;return yr.topRule=vr,yr.occurrence=Ar,yr.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},yr}return dr.prototype.startWalking=function(){return this.walk(this.topRule),this.result},dr}(tr.RestWalker);ir.AbstractNextTerminalAfterProductionWalker=lr;var cr=function(mr){er(dr,mr);function dr(){return mr!==null&&mr.apply(this,arguments)||this}return dr.prototype.walkMany=function(vr,Ar,yr){if(vr.idx===this.occurrence){var wr=rr.first(Ar.concat(yr));this.result.isEndOfRule=wr===void 0,wr instanceof sr.Terminal&&(this.result.token=wr.terminalType,this.result.occurrence=wr.idx)}else mr.prototype.walkMany.call(this,vr,Ar,yr)},dr}(lr);ir.NextTerminalAfterManyWalker=cr;var hr=function(mr){er(dr,mr);function dr(){return mr!==null&&mr.apply(this,arguments)||this}return dr.prototype.walkManySep=function(vr,Ar,yr){if(vr.idx===this.occurrence){var wr=rr.first(Ar.concat(yr));this.result.isEndOfRule=wr===void 0,wr instanceof sr.Terminal&&(this.result.token=wr.terminalType,this.result.occurrence=wr.idx)}else mr.prototype.walkManySep.call(this,vr,Ar,yr)},dr}(lr);ir.NextTerminalAfterManySepWalker=hr;var fr=function(mr){er(dr,mr);function dr(){return mr!==null&&mr.apply(this,arguments)||this}return dr.prototype.walkAtLeastOne=function(vr,Ar,yr){if(vr.idx===this.occurrence){var wr=rr.first(Ar.concat(yr));this.result.isEndOfRule=wr===void 0,wr instanceof sr.Terminal&&(this.result.token=wr.terminalType,this.result.occurrence=wr.idx)}else mr.prototype.walkAtLeastOne.call(this,vr,Ar,yr)},dr}(lr);ir.NextTerminalAfterAtLeastOneWalker=fr;var ur=function(mr){er(dr,mr);function dr(){return mr!==null&&mr.apply(this,arguments)||this}return dr.prototype.walkAtLeastOneSep=function(vr,Ar,yr){if(vr.idx===this.occurrence){var wr=rr.first(Ar.concat(yr));this.result.isEndOfRule=wr===void 0,wr instanceof sr.Terminal&&(this.result.token=wr.terminalType,this.result.occurrence=wr.idx)}else mr.prototype.walkAtLeastOneSep.call(this,vr,Ar,yr)},dr}(lr);ir.NextTerminalAfterAtLeastOneSepWalker=ur;function pr(mr,dr,vr){vr===void 0&&(vr=[]),vr=rr.cloneArr(vr);var Ar=[],yr=0;function wr(Cr){return Cr.concat(rr.drop(mr,yr+1))}function br(Cr){var Ir=pr(wr(Cr),dr,vr);return Ar.concat(Ir)}for(;vr.length<dr&&yr<mr.length;){var Sr=mr[yr];if(Sr instanceof sr.Alternative||Sr instanceof sr.NonTerminal)return br(Sr.definition);if(Sr instanceof sr.Option)Ar=br(Sr.definition);else if(Sr instanceof sr.RepetitionMandatory){var xr=Sr.definition.concat([new sr.Repetition({definition:Sr.definition})]);return br(xr)}else if(Sr instanceof sr.RepetitionMandatoryWithSeparator){var xr=[new sr.Alternative({definition:Sr.definition}),new sr.Repetition({definition:[new sr.Terminal({terminalType:Sr.separator})].concat(Sr.definition)})];return br(xr)}else if(Sr instanceof sr.RepetitionWithSeparator){var xr=Sr.definition.concat([new sr.Repetition({definition:[new sr.Terminal({terminalType:Sr.separator})].concat(Sr.definition)})]);Ar=br(xr)}else if(Sr instanceof sr.Repetition){var xr=Sr.definition.concat([new sr.Repetition({definition:Sr.definition})]);Ar=br(xr)}else{if(Sr instanceof sr.Alternation)return rr.forEach(Sr.definition,function(Cr){rr.isEmpty(Cr.definition)===!1&&(Ar=br(Cr.definition))}),Ar;if(Sr instanceof sr.Terminal)vr.push(Sr.terminalType);else throw Error("non exhaustive match")}yr++}return Ar.push({partialPath:vr,suffixDef:rr.drop(mr,yr)}),Ar}ir.possiblePathsFrom=pr;function gr(mr,dr,vr,Ar){var yr="EXIT_NONE_TERMINAL",wr=[yr],br="EXIT_ALTERNATIVE",Sr=!1,xr=dr.length,Cr=xr-Ar-1,Ir=[],Rr=[];for(Rr.push({idx:-1,def:mr,ruleStack:[],occurrenceStack:[]});!rr.isEmpty(Rr);){var Pr=Rr.pop();if(Pr===br){Sr&&rr.last(Rr).idx<=Cr&&Rr.pop();continue}var Fr=Pr.def,Nr=Pr.idx,Ur=Pr.ruleStack,Br=Pr.occurrenceStack;if(!rr.isEmpty(Fr)){var Or=Fr[0];if(Or===yr){var Dr={idx:Nr,def:rr.drop(Fr),ruleStack:rr.dropRight(Ur),occurrenceStack:rr.dropRight(Br)};Rr.push(Dr)}else if(Or instanceof sr.Terminal)if(Nr<xr-1){var Wr=Nr+1,$r=dr[Wr];if(vr($r,Or.terminalType)){var Dr={idx:Wr,def:rr.drop(Fr),ruleStack:Ur,occurrenceStack:Br};Rr.push(Dr)}}else if(Nr===xr-1)Ir.push({nextTokenType:Or.terminalType,nextTokenOccurrence:Or.idx,ruleStack:Ur,occurrenceStack:Br}),Sr=!0;else throw Error("non exhaustive match");else if(Or instanceof sr.NonTerminal){var Yr=rr.cloneArr(Ur);Yr.push(Or.nonTerminalName);var Qi=rr.cloneArr(Br);Qi.push(Or.idx);var Dr={idx:Nr,def:Or.definition.concat(wr,rr.drop(Fr)),ruleStack:Yr,occurrenceStack:Qi};Rr.push(Dr)}else if(Or instanceof sr.Option){var rs={idx:Nr,def:rr.drop(Fr),ruleStack:Ur,occurrenceStack:Br};Rr.push(rs),Rr.push(br);var Kr={idx:Nr,def:Or.definition.concat(rr.drop(Fr)),ruleStack:Ur,occurrenceStack:Br};Rr.push(Kr)}else if(Or instanceof sr.RepetitionMandatory){var Qr=new sr.Repetition({definition:Or.definition,idx:Or.idx}),Vr=Or.definition.concat([Qr],rr.drop(Fr)),Dr={idx:Nr,def:Vr,ruleStack:Ur,occurrenceStack:Br};Rr.push(Dr)}else if(Or instanceof sr.RepetitionMandatoryWithSeparator){var Gr=new sr.Terminal({terminalType:Or.separator}),Qr=new sr.Repetition({definition:[Gr].concat(Or.definition),idx:Or.idx}),Vr=Or.definition.concat([Qr],rr.drop(Fr)),Dr={idx:Nr,def:Vr,ruleStack:Ur,occurrenceStack:Br};Rr.push(Dr)}else if(Or instanceof sr.RepetitionWithSeparator){var rs={idx:Nr,def:rr.drop(Fr),ruleStack:Ur,occurrenceStack:Br};Rr.push(rs),Rr.push(br);var Gr=new sr.Terminal({terminalType:Or.separator}),qr=new sr.Repetition({definition:[Gr].concat(Or.definition),idx:Or.idx}),Vr=Or.definition.concat([qr],rr.drop(Fr)),Kr={idx:Nr,def:Vr,ruleStack:Ur,occurrenceStack:Br};Rr.push(Kr)}else if(Or instanceof sr.Repetition){var rs={idx:Nr,def:rr.drop(Fr),ruleStack:Ur,occurrenceStack:Br};Rr.push(rs),Rr.push(br);var qr=new sr.Repetition({definition:Or.definition,idx:Or.idx}),Vr=Or.definition.concat([qr],rr.drop(Fr)),Kr={idx:Nr,def:Vr,ruleStack:Ur,occurrenceStack:Br};Rr.push(Kr)}else if(Or instanceof sr.Alternation)for(var ji=Or.definition.length-1;ji>=0;ji--){var Zr=Or.definition[ji],Zi={idx:Nr,def:Zr.definition.concat(rr.drop(Fr)),ruleStack:Ur,occurrenceStack:Br};Rr.push(Zi),Rr.push(br)}else if(Or instanceof sr.Alternative)Rr.push({idx:Nr,def:Or.definition.concat(rr.drop(Fr)),ruleStack:Ur,occurrenceStack:Br});else if(Or instanceof sr.Rule)Rr.push(_r(Or,Nr,Ur,Br));else throw Error("non exhaustive match")}}return Ir}ir.nextPossibleTokensAfter=gr;function _r(mr,dr,vr,Ar){var yr=rr.cloneArr(vr);yr.push(mr.name);var wr=rr.cloneArr(Ar);return wr.push(1),{idx:dr,def:mr.definition,ruleStack:yr,occurrenceStack:wr}}}),yt=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var Cr=function(Ir,Rr){return Cr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Pr,Fr){Pr.__proto__=Fr}||function(Pr,Fr){for(var Nr in Fr)Object.prototype.hasOwnProperty.call(Fr,Nr)&&(Pr[Nr]=Fr[Nr])},Cr(Ir,Rr)};return function(Ir,Rr){if(typeof Rr!="function"&&Rr!==null)throw new TypeError("Class extends value "+String(Rr)+" is not a constructor or null");Cr(Ir,Rr);function Pr(){this.constructor=Ir}Ir.prototype=Rr===null?Object.create(Rr):(Pr.prototype=Rr.prototype,new Pr)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.areTokenCategoriesNotUsed=ir.isStrictPrefixOfPath=ir.containsPath=ir.getLookaheadPathsForOptionalProd=ir.getLookaheadPathsForOr=ir.lookAheadSequenceFromAlternatives=ir.buildSingleAlternativeLookaheadFunction=ir.buildAlternativesLookAheadFunc=ir.buildLookaheadFuncForOptionalProd=ir.buildLookaheadFuncForOr=ir.getProdType=ir.PROD_TYPE=void 0;var tr=k(),rr=Tt(),nr=Gt(),sr=Xe(),ar=ne(),or=$e(),lr;(function(Cr){Cr[Cr.OPTION=0]="OPTION",Cr[Cr.REPETITION=1]="REPETITION",Cr[Cr.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",Cr[Cr.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",Cr[Cr.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",Cr[Cr.ALTERNATION=5]="ALTERNATION"})(lr=ir.PROD_TYPE||(ir.PROD_TYPE={}));function cr(Cr){if(Cr instanceof ar.Option)return lr.OPTION;if(Cr instanceof ar.Repetition)return lr.REPETITION;if(Cr instanceof ar.RepetitionMandatory)return lr.REPETITION_MANDATORY;if(Cr instanceof ar.RepetitionMandatoryWithSeparator)return lr.REPETITION_MANDATORY_WITH_SEPARATOR;if(Cr instanceof ar.RepetitionWithSeparator)return lr.REPETITION_WITH_SEPARATOR;if(Cr instanceof ar.Alternation)return lr.ALTERNATION;throw Error("non exhaustive match")}ir.getProdType=cr;function hr(Cr,Ir,Rr,Pr,Fr,Nr){var Ur=yr(Cr,Ir,Rr),Br=xr(Ur)?sr.tokenStructuredMatcherNoCategories:sr.tokenStructuredMatcher;return Nr(Ur,Pr,Br,Fr)}ir.buildLookaheadFuncForOr=hr;function fr(Cr,Ir,Rr,Pr,Fr,Nr){var Ur=wr(Cr,Ir,Fr,Rr),Br=xr(Ur)?sr.tokenStructuredMatcherNoCategories:sr.tokenStructuredMatcher;return Nr(Ur[0],Br,Pr)}ir.buildLookaheadFuncForOptionalProd=fr;function ur(Cr,Ir,Rr,Pr){var Fr=Cr.length,Nr=tr.every(Cr,function(Or){return tr.every(Or,function(Dr){return Dr.length===1})});if(Ir)return function(Or){for(var Dr=tr.map(Or,function(qr){return qr.GATE}),Wr=0;Wr<Fr;Wr++){var $r=Cr[Wr],Yr=$r.length,Qi=Dr[Wr];if(!(Qi!==void 0&&Qi.call(this)===!1))e:for(var rs=0;rs<Yr;rs++){for(var Kr=$r[rs],Qr=Kr.length,Vr=0;Vr<Qr;Vr++){var Gr=this.LA(Vr+1);if(Rr(Gr,Kr[Vr])===!1)continue e}return Wr}}};if(Nr&&!Pr){var Ur=tr.map(Cr,function(Or){return tr.flatten(Or)}),Br=tr.reduce(Ur,function(Or,Dr,Wr){return tr.forEach(Dr,function($r){tr.has(Or,$r.tokenTypeIdx)||(Or[$r.tokenTypeIdx]=Wr),tr.forEach($r.categoryMatches,function(Yr){tr.has(Or,Yr)||(Or[Yr]=Wr)})}),Or},[]);return function(){var Or=this.LA(1);return Br[Or.tokenTypeIdx]}}else return function(){for(var Or=0;Or<Fr;Or++){var Dr=Cr[Or],Wr=Dr.length;e:for(var $r=0;$r<Wr;$r++){for(var Yr=Dr[$r],Qi=Yr.length,rs=0;rs<Qi;rs++){var Kr=this.LA(rs+1);if(Rr(Kr,Yr[rs])===!1)continue e}return Or}}}}ir.buildAlternativesLookAheadFunc=ur;function pr(Cr,Ir,Rr){var Pr=tr.every(Cr,function(Dr){return Dr.length===1}),Fr=Cr.length;if(Pr&&!Rr){var Nr=tr.flatten(Cr);if(Nr.length===1&&tr.isEmpty(Nr[0].categoryMatches)){var Ur=Nr[0],Br=Ur.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===Br}}else{var Or=tr.reduce(Nr,function(Dr,Wr,$r){return Dr[Wr.tokenTypeIdx]=!0,tr.forEach(Wr.categoryMatches,function(Yr){Dr[Yr]=!0}),Dr},[]);return function(){var Dr=this.LA(1);return Or[Dr.tokenTypeIdx]===!0}}}else return function(){e:for(var Dr=0;Dr<Fr;Dr++){for(var Wr=Cr[Dr],$r=Wr.length,Yr=0;Yr<$r;Yr++){var Qi=this.LA(Yr+1);if(Ir(Qi,Wr[Yr])===!1)continue e}return!0}return!1}}ir.buildSingleAlternativeLookaheadFunction=pr;var gr=function(Cr){er(Ir,Cr);function Ir(Rr,Pr,Fr){var Nr=Cr.call(this)||this;return Nr.topProd=Rr,Nr.targetOccurrence=Pr,Nr.targetProdType=Fr,Nr}return Ir.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},Ir.prototype.checkIsTarget=function(Rr,Pr,Fr,Nr){return Rr.idx===this.targetOccurrence&&this.targetProdType===Pr?(this.restDef=Fr.concat(Nr),!0):!1},Ir.prototype.walkOption=function(Rr,Pr,Fr){this.checkIsTarget(Rr,lr.OPTION,Pr,Fr)||Cr.prototype.walkOption.call(this,Rr,Pr,Fr)},Ir.prototype.walkAtLeastOne=function(Rr,Pr,Fr){this.checkIsTarget(Rr,lr.REPETITION_MANDATORY,Pr,Fr)||Cr.prototype.walkOption.call(this,Rr,Pr,Fr)},Ir.prototype.walkAtLeastOneSep=function(Rr,Pr,Fr){this.checkIsTarget(Rr,lr.REPETITION_MANDATORY_WITH_SEPARATOR,Pr,Fr)||Cr.prototype.walkOption.call(this,Rr,Pr,Fr)},Ir.prototype.walkMany=function(Rr,Pr,Fr){this.checkIsTarget(Rr,lr.REPETITION,Pr,Fr)||Cr.prototype.walkOption.call(this,Rr,Pr,Fr)},Ir.prototype.walkManySep=function(Rr,Pr,Fr){this.checkIsTarget(Rr,lr.REPETITION_WITH_SEPARATOR,Pr,Fr)||Cr.prototype.walkOption.call(this,Rr,Pr,Fr)},Ir}(nr.RestWalker),_r=function(Cr){er(Ir,Cr);function Ir(Rr,Pr,Fr){var Nr=Cr.call(this)||this;return Nr.targetOccurrence=Rr,Nr.targetProdType=Pr,Nr.targetRef=Fr,Nr.result=[],Nr}return Ir.prototype.checkIsTarget=function(Rr,Pr){Rr.idx===this.targetOccurrence&&this.targetProdType===Pr&&(this.targetRef===void 0||Rr===this.targetRef)&&(this.result=Rr.definition)},Ir.prototype.visitOption=function(Rr){this.checkIsTarget(Rr,lr.OPTION)},Ir.prototype.visitRepetition=function(Rr){this.checkIsTarget(Rr,lr.REPETITION)},Ir.prototype.visitRepetitionMandatory=function(Rr){this.checkIsTarget(Rr,lr.REPETITION_MANDATORY)},Ir.prototype.visitRepetitionMandatoryWithSeparator=function(Rr){this.checkIsTarget(Rr,lr.REPETITION_MANDATORY_WITH_SEPARATOR)},Ir.prototype.visitRepetitionWithSeparator=function(Rr){this.checkIsTarget(Rr,lr.REPETITION_WITH_SEPARATOR)},Ir.prototype.visitAlternation=function(Rr){this.checkIsTarget(Rr,lr.ALTERNATION)},Ir}(or.GAstVisitor);function mr(Cr){for(var Ir=new Array(Cr),Rr=0;Rr<Cr;Rr++)Ir[Rr]=[];return Ir}function dr(Cr){for(var Ir=[""],Rr=0;Rr<Cr.length;Rr++){for(var Pr=Cr[Rr],Fr=[],Nr=0;Nr<Ir.length;Nr++){var Ur=Ir[Nr];Fr.push(Ur+"_"+Pr.tokenTypeIdx);for(var Br=0;Br<Pr.categoryMatches.length;Br++){var Or="_"+Pr.categoryMatches[Br];Fr.push(Ur+Or)}}Ir=Fr}return Ir}function vr(Cr,Ir,Rr){for(var Pr=0;Pr<Cr.length;Pr++)if(Pr!==Rr)for(var Fr=Cr[Pr],Nr=0;Nr<Ir.length;Nr++){var Ur=Ir[Nr];if(Fr[Ur]===!0)return!1}return!0}function Ar(Cr,Ir){for(var Rr=tr.map(Cr,function(Wr){return rr.possiblePathsFrom([Wr],1)}),Pr=mr(Rr.length),Fr=tr.map(Rr,function(Wr){var $r={};return tr.forEach(Wr,function(Yr){var Qi=dr(Yr.partialPath);tr.forEach(Qi,function(rs){$r[rs]=!0})}),$r}),Nr=Rr,Ur=1;Ur<=Ir;Ur++){var Br=Nr;Nr=mr(Br.length);for(var Or=function(Wr){for(var $r=Br[Wr],Yr=0;Yr<$r.length;Yr++){var Qi=$r[Yr].partialPath,rs=$r[Yr].suffixDef,Kr=dr(Qi),Qr=vr(Fr,Kr,Wr);if(Qr||tr.isEmpty(rs)||Qi.length===Ir){var Vr=Pr[Wr];if(br(Vr,Qi)===!1){Vr.push(Qi);for(var Gr=0;Gr<Kr.length;Gr++){var qr=Kr[Gr];Fr[Wr][qr]=!0}}}else{var ji=rr.possiblePathsFrom(rs,Ur+1,Qi);Nr[Wr]=Nr[Wr].concat(ji),tr.forEach(ji,function(Zr){var Zi=dr(Zr.partialPath);tr.forEach(Zi,function(Yi){Fr[Wr][Yi]=!0})})}}},Dr=0;Dr<Br.length;Dr++)Or(Dr)}return Pr}ir.lookAheadSequenceFromAlternatives=Ar;function yr(Cr,Ir,Rr,Pr){var Fr=new _r(Cr,lr.ALTERNATION,Pr);return Ir.accept(Fr),Ar(Fr.result,Rr)}ir.getLookaheadPathsForOr=yr;function wr(Cr,Ir,Rr,Pr){var Fr=new _r(Cr,Rr);Ir.accept(Fr);var Nr=Fr.result,Ur=new gr(Ir,Cr,Rr),Br=Ur.startWalking(),Or=new ar.Alternative({definition:Nr}),Dr=new ar.Alternative({definition:Br});return Ar([Or,Dr],Pr)}ir.getLookaheadPathsForOptionalProd=wr;function br(Cr,Ir){e:for(var Rr=0;Rr<Cr.length;Rr++){var Pr=Cr[Rr];if(Pr.length===Ir.length){for(var Fr=0;Fr<Pr.length;Fr++){var Nr=Ir[Fr],Ur=Pr[Fr],Br=Nr===Ur||Ur.categoryMatchesMap[Nr.tokenTypeIdx]!==void 0;if(Br===!1)continue e}return!0}}return!1}ir.containsPath=br;function Sr(Cr,Ir){return Cr.length<Ir.length&&tr.every(Cr,function(Rr,Pr){var Fr=Ir[Pr];return Rr===Fr||Fr.categoryMatchesMap[Rr.tokenTypeIdx]})}ir.isStrictPrefixOfPath=Sr;function xr(Cr){return tr.every(Cr,function(Ir){return tr.every(Ir,function(Rr){return tr.every(Rr,function(Pr){return tr.isEmpty(Pr.categoryMatches)})})})}ir.areTokenCategoriesNotUsed=xr}),jr=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var Pr=function(Fr,Nr){return Pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Ur,Br){Ur.__proto__=Br}||function(Ur,Br){for(var Or in Br)Object.prototype.hasOwnProperty.call(Br,Or)&&(Ur[Or]=Br[Or])},Pr(Fr,Nr)};return function(Fr,Nr){if(typeof Nr!="function"&&Nr!==null)throw new TypeError("Class extends value "+String(Nr)+" is not a constructor or null");Pr(Fr,Nr);function Ur(){this.constructor=Fr}Fr.prototype=Nr===null?Object.create(Nr):(Ur.prototype=Nr.prototype,new Ur)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.checkPrefixAlternativesAmbiguities=ir.validateSomeNonEmptyLookaheadPath=ir.validateTooManyAlts=ir.RepetionCollector=ir.validateAmbiguousAlternationAlternatives=ir.validateEmptyOrAlternative=ir.getFirstNoneTerminal=ir.validateNoLeftRecursion=ir.validateRuleIsOverridden=ir.validateRuleDoesNotAlreadyExist=ir.OccurrenceValidationCollector=ir.identifyProductionForDuplicates=ir.validateGrammar=void 0;var tr=k(),rr=k(),nr=ce(),sr=vt(),ar=yt(),or=Tt(),lr=ne(),cr=$e();function hr(Pr,Fr,Nr,Ur,Br){var Or=tr.map(Pr,function(Qr){return fr(Qr,Ur)}),Dr=tr.map(Pr,function(Qr){return dr(Qr,Qr,Ur)}),Wr=[],$r=[],Yr=[];rr.every(Dr,rr.isEmpty)&&(Wr=rr.map(Pr,function(Qr){return yr(Qr,Ur)}),$r=rr.map(Pr,function(Qr){return wr(Qr,Fr,Ur)}),Yr=xr(Pr,Fr,Ur));var Qi=Rr(Pr,Nr,Ur),rs=rr.map(Pr,function(Qr){return Sr(Qr,Ur)}),Kr=rr.map(Pr,function(Qr){return _r(Qr,Pr,Br,Ur)});return tr.flatten(Or.concat(Yr,Dr,Wr,$r,Qi,rs,Kr))}ir.validateGrammar=hr;function fr(Pr,Fr){var Nr=new gr;Pr.accept(Nr);var Ur=Nr.allProductions,Br=tr.groupBy(Ur,ur),Or=tr.pick(Br,function(Wr){return Wr.length>1}),Dr=tr.map(tr.values(Or),function(Wr){var $r=tr.first(Wr),Yr=Fr.buildDuplicateFoundError(Pr,Wr),Qi=sr.getProductionDslName($r),rs={message:Yr,type:nr.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:Pr.name,dslName:Qi,occurrence:$r.idx},Kr=pr($r);return Kr&&(rs.parameter=Kr),rs});return Dr}function ur(Pr){return sr.getProductionDslName(Pr)+"_#_"+Pr.idx+"_#_"+pr(Pr)}ir.identifyProductionForDuplicates=ur;function pr(Pr){return Pr instanceof lr.Terminal?Pr.terminalType.name:Pr instanceof lr.NonTerminal?Pr.nonTerminalName:""}var gr=function(Pr){er(Fr,Pr);function Fr(){var Nr=Pr!==null&&Pr.apply(this,arguments)||this;return Nr.allProductions=[],Nr}return Fr.prototype.visitNonTerminal=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitOption=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitRepetitionWithSeparator=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitRepetitionMandatory=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitRepetitionMandatoryWithSeparator=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitRepetition=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitAlternation=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitTerminal=function(Nr){this.allProductions.push(Nr)},Fr}(cr.GAstVisitor);ir.OccurrenceValidationCollector=gr;function _r(Pr,Fr,Nr,Ur){var Br=[],Or=rr.reduce(Fr,function(Wr,$r){return $r.name===Pr.name?Wr+1:Wr},0);if(Or>1){var Dr=Ur.buildDuplicateRuleNameError({topLevelRule:Pr,grammarName:Nr});Br.push({message:Dr,type:nr.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:Pr.name})}return Br}ir.validateRuleDoesNotAlreadyExist=_r;function mr(Pr,Fr,Nr){var Ur=[],Br;return tr.contains(Fr,Pr)||(Br="Invalid rule override, rule: ->"+Pr+"<- cannot be overridden in the grammar: ->"+Nr+"<-as it is not defined in any of the super grammars ",Ur.push({message:Br,type:nr.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:Pr})),Ur}ir.validateRuleIsOverridden=mr;function dr(Pr,Fr,Nr,Ur){Ur===void 0&&(Ur=[]);var Br=[],Or=vr(Fr.definition);if(tr.isEmpty(Or))return[];var Dr=Pr.name,Wr=tr.contains(Or,Pr);Wr&&Br.push({message:Nr.buildLeftRecursionError({topLevelRule:Pr,leftRecursionPath:Ur}),type:nr.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:Dr});var $r=tr.difference(Or,Ur.concat([Pr])),Yr=tr.map($r,function(Qi){var rs=tr.cloneArr(Ur);return rs.push(Qi),dr(Pr,Qi,Nr,rs)});return Br.concat(tr.flatten(Yr))}ir.validateNoLeftRecursion=dr;function vr(Pr){var Fr=[];if(tr.isEmpty(Pr))return Fr;var Nr=tr.first(Pr);if(Nr instanceof lr.NonTerminal)Fr.push(Nr.referencedRule);else if(Nr instanceof lr.Alternative||Nr instanceof lr.Option||Nr instanceof lr.RepetitionMandatory||Nr instanceof lr.RepetitionMandatoryWithSeparator||Nr instanceof lr.RepetitionWithSeparator||Nr instanceof lr.Repetition)Fr=Fr.concat(vr(Nr.definition));else if(Nr instanceof lr.Alternation)Fr=tr.flatten(tr.map(Nr.definition,function(Dr){return vr(Dr.definition)}));else if(!(Nr instanceof lr.Terminal))throw Error("non exhaustive match");var Ur=sr.isOptionalProd(Nr),Br=Pr.length>1;if(Ur&&Br){var Or=tr.drop(Pr);return Fr.concat(vr(Or))}else return Fr}ir.getFirstNoneTerminal=vr;var Ar=function(Pr){er(Fr,Pr);function Fr(){var Nr=Pr!==null&&Pr.apply(this,arguments)||this;return Nr.alternations=[],Nr}return Fr.prototype.visitAlternation=function(Nr){this.alternations.push(Nr)},Fr}(cr.GAstVisitor);function yr(Pr,Fr){var Nr=new Ar;Pr.accept(Nr);var Ur=Nr.alternations,Br=tr.reduce(Ur,function(Or,Dr){var Wr=tr.dropRight(Dr.definition),$r=tr.map(Wr,function(Yr,Qi){var rs=or.nextPossibleTokensAfter([Yr],[],null,1);return tr.isEmpty(rs)?{message:Fr.buildEmptyAlternationError({topLevelRule:Pr,alternation:Dr,emptyChoiceIdx:Qi}),type:nr.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:Pr.name,occurrence:Dr.idx,alternative:Qi+1}:null});return Or.concat(tr.compact($r))},[]);return Br}ir.validateEmptyOrAlternative=yr;function wr(Pr,Fr,Nr){var Ur=new Ar;Pr.accept(Ur);var Br=Ur.alternations;Br=rr.reject(Br,function(Dr){return Dr.ignoreAmbiguities===!0});var Or=tr.reduce(Br,function(Dr,Wr){var $r=Wr.idx,Yr=Wr.maxLookahead||Fr,Qi=ar.getLookaheadPathsForOr($r,Pr,Yr,Wr),rs=Cr(Qi,Wr,Pr,Nr),Kr=Ir(Qi,Wr,Pr,Nr);return Dr.concat(rs,Kr)},[]);return Or}ir.validateAmbiguousAlternationAlternatives=wr;var br=function(Pr){er(Fr,Pr);function Fr(){var Nr=Pr!==null&&Pr.apply(this,arguments)||this;return Nr.allProductions=[],Nr}return Fr.prototype.visitRepetitionWithSeparator=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitRepetitionMandatory=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitRepetitionMandatoryWithSeparator=function(Nr){this.allProductions.push(Nr)},Fr.prototype.visitRepetition=function(Nr){this.allProductions.push(Nr)},Fr}(cr.GAstVisitor);ir.RepetionCollector=br;function Sr(Pr,Fr){var Nr=new Ar;Pr.accept(Nr);var Ur=Nr.alternations,Br=tr.reduce(Ur,function(Or,Dr){return Dr.definition.length>255&&Or.push({message:Fr.buildTooManyAlternativesError({topLevelRule:Pr,alternation:Dr}),type:nr.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:Pr.name,occurrence:Dr.idx}),Or},[]);return Br}ir.validateTooManyAlts=Sr;function xr(Pr,Fr,Nr){var Ur=[];return rr.forEach(Pr,function(Br){var Or=new br;Br.accept(Or);var Dr=Or.allProductions;rr.forEach(Dr,function(Wr){var $r=ar.getProdType(Wr),Yr=Wr.maxLookahead||Fr,Qi=Wr.idx,rs=ar.getLookaheadPathsForOptionalProd(Qi,Br,$r,Yr),Kr=rs[0];if(rr.isEmpty(rr.flatten(Kr))){var Qr=Nr.buildEmptyRepetitionError({topLevelRule:Br,repetition:Wr});Ur.push({message:Qr,type:nr.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:Br.name})}})}),Ur}ir.validateSomeNonEmptyLookaheadPath=xr;function Cr(Pr,Fr,Nr,Ur){var Br=[],Or=rr.reduce(Pr,function(Wr,$r,Yr){return Fr.definition[Yr].ignoreAmbiguities===!0||rr.forEach($r,function(Qi){var rs=[Yr];rr.forEach(Pr,function(Kr,Qr){Yr!==Qr&&ar.containsPath(Kr,Qi)&&Fr.definition[Qr].ignoreAmbiguities!==!0&&rs.push(Qr)}),rs.length>1&&!ar.containsPath(Br,Qi)&&(Br.push(Qi),Wr.push({alts:rs,path:Qi}))}),Wr},[]),Dr=tr.map(Or,function(Wr){var $r=rr.map(Wr.alts,function(Qi){return Qi+1}),Yr=Ur.buildAlternationAmbiguityError({topLevelRule:Nr,alternation:Fr,ambiguityIndices:$r,prefixPath:Wr.path});return{message:Yr,type:nr.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:Nr.name,occurrence:Fr.idx,alternatives:[Wr.alts]}});return Dr}function Ir(Pr,Fr,Nr,Ur){var Br=[],Or=rr.reduce(Pr,function(Dr,Wr,$r){var Yr=rr.map(Wr,function(Qi){return{idx:$r,path:Qi}});return Dr.concat(Yr)},[]);return rr.forEach(Or,function(Dr){var Wr=Fr.definition[Dr.idx];if(Wr.ignoreAmbiguities!==!0){var $r=Dr.idx,Yr=Dr.path,Qi=rr.findAll(Or,function(Kr){return Fr.definition[Kr.idx].ignoreAmbiguities!==!0&&Kr.idx<$r&&ar.isStrictPrefixOfPath(Kr.path,Yr)}),rs=rr.map(Qi,function(Kr){var Qr=[Kr.idx+1,$r+1],Vr=Fr.idx===0?"":Fr.idx,Gr=Ur.buildAlternationPrefixAmbiguityError({topLevelRule:Nr,alternation:Fr,ambiguityIndices:Qr,prefixPath:Kr.path});return{message:Gr,type:nr.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:Nr.name,occurrence:Vr,alternatives:Qr}});Br=Br.concat(rs)}}),Br}ir.checkPrefixAlternativesAmbiguities=Ir;function Rr(Pr,Fr,Nr){var Ur=[],Br=rr.map(Fr,function(Or){return Or.name});return rr.forEach(Pr,function(Or){var Dr=Or.name;if(rr.contains(Br,Dr)){var Wr=Nr.buildNamespaceConflictError(Or);Ur.push({message:Wr,type:nr.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:Dr})}}),Ur}}),Ui=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.validateGrammar=ir.resolveGrammar=void 0;var er=k(),tr=mi(),rr=jr(),nr=mt();function sr(or){or=er.defaults(or,{errMsgProvider:nr.defaultGrammarResolverErrorProvider});var lr={};return er.forEach(or.rules,function(cr){lr[cr.name]=cr}),tr.resolveGrammar(lr,or.errMsgProvider)}ir.resolveGrammar=sr;function ar(or){return or=er.defaults(or,{errMsgProvider:nr.defaultGrammarValidatorErrorProvider}),rr.validateGrammar(or.rules,or.maxLookahead,or.tokenTypes,or.errMsgProvider,or.grammarName)}ir.validateGrammar=ar}),et=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var gr=function(_r,mr){return gr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(dr,vr){dr.__proto__=vr}||function(dr,vr){for(var Ar in vr)Object.prototype.hasOwnProperty.call(vr,Ar)&&(dr[Ar]=vr[Ar])},gr(_r,mr)};return function(_r,mr){if(typeof mr!="function"&&mr!==null)throw new TypeError("Class extends value "+String(mr)+" is not a constructor or null");gr(_r,mr);function dr(){this.constructor=_r}_r.prototype=mr===null?Object.create(mr):(dr.prototype=mr.prototype,new dr)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.EarlyExitException=ir.NotAllInputParsedException=ir.NoViableAltException=ir.MismatchedTokenException=ir.isRecognitionException=void 0;var tr=k(),rr="MismatchedTokenException",nr="NoViableAltException",sr="EarlyExitException",ar="NotAllInputParsedException",or=[rr,nr,sr,ar];Object.freeze(or);function lr(gr){return tr.contains(or,gr.name)}ir.isRecognitionException=lr;var cr=function(gr){er(_r,gr);function _r(mr,dr){var vr=this.constructor,Ar=gr.call(this,mr)||this;return Ar.token=dr,Ar.resyncedTokens=[],Object.setPrototypeOf(Ar,vr.prototype),Error.captureStackTrace&&Error.captureStackTrace(Ar,Ar.constructor),Ar}return _r}(Error),hr=function(gr){er(_r,gr);function _r(mr,dr,vr){var Ar=gr.call(this,mr,dr)||this;return Ar.previousToken=vr,Ar.name=rr,Ar}return _r}(cr);ir.MismatchedTokenException=hr;var fr=function(gr){er(_r,gr);function _r(mr,dr,vr){var Ar=gr.call(this,mr,dr)||this;return Ar.previousToken=vr,Ar.name=nr,Ar}return _r}(cr);ir.NoViableAltException=fr;var ur=function(gr){er(_r,gr);function _r(mr,dr){var vr=gr.call(this,mr,dr)||this;return vr.name=ar,vr}return _r}(cr);ir.NotAllInputParsedException=ur;var pr=function(gr){er(_r,gr);function _r(mr,dr,vr){var Ar=gr.call(this,mr,dr)||this;return Ar.previousToken=vr,Ar.name=sr,Ar}return _r}(cr);ir.EarlyExitException=pr}),zr=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.attemptInRepetitionRecovery=ir.Recoverable=ir.InRuleRecoveryException=ir.IN_RULE_RECOVERY_EXCEPTION=ir.EOF_FOLLOW_KEY=void 0;var er=Ue(),tr=k(),rr=et(),nr=Mr(),sr=ce();ir.EOF_FOLLOW_KEY={},ir.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException";function ar(cr){this.name=ir.IN_RULE_RECOVERY_EXCEPTION,this.message=cr}ir.InRuleRecoveryException=ar,ar.prototype=Error.prototype;var or=function(){function cr(){}return cr.prototype.initRecoverable=function(hr){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=tr.has(hr,"recoveryEnabled")?hr.recoveryEnabled:sr.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=lr)},cr.prototype.getTokenToInsert=function(hr){var fr=er.createTokenInstance(hr,"",NaN,NaN,NaN,NaN,NaN,NaN);return fr.isInsertedInRecovery=!0,fr},cr.prototype.canTokenTypeBeInsertedInRecovery=function(hr){return!0},cr.prototype.tryInRepetitionRecovery=function(hr,fr,ur,pr){for(var gr=this,_r=this.findReSyncTokenType(),mr=this.exportLexerState(),dr=[],vr=!1,Ar=this.LA(1),yr=this.LA(1),wr=function(){var br=gr.LA(0),Sr=gr.errorMessageProvider.buildMismatchTokenMessage({expected:pr,actual:Ar,previous:br,ruleName:gr.getCurrRuleFullName()}),xr=new rr.MismatchedTokenException(Sr,Ar,gr.LA(0));xr.resyncedTokens=tr.dropRight(dr),gr.SAVE_ERROR(xr)};!vr;)if(this.tokenMatcher(yr,pr)){wr();return}else if(ur.call(this)){wr(),hr.apply(this,fr);return}else this.tokenMatcher(yr,_r)?vr=!0:(yr=this.SKIP_TOKEN(),this.addToResyncTokens(yr,dr));this.importLexerState(mr)},cr.prototype.shouldInRepetitionRecoveryBeTried=function(hr,fr,ur){return!(ur===!1||hr===void 0||fr===void 0||this.tokenMatcher(this.LA(1),hr)||this.isBackTracking()||this.canPerformInRuleRecovery(hr,this.getFollowsForInRuleRecovery(hr,fr)))},cr.prototype.getFollowsForInRuleRecovery=function(hr,fr){var ur=this.getCurrentGrammarPath(hr,fr),pr=this.getNextPossibleTokenTypes(ur);return pr},cr.prototype.tryInRuleRecovery=function(hr,fr){if(this.canRecoverWithSingleTokenInsertion(hr,fr)){var ur=this.getTokenToInsert(hr);return ur}if(this.canRecoverWithSingleTokenDeletion(hr)){var pr=this.SKIP_TOKEN();return this.consumeToken(),pr}throw new ar("sad sad panda")},cr.prototype.canPerformInRuleRecovery=function(hr,fr){return this.canRecoverWithSingleTokenInsertion(hr,fr)||this.canRecoverWithSingleTokenDeletion(hr)},cr.prototype.canRecoverWithSingleTokenInsertion=function(hr,fr){var ur=this;if(!this.canTokenTypeBeInsertedInRecovery(hr)||tr.isEmpty(fr))return!1;var pr=this.LA(1),gr=tr.find(fr,function(_r){return ur.tokenMatcher(pr,_r)})!==void 0;return gr},cr.prototype.canRecoverWithSingleTokenDeletion=function(hr){var fr=this.tokenMatcher(this.LA(2),hr);return fr},cr.prototype.isInCurrentRuleReSyncSet=function(hr){var fr=this.getCurrFollowKey(),ur=this.getFollowSetFromFollowKey(fr);return tr.contains(ur,hr)},cr.prototype.findReSyncTokenType=function(){for(var hr=this.flattenFollowSet(),fr=this.LA(1),ur=2;;){var pr=fr.tokenType;if(tr.contains(hr,pr))return pr;fr=this.LA(ur),ur++}},cr.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return ir.EOF_FOLLOW_KEY;var hr=this.getLastExplicitRuleShortName(),fr=this.getLastExplicitRuleOccurrenceIndex(),ur=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(hr),idxInCallingRule:fr,inRule:this.shortRuleNameToFullName(ur)}},cr.prototype.buildFullFollowKeyStack=function(){var hr=this,fr=this.RULE_STACK,ur=this.RULE_OCCURRENCE_STACK;return tr.map(fr,function(pr,gr){return gr===0?ir.EOF_FOLLOW_KEY:{ruleName:hr.shortRuleNameToFullName(pr),idxInCallingRule:ur[gr],inRule:hr.shortRuleNameToFullName(fr[gr-1])}})},cr.prototype.flattenFollowSet=function(){var hr=this,fr=tr.map(this.buildFullFollowKeyStack(),function(ur){return hr.getFollowSetFromFollowKey(ur)});return tr.flatten(fr)},cr.prototype.getFollowSetFromFollowKey=function(hr){if(hr===ir.EOF_FOLLOW_KEY)return[er.EOF];var fr=hr.ruleName+hr.idxInCallingRule+nr.IN+hr.inRule;return this.resyncFollows[fr]},cr.prototype.addToResyncTokens=function(hr,fr){return this.tokenMatcher(hr,er.EOF)||fr.push(hr),fr},cr.prototype.reSyncTo=function(hr){for(var fr=[],ur=this.LA(1);this.tokenMatcher(ur,hr)===!1;)ur=this.SKIP_TOKEN(),this.addToResyncTokens(ur,fr);return tr.dropRight(fr)},cr.prototype.attemptInRepetitionRecovery=function(hr,fr,ur,pr,gr,_r,mr){},cr.prototype.getCurrentGrammarPath=function(hr,fr){var ur=this.getHumanReadableRuleStack(),pr=tr.cloneArr(this.RULE_OCCURRENCE_STACK),gr={ruleStack:ur,occurrenceStack:pr,lastTok:hr,lastTokOccurrence:fr};return gr},cr.prototype.getHumanReadableRuleStack=function(){var hr=this;return tr.map(this.RULE_STACK,function(fr){return hr.shortRuleNameToFullName(fr)})},cr}();ir.Recoverable=or;function lr(cr,hr,fr,ur,pr,gr,_r){var mr=this.getKeyForAutomaticLookahead(ur,pr),dr=this.firstAfterRepMap[mr];if(dr===void 0){var vr=this.getCurrRuleFullName(),Ar=this.getGAstProductions()[vr],yr=new gr(Ar,pr);dr=yr.startWalking(),this.firstAfterRepMap[mr]=dr}var wr=dr.token,br=dr.occurrence,Sr=dr.isEndOfRule;this.RULE_STACK.length===1&&Sr&&wr===void 0&&(wr=er.EOF,br=1),this.shouldInRepetitionRecoveryBeTried(wr,br,_r)&&this.tryInRepetitionRecovery(cr,hr,fr,wr)}ir.attemptInRepetitionRecovery=lr}),Yt=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.getKeyForAutomaticLookahead=ir.AT_LEAST_ONE_SEP_IDX=ir.MANY_SEP_IDX=ir.AT_LEAST_ONE_IDX=ir.MANY_IDX=ir.OPTION_IDX=ir.OR_IDX=ir.BITS_FOR_ALT_IDX=ir.BITS_FOR_RULE_IDX=ir.BITS_FOR_OCCURRENCE_IDX=ir.BITS_FOR_METHOD_TYPE=void 0,ir.BITS_FOR_METHOD_TYPE=4,ir.BITS_FOR_OCCURRENCE_IDX=8,ir.BITS_FOR_RULE_IDX=12,ir.BITS_FOR_ALT_IDX=8,ir.OR_IDX=1<<ir.BITS_FOR_OCCURRENCE_IDX,ir.OPTION_IDX=2<<ir.BITS_FOR_OCCURRENCE_IDX,ir.MANY_IDX=3<<ir.BITS_FOR_OCCURRENCE_IDX,ir.AT_LEAST_ONE_IDX=4<<ir.BITS_FOR_OCCURRENCE_IDX,ir.MANY_SEP_IDX=5<<ir.BITS_FOR_OCCURRENCE_IDX,ir.AT_LEAST_ONE_SEP_IDX=6<<ir.BITS_FOR_OCCURRENCE_IDX;function er(rr,nr,sr){return sr|nr|rr}ir.getKeyForAutomaticLookahead=er;var tr=32-ir.BITS_FOR_ALT_IDX}),zi=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.LooksAhead=void 0;var er=yt(),tr=k(),rr=ce(),nr=Yt(),sr=vt(),ar=function(){function or(){}return or.prototype.initLooksAhead=function(lr){this.dynamicTokensEnabled=tr.has(lr,"dynamicTokensEnabled")?lr.dynamicTokensEnabled:rr.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=tr.has(lr,"maxLookahead")?lr.maxLookahead:rr.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=tr.isES2015MapSupported()?new Map:[],tr.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},or.prototype.preComputeLookaheadFunctions=function(lr){var cr=this;tr.forEach(lr,function(hr){cr.TRACE_INIT(hr.name+" Rule Lookahead",function(){var fr=sr.collectMethods(hr),ur=fr.alternation,pr=fr.repetition,gr=fr.option,_r=fr.repetitionMandatory,mr=fr.repetitionMandatoryWithSeparator,dr=fr.repetitionWithSeparator;tr.forEach(ur,function(vr){var Ar=vr.idx===0?"":vr.idx;cr.TRACE_INIT(""+sr.getProductionDslName(vr)+Ar,function(){var yr=er.buildLookaheadFuncForOr(vr.idx,hr,vr.maxLookahead||cr.maxLookahead,vr.hasPredicates,cr.dynamicTokensEnabled,cr.lookAheadBuilderForAlternatives),wr=nr.getKeyForAutomaticLookahead(cr.fullRuleNameToShort[hr.name],nr.OR_IDX,vr.idx);cr.setLaFuncCache(wr,yr)})}),tr.forEach(pr,function(vr){cr.computeLookaheadFunc(hr,vr.idx,nr.MANY_IDX,er.PROD_TYPE.REPETITION,vr.maxLookahead,sr.getProductionDslName(vr))}),tr.forEach(gr,function(vr){cr.computeLookaheadFunc(hr,vr.idx,nr.OPTION_IDX,er.PROD_TYPE.OPTION,vr.maxLookahead,sr.getProductionDslName(vr))}),tr.forEach(_r,function(vr){cr.computeLookaheadFunc(hr,vr.idx,nr.AT_LEAST_ONE_IDX,er.PROD_TYPE.REPETITION_MANDATORY,vr.maxLookahead,sr.getProductionDslName(vr))}),tr.forEach(mr,function(vr){cr.computeLookaheadFunc(hr,vr.idx,nr.AT_LEAST_ONE_SEP_IDX,er.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,vr.maxLookahead,sr.getProductionDslName(vr))}),tr.forEach(dr,function(vr){cr.computeLookaheadFunc(hr,vr.idx,nr.MANY_SEP_IDX,er.PROD_TYPE.REPETITION_WITH_SEPARATOR,vr.maxLookahead,sr.getProductionDslName(vr))})})})},or.prototype.computeLookaheadFunc=function(lr,cr,hr,fr,ur,pr){var gr=this;this.TRACE_INIT(""+pr+(cr===0?"":cr),function(){var _r=er.buildLookaheadFuncForOptionalProd(cr,lr,ur||gr.maxLookahead,gr.dynamicTokensEnabled,fr,gr.lookAheadBuilderForOptional),mr=nr.getKeyForAutomaticLookahead(gr.fullRuleNameToShort[lr.name],hr,cr);gr.setLaFuncCache(mr,_r)})},or.prototype.lookAheadBuilderForOptional=function(lr,cr,hr){return er.buildSingleAlternativeLookaheadFunction(lr,cr,hr)},or.prototype.lookAheadBuilderForAlternatives=function(lr,cr,hr,fr){return er.buildAlternativesLookAheadFunc(lr,cr,hr,fr)},or.prototype.getKeyForAutomaticLookahead=function(lr,cr){var hr=this.getLastExplicitRuleShortName();return nr.getKeyForAutomaticLookahead(hr,lr,cr)},or.prototype.getLaFuncFromCache=function(lr){},or.prototype.getLaFuncFromMap=function(lr){return this.lookAheadFuncsCache.get(lr)},or.prototype.getLaFuncFromObj=function(lr){return this.lookAheadFuncsCache[lr]},or.prototype.setLaFuncCache=function(lr,cr){},or.prototype.setLaFuncCacheUsingMap=function(lr,cr){this.lookAheadFuncsCache.set(lr,cr)},or.prototype.setLaFuncUsingObj=function(lr,cr){this.lookAheadFuncsCache[lr]=cr},or}();ir.LooksAhead=ar}),Hi=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.addNoneTerminalToCst=ir.addTerminalToCst=ir.setNodeLocationFull=ir.setNodeLocationOnlyOffset=void 0;function er(sr,ar){isNaN(sr.startOffset)===!0?(sr.startOffset=ar.startOffset,sr.endOffset=ar.endOffset):sr.endOffset<ar.endOffset&&(sr.endOffset=ar.endOffset)}ir.setNodeLocationOnlyOffset=er;function tr(sr,ar){isNaN(sr.startOffset)===!0?(sr.startOffset=ar.startOffset,sr.startColumn=ar.startColumn,sr.startLine=ar.startLine,sr.endOffset=ar.endOffset,sr.endColumn=ar.endColumn,sr.endLine=ar.endLine):sr.endOffset<ar.endOffset&&(sr.endOffset=ar.endOffset,sr.endColumn=ar.endColumn,sr.endLine=ar.endLine)}ir.setNodeLocationFull=tr;function rr(sr,ar,or){sr.children[or]===void 0?sr.children[or]=[ar]:sr.children[or].push(ar)}ir.addTerminalToCst=rr;function nr(sr,ar,or){sr.children[ar]===void 0?sr.children[ar]=[or]:sr.children[ar].push(or)}ir.addNoneTerminalToCst=nr}),Hr=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.defineNameProp=ir.functionName=ir.classNameFromInstance=void 0;var er=k();function tr(ar){return nr(ar.constructor)}ir.classNameFromInstance=tr;var rr="name";function nr(ar){var or=ar.name;return or||"anonymous"}ir.functionName=nr;function sr(ar,or){var lr=Object.getOwnPropertyDescriptor(ar,rr);return er.isUndefined(lr)||lr.configurable?(Object.defineProperty(ar,rr,{enumerable:!1,configurable:!0,writable:!1,value:or}),!0):!1}ir.defineNameProp=sr}),ea=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.validateRedundantMethods=ir.validateMissingCstMethods=ir.validateVisitor=ir.CstVisitorDefinitionError=ir.createBaseVisitorConstructorWithDefaults=ir.createBaseSemanticVisitorConstructor=ir.defaultVisit=void 0;var er=k(),tr=Hr();function rr(fr,ur){for(var pr=er.keys(fr),gr=pr.length,_r=0;_r<gr;_r++)for(var mr=pr[_r],dr=fr[mr],vr=dr.length,Ar=0;Ar<vr;Ar++){var yr=dr[Ar];yr.tokenTypeIdx===void 0&&this[yr.name](yr.children,ur)}}ir.defaultVisit=rr;function nr(fr,ur){var pr=function(){};tr.defineNameProp(pr,fr+"BaseSemantics");var gr={visit:function(_r,mr){if(er.isArray(_r)&&(_r=_r[0]),!er.isUndefined(_r))return this[_r.name](_r.children,mr)},validateVisitor:function(){var _r=or(this,ur);if(!er.isEmpty(_r)){var mr=er.map(_r,function(dr){return dr.msg});throw Error("Errors Detected in CST Visitor <"+tr.functionName(this.constructor)+`>:
	`+(""+mr.join(`

`).replace(/\n/g,`
	`)))}}};return pr.prototype=gr,pr.prototype.constructor=pr,pr._RULE_NAMES=ur,pr}ir.createBaseSemanticVisitorConstructor=nr;function sr(fr,ur,pr){var gr=function(){};tr.defineNameProp(gr,fr+"BaseSemanticsWithDefaults");var _r=Object.create(pr.prototype);return er.forEach(ur,function(mr){_r[mr]=rr}),gr.prototype=_r,gr.prototype.constructor=gr,gr}ir.createBaseVisitorConstructorWithDefaults=sr;var ar;(function(fr){fr[fr.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",fr[fr.MISSING_METHOD=1]="MISSING_METHOD"})(ar=ir.CstVisitorDefinitionError||(ir.CstVisitorDefinitionError={}));function or(fr,ur){var pr=lr(fr,ur),gr=hr(fr,ur);return pr.concat(gr)}ir.validateVisitor=or;function lr(fr,ur){var pr=er.map(ur,function(gr){if(!er.isFunction(fr[gr]))return{msg:"Missing visitor method: <"+gr+"> on "+tr.functionName(fr.constructor)+" CST Visitor.",type:ar.MISSING_METHOD,methodName:gr}});return er.compact(pr)}ir.validateMissingCstMethods=lr;var cr=["constructor","visit","validateVisitor"];function hr(fr,ur){var pr=[];for(var gr in fr)er.isFunction(fr[gr])&&!er.contains(cr,gr)&&!er.contains(ur,gr)&&pr.push({msg:"Redundant visitor method: <"+gr+"> on "+tr.functionName(fr.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`,type:ar.REDUNDANT_METHOD,methodName:gr});return pr}ir.validateRedundantMethods=hr}),ra=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.TreeBuilder=void 0;var er=Hi(),tr=k(),rr=ea(),nr=ce(),sr=function(){function ar(){}return ar.prototype.initTreeBuilder=function(or){if(this.CST_STACK=[],this.outputCst=or.outputCst,this.nodeLocationTracking=tr.has(or,"nodeLocationTracking")?or.nodeLocationTracking:nr.DEFAULT_PARSER_CONFIG.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=tr.NOOP,this.cstFinallyStateUpdate=tr.NOOP,this.cstPostTerminal=tr.NOOP,this.cstPostNonTerminal=tr.NOOP,this.cstPostRule=tr.NOOP;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=er.setNodeLocationFull,this.setNodeLocationFromNode=er.setNodeLocationFull,this.cstPostRule=tr.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=tr.NOOP,this.setNodeLocationFromNode=tr.NOOP,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=er.setNodeLocationOnlyOffset,this.setNodeLocationFromNode=er.setNodeLocationOnlyOffset,this.cstPostRule=tr.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=tr.NOOP,this.setNodeLocationFromNode=tr.NOOP,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=tr.NOOP,this.setNodeLocationFromNode=tr.NOOP,this.cstPostRule=tr.NOOP,this.setInitialNodeLocation=tr.NOOP;else throw Error('Invalid <nodeLocationTracking> config option: "'+or.nodeLocationTracking+'"')},ar.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(or){or.location={startOffset:NaN,endOffset:NaN}},ar.prototype.setInitialNodeLocationOnlyOffsetRegular=function(or){or.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},ar.prototype.setInitialNodeLocationFullRecovery=function(or){or.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},ar.prototype.setInitialNodeLocationFullRegular=function(or){var lr=this.LA(1);or.location={startOffset:lr.startOffset,startLine:lr.startLine,startColumn:lr.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},ar.prototype.cstInvocationStateUpdate=function(or,lr){var cr={name:or,children:{}};this.setInitialNodeLocation(cr),this.CST_STACK.push(cr)},ar.prototype.cstFinallyStateUpdate=function(){this.CST_STACK.pop()},ar.prototype.cstPostRuleFull=function(or){var lr=this.LA(0),cr=or.location;cr.startOffset<=lr.startOffset?(cr.endOffset=lr.endOffset,cr.endLine=lr.endLine,cr.endColumn=lr.endColumn):(cr.startOffset=NaN,cr.startLine=NaN,cr.startColumn=NaN)},ar.prototype.cstPostRuleOnlyOffset=function(or){var lr=this.LA(0),cr=or.location;cr.startOffset<=lr.startOffset?cr.endOffset=lr.endOffset:cr.startOffset=NaN},ar.prototype.cstPostTerminal=function(or,lr){var cr=this.CST_STACK[this.CST_STACK.length-1];er.addTerminalToCst(cr,lr,or),this.setNodeLocationFromToken(cr.location,lr)},ar.prototype.cstPostNonTerminal=function(or,lr){var cr=this.CST_STACK[this.CST_STACK.length-1];er.addNoneTerminalToCst(cr,lr,or),this.setNodeLocationFromNode(cr.location,or.location)},ar.prototype.getBaseCstVisitorConstructor=function(){if(tr.isUndefined(this.baseCstVisitorConstructor)){var or=rr.createBaseSemanticVisitorConstructor(this.className,tr.keys(this.gastProductionsCache));return this.baseCstVisitorConstructor=or,or}return this.baseCstVisitorConstructor},ar.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(tr.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var or=rr.createBaseVisitorConstructorWithDefaults(this.className,tr.keys(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=or,or}return this.baseCstVisitorWithDefaultsConstructor},ar.prototype.getLastExplicitRuleShortName=function(){var or=this.RULE_STACK;return or[or.length-1]},ar.prototype.getPreviousExplicitRuleShortName=function(){var or=this.RULE_STACK;return or[or.length-2]},ar.prototype.getLastExplicitRuleOccurrenceIndex=function(){var or=this.RULE_OCCURRENCE_STACK;return or[or.length-1]},ar}();ir.TreeBuilder=sr}),ia=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.LexerAdapter=void 0;var er=ce(),tr=function(){function rr(){}return rr.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(rr.prototype,"input",{get:function(){return this.tokVector},set:function(nr){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=nr,this.tokVectorLength=nr.length},enumerable:!1,configurable:!0}),rr.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):er.END_OF_FILE},rr.prototype.LA=function(nr){var sr=this.currIdx+nr;return sr<0||this.tokVectorLength<=sr?er.END_OF_FILE:this.tokVector[sr]},rr.prototype.consumeToken=function(){this.currIdx++},rr.prototype.exportLexerState=function(){return this.currIdx},rr.prototype.importLexerState=function(nr){this.currIdx=nr},rr.prototype.resetLexerState=function(){this.currIdx=-1},rr.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},rr.prototype.getLexerPosition=function(){return this.exportLexerState()},rr}();ir.LexerAdapter=tr}),oa=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.RecognizerApi=void 0;var er=k(),tr=et(),rr=ce(),nr=mt(),sr=jr(),ar=ne(),or=function(){function lr(){}return lr.prototype.ACTION=function(cr){return cr.call(this)},lr.prototype.consume=function(cr,hr,fr){return this.consumeInternal(hr,cr,fr)},lr.prototype.subrule=function(cr,hr,fr){return this.subruleInternal(hr,cr,fr)},lr.prototype.option=function(cr,hr){return this.optionInternal(hr,cr)},lr.prototype.or=function(cr,hr){return this.orInternal(hr,cr)},lr.prototype.many=function(cr,hr){return this.manyInternal(cr,hr)},lr.prototype.atLeastOne=function(cr,hr){return this.atLeastOneInternal(cr,hr)},lr.prototype.CONSUME=function(cr,hr){return this.consumeInternal(cr,0,hr)},lr.prototype.CONSUME1=function(cr,hr){return this.consumeInternal(cr,1,hr)},lr.prototype.CONSUME2=function(cr,hr){return this.consumeInternal(cr,2,hr)},lr.prototype.CONSUME3=function(cr,hr){return this.consumeInternal(cr,3,hr)},lr.prototype.CONSUME4=function(cr,hr){return this.consumeInternal(cr,4,hr)},lr.prototype.CONSUME5=function(cr,hr){return this.consumeInternal(cr,5,hr)},lr.prototype.CONSUME6=function(cr,hr){return this.consumeInternal(cr,6,hr)},lr.prototype.CONSUME7=function(cr,hr){return this.consumeInternal(cr,7,hr)},lr.prototype.CONSUME8=function(cr,hr){return this.consumeInternal(cr,8,hr)},lr.prototype.CONSUME9=function(cr,hr){return this.consumeInternal(cr,9,hr)},lr.prototype.SUBRULE=function(cr,hr){return this.subruleInternal(cr,0,hr)},lr.prototype.SUBRULE1=function(cr,hr){return this.subruleInternal(cr,1,hr)},lr.prototype.SUBRULE2=function(cr,hr){return this.subruleInternal(cr,2,hr)},lr.prototype.SUBRULE3=function(cr,hr){return this.subruleInternal(cr,3,hr)},lr.prototype.SUBRULE4=function(cr,hr){return this.subruleInternal(cr,4,hr)},lr.prototype.SUBRULE5=function(cr,hr){return this.subruleInternal(cr,5,hr)},lr.prototype.SUBRULE6=function(cr,hr){return this.subruleInternal(cr,6,hr)},lr.prototype.SUBRULE7=function(cr,hr){return this.subruleInternal(cr,7,hr)},lr.prototype.SUBRULE8=function(cr,hr){return this.subruleInternal(cr,8,hr)},lr.prototype.SUBRULE9=function(cr,hr){return this.subruleInternal(cr,9,hr)},lr.prototype.OPTION=function(cr){return this.optionInternal(cr,0)},lr.prototype.OPTION1=function(cr){return this.optionInternal(cr,1)},lr.prototype.OPTION2=function(cr){return this.optionInternal(cr,2)},lr.prototype.OPTION3=function(cr){return this.optionInternal(cr,3)},lr.prototype.OPTION4=function(cr){return this.optionInternal(cr,4)},lr.prototype.OPTION5=function(cr){return this.optionInternal(cr,5)},lr.prototype.OPTION6=function(cr){return this.optionInternal(cr,6)},lr.prototype.OPTION7=function(cr){return this.optionInternal(cr,7)},lr.prototype.OPTION8=function(cr){return this.optionInternal(cr,8)},lr.prototype.OPTION9=function(cr){return this.optionInternal(cr,9)},lr.prototype.OR=function(cr){return this.orInternal(cr,0)},lr.prototype.OR1=function(cr){return this.orInternal(cr,1)},lr.prototype.OR2=function(cr){return this.orInternal(cr,2)},lr.prototype.OR3=function(cr){return this.orInternal(cr,3)},lr.prototype.OR4=function(cr){return this.orInternal(cr,4)},lr.prototype.OR5=function(cr){return this.orInternal(cr,5)},lr.prototype.OR6=function(cr){return this.orInternal(cr,6)},lr.prototype.OR7=function(cr){return this.orInternal(cr,7)},lr.prototype.OR8=function(cr){return this.orInternal(cr,8)},lr.prototype.OR9=function(cr){return this.orInternal(cr,9)},lr.prototype.MANY=function(cr){this.manyInternal(0,cr)},lr.prototype.MANY1=function(cr){this.manyInternal(1,cr)},lr.prototype.MANY2=function(cr){this.manyInternal(2,cr)},lr.prototype.MANY3=function(cr){this.manyInternal(3,cr)},lr.prototype.MANY4=function(cr){this.manyInternal(4,cr)},lr.prototype.MANY5=function(cr){this.manyInternal(5,cr)},lr.prototype.MANY6=function(cr){this.manyInternal(6,cr)},lr.prototype.MANY7=function(cr){this.manyInternal(7,cr)},lr.prototype.MANY8=function(cr){this.manyInternal(8,cr)},lr.prototype.MANY9=function(cr){this.manyInternal(9,cr)},lr.prototype.MANY_SEP=function(cr){this.manySepFirstInternal(0,cr)},lr.prototype.MANY_SEP1=function(cr){this.manySepFirstInternal(1,cr)},lr.prototype.MANY_SEP2=function(cr){this.manySepFirstInternal(2,cr)},lr.prototype.MANY_SEP3=function(cr){this.manySepFirstInternal(3,cr)},lr.prototype.MANY_SEP4=function(cr){this.manySepFirstInternal(4,cr)},lr.prototype.MANY_SEP5=function(cr){this.manySepFirstInternal(5,cr)},lr.prototype.MANY_SEP6=function(cr){this.manySepFirstInternal(6,cr)},lr.prototype.MANY_SEP7=function(cr){this.manySepFirstInternal(7,cr)},lr.prototype.MANY_SEP8=function(cr){this.manySepFirstInternal(8,cr)},lr.prototype.MANY_SEP9=function(cr){this.manySepFirstInternal(9,cr)},lr.prototype.AT_LEAST_ONE=function(cr){this.atLeastOneInternal(0,cr)},lr.prototype.AT_LEAST_ONE1=function(cr){return this.atLeastOneInternal(1,cr)},lr.prototype.AT_LEAST_ONE2=function(cr){this.atLeastOneInternal(2,cr)},lr.prototype.AT_LEAST_ONE3=function(cr){this.atLeastOneInternal(3,cr)},lr.prototype.AT_LEAST_ONE4=function(cr){this.atLeastOneInternal(4,cr)},lr.prototype.AT_LEAST_ONE5=function(cr){this.atLeastOneInternal(5,cr)},lr.prototype.AT_LEAST_ONE6=function(cr){this.atLeastOneInternal(6,cr)},lr.prototype.AT_LEAST_ONE7=function(cr){this.atLeastOneInternal(7,cr)},lr.prototype.AT_LEAST_ONE8=function(cr){this.atLeastOneInternal(8,cr)},lr.prototype.AT_LEAST_ONE9=function(cr){this.atLeastOneInternal(9,cr)},lr.prototype.AT_LEAST_ONE_SEP=function(cr){this.atLeastOneSepFirstInternal(0,cr)},lr.prototype.AT_LEAST_ONE_SEP1=function(cr){this.atLeastOneSepFirstInternal(1,cr)},lr.prototype.AT_LEAST_ONE_SEP2=function(cr){this.atLeastOneSepFirstInternal(2,cr)},lr.prototype.AT_LEAST_ONE_SEP3=function(cr){this.atLeastOneSepFirstInternal(3,cr)},lr.prototype.AT_LEAST_ONE_SEP4=function(cr){this.atLeastOneSepFirstInternal(4,cr)},lr.prototype.AT_LEAST_ONE_SEP5=function(cr){this.atLeastOneSepFirstInternal(5,cr)},lr.prototype.AT_LEAST_ONE_SEP6=function(cr){this.atLeastOneSepFirstInternal(6,cr)},lr.prototype.AT_LEAST_ONE_SEP7=function(cr){this.atLeastOneSepFirstInternal(7,cr)},lr.prototype.AT_LEAST_ONE_SEP8=function(cr){this.atLeastOneSepFirstInternal(8,cr)},lr.prototype.AT_LEAST_ONE_SEP9=function(cr){this.atLeastOneSepFirstInternal(9,cr)},lr.prototype.RULE=function(cr,hr,fr){if(fr===void 0&&(fr=rr.DEFAULT_RULE_CONFIG),er.contains(this.definedRulesNames,cr)){var ur=nr.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:cr,grammarName:this.className}),pr={message:ur,type:rr.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:cr};this.definitionErrors.push(pr)}this.definedRulesNames.push(cr);var gr=this.defineRule(cr,hr,fr);return this[cr]=gr,gr},lr.prototype.OVERRIDE_RULE=function(cr,hr,fr){fr===void 0&&(fr=rr.DEFAULT_RULE_CONFIG);var ur=[];ur=ur.concat(sr.validateRuleIsOverridden(cr,this.definedRulesNames,this.className)),this.definitionErrors=this.definitionErrors.concat(ur);var pr=this.defineRule(cr,hr,fr);return this[cr]=pr,pr},lr.prototype.BACKTRACK=function(cr,hr){return function(){this.isBackTrackingStack.push(1);var fr=this.saveRecogState();try{return cr.apply(this,hr),!0}catch(ur){if(tr.isRecognitionException(ur))return!1;throw ur}finally{this.reloadRecogState(fr),this.isBackTrackingStack.pop()}}},lr.prototype.getGAstProductions=function(){return this.gastProductionsCache},lr.prototype.getSerializedGastProductions=function(){return ar.serializeGrammar(er.values(this.gastProductionsCache))},lr}();ir.RecognizerApi=or}),la=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.RecognizerEngine=void 0;var er=k(),tr=Yt(),rr=et(),nr=yt(),sr=Tt(),ar=ce(),or=zr(),lr=Ue(),cr=Xe(),hr=Hr(),fr=function(){function ur(){}return ur.prototype.initRecognizerEngine=function(pr,gr){if(this.className=hr.classNameFromInstance(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=cr.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},er.has(gr,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(er.isArray(pr)){if(er.isEmpty(pr))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof pr[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(er.isArray(pr))this.tokensMap=er.reduce(pr,function(vr,Ar){return vr[Ar.name]=Ar,vr},{});else if(er.has(pr,"modes")&&er.every(er.flatten(er.values(pr.modes)),cr.isTokenType)){var _r=er.flatten(er.values(pr.modes)),mr=er.uniq(_r);this.tokensMap=er.reduce(mr,function(vr,Ar){return vr[Ar.name]=Ar,vr},{})}else if(er.isObject(pr))this.tokensMap=er.cloneObj(pr);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=lr.EOF;var dr=er.every(er.values(pr),function(vr){return er.isEmpty(vr.categoryMatches)});this.tokenMatcher=dr?cr.tokenStructuredMatcherNoCategories:cr.tokenStructuredMatcher,cr.augmentTokenTypes(er.values(this.tokensMap))},ur.prototype.defineRule=function(pr,gr,_r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+pr+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var mr=er.has(_r,"resyncEnabled")?_r.resyncEnabled:ar.DEFAULT_RULE_CONFIG.resyncEnabled,dr=er.has(_r,"recoveryValueFunc")?_r.recoveryValueFunc:ar.DEFAULT_RULE_CONFIG.recoveryValueFunc,vr=this.ruleShortNameIdx<<tr.BITS_FOR_METHOD_TYPE+tr.BITS_FOR_OCCURRENCE_IDX;this.ruleShortNameIdx++,this.shortRuleNameToFull[vr]=pr,this.fullRuleNameToShort[pr]=vr;function Ar(br){try{if(this.outputCst===!0){gr.apply(this,br);var Sr=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(Sr),Sr}else return gr.apply(this,br)}catch(xr){return this.invokeRuleCatch(xr,mr,dr)}finally{this.ruleFinallyStateUpdate()}}var yr=function(br,Sr){return br===void 0&&(br=0),this.ruleInvocationStateUpdate(vr,pr,br),Ar.call(this,Sr)},wr="ruleName";return yr[wr]=pr,yr.originalGrammarAction=gr,yr},ur.prototype.invokeRuleCatch=function(pr,gr,_r){var mr=this.RULE_STACK.length===1,dr=gr&&!this.isBackTracking()&&this.recoveryEnabled;if(rr.isRecognitionException(pr)){var vr=pr;if(dr){var Ar=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(Ar))if(vr.resyncedTokens=this.reSyncTo(Ar),this.outputCst){var yr=this.CST_STACK[this.CST_STACK.length-1];return yr.recoveredNode=!0,yr}else return _r();else{if(this.outputCst){var yr=this.CST_STACK[this.CST_STACK.length-1];yr.recoveredNode=!0,vr.partialCstResult=yr}throw vr}}else{if(mr)return this.moveToTerminatedState(),_r();throw vr}}else throw pr},ur.prototype.optionInternal=function(pr,gr){var _r=this.getKeyForAutomaticLookahead(tr.OPTION_IDX,gr);return this.optionInternalLogic(pr,gr,_r)},ur.prototype.optionInternalLogic=function(pr,gr,_r){var mr=this,dr=this.getLaFuncFromCache(_r),vr,Ar;if(pr.DEF!==void 0){if(vr=pr.DEF,Ar=pr.GATE,Ar!==void 0){var yr=dr;dr=function(){return Ar.call(mr)&&yr.call(mr)}}}else vr=pr;if(dr.call(this)===!0)return vr.call(this)},ur.prototype.atLeastOneInternal=function(pr,gr){var _r=this.getKeyForAutomaticLookahead(tr.AT_LEAST_ONE_IDX,pr);return this.atLeastOneInternalLogic(pr,gr,_r)},ur.prototype.atLeastOneInternalLogic=function(pr,gr,_r){var mr=this,dr=this.getLaFuncFromCache(_r),vr,Ar;if(gr.DEF!==void 0){if(vr=gr.DEF,Ar=gr.GATE,Ar!==void 0){var yr=dr;dr=function(){return Ar.call(mr)&&yr.call(mr)}}}else vr=gr;if(dr.call(this)===!0)for(var wr=this.doSingleRepetition(vr);dr.call(this)===!0&&wr===!0;)wr=this.doSingleRepetition(vr);else throw this.raiseEarlyExitException(pr,nr.PROD_TYPE.REPETITION_MANDATORY,gr.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[pr,gr],dr,tr.AT_LEAST_ONE_IDX,pr,sr.NextTerminalAfterAtLeastOneWalker)},ur.prototype.atLeastOneSepFirstInternal=function(pr,gr){var _r=this.getKeyForAutomaticLookahead(tr.AT_LEAST_ONE_SEP_IDX,pr);this.atLeastOneSepFirstInternalLogic(pr,gr,_r)},ur.prototype.atLeastOneSepFirstInternalLogic=function(pr,gr,_r){var mr=this,dr=gr.DEF,vr=gr.SEP,Ar=this.getLaFuncFromCache(_r);if(Ar.call(this)===!0){dr.call(this);for(var yr=function(){return mr.tokenMatcher(mr.LA(1),vr)};this.tokenMatcher(this.LA(1),vr)===!0;)this.CONSUME(vr),dr.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[pr,vr,yr,dr,sr.NextTerminalAfterAtLeastOneSepWalker],yr,tr.AT_LEAST_ONE_SEP_IDX,pr,sr.NextTerminalAfterAtLeastOneSepWalker)}else throw this.raiseEarlyExitException(pr,nr.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,gr.ERR_MSG)},ur.prototype.manyInternal=function(pr,gr){var _r=this.getKeyForAutomaticLookahead(tr.MANY_IDX,pr);return this.manyInternalLogic(pr,gr,_r)},ur.prototype.manyInternalLogic=function(pr,gr,_r){var mr=this,dr=this.getLaFuncFromCache(_r),vr,Ar;if(gr.DEF!==void 0){if(vr=gr.DEF,Ar=gr.GATE,Ar!==void 0){var yr=dr;dr=function(){return Ar.call(mr)&&yr.call(mr)}}}else vr=gr;for(var wr=!0;dr.call(this)===!0&&wr===!0;)wr=this.doSingleRepetition(vr);this.attemptInRepetitionRecovery(this.manyInternal,[pr,gr],dr,tr.MANY_IDX,pr,sr.NextTerminalAfterManyWalker,wr)},ur.prototype.manySepFirstInternal=function(pr,gr){var _r=this.getKeyForAutomaticLookahead(tr.MANY_SEP_IDX,pr);this.manySepFirstInternalLogic(pr,gr,_r)},ur.prototype.manySepFirstInternalLogic=function(pr,gr,_r){var mr=this,dr=gr.DEF,vr=gr.SEP,Ar=this.getLaFuncFromCache(_r);if(Ar.call(this)===!0){dr.call(this);for(var yr=function(){return mr.tokenMatcher(mr.LA(1),vr)};this.tokenMatcher(this.LA(1),vr)===!0;)this.CONSUME(vr),dr.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[pr,vr,yr,dr,sr.NextTerminalAfterManySepWalker],yr,tr.MANY_SEP_IDX,pr,sr.NextTerminalAfterManySepWalker)}},ur.prototype.repetitionSepSecondInternal=function(pr,gr,_r,mr,dr){for(;_r();)this.CONSUME(gr),mr.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[pr,gr,_r,mr,dr],_r,tr.AT_LEAST_ONE_SEP_IDX,pr,dr)},ur.prototype.doSingleRepetition=function(pr){var gr=this.getLexerPosition();pr.call(this);var _r=this.getLexerPosition();return _r>gr},ur.prototype.orInternal=function(pr,gr){var _r=this.getKeyForAutomaticLookahead(tr.OR_IDX,gr),mr=er.isArray(pr)?pr:pr.DEF,dr=this.getLaFuncFromCache(_r),vr=dr.call(this,mr);if(vr!==void 0){var Ar=mr[vr];return Ar.ALT.call(this)}this.raiseNoAltException(gr,pr.ERR_MSG)},ur.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var pr=this.LA(1),gr=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:pr,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new rr.NotAllInputParsedException(gr,pr))}},ur.prototype.subruleInternal=function(pr,gr,_r){var mr;try{var dr=_r!==void 0?_r.ARGS:void 0;return mr=pr.call(this,gr,dr),this.cstPostNonTerminal(mr,_r!==void 0&&_r.LABEL!==void 0?_r.LABEL:pr.ruleName),mr}catch(vr){this.subruleInternalError(vr,_r,pr.ruleName)}},ur.prototype.subruleInternalError=function(pr,gr,_r){throw rr.isRecognitionException(pr)&&pr.partialCstResult!==void 0&&(this.cstPostNonTerminal(pr.partialCstResult,gr!==void 0&&gr.LABEL!==void 0?gr.LABEL:_r),delete pr.partialCstResult),pr},ur.prototype.consumeInternal=function(pr,gr,_r){var mr;try{var dr=this.LA(1);this.tokenMatcher(dr,pr)===!0?(this.consumeToken(),mr=dr):this.consumeInternalError(pr,dr,_r)}catch(vr){mr=this.consumeInternalRecovery(pr,gr,vr)}return this.cstPostTerminal(_r!==void 0&&_r.LABEL!==void 0?_r.LABEL:pr.name,mr),mr},ur.prototype.consumeInternalError=function(pr,gr,_r){var mr,dr=this.LA(0);throw _r!==void 0&&_r.ERR_MSG?mr=_r.ERR_MSG:mr=this.errorMessageProvider.buildMismatchTokenMessage({expected:pr,actual:gr,previous:dr,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new rr.MismatchedTokenException(mr,gr,dr))},ur.prototype.consumeInternalRecovery=function(pr,gr,_r){if(this.recoveryEnabled&&_r.name==="MismatchedTokenException"&&!this.isBackTracking()){var mr=this.getFollowsForInRuleRecovery(pr,gr);try{return this.tryInRuleRecovery(pr,mr)}catch(dr){throw dr.name===or.IN_RULE_RECOVERY_EXCEPTION?_r:dr}}else throw _r},ur.prototype.saveRecogState=function(){var pr=this.errors,gr=er.cloneArr(this.RULE_STACK);return{errors:pr,lexerState:this.exportLexerState(),RULE_STACK:gr,CST_STACK:this.CST_STACK}},ur.prototype.reloadRecogState=function(pr){this.errors=pr.errors,this.importLexerState(pr.lexerState),this.RULE_STACK=pr.RULE_STACK},ur.prototype.ruleInvocationStateUpdate=function(pr,gr,_r){this.RULE_OCCURRENCE_STACK.push(_r),this.RULE_STACK.push(pr),this.cstInvocationStateUpdate(gr,pr)},ur.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},ur.prototype.getCurrRuleFullName=function(){var pr=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[pr]},ur.prototype.shortRuleNameToFullName=function(pr){return this.shortRuleNameToFull[pr]},ur.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),lr.EOF)},ur.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},ur}();ir.RecognizerEngine=fr}),pa=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.ErrorHandler=void 0;var er=et(),tr=k(),rr=yt(),nr=ce(),sr=function(){function ar(){}return ar.prototype.initErrorHandler=function(or){this._errors=[],this.errorMessageProvider=tr.has(or,"errorMessageProvider")?or.errorMessageProvider:nr.DEFAULT_PARSER_CONFIG.errorMessageProvider},ar.prototype.SAVE_ERROR=function(or){if(er.isRecognitionException(or))return or.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:tr.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(or),or;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(ar.prototype,"errors",{get:function(){return tr.cloneArr(this._errors)},set:function(or){this._errors=or},enumerable:!1,configurable:!0}),ar.prototype.raiseEarlyExitException=function(or,lr,cr){for(var hr=this.getCurrRuleFullName(),fr=this.getGAstProductions()[hr],ur=rr.getLookaheadPathsForOptionalProd(or,fr,lr,this.maxLookahead),pr=ur[0],gr=[],_r=1;_r<=this.maxLookahead;_r++)gr.push(this.LA(_r));var mr=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:pr,actual:gr,previous:this.LA(0),customUserDescription:cr,ruleName:hr});throw this.SAVE_ERROR(new er.EarlyExitException(mr,this.LA(1),this.LA(0)))},ar.prototype.raiseNoAltException=function(or,lr){for(var cr=this.getCurrRuleFullName(),hr=this.getGAstProductions()[cr],fr=rr.getLookaheadPathsForOr(or,hr,this.maxLookahead),ur=[],pr=1;pr<=this.maxLookahead;pr++)ur.push(this.LA(pr));var gr=this.LA(0),_r=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:fr,actual:ur,previous:gr,customUserDescription:lr,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new er.NoViableAltException(_r,this.LA(1),gr))},ar}();ir.ErrorHandler=sr}),va=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.ContentAssist=void 0;var er=Tt(),tr=k(),rr=function(){function nr(){}return nr.prototype.initContentAssist=function(){},nr.prototype.computeContentAssist=function(sr,ar){var or=this.gastProductionsCache[sr];if(tr.isUndefined(or))throw Error("Rule ->"+sr+"<- does not exist in this grammar.");return er.nextPossibleTokensAfter([or],ar,this.tokenMatcher,this.maxLookahead)},nr.prototype.getNextPossibleTokenTypes=function(sr){var ar=tr.first(sr.ruleStack),or=this.getGAstProductions(),lr=or[ar],cr=new er.NextAfterTokenWalker(lr,sr).startWalking();return cr},nr}();ir.ContentAssist=rr}),Ra=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.GastRecorder=void 0;var er=k(),tr=ne(),rr=ft(),nr=Xe(),sr=Ue(),ar=ce(),or=Yt(),lr={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(lr);var cr=!0,hr=Math.pow(2,or.BITS_FOR_OCCURRENCE_IDX)-1,fr=sr.createToken({name:"RECORDING_PHASE_TOKEN",pattern:rr.Lexer.NA});nr.augmentTokenTypes([fr]);var ur=sr.createTokenInstance(fr,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(ur);var pr={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}},gr=function(){function Ar(){}return Ar.prototype.initGastRecorder=function(yr){this.recordingProdStack=[],this.RECORDING_PHASE=!1},Ar.prototype.enableRecording=function(){var yr=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var wr=function(Sr){var xr=Sr>0?Sr:"";yr["CONSUME"+xr]=function(Cr,Ir){return this.consumeInternalRecord(Cr,Sr,Ir)},yr["SUBRULE"+xr]=function(Cr,Ir){return this.subruleInternalRecord(Cr,Sr,Ir)},yr["OPTION"+xr]=function(Cr){return this.optionInternalRecord(Cr,Sr)},yr["OR"+xr]=function(Cr){return this.orInternalRecord(Cr,Sr)},yr["MANY"+xr]=function(Cr){this.manyInternalRecord(Sr,Cr)},yr["MANY_SEP"+xr]=function(Cr){this.manySepFirstInternalRecord(Sr,Cr)},yr["AT_LEAST_ONE"+xr]=function(Cr){this.atLeastOneInternalRecord(Sr,Cr)},yr["AT_LEAST_ONE_SEP"+xr]=function(Cr){this.atLeastOneSepFirstInternalRecord(Sr,Cr)}},br=0;br<10;br++)wr(br);yr.consume=function(Sr,xr,Cr){return this.consumeInternalRecord(xr,Sr,Cr)},yr.subrule=function(Sr,xr,Cr){return this.subruleInternalRecord(xr,Sr,Cr)},yr.option=function(Sr,xr){return this.optionInternalRecord(xr,Sr)},yr.or=function(Sr,xr){return this.orInternalRecord(xr,Sr)},yr.many=function(Sr,xr){this.manyInternalRecord(Sr,xr)},yr.atLeastOne=function(Sr,xr){this.atLeastOneInternalRecord(Sr,xr)},yr.ACTION=yr.ACTION_RECORD,yr.BACKTRACK=yr.BACKTRACK_RECORD,yr.LA=yr.LA_RECORD})},Ar.prototype.disableRecording=function(){var yr=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var wr=0;wr<10;wr++){var br=wr>0?wr:"";delete yr["CONSUME"+br],delete yr["SUBRULE"+br],delete yr["OPTION"+br],delete yr["OR"+br],delete yr["MANY"+br],delete yr["MANY_SEP"+br],delete yr["AT_LEAST_ONE"+br],delete yr["AT_LEAST_ONE_SEP"+br]}delete yr.consume,delete yr.subrule,delete yr.option,delete yr.or,delete yr.many,delete yr.atLeastOne,delete yr.ACTION,delete yr.BACKTRACK,delete yr.LA})},Ar.prototype.ACTION_RECORD=function(yr){},Ar.prototype.BACKTRACK_RECORD=function(yr,wr){return function(){return!0}},Ar.prototype.LA_RECORD=function(yr){return ar.END_OF_FILE},Ar.prototype.topLevelRuleRecord=function(yr,wr){try{var br=new tr.Rule({definition:[],name:yr});return br.name=yr,this.recordingProdStack.push(br),wr.call(this),this.recordingProdStack.pop(),br}catch(Sr){if(Sr.KNOWN_RECORDER_ERROR!==!0)try{Sr.message=Sr.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw Sr}throw Sr}},Ar.prototype.optionInternalRecord=function(yr,wr){return _r.call(this,tr.Option,yr,wr)},Ar.prototype.atLeastOneInternalRecord=function(yr,wr){_r.call(this,tr.RepetitionMandatory,wr,yr)},Ar.prototype.atLeastOneSepFirstInternalRecord=function(yr,wr){_r.call(this,tr.RepetitionMandatoryWithSeparator,wr,yr,cr)},Ar.prototype.manyInternalRecord=function(yr,wr){_r.call(this,tr.Repetition,wr,yr)},Ar.prototype.manySepFirstInternalRecord=function(yr,wr){_r.call(this,tr.RepetitionWithSeparator,wr,yr,cr)},Ar.prototype.orInternalRecord=function(yr,wr){return mr.call(this,yr,wr)},Ar.prototype.subruleInternalRecord=function(yr,wr,br){if(vr(wr),!yr||er.has(yr,"ruleName")===!1){var Sr=new Error("<SUBRULE"+dr(wr)+"> argument is invalid"+(" expecting a Parser method reference but got: <"+JSON.stringify(yr)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw Sr.KNOWN_RECORDER_ERROR=!0,Sr}var xr=er.peek(this.recordingProdStack),Cr=yr.ruleName,Ir=new tr.NonTerminal({idx:wr,nonTerminalName:Cr,referencedRule:void 0});return xr.definition.push(Ir),this.outputCst?pr:lr},Ar.prototype.consumeInternalRecord=function(yr,wr,br){if(vr(wr),!nr.hasShortKeyProperty(yr)){var Sr=new Error("<CONSUME"+dr(wr)+"> argument is invalid"+(" expecting a TokenType reference but got: <"+JSON.stringify(yr)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw Sr.KNOWN_RECORDER_ERROR=!0,Sr}var xr=er.peek(this.recordingProdStack),Cr=new tr.Terminal({idx:wr,terminalType:yr});return xr.definition.push(Cr),ur},Ar}();ir.GastRecorder=gr;function _r(Ar,yr,wr,br){br===void 0&&(br=!1),vr(wr);var Sr=er.peek(this.recordingProdStack),xr=er.isFunction(yr)?yr:yr.DEF,Cr=new Ar({definition:[],idx:wr});return br&&(Cr.separator=yr.SEP),er.has(yr,"MAX_LOOKAHEAD")&&(Cr.maxLookahead=yr.MAX_LOOKAHEAD),this.recordingProdStack.push(Cr),xr.call(this),Sr.definition.push(Cr),this.recordingProdStack.pop(),lr}function mr(Ar,yr){var wr=this;vr(yr);var br=er.peek(this.recordingProdStack),Sr=er.isArray(Ar)===!1,xr=Sr===!1?Ar:Ar.DEF,Cr=new tr.Alternation({definition:[],idx:yr,ignoreAmbiguities:Sr&&Ar.IGNORE_AMBIGUITIES===!0});er.has(Ar,"MAX_LOOKAHEAD")&&(Cr.maxLookahead=Ar.MAX_LOOKAHEAD);var Ir=er.some(xr,function(Rr){return er.isFunction(Rr.GATE)});return Cr.hasPredicates=Ir,br.definition.push(Cr),er.forEach(xr,function(Rr){var Pr=new tr.Alternative({definition:[]});Cr.definition.push(Pr),er.has(Rr,"IGNORE_AMBIGUITIES")?Pr.ignoreAmbiguities=Rr.IGNORE_AMBIGUITIES:er.has(Rr,"GATE")&&(Pr.ignoreAmbiguities=!0),wr.recordingProdStack.push(Pr),Rr.ALT.call(wr),wr.recordingProdStack.pop()}),lr}function dr(Ar){return Ar===0?"":""+Ar}function vr(Ar){if(Ar<0||Ar>hr){var yr=new Error("Invalid DSL Method idx value: <"+Ar+`>
	`+("Idx value must be a none negative value smaller than "+(hr+1)));throw yr.KNOWN_RECORDER_ERROR=!0,yr}}}),Na=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.PerformanceTracer=void 0;var er=k(),tr=ce(),rr=function(){function nr(){}return nr.prototype.initPerformanceTracer=function(sr){if(er.has(sr,"traceInitPerf")){var ar=sr.traceInitPerf,or=typeof ar=="number";this.traceInitMaxIdent=or?ar:1/0,this.traceInitPerf=or?ar>0:ar}else this.traceInitMaxIdent=0,this.traceInitPerf=tr.DEFAULT_PARSER_CONFIG.traceInitPerf;this.traceInitIndent=-1},nr.prototype.TRACE_INIT=function(sr,ar){if(this.traceInitPerf===!0){this.traceInitIndent++;var or=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(or+"--> <"+sr+">");var lr=er.timer(ar),cr=lr.time,hr=lr.value,fr=cr>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&fr(or+"<-- <"+sr+"> time: "+cr+"ms"),this.traceInitIndent--,hr}else return ar()},nr}();ir.PerformanceTracer=rr}),Ia=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.applyMixins=void 0;function er(tr,rr){rr.forEach(function(nr){var sr=nr.prototype;Object.getOwnPropertyNames(sr).forEach(function(ar){if(ar!=="constructor"){var or=Object.getOwnPropertyDescriptor(sr,ar);or&&(or.get||or.set)?Object.defineProperty(tr.prototype,ar,or):tr.prototype[ar]=nr.prototype[ar]}})})}ir.applyMixins=er}),ce=R$1(ir=>{"use strict";var er=ir&&ir.__extends||function(){var Sr=function(xr,Cr){return Sr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Ir,Rr){Ir.__proto__=Rr}||function(Ir,Rr){for(var Pr in Rr)Object.prototype.hasOwnProperty.call(Rr,Pr)&&(Ir[Pr]=Rr[Pr])},Sr(xr,Cr)};return function(xr,Cr){if(typeof Cr!="function"&&Cr!==null)throw new TypeError("Class extends value "+String(Cr)+" is not a constructor or null");Sr(xr,Cr);function Ir(){this.constructor=xr}xr.prototype=Cr===null?Object.create(Cr):(Ir.prototype=Cr.prototype,new Ir)}}();Object.defineProperty(ir,"__esModule",{value:!0}),ir.EmbeddedActionsParser=ir.CstParser=ir.Parser=ir.EMPTY_ALT=ir.ParserDefinitionErrorType=ir.DEFAULT_RULE_CONFIG=ir.DEFAULT_PARSER_CONFIG=ir.END_OF_FILE=void 0;var tr=k(),rr=pi(),nr=Ue(),sr=mt(),ar=Ui(),or=zr(),lr=zi(),cr=ra(),hr=ia(),fr=oa(),ur=la(),pr=pa(),gr=va(),_r=Ra(),mr=Na(),dr=Ia();ir.END_OF_FILE=nr.createTokenInstance(nr.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(ir.END_OF_FILE),ir.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:sr.defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ir.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0});var vr;(function(Sr){Sr[Sr.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",Sr[Sr.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",Sr[Sr.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",Sr[Sr.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",Sr[Sr.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",Sr[Sr.LEFT_RECURSION=5]="LEFT_RECURSION",Sr[Sr.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",Sr[Sr.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",Sr[Sr.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",Sr[Sr.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",Sr[Sr.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",Sr[Sr.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",Sr[Sr.TOO_MANY_ALTS=12]="TOO_MANY_ALTS"})(vr=ir.ParserDefinitionErrorType||(ir.ParserDefinitionErrorType={}));function Ar(Sr){return Sr===void 0&&(Sr=void 0),function(){return Sr}}ir.EMPTY_ALT=Ar;var yr=function(){function Sr(xr,Cr){this.definitionErrors=[],this.selfAnalysisDone=!1;var Ir=this;if(Ir.initErrorHandler(Cr),Ir.initLexerAdapter(),Ir.initLooksAhead(Cr),Ir.initRecognizerEngine(xr,Cr),Ir.initRecoverable(Cr),Ir.initTreeBuilder(Cr),Ir.initContentAssist(),Ir.initGastRecorder(Cr),Ir.initPerformanceTracer(Cr),tr.has(Cr,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=tr.has(Cr,"skipValidations")?Cr.skipValidations:ir.DEFAULT_PARSER_CONFIG.skipValidations}return Sr.performSelfAnalysis=function(xr){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")},Sr.prototype.performSelfAnalysis=function(){var xr=this;this.TRACE_INIT("performSelfAnalysis",function(){var Cr;xr.selfAnalysisDone=!0;var Ir=xr.className;xr.TRACE_INIT("toFastProps",function(){tr.toFastProperties(xr)}),xr.TRACE_INIT("Grammar Recording",function(){try{xr.enableRecording(),tr.forEach(xr.definedRulesNames,function(Pr){var Fr=xr[Pr],Nr=Fr.originalGrammarAction,Ur=void 0;xr.TRACE_INIT(Pr+" Rule",function(){Ur=xr.topLevelRuleRecord(Pr,Nr)}),xr.gastProductionsCache[Pr]=Ur})}finally{xr.disableRecording()}});var Rr=[];if(xr.TRACE_INIT("Grammar Resolving",function(){Rr=ar.resolveGrammar({rules:tr.values(xr.gastProductionsCache)}),xr.definitionErrors=xr.definitionErrors.concat(Rr)}),xr.TRACE_INIT("Grammar Validations",function(){if(tr.isEmpty(Rr)&&xr.skipValidations===!1){var Pr=ar.validateGrammar({rules:tr.values(xr.gastProductionsCache),maxLookahead:xr.maxLookahead,tokenTypes:tr.values(xr.tokensMap),errMsgProvider:sr.defaultGrammarValidatorErrorProvider,grammarName:Ir});xr.definitionErrors=xr.definitionErrors.concat(Pr)}}),tr.isEmpty(xr.definitionErrors)&&(xr.recoveryEnabled&&xr.TRACE_INIT("computeAllProdsFollows",function(){var Pr=rr.computeAllProdsFollows(tr.values(xr.gastProductionsCache));xr.resyncFollows=Pr}),xr.TRACE_INIT("ComputeLookaheadFunctions",function(){xr.preComputeLookaheadFunctions(tr.values(xr.gastProductionsCache))})),!Sr.DEFER_DEFINITION_ERRORS_HANDLING&&!tr.isEmpty(xr.definitionErrors))throw Cr=tr.map(xr.definitionErrors,function(Pr){return Pr.message}),new Error(`Parser Definition Errors detected:
 `+Cr.join(`
-------------------------------
`))})},Sr.DEFER_DEFINITION_ERRORS_HANDLING=!1,Sr}();ir.Parser=yr,dr.applyMixins(yr,[or.Recoverable,lr.LooksAhead,cr.TreeBuilder,hr.LexerAdapter,ur.RecognizerEngine,fr.RecognizerApi,pr.ErrorHandler,gr.ContentAssist,_r.GastRecorder,mr.PerformanceTracer]);var wr=function(Sr){er(xr,Sr);function xr(Cr,Ir){Ir===void 0&&(Ir=ir.DEFAULT_PARSER_CONFIG);var Rr=this,Pr=tr.cloneObj(Ir);return Pr.outputCst=!0,Rr=Sr.call(this,Cr,Pr)||this,Rr}return xr}(yr);ir.CstParser=wr;var br=function(Sr){er(xr,Sr);function xr(Cr,Ir){Ir===void 0&&(Ir=ir.DEFAULT_PARSER_CONFIG);var Rr=this,Pr=tr.cloneObj(Ir);return Pr.outputCst=!1,Rr=Sr.call(this,Cr,Pr)||this,Rr}return xr}(yr);ir.EmbeddedActionsParser=br}),La=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.createSyntaxDiagramsCode=void 0;var er=Er();function tr(rr,nr){var sr=nr===void 0?{}:nr,ar=sr.resourceBase,or=ar===void 0?"https://unpkg.com/chevrotain@"+er.VERSION+"/diagrams/":ar,lr=sr.css,cr=lr===void 0?"https://unpkg.com/chevrotain@"+er.VERSION+"/diagrams/diagrams.css":lr,hr=`
<!-- This is a generated file -->
<!DOCTYPE html>
<meta charset="utf-8">
<style>
  body {
    background-color: hsl(30, 20%, 95%)
  }
</style>

`,fr=`
<link rel='stylesheet' href='`+cr+`'>
`,ur=`
<script src='`+or+`vendor/railroad-diagrams.js'><\/script>
<script src='`+or+`src/diagrams_builder.js'><\/script>
<script src='`+or+`src/diagrams_behavior.js'><\/script>
<script src='`+or+`src/main.js'><\/script>
`,pr=`
<div id="diagrams" align="center"></div>
`,gr=`
<script>
    window.serializedGrammar = `+JSON.stringify(rr,null,"  ")+`;
<\/script>
`,_r=`
<script>
    var diagramsDiv = document.getElementById("diagrams");
    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);
<\/script>
`;return hr+fr+ur+pr+gr+_r}ir.createSyntaxDiagramsCode=tr}),Fa=R$1(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0}),ir.Parser=ir.createSyntaxDiagramsCode=ir.clearCache=ir.GAstVisitor=ir.serializeProduction=ir.serializeGrammar=ir.Terminal=ir.Rule=ir.RepetitionWithSeparator=ir.RepetitionMandatoryWithSeparator=ir.RepetitionMandatory=ir.Repetition=ir.Option=ir.NonTerminal=ir.Alternative=ir.Alternation=ir.defaultLexerErrorProvider=ir.NoViableAltException=ir.NotAllInputParsedException=ir.MismatchedTokenException=ir.isRecognitionException=ir.EarlyExitException=ir.defaultParserErrorProvider=ir.tokenName=ir.tokenMatcher=ir.tokenLabel=ir.EOF=ir.createTokenInstance=ir.createToken=ir.LexerDefinitionErrorType=ir.Lexer=ir.EMPTY_ALT=ir.ParserDefinitionErrorType=ir.EmbeddedActionsParser=ir.CstParser=ir.VERSION=void 0;var er=Er();Object.defineProperty(ir,"VERSION",{enumerable:!0,get:function(){return er.VERSION}});var tr=ce();Object.defineProperty(ir,"CstParser",{enumerable:!0,get:function(){return tr.CstParser}}),Object.defineProperty(ir,"EmbeddedActionsParser",{enumerable:!0,get:function(){return tr.EmbeddedActionsParser}}),Object.defineProperty(ir,"ParserDefinitionErrorType",{enumerable:!0,get:function(){return tr.ParserDefinitionErrorType}}),Object.defineProperty(ir,"EMPTY_ALT",{enumerable:!0,get:function(){return tr.EMPTY_ALT}});var rr=ft();Object.defineProperty(ir,"Lexer",{enumerable:!0,get:function(){return rr.Lexer}}),Object.defineProperty(ir,"LexerDefinitionErrorType",{enumerable:!0,get:function(){return rr.LexerDefinitionErrorType}});var nr=Ue();Object.defineProperty(ir,"createToken",{enumerable:!0,get:function(){return nr.createToken}}),Object.defineProperty(ir,"createTokenInstance",{enumerable:!0,get:function(){return nr.createTokenInstance}}),Object.defineProperty(ir,"EOF",{enumerable:!0,get:function(){return nr.EOF}}),Object.defineProperty(ir,"tokenLabel",{enumerable:!0,get:function(){return nr.tokenLabel}}),Object.defineProperty(ir,"tokenMatcher",{enumerable:!0,get:function(){return nr.tokenMatcher}}),Object.defineProperty(ir,"tokenName",{enumerable:!0,get:function(){return nr.tokenName}});var sr=mt();Object.defineProperty(ir,"defaultParserErrorProvider",{enumerable:!0,get:function(){return sr.defaultParserErrorProvider}});var ar=et();Object.defineProperty(ir,"EarlyExitException",{enumerable:!0,get:function(){return ar.EarlyExitException}}),Object.defineProperty(ir,"isRecognitionException",{enumerable:!0,get:function(){return ar.isRecognitionException}}),Object.defineProperty(ir,"MismatchedTokenException",{enumerable:!0,get:function(){return ar.MismatchedTokenException}}),Object.defineProperty(ir,"NotAllInputParsedException",{enumerable:!0,get:function(){return ar.NotAllInputParsedException}}),Object.defineProperty(ir,"NoViableAltException",{enumerable:!0,get:function(){return ar.NoViableAltException}});var or=kr();Object.defineProperty(ir,"defaultLexerErrorProvider",{enumerable:!0,get:function(){return or.defaultLexerErrorProvider}});var lr=ne();Object.defineProperty(ir,"Alternation",{enumerable:!0,get:function(){return lr.Alternation}}),Object.defineProperty(ir,"Alternative",{enumerable:!0,get:function(){return lr.Alternative}}),Object.defineProperty(ir,"NonTerminal",{enumerable:!0,get:function(){return lr.NonTerminal}}),Object.defineProperty(ir,"Option",{enumerable:!0,get:function(){return lr.Option}}),Object.defineProperty(ir,"Repetition",{enumerable:!0,get:function(){return lr.Repetition}}),Object.defineProperty(ir,"RepetitionMandatory",{enumerable:!0,get:function(){return lr.RepetitionMandatory}}),Object.defineProperty(ir,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return lr.RepetitionMandatoryWithSeparator}}),Object.defineProperty(ir,"RepetitionWithSeparator",{enumerable:!0,get:function(){return lr.RepetitionWithSeparator}}),Object.defineProperty(ir,"Rule",{enumerable:!0,get:function(){return lr.Rule}}),Object.defineProperty(ir,"Terminal",{enumerable:!0,get:function(){return lr.Terminal}});var cr=ne();Object.defineProperty(ir,"serializeGrammar",{enumerable:!0,get:function(){return cr.serializeGrammar}}),Object.defineProperty(ir,"serializeProduction",{enumerable:!0,get:function(){return cr.serializeProduction}});var hr=$e();Object.defineProperty(ir,"GAstVisitor",{enumerable:!0,get:function(){return hr.GAstVisitor}});function fr(){console.warn(`The clearCache function was 'soft' removed from the Chevrotain API.
	 It performs no action other than printing this message.
	 Please avoid using it as it will be completely removed in the future`)}ir.clearCache=fr;var ur=La();Object.defineProperty(ir,"createSyntaxDiagramsCode",{enumerable:!0,get:function(){return ur.createSyntaxDiagramsCode}});var pr=function(){function gr(){throw new Error(`The Parser class has been deprecated, use CstParser or EmbeddedActionsParser instead.
See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_7-0-0`)}return gr}();ir.Parser=pr});const chevrotain=Fa();class VRMLLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=sr.path===""?LoaderUtils.extractUrlBase(er):sr.path,or=new FileLoader(sr.manager);or.setPath(sr.path),or.setRequestHeader(sr.requestHeader),or.setWithCredentials(sr.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},rr,nr)}parse(er,tr){const rr={};function nr(Ri){const Jr=sr(),Xi=new VRMLLexer(Jr.tokens),ss=new VRMLParser(Jr.tokenVocabulary),ls=ar(ss.getBaseCstVisitorConstructor()),gs=Xi.lex(Ri);ss.input=gs.tokens;const _s=ss.vrml();if(ss.errors.length>0)throw console.error(ss.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return ls.visit(_s)}function sr(){const Ri=chevrotain.createToken,Jr=Ri({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),Xi=Ri({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]([^\0-\x20\x22\x27\x23\x2b\x2c\x2e\x5b\x5d\x5c\x7b\x7d])*/,longer_alt:Jr}),ss=["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"],ls=Ri({name:"Version",pattern:/#VRML.*/,longer_alt:Xi}),gs=Ri({name:"NodeName",pattern:new RegExp(ss.join("|")),longer_alt:Xi}),_s=Ri({name:"DEF",pattern:/DEF/,longer_alt:Xi}),vs=Ri({name:"USE",pattern:/USE/,longer_alt:Xi}),As=Ri({name:"ROUTE",pattern:/ROUTE/,longer_alt:Xi}),Ss=Ri({name:"TO",pattern:/TO/,longer_alt:Xi}),Is=Ri({name:"StringLiteral",pattern:/"(?:[^\\"\n\r]|\\[bfnrtv"\\/]|\\u[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F])*"/}),Fs=Ri({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),Ns=Ri({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),Ws=Ri({name:"TrueLiteral",pattern:/TRUE/}),ks=Ri({name:"FalseLiteral",pattern:/FALSE/}),Vs=Ri({name:"NullLiteral",pattern:/NULL/}),bs=Ri({name:"LSquare",pattern:/\[/}),Ms=Ri({name:"RSquare",pattern:/]/}),Cs=Ri({name:"LCurly",pattern:/{/}),Ps=Ri({name:"RCurly",pattern:/}/}),Qs=Ri({name:"Comment",pattern:/#.*/,group:chevrotain.Lexer.SKIPPED}),ta=[Ri({name:"WhiteSpace",pattern:/[ ,\s]/,group:chevrotain.Lexer.SKIPPED}),gs,_s,vs,As,Ss,Ws,ks,Vs,ls,Xi,Jr,Is,Fs,Ns,bs,Ms,Cs,Ps,Qs],Sa={};for(let ga=0,$s=ta.length;ga<$s;ga++){const Ks=ta[ga];Sa[Ks.name]=Ks}return{tokens:ta,tokenVocabulary:Sa}}function ar(Ri){class Jr extends Ri{constructor(){super(),this.validateVisitor()}vrml(ls){const gs={version:this.visit(ls.version),nodes:[],routes:[]};for(let _s=0,vs=ls.node.length;_s<vs;_s++){const As=ls.node[_s];gs.nodes.push(this.visit(As))}if(ls.route)for(let _s=0,vs=ls.route.length;_s<vs;_s++){const As=ls.route[_s];gs.routes.push(this.visit(As))}return gs}version(ls){return ls.Version[0].image}node(ls){const gs={name:ls.NodeName[0].image,fields:[]};if(ls.field)for(let _s=0,vs=ls.field.length;_s<vs;_s++){const As=ls.field[_s];gs.fields.push(this.visit(As))}return ls.def&&(gs.DEF=this.visit(ls.def[0])),gs}field(ls){const gs={name:ls.Identifier[0].image,type:null,values:null};let _s;return ls.singleFieldValue&&(_s=this.visit(ls.singleFieldValue[0])),ls.multiFieldValue&&(_s=this.visit(ls.multiFieldValue[0])),gs.type=_s.type,gs.values=_s.values,gs}def(ls){return(ls.Identifier||ls.NodeName)[0].image}use(ls){return{USE:(ls.Identifier||ls.NodeName)[0].image}}singleFieldValue(ls){return Xi(this,ls)}multiFieldValue(ls){return Xi(this,ls)}route(ls){return{FROM:ls.RouteIdentifier[0].image,TO:ls.RouteIdentifier[1].image}}}function Xi(ss,ls){const gs={type:null,values:[]};if(ls.node){gs.type="node";for(let _s=0,vs=ls.node.length;_s<vs;_s++){const As=ls.node[_s];gs.values.push(ss.visit(As))}}if(ls.use){gs.type="use";for(let _s=0,vs=ls.use.length;_s<vs;_s++){const As=ls.use[_s];gs.values.push(ss.visit(As))}}if(ls.StringLiteral){gs.type="string";for(let _s=0,vs=ls.StringLiteral.length;_s<vs;_s++){const As=ls.StringLiteral[_s];gs.values.push(As.image.replace(/'|"/g,""))}}if(ls.NumberLiteral){gs.type="number";for(let _s=0,vs=ls.NumberLiteral.length;_s<vs;_s++){const As=ls.NumberLiteral[_s];gs.values.push(parseFloat(As.image))}}if(ls.HexLiteral){gs.type="hex";for(let _s=0,vs=ls.HexLiteral.length;_s<vs;_s++){const As=ls.HexLiteral[_s];gs.values.push(As.image)}}if(ls.TrueLiteral){gs.type="boolean";for(let _s=0,vs=ls.TrueLiteral.length;_s<vs;_s++)ls.TrueLiteral[_s].image==="TRUE"&&gs.values.push(!0)}if(ls.FalseLiteral){gs.type="boolean";for(let _s=0,vs=ls.FalseLiteral.length;_s<vs;_s++)ls.FalseLiteral[_s].image==="FALSE"&&gs.values.push(!1)}return ls.NullLiteral&&(gs.type="null",ls.NullLiteral.forEach(function(){gs.values.push(null)})),gs}return new Jr}function or(Ri){const Jr=Ri.nodes,Xi=new Scene;for(let ss=0,ls=Jr.length;ss<ls;ss++){const gs=Jr[ss];lr(gs)}for(let ss=0,ls=Jr.length;ss<ls;ss++){const gs=Jr[ss],_s=cr(gs);_s instanceof Object3D&&Xi.add(_s),gs.name==="WorldInfo"&&(Xi.userData.worldInfo=_s)}return Xi}function lr(Ri){Ri.DEF&&(rr[Ri.DEF]=Ri);const Jr=Ri.fields;for(let Xi=0,ss=Jr.length;Xi<ss;Xi++){const ls=Jr[Xi];if(ls.type==="node"){const gs=ls.values;for(let _s=0,vs=gs.length;_s<vs;_s++)lr(gs[_s])}}}function cr(Ri){return Ri.USE?Br(Ri.USE):(Ri.build!==void 0||(Ri.build=hr(Ri)),Ri.build)}function hr(Ri){const Jr=Ri.name;let Xi;switch(Jr){case"Anchor":case"Group":case"Transform":case"Collision":Xi=fr(Ri);break;case"Background":Xi=ur(Ri);break;case"Shape":Xi=pr(Ri);break;case"Appearance":Xi=gr(Ri);break;case"Material":Xi=_r(Ri);break;case"ImageTexture":Xi=Ar(Ri);break;case"PixelTexture":Xi=vr(Ri);break;case"TextureTransform":Xi=yr(Ri);break;case"IndexedFaceSet":Xi=Sr(Ri);break;case"IndexedLineSet":Xi=xr(Ri);break;case"PointSet":Xi=Cr(Ri);break;case"Box":Xi=Ir(Ri);break;case"Cone":Xi=Rr(Ri);break;case"Cylinder":Xi=Pr(Ri);break;case"Sphere":Xi=Fr(Ri);break;case"ElevationGrid":Xi=Nr(Ri);break;case"Extrusion":Xi=Ur(Ri);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":Xi=wr(Ri);break;case"WorldInfo":Xi=br(Ri);break;case"Billboard":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",Jr);break}return Xi!==void 0&&Ri.DEF!==void 0&&Xi.hasOwnProperty("name")===!0&&(Xi.name=Ri.DEF),Xi}function fr(Ri){const Jr=new Group,Xi=Ri.fields;for(let ss=0,ls=Xi.length;ss<ls;ss++){const gs=Xi[ss],_s=gs.name,vs=gs.values;switch(_s){case"bboxCenter":break;case"bboxSize":break;case"center":break;case"children":Or(vs,Jr);break;case"description":break;case"collide":break;case"parameter":break;case"rotation":const As=new Vector3$1(vs[0],vs[1],vs[2]).normalize(),Ss=vs[3];Jr.quaternion.setFromAxisAngle(As,Ss);break;case"scale":Jr.scale.set(vs[0],vs[1],vs[2]);break;case"scaleOrientation":break;case"translation":Jr.position.set(vs[0],vs[1],vs[2]);break;case"proxy":break;case"url":break;default:console.warn("THREE.VRMLLoader: Unknown field:",_s);break}}return Jr}function ur(Ri){const Jr=new Group;let Xi,ss,ls,gs;const _s=Ri.fields;for(let As=0,Ss=_s.length;As<Ss;As++){const Is=_s[As],Fs=Is.name,Ns=Is.values;switch(Fs){case"groundAngle":Xi=Ns;break;case"groundColor":ss=Ns;break;case"backUrl":break;case"bottomUrl":break;case"frontUrl":break;case"leftUrl":break;case"rightUrl":break;case"topUrl":break;case"skyAngle":ls=Ns;break;case"skyColor":gs=Ns;break;default:console.warn("THREE.VRMLLoader: Unknown field:",Fs);break}}const vs=1e4;if(gs){const As=new SphereGeometry(vs,32,16),Ss=new MeshBasicMaterial({fog:!1,side:BackSide,depthWrite:!1,depthTest:!1});gs.length>3?(Ji(As,vs,ls,us(gs),!0),Ss.vertexColors=!0):Ss.color.setRGB(gs[0],gs[1],gs[2],SRGBColorSpace);const Is=new Mesh(As,Ss);Jr.add(Is)}if(ss&&ss.length>0){const As=new SphereGeometry(vs,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),Ss=new MeshBasicMaterial({fog:!1,side:BackSide,vertexColors:!0,depthWrite:!1,depthTest:!1});Ji(As,vs,Xi,us(ss),!1);const Is=new Mesh(As,Ss);Jr.add(Is)}return Jr.renderOrder=-1/0,Jr}function pr(Ri){const Jr=Ri.fields;let Xi=new MeshBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:0}),ss;for(let gs=0,_s=Jr.length;gs<_s;gs++){const vs=Jr[gs],As=vs.name,Ss=vs.values;switch(As){case"appearance":Ss[0]!==null&&(Xi=cr(Ss[0]));break;case"geometry":Ss[0]!==null&&(ss=cr(Ss[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}let ls;if(ss&&ss.attributes.position){const gs=ss._type;if(gs==="points"){const _s=new PointsMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16777215,opacity:Xi.opacity,transparent:Xi.transparent});ss.attributes.color!==void 0?_s.vertexColors=!0:Xi.isMeshPhongMaterial&&_s.color.copy(Xi.emissive),ls=new Points(ss,_s)}else if(gs==="line"){const _s=new LineBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16777215,opacity:Xi.opacity,transparent:Xi.transparent});ss.attributes.color!==void 0?_s.vertexColors=!0:Xi.isMeshPhongMaterial&&_s.color.copy(Xi.emissive),ls=new LineSegments(ss,_s)}else ss._solid!==void 0&&(Xi.side=ss._solid?FrontSide:DoubleSide),ss.attributes.color!==void 0&&(Xi.vertexColors=!0),ls=new Mesh(ss,Xi)}else ls=new Object3D,ls.visible=!1;return ls}function gr(Ri){let Jr=new MeshPhongMaterial,Xi;const ss=Ri.fields;for(let ls=0,gs=ss.length;ls<gs;ls++){const _s=ss[ls],vs=_s.name,As=_s.values;switch(vs){case"material":if(As[0]!==null){const Is=cr(As[0]);Is.diffuseColor&&Jr.color.copy(Is.diffuseColor),Is.emissiveColor&&Jr.emissive.copy(Is.emissiveColor),Is.shininess&&(Jr.shininess=Is.shininess),Is.specularColor&&Jr.specular.copy(Is.specularColor),Is.transparency&&(Jr.opacity=1-Is.transparency),Is.transparency>0&&(Jr.transparent=!0)}else Jr=new MeshBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:0});break;case"texture":const Ss=As[0];Ss!==null&&(Ss.name==="ImageTexture"||Ss.name==="PixelTexture")&&(Jr.map=cr(Ss));break;case"textureTransform":As[0]!==null&&(Xi=cr(As[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",vs);break}}if(Jr.map){if(Jr.map.__type){switch(Jr.map.__type){case TEXTURE_TYPE.INTENSITY_ALPHA:Jr.opacity=1;break;case TEXTURE_TYPE.RGB:Jr.color.set(16777215);break;case TEXTURE_TYPE.RGBA:Jr.color.set(16777215),Jr.opacity=1;break;default:}delete Jr.map.__type}Xi&&(Jr.map.center.copy(Xi.center),Jr.map.rotation=Xi.rotation,Jr.map.repeat.copy(Xi.scale),Jr.map.offset.copy(Xi.translation))}return Jr}function _r(Ri){const Jr={},Xi=Ri.fields;for(let ss=0,ls=Xi.length;ss<ls;ss++){const gs=Xi[ss],_s=gs.name,vs=gs.values;switch(_s){case"ambientIntensity":break;case"diffuseColor":Jr.diffuseColor=new Color().setRGB(vs[0],vs[1],vs[2],SRGBColorSpace);break;case"emissiveColor":Jr.emissiveColor=new Color().setRGB(vs[0],vs[1],vs[2],SRGBColorSpace);break;case"shininess":Jr.shininess=vs[0];break;case"specularColor":Jr.specularColor=new Color().setRGB(vs[0],vs[1],vs[2],SRGBColorSpace);break;case"transparency":Jr.transparency=vs[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",_s);break}}return Jr}function mr(Ri,Jr,Xi){let ss;switch(Jr){case TEXTURE_TYPE.INTENSITY:ss=parseInt(Ri),Xi.r=ss,Xi.g=ss,Xi.b=ss,Xi.a=1;break;case TEXTURE_TYPE.INTENSITY_ALPHA:ss=parseInt("0x"+Ri.substring(2,4)),Xi.r=ss,Xi.g=ss,Xi.b=ss,Xi.a=parseInt("0x"+Ri.substring(4,6));break;case TEXTURE_TYPE.RGB:Xi.r=parseInt("0x"+Ri.substring(2,4)),Xi.g=parseInt("0x"+Ri.substring(4,6)),Xi.b=parseInt("0x"+Ri.substring(6,8)),Xi.a=1;break;case TEXTURE_TYPE.RGBA:Xi.r=parseInt("0x"+Ri.substring(2,4)),Xi.g=parseInt("0x"+Ri.substring(4,6)),Xi.b=parseInt("0x"+Ri.substring(6,8)),Xi.a=parseInt("0x"+Ri.substring(8,10));break;default:}}function dr(Ri){let Jr;switch(Ri){case 1:Jr=TEXTURE_TYPE.INTENSITY;break;case 2:Jr=TEXTURE_TYPE.INTENSITY_ALPHA;break;case 3:Jr=TEXTURE_TYPE.RGB;break;case 4:Jr=TEXTURE_TYPE.RGBA;break;default:}return Jr}function vr(Ri){let Jr,Xi=RepeatWrapping,ss=RepeatWrapping;const ls=Ri.fields;for(let gs=0,_s=ls.length;gs<_s;gs++){const vs=ls[gs],As=vs.name,Ss=vs.values;switch(As){case"image":const Is=Ss[0],Fs=Ss[1],Ns=Ss[2],Ws=dr(Ns),ks=new Uint8Array(4*Is*Fs),Vs={r:0,g:0,b:0,a:0};for(let bs=3,Ms=0,Cs=Ss.length;bs<Cs;bs++,Ms++){mr(Ss[bs],Ws,Vs);const Ps=Ms*4;ks[Ps+0]=Vs.r,ks[Ps+1]=Vs.g,ks[Ps+2]=Vs.b,ks[Ps+3]=Vs.a}Jr=new DataTexture(ks,Is,Fs),Jr.colorSpace=SRGBColorSpace,Jr.needsUpdate=!0,Jr.__type=Ws;break;case"repeatS":Ss[0]===!1&&(Xi=ClampToEdgeWrapping);break;case"repeatT":Ss[0]===!1&&(ss=ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}return Jr&&(Jr.wrapS=Xi,Jr.wrapT=ss),Jr}function Ar(Ri){let Jr,Xi=RepeatWrapping,ss=RepeatWrapping;const ls=Ri.fields;for(let gs=0,_s=ls.length;gs<_s;gs++){const vs=ls[gs],As=vs.name,Ss=vs.values;switch(As){case"url":const Is=Ss[0];Is&&(Jr=ms.load(Is));break;case"repeatS":Ss[0]===!1&&(Xi=ClampToEdgeWrapping);break;case"repeatT":Ss[0]===!1&&(ss=ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}return Jr&&(Jr.wrapS=Xi,Jr.wrapT=ss,Jr.colorSpace=SRGBColorSpace),Jr}function yr(Ri){const Jr={center:new Vector2,rotation:new Vector2,scale:new Vector2,translation:new Vector2},Xi=Ri.fields;for(let ss=0,ls=Xi.length;ss<ls;ss++){const gs=Xi[ss],_s=gs.name,vs=gs.values;switch(_s){case"center":Jr.center.set(vs[0],vs[1]);break;case"rotation":Jr.rotation=vs[0];break;case"scale":Jr.scale.set(vs[0],vs[1]);break;case"translation":Jr.translation.set(vs[0],vs[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",_s);break}}return Jr}function wr(Ri){return Ri.fields[0].values}function br(Ri){const Jr={},Xi=Ri.fields;for(let ss=0,ls=Xi.length;ss<ls;ss++){const gs=Xi[ss],_s=gs.name,vs=gs.values;switch(_s){case"title":Jr.title=vs[0];break;case"info":Jr.info=vs;break;default:console.warn("THREE.VRMLLoader: Unknown field:",_s);break}}return Jr}function Sr(Ri){let Jr,Xi,ss,ls,gs=!0,_s=!0,vs=0,As,Ss,Is,Fs,Ns=!0,Ws=!0;const ks=Ri.fields;for(let Hs=0,ta=ks.length;Hs<ta;Hs++){const Sa=ks[Hs],ga=Sa.name,$s=Sa.values;switch(ga){case"color":const Ks=$s[0];Ks!==null&&(Jr=cr(Ks));break;case"coord":const qs=$s[0];qs!==null&&(Xi=cr(qs));break;case"normal":const Zs=$s[0];Zs!==null&&(ss=cr(Zs));break;case"texCoord":const ha=$s[0];ha!==null&&(ls=cr(ha));break;case"ccw":gs=$s[0];break;case"colorIndex":As=$s;break;case"colorPerVertex":Ns=$s[0];break;case"convex":break;case"coordIndex":Ss=$s;break;case"creaseAngle":vs=$s[0];break;case"normalIndex":Is=$s;break;case"normalPerVertex":Ws=$s[0];break;case"solid":_s=$s[0];break;case"texCoordIndex":Fs=$s;break;default:console.warn("THREE.VRMLLoader: Unknown field:",ga);break}}if(Ss===void 0)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new BufferGeometry;const Vs=Dr(Ss,gs);let bs,Ms,Cs;if(Jr){if(Ns===!0)if(As&&As.length>0){const Hs=Dr(As,gs);bs=ji(Vs,Hs,Jr,3)}else bs=Yi(Vs,new Float32BufferAttribute(Jr,3));else if(As&&As.length>0){const Hs=$r(Jr,As),ta=Wr(Hs,Ss);bs=Zr(Vs,ta)}else{const Hs=Wr(Jr,Ss);bs=Zr(Vs,Hs)}is(bs)}if(ss)if(Ws===!0)if(Is&&Is.length>0){const Hs=Dr(Is,gs);Ms=ji(Vs,Hs,ss,3)}else Ms=Yi(Vs,new Float32BufferAttribute(ss,3));else if(Is&&Is.length>0){const Hs=$r(ss,Is),ta=Wr(Hs,Ss);Ms=Zr(Vs,ta)}else{const Hs=Wr(ss,Ss);Ms=Zr(Vs,Hs)}else Ms=ns(Vs,Xi,vs);if(ls)if(Fs&&Fs.length>0){const Hs=Dr(Fs,gs);Cs=ji(Vs,Hs,ls,2)}else Cs=Yi(Vs,new Float32BufferAttribute(ls,2));const Ps=new BufferGeometry,Qs=Yi(Vs,new Float32BufferAttribute(Xi,3));return Ps.setAttribute("position",Qs),Ps.setAttribute("normal",Ms),bs&&Ps.setAttribute("color",bs),Cs&&Ps.setAttribute("uv",Cs),Ps._solid=_s,Ps._type="mesh",Ps}function xr(Ri){let Jr,Xi,ss,ls,gs=!0;const _s=Ri.fields;for(let Fs=0,Ns=_s.length;Fs<Ns;Fs++){const Ws=_s[Fs],ks=Ws.name,Vs=Ws.values;switch(ks){case"color":const bs=Vs[0];bs!==null&&(Jr=cr(bs));break;case"coord":const Ms=Vs[0];Ms!==null&&(Xi=cr(Ms));break;case"colorIndex":ss=Vs;break;case"colorPerVertex":gs=Vs[0];break;case"coordIndex":ls=Vs;break;default:console.warn("THREE.VRMLLoader: Unknown field:",ks);break}}let vs;const As=Yr(ls);if(Jr){if(gs===!0)if(ss.length>0){const Fs=Yr(ss);vs=ji(As,Fs,Jr,3)}else vs=Yi(As,new Float32BufferAttribute(Jr,3));else if(ss.length>0){const Fs=$r(Jr,ss),Ns=Qi(Fs,ls);vs=Zi(As,Ns)}else{const Fs=Qi(Jr,ls);vs=Zi(As,Fs)}is(vs)}const Ss=new BufferGeometry,Is=Yi(As,new Float32BufferAttribute(Xi,3));return Ss.setAttribute("position",Is),vs&&Ss.setAttribute("color",vs),Ss._type="line",Ss}function Cr(Ri){let Jr,Xi;const ss=Ri.fields;for(let gs=0,_s=ss.length;gs<_s;gs++){const vs=ss[gs],As=vs.name,Ss=vs.values;switch(As){case"color":const Is=Ss[0];Is!==null&&(Jr=cr(Is));break;case"coord":const Fs=Ss[0];Fs!==null&&(Xi=cr(Fs));break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}const ls=new BufferGeometry;if(ls.setAttribute("position",new Float32BufferAttribute(Xi,3)),Jr){const gs=new Float32BufferAttribute(Jr,3);is(gs),ls.setAttribute("color",gs)}return ls._type="points",ls}function Ir(Ri){const Jr=new Vector3$1(2,2,2),Xi=Ri.fields;for(let ls=0,gs=Xi.length;ls<gs;ls++){const _s=Xi[ls],vs=_s.name,As=_s.values;switch(vs){case"size":Jr.x=As[0],Jr.y=As[1],Jr.z=As[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",vs);break}}return new BoxGeometry(Jr.x,Jr.y,Jr.z)}function Rr(Ri){let Jr=1,Xi=2,ss=!1;const ls=Ri.fields;for(let _s=0,vs=ls.length;_s<vs;_s++){const As=ls[_s],Ss=As.name,Is=As.values;switch(Ss){case"bottom":ss=!Is[0];break;case"bottomRadius":Jr=Is[0];break;case"height":Xi=Is[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",Ss);break}}return new ConeGeometry(Jr,Xi,16,1,ss)}function Pr(Ri){let Jr=1,Xi=2;const ss=Ri.fields;for(let gs=0,_s=ss.length;gs<_s;gs++){const vs=ss[gs],As=vs.name,Ss=vs.values;switch(As){case"bottom":break;case"radius":Jr=Ss[0];break;case"height":Xi=Ss[0];break;case"side":break;case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}return new CylinderGeometry(Jr,Jr,Xi,16,1)}function Fr(Ri){let Jr=1;const Xi=Ri.fields;for(let ls=0,gs=Xi.length;ls<gs;ls++){const _s=Xi[ls],vs=_s.name,As=_s.values;switch(vs){case"radius":Jr=As[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",vs);break}}return new SphereGeometry(Jr,16,16)}function Nr(Ri){let Jr,Xi,ss,ls,gs=!0,_s=!0,vs=!0,As=!0,Ss=0,Is=2,Fs=2,Ns=1,Ws=1;const ks=Ri.fields;for(let $s=0,Ks=ks.length;$s<Ks;$s++){const qs=ks[$s],Zs=qs.name,ha=qs.values;switch(Zs){case"color":const Ta=ha[0];Ta!==null&&(Jr=cr(Ta));break;case"normal":const $a=ha[0];$a!==null&&(Xi=cr($a));break;case"texCoord":const Wa=ha[0];Wa!==null&&(ss=cr(Wa));break;case"height":ls=ha;break;case"ccw":As=ha[0];break;case"colorPerVertex":gs=ha[0];break;case"creaseAngle":Ss=ha[0];break;case"normalPerVertex":_s=ha[0];break;case"solid":vs=ha[0];break;case"xDimension":Is=ha[0];break;case"xSpacing":Ns=ha[0];break;case"zDimension":Fs=ha[0];break;case"zSpacing":Ws=ha[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",Zs);break}}const Vs=[],bs=[],Ms=[],Cs=[];for(let $s=0;$s<Fs;$s++)for(let Ks=0;Ks<Is;Ks++){const qs=$s*Is+Ks,Zs=Ns*$s,ha=ls[qs],Ta=Ws*Ks;if(Vs.push(Zs,ha,Ta),Jr&&gs===!0){const $a=Jr[qs*3+0],Wa=Jr[qs*3+1],Qa=Jr[qs*3+2];Ms.push($a,Wa,Qa)}if(Xi&&_s===!0){const $a=Xi[qs*3+0],Wa=Xi[qs*3+1],Qa=Xi[qs*3+2];bs.push($a,Wa,Qa)}if(ss){const $a=ss[qs*2+0],Wa=ss[qs*2+1];Cs.push($a,Wa)}else Cs.push($s/(Is-1),Ks/(Fs-1))}const Ps=[];for(let $s=0;$s<Is-1;$s++)for(let Ks=0;Ks<Fs-1;Ks++){const qs=$s+Ks*Is,Zs=$s+(Ks+1)*Is,ha=$s+1+(Ks+1)*Is,Ta=$s+1+Ks*Is;As===!0?(Ps.push(qs,ha,Zs),Ps.push(ha,qs,Ta)):(Ps.push(qs,Zs,ha),Ps.push(ha,Ta,qs))}const Qs=Yi(Ps,new Float32BufferAttribute(Vs,3)),Hs=Yi(Ps,new Float32BufferAttribute(Cs,2));let ta,Sa;if(Jr){if(gs===!1){for(let $s=0;$s<Is-1;$s++)for(let Ks=0;Ks<Fs-1;Ks++){const qs=$s+Ks*(Is-1),Zs=Jr[qs*3+0],ha=Jr[qs*3+1],Ta=Jr[qs*3+2];Ms.push(Zs,ha,Ta),Ms.push(Zs,ha,Ta),Ms.push(Zs,ha,Ta),Ms.push(Zs,ha,Ta),Ms.push(Zs,ha,Ta),Ms.push(Zs,ha,Ta)}ta=new Float32BufferAttribute(Ms,3)}else ta=Yi(Ps,new Float32BufferAttribute(Ms,3));is(ta)}if(Xi)if(_s===!1){for(let $s=0;$s<Is-1;$s++)for(let Ks=0;Ks<Fs-1;Ks++){const qs=$s+Ks*(Is-1),Zs=Xi[qs*3+0],ha=Xi[qs*3+1],Ta=Xi[qs*3+2];bs.push(Zs,ha,Ta),bs.push(Zs,ha,Ta),bs.push(Zs,ha,Ta),bs.push(Zs,ha,Ta),bs.push(Zs,ha,Ta),bs.push(Zs,ha,Ta)}Sa=new Float32BufferAttribute(bs,3)}else Sa=Yi(Ps,new Float32BufferAttribute(bs,3));else Sa=ns(Ps,Vs,Ss);const ga=new BufferGeometry;return ga.setAttribute("position",Qs),ga.setAttribute("normal",Sa),ga.setAttribute("uv",Hs),ta&&ga.setAttribute("color",ta),ga._solid=vs,ga._type="mesh",ga}function Ur(Ri){let Jr=[1,1,1,-1,-1,-1,-1,1,1,1],Xi=[0,0,0,0,1,0],ss,ls,gs=!0,_s=!0,vs=0,As=!0,Ss=!0;const Is=Ri.fields;for(let ga=0,$s=Is.length;ga<$s;ga++){const Ks=Is[ga],qs=Ks.name,Zs=Ks.values;switch(qs){case"beginCap":gs=Zs[0];break;case"ccw":_s=Zs[0];break;case"convex":break;case"creaseAngle":vs=Zs[0];break;case"crossSection":Jr=Zs;break;case"endCap":As=Zs[0];break;case"orientation":ls=Zs;break;case"scale":ss=Zs;break;case"solid":Ss=Zs[0];break;case"spine":Xi=Zs;break;default:console.warn("THREE.VRMLLoader: Unknown field:",qs);break}}const Fs=Jr[0]===Jr[Jr.length-2]&&Jr[1]===Jr[Jr.length-1],Ns=[],Ws=new Vector3$1,ks=new Vector3$1,Vs=new Vector3$1,bs=new Vector3$1,Ms=new Quaternion$1;for(let ga=0,$s=0,Ks=0,qs=Xi.length;ga<qs;ga+=3,$s+=2,Ks+=4){Ws.fromArray(Xi,ga),ks.x=ss?ss[$s+0]:1,ks.y=1,ks.z=ss?ss[$s+1]:1,Vs.x=ls?ls[Ks+0]:0,Vs.y=ls?ls[Ks+1]:0,Vs.z=ls?ls[Ks+2]:1;const Zs=ls?ls[Ks+3]:0;for(let ha=0,Ta=Jr.length;ha<Ta;ha+=2)bs.x=Jr[ha+0],bs.y=0,bs.z=Jr[ha+1],bs.multiply(ks),Ms.setFromAxisAngle(Vs,Zs),bs.applyQuaternion(Ms),bs.add(Ws),Ns.push(bs.x,bs.y,bs.z)}const Cs=[],Ps=Xi.length/3,Qs=Jr.length/2;for(let ga=0;ga<Ps-1;ga++)for(let $s=0;$s<Qs-1;$s++){const Ks=$s+ga*Qs;let qs=$s+1+ga*Qs;const Zs=$s+(ga+1)*Qs;let ha=$s+1+(ga+1)*Qs;$s===Qs-2&&Fs===!0&&(qs=ga*Qs,ha=(ga+1)*Qs),_s===!0?(Cs.push(Ks,qs,Zs),Cs.push(Zs,qs,ha)):(Cs.push(Ks,Zs,qs),Cs.push(Zs,ha,qs))}if(gs===!0||As===!0){const ga=[];for(let qs=0,Zs=Jr.length;qs<Zs;qs+=2)ga.push(new Vector2(Jr[qs],Jr[qs+1]));const $s=ShapeUtils.triangulateShape(ga,[]),Ks=[];for(let qs=0,Zs=$s.length;qs<Zs;qs++){const ha=$s[qs];Ks.push(ha[0],ha[1],ha[2])}if(gs===!0)for(let qs=0,Zs=Ks.length;qs<Zs;qs+=3)_s===!0?Cs.push(Ks[qs+0],Ks[qs+1],Ks[qs+2]):Cs.push(Ks[qs+0],Ks[qs+2],Ks[qs+1]);if(As===!0){const qs=Qs*(Ps-1);for(let Zs=0,ha=Ks.length;Zs<ha;Zs+=3)_s===!0?Cs.push(qs+Ks[Zs+0],qs+Ks[Zs+2],qs+Ks[Zs+1]):Cs.push(qs+Ks[Zs+0],qs+Ks[Zs+1],qs+Ks[Zs+2])}}const Hs=Yi(Cs,new Float32BufferAttribute(Ns,3)),ta=ns(Cs,Ns,vs),Sa=new BufferGeometry;return Sa.setAttribute("position",Hs),Sa.setAttribute("normal",ta),Sa._solid=Ss,Sa._type="mesh",Sa}function Br(Ri){const Jr=rr[Ri],Xi=cr(Jr);return Xi.isObject3D||Xi.isMaterial?Xi.clone():Xi}function Or(Ri,Jr){for(let Xi=0,ss=Ri.length;Xi<ss;Xi++){const ls=cr(Ri[Xi]);ls instanceof Object3D&&Jr.add(ls)}}function Dr(Ri,Jr){const Xi=[];let ss=0;for(let ls=0,gs=Ri.length;ls<gs;ls++){const _s=Ri[ss],vs=Ri[ls+(Jr?1:2)],As=Ri[ls+(Jr?2:1)];Xi.push(_s,vs,As),(Ri[ls+3]===-1||ls+3>=gs)&&(ls+=3,ss=ls+1)}return Xi}function Wr(Ri,Jr){const Xi=[];let ss=0;for(let ls=0,gs=Jr.length;ls<gs;ls++){const _s=ss*3,vs=Ri[_s],As=Ri[_s+1],Ss=Ri[_s+2];Xi.push(vs,As,Ss),(Jr[ls+3]===-1||ls+3>=gs)&&(ls+=3,ss++)}return Xi}function $r(Ri,Jr){const Xi=[];for(let ss=0,ls=Jr.length;ss<ls;ss++){const _s=Jr[ss]*3,vs=Ri[_s],As=Ri[_s+1],Ss=Ri[_s+2];Xi.push(vs,As,Ss)}return Xi}function Yr(Ri){const Jr=[];for(let Xi=0,ss=Ri.length;Xi<ss;Xi++){const ls=Ri[Xi],gs=Ri[Xi+1];Jr.push(ls,gs),(Ri[Xi+2]===-1||Xi+2>=ss)&&(Xi+=2)}return Jr}function Qi(Ri,Jr){const Xi=[];let ss=0;for(let ls=0,gs=Jr.length;ls<gs;ls++){const _s=ss*3,vs=Ri[_s],As=Ri[_s+1],Ss=Ri[_s+2];Xi.push(vs,As,Ss),(Jr[ls+2]===-1||ls+2>=gs)&&(ls+=2,ss++)}return Xi}const rs=new Vector3$1,Kr=new Vector3$1,Qr=new Vector3$1,Vr=new Vector2,Gr=new Vector2,qr=new Vector2;function ji(Ri,Jr,Xi,ss){const ls=[];for(let gs=0,_s=Ri.length;gs<_s;gs+=3){const vs=Jr[gs],As=Jr[gs+1],Ss=Jr[gs+2];ss===2?(Vr.fromArray(Xi,vs*ss),Gr.fromArray(Xi,As*ss),qr.fromArray(Xi,Ss*ss),ls.push(Vr.x,Vr.y),ls.push(Gr.x,Gr.y),ls.push(qr.x,qr.y)):(rs.fromArray(Xi,vs*ss),Kr.fromArray(Xi,As*ss),Qr.fromArray(Xi,Ss*ss),ls.push(rs.x,rs.y,rs.z),ls.push(Kr.x,Kr.y,Kr.z),ls.push(Qr.x,Qr.y,Qr.z))}return new Float32BufferAttribute(ls,ss)}function Zr(Ri,Jr){const Xi=[];for(let ss=0,ls=0,gs=Ri.length;ss<gs;ss+=3,ls++)rs.fromArray(Jr,ls*3),Xi.push(rs.x,rs.y,rs.z),Xi.push(rs.x,rs.y,rs.z),Xi.push(rs.x,rs.y,rs.z);return new Float32BufferAttribute(Xi,3)}function Zi(Ri,Jr){const Xi=[];for(let ss=0,ls=0,gs=Ri.length;ss<gs;ss+=2,ls++)rs.fromArray(Jr,ls*3),Xi.push(rs.x,rs.y,rs.z),Xi.push(rs.x,rs.y,rs.z);return new Float32BufferAttribute(Xi,3)}function Yi(Ri,Jr){const Xi=Jr.array,ss=Jr.itemSize,ls=new Xi.constructor(Ri.length*ss);let gs=0,_s=0;for(let vs=0,As=Ri.length;vs<As;vs++){gs=Ri[vs]*ss;for(let Ss=0;Ss<ss;Ss++)ls[_s++]=Xi[gs++]}return new Float32BufferAttribute(ls,ss)}const qi=new Vector3$1,Xr=new Vector3$1;function ns(Ri,Jr,Xi){const ss=[],ls={};for(let _s=0,vs=Ri.length;_s<vs;_s+=3){const As=Ri[_s],Ss=Ri[_s+1],Is=Ri[_s+2],Fs=new Face(As,Ss,Is);rs.fromArray(Jr,As*3),Kr.fromArray(Jr,Ss*3),Qr.fromArray(Jr,Is*3),Xr.subVectors(Qr,Kr),qi.subVectors(rs,Kr),Xr.cross(qi),Xr.normalize(),Fs.normal.copy(Xr),ls[As]===void 0&&(ls[As]=[]),ls[Ss]===void 0&&(ls[Ss]=[]),ls[Is]===void 0&&(ls[Is]=[]),ls[As].push(Fs.normal),ls[Ss].push(Fs.normal),ls[Is].push(Fs.normal),ss.push(Fs)}const gs=[];for(let _s=0,vs=ss.length;_s<vs;_s++){const As=ss[_s],Ss=os(ls[As.a],As.normal,Xi),Is=os(ls[As.b],As.normal,Xi),Fs=os(ls[As.c],As.normal,Xi);rs.fromArray(Jr,As.a*3),Kr.fromArray(Jr,As.b*3),Qr.fromArray(Jr,As.c*3),gs.push(Ss.x,Ss.y,Ss.z),gs.push(Is.x,Is.y,Is.z),gs.push(Fs.x,Fs.y,Fs.z)}return new Float32BufferAttribute(gs,3)}function os(Ri,Jr,Xi){const ss=new Vector3$1;if(Xi===0)ss.copy(Jr);else for(let ls=0,gs=Ri.length;ls<gs;ls++)Ri[ls].angleTo(Jr)<Xi&&ss.add(Ri[ls]);return ss.normalize()}function us(Ri){const Jr=[];for(let Xi=0,ss=Ri.length;Xi<ss;Xi+=3)Jr.push(new Color(Ri[Xi],Ri[Xi+1],Ri[Xi+2]));return Jr}function is(Ri){const Jr=new Color;for(let Xi=0;Xi<Ri.count;Xi++)Jr.fromBufferAttribute(Ri,Xi),ColorManagement.toWorkingColorSpace(Jr,SRGBColorSpace),Ri.setXYZ(Xi,Jr.r,Jr.g,Jr.b)}function Ji(Ri,Jr,Xi,ss,ls){const gs=[],_s=ls===!0?0:Math.PI;for(let Ns=0,Ws=ss.length;Ns<Ws;Ns++){let ks=Ns===0?0:Xi[Ns-1];ks=ls===!0?ks:_s-ks;const Vs=new Vector3$1;Vs.setFromSphericalCoords(Jr,ks,0),gs.push(Vs)}const vs=Ri.index,As=Ri.attributes.position,Ss=new BufferAttribute(new Float32Array(Ri.attributes.position.count*3),3),Is=new Vector3$1,Fs=new Color;for(let Ns=0;Ns<vs.count;Ns++){const Ws=vs.getX(Ns);Is.fromBufferAttribute(As,Ws);let ks,Vs,bs=1;for(let Ps=1;Ps<gs.length;Ps++){ks=Ps-1,Vs=Ps;const Qs=gs[ks],Hs=gs[Vs];if(ls===!0){if(Is.y<=Qs.y&&Is.y>Hs.y){bs=Math.abs(Qs.y-Is.y)/Math.abs(Qs.y-Hs.y);break}}else if(Is.y>=Qs.y&&Is.y<Hs.y){bs=Math.abs(Qs.y-Is.y)/Math.abs(Qs.y-Hs.y);break}}const Ms=ss[ks],Cs=ss[Vs];Fs.copy(Ms).lerp(Cs,bs),ColorManagement.toWorkingColorSpace(Fs,SRGBColorSpace),Ss.setXYZ(Ws,Fs.r,Fs.g,Fs.b)}Ri.setAttribute("color",Ss)}const ms=new TextureLoader(this.manager);if(ms.setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin),er.indexOf("#VRML V2.0")===-1)throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");const Ki=nr(er);return or(Ki)}}class VRMLLexer{constructor(er){this.lexer=new chevrotain.Lexer(er)}lex(er){const tr=this.lexer.tokenize(er);if(tr.errors.length>0)throw console.error(tr.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return tr}}const CstParser=chevrotain.CstParser;class VRMLParser extends CstParser{constructor(er){super(er);const tr=this,rr=er.Version,nr=er.LCurly,sr=er.RCurly,ar=er.LSquare,or=er.RSquare,lr=er.Identifier,cr=er.RouteIdentifier,hr=er.StringLiteral,fr=er.HexLiteral,ur=er.NumberLiteral,pr=er.TrueLiteral,gr=er.FalseLiteral,_r=er.NullLiteral,mr=er.DEF,dr=er.USE,vr=er.ROUTE,Ar=er.TO,yr=er.NodeName;tr.RULE("vrml",function(){tr.SUBRULE(tr.version),tr.AT_LEAST_ONE(function(){tr.SUBRULE(tr.node)}),tr.MANY(function(){tr.SUBRULE(tr.route)})}),tr.RULE("version",function(){tr.CONSUME(rr)}),tr.RULE("node",function(){tr.OPTION(function(){tr.SUBRULE(tr.def)}),tr.CONSUME(yr),tr.CONSUME(nr),tr.MANY(function(){tr.SUBRULE(tr.field)}),tr.CONSUME(sr)}),tr.RULE("field",function(){tr.CONSUME(lr),tr.OR2([{ALT:function(){tr.SUBRULE(tr.singleFieldValue)}},{ALT:function(){tr.SUBRULE(tr.multiFieldValue)}}])}),tr.RULE("def",function(){tr.CONSUME(mr),tr.OR([{ALT:function(){tr.CONSUME(lr)}},{ALT:function(){tr.CONSUME(yr)}}])}),tr.RULE("use",function(){tr.CONSUME(dr),tr.OR([{ALT:function(){tr.CONSUME(lr)}},{ALT:function(){tr.CONSUME(yr)}}])}),tr.RULE("singleFieldValue",function(){tr.AT_LEAST_ONE(function(){tr.OR([{ALT:function(){tr.SUBRULE(tr.node)}},{ALT:function(){tr.SUBRULE(tr.use)}},{ALT:function(){tr.CONSUME(hr)}},{ALT:function(){tr.CONSUME(fr)}},{ALT:function(){tr.CONSUME(ur)}},{ALT:function(){tr.CONSUME(pr)}},{ALT:function(){tr.CONSUME(gr)}},{ALT:function(){tr.CONSUME(_r)}}])})}),tr.RULE("multiFieldValue",function(){tr.CONSUME(ar),tr.MANY(function(){tr.OR([{ALT:function(){tr.SUBRULE(tr.node)}},{ALT:function(){tr.SUBRULE(tr.use)}},{ALT:function(){tr.CONSUME(hr)}},{ALT:function(){tr.CONSUME(fr)}},{ALT:function(){tr.CONSUME(ur)}},{ALT:function(){tr.CONSUME(_r)}}])}),tr.CONSUME(or)}),tr.RULE("route",function(){tr.CONSUME(vr),tr.CONSUME(cr),tr.CONSUME(Ar),tr.CONSUME2(cr)}),this.performSelfAnalysis()}}class Face{constructor(er,tr,rr){this.a=er,this.b=tr,this.c=rr,this.normal=new Vector3$1}}const TEXTURE_TYPE={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};class VTKLoader extends Loader{constructor(er){super(er)}load(er,tr,rr,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){function tr(cr){const hr=[],fr=[],ur=[],pr=[];let gr;const _r=/^[^\d.\s-]+/,mr=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,dr=/^(\d+)\s+([\s\d]*)/,vr=/^POINTS /,Ar=/^POLYGONS /,yr=/^TRIANGLE_STRIPS /,wr=/^POINT_DATA[ ]+(\d+)/,br=/^CELL_DATA[ ]+(\d+)/,Sr=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,xr=/^NORMALS[ ]+(\w+)[ ]+(\w+)/;let Cr=!1,Ir=!1,Rr=!1,Pr=!1,Fr=!1,Nr=!1,Ur=!1;const Br=new Color,Or=cr.split(`
`);for(const Wr in Or){const $r=Or[Wr].trim();if($r.indexOf("DATASET")===0){const Yr=$r.split(" ")[1];if(Yr!=="POLYDATA")throw new Error("Unsupported DATASET type: "+Yr)}else if(Cr)for(;(gr=mr.exec($r))!==null&&_r.exec($r)===null;){const Yr=parseFloat(gr[1]),Qi=parseFloat(gr[2]),rs=parseFloat(gr[3]);fr.push(Yr,Qi,rs)}else if(Ir){if((gr=dr.exec($r))!==null){const Yr=parseInt(gr[1]),Qi=gr[2].split(/\s+/);if(Yr>=3){const rs=parseInt(Qi[0]);let Kr=1;for(let Qr=0;Qr<Yr-2;++Qr){const Vr=parseInt(Qi[Kr]),Gr=parseInt(Qi[Kr+1]);hr.push(rs,Vr,Gr),Kr++}}}}else if(Rr){if((gr=dr.exec($r))!==null){const Yr=parseInt(gr[1]),Qi=gr[2].split(/\s+/);if(Yr>=3)for(let rs=0;rs<Yr-2;rs++)if(rs%2===1){const Kr=parseInt(Qi[rs]),Qr=parseInt(Qi[rs+2]),Vr=parseInt(Qi[rs+1]);hr.push(Kr,Qr,Vr)}else{const Kr=parseInt(Qi[rs]),Qr=parseInt(Qi[rs+1]),Vr=parseInt(Qi[rs+2]);hr.push(Kr,Qr,Vr)}}}else if(Pr||Fr){if(Nr)for(;(gr=mr.exec($r))!==null&&_r.exec($r)===null;){const Yr=parseFloat(gr[1]),Qi=parseFloat(gr[2]),rs=parseFloat(gr[3]);Br.setRGB(Yr,Qi,rs,SRGBColorSpace),ur.push(Br.r,Br.g,Br.b)}else if(Ur)for(;(gr=mr.exec($r))!==null&&_r.exec($r)===null;){const Yr=parseFloat(gr[1]),Qi=parseFloat(gr[2]),rs=parseFloat(gr[3]);pr.push(Yr,Qi,rs)}}Ar.exec($r)!==null?(Ir=!0,Cr=!1,Rr=!1):vr.exec($r)!==null?(Ir=!1,Cr=!0,Rr=!1):yr.exec($r)!==null?(Ir=!1,Cr=!1,Rr=!0):wr.exec($r)!==null?(Pr=!0,Cr=!1,Ir=!1,Rr=!1):br.exec($r)!==null?(Fr=!0,Cr=!1,Ir=!1,Rr=!1):Sr.exec($r)!==null?(Nr=!0,Ur=!1,Cr=!1,Ir=!1,Rr=!1):xr.exec($r)!==null&&(Ur=!0,Nr=!1,Cr=!1,Ir=!1,Rr=!1)}let Dr=new BufferGeometry;if(Dr.setIndex(hr),Dr.setAttribute("position",new Float32BufferAttribute(fr,3)),pr.length===fr.length&&Dr.setAttribute("normal",new Float32BufferAttribute(pr,3)),ur.length!==hr.length)ur.length===fr.length&&Dr.setAttribute("color",new Float32BufferAttribute(ur,3));else{Dr=Dr.toNonIndexed();const Wr=Dr.attributes.position.count/3;if(ur.length===Wr*3){const $r=[];for(let Yr=0;Yr<Wr;Yr++){const Qi=ur[3*Yr+0],rs=ur[3*Yr+1],Kr=ur[3*Yr+2];Br.setRGB(Qi,rs,Kr,SRGBColorSpace),$r.push(Br.r,Br.g,Br.b),$r.push(Br.r,Br.g,Br.b),$r.push(Br.r,Br.g,Br.b)}Dr.setAttribute("color",new Float32BufferAttribute($r,3))}}return Dr}function rr(cr){const hr=new Uint8Array(cr),fr=new DataView(cr);let ur=[],pr=[],gr=[],_r=0;function mr(yr,wr){let br=wr,Sr=yr[br];const xr=[];for(;Sr!==10;)xr.push(String.fromCharCode(Sr)),br++,Sr=yr[br];return{start:wr,end:br,next:br+1,parsedString:xr.join("")}}let dr,vr;for(;;){if(dr=mr(hr,_r),vr=dr.parsedString,vr.indexOf("DATASET")===0){const yr=vr.split(" ")[1];if(yr!=="POLYDATA")throw new Error("Unsupported DATASET type: "+yr)}else if(vr.indexOf("POINTS")===0){const yr=parseInt(vr.split(" ")[1],10),wr=yr*4*3;ur=new Float32Array(yr*3);let br=dr.next;for(let Sr=0;Sr<yr;Sr++)ur[3*Sr]=fr.getFloat32(br,!1),ur[3*Sr+1]=fr.getFloat32(br+4,!1),ur[3*Sr+2]=fr.getFloat32(br+8,!1),br=br+12;dr.next=dr.next+wr+1}else if(vr.indexOf("TRIANGLE_STRIPS")===0){const yr=parseInt(vr.split(" ")[1],10),wr=parseInt(vr.split(" ")[2],10),br=wr*4;gr=new Uint32Array(3*wr-9*yr);let Sr=0,xr=dr.next;for(let Cr=0;Cr<yr;Cr++){const Ir=fr.getInt32(xr,!1),Rr=[];xr+=4;for(let Pr=0;Pr<Ir;Pr++)Rr.push(fr.getInt32(xr,!1)),xr+=4;for(let Pr=0;Pr<Ir-2;Pr++)Pr%2?(gr[Sr++]=Rr[Pr],gr[Sr++]=Rr[Pr+2],gr[Sr++]=Rr[Pr+1]):(gr[Sr++]=Rr[Pr],gr[Sr++]=Rr[Pr+1],gr[Sr++]=Rr[Pr+2])}dr.next=dr.next+br+1}else if(vr.indexOf("POLYGONS")===0){const yr=parseInt(vr.split(" ")[1],10),wr=parseInt(vr.split(" ")[2],10),br=wr*4;gr=new Uint32Array(3*wr-9*yr);let Sr=0,xr=dr.next;for(let Cr=0;Cr<yr;Cr++){const Ir=fr.getInt32(xr,!1),Rr=[];xr+=4;for(let Pr=0;Pr<Ir;Pr++)Rr.push(fr.getInt32(xr,!1)),xr+=4;for(let Pr=1;Pr<Ir-1;Pr++)gr[Sr++]=Rr[0],gr[Sr++]=Rr[Pr],gr[Sr++]=Rr[Pr+1]}dr.next=dr.next+br+1}else if(vr.indexOf("POINT_DATA")===0){const yr=parseInt(vr.split(" ")[1],10);dr=mr(hr,dr.next);const wr=yr*4*3;pr=new Float32Array(yr*3);let br=dr.next;for(let Sr=0;Sr<yr;Sr++)pr[3*Sr]=fr.getFloat32(br,!1),pr[3*Sr+1]=fr.getFloat32(br+4,!1),pr[3*Sr+2]=fr.getFloat32(br+8,!1),br+=12;dr.next=dr.next+wr}if(_r=dr.next,_r>=hr.byteLength)break}const Ar=new BufferGeometry;return Ar.setIndex(new BufferAttribute(gr,1)),Ar.setAttribute("position",new BufferAttribute(ur,3)),pr.length===ur.length&&Ar.setAttribute("normal",new BufferAttribute(pr,3)),Ar}function nr(cr,hr){const fr=cr.length,ur=new Float32Array(fr+hr.length);return ur.set(cr),ur.set(hr,fr),ur}function sr(cr,hr){const fr=cr.length,ur=new Int32Array(fr+hr.length);return ur.set(cr),ur.set(hr,fr),ur}function ar(cr){function hr(Ar){let yr={};if(Ar.nodeType===1){if(Ar.attributes&&Ar.attributes.length>0){yr.attributes={};for(let wr=0;wr<Ar.attributes.length;wr++){const br=Ar.attributes.item(wr);yr.attributes[br.nodeName]=br.nodeValue.trim()}}}else Ar.nodeType===3&&(yr=Ar.nodeValue.trim());if(Ar.hasChildNodes())for(let wr=0;wr<Ar.childNodes.length;wr++){const br=Ar.childNodes.item(wr),Sr=br.nodeName;if(typeof yr[Sr]>"u"){const xr=hr(br);xr!==""&&(Array.isArray(xr["#text"])&&(xr["#text"]=xr["#text"][0]),yr[Sr]=xr)}else{if(typeof yr[Sr].push>"u"){const Cr=yr[Sr];yr[Sr]=[Cr]}const xr=hr(br);xr!==""&&(Array.isArray(xr["#text"])&&(xr["#text"]=xr["#text"][0]),yr[Sr].push(xr))}}return yr}function fr(Ar){const yr=typeof Uint8Array<"u"?Uint8Array:Array,wr=[],br="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let Nr=0,Ur=br.length;Nr<Ur;++Nr)wr[br.charCodeAt(Nr)]=Nr;wr[45]=62,wr[95]=63;const Sr=Ar.length;if(Sr%4>0)throw new Error("Invalid string. Length must be a multiple of 4");const xr=Ar[Sr-2]==="="?2:Ar[Sr-1]==="="?1:0,Cr=new yr(Sr*3/4-xr),Ir=xr>0?Sr-4:Sr;let Rr=0,Pr,Fr;for(Pr=0,Fr=0;Pr<Ir;Pr+=4,Fr+=3){const Nr=wr[Ar.charCodeAt(Pr)]<<18|wr[Ar.charCodeAt(Pr+1)]<<12|wr[Ar.charCodeAt(Pr+2)]<<6|wr[Ar.charCodeAt(Pr+3)];Cr[Rr++]=(Nr&16711680)>>16,Cr[Rr++]=(Nr&65280)>>8,Cr[Rr++]=Nr&255}if(xr===2){const Nr=wr[Ar.charCodeAt(Pr)]<<2|wr[Ar.charCodeAt(Pr+1)]>>4;Cr[Rr++]=Nr&255}else if(xr===1){const Nr=wr[Ar.charCodeAt(Pr)]<<10|wr[Ar.charCodeAt(Pr+1)]<<4|wr[Ar.charCodeAt(Pr+2)]>>2;Cr[Rr++]=Nr>>8&255,Cr[Rr++]=Nr&255}return Cr}function ur(Ar,yr){let wr=0;_r.attributes.header_type==="UInt64"?wr=8:_r.attributes.header_type==="UInt32"&&(wr=4);let br,Sr;if(Ar.attributes.format==="binary"&&yr){Ar.attributes.type==="Float32"?br=new Float32Array:(Ar.attributes.type==="Int32"||Ar.attributes.type==="Int64")&&(br=new Int32Array);const xr=Ar["#text"],Cr=Array.isArray(xr)?xr[0]:xr,Ir=fr(Cr),Rr=8;let Pr=Ir[0];for(let Dr=1;Dr<wr-1;Dr++)Pr=Pr|Ir[Dr]<<Dr*Rr;let Fr=(Pr+3)*wr;const Nr=Fr%3>0?3-Fr%3:0;Fr=Fr+Nr;const Ur=[];let Br=Fr;Ur.push(Br);const Or=3*wr;for(let Dr=0;Dr<Pr;Dr++){let Wr=Ir[Dr*wr+Or];for(let $r=1;$r<wr-1;$r++)Wr=Wr|Ir[Dr*wr+Or+$r]<<$r*Rr;Br=Br+Wr,Ur.push(Br)}for(let Dr=0;Dr<Ur.length-1;Dr++)Sr=unzlibSync(Ir.slice(Ur[Dr],Ur[Dr+1])).buffer,Ar.attributes.type==="Float32"?(Sr=new Float32Array(Sr),br=nr(br,Sr)):(Ar.attributes.type==="Int32"||Ar.attributes.type==="Int64")&&(Sr=new Int32Array(Sr),br=sr(br,Sr));delete Ar["#text"],Ar.attributes.type==="Int64"&&Ar.attributes.format==="binary"&&(br=br.filter(function(Dr,Wr){if(Wr%2!==1)return!0}))}else Ar.attributes.format==="binary"&&!yr?(Sr=fr(Ar["#text"]),Sr=Sr.slice(wr).buffer):Ar["#text"]?Sr=Ar["#text"].split(/\s+/).filter(function(xr){if(xr!=="")return xr}):Sr=new Int32Array(0).buffer,delete Ar["#text"],Ar.attributes.type==="Float32"?br=new Float32Array(Sr):Ar.attributes.type==="Int32"?br=new Int32Array(Sr):Ar.attributes.type==="Int64"&&(br=new Int32Array(Sr),Ar.attributes.format==="binary"&&(br=br.filter(function(xr,Cr){if(Cr%2!==1)return!0})));return br}const gr=new DOMParser().parseFromString(cr,"application/xml").documentElement,_r=hr(gr);let mr=[],dr=[],vr=[];if(_r.AppendedData){const Ar=_r.AppendedData["#text"].slice(1),yr=_r.PolyData.Piece,wr=["PointData","CellData","Points","Verts","Lines","Strips","Polys"];let br=0;const Sr=wr.map(xr=>{const Cr=yr[xr];return Cr&&Cr.DataArray?(Array.isArray(Cr.DataArray)?Cr.DataArray:[Cr.DataArray]).map(Rr=>Rr.attributes.offset):[]}).flat();for(const xr of wr){const Cr=yr[xr];if(Cr&&Cr.DataArray)if(Array.isArray(Cr.DataArray))for(const Ir of Cr.DataArray)Ir["#text"]=Ar.slice(Sr[br],Sr[br+1]),Ir.attributes.format="binary",br++;else Cr.DataArray["#text"]=Ar.slice(Sr[br],Sr[br+1]),Cr.DataArray.attributes.format="binary",br++}}if(_r.PolyData){const Ar=_r.PolyData.Piece,yr=_r.attributes.hasOwnProperty("compressor"),wr=["PointData","Points","Strips","Polys"];let br=0;const Sr=wr.length;for(;br<Sr;){const Cr=Ar[wr[br]];if(Cr&&Cr.DataArray){let Ir;Array.isArray(Cr.DataArray)?Ir=Cr.DataArray:Ir=[Cr.DataArray];let Rr=0;const Pr=Ir.length;for(;Rr<Pr;)"#text"in Ir[Rr]&&Ir[Rr]["#text"].length>0&&(Ir[Rr].text=ur(Ir[Rr],yr)),Rr++;switch(wr[br]){case"PointData":{const Fr=parseInt(Ar.attributes.NumberOfPoints),Nr=Cr.attributes.Normals;if(Fr>0){for(let Ur=0,Br=Ir.length;Ur<Br;Ur++)if(Nr===Ir[Ur].attributes.Name){const Or=Ir[Ur].attributes.NumberOfComponents;dr=new Float32Array(Fr*Or),dr.set(Ir[Ur].text,0)}}}break;case"Points":{const Fr=parseInt(Ar.attributes.NumberOfPoints);if(Fr>0){const Nr=Cr.DataArray.attributes.NumberOfComponents;mr=new Float32Array(Fr*Nr),mr.set(Cr.DataArray.text,0)}}break;case"Strips":{const Fr=parseInt(Ar.attributes.NumberOfStrips);if(Fr>0){const Nr=new Int32Array(Cr.DataArray[0].text.length),Ur=new Int32Array(Cr.DataArray[1].text.length);Nr.set(Cr.DataArray[0].text,0),Ur.set(Cr.DataArray[1].text,0);const Br=Fr+Nr.length;vr=new Uint32Array(3*Br-9*Fr);let Or=0;for(let Dr=0,Wr=Fr;Dr<Wr;Dr++){const $r=[];for(let Yr=0,Qi=Ur[Dr],rs=0;Yr<Qi-rs;Yr++)$r.push(Nr[Yr]),Dr>0&&(rs=Ur[Dr-1]);for(let Yr=0,Qi=Ur[Dr],rs=0;Yr<Qi-rs-2;Yr++)Yr%2?(vr[Or++]=$r[Yr],vr[Or++]=$r[Yr+2],vr[Or++]=$r[Yr+1]):(vr[Or++]=$r[Yr],vr[Or++]=$r[Yr+1],vr[Or++]=$r[Yr+2]),Dr>0&&(rs=Ur[Dr-1])}}}break;case"Polys":{const Fr=parseInt(Ar.attributes.NumberOfPolys);if(Fr>0){const Nr=new Int32Array(Cr.DataArray[0].text.length),Ur=new Int32Array(Cr.DataArray[1].text.length);Nr.set(Cr.DataArray[0].text,0),Ur.set(Cr.DataArray[1].text,0);const Br=Fr+Nr.length;vr=new Uint32Array(3*Br-9*Fr);let Or=0,Dr=0,Wr=0,$r=0;const Yr=Fr;for(;Wr<Yr;){const Qi=[];let rs=0;const Kr=Ur[Wr];for(;rs<Kr-$r;)Qi.push(Nr[Dr++]),rs++;let Qr=1;for(;Qr<Kr-$r-1;)vr[Or++]=Qi[0],vr[Or++]=Qi[Qr],vr[Or++]=Qi[Qr+1],Qr++;Wr++,$r=Ur[Wr-1]}}}break;default:break}}br++}const xr=new BufferGeometry;return xr.setIndex(new BufferAttribute(vr,1)),xr.setAttribute("position",new BufferAttribute(mr,3)),dr.length===mr.length&&xr.setAttribute("normal",new BufferAttribute(dr,3)),xr}else throw new Error("Unsupported DATASET type")}const or=new TextDecoder,lr=or.decode(new Uint8Array(er,0,250)).split(`
`);return lr[0].indexOf("xml")!==-1?ar(or.decode(er)):lr[2].includes("ASCII")?tr(or.decode(er)):rr(er)}}class XYZLoader extends Loader{load(er,tr,rr,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},rr,nr)}parse(er){const tr=er.split(`
`),rr=[],nr=[],sr=new Color;for(let or of tr){if(or=or.trim(),or.charAt(0)==="#")continue;const lr=or.split(/\s+/);if(lr.length===3&&(rr.push(parseFloat(lr[0])),rr.push(parseFloat(lr[1])),rr.push(parseFloat(lr[2]))),lr.length===6){rr.push(parseFloat(lr[0])),rr.push(parseFloat(lr[1])),rr.push(parseFloat(lr[2]));const cr=parseFloat(lr[3])/255,hr=parseFloat(lr[4])/255,fr=parseFloat(lr[5])/255;sr.setRGB(cr,hr,fr,SRGBColorSpace),nr.push(sr.r,sr.g,sr.b)}}const ar=new BufferGeometry;return ar.setAttribute("position",new Float32BufferAttribute(rr,3)),nr.length>0&&ar.setAttribute("color",new Float32BufferAttribute(nr,3)),ar}}const GouraudShader={name:"GouraudShader",uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:`

		#define GOURAUD

		varying vec3 vLightFront;
		varying vec3 vIndirectFront;

		#ifdef DOUBLE_SIDED
			varying vec3 vLightBack;
			varying vec3 vIndirectBack;
		#endif

		#include <common>
		#include <uv_pars_vertex>
		#include <envmap_pars_vertex>
		#include <bsdfs>
		#include <lights_pars_begin>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <morphtarget_pars_vertex>
		#include <skinning_pars_vertex>
		#include <shadowmap_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		void main() {

			#include <uv_vertex>
			#include <color_vertex>
			#include <morphcolor_vertex>

			#include <beginnormal_vertex>
			#include <morphnormal_vertex>
			#include <skinbase_vertex>
			#include <skinnormal_vertex>
			#include <defaultnormal_vertex>

			#include <begin_vertex>
			#include <morphtarget_vertex>
			#include <skinning_vertex>
			#include <project_vertex>
			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>

			#include <worldpos_vertex>
			#include <envmap_vertex>

			// inlining legacy <lights_lambert_vertex>

			vec3 diffuse = vec3( 1.0 );

			vec3 geometryPosition = mvPosition.xyz;
			vec3 geometryNormal = normalize( transformedNormal );
			vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );

			vec3 backGeometryNormal = - geometryNormal;

			vLightFront = vec3( 0.0 );
			vIndirectFront = vec3( 0.0 );
			#ifdef DOUBLE_SIDED
				vLightBack = vec3( 0.0 );
				vIndirectBack = vec3( 0.0 );
			#endif

			IncidentLight directLight;
			float dotNL;
			vec3 directLightColor_Diffuse;

			vIndirectFront += getAmbientLightIrradiance( ambientLightColor );

			#if defined( USE_LIGHT_PROBES )

				vIndirectFront += getLightProbeIrradiance( lightProbe, geometryNormal );

			#endif

			#ifdef DOUBLE_SIDED

				vIndirectBack += getAmbientLightIrradiance( ambientLightColor );

				#if defined( USE_LIGHT_PROBES )

					vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometryNormal );

				#endif

			#endif

			#if NUM_POINT_LIGHTS > 0

				#pragma unroll_loop_start
				for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

					getPointLightInfo( pointLights[ i ], geometryPosition, directLight );

					dotNL = dot( geometryNormal, directLight.direction );
					directLightColor_Diffuse = directLight.color;

					vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

					#ifdef DOUBLE_SIDED

						vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

					#endif

				}
				#pragma unroll_loop_end

			#endif

			#if NUM_SPOT_LIGHTS > 0

				#pragma unroll_loop_start
				for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

					getSpotLightInfo( spotLights[ i ], geometryPosition, directLight );

					dotNL = dot( geometryNormal, directLight.direction );
					directLightColor_Diffuse = directLight.color;

					vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

					#ifdef DOUBLE_SIDED

						vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

					#endif
				}
				#pragma unroll_loop_end

			#endif

			#if NUM_DIR_LIGHTS > 0

				#pragma unroll_loop_start
				for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

					getDirectionalLightInfo( directionalLights[ i ], directLight );

					dotNL = dot( geometryNormal, directLight.direction );
					directLightColor_Diffuse = directLight.color;

					vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

					#ifdef DOUBLE_SIDED

						vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

					#endif

				}
				#pragma unroll_loop_end

			#endif

			#if NUM_HEMI_LIGHTS > 0

				#pragma unroll_loop_start
				for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

					vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );

					#ifdef DOUBLE_SIDED

						vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometryNormal );

					#endif

				}
				#pragma unroll_loop_end

			#endif

			#include <shadowmap_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#define GOURAUD

		uniform vec3 diffuse;
		uniform vec3 emissive;
		uniform float opacity;

		varying vec3 vLightFront;
		varying vec3 vIndirectFront;

		#ifdef DOUBLE_SIDED
			varying vec3 vLightBack;
			varying vec3 vIndirectBack;
		#endif

		#include <common>
		#include <packing>
		#include <dithering_pars_fragment>
		#include <color_pars_fragment>
		#include <uv_pars_fragment>
		#include <map_pars_fragment>
		#include <alphamap_pars_fragment>
		#include <alphatest_pars_fragment>
		#include <aomap_pars_fragment>
		#include <lightmap_pars_fragment>
		#include <emissivemap_pars_fragment>
		#include <envmap_common_pars_fragment>
		#include <envmap_pars_fragment>
		#include <bsdfs>
		#include <lights_pars_begin>
		#include <fog_pars_fragment>
		#include <shadowmap_pars_fragment>
		#include <shadowmask_pars_fragment>
		#include <specularmap_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		void main() {

			#include <clipping_planes_fragment>

			vec4 diffuseColor = vec4( diffuse, opacity );
			ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
			vec3 totalEmissiveRadiance = emissive;

			#include <logdepthbuf_fragment>
			#include <map_fragment>
			#include <color_fragment>
			#include <alphamap_fragment>
			#include <alphatest_fragment>
			#include <specularmap_fragment>
			#include <emissivemap_fragment>

			// accumulation

			#ifdef DOUBLE_SIDED

				reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;

			#else

				reflectedLight.indirectDiffuse += vIndirectFront;

			#endif

			#ifdef USE_LIGHTMAP

				vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
				vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
				reflectedLight.indirectDiffuse += lightMapIrradiance;

			#endif

			reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );

			#ifdef DOUBLE_SIDED

				reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;

			#else

				reflectedLight.directDiffuse = vLightFront;

			#endif

			reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();

			// modulation

			#include <aomap_fragment>

			vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

			#include <envmap_fragment>

			#include <opaque_fragment>
			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>
			#include <dithering_fragment>

		}`};class MeshGouraudMaterial extends ShaderMaterial{constructor(er){super(),console.warn("THREE.MeshGouraudMaterial: MeshGouraudMaterial has been deprecated and will be removed with r183. Use THREE.MeshLambertMaterial instead."),this.isMeshGouraudMaterial=!0,this.type="MeshGouraudMaterial",this.combine=MultiplyOperation,this.fog=!1,this.lights=!0,this.clipping=!1;const tr=GouraudShader;this.defines=Object.assign({},tr.defines),this.uniforms=UniformsUtils.clone(tr.uniforms),this.vertexShader=tr.vertexShader,this.fragmentShader=tr.fragmentShader;const rr=["map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","specularMap","alphaMap","envMap","reflectivity","refractionRatio","opacity","diffuse"];for(const nr of rr)Object.defineProperty(this,nr,{get:function(){return this.uniforms[nr].value},set:function(sr){this.uniforms[nr].value=sr}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.specularMap=er.specularMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.combine=er.combine,this.reflectivity=er.reflectivity,this.refractionRatio=er.refractionRatio,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.fog=er.fog,this}}class LDrawConditionalLineMaterial extends ShaderMaterial{static get type(){return"LDrawConditionalLineMaterial"}constructor(er){super({uniforms:UniformsUtils.merge([UniformsLib.fog,{diffuse:{value:new Color},opacity:{value:1}}]),vertexShader:`
				attribute vec3 control0;
				attribute vec3 control1;
				attribute vec3 direction;
				varying float discardFlag;

				#include <common>
				#include <color_pars_vertex>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>
				void main() {
					#include <color_vertex>

					vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

					// Transform the line segment ends and control points into camera clip space
					vec4 c0 = projectionMatrix * modelViewMatrix * vec4( control0, 1.0 );
					vec4 c1 = projectionMatrix * modelViewMatrix * vec4( control1, 1.0 );
					vec4 p0 = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
					vec4 p1 = projectionMatrix * modelViewMatrix * vec4( position + direction, 1.0 );

					c0.xy /= c0.w;
					c1.xy /= c1.w;
					p0.xy /= p0.w;
					p1.xy /= p1.w;

					// Get the direction of the segment and an orthogonal vector
					vec2 dir = p1.xy - p0.xy;
					vec2 norm = vec2( -dir.y, dir.x );

					// Get control point directions from the line
					vec2 c0dir = c0.xy - p1.xy;
					vec2 c1dir = c1.xy - p1.xy;

					// If the vectors to the controls points are pointed in different directions away
					// from the line segment then the line should not be drawn.
					float d0 = dot( normalize( norm ), normalize( c0dir ) );
					float d1 = dot( normalize( norm ), normalize( c1dir ) );
					discardFlag = float( sign( d0 ) != sign( d1 ) );

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>
				}
			`,fragmentShader:`
			uniform vec3 diffuse;
			uniform float opacity;
			varying float discardFlag;

			#include <common>
			#include <color_pars_fragment>
			#include <fog_pars_fragment>
			#include <logdepthbuf_pars_fragment>
			#include <clipping_planes_pars_fragment>
			void main() {

				if ( discardFlag > 0.5 ) discard;

				#include <clipping_planes_fragment>
				vec3 outgoingLight = vec3( 0.0 );
				vec4 diffuseColor = vec4( diffuse, opacity );
				#include <logdepthbuf_fragment>
				#include <color_fragment>
				outgoingLight = diffuseColor.rgb; // simple shader
				gl_FragColor = vec4( outgoingLight, diffuseColor.a );
				#include <tonemapping_fragment>
				#include <colorspace_fragment>
				#include <fog_fragment>
				#include <premultiplied_alpha_fragment>
			}
			`}),Object.defineProperties(this,{opacity:{get:function(){return this.uniforms.opacity.value},set:function(tr){this.uniforms.opacity.value=tr}},color:{get:function(){return this.uniforms.diffuse.value}}}),this.setValues(er),this.isLDrawConditionalLineMaterial=!0}}class MeshPostProcessingMaterial extends MeshPhysicalMaterial{constructor(er){const tr=er.aoPassMap,rr=er.aoPassMapScale||1;delete er.aoPassMap,delete er.aoPassMapScale,super(er),this.onBeforeCompile=this._onBeforeCompile,this.customProgramCacheKey=this._customProgramCacheKey,this._aoPassMap=tr,this.aoPassMapScale=rr,this._shader=null}get aoPassMap(){return this._aoPassMap}set aoPassMap(er){this._aoPassMap=er,this.needsUpdate=!0,this._setUniforms()}_customProgramCacheKey(){return this._aoPassMap!==void 0&&this._aoPassMap!==null?"aoPassMap":""}_onBeforeCompile(er){this._shader=er,this._aoPassMap!==void 0&&this._aoPassMap!==null&&(er.fragmentShader=er.fragmentShader.replace("#include <aomap_pars_fragment>",aomap_pars_fragment_replacement),er.fragmentShader=er.fragmentShader.replace("#include <aomap_fragment>",aomap_fragment_replacement)),this._setUniforms()}_setUniforms(){this._shader&&(this._shader.uniforms.tAoPassMap={value:this._aoPassMap},this._shader.uniforms.aoPassMapScale={value:this.aoPassMapScale})}}const aomap_pars_fragment_replacement=`
#ifdef USE_AOMAP

	uniform sampler2D aoMap;
	uniform float aoMapIntensity;

#endif

	uniform sampler2D tAoPassMap;
	uniform float aoPassMapScale;
`,aomap_fragment_replacement=`
#ifndef AOPASSMAP_SWIZZLE
	#define AOPASSMAP_SWIZZLE r
#endif
	float ambientOcclusion = texelFetch( tAoPassMap, ivec2( gl_FragCoord.xy * aoPassMapScale ), 0 ).AOPASSMAP_SWIZZLE;

#ifdef USE_AOMAP

	// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	ambientOcclusion = min( ambientOcclusion, texture2D( aoMap, vAoMapUv ).r );
	ambientOcclusion *= ( ambientOcclusion - 1.0 ) * aoMapIntensity + 1.0;

#endif

	reflectedLight.indirectDiffuse *= ambientOcclusion;

	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif

	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif

	#if defined( USE_ENVMAP ) && defined( STANDARD )

		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );

		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );

	#endif
`;class Capsule{constructor(er=new Vector3$1(0,0,0),tr=new Vector3$1(0,1,0),rr=1){this.start=er,this.end=tr,this.radius=rr}clone(){return new Capsule(this.start.clone(),this.end.clone(),this.radius)}set(er,tr,rr){this.start.copy(er),this.end.copy(tr),this.radius=rr}copy(er){this.start.copy(er.start),this.end.copy(er.end),this.radius=er.radius}getCenter(er){return er.copy(this.end).add(this.start).multiplyScalar(.5)}translate(er){this.start.add(er),this.end.add(er)}checkAABBAxis(er,tr,rr,nr,sr,ar,or,lr,cr){return(sr-er<cr||sr-rr<cr)&&(er-ar<cr||rr-ar<cr)&&(or-tr<cr||or-nr<cr)&&(tr-lr<cr||nr-lr<cr)}intersectsBox(er){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,er.min.x,er.max.x,er.min.y,er.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,er.min.x,er.max.x,er.min.z,er.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,er.min.y,er.max.y,er.min.z,er.max.z,this.radius)}}const _hsl={};class ColorConverter{static setHSV(er,tr,rr,nr){return tr=MathUtils.euclideanModulo(tr,1),rr=MathUtils.clamp(rr,0,1),nr=MathUtils.clamp(nr,0,1),er.setHSL(tr,rr*nr/((tr=(2-rr)*nr)<1?tr:2-tr),tr*.5)}static getHSV(er,tr){return er.getHSL(_hsl),_hsl.s*=_hsl.l<.5?_hsl.l:1-_hsl.l,tr.h=_hsl.h,tr.s=2*_hsl.s/(_hsl.l+_hsl.s),tr.v=_hsl.l+_hsl.s,tr}}const _p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let ir=0;ir<256;ir++)_p[256+ir]=_p[ir];function fade(ir){return ir*ir*ir*(ir*(ir*6-15)+10)}function lerp(ir,er,tr){return er+ir*(tr-er)}function grad(ir,er,tr,rr){const nr=ir&15,sr=nr<8?er:tr,ar=nr<4?tr:nr==12||nr==14?er:rr;return(nr&1?-sr:sr)+(nr&2?-ar:ar)}class ImprovedNoise{noise(er,tr,rr){const nr=Math.floor(er),sr=Math.floor(tr),ar=Math.floor(rr),or=nr&255,lr=sr&255,cr=ar&255;er-=nr,tr-=sr,rr-=ar;const hr=er-1,fr=tr-1,ur=rr-1,pr=fade(er),gr=fade(tr),_r=fade(rr),mr=_p[or]+lr,dr=_p[mr]+cr,vr=_p[mr+1]+cr,Ar=_p[or+1]+lr,yr=_p[Ar]+cr,wr=_p[Ar+1]+cr;return lerp(_r,lerp(gr,lerp(pr,grad(_p[dr],er,tr,rr),grad(_p[yr],hr,tr,rr)),lerp(pr,grad(_p[vr],er,fr,rr),grad(_p[wr],hr,fr,rr))),lerp(gr,lerp(pr,grad(_p[dr+1],er,tr,ur),grad(_p[yr+1],hr,tr,ur)),lerp(pr,grad(_p[vr+1],er,fr,ur),grad(_p[wr+1],hr,fr,ur))))}}class Lut{constructor(er,tr=32){this.isLut=!0,this.lut=[],this.map=[],this.n=0,this.minV=0,this.maxV=1,this.setColorMap(er,tr)}set(er){return er.isLut===!0&&this.copy(er),this}setMin(er){return this.minV=er,this}setMax(er){return this.maxV=er,this}setColorMap(er,tr=32){this.map=ColorMapKeywords[er]||ColorMapKeywords.rainbow,this.n=tr;const rr=1/this.n,nr=new Color,sr=new Color;this.lut.length=0,this.lut.push(new Color(this.map[0][1]));for(let ar=1;ar<tr;ar++){const or=ar*rr;for(let lr=0;lr<this.map.length-1;lr++)if(or>this.map[lr][0]&&or<=this.map[lr+1][0]){const cr=this.map[lr][0],hr=this.map[lr+1][0];nr.setHex(this.map[lr][1],LinearSRGBColorSpace),sr.setHex(this.map[lr+1][1],LinearSRGBColorSpace);const fr=new Color().lerpColors(nr,sr,(or-cr)/(hr-cr));this.lut.push(fr)}}return this.lut.push(new Color(this.map[this.map.length-1][1])),this}copy(er){return this.lut=er.lut,this.map=er.map,this.n=er.n,this.minV=er.minV,this.maxV=er.maxV,this}getColor(er){er=MathUtils.clamp(er,this.minV,this.maxV),er=(er-this.minV)/(this.maxV-this.minV);const tr=Math.round(er*this.n);return this.lut[tr]}addColorMap(er,tr){return ColorMapKeywords[er]=tr,this}createCanvas(){const er=document.createElement("canvas");return er.width=1,er.height=this.n,this.updateCanvas(er),er}updateCanvas(er){const tr=er.getContext("2d",{alpha:!1}),rr=tr.getImageData(0,0,1,this.n),nr=rr.data;let sr=0;const ar=1/this.n,or=new Color,lr=new Color,cr=new Color;for(let hr=1;hr>=0;hr-=ar)for(let fr=this.map.length-1;fr>=0;fr--)if(hr<this.map[fr][0]&&hr>=this.map[fr-1][0]){const ur=this.map[fr-1][0],pr=this.map[fr][0];or.setHex(this.map[fr-1][1],LinearSRGBColorSpace),lr.setHex(this.map[fr][1],LinearSRGBColorSpace),cr.lerpColors(or,lr,(hr-ur)/(pr-ur)),nr[sr*4]=Math.round(cr.r*255),nr[sr*4+1]=Math.round(cr.g*255),nr[sr*4+2]=Math.round(cr.b*255),nr[sr*4+3]=255,sr+=1}return tr.putImageData(rr,0,0),er}}const ColorMapKeywords={rainbow:[[0,255],[.2,65535],[.5,65280],[.8,16776960],[1,16711680]],cooltowarm:[[0,3952322],[.2,10206463],[.5,14474460],[.8,16163717],[1,11797542]],blackbody:[[0,0],[.2,7864320],[.5,15086080],[.8,16776960],[1,16777215]],grayscale:[[0,0],[.2,4210752],[.5,8355712],[.8,12566463],[1,16777215]]},_face=new Triangle$2,_color$1=new Vector3$1,_uva=new Vector2,_uvb=new Vector2,_uvc=new Vector2;class MeshSurfaceSampler{constructor(er){this.geometry=er.geometry,this.randomFunction=Math.random,this.indexAttribute=this.geometry.index,this.positionAttribute=this.geometry.getAttribute("position"),this.normalAttribute=this.geometry.getAttribute("normal"),this.colorAttribute=this.geometry.getAttribute("color"),this.uvAttribute=this.geometry.getAttribute("uv"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(er){return this.weightAttribute=er?this.geometry.getAttribute(er):null,this}build(){const er=this.indexAttribute,tr=this.positionAttribute,rr=this.weightAttribute,nr=er?er.count/3:tr.count/3,sr=new Float32Array(nr);for(let lr=0;lr<nr;lr++){let cr=1,hr=3*lr,fr=3*lr+1,ur=3*lr+2;er&&(hr=er.getX(hr),fr=er.getX(fr),ur=er.getX(ur)),rr&&(cr=rr.getX(hr)+rr.getX(fr)+rr.getX(ur)),_face.a.fromBufferAttribute(tr,hr),_face.b.fromBufferAttribute(tr,fr),_face.c.fromBufferAttribute(tr,ur),cr*=_face.getArea(),sr[lr]=cr}const ar=new Float32Array(nr);let or=0;for(let lr=0;lr<nr;lr++)or+=sr[lr],ar[lr]=or;return this.distribution=ar,this}setRandomGenerator(er){return this.randomFunction=er,this}sample(er,tr,rr,nr){const sr=this.sampleFaceIndex();return this.sampleFace(sr,er,tr,rr,nr)}sampleFaceIndex(){const er=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*er)}binarySearch(er){const tr=this.distribution;let rr=0,nr=tr.length-1,sr=-1;for(;rr<=nr;){const ar=Math.ceil((rr+nr)/2);if(ar===0||tr[ar-1]<=er&&tr[ar]>er){sr=ar;break}else er<tr[ar]?nr=ar-1:rr=ar+1}return sr}sampleFace(er,tr,rr,nr,sr){let ar=this.randomFunction(),or=this.randomFunction();ar+or>1&&(ar=1-ar,or=1-or);const lr=this.indexAttribute;let cr=er*3,hr=er*3+1,fr=er*3+2;return lr&&(cr=lr.getX(cr),hr=lr.getX(hr),fr=lr.getX(fr)),_face.a.fromBufferAttribute(this.positionAttribute,cr),_face.b.fromBufferAttribute(this.positionAttribute,hr),_face.c.fromBufferAttribute(this.positionAttribute,fr),tr.set(0,0,0).addScaledVector(_face.a,ar).addScaledVector(_face.b,or).addScaledVector(_face.c,1-(ar+or)),rr!==void 0&&(this.normalAttribute!==void 0?(_face.a.fromBufferAttribute(this.normalAttribute,cr),_face.b.fromBufferAttribute(this.normalAttribute,hr),_face.c.fromBufferAttribute(this.normalAttribute,fr),rr.set(0,0,0).addScaledVector(_face.a,ar).addScaledVector(_face.b,or).addScaledVector(_face.c,1-(ar+or)).normalize()):_face.getNormal(rr)),nr!==void 0&&this.colorAttribute!==void 0&&(_face.a.fromBufferAttribute(this.colorAttribute,cr),_face.b.fromBufferAttribute(this.colorAttribute,hr),_face.c.fromBufferAttribute(this.colorAttribute,fr),_color$1.set(0,0,0).addScaledVector(_face.a,ar).addScaledVector(_face.b,or).addScaledVector(_face.c,1-(ar+or)),nr.r=_color$1.x,nr.g=_color$1.y,nr.b=_color$1.z),sr!==void 0&&this.uvAttribute!==void 0&&(_uva.fromBufferAttribute(this.uvAttribute,cr),_uvb.fromBufferAttribute(this.uvAttribute,hr),_uvc.fromBufferAttribute(this.uvAttribute,fr),sr.set(0,0).addScaledVector(_uva,ar).addScaledVector(_uvb,or).addScaledVector(_uvc,1-(ar+or))),this}}const a={c:null,u:[new Vector3$1,new Vector3$1,new Vector3$1],e:[]},b={c:null,u:[new Vector3$1,new Vector3$1,new Vector3$1],e:[]},R=[[],[],[]],AbsR=[[],[],[]],t=[],xAxis=new Vector3$1,yAxis=new Vector3$1,zAxis=new Vector3$1,v1=new Vector3$1,size=new Vector3$1,closestPoint=new Vector3$1,rotationMatrix=new Matrix3,aabb=new Box3,matrix$1=new Matrix4,inverse=new Matrix4,localRay=new Ray$1;class OBB{constructor(er=new Vector3$1,tr=new Vector3$1,rr=new Matrix3){this.center=er,this.halfSize=tr,this.rotation=rr}set(er,tr,rr){return this.center=er,this.halfSize=tr,this.rotation=rr,this}copy(er){return this.center.copy(er.center),this.halfSize.copy(er.halfSize),this.rotation.copy(er.rotation),this}clone(){return new this.constructor().copy(this)}getSize(er){return er.copy(this.halfSize).multiplyScalar(2)}clampPoint(er,tr){const rr=this.halfSize;v1.subVectors(er,this.center),this.rotation.extractBasis(xAxis,yAxis,zAxis),tr.copy(this.center);const nr=MathUtils.clamp(v1.dot(xAxis),-rr.x,rr.x);tr.add(xAxis.multiplyScalar(nr));const sr=MathUtils.clamp(v1.dot(yAxis),-rr.y,rr.y);tr.add(yAxis.multiplyScalar(sr));const ar=MathUtils.clamp(v1.dot(zAxis),-rr.z,rr.z);return tr.add(zAxis.multiplyScalar(ar)),tr}containsPoint(er){return v1.subVectors(er,this.center),this.rotation.extractBasis(xAxis,yAxis,zAxis),Math.abs(v1.dot(xAxis))<=this.halfSize.x&&Math.abs(v1.dot(yAxis))<=this.halfSize.y&&Math.abs(v1.dot(zAxis))<=this.halfSize.z}intersectsBox3(er){return this.intersectsOBB(obb.fromBox3(er))}intersectsSphere(er){return this.clampPoint(er.center,closestPoint),closestPoint.distanceToSquared(er.center)<=er.radius*er.radius}intersectsOBB(er,tr=Number.EPSILON){a.c=this.center,a.e[0]=this.halfSize.x,a.e[1]=this.halfSize.y,a.e[2]=this.halfSize.z,this.rotation.extractBasis(a.u[0],a.u[1],a.u[2]),b.c=er.center,b.e[0]=er.halfSize.x,b.e[1]=er.halfSize.y,b.e[2]=er.halfSize.z,er.rotation.extractBasis(b.u[0],b.u[1],b.u[2]);for(let sr=0;sr<3;sr++)for(let ar=0;ar<3;ar++)R[sr][ar]=a.u[sr].dot(b.u[ar]);v1.subVectors(b.c,a.c),t[0]=v1.dot(a.u[0]),t[1]=v1.dot(a.u[1]),t[2]=v1.dot(a.u[2]);for(let sr=0;sr<3;sr++)for(let ar=0;ar<3;ar++)AbsR[sr][ar]=Math.abs(R[sr][ar])+tr;let rr,nr;for(let sr=0;sr<3;sr++)if(rr=a.e[sr],nr=b.e[0]*AbsR[sr][0]+b.e[1]*AbsR[sr][1]+b.e[2]*AbsR[sr][2],Math.abs(t[sr])>rr+nr)return!1;for(let sr=0;sr<3;sr++)if(rr=a.e[0]*AbsR[0][sr]+a.e[1]*AbsR[1][sr]+a.e[2]*AbsR[2][sr],nr=b.e[sr],Math.abs(t[0]*R[0][sr]+t[1]*R[1][sr]+t[2]*R[2][sr])>rr+nr)return!1;return rr=a.e[1]*AbsR[2][0]+a.e[2]*AbsR[1][0],nr=b.e[1]*AbsR[0][2]+b.e[2]*AbsR[0][1],!(Math.abs(t[2]*R[1][0]-t[1]*R[2][0])>rr+nr||(rr=a.e[1]*AbsR[2][1]+a.e[2]*AbsR[1][1],nr=b.e[0]*AbsR[0][2]+b.e[2]*AbsR[0][0],Math.abs(t[2]*R[1][1]-t[1]*R[2][1])>rr+nr)||(rr=a.e[1]*AbsR[2][2]+a.e[2]*AbsR[1][2],nr=b.e[0]*AbsR[0][1]+b.e[1]*AbsR[0][0],Math.abs(t[2]*R[1][2]-t[1]*R[2][2])>rr+nr)||(rr=a.e[0]*AbsR[2][0]+a.e[2]*AbsR[0][0],nr=b.e[1]*AbsR[1][2]+b.e[2]*AbsR[1][1],Math.abs(t[0]*R[2][0]-t[2]*R[0][0])>rr+nr)||(rr=a.e[0]*AbsR[2][1]+a.e[2]*AbsR[0][1],nr=b.e[0]*AbsR[1][2]+b.e[2]*AbsR[1][0],Math.abs(t[0]*R[2][1]-t[2]*R[0][1])>rr+nr)||(rr=a.e[0]*AbsR[2][2]+a.e[2]*AbsR[0][2],nr=b.e[0]*AbsR[1][1]+b.e[1]*AbsR[1][0],Math.abs(t[0]*R[2][2]-t[2]*R[0][2])>rr+nr)||(rr=a.e[0]*AbsR[1][0]+a.e[1]*AbsR[0][0],nr=b.e[1]*AbsR[2][2]+b.e[2]*AbsR[2][1],Math.abs(t[1]*R[0][0]-t[0]*R[1][0])>rr+nr)||(rr=a.e[0]*AbsR[1][1]+a.e[1]*AbsR[0][1],nr=b.e[0]*AbsR[2][2]+b.e[2]*AbsR[2][0],Math.abs(t[1]*R[0][1]-t[0]*R[1][1])>rr+nr)||(rr=a.e[0]*AbsR[1][2]+a.e[1]*AbsR[0][2],nr=b.e[0]*AbsR[2][1]+b.e[1]*AbsR[2][0],Math.abs(t[1]*R[0][2]-t[0]*R[1][2])>rr+nr))}intersectsPlane(er){this.rotation.extractBasis(xAxis,yAxis,zAxis);const tr=this.halfSize.x*Math.abs(er.normal.dot(xAxis))+this.halfSize.y*Math.abs(er.normal.dot(yAxis))+this.halfSize.z*Math.abs(er.normal.dot(zAxis)),rr=er.normal.dot(this.center)-er.constant;return Math.abs(rr)<=tr}intersectRay(er,tr){return this.getSize(size),aabb.setFromCenterAndSize(v1.set(0,0,0),size),matrix$1.setFromMatrix3(this.rotation),matrix$1.setPosition(this.center),inverse.copy(matrix$1).invert(),localRay.copy(er).applyMatrix4(inverse),localRay.intersectBox(aabb,tr)?tr.applyMatrix4(matrix$1):null}intersectsRay(er){return this.intersectRay(er,v1)!==null}fromBox3(er){return er.getCenter(this.center),er.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(er){return er.center.equals(this.center)&&er.halfSize.equals(this.halfSize)&&er.rotation.equals(this.rotation)}applyMatrix4(er){const tr=er.elements;let rr=v1.set(tr[0],tr[1],tr[2]).length();const nr=v1.set(tr[4],tr[5],tr[6]).length(),sr=v1.set(tr[8],tr[9],tr[10]).length();er.determinant()<0&&(rr=-rr),rotationMatrix.setFromMatrix4(er);const or=1/rr,lr=1/nr,cr=1/sr;return rotationMatrix.elements[0]*=or,rotationMatrix.elements[1]*=or,rotationMatrix.elements[2]*=or,rotationMatrix.elements[3]*=lr,rotationMatrix.elements[4]*=lr,rotationMatrix.elements[5]*=lr,rotationMatrix.elements[6]*=cr,rotationMatrix.elements[7]*=cr,rotationMatrix.elements[8]*=cr,this.rotation.multiply(rotationMatrix),this.halfSize.x*=rr,this.halfSize.y*=nr,this.halfSize.z*=sr,v1.setFromMatrixPosition(er),this.center.add(v1),this}}const obb=new OBB,_v1$1=new Vector3$1,_v2=new Vector3$1,_point1=new Vector3$1,_point2=new Vector3$1,_plane=new Plane,_line1=new Line3,_line2=new Line3,_sphere=new Sphere,_capsule=new Capsule,_temp1=new Vector3$1,_temp2=new Vector3$1,_temp3=new Vector3$1,EPS=1e-10;function lineToLineClosestPoints(ir,er,tr=null,rr=null){const nr=_temp1.copy(ir.end).sub(ir.start),sr=_temp2.copy(er.end).sub(er.start),ar=_temp3.copy(er.start).sub(ir.start),or=nr.dot(sr),lr=nr.dot(nr),cr=sr.dot(sr),hr=sr.dot(ar),fr=nr.dot(ar);let ur,pr;const gr=lr*cr-or*or;if(Math.abs(gr)<EPS){const _r=-hr/cr,mr=(or-hr)/cr;Math.abs(_r-.5)<Math.abs(mr-.5)?(ur=0,pr=_r):(ur=1,pr=mr)}else ur=(hr*or+fr*cr)/gr,pr=(ur*or-hr)/cr;pr=Math.max(0,Math.min(1,pr)),ur=Math.max(0,Math.min(1,ur)),tr&&tr.copy(nr).multiplyScalar(ur).add(ir.start),rr&&rr.copy(sr).multiplyScalar(pr).add(er.start)}class Octree{constructor(er){this.box=er,this.bounds=new Box3,this.subTrees=[],this.triangles=[],this.layers=new Layers}addTriangle(er){return this.bounds.min.x=Math.min(this.bounds.min.x,er.a.x,er.b.x,er.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,er.a.y,er.b.y,er.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,er.a.z,er.b.z,er.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,er.a.x,er.b.x,er.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,er.a.y,er.b.y,er.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,er.a.z,er.b.z,er.c.z),this.triangles.push(er),this}calcBox(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}split(er){if(!this.box)return;const tr=[],rr=_v2.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let sr=0;sr<2;sr++)for(let ar=0;ar<2;ar++)for(let or=0;or<2;or++){const lr=new Box3,cr=_v1$1.set(sr,ar,or);lr.min.copy(this.box.min).add(cr.multiply(rr)),lr.max.copy(lr.min).add(rr),tr.push(new Octree(lr))}let nr;for(;nr=this.triangles.pop();)for(let sr=0;sr<tr.length;sr++)tr[sr].box.intersectsTriangle(nr)&&tr[sr].triangles.push(nr);for(let sr=0;sr<tr.length;sr++){const ar=tr[sr].triangles.length;ar>8&&er<16&&tr[sr].split(er+1),ar!==0&&this.subTrees.push(tr[sr])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(er,tr){for(let rr=0;rr<this.subTrees.length;rr++){const nr=this.subTrees[rr];if(er.intersectsBox(nr.box))if(nr.triangles.length>0)for(let sr=0;sr<nr.triangles.length;sr++)tr.indexOf(nr.triangles[sr])===-1&&tr.push(nr.triangles[sr]);else nr.getRayTriangles(er,tr)}return tr}triangleCapsuleIntersect(er,tr){tr.getPlane(_plane);const rr=_plane.distanceToPoint(er.start)-er.radius,nr=_plane.distanceToPoint(er.end)-er.radius;if(rr>0&&nr>0||rr<-er.radius&&nr<-er.radius)return!1;const sr=Math.abs(rr/(Math.abs(rr)+Math.abs(nr))),ar=_v1$1.copy(er.start).lerp(er.end,sr);if(tr.containsPoint(ar))return{normal:_plane.normal.clone(),point:ar.clone(),depth:Math.abs(Math.min(rr,nr))};const or=er.radius*er.radius,lr=_line1.set(er.start,er.end),cr=[[tr.a,tr.b],[tr.b,tr.c],[tr.c,tr.a]];for(let hr=0;hr<cr.length;hr++){const fr=_line2.set(cr[hr][0],cr[hr][1]);if(lineToLineClosestPoints(lr,fr,_point1,_point2),_point1.distanceToSquared(_point2)<or)return{normal:_point1.clone().sub(_point2).normalize(),point:_point2.clone(),depth:er.radius-_point1.distanceTo(_point2)}}return!1}triangleSphereIntersect(er,tr){if(tr.getPlane(_plane),!er.intersectsPlane(_plane))return!1;const rr=Math.abs(_plane.distanceToSphere(er)),nr=er.radius*er.radius-rr*rr,sr=_plane.projectPoint(er.center,_v1$1);if(tr.containsPoint(er.center))return{normal:_plane.normal.clone(),point:sr.clone(),depth:Math.abs(_plane.distanceToSphere(er))};const ar=[[tr.a,tr.b],[tr.b,tr.c],[tr.c,tr.a]];for(let or=0;or<ar.length;or++){_line1.set(ar[or][0],ar[or][1]),_line1.closestPointToPoint(sr,!0,_v2);const lr=_v2.distanceToSquared(er.center);if(lr<nr)return{normal:er.center.clone().sub(_v2).normalize(),point:_v2.clone(),depth:er.radius-Math.sqrt(lr)}}return!1}getSphereTriangles(er,tr){for(let rr=0;rr<this.subTrees.length;rr++){const nr=this.subTrees[rr];if(er.intersectsBox(nr.box))if(nr.triangles.length>0)for(let sr=0;sr<nr.triangles.length;sr++)tr.indexOf(nr.triangles[sr])===-1&&tr.push(nr.triangles[sr]);else nr.getSphereTriangles(er,tr)}}getCapsuleTriangles(er,tr){for(let rr=0;rr<this.subTrees.length;rr++){const nr=this.subTrees[rr];if(er.intersectsBox(nr.box))if(nr.triangles.length>0)for(let sr=0;sr<nr.triangles.length;sr++)tr.indexOf(nr.triangles[sr])===-1&&tr.push(nr.triangles[sr]);else nr.getCapsuleTriangles(er,tr)}}sphereIntersect(er){_sphere.copy(er);const tr=[];let rr,nr=!1;this.getSphereTriangles(er,tr);for(let sr=0;sr<tr.length;sr++)(rr=this.triangleSphereIntersect(_sphere,tr[sr]))&&(nr=!0,_sphere.center.add(rr.normal.multiplyScalar(rr.depth)));if(nr){const sr=_sphere.center.clone().sub(er.center),ar=sr.length();return{normal:sr.normalize(),depth:ar}}return!1}capsuleIntersect(er){_capsule.copy(er);const tr=[];let rr,nr=!1;this.getCapsuleTriangles(_capsule,tr);for(let sr=0;sr<tr.length;sr++)(rr=this.triangleCapsuleIntersect(_capsule,tr[sr]))&&(nr=!0,_capsule.translate(rr.normal.multiplyScalar(rr.depth)));if(nr){const sr=_capsule.getCenter(new Vector3$1).sub(er.getCenter(_v1$1)),ar=sr.length();return{normal:sr.normalize(),depth:ar}}return!1}rayIntersect(er){if(er.direction.length()===0)return;const tr=[];let rr,nr,sr=1e100;this.getRayTriangles(er,tr);for(let ar=0;ar<tr.length;ar++){const or=er.intersectTriangle(tr[ar].a,tr[ar].b,tr[ar].c,!0,_v1$1);if(or){const lr=or.sub(er.origin).length();sr>lr&&(nr=or.clone().add(er.origin),sr=lr,rr=tr[ar])}}return sr<1e100?{distance:sr,triangle:rr,position:nr}:!1}fromGraphNode(er){return er.updateWorldMatrix(!0,!0),er.traverse(tr=>{if(tr.isMesh===!0&&this.layers.test(tr.layers)){let rr,nr=!1;tr.geometry.index!==null?(nr=!0,rr=tr.geometry.toNonIndexed()):rr=tr.geometry;const sr=rr.getAttribute("position");for(let ar=0;ar<sr.count;ar+=3){const or=new Vector3$1().fromBufferAttribute(sr,ar),lr=new Vector3$1().fromBufferAttribute(sr,ar+1),cr=new Vector3$1().fromBufferAttribute(sr,ar+2);or.applyMatrix4(tr.matrixWorld),lr.applyMatrix4(tr.matrixWorld),cr.applyMatrix4(tr.matrixWorld),this.addTriangle(new Triangle$2(or,lr,cr))}nr&&rr.dispose()}}),this.build(),this}clear(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}class SimplexNoise{constructor(er=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let tr=0;tr<256;tr++)this.p[tr]=Math.floor(er.random()*256);this.perm=[];for(let tr=0;tr<512;tr++)this.perm[tr]=this.p[tr&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(er,tr,rr){return er[0]*tr+er[1]*rr}dot3(er,tr,rr,nr){return er[0]*tr+er[1]*rr+er[2]*nr}dot4(er,tr,rr,nr,sr){return er[0]*tr+er[1]*rr+er[2]*nr+er[3]*sr}noise(er,tr){let rr,nr,sr;const ar=.5*(Math.sqrt(3)-1),or=(er+tr)*ar,lr=Math.floor(er+or),cr=Math.floor(tr+or),hr=(3-Math.sqrt(3))/6,fr=(lr+cr)*hr,ur=lr-fr,pr=cr-fr,gr=er-ur,_r=tr-pr;let mr,dr;gr>_r?(mr=1,dr=0):(mr=0,dr=1);const vr=gr-mr+hr,Ar=_r-dr+hr,yr=gr-1+2*hr,wr=_r-1+2*hr,br=lr&255,Sr=cr&255,xr=this.perm[br+this.perm[Sr]]%12,Cr=this.perm[br+mr+this.perm[Sr+dr]]%12,Ir=this.perm[br+1+this.perm[Sr+1]]%12;let Rr=.5-gr*gr-_r*_r;Rr<0?rr=0:(Rr*=Rr,rr=Rr*Rr*this.dot(this.grad3[xr],gr,_r));let Pr=.5-vr*vr-Ar*Ar;Pr<0?nr=0:(Pr*=Pr,nr=Pr*Pr*this.dot(this.grad3[Cr],vr,Ar));let Fr=.5-yr*yr-wr*wr;return Fr<0?sr=0:(Fr*=Fr,sr=Fr*Fr*this.dot(this.grad3[Ir],yr,wr)),70*(rr+nr+sr)}noise3d(er,tr,rr){let nr,sr,ar,or;const cr=(er+tr+rr)*.3333333333333333,hr=Math.floor(er+cr),fr=Math.floor(tr+cr),ur=Math.floor(rr+cr),pr=1/6,gr=(hr+fr+ur)*pr,_r=hr-gr,mr=fr-gr,dr=ur-gr,vr=er-_r,Ar=tr-mr,yr=rr-dr;let wr,br,Sr,xr,Cr,Ir;vr>=Ar?Ar>=yr?(wr=1,br=0,Sr=0,xr=1,Cr=1,Ir=0):vr>=yr?(wr=1,br=0,Sr=0,xr=1,Cr=0,Ir=1):(wr=0,br=0,Sr=1,xr=1,Cr=0,Ir=1):Ar<yr?(wr=0,br=0,Sr=1,xr=0,Cr=1,Ir=1):vr<yr?(wr=0,br=1,Sr=0,xr=0,Cr=1,Ir=1):(wr=0,br=1,Sr=0,xr=1,Cr=1,Ir=0);const Rr=vr-wr+pr,Pr=Ar-br+pr,Fr=yr-Sr+pr,Nr=vr-xr+2*pr,Ur=Ar-Cr+2*pr,Br=yr-Ir+2*pr,Or=vr-1+3*pr,Dr=Ar-1+3*pr,Wr=yr-1+3*pr,$r=hr&255,Yr=fr&255,Qi=ur&255,rs=this.perm[$r+this.perm[Yr+this.perm[Qi]]]%12,Kr=this.perm[$r+wr+this.perm[Yr+br+this.perm[Qi+Sr]]]%12,Qr=this.perm[$r+xr+this.perm[Yr+Cr+this.perm[Qi+Ir]]]%12,Vr=this.perm[$r+1+this.perm[Yr+1+this.perm[Qi+1]]]%12;let Gr=.6-vr*vr-Ar*Ar-yr*yr;Gr<0?nr=0:(Gr*=Gr,nr=Gr*Gr*this.dot3(this.grad3[rs],vr,Ar,yr));let qr=.6-Rr*Rr-Pr*Pr-Fr*Fr;qr<0?sr=0:(qr*=qr,sr=qr*qr*this.dot3(this.grad3[Kr],Rr,Pr,Fr));let ji=.6-Nr*Nr-Ur*Ur-Br*Br;ji<0?ar=0:(ji*=ji,ar=ji*ji*this.dot3(this.grad3[Qr],Nr,Ur,Br));let Zr=.6-Or*Or-Dr*Dr-Wr*Wr;return Zr<0?or=0:(Zr*=Zr,or=Zr*Zr*this.dot3(this.grad3[Vr],Or,Dr,Wr)),32*(nr+sr+ar+or)}noise4d(er,tr,rr,nr){const sr=this.grad4,ar=this.simplex,or=this.perm,lr=(Math.sqrt(5)-1)/4,cr=(5-Math.sqrt(5))/20;let hr,fr,ur,pr,gr;const _r=(er+tr+rr+nr)*lr,mr=Math.floor(er+_r),dr=Math.floor(tr+_r),vr=Math.floor(rr+_r),Ar=Math.floor(nr+_r),yr=(mr+dr+vr+Ar)*cr,wr=mr-yr,br=dr-yr,Sr=vr-yr,xr=Ar-yr,Cr=er-wr,Ir=tr-br,Rr=rr-Sr,Pr=nr-xr,Fr=Cr>Ir?32:0,Nr=Cr>Rr?16:0,Ur=Ir>Rr?8:0,Br=Cr>Pr?4:0,Or=Ir>Pr?2:0,Dr=Rr>Pr?1:0,Wr=Fr+Nr+Ur+Br+Or+Dr,$r=ar[Wr][0]>=3?1:0,Yr=ar[Wr][1]>=3?1:0,Qi=ar[Wr][2]>=3?1:0,rs=ar[Wr][3]>=3?1:0,Kr=ar[Wr][0]>=2?1:0,Qr=ar[Wr][1]>=2?1:0,Vr=ar[Wr][2]>=2?1:0,Gr=ar[Wr][3]>=2?1:0,qr=ar[Wr][0]>=1?1:0,ji=ar[Wr][1]>=1?1:0,Zr=ar[Wr][2]>=1?1:0,Zi=ar[Wr][3]>=1?1:0,Yi=Cr-$r+cr,qi=Ir-Yr+cr,Xr=Rr-Qi+cr,ns=Pr-rs+cr,os=Cr-Kr+2*cr,us=Ir-Qr+2*cr,is=Rr-Vr+2*cr,Ji=Pr-Gr+2*cr,ms=Cr-qr+3*cr,Ki=Ir-ji+3*cr,Ni=Rr-Zr+3*cr,Ri=Pr-Zi+3*cr,Jr=Cr-1+4*cr,Xi=Ir-1+4*cr,ss=Rr-1+4*cr,ls=Pr-1+4*cr,gs=mr&255,_s=dr&255,vs=vr&255,As=Ar&255,Ss=or[gs+or[_s+or[vs+or[As]]]]%32,Is=or[gs+$r+or[_s+Yr+or[vs+Qi+or[As+rs]]]]%32,Fs=or[gs+Kr+or[_s+Qr+or[vs+Vr+or[As+Gr]]]]%32,Ns=or[gs+qr+or[_s+ji+or[vs+Zr+or[As+Zi]]]]%32,Ws=or[gs+1+or[_s+1+or[vs+1+or[As+1]]]]%32;let ks=.6-Cr*Cr-Ir*Ir-Rr*Rr-Pr*Pr;ks<0?hr=0:(ks*=ks,hr=ks*ks*this.dot4(sr[Ss],Cr,Ir,Rr,Pr));let Vs=.6-Yi*Yi-qi*qi-Xr*Xr-ns*ns;Vs<0?fr=0:(Vs*=Vs,fr=Vs*Vs*this.dot4(sr[Is],Yi,qi,Xr,ns));let bs=.6-os*os-us*us-is*is-Ji*Ji;bs<0?ur=0:(bs*=bs,ur=bs*bs*this.dot4(sr[Fs],os,us,is,Ji));let Ms=.6-ms*ms-Ki*Ki-Ni*Ni-Ri*Ri;Ms<0?pr=0:(Ms*=Ms,pr=Ms*Ms*this.dot4(sr[Ns],ms,Ki,Ni,Ri));let Cs=.6-Jr*Jr-Xi*Xi-ss*ss-ls*ls;return Cs<0?gr=0:(Cs*=Cs,gr=Cs*Cs*this.dot4(sr[Ws],Jr,Xi,ss,ls)),27*(hr+fr+ur+pr+gr)}}const _v1=new Vector3$1;class ConvexObjectBreaker{constructor(er=1.4,tr=1e-4){this.minSizeForBreak=er,this.smallDelta=tr,this.tempLine1=new Line3,this.tempPlane1=new Plane,this.tempPlane2=new Plane,this.tempPlane_Cut=new Plane,this.tempCM1=new Vector3$1,this.tempCM2=new Vector3$1,this.tempVector3=new Vector3$1,this.tempVector3_2=new Vector3$1,this.tempVector3_3=new Vector3$1,this.tempVector3_P0=new Vector3$1,this.tempVector3_P1=new Vector3$1,this.tempVector3_P2=new Vector3$1,this.tempVector3_N0=new Vector3$1,this.tempVector3_N1=new Vector3$1,this.tempVector3_AB=new Vector3$1,this.tempVector3_CB=new Vector3$1,this.tempResultObjects={object1:null,object2:null},this.segments=[];const rr=30*30;for(let nr=0;nr<rr;nr++)this.segments[nr]=!1}prepareBreakableObject(er,tr,rr,nr,sr){const ar=er.userData;ar.mass=tr,ar.velocity=rr.clone(),ar.angularVelocity=nr.clone(),ar.breakable=sr}subdivideByImpact(er,tr,rr,nr,sr){const ar=[],or=this.tempPlane1,lr=this.tempPlane2;this.tempVector3.addVectors(tr,rr),or.setFromCoplanarPoints(tr,er.position,this.tempVector3);const cr=sr+nr,hr=this;function fr(ur,pr,gr,_r){if(Math.random()<_r*.05||_r>cr){ar.push(ur);return}let mr=Math.PI;_r===0?(lr.normal.copy(or.normal),lr.constant=or.constant):_r<=nr?(mr=(gr-pr)*(.2+.6*Math.random())+pr,hr.tempVector3_2.copy(er.position).sub(tr).applyAxisAngle(rr,mr).add(tr),lr.setFromCoplanarPoints(tr,hr.tempVector3,hr.tempVector3_2)):(mr=(.5*(_r&1)+.2*(2-Math.random()))*Math.PI,hr.tempVector3_2.copy(tr).sub(ur.position).applyAxisAngle(rr,mr).add(ur.position),hr.tempVector3_3.copy(rr).add(ur.position),lr.setFromCoplanarPoints(ur.position,hr.tempVector3_3,hr.tempVector3_2)),hr.cutByPlane(ur,lr,hr.tempResultObjects);const dr=hr.tempResultObjects.object1,vr=hr.tempResultObjects.object2;dr&&fr(dr,pr,mr,_r+1),vr&&fr(vr,mr,gr,_r+1)}return fr(er,0,2*Math.PI,0),ar}cutByPlane(er,tr,rr){const nr=er.geometry,sr=nr.attributes.position.array,ar=nr.attributes.normal.array,or=sr.length/3;let lr=or/3,cr=nr.getIndex();cr&&(cr=cr.array,lr=cr.length/3);function hr(Pr,Fr){const Nr=Pr*3+Fr;return cr?cr[Nr]:Nr}const fr=[],ur=[],pr=this.smallDelta,gr=or*or;for(let Pr=0;Pr<gr;Pr++)this.segments[Pr]=!1;const _r=this.tempVector3_P0,mr=this.tempVector3_P1,dr=this.tempVector3_N0,vr=this.tempVector3_N1;for(let Pr=0;Pr<lr-1;Pr++){const Fr=hr(Pr,0),Nr=hr(Pr,1),Ur=hr(Pr,2);dr.set(ar[Fr],ar[Fr]+1,ar[Fr]+2);for(let Br=Pr+1;Br<lr;Br++){const Or=hr(Br,0),Dr=hr(Br,1),Wr=hr(Br,2);vr.set(ar[Or],ar[Or]+1,ar[Or]+2),1-dr.dot(vr)<pr&&(Fr===Or||Fr===Dr||Fr===Wr?Nr===Or||Nr===Dr||Nr===Wr?(this.segments[Fr*or+Nr]=!0,this.segments[Nr*or+Fr]=!0):(this.segments[Ur*or+Fr]=!0,this.segments[Fr*or+Ur]=!0):(Nr===Or||Nr===Dr||Nr===Wr)&&(this.segments[Ur*or+Nr]=!0,this.segments[Nr*or+Ur]=!0))}}const Ar=this.tempPlane_Cut;er.updateMatrix(),ConvexObjectBreaker.transformPlaneToLocalSpace(tr,er.matrix,Ar);for(let Pr=0;Pr<lr;Pr++){const Fr=hr(Pr,0),Nr=hr(Pr,1),Ur=hr(Pr,2);for(let Br=0;Br<3;Br++){const Or=Br===0?Fr:Br===1?Nr:Ur,Dr=Br===0?Nr:Br===1?Ur:Fr;if(this.segments[Or*or+Dr])continue;this.segments[Or*or+Dr]=!0,this.segments[Dr*or+Or]=!0,_r.set(sr[3*Or],sr[3*Or+1],sr[3*Or+2]),mr.set(sr[3*Dr],sr[3*Dr+1],sr[3*Dr+2]);let $r=0,Yr=Ar.distanceToPoint(_r);Yr>pr?($r=2,ur.push(_r.clone())):Yr<-pr?($r=1,fr.push(_r.clone())):($r=3,fr.push(_r.clone()),ur.push(_r.clone()));let Qi=0;if(Yr=Ar.distanceToPoint(mr),Yr>pr?(Qi=2,ur.push(mr.clone())):Yr<-pr?(Qi=1,fr.push(mr.clone())):(Qi=3,fr.push(mr.clone()),ur.push(mr.clone())),$r===1&&Qi===2||$r===2&&Qi===1){this.tempLine1.start.copy(_r),this.tempLine1.end.copy(mr);let rs=new Vector3$1;if(rs=Ar.intersectLine(this.tempLine1,rs),rs===null)return console.error("Internal error: segment does not intersect plane."),rr.segmentedObject1=null,rr.segmentedObject2=null,0;fr.push(rs),ur.push(rs.clone())}}}const yr=er.userData.mass*.5;this.tempCM1.set(0,0,0);let wr=0;const br=fr.length;if(br>0){for(let Pr=0;Pr<br;Pr++)this.tempCM1.add(fr[Pr]);this.tempCM1.divideScalar(br);for(let Pr=0;Pr<br;Pr++){const Fr=fr[Pr];Fr.sub(this.tempCM1),wr=Math.max(wr,Fr.x,Fr.y,Fr.z)}this.tempCM1.add(er.position)}this.tempCM2.set(0,0,0);let Sr=0;const xr=ur.length;if(xr>0){for(let Pr=0;Pr<xr;Pr++)this.tempCM2.add(ur[Pr]);this.tempCM2.divideScalar(xr);for(let Pr=0;Pr<xr;Pr++){const Fr=ur[Pr];Fr.sub(this.tempCM2),Sr=Math.max(Sr,Fr.x,Fr.y,Fr.z)}this.tempCM2.add(er.position)}let Cr=null,Ir=null,Rr=0;return br>4&&(Cr=new Mesh(new ConvexGeometry(fr),er.material),Cr.position.copy(this.tempCM1),Cr.quaternion.copy(er.quaternion),this.prepareBreakableObject(Cr,yr,er.userData.velocity,er.userData.angularVelocity,2*wr>this.minSizeForBreak),Rr++),xr>4&&(Ir=new Mesh(new ConvexGeometry(ur),er.material),Ir.position.copy(this.tempCM2),Ir.quaternion.copy(er.quaternion),this.prepareBreakableObject(Ir,yr,er.userData.velocity,er.userData.angularVelocity,2*Sr>this.minSizeForBreak),Rr++),rr.object1=Cr,rr.object2=Ir,Rr}static transformFreeVector(er,tr){const rr=er.x,nr=er.y,sr=er.z,ar=tr.elements;return er.x=ar[0]*rr+ar[4]*nr+ar[8]*sr,er.y=ar[1]*rr+ar[5]*nr+ar[9]*sr,er.z=ar[2]*rr+ar[6]*nr+ar[10]*sr,er}static transformFreeVectorInverse(er,tr){const rr=er.x,nr=er.y,sr=er.z,ar=tr.elements;return er.x=ar[0]*rr+ar[1]*nr+ar[2]*sr,er.y=ar[4]*rr+ar[5]*nr+ar[6]*sr,er.z=ar[8]*rr+ar[9]*nr+ar[10]*sr,er}static transformTiedVectorInverse(er,tr){const rr=er.x,nr=er.y,sr=er.z,ar=tr.elements;return er.x=ar[0]*rr+ar[1]*nr+ar[2]*sr-ar[12],er.y=ar[4]*rr+ar[5]*nr+ar[6]*sr-ar[13],er.z=ar[8]*rr+ar[9]*nr+ar[10]*sr-ar[14],er}static transformPlaneToLocalSpace(er,tr,rr){rr.normal.copy(er.normal),rr.constant=er.constant;const nr=ConvexObjectBreaker.transformTiedVectorInverse(er.coplanarPoint(_v1),tr);ConvexObjectBreaker.transformFreeVectorInverse(rr.normal,tr),rr.constant=-nr.dot(rr.normal)}}class GPUComputationRenderer{constructor(er,tr,rr){this.variables=[],this.currentTextureIndex=0;let nr=FloatType;const sr={passThruTexture:{value:null}},ar=cr(fr(),sr),or=new FullScreenQuad(ar);this.setDataType=function(ur){return nr=ur,this},this.addVariable=function(ur,pr,gr){const _r=this.createShaderMaterial(pr),mr={name:ur,initialValueTexture:gr,material:_r,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:NearestFilter,magFilter:NearestFilter};return this.variables.push(mr),mr},this.setVariableDependencies=function(ur,pr){ur.dependencies=pr},this.init=function(){if(rr.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let ur=0;ur<this.variables.length;ur++){const pr=this.variables[ur];pr.renderTargets[0]=this.createRenderTarget(er,tr,pr.wrapS,pr.wrapT,pr.minFilter,pr.magFilter),pr.renderTargets[1]=this.createRenderTarget(er,tr,pr.wrapS,pr.wrapT,pr.minFilter,pr.magFilter),this.renderTexture(pr.initialValueTexture,pr.renderTargets[0]),this.renderTexture(pr.initialValueTexture,pr.renderTargets[1]);const gr=pr.material,_r=gr.uniforms;if(pr.dependencies!==null)for(let mr=0;mr<pr.dependencies.length;mr++){const dr=pr.dependencies[mr];if(dr.name!==pr.name){let vr=!1;for(let Ar=0;Ar<this.variables.length;Ar++)if(dr.name===this.variables[Ar].name){vr=!0;break}if(!vr)return"Variable dependency not found. Variable="+pr.name+", dependency="+dr.name}_r[dr.name]={value:null},gr.fragmentShader=`
uniform sampler2D `+dr.name+`;
`+gr.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){const ur=this.currentTextureIndex,pr=this.currentTextureIndex===0?1:0;for(let gr=0,_r=this.variables.length;gr<_r;gr++){const mr=this.variables[gr];if(mr.dependencies!==null){const dr=mr.material.uniforms;for(let vr=0,Ar=mr.dependencies.length;vr<Ar;vr++){const yr=mr.dependencies[vr];dr[yr.name].value=yr.renderTargets[ur].texture}}this.doRenderTarget(mr.material,mr.renderTargets[pr])}this.currentTextureIndex=pr},this.getCurrentRenderTarget=function(ur){return ur.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(ur){return ur.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){or.dispose();const ur=this.variables;for(let pr=0;pr<ur.length;pr++){const gr=ur[pr];gr.initialValueTexture&&gr.initialValueTexture.dispose();const _r=gr.renderTargets;for(let mr=0;mr<_r.length;mr++)_r[mr].dispose()}};function lr(ur){ur.defines.resolution="vec2( "+er.toFixed(1)+", "+tr.toFixed(1)+" )"}this.addResolutionDefine=lr;function cr(ur,pr){pr=pr||{};const gr=new ShaderMaterial({name:"GPUComputationShader",uniforms:pr,vertexShader:hr(),fragmentShader:ur});return lr(gr),gr}this.createShaderMaterial=cr,this.createRenderTarget=function(ur,pr,gr,_r,mr,dr){return ur=ur||er,pr=pr||tr,gr=gr||ClampToEdgeWrapping,_r=_r||ClampToEdgeWrapping,mr=mr||NearestFilter,dr=dr||NearestFilter,new WebGLRenderTarget(ur,pr,{wrapS:gr,wrapT:_r,minFilter:mr,magFilter:dr,format:RGBAFormat,type:nr,depthBuffer:!1})},this.createTexture=function(){const ur=new Float32Array(er*tr*4),pr=new DataTexture(ur,er,tr,RGBAFormat,FloatType);return pr.needsUpdate=!0,pr},this.renderTexture=function(ur,pr){sr.passThruTexture.value=ur,this.doRenderTarget(ar,pr),sr.passThruTexture.value=null},this.doRenderTarget=function(ur,pr){const gr=rr.getRenderTarget(),_r=rr.xr.enabled,mr=rr.shadowMap.autoUpdate;rr.xr.enabled=!1,rr.shadowMap.autoUpdate=!1,or.material=ur,rr.setRenderTarget(pr),or.render(rr),or.material=ar,rr.xr.enabled=_r,rr.shadowMap.autoUpdate=mr,rr.setRenderTarget(gr)};function hr(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function fr(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}}const _translationObject=new Vector3$1,_quaternionObject=new Quaternion$1,_scaleObject=new Vector3$1,_translationWorld=new Vector3$1,_quaternionWorld=new Quaternion$1,_scaleWorld=new Vector3$1;class Gyroscope extends Object3D{constructor(){super()}updateMatrixWorld(er){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||er)&&(this.parent!==null?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(_translationWorld,_quaternionWorld,_scaleWorld),this.matrix.decompose(_translationObject,_quaternionObject,_scaleObject),this.matrixWorld.compose(_translationWorld,_quaternionObject,_scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,er=!0);for(let tr=0,rr=this.children.length;tr<rr;tr++)this.children[tr].updateMatrixWorld(er)}}class MD2Character{constructor(){this.scale=1,this.animationFPS=6,this.root=new Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0}loadParts(er){const tr=this;function rr(cr,hr){const fr=new MeshLambertMaterial({color:16755200,wireframe:!0}),ur=new MeshLambertMaterial({color:16777215,wireframe:!1,map:hr}),pr=new Mesh(cr,ur);return pr.rotation.y=-Math.PI/2,pr.castShadow=!0,pr.receiveShadow=!0,pr.materialTexture=ur,pr.materialWireframe=fr,pr}function nr(cr,hr){const fr=new TextureLoader,ur=[];for(let pr=0;pr<hr.length;pr++)ur[pr]=fr.load(cr+hr[pr],sr),ur[pr].mapping=UVMapping,ur[pr].name=hr[pr],ur[pr].colorSpace=SRGBColorSpace;return ur}function sr(){tr.loadCounter-=1,tr.loadCounter===0&&tr.onLoadComplete()}this.loadCounter=er.weapons.length*2+er.skins.length+1;const ar=[];for(let cr=0;cr<er.weapons.length;cr++)ar[cr]=er.weapons[cr][1];this.skinsBody=nr(er.baseUrl+"skins/",er.skins),this.skinsWeapon=nr(er.baseUrl+"skins/",ar);const or=new MD2Loader;or.load(er.baseUrl+er.body,function(cr){const hr=new Box3;hr.setFromBufferAttribute(cr.attributes.position),tr.root.position.y=-tr.scale*hr.min.y;const fr=rr(cr,tr.skinsBody[0]);fr.scale.set(tr.scale,tr.scale,tr.scale),tr.root.add(fr),tr.meshBody=fr,tr.meshBody.clipOffset=0,tr.activeAnimationClipName=fr.geometry.animations[0].name,tr.mixer=new AnimationMixer(fr),sr()});const lr=function(cr,hr){return function(fr){const ur=rr(fr,tr.skinsWeapon[cr]);ur.scale.set(tr.scale,tr.scale,tr.scale),ur.visible=!1,ur.name=hr,tr.root.add(ur),tr.weapons[cr]=ur,tr.meshWeapon=ur,sr()}};for(let cr=0;cr<er.weapons.length;cr++)or.load(er.baseUrl+er.weapons[cr][0],lr(cr,er.weapons[cr][0]))}setPlaybackRate(er){er!==0?this.mixer.timeScale=1/er:this.mixer.timeScale=0}setWireframe(er){er?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))}setSkin(er){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[er])}setWeapon(er){for(let rr=0;rr<this.weapons.length;rr++)this.weapons[rr].visible=!1;const tr=this.weapons[er];tr&&(tr.visible=!0,this.meshWeapon=tr,this.syncWeaponAnimation())}setAnimation(er){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);const tr=this.mixer.clipAction(er,this.meshBody);tr&&(this.meshBody.activeAction=tr.play())}this.activeClipName=er,this.syncWeaponAnimation()}syncWeaponAnimation(){const er=this.activeClipName;if(this.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);const tr=this.mixer.clipAction(er,this.meshWeapon);tr&&(this.meshWeapon.activeAction=tr.syncWith(this.meshBody.activeAction).play())}}update(er){this.mixer&&this.mixer.update(er)}}class MorphBlendMesh extends Mesh{constructor(er,tr){super(er,tr),this.animationsMap={},this.animationsList=[];const rr=Object.keys(this.morphTargetDictionary).length,nr="__default",sr=0,ar=rr-1,or=rr/1;this.createAnimation(nr,sr,ar,or),this.setAnimationWeight(nr,1)}createAnimation(er,tr,rr,nr){const sr={start:tr,end:rr,length:rr-tr+1,fps:nr,duration:(rr-tr)/nr,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[er]=sr,this.animationsList.push(sr)}autoCreateAnimations(er){const tr=/([a-z]+)_?(\d+)/i;let rr;const nr={};let sr=0;for(const ar in this.morphTargetDictionary){const or=ar.match(tr);if(or&&or.length>1){const lr=or[1];nr[lr]||(nr[lr]={start:1/0,end:-1/0});const cr=nr[lr];sr<cr.start&&(cr.start=sr),sr>cr.end&&(cr.end=sr),rr||(rr=lr)}sr++}for(const ar in nr){const or=nr[ar];this.createAnimation(ar,or.start,or.end,er)}this.firstAnimation=rr}setAnimationDirectionForward(er){const tr=this.animationsMap[er];tr&&(tr.direction=1,tr.directionBackwards=!1)}setAnimationDirectionBackward(er){const tr=this.animationsMap[er];tr&&(tr.direction=-1,tr.directionBackwards=!0)}setAnimationFPS(er,tr){const rr=this.animationsMap[er];rr&&(rr.fps=tr,rr.duration=(rr.end-rr.start)/rr.fps)}setAnimationDuration(er,tr){const rr=this.animationsMap[er];rr&&(rr.duration=tr,rr.fps=(rr.end-rr.start)/rr.duration)}setAnimationWeight(er,tr){const rr=this.animationsMap[er];rr&&(rr.weight=tr)}setAnimationTime(er,tr){const rr=this.animationsMap[er];rr&&(rr.time=tr)}getAnimationTime(er){let tr=0;const rr=this.animationsMap[er];return rr&&(tr=rr.time),tr}getAnimationDuration(er){let tr=-1;const rr=this.animationsMap[er];return rr&&(tr=rr.duration),tr}playAnimation(er){const tr=this.animationsMap[er];tr?(tr.time=0,tr.active=!0):console.warn("THREE.MorphBlendMesh: animation["+er+"] undefined in .playAnimation()")}stopAnimation(er){const tr=this.animationsMap[er];tr&&(tr.active=!1)}update(er){for(let tr=0,rr=this.animationsList.length;tr<rr;tr++){const nr=this.animationsList[tr];if(!nr.active)continue;const sr=nr.duration/nr.length;nr.time+=nr.direction*er,nr.mirroredLoop?(nr.time>nr.duration||nr.time<0)&&(nr.direction*=-1,nr.time>nr.duration&&(nr.time=nr.duration,nr.directionBackwards=!0),nr.time<0&&(nr.time=0,nr.directionBackwards=!1)):(nr.time=nr.time%nr.duration,nr.time<0&&(nr.time+=nr.duration));const ar=nr.start+MathUtils.clamp(Math.floor(nr.time/sr),0,nr.length-1),or=nr.weight;ar!==nr.currentFrame&&(this.morphTargetInfluences[nr.lastFrame]=0,this.morphTargetInfluences[nr.currentFrame]=1*or,this.morphTargetInfluences[ar]=0,nr.lastFrame=nr.currentFrame,nr.currentFrame=ar);let lr=nr.time%sr/sr;nr.directionBackwards&&(lr=1-lr),nr.currentFrame!==nr.lastFrame?(this.morphTargetInfluences[nr.currentFrame]=lr*or,this.morphTargetInfluences[nr.lastFrame]=(1-lr)*or):this.morphTargetInfluences[nr.currentFrame]=or}}}class MD2CharacterComplex{constructor(){this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new Object3D,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=this.maxSpeed*.5,this.activeAnimation=null,this.oldAnimation=null}enableShadows(er){for(let tr=0;tr<this.meshes.length;tr++)this.meshes[tr].castShadow=er,this.meshes[tr].receiveShadow=er}setVisible(er){for(let tr=0;tr<this.meshes.length;tr++)this.meshes[tr].visible=er,this.meshes[tr].visible=er}shareParts(er){this.animations=er.animations,this.walkSpeed=er.walkSpeed,this.crouchSpeed=er.crouchSpeed,this.skinsBody=er.skinsBody,this.skinsWeapon=er.skinsWeapon;const tr=this._createPart(er.meshBody.geometry,this.skinsBody[0]);tr.scale.set(this.scale,this.scale,this.scale),this.root.position.y=er.root.position.y,this.root.add(tr),this.meshBody=tr,this.meshes.push(tr);for(let rr=0;rr<er.weapons.length;rr++){const nr=this._createPart(er.weapons[rr].geometry,this.skinsWeapon[rr]);nr.scale.set(this.scale,this.scale,this.scale),nr.visible=!1,nr.name=er.weapons[rr].name,this.root.add(nr),this.weapons[rr]=nr,this.meshWeapon=nr,this.meshes.push(nr)}}loadParts(er){const tr=this;function rr(lr,cr){const hr=new TextureLoader,fr=[];for(let ur=0;ur<cr.length;ur++)fr[ur]=hr.load(lr+cr[ur],nr),fr[ur].mapping=UVMapping,fr[ur].name=cr[ur],fr[ur].colorSpace=SRGBColorSpace;return fr}function nr(){tr.loadCounter-=1,tr.loadCounter===0&&tr.onLoadComplete()}this.animations=er.animations,this.walkSpeed=er.walkSpeed,this.crouchSpeed=er.crouchSpeed,this.loadCounter=er.weapons.length*2+er.skins.length+1;const sr=[];for(let lr=0;lr<er.weapons.length;lr++)sr[lr]=er.weapons[lr][1];this.skinsBody=rr(er.baseUrl+"skins/",er.skins),this.skinsWeapon=rr(er.baseUrl+"skins/",sr);const ar=new MD2Loader;ar.load(er.baseUrl+er.body,function(lr){const cr=new Box3;cr.setFromBufferAttribute(lr.attributes.position),tr.root.position.y=-tr.scale*cr.min.y;const hr=tr._createPart(lr,tr.skinsBody[0]);hr.scale.set(tr.scale,tr.scale,tr.scale),tr.root.add(hr),tr.meshBody=hr,tr.meshes.push(hr),nr()});const or=function(lr,cr){return function(hr){const fr=tr._createPart(hr,tr.skinsWeapon[lr]);fr.scale.set(tr.scale,tr.scale,tr.scale),fr.visible=!1,fr.name=cr,tr.root.add(fr),tr.weapons[lr]=fr,tr.meshWeapon=fr,tr.meshes.push(fr),nr()}};for(let lr=0;lr<er.weapons.length;lr++)ar.load(er.baseUrl+er.weapons[lr][0],or(lr,er.weapons[lr][0]))}setPlaybackRate(er){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/er),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/er)}setWireframe(er){er?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))}setSkin(er){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[er],this.currentSkin=er)}setWeapon(er){for(let rr=0;rr<this.weapons.length;rr++)this.weapons[rr].visible=!1;const tr=this.weapons[er];tr&&(tr.visible=!0,this.meshWeapon=tr,this.activeAnimation&&(tr.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))}setAnimation(er){er===this.activeAnimation||!er||(this.meshBody&&(this.meshBody.setAnimationWeight(er,0),this.meshBody.playAnimation(er),this.oldAnimation=this.activeAnimation,this.activeAnimation=er,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(er,0),this.meshWeapon.playAnimation(er)))}update(er){this.controls&&this.updateMovementModel(er),this.animations&&(this.updateBehaviors(),this.updateAnimations(er))}updateAnimations(er){let tr=1;this.blendCounter>0&&(tr=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(er),this.meshBody.setAnimationWeight(this.activeAnimation,tr),this.meshBody.setAnimationWeight(this.oldAnimation,1-tr)),this.meshWeapon&&(this.meshWeapon.update(er),this.meshWeapon.setAnimationWeight(this.activeAnimation,tr),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-tr))}updateBehaviors(){const er=this.controls,tr=this.animations;let rr,nr;er.crouch?(rr=tr.crouchMove,nr=tr.crouchIdle):(rr=tr.move,nr=tr.idle),er.jump&&(rr=tr.jump,nr=tr.jump),er.attack&&(er.crouch?(rr=tr.crouchAttack,nr=tr.crouchAttack):(rr=tr.attack,nr=tr.attack)),(er.moveForward||er.moveBackward||er.moveLeft||er.moveRight)&&this.activeAnimation!==rr&&this.setAnimation(rr),Math.abs(this.speed)<.2*this.maxSpeed&&!(er.moveLeft||er.moveRight||er.moveForward||er.moveBackward)&&this.activeAnimation!==nr&&this.setAnimation(nr),er.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),er.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))}updateMovementModel(er){function tr(ar){return ar===1?1:-Math.pow(2,-10*ar)+1}const rr=this.controls;rr.crouch?this.maxSpeed=this.crouchSpeed:this.maxSpeed=this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,rr.moveForward&&(this.speed=MathUtils.clamp(this.speed+er*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),rr.moveBackward&&(this.speed=MathUtils.clamp(this.speed-er*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));const nr=1;if(rr.moveLeft&&(this.bodyOrientation+=er*this.angularSpeed,this.speed=MathUtils.clamp(this.speed+nr*er*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),rr.moveRight&&(this.bodyOrientation-=er*this.angularSpeed,this.speed=MathUtils.clamp(this.speed+nr*er*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!(rr.moveForward||rr.moveBackward))if(this.speed>0){const ar=tr(this.speed/this.maxSpeed);this.speed=MathUtils.clamp(this.speed-ar*er*this.frontDecceleration,0,this.maxSpeed)}else{const ar=tr(this.speed/this.maxReverseSpeed);this.speed=MathUtils.clamp(this.speed+ar*er*this.backAcceleration,this.maxReverseSpeed,0)}const sr=this.speed*er;this.root.position.x+=Math.sin(this.bodyOrientation)*sr,this.root.position.z+=Math.cos(this.bodyOrientation)*sr,this.root.rotation.y=this.bodyOrientation}_createPart(er,tr){const rr=new MeshLambertMaterial({color:16755200,wireframe:!0}),nr=new MeshLambertMaterial({color:16777215,wireframe:!1,map:tr}),sr=new MorphBlendMesh(er,nr);return sr.rotation.y=-Math.PI/2,sr.materialTexture=nr,sr.materialWireframe=rr,sr.autoCreateAnimations(this.animationFPS),sr}}class MorphAnimMesh extends Mesh{constructor(er,tr){super(er,tr),this.type="MorphAnimMesh",this.mixer=new AnimationMixer(this),this.activeAction=null}setDirectionForward(){this.mixer.timeScale=1}setDirectionBackward(){this.mixer.timeScale=-1}playAnimation(er,tr){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);const rr=AnimationClip.findByName(this,er);if(rr){const nr=this.mixer.clipAction(rr);nr.timeScale=rr.tracks.length*tr/rr.duration,this.activeAction=nr.play()}else throw new Error("THREE.MorphAnimMesh: animations["+er+"] undefined in .playAnimation()")}updateAnimation(er){this.mixer.update(er)}copy(er,tr){return super.copy(er,tr),this.mixer=new AnimationMixer(this),this}}/**
 * potpack - by [@mourner](https://github.com/mourner)
 * 
 * A tiny JavaScript function for packing 2D rectangles into a near-square container, 
 * which is useful for generating CSS sprites and WebGL textures. Similar to 
 * [shelf-pack](https://github.com/mapbox/shelf-pack), but static (you can't add items 
 * once a layout is generated), and aims for maximal space utilization.
 *
 * A variation of algorithms used in [rectpack2D](https://github.com/TeamHypersomnia/rectpack2D)
 * and [bin-pack](https://github.com/bryanburgers/bin-pack), which are in turn based 
 * on [this article by Blackpawn](http://blackpawn.com/texts/lightmaps/default.html).
 * 
 * @license
 * ISC License
 * 
 * Copyright (c) 2018, Mapbox
 * 
 * Permission to use, copy, modify, and/or distribute this software for any purpose
 * with or without fee is hereby granted, provided that the above copyright notice
 * and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
 * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
 * FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
 * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
 * OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
 * TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
 * THIS SOFTWARE.
 */function potpack(ir){let er=0,tr=0;for(const or of ir)er+=or.w*or.h,tr=Math.max(tr,or.w);ir.sort((or,lr)=>lr.h-or.h);const nr=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(er/.95)),tr),h:1/0}];let sr=0,ar=0;for(const or of ir)for(let lr=nr.length-1;lr>=0;lr--){const cr=nr[lr];if(!(or.w>cr.w||or.h>cr.h)){if(or.x=cr.x,or.y=cr.y,ar=Math.max(ar,or.y+or.h),sr=Math.max(sr,or.x+or.w),or.w===cr.w&&or.h===cr.h){const hr=nr.pop();lr<nr.length&&(nr[lr]=hr)}else or.h===cr.h?(cr.x+=or.w,cr.w-=or.w):or.w===cr.w?(cr.y+=or.h,cr.h-=or.h):(nr.push({x:cr.x+or.w,y:cr.y,w:cr.w-or.w,h:or.h}),cr.y+=or.h,cr.h-=or.h);break}}return{w:sr,h:ar,fill:er/(sr*ar)||0}}class ProgressiveLightMap{constructor(er,tr=1024){this.renderer=er,this.res=tr,this.lightMapContainers=[],this.scene=new Scene,this.buffer1Active=!1,this.firstUpdate=!0,this.labelMesh=null,this.blurringPlane=null;const rr=/(Android|iPad|iPhone|iPod)/g.test(navigator.userAgent)?HalfFloatType:FloatType;this.progressiveLightMap1=new WebGLRenderTarget(this.res,this.res,{type:rr}),this.progressiveLightMap2=new WebGLRenderTarget(this.res,this.res,{type:rr}),this.progressiveLightMap2.texture.channel=1,this.uvMat=new MeshPhongMaterial,this.uvMat.uniforms={},this.uvMat.onBeforeCompile=nr=>{nr.vertexShader=`attribute vec2 uv1;
#define USE_LIGHTMAP
#define LIGHTMAP_UV uv1
`+nr.vertexShader.slice(0,-1)+"	gl_Position = vec4((LIGHTMAP_UV - 0.5) * 2.0, 1.0, 1.0); }";const sr=nr.fragmentShader.indexOf("void main() {");nr.fragmentShader=`#define USE_LIGHTMAP
`+nr.fragmentShader.slice(0,sr)+`	uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+nr.fragmentShader.slice(sr-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vLightMapUv).rgb;
				gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/averagingWindow);
			}`,nr.uniforms.previousShadowMap={value:this.progressiveLightMap1.texture},nr.uniforms.averagingWindow={value:100},this.uvMat.uniforms=nr.uniforms,this.uvMat.userData.shader=nr}}addObjectsToLightMap(er){this.uv_boxes=[];const tr=3/this.res;for(let nr=0;nr<er.length;nr++){const sr=er[nr];if(sr.isLight){this.scene.attach(sr);continue}if(sr.geometry.hasAttribute("uv")===!1){console.warn("THREE.ProgressiveLightMap: All lightmap objects need uvs.");continue}this.blurringPlane===null&&this._initializeBlurPlane(this.res,this.progressiveLightMap1),sr.material.lightMap=this.progressiveLightMap2.texture,sr.material.dithering=!0,sr.castShadow=!0,sr.receiveShadow=!0,sr.renderOrder=1e3+nr,this.uv_boxes.push({w:1+tr*2,h:1+tr*2,index:nr}),this.lightMapContainers.push({basicMat:sr.material,object:sr})}const rr=potpack(this.uv_boxes);this.uv_boxes.forEach(nr=>{const sr=er[nr.index].geometry.getAttribute("uv").clone();for(let ar=0;ar<sr.array.length;ar+=sr.itemSize)sr.array[ar]=(sr.array[ar]+nr.x+tr)/rr.w,sr.array[ar+1]=(sr.array[ar+1]+nr.y+tr)/rr.h;er[nr.index].geometry.setAttribute("uv1",sr),er[nr.index].geometry.getAttribute("uv1").needsUpdate=!0})}update(er,tr=100,rr=!0){if(this.blurringPlane===null)return;const nr=this.renderer.getRenderTarget();this.blurringPlane.visible=rr;for(let or=0;or<this.lightMapContainers.length;or++)this.lightMapContainers[or].object.oldScene=this.lightMapContainers[or].object.parent,this.scene.attach(this.lightMapContainers[or].object);this.firstUpdate===!0&&(this.renderer.compile(this.scene,er),this.firstUpdate=!1);for(let or=0;or<this.lightMapContainers.length;or++)this.uvMat.uniforms.averagingWindow={value:tr},this.lightMapContainers[or].object.material=this.uvMat,this.lightMapContainers[or].object.oldFrustumCulled=this.lightMapContainers[or].object.frustumCulled,this.lightMapContainers[or].object.frustumCulled=!1;const sr=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,ar=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1;this.renderer.setRenderTarget(sr),this.uvMat.uniforms.previousShadowMap={value:ar.texture},this.blurringPlane.material.uniforms.previousShadowMap={value:ar.texture},this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,er);for(let or=0;or<this.lightMapContainers.length;or++)this.lightMapContainers[or].object.frustumCulled=this.lightMapContainers[or].object.oldFrustumCulled,this.lightMapContainers[or].object.material=this.lightMapContainers[or].basicMat,this.lightMapContainers[or].object.oldScene.attach(this.lightMapContainers[or].object);this.renderer.setRenderTarget(nr)}showDebugLightmap(er,tr=void 0){if(this.lightMapContainers.length===0){console.warn("THREE.ProgressiveLightMap: Call .showDebugLightmap() after adding the objects.");return}if(this.labelMesh===null){const rr=new MeshBasicMaterial({map:this.progressiveLightMap1.texture,side:DoubleSide}),nr=new PlaneGeometry(100,100);this.labelMesh=new Mesh(nr,rr),this.labelMesh.position.y=250,this.lightMapContainers[0].object.parent.add(this.labelMesh)}tr!==void 0&&this.labelMesh.position.copy(tr),this.labelMesh.visible=er}_initializeBlurPlane(er,tr=null){const rr=new MeshBasicMaterial;rr.uniforms={previousShadowMap:{value:null},pixelOffset:{value:1/er},polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:3},rr.onBeforeCompile=nr=>{nr.vertexShader=`#define USE_UV
`+nr.vertexShader.slice(0,-1)+"	gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const sr=nr.fragmentShader.indexOf("void main() {");nr.fragmentShader=`#define USE_UV
`+nr.fragmentShader.slice(0,sr)+`	uniform sampler2D previousShadowMap;
	uniform float pixelOffset;
`+nr.fragmentShader.slice(sr-1,-1)+`	gl_FragColor.rgb = (
									texture2D(previousShadowMap, vUv + vec2( pixelOffset,  0.0        )).rgb +
									texture2D(previousShadowMap, vUv + vec2( 0.0        ,  pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2( 0.0        , -pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2(-pixelOffset,  0.0        )).rgb +
									texture2D(previousShadowMap, vUv + vec2( pixelOffset,  pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2(-pixelOffset,  pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2( pixelOffset, -pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2(-pixelOffset, -pixelOffset)).rgb)/8.0;
				}`,nr.uniforms.previousShadowMap={value:tr.texture},nr.uniforms.pixelOffset={value:.5/er},rr.uniforms=nr.uniforms,rr.userData.shader=nr},this.blurringPlane=new Mesh(new PlaneGeometry(1,1),rr),this.blurringPlane.name="Blurring Plane",this.blurringPlane.frustumCulled=!1,this.blurringPlane.renderOrder=0,this.blurringPlane.material.depthWrite=!1,this.scene.add(this.blurringPlane)}dispose(){this.progressiveLightMap1.dispose(),this.progressiveLightMap2.dispose(),this.uvMat.dispose(),this.blurringPlane!==null&&(this.blurringPlane.geometry.dispose(),this.blurringPlane.material.dispose()),this.labelMesh!==null&&(this.labelMesh.geometry.dispose(),this.labelMesh.material.dispose())}}class RollerCoasterGeometry extends BufferGeometry{constructor(er,tr){super();const rr=[],nr=[],sr=[],ar=[1,1,1],or=[1,1,0],lr=new Vector3$1(0,1,0),cr=new Vector3$1,hr=new Vector3$1,fr=new Quaternion$1,ur=new Quaternion$1;ur.setFromAxisAngle(lr,Math.PI/2);const pr=new Vector3$1,gr=new Vector3$1;gr.copy(er.getPointAt(0));const _r=[new Vector3$1(-.225,0,0),new Vector3$1(0,-.05,0),new Vector3$1(0,-.175,0),new Vector3$1(0,-.05,0),new Vector3$1(.225,0,0),new Vector3$1(0,-.175,0)],mr=Math.PI*2;let dr=5;const vr=[];for(let Or=0;Or<dr;Or++){const Dr=Or/dr*mr;vr.push(new Vector3$1(Math.sin(Dr)*.06,Math.cos(Dr)*.06,0))}dr=6;const Ar=[];for(let Or=0;Or<dr;Or++){const Dr=Or/dr*mr;Ar.push(new Vector3$1(Math.sin(Dr)*.025,Math.cos(Dr)*.025,0))}const yr=new Vector3$1,wr=new Vector3$1;function br(Or,Dr){wr.set(0,0,-1).applyQuaternion(fr);for(let Wr=0;Wr<Or.length;Wr++)yr.copy(Or[Wr]),yr.applyQuaternion(fr),yr.add(pr),rr.push(yr.x,yr.y,yr.z),nr.push(wr.x,wr.y,wr.z),sr.push(Dr[0],Dr[1],Dr[2]);wr.set(0,0,1).applyQuaternion(fr);for(let Wr=Or.length-1;Wr>=0;Wr--)yr.copy(Or[Wr]),yr.applyQuaternion(fr),yr.add(pr),rr.push(yr.x,yr.y,yr.z),nr.push(wr.x,wr.y,wr.z),sr.push(Dr[0],Dr[1],Dr[2])}const Sr=new Vector3$1,xr=new Vector3$1,Cr=new Vector3$1,Ir=new Vector3$1,Rr=new Vector3$1,Pr=new Vector3$1,Fr=new Vector3$1,Nr=new Vector3$1;function Ur(Or,Dr,Wr){for(let $r=0,Yr=Or.length;$r<Yr;$r++){const Qi=Or[$r],rs=Or[($r+1)%Yr];Sr.copy(Qi).add(Dr),Sr.applyQuaternion(fr),Sr.add(pr),xr.copy(rs).add(Dr),xr.applyQuaternion(fr),xr.add(pr),Cr.copy(rs).add(Dr),Cr.applyQuaternion(ur),Cr.add(gr),Ir.copy(Qi).add(Dr),Ir.applyQuaternion(ur),Ir.add(gr),rr.push(Sr.x,Sr.y,Sr.z),rr.push(xr.x,xr.y,xr.z),rr.push(Ir.x,Ir.y,Ir.z),rr.push(xr.x,xr.y,xr.z),rr.push(Cr.x,Cr.y,Cr.z),rr.push(Ir.x,Ir.y,Ir.z),Rr.copy(Qi),Rr.applyQuaternion(fr),Rr.normalize(),Pr.copy(rs),Pr.applyQuaternion(fr),Pr.normalize(),Fr.copy(rs),Fr.applyQuaternion(ur),Fr.normalize(),Nr.copy(Qi),Nr.applyQuaternion(ur),Nr.normalize(),nr.push(Rr.x,Rr.y,Rr.z),nr.push(Pr.x,Pr.y,Pr.z),nr.push(Nr.x,Nr.y,Nr.z),nr.push(Pr.x,Pr.y,Pr.z),nr.push(Fr.x,Fr.y,Fr.z),nr.push(Nr.x,Nr.y,Nr.z),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2])}}const Br=new Vector3$1;for(let Or=1;Or<=tr;Or++){pr.copy(er.getPointAt(Or/tr)),lr.set(0,1,0),cr.subVectors(pr,gr).normalize(),hr.crossVectors(lr,cr).normalize(),lr.crossVectors(cr,hr);const Dr=Math.atan2(cr.x,cr.z);fr.setFromAxisAngle(lr,Dr),Or%2===0&&br(_r,or),Ur(vr,Br.set(0,-.125,0),or),Ur(Ar,Br.set(.2,0,0),ar),Ur(Ar,Br.set(-.2,0,0),ar),gr.copy(pr),ur.copy(fr)}this.setAttribute("position",new BufferAttribute(new Float32Array(rr),3)),this.setAttribute("normal",new BufferAttribute(new Float32Array(nr),3)),this.setAttribute("color",new BufferAttribute(new Float32Array(sr),3))}}class RollerCoasterLiftersGeometry extends BufferGeometry{constructor(er,tr){super();const rr=[],nr=[],sr=new Quaternion$1,ar=new Vector3$1(0,1,0),or=new Vector3$1,lr=new Vector3$1,cr=[new Vector3$1(0,.05,-.05),new Vector3$1(0,.05,.05),new Vector3$1(0,-.05,0)],hr=[new Vector3$1(-.05,0,.05),new Vector3$1(-.05,0,-.05),new Vector3$1(.05,0,0)],fr=[new Vector3$1(.05,0,-.05),new Vector3$1(.05,0,.05),new Vector3$1(-.05,0,0)],ur=new Vector3$1,pr=new Vector3$1,gr=new Vector3$1,_r=new Vector3$1,mr=new Vector3$1,dr=new Vector3$1,vr=new Vector3$1,Ar=new Vector3$1;function yr(Sr,xr,Cr){for(let Ir=0,Rr=Sr.length;Ir<Rr;Ir++){const Pr=Sr[Ir],Fr=Sr[(Ir+1)%Rr];ur.copy(Pr),ur.applyQuaternion(sr),ur.add(xr),pr.copy(Fr),pr.applyQuaternion(sr),pr.add(xr),gr.copy(Fr),gr.applyQuaternion(sr),gr.add(Cr),_r.copy(Pr),_r.applyQuaternion(sr),_r.add(Cr),rr.push(ur.x,ur.y,ur.z),rr.push(pr.x,pr.y,pr.z),rr.push(_r.x,_r.y,_r.z),rr.push(pr.x,pr.y,pr.z),rr.push(gr.x,gr.y,gr.z),rr.push(_r.x,_r.y,_r.z),mr.copy(Pr),mr.applyQuaternion(sr),mr.normalize(),dr.copy(Fr),dr.applyQuaternion(sr),dr.normalize(),vr.copy(Fr),vr.applyQuaternion(sr),vr.normalize(),Ar.copy(Pr),Ar.applyQuaternion(sr),Ar.normalize(),nr.push(mr.x,mr.y,mr.z),nr.push(dr.x,dr.y,dr.z),nr.push(Ar.x,Ar.y,Ar.z),nr.push(dr.x,dr.y,dr.z),nr.push(vr.x,vr.y,vr.z),nr.push(Ar.x,Ar.y,Ar.z)}}const wr=new Vector3$1,br=new Vector3$1;for(let Sr=1;Sr<=tr;Sr++){or.copy(er.getPointAt(Sr/tr)),lr.copy(er.getTangentAt(Sr/tr));const xr=Math.atan2(lr.x,lr.z);sr.setFromAxisAngle(ar,xr),or.y>10?(wr.set(-.75,-.35,0),wr.applyQuaternion(sr),wr.add(or),br.set(.75,-.35,0),br.applyQuaternion(sr),br.add(or),yr(cr,wr,br),wr.set(-.7,-.3,0),wr.applyQuaternion(sr),wr.add(or),br.set(-.7,-or.y,0),br.applyQuaternion(sr),br.add(or),yr(hr,wr,br),wr.set(.7,-.3,0),wr.applyQuaternion(sr),wr.add(or),br.set(.7,-or.y,0),br.applyQuaternion(sr),br.add(or),yr(fr,wr,br)):(wr.set(0,-.2,0),wr.applyQuaternion(sr),wr.add(or),br.set(0,-or.y,0),br.applyQuaternion(sr),br.add(or),yr(fr,wr,br))}this.setAttribute("position",new BufferAttribute(new Float32Array(rr),3)),this.setAttribute("normal",new BufferAttribute(new Float32Array(nr),3))}}class RollerCoasterShadowGeometry extends BufferGeometry{constructor(er,tr){super();const rr=[],nr=new Vector3$1(0,1,0),sr=new Vector3$1,ar=new Quaternion$1,or=new Quaternion$1;or.setFromAxisAngle(nr,Math.PI/2);const lr=new Vector3$1,cr=new Vector3$1;cr.copy(er.getPointAt(0)),cr.y=0;const hr=new Vector3$1,fr=new Vector3$1,ur=new Vector3$1,pr=new Vector3$1;for(let gr=1;gr<=tr;gr++){lr.copy(er.getPointAt(gr/tr)),lr.y=0,sr.subVectors(lr,cr);const _r=Math.atan2(sr.x,sr.z);ar.setFromAxisAngle(nr,_r),hr.set(-.3,0,0),hr.applyQuaternion(ar),hr.add(lr),fr.set(.3,0,0),fr.applyQuaternion(ar),fr.add(lr),ur.set(.3,0,0),ur.applyQuaternion(or),ur.add(cr),pr.set(-.3,0,0),pr.applyQuaternion(or),pr.add(cr),rr.push(hr.x,hr.y,hr.z),rr.push(fr.x,fr.y,fr.z),rr.push(pr.x,pr.y,pr.z),rr.push(fr.x,fr.y,fr.z),rr.push(ur.x,ur.y,ur.z),rr.push(pr.x,pr.y,pr.z),cr.copy(lr),or.copy(ar)}this.setAttribute("position",new BufferAttribute(new Float32Array(rr),3))}}class SkyGeometry extends BufferGeometry{constructor(){super();const er=[];for(let tr=0;tr<100;tr++){const rr=Math.random()*800-400,nr=Math.random()*50+50,sr=Math.random()*800-400,ar=Math.random()*40+20;er.push(rr-ar,nr,sr-ar),er.push(rr+ar,nr,sr-ar),er.push(rr-ar,nr,sr+ar),er.push(rr+ar,nr,sr-ar),er.push(rr+ar,nr,sr+ar),er.push(rr-ar,nr,sr+ar)}this.setAttribute("position",new BufferAttribute(new Float32Array(er),3))}}class TreesGeometry extends BufferGeometry{constructor(er){super();const tr=[],rr=[],nr=new Raycaster;nr.ray.direction.set(0,-1,0);const sr=new Color;for(let ar=0;ar<2e3;ar++){const or=Math.random()*500-250,lr=Math.random()*500-250;nr.ray.origin.set(or,50,lr);const cr=nr.intersectObject(er);if(cr.length===0)continue;const hr=cr[0].point.y,fr=Math.random()*5+.5;let ur=Math.random()*Math.PI*2;tr.push(or+Math.sin(ur),hr,lr+Math.cos(ur)),tr.push(or,hr+fr,lr),tr.push(or+Math.sin(ur+Math.PI),hr,lr+Math.cos(ur+Math.PI)),ur+=Math.PI/2,tr.push(or+Math.sin(ur),hr,lr+Math.cos(ur)),tr.push(or,hr+fr,lr),tr.push(or+Math.sin(ur+Math.PI),hr,lr+Math.cos(ur+Math.PI));const pr=Math.random()*.1;for(let gr=0;gr<6;gr++)sr.setRGB(.2+pr,.4+pr,0,SRGBColorSpace),rr.push(sr.r,sr.g,sr.b)}this.setAttribute("position",new BufferAttribute(new Float32Array(tr),3)),this.setAttribute("color",new BufferAttribute(new Float32Array(rr),3))}}class Timer{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=now(),this._delta=0,this._elapsed=0,this._timescale=1,this._usePageVisibilityAPI=typeof document<"u"&&document.hidden!==void 0,this._usePageVisibilityAPI===!0&&(this._pageVisibilityHandler=handleVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(er){return this._timescale=er,this}reset(){return this._currentTime=now()-this._startTime,this}dispose(){return this._usePageVisibilityAPI===!0&&document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this}update(er){return this._usePageVisibilityAPI===!0&&document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(er!==void 0?er:now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}class FixedTimer extends Timer{constructor(er=60){super(),this._delta=1/er*1e3}update(){return this._elapsed+=this._delta*this._timescale,this}}function now(){return performance.now()}function handleVisibilityChange(){document.hidden===!1&&this.reset()}function TubePainter(){const er=new BufferAttribute(new Float32Array(3e6),3);er.usage=DynamicDrawUsage;const tr=new BufferAttribute(new Float32Array(3e6),3);tr.usage=DynamicDrawUsage;const rr=new BufferAttribute(new Float32Array(3e6),3);rr.usage=DynamicDrawUsage;const nr=new BufferGeometry;nr.setAttribute("position",er),nr.setAttribute("normal",tr),nr.setAttribute("color",rr),nr.drawRange.count=0;const sr=new MeshStandardMaterial({vertexColors:!0}),ar=new Mesh(nr,sr);ar.frustumCulled=!1;function or(Cr){const Ir=Math.PI*2,Rr=10,Pr=[],Fr=.01*Cr;for(let Nr=0;Nr<Rr;Nr++){const Ur=Nr/Rr*Ir;Pr.push(new Vector3$1(Math.sin(Ur)*Fr,Math.cos(Ur)*Fr,0))}return Pr}const lr=new Vector3$1,cr=new Vector3$1,hr=new Vector3$1,fr=new Vector3$1,ur=new Color(16777215);let pr=1;function gr(Cr,Ir,Rr,Pr){if(Cr.distanceToSquared(Ir)===0)return;let Fr=nr.drawRange.count;const Nr=or(pr);for(let Ur=0,Br=Nr.length;Ur<Br;Ur++){const Or=Nr[Ur],Dr=Nr[(Ur+1)%Br];lr.copy(Or).applyMatrix4(Pr).add(Ir),cr.copy(Dr).applyMatrix4(Pr).add(Ir),hr.copy(Dr).applyMatrix4(Rr).add(Cr),fr.copy(Or).applyMatrix4(Rr).add(Cr),lr.toArray(er.array,(Fr+0)*3),cr.toArray(er.array,(Fr+1)*3),fr.toArray(er.array,(Fr+2)*3),cr.toArray(er.array,(Fr+3)*3),hr.toArray(er.array,(Fr+4)*3),fr.toArray(er.array,(Fr+5)*3),lr.copy(Or).applyMatrix4(Pr).normalize(),cr.copy(Dr).applyMatrix4(Pr).normalize(),hr.copy(Dr).applyMatrix4(Rr).normalize(),fr.copy(Or).applyMatrix4(Rr).normalize(),lr.toArray(tr.array,(Fr+0)*3),cr.toArray(tr.array,(Fr+1)*3),fr.toArray(tr.array,(Fr+2)*3),cr.toArray(tr.array,(Fr+3)*3),hr.toArray(tr.array,(Fr+4)*3),fr.toArray(tr.array,(Fr+5)*3),ur.toArray(rr.array,(Fr+0)*3),ur.toArray(rr.array,(Fr+1)*3),ur.toArray(rr.array,(Fr+2)*3),ur.toArray(rr.array,(Fr+3)*3),ur.toArray(rr.array,(Fr+4)*3),ur.toArray(rr.array,(Fr+5)*3),Fr+=6}nr.drawRange.count=Fr}const _r=new Vector3$1(0,1,0),mr=new Vector3$1,dr=new Vector3$1,vr=new Matrix4,Ar=new Matrix4;function yr(Cr){mr.copy(Cr),vr.lookAt(dr,mr,_r),dr.copy(Cr),Ar.copy(vr)}function wr(Cr){mr.copy(Cr),vr.lookAt(dr,mr,_r),gr(mr,dr,vr,Ar),dr.copy(mr),Ar.copy(vr)}function br(Cr){pr=Cr}let Sr=0;function xr(){const Cr=Sr,Ir=nr.drawRange.count;Cr!==Ir&&(er.addUpdateRange(Cr*3,(Ir-Cr)*3),er.needsUpdate=!0,tr.addUpdateRange(Cr*3,(Ir-Cr)*3),tr.needsUpdate=!0,rr.addUpdateRange(Cr*3,(Ir-Cr)*3),rr.needsUpdate=!0,Sr=nr.drawRange.count)}return{mesh:ar,moveTo:yr,lineTo:wr,setSize:br,update:xr}}const CHANNELS=4,TEXTURE_WIDTH=1024,TEXTURE_HEIGHT=4;function initSplineTexture(ir=1){const er=new Uint16Array(TEXTURE_WIDTH*TEXTURE_HEIGHT*ir*CHANNELS),tr=new DataTexture(er,TEXTURE_WIDTH,TEXTURE_HEIGHT*ir,RGBAFormat,HalfFloatType);return tr.wrapS=RepeatWrapping,tr.wrapY=RepeatWrapping,tr.magFilter=LinearFilter,tr.minFilter=LinearFilter,tr.needsUpdate=!0,tr}function updateSplineTexture(ir,er,tr=0){const rr=Math.floor(TEXTURE_WIDTH*(TEXTURE_HEIGHT/4));er.arcLengthDivisions=rr/2,er.updateArcLengths();const nr=er.getSpacedPoints(rr),sr=er.computeFrenetFrames(rr,!0);for(let ar=0;ar<rr;ar++){const or=Math.floor(ar/TEXTURE_WIDTH),lr=ar%TEXTURE_WIDTH;let cr=nr[ar];setTextureValue(ir,lr,cr.x,cr.y,cr.z,0+or+TEXTURE_HEIGHT*tr),cr=sr.tangents[ar],setTextureValue(ir,lr,cr.x,cr.y,cr.z,1+or+TEXTURE_HEIGHT*tr),cr=sr.normals[ar],setTextureValue(ir,lr,cr.x,cr.y,cr.z,2+or+TEXTURE_HEIGHT*tr),cr=sr.binormals[ar],setTextureValue(ir,lr,cr.x,cr.y,cr.z,3+or+TEXTURE_HEIGHT*tr)}ir.needsUpdate=!0}function setTextureValue(ir,er,tr,rr,nr,sr){const ar=ir.image,{data:or}=ar,lr=CHANNELS*TEXTURE_WIDTH*sr;or[er*CHANNELS+lr+0]=DataUtils.toHalfFloat(tr),or[er*CHANNELS+lr+1]=DataUtils.toHalfFloat(rr),or[er*CHANNELS+lr+2]=DataUtils.toHalfFloat(nr),or[er*CHANNELS+lr+3]=DataUtils.toHalfFloat(1)}function getUniforms(ir){return{spineTexture:{value:ir},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}}}function modifyShader(ir,er,tr=1){ir.__ok||(ir.__ok=!0,ir.onBeforeCompile=rr=>{if(rr.__modified)return;rr.__modified=!0,Object.assign(rr.uniforms,er);const nr=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${TEXTURE_HEIGHT*tr}.;
		float textureStacks = ${TEXTURE_HEIGHT/4}.;

		${rr.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
void main() {
#include <beginnormal_vertex>

vec4 worldPos = modelMatrix * vec4(position, 1.);

bool bend = flow > 0;
float xWeight = bend ? 0. : 1.;

#ifdef USE_INSTANCING
float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
#else
float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
#endif

mt = mod(mt, textureStacks);
float rowOffset = floor(mt);

#ifdef USE_INSTANCING
rowOffset += instanceMatrix[3][1] * ${TEXTURE_HEIGHT}.;
#endif

vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
mat3 basis = mat3(a, b, c);

vec3 transformed = basis
	* vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
	+ spinePos;

vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);rr.vertexShader=nr})}class Flow{constructor(er,tr=1){const rr=er.clone(),nr=initSplineTexture(tr),sr=getUniforms(nr);rr.traverse(function(ar){if(ar instanceof Mesh||ar instanceof InstancedMesh)if(Array.isArray(ar.material)){const or=[];for(const lr of ar.material){const cr=lr.clone();modifyShader(cr,sr,tr),or.push(cr)}ar.material=or}else ar.material=ar.material.clone(),modifyShader(ar.material,sr,tr)}),this.curveArray=new Array(tr),this.curveLengthArray=new Array(tr),this.object3D=rr,this.splineTexture=nr,this.uniforms=sr}updateCurve(er,tr){if(er>=this.curveArray.length)throw Error("Index out of range for Flow");const rr=tr.getLength();this.uniforms.spineLength.value=rr,this.curveLengthArray[er]=rr,this.curveArray[er]=tr,updateSplineTexture(this.splineTexture,tr,er)}moveAlongCurve(er){this.uniforms.pathOffset.value+=er}}const matrix=new Matrix4;class InstancedFlow extends Flow{constructor(er,tr,rr,nr){const sr=new InstancedMesh(rr,nr,er);sr.instanceMatrix.setUsage(DynamicDrawUsage),sr.frustumCulled=!1,super(sr,tr),this.offsets=new Array(er).fill(0),this.whichCurve=new Array(er).fill(0)}writeChanges(er){matrix.makeTranslation(this.curveLengthArray[this.whichCurve[er]],this.whichCurve[er],this.offsets[er]),this.object3D.setMatrixAt(er,matrix),this.object3D.instanceMatrix.needsUpdate=!0}moveIndividualAlongCurve(er,tr){this.offsets[er]+=tr,this.writeChanges(er)}setCurve(er,tr){if(isNaN(tr))throw Error("curve index being set is Not a Number (NaN)");this.whichCurve[er]=tr,this.writeChanges(er)}}const _A=new Vector3$1,_B=new Vector3$1,_C=new Vector3$1;class EdgeSplitModifier{modify(er,tr,rr=!0){function nr(){ur=new Float32Array(hr.length*3);for(let dr=0;dr<hr.length;dr+=3){let vr=hr[dr];_A.set(fr[3*vr],fr[3*vr+1],fr[3*vr+2]),vr=hr[dr+1],_B.set(fr[3*vr],fr[3*vr+1],fr[3*vr+2]),vr=hr[dr+2],_C.set(fr[3*vr],fr[3*vr+1],fr[3*vr+2]),_C.sub(_B),_A.sub(_B);const Ar=_C.cross(_A).normalize();for(let yr=0;yr<3;yr++)ur[3*(dr+yr)]=Ar.x,ur[3*(dr+yr)+1]=Ar.y,ur[3*(dr+yr)+2]=Ar.z}}function sr(){pr=Array(fr.length/3);for(let dr=0;dr<hr.length;dr++){const vr=hr[dr];pr[vr]==null&&(pr[vr]=[]),pr[vr].push(dr)}}function ar(dr,vr,Ar){_A.set(ur[3*Ar],ur[3*Ar+1],ur[3*Ar+2]).normalize();const yr={splitGroup:[],currentGroup:[Ar]};for(const wr of dr)wr!==Ar&&(_B.set(ur[3*wr],ur[3*wr+1],ur[3*wr+2]).normalize(),_B.dot(_A)<vr?yr.splitGroup.push(wr):yr.currentGroup.push(wr));return yr}function or(dr,vr,Ar=null){if(dr.length===0)return;const yr=[];for(const br of dr)yr.push(ar(dr,vr,br));let wr=yr[0];for(const br of yr)br.currentGroup.length>wr.currentGroup.length&&(wr=br);Ar!=null&&gr.push({original:Ar,indexes:wr.currentGroup}),wr.splitGroup.length&&or(wr.splitGroup,vr,Ar||wr.currentGroup[0])}let lr=!1,cr=null;er.attributes.normal&&(lr=!0,er=er.clone(),rr===!0&&er.index!==null&&(cr=er.attributes.normal.array),er.deleteAttribute("normal")),er.index==null&&(er=mergeVertices(er));const hr=er.index.array,fr=er.getAttribute("position").array;let ur,pr;nr(),sr();const gr=[];for(const dr of pr)or(dr,Math.cos(tr)-.001);const _r={};for(const dr of Object.keys(er.attributes)){const vr=er.attributes[dr],Ar=new vr.array.constructor((hr.length+gr.length)*vr.itemSize);Ar.set(vr.array),_r[dr]=new BufferAttribute(Ar,vr.itemSize,vr.normalized)}const mr=new Uint32Array(hr.length);mr.set(hr);for(let dr=0;dr<gr.length;dr++){const vr=gr[dr],Ar=hr[vr.original];for(const yr of Object.values(_r))for(let wr=0;wr<yr.itemSize;wr++)yr.array[(hr.length+dr)*yr.itemSize+wr]=yr.array[Ar*yr.itemSize+wr];for(const yr of vr.indexes)mr[yr]=hr.length+dr}er=new BufferGeometry,er.setIndex(new BufferAttribute(mr,1));for(const dr of Object.keys(_r))er.setAttribute(dr,_r[dr]);if(lr&&(er.computeVertexNormals(),cr!==null)){const dr=new Array(cr.length/3).fill(!1);for(const vr of gr)dr[vr.original]=!0;for(let vr=0;vr<dr.length;vr++)if(dr[vr]===!1)for(let Ar=0;Ar<3;Ar++)er.attributes.normal.array[3*vr+Ar]=cr[3*vr+Ar]}return er}}const _cb=new Vector3$1,_ab=new Vector3$1;class SimplifyModifier{modify(er,tr){er=er.clone(),delete er.morphAttributes.position,delete er.morphAttributes.normal;const rr=er.attributes;for(const xr in rr)xr!=="position"&&xr!=="uv"&&xr!=="normal"&&xr!=="tangent"&&xr!=="color"&&er.deleteAttribute(xr);er=mergeVertices(er);const nr=[],sr=[],ar=er.getAttribute("position"),or=er.getAttribute("uv"),lr=er.getAttribute("normal"),cr=er.getAttribute("tangent"),hr=er.getAttribute("color");let fr=null,ur=null,pr=null,gr=null;for(let xr=0;xr<ar.count;xr++){const Cr=new Vector3$1().fromBufferAttribute(ar,xr);or&&(ur=new Vector2().fromBufferAttribute(or,xr)),lr&&(pr=new Vector3$1().fromBufferAttribute(lr,xr)),cr&&(fr=new Vector4().fromBufferAttribute(cr,xr)),hr&&(gr=new Color().fromBufferAttribute(hr,xr));const Ir=new Vertex(Cr,ur,pr,fr,gr);nr.push(Ir)}let _r=er.getIndex();if(_r!==null)for(let xr=0;xr<_r.count;xr+=3){const Cr=_r.getX(xr),Ir=_r.getX(xr+1),Rr=_r.getX(xr+2),Pr=new Triangle(nr[Cr],nr[Ir],nr[Rr],Cr,Ir,Rr);sr.push(Pr)}else for(let xr=0;xr<ar.count;xr+=3){const Cr=xr,Ir=xr+1,Rr=xr+2,Pr=new Triangle(nr[Cr],nr[Ir],nr[Rr],Cr,Ir,Rr);sr.push(Pr)}for(let xr=0,Cr=nr.length;xr<Cr;xr++)computeEdgeCostAtVertex(nr[xr]);let mr,dr=tr;for(;dr--;){if(mr=minimumCostEdge(nr),!mr){console.log("THREE.SimplifyModifier: No next vertex");break}collapse(nr,sr,mr,mr.collapseNeighbor)}const vr=new BufferGeometry,Ar=[],yr=[],wr=[],br=[],Sr=[];_r=[];for(let xr=0;xr<nr.length;xr++){const Cr=nr[xr];Ar.push(Cr.position.x,Cr.position.y,Cr.position.z),Cr.uv&&yr.push(Cr.uv.x,Cr.uv.y),Cr.normal&&wr.push(Cr.normal.x,Cr.normal.y,Cr.normal.z),Cr.tangent&&br.push(Cr.tangent.x,Cr.tangent.y,Cr.tangent.z,Cr.tangent.w),Cr.color&&Sr.push(Cr.color.r,Cr.color.g,Cr.color.b),Cr.id=xr}for(let xr=0;xr<sr.length;xr++){const Cr=sr[xr];_r.push(Cr.v1.id,Cr.v2.id,Cr.v3.id)}return vr.setAttribute("position",new Float32BufferAttribute(Ar,3)),yr.length>0&&vr.setAttribute("uv",new Float32BufferAttribute(yr,2)),wr.length>0&&vr.setAttribute("normal",new Float32BufferAttribute(wr,3)),br.length>0&&vr.setAttribute("tangent",new Float32BufferAttribute(br,4)),Sr.length>0&&vr.setAttribute("color",new Float32BufferAttribute(Sr,3)),vr.setIndex(_r),vr}}function pushIfUnique(ir,er){ir.indexOf(er)===-1&&ir.push(er)}function removeFromArray(ir,er){const tr=ir.indexOf(er);tr>-1&&ir.splice(tr,1)}function computeEdgeCollapseCost(ir,er){const tr=er.position.distanceTo(ir.position);let rr=0;const nr=[];for(let or=0,lr=ir.faces.length;or<lr;or++){const cr=ir.faces[or];cr.hasVertex(er)&&nr.push(cr)}for(let or=0,lr=ir.faces.length;or<lr;or++){let cr=1;const hr=ir.faces[or];for(let fr=0;fr<nr.length;fr++){const ur=nr[fr],pr=hr.normal.dot(ur.normal);cr=Math.min(cr,(1.001-pr)/2)}rr=Math.max(rr,cr)}const sr=0;return nr.length<2&&(rr=1),tr*rr+sr}function computeEdgeCostAtVertex(ir){if(ir.neighbors.length===0){ir.collapseNeighbor=null,ir.collapseCost=-.01;return}ir.collapseCost=1e5,ir.collapseNeighbor=null;for(let er=0;er<ir.neighbors.length;er++){const tr=computeEdgeCollapseCost(ir,ir.neighbors[er]);ir.collapseNeighbor||(ir.collapseNeighbor=ir.neighbors[er],ir.collapseCost=tr,ir.minCost=tr,ir.totalCost=0,ir.costCount=0),ir.costCount++,ir.totalCost+=tr,tr<ir.minCost&&(ir.collapseNeighbor=ir.neighbors[er],ir.minCost=tr)}ir.collapseCost=ir.totalCost/ir.costCount}function removeVertex(ir,er){for(console.assert(ir.faces.length===0);ir.neighbors.length;){const tr=ir.neighbors.pop();removeFromArray(tr.neighbors,ir)}removeFromArray(er,ir)}function removeFace(ir,er){removeFromArray(er,ir),ir.v1&&removeFromArray(ir.v1.faces,ir),ir.v2&&removeFromArray(ir.v2.faces,ir),ir.v3&&removeFromArray(ir.v3.faces,ir);const tr=[ir.v1,ir.v2,ir.v3];for(let rr=0;rr<3;rr++){const nr=tr[rr],sr=tr[(rr+1)%3];!nr||!sr||(nr.removeIfNonNeighbor(sr),sr.removeIfNonNeighbor(nr))}}function collapse(ir,er,tr,rr){if(!rr){removeVertex(tr,ir);return}rr.uv&&tr.uv.copy(rr.uv),rr.normal&&rr.normal.add(tr.normal).normalize(),rr.tangent&&rr.tangent.add(tr.tangent).normalize();const nr=[];for(let sr=0;sr<tr.neighbors.length;sr++)nr.push(tr.neighbors[sr]);for(let sr=tr.faces.length-1;sr>=0;sr--)tr.faces[sr]&&tr.faces[sr].hasVertex(rr)&&removeFace(tr.faces[sr],er);for(let sr=tr.faces.length-1;sr>=0;sr--)tr.faces[sr].replaceVertex(tr,rr);removeVertex(tr,ir);for(let sr=0;sr<nr.length;sr++)computeEdgeCostAtVertex(nr[sr])}function minimumCostEdge(ir){let er=ir[0];for(let tr=0;tr<ir.length;tr++)ir[tr].collapseCost<er.collapseCost&&(er=ir[tr]);return er}class Triangle{constructor(er,tr,rr,nr,sr,ar){this.a=nr,this.b=sr,this.c=ar,this.v1=er,this.v2=tr,this.v3=rr,this.normal=new Vector3$1,this.computeNormal(),er.faces.push(this),er.addUniqueNeighbor(tr),er.addUniqueNeighbor(rr),tr.faces.push(this),tr.addUniqueNeighbor(er),tr.addUniqueNeighbor(rr),rr.faces.push(this),rr.addUniqueNeighbor(er),rr.addUniqueNeighbor(tr)}computeNormal(){const er=this.v1.position,tr=this.v2.position,rr=this.v3.position;_cb.subVectors(rr,tr),_ab.subVectors(er,tr),_cb.cross(_ab).normalize(),this.normal.copy(_cb)}hasVertex(er){return er===this.v1||er===this.v2||er===this.v3}replaceVertex(er,tr){er===this.v1?this.v1=tr:er===this.v2?this.v2=tr:er===this.v3&&(this.v3=tr),removeFromArray(er.faces,this),tr.faces.push(this),er.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(er),er.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(er),er.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(er),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()}}class Vertex{constructor(er,tr,rr,nr,sr){this.position=er,this.uv=tr,this.normal=rr,this.tangent=nr,this.color=sr,this.id=-1,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}addUniqueNeighbor(er){pushIfUnique(this.neighbors,er)}removeIfNonNeighbor(er){const tr=this.neighbors,rr=this.faces,nr=tr.indexOf(er);if(nr!==-1){for(let sr=0;sr<rr.length;sr++)if(rr[sr].hasVertex(er))return;tr.splice(nr,1)}}}class TessellateModifier{constructor(er=.1,tr=6){this.maxEdgeLength=er,this.maxIterations=tr}modify(er){er.index!==null&&(er=er.toNonIndexed());const tr=this.maxIterations,rr=this.maxEdgeLength*this.maxEdgeLength,nr=new Vector3$1,sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=[nr,sr,ar,or],cr=new Vector3$1,hr=new Vector3$1,fr=new Vector3$1,ur=new Vector3$1,pr=[cr,hr,fr,ur],gr=new Color,_r=new Color,mr=new Color,dr=new Color,vr=[gr,_r,mr,dr],Ar=new Vector2,yr=new Vector2,wr=new Vector2,br=new Vector2,Sr=[Ar,yr,wr,br],xr=new Vector2,Cr=new Vector2,Ir=new Vector2,Rr=new Vector2,Pr=[xr,Cr,Ir,Rr],Fr=er.attributes,Nr=Fr.normal!==void 0,Ur=Fr.color!==void 0,Br=Fr.uv!==void 0,Or=Fr.uv1!==void 0;let Dr=Fr.position.array,Wr=Nr?Fr.normal.array:null,$r=Ur?Fr.color.array:null,Yr=Br?Fr.uv.array:null,Qi=Or?Fr.uv1.array:null,rs=Dr,Kr=Wr,Qr=$r,Vr=Yr,Gr=Qi,qr=0,ji=!0;function Zr(Yi,qi,Xr){const ns=lr[Yi],os=lr[qi],us=lr[Xr];if(rs.push(ns.x,ns.y,ns.z),rs.push(os.x,os.y,os.z),rs.push(us.x,us.y,us.z),Nr){const is=pr[Yi],Ji=pr[qi],ms=pr[Xr];Kr.push(is.x,is.y,is.z),Kr.push(Ji.x,Ji.y,Ji.z),Kr.push(ms.x,ms.y,ms.z)}if(Ur){const is=vr[Yi],Ji=vr[qi],ms=vr[Xr];Qr.push(is.r,is.g,is.b),Qr.push(Ji.r,Ji.g,Ji.b),Qr.push(ms.r,ms.g,ms.b)}if(Br){const is=Sr[Yi],Ji=Sr[qi],ms=Sr[Xr];Vr.push(is.x,is.y),Vr.push(Ji.x,Ji.y),Vr.push(ms.x,ms.y)}if(Or){const is=Pr[Yi],Ji=Pr[qi],ms=Pr[Xr];Gr.push(is.x,is.y),Gr.push(Ji.x,Ji.y),Gr.push(ms.x,ms.y)}}for(;ji&&qr<tr;){qr++,ji=!1,Dr=rs,rs=[],Nr&&(Wr=Kr,Kr=[]),Ur&&($r=Qr,Qr=[]),Br&&(Yr=Vr,Vr=[]),Or&&(Qi=Gr,Gr=[]);for(let Yi=0,qi=0,Xr=Dr.length;Yi<Xr;Yi+=9,qi+=6){nr.fromArray(Dr,Yi+0),sr.fromArray(Dr,Yi+3),ar.fromArray(Dr,Yi+6),Nr&&(cr.fromArray(Wr,Yi+0),hr.fromArray(Wr,Yi+3),fr.fromArray(Wr,Yi+6)),Ur&&(gr.fromArray($r,Yi+0),_r.fromArray($r,Yi+3),mr.fromArray($r,Yi+6)),Br&&(Ar.fromArray(Yr,qi+0),yr.fromArray(Yr,qi+2),wr.fromArray(Yr,qi+4)),Or&&(xr.fromArray(Qi,qi+0),Cr.fromArray(Qi,qi+2),Ir.fromArray(Qi,qi+4));const ns=nr.distanceToSquared(sr),os=sr.distanceToSquared(ar),us=nr.distanceToSquared(ar);ns>rr||os>rr||us>rr?(ji=!0,ns>=os&&ns>=us?(or.lerpVectors(nr,sr,.5),Nr&&ur.lerpVectors(cr,hr,.5),Ur&&dr.lerpColors(gr,_r,.5),Br&&br.lerpVectors(Ar,yr,.5),Or&&Rr.lerpVectors(xr,Cr,.5),Zr(0,3,2),Zr(3,1,2)):os>=ns&&os>=us?(or.lerpVectors(sr,ar,.5),Nr&&ur.lerpVectors(hr,fr,.5),Ur&&dr.lerpColors(_r,mr,.5),Br&&br.lerpVectors(yr,wr,.5),Or&&Rr.lerpVectors(Cr,Ir,.5),Zr(0,1,3),Zr(3,2,0)):(or.lerpVectors(nr,ar,.5),Nr&&ur.lerpVectors(cr,fr,.5),Ur&&dr.lerpColors(gr,mr,.5),Br&&br.lerpVectors(Ar,wr,.5),Or&&Rr.lerpVectors(xr,Ir,.5),Zr(0,1,3),Zr(3,1,2))):Zr(0,1,2)}}const Zi=new BufferGeometry;return Zi.setAttribute("position",new Float32BufferAttribute(rs,3)),Nr&&Zi.setAttribute("normal",new Float32BufferAttribute(Kr,3)),Ur&&Zi.setAttribute("color",new Float32BufferAttribute(Qr,3)),Br&&Zi.setAttribute("uv",new Float32BufferAttribute(Vr,2)),Or&&Zi.setAttribute("uv1",new Float32BufferAttribute(Gr,2)),Zi}}class GroundedSkybox extends Mesh{constructor(er,tr,rr,nr=128){if(tr<=0||rr<=0||nr<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const sr=new SphereGeometry(rr,2*nr,nr);sr.scale(1,1,-1);const ar=sr.getAttribute("position"),or=new Vector3$1;for(let lr=0;lr<ar.count;++lr)if(or.fromBufferAttribute(ar,lr),or.y<0){const cr=-tr*3/2,hr=or.y<cr?-tr/or.y:1-or.y*or.y/(3*cr*cr);or.multiplyScalar(hr),or.toArray(ar.array,3*lr)}ar.needsUpdate=!0,super(sr,new MeshBasicMaterial({map:er,depthWrite:!1}))}}class Lensflare extends Mesh{constructor(){super(Lensflare.Geometry,new MeshBasicMaterial({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const er=new Vector3$1,tr=new Vector3$1,rr=new FramebufferTexture(16,16),nr=new FramebufferTexture(16,16);let sr=UnsignedByteType;const ar=Lensflare.Geometry,or=new RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;

				void main() {

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				void main() {

					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );

				}`,depthTest:!0,depthWrite:!1,transparent:!1}),lr=new RawShaderMaterial({uniforms:{map:{value:rr},scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;
				attribute vec2 uv;

				varying vec2 vUV;

				void main() {

					vUV = uv;

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				uniform sampler2D map;

				varying vec2 vUV;

				void main() {

					gl_FragColor = texture2D( map, vUV );

				}`,depthTest:!1,depthWrite:!1,transparent:!1}),cr=new Mesh(ar,or),hr=[],fr=LensflareElement.Shader,ur=new RawShaderMaterial({name:fr.name,uniforms:{map:{value:null},occlusionMap:{value:nr},color:{value:new Color(16777215)},scale:{value:new Vector2},screenPosition:{value:new Vector3$1}},vertexShader:fr.vertexShader,fragmentShader:fr.fragmentShader,blending:AdditiveBlending,transparent:!0,depthWrite:!1}),pr=new Mesh(ar,ur);this.addElement=function(vr){hr.push(vr)};const gr=new Vector2,_r=new Vector2,mr=new Box2,dr=new Vector4;this.onBeforeRender=function(vr,Ar,yr){vr.getCurrentViewport(dr);const wr=vr.getRenderTarget(),br=wr!==null?wr.texture.type:UnsignedByteType;sr!==br&&(rr.dispose(),nr.dispose(),rr.type=nr.type=br,sr=br);const Sr=dr.w/dr.z,xr=dr.z/2,Cr=dr.w/2;let Ir=16/dr.w;if(gr.set(Ir*Sr,Ir),mr.min.set(dr.x,dr.y),mr.max.set(dr.x+(dr.z-16),dr.y+(dr.w-16)),tr.setFromMatrixPosition(this.matrixWorld),tr.applyMatrix4(yr.matrixWorldInverse),!(tr.z>0)&&(er.copy(tr).applyMatrix4(yr.projectionMatrix),_r.x=dr.x+er.x*xr+xr-8,_r.y=dr.y+er.y*Cr+Cr-8,mr.containsPoint(_r))){vr.copyFramebufferToTexture(rr,_r);let Rr=or.uniforms;Rr.scale.value=gr,Rr.screenPosition.value=er,vr.renderBufferDirect(yr,null,ar,or,cr,null),vr.copyFramebufferToTexture(nr,_r),Rr=lr.uniforms,Rr.scale.value=gr,Rr.screenPosition.value=er,vr.renderBufferDirect(yr,null,ar,lr,cr,null);const Pr=-er.x*2,Fr=-er.y*2;for(let Nr=0,Ur=hr.length;Nr<Ur;Nr++){const Br=hr[Nr],Or=ur.uniforms;Or.color.value.copy(Br.color),Or.map.value=Br.texture,Or.screenPosition.value.x=er.x+Pr*Br.distance,Or.screenPosition.value.y=er.y+Fr*Br.distance,Ir=Br.size/dr.w;const Dr=dr.w/dr.z;Or.scale.value.set(Ir*Dr,Ir),ur.uniformsNeedUpdate=!0,vr.renderBufferDirect(yr,null,ar,ur,pr,null)}}},this.dispose=function(){or.dispose(),lr.dispose(),ur.dispose(),rr.dispose(),nr.dispose();for(let vr=0,Ar=hr.length;vr<Ar;vr++)hr[vr].texture.dispose()}}}class LensflareElement{constructor(er,tr=1,rr=0,nr=new Color(16777215)){this.texture=er,this.size=tr,this.distance=rr,this.color=nr}}LensflareElement.Shader={name:"LensflareElementShader",uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:`

		precision highp float;

		uniform vec3 screenPosition;
		uniform vec2 scale;

		uniform sampler2D occlusionMap;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vUV = uv;

			vec2 pos = position.xy;

			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );

			vVisibility =        visibility.r / 9.0;
			vVisibility *= 1.0 - visibility.g / 9.0;
			vVisibility *=       visibility.b / 9.0;

			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D map;
		uniform vec3 color;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vec4 texture = texture2D( map, vUV );
			texture.a *= vVisibility;
			gl_FragColor = texture;
			gl_FragColor.rgb *= color;

		}`};Lensflare.Geometry=function(){const ir=new BufferGeometry,er=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),tr=new InterleavedBuffer(er,5);return ir.setIndex([0,1,2,0,2,3]),ir.setAttribute("position",new InterleavedBufferAttribute(tr,3,0,!1)),ir.setAttribute("uv",new InterleavedBufferAttribute(tr,2,3,!1)),ir}();class MarchingCubes extends Mesh{constructor(er,tr,rr=!1,nr=!1,sr=1e4){const ar=new BufferGeometry;super(ar,tr),this.isMarchingCubes=!0;const or=this,lr=new Float32Array(12*3),cr=new Float32Array(12*3),hr=new Float32Array(12*3);this.enableUvs=rr,this.enableColors=nr,this.init=function(vr){this.resolution=vr,this.isolation=80,this.size=vr,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.palette=new Float32Array(this.size3*3),this.count=0;const Ar=sr*3;this.positionArray=new Float32Array(Ar*3);const yr=new BufferAttribute(this.positionArray,3);yr.setUsage(DynamicDrawUsage),ar.setAttribute("position",yr),this.normalArray=new Float32Array(Ar*3);const wr=new BufferAttribute(this.normalArray,3);if(wr.setUsage(DynamicDrawUsage),ar.setAttribute("normal",wr),this.enableUvs){this.uvArray=new Float32Array(Ar*2);const br=new BufferAttribute(this.uvArray,2);br.setUsage(DynamicDrawUsage),ar.setAttribute("uv",br)}if(this.enableColors){this.colorArray=new Float32Array(Ar*3);const br=new BufferAttribute(this.colorArray,3);br.setUsage(DynamicDrawUsage),ar.setAttribute("color",br)}ar.boundingSphere=new Sphere(new Vector3$1,1)};function fr(vr,Ar,yr){return vr+(Ar-vr)*yr}function ur(vr,Ar,yr,wr,br,Sr,xr,Cr,Ir,Rr){const Pr=(yr-xr)/(Cr-xr),Fr=or.normal_cache;lr[Ar+0]=wr+Pr*or.delta,lr[Ar+1]=br,lr[Ar+2]=Sr,cr[Ar+0]=fr(Fr[vr+0],Fr[vr+3],Pr),cr[Ar+1]=fr(Fr[vr+1],Fr[vr+4],Pr),cr[Ar+2]=fr(Fr[vr+2],Fr[vr+5],Pr),hr[Ar+0]=fr(or.palette[Ir*3+0],or.palette[Rr*3+0],Pr),hr[Ar+1]=fr(or.palette[Ir*3+1],or.palette[Rr*3+1],Pr),hr[Ar+2]=fr(or.palette[Ir*3+2],or.palette[Rr*3+2],Pr)}function pr(vr,Ar,yr,wr,br,Sr,xr,Cr,Ir,Rr){const Pr=(yr-xr)/(Cr-xr),Fr=or.normal_cache;lr[Ar+0]=wr,lr[Ar+1]=br+Pr*or.delta,lr[Ar+2]=Sr;const Nr=vr+or.yd*3;cr[Ar+0]=fr(Fr[vr+0],Fr[Nr+0],Pr),cr[Ar+1]=fr(Fr[vr+1],Fr[Nr+1],Pr),cr[Ar+2]=fr(Fr[vr+2],Fr[Nr+2],Pr),hr[Ar+0]=fr(or.palette[Ir*3+0],or.palette[Rr*3+0],Pr),hr[Ar+1]=fr(or.palette[Ir*3+1],or.palette[Rr*3+1],Pr),hr[Ar+2]=fr(or.palette[Ir*3+2],or.palette[Rr*3+2],Pr)}function gr(vr,Ar,yr,wr,br,Sr,xr,Cr,Ir,Rr){const Pr=(yr-xr)/(Cr-xr),Fr=or.normal_cache;lr[Ar+0]=wr,lr[Ar+1]=br,lr[Ar+2]=Sr+Pr*or.delta;const Nr=vr+or.zd*3;cr[Ar+0]=fr(Fr[vr+0],Fr[Nr+0],Pr),cr[Ar+1]=fr(Fr[vr+1],Fr[Nr+1],Pr),cr[Ar+2]=fr(Fr[vr+2],Fr[Nr+2],Pr),hr[Ar+0]=fr(or.palette[Ir*3+0],or.palette[Rr*3+0],Pr),hr[Ar+1]=fr(or.palette[Ir*3+1],or.palette[Rr*3+1],Pr),hr[Ar+2]=fr(or.palette[Ir*3+2],or.palette[Rr*3+2],Pr)}function _r(vr){const Ar=vr*3;or.normal_cache[Ar]===0&&(or.normal_cache[Ar+0]=or.field[vr-1]-or.field[vr+1],or.normal_cache[Ar+1]=or.field[vr-or.yd]-or.field[vr+or.yd],or.normal_cache[Ar+2]=or.field[vr-or.zd]-or.field[vr+or.zd])}function mr(vr,Ar,yr,wr,br){const Sr=wr+1,xr=wr+or.yd,Cr=wr+or.zd,Ir=Sr+or.yd,Rr=Sr+or.zd,Pr=wr+or.yd+or.zd,Fr=Sr+or.yd+or.zd;let Nr=0;const Ur=or.field[wr],Br=or.field[Sr],Or=or.field[xr],Dr=or.field[Ir],Wr=or.field[Cr],$r=or.field[Rr],Yr=or.field[Pr],Qi=or.field[Fr];Ur<br&&(Nr|=1),Br<br&&(Nr|=2),Or<br&&(Nr|=8),Dr<br&&(Nr|=4),Wr<br&&(Nr|=16),$r<br&&(Nr|=32),Yr<br&&(Nr|=128),Qi<br&&(Nr|=64);const rs=edgeTable[Nr];if(rs===0)return 0;const Kr=or.delta,Qr=vr+Kr,Vr=Ar+Kr,Gr=yr+Kr;rs&1&&(_r(wr),_r(Sr),ur(wr*3,0,br,vr,Ar,yr,Ur,Br,wr,Sr)),rs&2&&(_r(Sr),_r(Ir),pr(Sr*3,3,br,Qr,Ar,yr,Br,Dr,Sr,Ir)),rs&4&&(_r(xr),_r(Ir),ur(xr*3,6,br,vr,Vr,yr,Or,Dr,xr,Ir)),rs&8&&(_r(wr),_r(xr),pr(wr*3,9,br,vr,Ar,yr,Ur,Or,wr,xr)),rs&16&&(_r(Cr),_r(Rr),ur(Cr*3,12,br,vr,Ar,Gr,Wr,$r,Cr,Rr)),rs&32&&(_r(Rr),_r(Fr),pr(Rr*3,15,br,Qr,Ar,Gr,$r,Qi,Rr,Fr)),rs&64&&(_r(Pr),_r(Fr),ur(Pr*3,18,br,vr,Vr,Gr,Yr,Qi,Pr,Fr)),rs&128&&(_r(Cr),_r(Pr),pr(Cr*3,21,br,vr,Ar,Gr,Wr,Yr,Cr,Pr)),rs&256&&(_r(wr),_r(Cr),gr(wr*3,24,br,vr,Ar,yr,Ur,Wr,wr,Cr)),rs&512&&(_r(Sr),_r(Rr),gr(Sr*3,27,br,Qr,Ar,yr,Br,$r,Sr,Rr)),rs&1024&&(_r(Ir),_r(Fr),gr(Ir*3,30,br,Qr,Vr,yr,Dr,Qi,Ir,Fr)),rs&2048&&(_r(xr),_r(Pr),gr(xr*3,33,br,vr,Vr,yr,Or,Yr,xr,Pr)),Nr<<=4;let qr,ji,Zr,Zi=0,Yi=0;for(;triTable[Nr+Yi]!=-1;)qr=Nr+Yi,ji=qr+1,Zr=qr+2,dr(lr,cr,hr,3*triTable[qr],3*triTable[ji],3*triTable[Zr]),Yi+=3,Zi++;return Zi}function dr(vr,Ar,yr,wr,br,Sr){const xr=or.count*3;if(or.positionArray[xr+0]=vr[wr],or.positionArray[xr+1]=vr[wr+1],or.positionArray[xr+2]=vr[wr+2],or.positionArray[xr+3]=vr[br],or.positionArray[xr+4]=vr[br+1],or.positionArray[xr+5]=vr[br+2],or.positionArray[xr+6]=vr[Sr],or.positionArray[xr+7]=vr[Sr+1],or.positionArray[xr+8]=vr[Sr+2],or.material.flatShading===!0){const Cr=(Ar[wr+0]+Ar[br+0]+Ar[Sr+0])/3,Ir=(Ar[wr+1]+Ar[br+1]+Ar[Sr+1])/3,Rr=(Ar[wr+2]+Ar[br+2]+Ar[Sr+2])/3;or.normalArray[xr+0]=Cr,or.normalArray[xr+1]=Ir,or.normalArray[xr+2]=Rr,or.normalArray[xr+3]=Cr,or.normalArray[xr+4]=Ir,or.normalArray[xr+5]=Rr,or.normalArray[xr+6]=Cr,or.normalArray[xr+7]=Ir,or.normalArray[xr+8]=Rr}else or.normalArray[xr+0]=Ar[wr+0],or.normalArray[xr+1]=Ar[wr+1],or.normalArray[xr+2]=Ar[wr+2],or.normalArray[xr+3]=Ar[br+0],or.normalArray[xr+4]=Ar[br+1],or.normalArray[xr+5]=Ar[br+2],or.normalArray[xr+6]=Ar[Sr+0],or.normalArray[xr+7]=Ar[Sr+1],or.normalArray[xr+8]=Ar[Sr+2];if(or.enableUvs){const Cr=or.count*2;or.uvArray[Cr+0]=vr[wr+0],or.uvArray[Cr+1]=vr[wr+2],or.uvArray[Cr+2]=vr[br+0],or.uvArray[Cr+3]=vr[br+2],or.uvArray[Cr+4]=vr[Sr+0],or.uvArray[Cr+5]=vr[Sr+2]}or.enableColors&&(or.colorArray[xr+0]=yr[wr+0],or.colorArray[xr+1]=yr[wr+1],or.colorArray[xr+2]=yr[wr+2],or.colorArray[xr+3]=yr[br+0],or.colorArray[xr+4]=yr[br+1],or.colorArray[xr+5]=yr[br+2],or.colorArray[xr+6]=yr[Sr+0],or.colorArray[xr+7]=yr[Sr+1],or.colorArray[xr+8]=yr[Sr+2]),or.count+=3}this.addBall=function(vr,Ar,yr,wr,br,Sr){const xr=Math.sign(wr);wr=Math.abs(wr);const Cr=Sr!=null;let Ir=new Color(vr,Ar,yr);if(Cr)try{Ir=Sr instanceof Color?Sr:Array.isArray(Sr)?new Color(Math.min(Math.abs(Sr[0]),1),Math.min(Math.abs(Sr[1]),1),Math.min(Math.abs(Sr[2]),1)):new Color(Sr)}catch{Ir=new Color(vr,Ar,yr)}const Rr=this.size*Math.sqrt(wr/br),Pr=yr*this.size,Fr=Ar*this.size,Nr=vr*this.size;let Ur=Math.floor(Pr-Rr);Ur<1&&(Ur=1);let Br=Math.floor(Pr+Rr);Br>this.size-1&&(Br=this.size-1);let Or=Math.floor(Fr-Rr);Or<1&&(Or=1);let Dr=Math.floor(Fr+Rr);Dr>this.size-1&&(Dr=this.size-1);let Wr=Math.floor(Nr-Rr);Wr<1&&(Wr=1);let $r=Math.floor(Nr+Rr);$r>this.size-1&&($r=this.size-1);let Yr,Qi,rs,Kr,Qr,Vr,Gr,qr,ji,Zr,Zi;for(rs=Ur;rs<Br;rs++)for(Qr=this.size2*rs,qr=rs/this.size-yr,ji=qr*qr,Qi=Or;Qi<Dr;Qi++)for(Kr=Qr+this.size*Qi,Gr=Qi/this.size-Ar,Zr=Gr*Gr,Yr=Wr;Yr<$r;Yr++)if(Vr=Yr/this.size-vr,Zi=wr/(1e-6+Vr*Vr+Zr+ji)-br,Zi>0){this.field[Kr+Yr]+=Zi*xr;const Yi=Math.sqrt((Yr-Nr)*(Yr-Nr)+(Qi-Fr)*(Qi-Fr)+(rs-Pr)*(rs-Pr))/Rr,qi=1-Yi*Yi*Yi*(Yi*(Yi*6-15)+10);this.palette[(Kr+Yr)*3+0]+=Ir.r*qi,this.palette[(Kr+Yr)*3+1]+=Ir.g*qi,this.palette[(Kr+Yr)*3+2]+=Ir.b*qi}},this.addPlaneX=function(vr,Ar){const yr=this.size,wr=this.yd,br=this.zd,Sr=this.field;let xr,Cr,Ir,Rr,Pr,Fr,Nr,Ur=yr*Math.sqrt(vr/Ar);for(Ur>yr&&(Ur=yr),xr=0;xr<Ur;xr++)if(Fr=xr/yr,Rr=Fr*Fr,Pr=vr/(1e-4+Rr)-Ar,Pr>0)for(Cr=0;Cr<yr;Cr++)for(Nr=xr+Cr*wr,Ir=0;Ir<yr;Ir++)Sr[br*Ir+Nr]+=Pr},this.addPlaneY=function(vr,Ar){const yr=this.size,wr=this.yd,br=this.zd,Sr=this.field;let xr,Cr,Ir,Rr,Pr,Fr,Nr,Ur,Br=yr*Math.sqrt(vr/Ar);for(Br>yr&&(Br=yr),Cr=0;Cr<Br;Cr++)if(Fr=Cr/yr,Rr=Fr*Fr,Pr=vr/(1e-4+Rr)-Ar,Pr>0)for(Nr=Cr*wr,xr=0;xr<yr;xr++)for(Ur=Nr+xr,Ir=0;Ir<yr;Ir++)Sr[br*Ir+Ur]+=Pr},this.addPlaneZ=function(vr,Ar){const yr=this.size,wr=this.yd,br=this.zd,Sr=this.field;let xr,Cr,Ir,Rr,Pr,Fr,Nr,Ur,Br=yr*Math.sqrt(vr/Ar);for(Br>yr&&(Br=yr),Ir=0;Ir<Br;Ir++)if(Fr=Ir/yr,Rr=Fr*Fr,Pr=vr/(1e-4+Rr)-Ar,Pr>0)for(Nr=br*Ir,Cr=0;Cr<yr;Cr++)for(Ur=Nr+Cr*wr,xr=0;xr<yr;xr++)Sr[Ur+xr]+=Pr},this.setCell=function(vr,Ar,yr,wr){const br=this.size2*yr+this.size*Ar+vr;this.field[br]=wr},this.getCell=function(vr,Ar,yr){const wr=this.size2*yr+this.size*Ar+vr;return this.field[wr]},this.blur=function(vr=1){const Ar=this.field,yr=Ar.slice(),wr=this.size,br=this.size2;for(let Sr=0;Sr<wr;Sr++)for(let xr=0;xr<wr;xr++)for(let Cr=0;Cr<wr;Cr++){const Ir=br*Cr+wr*xr+Sr;let Rr=yr[Ir],Pr=1;for(let Fr=-1;Fr<=1;Fr+=2){const Nr=Fr+Sr;if(!(Nr<0||Nr>=wr))for(let Ur=-1;Ur<=1;Ur+=2){const Br=Ur+xr;if(!(Br<0||Br>=wr))for(let Or=-1;Or<=1;Or+=2){const Dr=Or+Cr;if(Dr<0||Dr>=wr)continue;const Wr=br*Dr+wr*Br+Nr,$r=yr[Wr];Pr++,Rr+=vr*($r-Rr)/Pr}}}Ar[Ir]=Rr}},this.reset=function(){for(let vr=0;vr<this.size3;vr++)this.normal_cache[vr*3]=0,this.field[vr]=0,this.palette[vr*3]=this.palette[vr*3+1]=this.palette[vr*3+2]=0},this.update=function(){this.count=0;const vr=this.size-2;for(let Ar=1;Ar<vr;Ar++){const yr=this.size2*Ar,wr=(Ar-this.halfsize)/this.halfsize;for(let br=1;br<vr;br++){const Sr=yr+this.size*br,xr=(br-this.halfsize)/this.halfsize;for(let Cr=1;Cr<vr;Cr++){const Ir=(Cr-this.halfsize)/this.halfsize,Rr=Sr+Cr;mr(Ir,xr,wr,Rr,this.isolation)}}}this.geometry.setDrawRange(0,this.count),ar.getAttribute("position").needsUpdate=!0,ar.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(ar.getAttribute("uv").needsUpdate=!0),this.enableColors&&(ar.getAttribute("color").needsUpdate=!0),this.count/3>sr&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(er)}}const edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);class Reflector extends Mesh{constructor(er,tr={}){super(er),this.isReflector=!0,this.type="Reflector",this.camera=new PerspectiveCamera;const rr=this,nr=tr.color!==void 0?new Color(tr.color):new Color(8355711),sr=tr.textureWidth||512,ar=tr.textureHeight||512,or=tr.clipBias||0,lr=tr.shader||Reflector.ReflectorShader,cr=tr.multisample!==void 0?tr.multisample:4,hr=new Plane,fr=new Vector3$1,ur=new Vector3$1,pr=new Vector3$1,gr=new Matrix4,_r=new Vector3$1(0,0,-1),mr=new Vector4,dr=new Vector3$1,vr=new Vector3$1,Ar=new Vector4,yr=new Matrix4,wr=this.camera,br=new WebGLRenderTarget(sr,ar,{samples:cr,type:HalfFloatType}),Sr=new ShaderMaterial({name:lr.name!==void 0?lr.name:"unspecified",uniforms:UniformsUtils.clone(lr.uniforms),fragmentShader:lr.fragmentShader,vertexShader:lr.vertexShader});Sr.uniforms.tDiffuse.value=br.texture,Sr.uniforms.color.value=nr,Sr.uniforms.textureMatrix.value=yr,this.material=Sr,this.onBeforeRender=function(xr,Cr,Ir){if(ur.setFromMatrixPosition(rr.matrixWorld),pr.setFromMatrixPosition(Ir.matrixWorld),gr.extractRotation(rr.matrixWorld),fr.set(0,0,1),fr.applyMatrix4(gr),dr.subVectors(ur,pr),dr.dot(fr)>0)return;dr.reflect(fr).negate(),dr.add(ur),gr.extractRotation(Ir.matrixWorld),_r.set(0,0,-1),_r.applyMatrix4(gr),_r.add(pr),vr.subVectors(ur,_r),vr.reflect(fr).negate(),vr.add(ur),wr.position.copy(dr),wr.up.set(0,1,0),wr.up.applyMatrix4(gr),wr.up.reflect(fr),wr.lookAt(vr),wr.far=Ir.far,wr.updateMatrixWorld(),wr.projectionMatrix.copy(Ir.projectionMatrix),yr.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),yr.multiply(wr.projectionMatrix),yr.multiply(wr.matrixWorldInverse),yr.multiply(rr.matrixWorld),hr.setFromNormalAndCoplanarPoint(fr,ur),hr.applyMatrix4(wr.matrixWorldInverse),mr.set(hr.normal.x,hr.normal.y,hr.normal.z,hr.constant);const Rr=wr.projectionMatrix;Ar.x=(Math.sign(mr.x)+Rr.elements[8])/Rr.elements[0],Ar.y=(Math.sign(mr.y)+Rr.elements[9])/Rr.elements[5],Ar.z=-1,Ar.w=(1+Rr.elements[10])/Rr.elements[14],mr.multiplyScalar(2/mr.dot(Ar)),Rr.elements[2]=mr.x,Rr.elements[6]=mr.y,Rr.elements[10]=mr.z+1-or,Rr.elements[14]=mr.w,rr.visible=!1;const Pr=xr.getRenderTarget(),Fr=xr.xr.enabled,Nr=xr.shadowMap.autoUpdate;xr.xr.enabled=!1,xr.shadowMap.autoUpdate=!1,xr.setRenderTarget(br),xr.state.buffers.depth.setMask(!0),xr.autoClear===!1&&xr.clear(),xr.render(Cr,wr),xr.xr.enabled=Fr,xr.shadowMap.autoUpdate=Nr,xr.setRenderTarget(Pr);const Ur=Ir.viewport;Ur!==void 0&&xr.state.viewport(Ur),rr.visible=!0},this.getRenderTarget=function(){return br},this.dispose=function(){br.dispose(),rr.material.dispose()}}}Reflector.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class ReflectorForSSRPass extends Mesh{constructor(er,tr={}){super(er),this.isReflectorForSSRPass=!0,this.type="ReflectorForSSRPass";const rr=this,nr=tr.color!==void 0?new Color(tr.color):new Color(8355711),sr=tr.textureWidth||512,ar=tr.textureHeight||512,or=tr.clipBias||0,lr=tr.shader||ReflectorForSSRPass.ReflectorShader,cr=tr.useDepthTexture===!0,hr=new Vector3$1(0,1,0),fr=new Vector3$1,ur=new Vector3$1;rr.needsUpdate=!1,rr.maxDistance=ReflectorForSSRPass.ReflectorShader.uniforms.maxDistance.value,rr.opacity=ReflectorForSSRPass.ReflectorShader.uniforms.opacity.value,rr.color=nr,rr.resolution=tr.resolution||new Vector2(window.innerWidth,window.innerHeight),rr._distanceAttenuation=ReflectorForSSRPass.ReflectorShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(rr,"distanceAttenuation",{get(){return rr._distanceAttenuation},set(Pr){rr._distanceAttenuation!==Pr&&(rr._distanceAttenuation=Pr,rr.material.defines.DISTANCE_ATTENUATION=Pr,rr.material.needsUpdate=!0)}}),rr._fresnel=ReflectorForSSRPass.ReflectorShader.defines.FRESNEL,Object.defineProperty(rr,"fresnel",{get(){return rr._fresnel},set(Pr){rr._fresnel!==Pr&&(rr._fresnel=Pr,rr.material.defines.FRESNEL=Pr,rr.material.needsUpdate=!0)}});const pr=new Vector3$1,gr=new Vector3$1,_r=new Vector3$1,mr=new Matrix4,dr=new Vector3$1(0,0,-1),vr=new Vector3$1,Ar=new Vector3$1,yr=new Matrix4,wr=new PerspectiveCamera;let br;cr&&(br=new DepthTexture,br.type=UnsignedShortType,br.minFilter=NearestFilter,br.magFilter=NearestFilter);const Sr={depthTexture:cr?br:null,type:HalfFloatType},xr=new WebGLRenderTarget(sr,ar,Sr),Cr=new ShaderMaterial({name:lr.name!==void 0?lr.name:"unspecified",transparent:cr,defines:Object.assign({},ReflectorForSSRPass.ReflectorShader.defines,{useDepthTexture:cr}),uniforms:UniformsUtils.clone(lr.uniforms),fragmentShader:lr.fragmentShader,vertexShader:lr.vertexShader});Cr.uniforms.tDiffuse.value=xr.texture,Cr.uniforms.color.value=rr.color,Cr.uniforms.textureMatrix.value=yr,cr&&(Cr.uniforms.tDepth.value=xr.depthTexture),this.material=Cr;const Rr=[new Plane(new Vector3$1(0,1,0),or)];this.doRender=function(Pr,Fr,Nr){if(Cr.uniforms.maxDistance.value=rr.maxDistance,Cr.uniforms.color.value=rr.color,Cr.uniforms.opacity.value=rr.opacity,fr.copy(Nr.position).normalize(),ur.copy(fr).reflect(hr),Cr.uniforms.fresnelCoe.value=(fr.dot(ur)+1)/2,gr.setFromMatrixPosition(rr.matrixWorld),_r.setFromMatrixPosition(Nr.matrixWorld),mr.extractRotation(rr.matrixWorld),pr.set(0,0,1),pr.applyMatrix4(mr),vr.subVectors(gr,_r),vr.dot(pr)>0)return;vr.reflect(pr).negate(),vr.add(gr),mr.extractRotation(Nr.matrixWorld),dr.set(0,0,-1),dr.applyMatrix4(mr),dr.add(_r),Ar.subVectors(gr,dr),Ar.reflect(pr).negate(),Ar.add(gr),wr.position.copy(vr),wr.up.set(0,1,0),wr.up.applyMatrix4(mr),wr.up.reflect(pr),wr.lookAt(Ar),wr.far=Nr.far,wr.updateMatrixWorld(),wr.projectionMatrix.copy(Nr.projectionMatrix),Cr.uniforms.virtualCameraNear.value=Nr.near,Cr.uniforms.virtualCameraFar.value=Nr.far,Cr.uniforms.virtualCameraMatrixWorld.value=wr.matrixWorld,Cr.uniforms.virtualCameraProjectionMatrix.value=Nr.projectionMatrix,Cr.uniforms.virtualCameraProjectionMatrixInverse.value=Nr.projectionMatrixInverse,Cr.uniforms.resolution.value=rr.resolution,yr.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),yr.multiply(wr.projectionMatrix),yr.multiply(wr.matrixWorldInverse),yr.multiply(rr.matrixWorld);const Ur=Pr.getRenderTarget(),Br=Pr.xr.enabled,Or=Pr.shadowMap.autoUpdate,Dr=Pr.clippingPlanes;Pr.xr.enabled=!1,Pr.shadowMap.autoUpdate=!1,Pr.clippingPlanes=Rr,Pr.setRenderTarget(xr),Pr.state.buffers.depth.setMask(!0),Pr.autoClear===!1&&Pr.clear(),Pr.render(Fr,wr),Pr.xr.enabled=Br,Pr.shadowMap.autoUpdate=Or,Pr.clippingPlanes=Dr,Pr.setRenderTarget(Ur);const Wr=Nr.viewport;Wr!==void 0&&Pr.state.viewport(Wr)},this.getRenderTarget=function(){return xr}}}ReflectorForSSRPass.ReflectorShader={name:"ReflectorShader",defines:{DISTANCE_ATTENUATION:!0,FRESNEL:!0},uniforms:{color:{value:null},tDiffuse:{value:null},tDepth:{value:null},textureMatrix:{value:new Matrix4},maxDistance:{value:180},opacity:{value:.5},fresnelCoe:{value:null},virtualCameraNear:{value:null},virtualCameraFar:{value:null},virtualCameraProjectionMatrix:{value:new Matrix4},virtualCameraMatrixWorld:{value:new Matrix4},virtualCameraProjectionMatrixInverse:{value:new Matrix4},resolution:{value:new Vector2}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;
		uniform float maxDistance;
		uniform float opacity;
		uniform float fresnelCoe;
		uniform float virtualCameraNear;
		uniform float virtualCameraFar;
		uniform mat4 virtualCameraProjectionMatrix;
		uniform mat4 virtualCameraProjectionMatrixInverse;
		uniform mat4 virtualCameraMatrixWorld;
		uniform vec2 resolution;
		varying vec4 vUv;
		#include <packing>
		float blendOverlay( float base, float blend ) {
			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );
		}
		vec3 blendOverlay( vec3 base, vec3 blend ) {
			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			return perspectiveDepthToViewZ( depth, virtualCameraNear, virtualCameraFar );
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( virtualCameraProjectionMatrixInverse * clipPosition ).xyz;//view
		}
		void main() {
			vec4 base = texture2DProj( tDiffuse, vUv );
			#ifdef useDepthTexture
				vec2 uv=(gl_FragCoord.xy-.5)/resolution.xy;
				uv.x=1.-uv.x;
				float depth = texture2DProj( tDepth, vUv ).r;
				float viewZ = getViewZ( depth );
				float clipW = virtualCameraProjectionMatrix[2][3] * viewZ+virtualCameraProjectionMatrix[3][3];
				vec3 viewPosition=getViewPosition( uv, depth, clipW );
				vec3 worldPosition=(virtualCameraMatrixWorld*vec4(viewPosition,1)).xyz;
				if(worldPosition.y>maxDistance) discard;
				float op=opacity;
				#ifdef DISTANCE_ATTENUATION
					float ratio=1.-(worldPosition.y/maxDistance);
					float attenuation=ratio*ratio;
					op=opacity*attenuation;
				#endif
				#ifdef FRESNEL
					op*=fresnelCoe;
				#endif
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), op );
			#else
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );
			#endif
		}
	`};class Refractor extends Mesh{constructor(er,tr={}){super(er),this.isRefractor=!0,this.type="Refractor",this.camera=new PerspectiveCamera;const rr=this,nr=tr.color!==void 0?new Color(tr.color):new Color(8355711),sr=tr.textureWidth||512,ar=tr.textureHeight||512,or=tr.clipBias||0,lr=tr.shader||Refractor.RefractorShader,cr=tr.multisample!==void 0?tr.multisample:4,hr=this.camera;hr.matrixAutoUpdate=!1,hr.userData.refractor=!0;const fr=new Plane,ur=new Matrix4,pr=new WebGLRenderTarget(sr,ar,{samples:cr,type:HalfFloatType});this.material=new ShaderMaterial({name:lr.name!==void 0?lr.name:"unspecified",uniforms:UniformsUtils.clone(lr.uniforms),vertexShader:lr.vertexShader,fragmentShader:lr.fragmentShader,transparent:!0}),this.material.uniforms.color.value=nr,this.material.uniforms.tDiffuse.value=pr.texture,this.material.uniforms.textureMatrix.value=ur;const gr=function(){const Ar=new Vector3$1,yr=new Vector3$1,wr=new Matrix4,br=new Vector3$1,Sr=new Vector3$1;return function(Cr){return Ar.setFromMatrixPosition(rr.matrixWorld),yr.setFromMatrixPosition(Cr.matrixWorld),br.subVectors(Ar,yr),wr.extractRotation(rr.matrixWorld),Sr.set(0,0,1),Sr.applyMatrix4(wr),br.dot(Sr)<0}}(),_r=function(){const Ar=new Vector3$1,yr=new Vector3$1,wr=new Quaternion$1,br=new Vector3$1;return function(){rr.matrixWorld.decompose(yr,wr,br),Ar.set(0,0,1).applyQuaternion(wr).normalize(),Ar.negate(),fr.setFromNormalAndCoplanarPoint(Ar,yr)}}(),mr=function(){const Ar=new Plane,yr=new Vector4,wr=new Vector4;return function(Sr){hr.matrixWorld.copy(Sr.matrixWorld),hr.matrixWorldInverse.copy(hr.matrixWorld).invert(),hr.projectionMatrix.copy(Sr.projectionMatrix),hr.far=Sr.far,Ar.copy(fr),Ar.applyMatrix4(hr.matrixWorldInverse),yr.set(Ar.normal.x,Ar.normal.y,Ar.normal.z,Ar.constant);const xr=hr.projectionMatrix;wr.x=(Math.sign(yr.x)+xr.elements[8])/xr.elements[0],wr.y=(Math.sign(yr.y)+xr.elements[9])/xr.elements[5],wr.z=-1,wr.w=(1+xr.elements[10])/xr.elements[14],yr.multiplyScalar(2/yr.dot(wr)),xr.elements[2]=yr.x,xr.elements[6]=yr.y,xr.elements[10]=yr.z+1-or,xr.elements[14]=yr.w}}();function dr(Ar){ur.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ur.multiply(Ar.projectionMatrix),ur.multiply(Ar.matrixWorldInverse),ur.multiply(rr.matrixWorld)}function vr(Ar,yr,wr){rr.visible=!1;const br=Ar.getRenderTarget(),Sr=Ar.xr.enabled,xr=Ar.shadowMap.autoUpdate;Ar.xr.enabled=!1,Ar.shadowMap.autoUpdate=!1,Ar.setRenderTarget(pr),Ar.autoClear===!1&&Ar.clear(),Ar.render(yr,hr),Ar.xr.enabled=Sr,Ar.shadowMap.autoUpdate=xr,Ar.setRenderTarget(br);const Cr=wr.viewport;Cr!==void 0&&Ar.state.viewport(Cr),rr.visible=!0}this.onBeforeRender=function(Ar,yr,wr){wr.userData.refractor!==!0&&gr(wr)&&(_r(),dr(wr),mr(wr),vr(Ar,yr,wr))},this.getRenderTarget=function(){return pr},this.dispose=function(){pr.dispose(),rr.material.dispose()}}}Refractor.RefractorShader={name:"RefractorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};const _shadowMatrix=new Matrix4;class ShadowMesh extends Mesh{constructor(er){const tr=new MeshBasicMaterial({color:0,transparent:!0,opacity:.6,depthWrite:!1,stencilWrite:!0,stencilFunc:EqualStencilFunc,stencilRef:0,stencilZPass:IncrementStencilOp});super(er.geometry,tr),this.isShadowMesh=!0,this.meshMatrix=er.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1}update(er,tr){const rr=er.normal.x*tr.x+er.normal.y*tr.y+er.normal.z*tr.z+-er.constant*tr.w,nr=_shadowMatrix.elements;nr[0]=rr-tr.x*er.normal.x,nr[4]=-tr.x*er.normal.y,nr[8]=-tr.x*er.normal.z,nr[12]=-tr.x*-er.constant,nr[1]=-tr.y*er.normal.x,nr[5]=rr-tr.y*er.normal.y,nr[9]=-tr.y*er.normal.z,nr[13]=-tr.y*-er.constant,nr[2]=-tr.z*er.normal.x,nr[6]=-tr.z*er.normal.y,nr[10]=rr-tr.z*er.normal.z,nr[14]=-tr.z*-er.constant,nr[3]=-tr.w*er.normal.x,nr[7]=-tr.w*er.normal.y,nr[11]=-tr.w*er.normal.z,nr[15]=rr-tr.w*-er.constant,this.matrix.multiplyMatrices(_shadowMatrix,this.meshMatrix)}}class Sky extends Mesh{constructor(){const er=Sky.SkyShader,tr=new ShaderMaterial({name:er.name,uniforms:UniformsUtils.clone(er.uniforms),vertexShader:er.vertexShader,fragmentShader:er.fragmentShader,side:BackSide,depthWrite:!1});super(new BoxGeometry(1,1,1),tr),this.isSky=!0}}Sky.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Vector3$1},up:{value:new Vector3$1(0,1,0)}},vertexShader:`
		uniform vec3 sunPosition;
		uniform float rayleigh;
		uniform float turbidity;
		uniform float mieCoefficient;
		uniform vec3 up;

		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		// constants for atmospheric scattering
		const float e = 2.71828182845904523536028747135266249775724709369995957;
		const float pi = 3.141592653589793238462643383279502884197169;

		// wavelength of used primaries, according to preetham
		const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
		// this pre-calculation replaces older TotalRayleigh(vec3 lambda) function:
		// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
		const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

		// mie stuff
		// K coefficient for the primaries
		const float v = 4.0;
		const vec3 K = vec3( 0.686, 0.678, 0.666 );
		// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
		const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

		// earth shadow hack
		// cutoffAngle = pi / 1.95;
		const float cutoffAngle = 1.6110731556870734;
		const float steepness = 1.5;
		const float EE = 1000.0;

		float sunIntensity( float zenithAngleCos ) {
			zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
			return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
		}

		vec3 totalMie( float T ) {
			float c = ( 0.2 * T ) * 10E-18;
			return 0.434 * c * MieConst;
		}

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			gl_Position.z = gl_Position.w; // set z to camera.far

			vSunDirection = normalize( sunPosition );

			vSunE = sunIntensity( dot( vSunDirection, up ) );

			vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

			float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

			// extinction (absorption + out scattering)
			// rayleigh coefficients
			vBetaR = totalRayleigh * rayleighCoefficient;

			// mie coefficients
			vBetaM = totalMie( turbidity ) * mieCoefficient;

		}`,fragmentShader:`
		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		uniform float mieDirectionalG;
		uniform vec3 up;

		// constants for atmospheric scattering
		const float pi = 3.141592653589793238462643383279502884197169;

		const float n = 1.0003; // refractive index of air
		const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

		// optical length at zenith for molecules
		const float rayleighZenithLength = 8.4E3;
		const float mieZenithLength = 1.25E3;
		// 66 arc seconds -> degrees, and the cosine of that
		const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

		// 3.0 / ( 16.0 * pi )
		const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
		// 1.0 / ( 4.0 * pi )
		const float ONE_OVER_FOURPI = 0.07957747154594767;

		float rayleighPhase( float cosTheta ) {
			return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
		}

		float hgPhase( float cosTheta, float g ) {
			float g2 = pow( g, 2.0 );
			float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
			return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
		}

		void main() {

			vec3 direction = normalize( vWorldPosition - cameraPosition );

			// optical length
			// cutoff angle at 90 to avoid singularity in next formula.
			float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
			float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
			float sR = rayleighZenithLength * inverse;
			float sM = mieZenithLength * inverse;

			// combined extinction factor
			vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

			// in scattering
			float cosTheta = dot( direction, vSunDirection );

			float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
			vec3 betaRTheta = vBetaR * rPhase;

			float mPhase = hgPhase( cosTheta, mieDirectionalG );
			vec3 betaMTheta = vBetaM * mPhase;

			vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
			Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

			// nightsky
			float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
			float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
			vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
			vec3 L0 = vec3( 0.1 ) * Fex;

			// composition + solar disc
			float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
			L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

			vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

			vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

			gl_FragColor = vec4( retColor, 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};let Water$1=class extends Mesh{constructor(er,tr={}){super(er),this.isWater=!0;const rr=this,nr=tr.textureWidth!==void 0?tr.textureWidth:512,sr=tr.textureHeight!==void 0?tr.textureHeight:512,ar=tr.clipBias!==void 0?tr.clipBias:0,or=tr.alpha!==void 0?tr.alpha:1,lr=tr.time!==void 0?tr.time:0,cr=tr.waterNormals!==void 0?tr.waterNormals:null,hr=tr.sunDirection!==void 0?tr.sunDirection:new Vector3$1(.70707,.70707,0),fr=new Color(tr.sunColor!==void 0?tr.sunColor:16777215),ur=new Color(tr.waterColor!==void 0?tr.waterColor:8355711),pr=tr.eye!==void 0?tr.eye:new Vector3$1(0,0,0),gr=tr.distortionScale!==void 0?tr.distortionScale:20,_r=tr.side!==void 0?tr.side:FrontSide,mr=tr.fog!==void 0?tr.fog:!1,dr=new Plane,vr=new Vector3$1,Ar=new Vector3$1,yr=new Vector3$1,wr=new Matrix4,br=new Vector3$1(0,0,-1),Sr=new Vector4,xr=new Vector3$1,Cr=new Vector3$1,Ir=new Vector4,Rr=new Matrix4,Pr=new PerspectiveCamera,Fr=new WebGLRenderTarget(nr,sr),Nr={name:"MirrorShader",uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Matrix4},sunColor:{value:new Color(8355711)},sunDirection:{value:new Vector3$1(.70707,.70707,0)},eye:{value:new Vector3$1},waterColor:{value:new Color(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>
					#include <fog_fragment>	
				}`},Ur=new ShaderMaterial({name:Nr.name,uniforms:UniformsUtils.clone(Nr.uniforms),vertexShader:Nr.vertexShader,fragmentShader:Nr.fragmentShader,lights:!0,side:_r,fog:mr});Ur.uniforms.mirrorSampler.value=Fr.texture,Ur.uniforms.textureMatrix.value=Rr,Ur.uniforms.alpha.value=or,Ur.uniforms.time.value=lr,Ur.uniforms.normalSampler.value=cr,Ur.uniforms.sunColor.value=fr,Ur.uniforms.waterColor.value=ur,Ur.uniforms.sunDirection.value=hr,Ur.uniforms.distortionScale.value=gr,Ur.uniforms.eye.value=pr,rr.material=Ur,rr.onBeforeRender=function(Br,Or,Dr){if(Ar.setFromMatrixPosition(rr.matrixWorld),yr.setFromMatrixPosition(Dr.matrixWorld),wr.extractRotation(rr.matrixWorld),vr.set(0,0,1),vr.applyMatrix4(wr),xr.subVectors(Ar,yr),xr.dot(vr)>0)return;xr.reflect(vr).negate(),xr.add(Ar),wr.extractRotation(Dr.matrixWorld),br.set(0,0,-1),br.applyMatrix4(wr),br.add(yr),Cr.subVectors(Ar,br),Cr.reflect(vr).negate(),Cr.add(Ar),Pr.position.copy(xr),Pr.up.set(0,1,0),Pr.up.applyMatrix4(wr),Pr.up.reflect(vr),Pr.lookAt(Cr),Pr.far=Dr.far,Pr.updateMatrixWorld(),Pr.projectionMatrix.copy(Dr.projectionMatrix),Rr.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),Rr.multiply(Pr.projectionMatrix),Rr.multiply(Pr.matrixWorldInverse),dr.setFromNormalAndCoplanarPoint(vr,Ar),dr.applyMatrix4(Pr.matrixWorldInverse),Sr.set(dr.normal.x,dr.normal.y,dr.normal.z,dr.constant);const Wr=Pr.projectionMatrix;Ir.x=(Math.sign(Sr.x)+Wr.elements[8])/Wr.elements[0],Ir.y=(Math.sign(Sr.y)+Wr.elements[9])/Wr.elements[5],Ir.z=-1,Ir.w=(1+Wr.elements[10])/Wr.elements[14],Sr.multiplyScalar(2/Sr.dot(Ir)),Wr.elements[2]=Sr.x,Wr.elements[6]=Sr.y,Wr.elements[10]=Sr.z+1-ar,Wr.elements[14]=Sr.w,pr.setFromMatrixPosition(Dr.matrixWorld);const $r=Br.getRenderTarget(),Yr=Br.xr.enabled,Qi=Br.shadowMap.autoUpdate;rr.visible=!1,Br.xr.enabled=!1,Br.shadowMap.autoUpdate=!1,Br.setRenderTarget(Fr),Br.state.buffers.depth.setMask(!0),Br.autoClear===!1&&Br.clear(),Br.render(Or,Pr),rr.visible=!0,Br.xr.enabled=Yr,Br.shadowMap.autoUpdate=Qi,Br.setRenderTarget($r);const rs=Dr.viewport;rs!==void 0&&Br.state.viewport(rs)}}};class Water extends Mesh{constructor(er,tr={}){super(er),this.isWater=!0,this.type="Water";const rr=this,nr=tr.color!==void 0?new Color(tr.color):new Color(16777215),sr=tr.textureWidth!==void 0?tr.textureWidth:512,ar=tr.textureHeight!==void 0?tr.textureHeight:512,or=tr.clipBias!==void 0?tr.clipBias:0,lr=tr.flowDirection!==void 0?tr.flowDirection:new Vector2(1,0),cr=tr.flowSpeed!==void 0?tr.flowSpeed:.03,hr=tr.reflectivity!==void 0?tr.reflectivity:.02,fr=tr.scale!==void 0?tr.scale:1,ur=tr.shader!==void 0?tr.shader:Water.WaterShader,pr=new TextureLoader,gr=tr.flowMap||void 0,_r=tr.normalMap0||pr.load("textures/water/Water_1_M_Normal.jpg"),mr=tr.normalMap1||pr.load("textures/water/Water_2_M_Normal.jpg"),dr=.15,vr=dr*.5,Ar=new Matrix4,yr=new Clock;if(Reflector===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(Refractor===void 0){console.error("THREE.Water: Required component Refractor not found.");return}const wr=new Reflector(er,{textureWidth:sr,textureHeight:ar,clipBias:or}),br=new Refractor(er,{textureWidth:sr,textureHeight:ar,clipBias:or});wr.matrixAutoUpdate=!1,br.matrixAutoUpdate=!1,this.material=new ShaderMaterial({name:ur.name,uniforms:UniformsUtils.merge([UniformsLib.fog,ur.uniforms]),vertexShader:ur.vertexShader,fragmentShader:ur.fragmentShader,transparent:!0,fog:!0}),gr!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:gr}):this.material.uniforms.flowDirection={type:"v2",value:lr},_r.wrapS=_r.wrapT=RepeatWrapping,mr.wrapS=mr.wrapT=RepeatWrapping,this.material.uniforms.tReflectionMap.value=wr.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=br.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=_r,this.material.uniforms.tNormalMap1.value=mr,this.material.uniforms.color.value=nr,this.material.uniforms.reflectivity.value=hr,this.material.uniforms.textureMatrix.value=Ar,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=vr,this.material.uniforms.config.value.z=vr,this.material.uniforms.config.value.w=fr;function Sr(Cr){Ar.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),Ar.multiply(Cr.projectionMatrix),Ar.multiply(Cr.matrixWorldInverse),Ar.multiply(rr.matrixWorld)}function xr(){const Cr=yr.getDelta(),Ir=rr.material.uniforms.config;Ir.value.x+=cr*Cr,Ir.value.y=Ir.value.x+vr,Ir.value.x>=dr?(Ir.value.x=0,Ir.value.y=vr):Ir.value.y>=dr&&(Ir.value.y=Ir.value.y-dr)}this.onBeforeRender=function(Cr,Ir,Rr){Sr(Rr),xr(),rr.visible=!1,wr.matrixWorld.copy(rr.matrixWorld),br.matrixWorld.copy(rr.matrixWorld),wr.onBeforeRender(Cr,Ir,Rr),br.onBeforeRender(Cr,Ir,Rr),rr.visible=!0}}}Water.WaterShader={name:"WaterShader",uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new Vector4}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>

		}`};async function AmmoPhysics(){if(!("Ammo"in window)){console.error("AmmoPhysics: Couldn't find Ammo.js");return}const ir=await Ammo(),er=60,tr=new ir.btDefaultCollisionConfiguration,rr=new ir.btCollisionDispatcher(tr),nr=new ir.btDbvtBroadphase,sr=new ir.btSequentialImpulseConstraintSolver,ar=new ir.btDiscreteDynamicsWorld(rr,nr,sr,tr);ar.setGravity(new ir.btVector3(0,-9.8,0));const or=new ir.btTransform;function lr(vr){const Ar=vr.parameters;if(vr.type==="BoxGeometry"){const yr=Ar.width!==void 0?Ar.width/2:.5,wr=Ar.height!==void 0?Ar.height/2:.5,br=Ar.depth!==void 0?Ar.depth/2:.5,Sr=new ir.btBoxShape(new ir.btVector3(yr,wr,br));return Sr.setMargin(.05),Sr}else if(vr.type==="SphereGeometry"||vr.type==="IcosahedronGeometry"){const yr=Ar.radius!==void 0?Ar.radius:1,wr=new ir.btSphereShape(yr);return wr.setMargin(.05),wr}return null}const cr=[],hr=new WeakMap;function fr(vr){vr.traverse(function(Ar){if(Ar.isMesh){const yr=Ar.userData.physics;yr&&ur(Ar,yr.mass)}})}function ur(vr,Ar=0){const yr=lr(vr.geometry);yr!==null&&(vr.isInstancedMesh?gr(vr,Ar,yr):vr.isMesh&&pr(vr,Ar,yr))}function pr(vr,Ar,yr){const wr=vr.position,br=vr.quaternion,Sr=new ir.btTransform;Sr.setIdentity(),Sr.setOrigin(new ir.btVector3(wr.x,wr.y,wr.z)),Sr.setRotation(new ir.btQuaternion(br.x,br.y,br.z,br.w));const xr=new ir.btDefaultMotionState(Sr),Cr=new ir.btVector3(0,0,0);yr.calculateLocalInertia(Ar,Cr);const Ir=new ir.btRigidBodyConstructionInfo(Ar,xr,yr,Cr),Rr=new ir.btRigidBody(Ir);ar.addRigidBody(Rr),Ar>0&&(cr.push(vr),hr.set(vr,Rr))}function gr(vr,Ar,yr){const wr=vr.instanceMatrix.array,br=[];for(let Sr=0;Sr<vr.count;Sr++){const xr=Sr*16,Cr=new ir.btTransform;Cr.setFromOpenGLMatrix(wr.slice(xr,xr+16));const Ir=new ir.btDefaultMotionState(Cr),Rr=new ir.btVector3(0,0,0);yr.calculateLocalInertia(Ar,Rr);const Pr=new ir.btRigidBodyConstructionInfo(Ar,Ir,yr,Rr),Fr=new ir.btRigidBody(Pr);ar.addRigidBody(Fr),br.push(Fr)}Ar>0&&(cr.push(vr),hr.set(vr,br))}function _r(vr,Ar,yr=0){if(vr.isInstancedMesh){const br=hr.get(vr)[yr];br.setAngularVelocity(new ir.btVector3(0,0,0)),br.setLinearVelocity(new ir.btVector3(0,0,0)),or.setIdentity(),or.setOrigin(new ir.btVector3(Ar.x,Ar.y,Ar.z)),br.setWorldTransform(or)}else if(vr.isMesh){const wr=hr.get(vr);wr.setAngularVelocity(new ir.btVector3(0,0,0)),wr.setLinearVelocity(new ir.btVector3(0,0,0)),or.setIdentity(),or.setOrigin(new ir.btVector3(Ar.x,Ar.y,Ar.z)),wr.setWorldTransform(or)}}let mr=0;function dr(){const vr=performance.now();if(mr>0){const Ar=(vr-mr)/1e3;ar.stepSimulation(Ar,10);for(let yr=0,wr=cr.length;yr<wr;yr++){const br=cr[yr];if(br.isInstancedMesh){const Sr=br.instanceMatrix.array,xr=hr.get(br);for(let Cr=0;Cr<xr.length;Cr++){xr[Cr].getMotionState().getWorldTransform(or);const Pr=or.getOrigin(),Fr=or.getRotation();compose(Pr,Fr,Sr,Cr*16)}br.instanceMatrix.needsUpdate=!0,br.computeBoundingSphere()}else if(br.isMesh){hr.get(br).getMotionState().getWorldTransform(or);const Cr=or.getOrigin(),Ir=or.getRotation();br.position.set(Cr.x(),Cr.y(),Cr.z()),br.quaternion.set(Ir.x(),Ir.y(),Ir.z(),Ir.w())}}}mr=vr}return setInterval(dr,1e3/er),{addScene:fr,addMesh:ur,setMeshPosition:_r}}function compose(ir,er,tr,rr){const nr=er.x(),sr=er.y(),ar=er.z(),or=er.w(),lr=nr+nr,cr=sr+sr,hr=ar+ar,fr=nr*lr,ur=nr*cr,pr=nr*hr,gr=sr*cr,_r=sr*hr,mr=ar*hr,dr=or*lr,vr=or*cr,Ar=or*hr;tr[rr+0]=1-(gr+mr),tr[rr+1]=ur+Ar,tr[rr+2]=pr-vr,tr[rr+3]=0,tr[rr+4]=ur-Ar,tr[rr+5]=1-(fr+mr),tr[rr+6]=_r+dr,tr[rr+7]=0,tr[rr+8]=pr+vr,tr[rr+9]=_r-dr,tr[rr+10]=1-(fr+gr),tr[rr+11]=0,tr[rr+12]=ir.x(),tr[rr+13]=ir.y(),tr[rr+14]=ir.z(),tr[rr+15]=1}const scriptRel="modulepreload",assetsURL=function(ir){return"/cloth-button/"+ir},seen={},__vitePreload=function ir(er,tr,rr){let nr=Promise.resolve();if(tr&&tr.length>0){const ar=document.getElementsByTagName("link"),or=document.querySelector("meta[property=csp-nonce]"),lr=or?.nonce||or?.getAttribute("nonce");nr=Promise.allSettled(tr.map(cr=>{if(cr=assetsURL(cr,rr),cr in seen)return;seen[cr]=!0;const hr=cr.endsWith(".css"),fr=hr?'[rel="stylesheet"]':"";if(!!rr)for(let gr=ar.length-1;gr>=0;gr--){const _r=ar[gr];if(_r.href===cr&&(!hr||_r.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${cr}"]${fr}`))return;const pr=document.createElement("link");if(pr.rel=hr?"stylesheet":scriptRel,hr||(pr.as="script"),pr.crossOrigin="",pr.href=cr,lr&&pr.setAttribute("nonce",lr),document.head.appendChild(pr),hr)return new Promise((gr,_r)=>{pr.addEventListener("load",gr),pr.addEventListener("error",()=>_r(new Error(`Unable to preload CSS for ${cr}`)))})}))}function sr(ar){const or=new Event("vite:preloadError",{cancelable:!0});if(or.payload=ar,window.dispatchEvent(or),!or.defaultPrevented)throw ar}return nr.then(ar=>{for(const or of ar||[])or.status==="rejected"&&sr(or.reason);return er().catch(sr)})},RAPIER_PATH="https://cdn.skypack.dev/@dimforge/rapier3d-compat@0.12.0",frameRate=60,_scale$1=new Vector3$1(1,1,1),ZERO=new Vector3$1;let RAPIER=null;function getShape(ir){const er=ir.parameters;if(ir.type==="BoxGeometry"){const tr=er.width!==void 0?er.width/2:.5,rr=er.height!==void 0?er.height/2:.5,nr=er.depth!==void 0?er.depth/2:.5;return RAPIER.ColliderDesc.cuboid(tr,rr,nr)}else if(ir.type==="SphereGeometry"||ir.type==="IcosahedronGeometry"){const tr=er.radius!==void 0?er.radius:1;return RAPIER.ColliderDesc.ball(tr)}else if(ir.type==="BufferGeometry"){const tr=[],rr=new Vector3$1,nr=ir.getAttribute("position");for(let ar=0;ar<nr.count;ar++)rr.fromBufferAttribute(nr,ar),tr.push(rr.x,rr.y,rr.z);const sr=ir.getIndex()===null?Uint32Array.from(Array(parseInt(tr.length/3)).keys()):ir.getIndex().array;return RAPIER.ColliderDesc.trimesh(tr,sr)}return null}async function RapierPhysics(){RAPIER===null&&(RAPIER=await __vitePreload(()=>import(`${RAPIER_PATH}`),[]),await RAPIER.init());const ir=new Vector3$1(0,-9.81,0),er=new RAPIER.World(ir),tr=[],rr=new WeakMap,nr=new Vector3$1,sr=new Quaternion$1,ar=new Matrix4;function or(_r){_r.traverse(function(mr){if(mr.isMesh){const dr=mr.userData.physics;dr&&lr(mr,dr.mass,dr.restitution)}})}function lr(_r,mr=0,dr=0){const vr=getShape(_r.geometry);if(vr===null)return;vr.setMass(mr),vr.setRestitution(dr);const Ar=_r.isInstancedMesh?cr(_r,mr,vr):hr(_r.position,_r.quaternion,mr,vr);mr>0&&(tr.push(_r),rr.set(_r,Ar))}function cr(_r,mr,dr){const vr=_r.instanceMatrix.array,Ar=[];for(let yr=0;yr<_r.count;yr++){const wr=nr.fromArray(vr,yr*16+12);Ar.push(hr(wr,null,mr,dr))}return Ar}function hr(_r,mr,dr,vr){const Ar=dr>0?RAPIER.RigidBodyDesc.dynamic():RAPIER.RigidBodyDesc.fixed();Ar.setTranslation(..._r),mr!==null&&Ar.setRotation(mr);const yr=er.createRigidBody(Ar);return er.createCollider(vr,yr),yr}function fr(_r,mr,dr=0){let vr=rr.get(_r);_r.isInstancedMesh&&(vr=vr[dr]),vr.setAngvel(ZERO),vr.setLinvel(ZERO),vr.setTranslation(mr)}function ur(_r,mr,dr=0){let vr=rr.get(_r);_r.isInstancedMesh&&(vr=vr[dr]),vr.setLinvel(mr)}const pr=new Clock;function gr(){er.timestep=pr.getDelta(),er.step();for(let _r=0,mr=tr.length;_r<mr;_r++){const dr=tr[_r];if(dr.isInstancedMesh){const vr=dr.instanceMatrix.array,Ar=rr.get(dr);for(let yr=0;yr<Ar.length;yr++){const wr=Ar[yr],br=wr.translation();sr.copy(wr.rotation()),ar.compose(br,sr,_scale$1).toArray(vr,yr*16)}dr.instanceMatrix.needsUpdate=!0,dr.computeBoundingSphere()}else{const vr=rr.get(dr);dr.position.copy(vr.translation()),dr.quaternion.copy(vr.rotation())}}}return setInterval(gr,1e3/frameRate),{addScene:or,addMesh:lr,setMeshPosition:fr,setMeshVelocity:ur}}const CopyShader={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`},AfterimageShader={name:"AfterimageShader",uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float damp;

		uniform sampler2D tOld;
		uniform sampler2D tNew;

		varying vec2 vUv;

		vec4 when_gt( vec4 x, float y ) {

			return max( sign( x - y ), 0.0 );

		}

		void main() {

			vec4 texelOld = texture2D( tOld, vUv );
			vec4 texelNew = texture2D( tNew, vUv );

			texelOld *= damp * when_gt( texelOld, 0.1 );

			gl_FragColor = max(texelNew, texelOld);

		}`};class AfterimagePass extends Pass{constructor(er=.96){super(),this.shader=AfterimageShader,this.uniforms=UniformsUtils.clone(this.shader.uniforms),this.uniforms.damp.value=er,this.textureComp=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{magFilter:NearestFilter,type:HalfFloatType}),this.textureOld=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{magFilter:NearestFilter,type:HalfFloatType}),this.compFsMaterial=new ShaderMaterial({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new FullScreenQuad(this.compFsMaterial);const tr=CopyShader;this.copyFsMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(tr.uniforms),vertexShader:tr.vertexShader,fragmentShader:tr.fragmentShader,blending:NoBlending,depthTest:!1,depthWrite:!1}),this.copyFsQuad=new FullScreenQuad(this.copyFsMaterial)}render(er,tr,rr){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=rr.texture,er.setRenderTarget(this.textureComp),this.compFsQuad.render(er),this.copyFsQuad.material.uniforms.tDiffuse.value=this.textureComp.texture,this.renderToScreen?(er.setRenderTarget(null),this.copyFsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.copyFsQuad.render(er));const nr=this.textureOld;this.textureOld=this.textureComp,this.textureComp=nr}setSize(er,tr){this.textureComp.setSize(er,tr),this.textureOld.setSize(er,tr)}dispose(){this.textureComp.dispose(),this.textureOld.dispose(),this.compFsMaterial.dispose(),this.copyFsMaterial.dispose(),this.compFsQuad.dispose(),this.copyFsQuad.dispose()}}const ConvolutionShader={name:"ConvolutionShader",defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:`

		uniform vec2 uImageIncrement;

		varying vec2 vUv;

		void main() {

			vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float cKernel[ KERNEL_SIZE_INT ];

		uniform sampler2D tDiffuse;
		uniform vec2 uImageIncrement;

		varying vec2 vUv;

		void main() {

			vec2 imageCoord = vUv;
			vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );

			for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {

				sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];
				imageCoord += uImageIncrement;

			}

			gl_FragColor = sum;

		}`,buildKernel:function(ir){let tr=2*Math.ceil(ir*3)+1;tr>25&&(tr=25);const rr=(tr-1)*.5,nr=new Array(tr);let sr=0;for(let ar=0;ar<tr;++ar)nr[ar]=gauss(ar-rr,ir),sr+=nr[ar];for(let ar=0;ar<tr;++ar)nr[ar]/=sr;return nr}};function gauss(ir,er){return Math.exp(-(ir*ir)/(2*er*er))}class BloomPass extends Pass{constructor(er=1,tr=25,rr=4){super(),this.renderTargetX=new WebGLRenderTarget(1,1,{type:HalfFloatType}),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new WebGLRenderTarget(1,1,{type:HalfFloatType}),this.renderTargetY.texture.name="BloomPass.y",this.combineUniforms=UniformsUtils.clone(CombineShader.uniforms),this.combineUniforms.strength.value=er,this.materialCombine=new ShaderMaterial({name:CombineShader.name,uniforms:this.combineUniforms,vertexShader:CombineShader.vertexShader,fragmentShader:CombineShader.fragmentShader,blending:AdditiveBlending,transparent:!0});const nr=ConvolutionShader;this.convolutionUniforms=UniformsUtils.clone(nr.uniforms),this.convolutionUniforms.uImageIncrement.value=BloomPass.blurX,this.convolutionUniforms.cKernel.value=ConvolutionShader.buildKernel(rr),this.materialConvolution=new ShaderMaterial({name:nr.name,uniforms:this.convolutionUniforms,vertexShader:nr.vertexShader,fragmentShader:nr.fragmentShader,defines:{KERNEL_SIZE_FLOAT:tr.toFixed(1),KERNEL_SIZE_INT:tr.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new FullScreenQuad(null)}render(er,tr,rr,nr,sr){sr&&er.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=rr.texture,this.convolutionUniforms.uImageIncrement.value=BloomPass.blurX,er.setRenderTarget(this.renderTargetX),er.clear(),this.fsQuad.render(er),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=BloomPass.blurY,er.setRenderTarget(this.renderTargetY),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.materialCombine,this.combineUniforms.tDiffuse.value=this.renderTargetY.texture,sr&&er.state.buffers.stencil.setTest(!0),er.setRenderTarget(rr),this.clear&&er.clear(),this.fsQuad.render(er)}setSize(er,tr){this.renderTargetX.setSize(er,tr),this.renderTargetY.setSize(er,tr)}dispose(){this.renderTargetX.dispose(),this.renderTargetY.dispose(),this.materialCombine.dispose(),this.materialConvolution.dispose(),this.fsQuad.dispose()}}const CombineShader={name:"CombineShader",uniforms:{tDiffuse:{value:null},strength:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float strength;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = strength * texel;

		}`};BloomPass.blurX=new Vector2(.001953125,0);BloomPass.blurY=new Vector2(0,.001953125);const BokehShader$1={name:"BokehShader",defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		varying vec2 vUv;

		uniform sampler2D tColor;
		uniform sampler2D tDepth;

		uniform float maxblur; // max blur amount
		uniform float aperture; // aperture - bigger values for shallower depth of field

		uniform float nearClip;
		uniform float farClip;

		uniform float focus;
		uniform float aspect;

		#include <packing>

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, nearClip, farClip );
			#else
			return orthographicDepthToViewZ( depth, nearClip, farClip );
			#endif
		}


		void main() {

			vec2 aspectcorrect = vec2( 1.0, aspect );

			float viewZ = getViewZ( getDepth( vUv ) );

			float factor = ( focus + viewZ ); // viewZ is <= 0, so this is a difference equation

			vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );

			vec2 dofblur9 = dofblur * 0.9;
			vec2 dofblur7 = dofblur * 0.7;
			vec2 dofblur4 = dofblur * 0.4;

			vec4 col = vec4( 0.0 );

			col += texture2D( tColor, vUv.xy );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );

			gl_FragColor = col / 41.0;
			gl_FragColor.a = 1.0;

		}`};class BokehPass extends Pass{constructor(er,tr,rr){super(),this.scene=er,this.camera=tr;const nr=rr.focus!==void 0?rr.focus:1,sr=rr.aperture!==void 0?rr.aperture:.025,ar=rr.maxblur!==void 0?rr.maxblur:1;this.renderTargetDepth=new WebGLRenderTarget(1,1,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new MeshDepthMaterial,this.materialDepth.depthPacking=RGBADepthPacking,this.materialDepth.blending=NoBlending;const or=BokehShader$1,lr=UniformsUtils.clone(or.uniforms);lr.tDepth.value=this.renderTargetDepth.texture,lr.focus.value=nr,lr.aspect.value=tr.aspect,lr.aperture.value=sr,lr.maxblur.value=ar,lr.nearClip.value=tr.near,lr.farClip.value=tr.far,this.materialBokeh=new ShaderMaterial({defines:Object.assign({},or.defines),uniforms:lr,vertexShader:or.vertexShader,fragmentShader:or.fragmentShader}),this.uniforms=lr,this.fsQuad=new FullScreenQuad(this.materialBokeh),this._oldClearColor=new Color}render(er,tr,rr){this.scene.overrideMaterial=this.materialDepth,er.getClearColor(this._oldClearColor);const nr=er.getClearAlpha(),sr=er.autoClear;er.autoClear=!1,er.setClearColor(16777215),er.setClearAlpha(1),er.setRenderTarget(this.renderTargetDepth),er.clear(),er.render(this.scene,this.camera),this.uniforms.tColor.value=rr.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),er.clear(),this.fsQuad.render(er)),this.scene.overrideMaterial=null,er.setClearColor(this._oldClearColor),er.setClearAlpha(nr),er.autoClear=sr}setSize(er,tr){this.materialBokeh.uniforms.aspect.value=er/tr,this.renderTargetDepth.setSize(er,tr)}dispose(){this.renderTargetDepth.dispose(),this.materialDepth.dispose(),this.materialBokeh.dispose(),this.fsQuad.dispose()}}class ClearPass extends Pass{constructor(er,tr){super(),this.needsSwap=!1,this.clearColor=er!==void 0?er:0,this.clearAlpha=tr!==void 0?tr:0,this._oldClearColor=new Color}render(er,tr,rr){let nr;this.clearColor&&(er.getClearColor(this._oldClearColor),nr=er.getClearAlpha(),er.setClearColor(this.clearColor,this.clearAlpha)),er.setRenderTarget(this.renderToScreen?null:rr),er.clear(),this.clearColor&&er.setClearColor(this._oldClearColor,nr)}}class CubeTexturePass extends Pass{constructor(er,tr,rr=1){super(),this.camera=er,this.needsSwap=!1,this.cubeShader=ShaderLib.cube,this.cubeMesh=new Mesh(new BoxGeometry(10,10,10),new ShaderMaterial({uniforms:UniformsUtils.clone(this.cubeShader.uniforms),vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:BackSide})),Object.defineProperty(this.cubeMesh.material,"envMap",{get:function(){return this.uniforms.tCube.value}}),this.tCube=tr,this.opacity=rr,this.cubeScene=new Scene,this.cubeCamera=new PerspectiveCamera,this.cubeScene.add(this.cubeMesh)}render(er,tr,rr){const nr=er.autoClear;er.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.tCube.value=this.tCube,this.cubeMesh.material.uniforms.tFlip.value=this.tCube.isCubeTexture&&this.tCube.isRenderTargetTexture===!1?-1:1,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,er.setRenderTarget(this.renderToScreen?null:rr),this.clear&&er.clear(),er.render(this.cubeScene,this.cubeCamera),er.autoClear=nr}dispose(){this.cubeMesh.geometry.dispose(),this.cubeMesh.material.dispose()}}const DotScreenShader={name:"DotScreenShader",uniforms:{tDiffuse:{value:null},tSize:{value:new Vector2(256,256)},center:{value:new Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec2 center;
		uniform float angle;
		uniform float scale;
		uniform vec2 tSize;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		float pattern() {

			float s = sin( angle ), c = cos( angle );

			vec2 tex = vUv * tSize - center;
			vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;

			return ( sin( point.x ) * sin( point.y ) ) * 4.0;

		}

		void main() {

			vec4 color = texture2D( tDiffuse, vUv );

			float average = ( color.r + color.g + color.b ) / 3.0;

			gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );

		}`};class DotScreenPass extends Pass{constructor(er,tr,rr){super();const nr=DotScreenShader;this.uniforms=UniformsUtils.clone(nr.uniforms),er!==void 0&&this.uniforms.center.value.copy(er),tr!==void 0&&(this.uniforms.angle.value=tr),rr!==void 0&&(this.uniforms.scale.value=rr),this.material=new ShaderMaterial({name:nr.name,uniforms:this.uniforms,vertexShader:nr.vertexShader,fragmentShader:nr.fragmentShader}),this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,rr){this.uniforms.tDiffuse.value=rr.texture,this.uniforms.tSize.value.set(rr.width,rr.height),this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class ShaderPass extends Pass{constructor(er,tr){super(),this.textureID=tr!==void 0?tr:"tDiffuse",er instanceof ShaderMaterial?(this.uniforms=er.uniforms,this.material=er):er&&(this.uniforms=UniformsUtils.clone(er.uniforms),this.material=new ShaderMaterial({name:er.name!==void 0?er.name:"unspecified",defines:Object.assign({},er.defines),uniforms:this.uniforms,vertexShader:er.vertexShader,fragmentShader:er.fragmentShader})),this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,rr){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=rr.texture),this.fsQuad.material=this.material,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(er.autoClearColor,er.autoClearDepth,er.autoClearStencil),this.fsQuad.render(er))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class MaskPass extends Pass{constructor(er,tr){super(),this.scene=er,this.camera=tr,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(er,tr,rr){const nr=er.getContext(),sr=er.state;sr.buffers.color.setMask(!1),sr.buffers.depth.setMask(!1),sr.buffers.color.setLocked(!0),sr.buffers.depth.setLocked(!0);let ar,or;this.inverse?(ar=0,or=1):(ar=1,or=0),sr.buffers.stencil.setTest(!0),sr.buffers.stencil.setOp(nr.REPLACE,nr.REPLACE,nr.REPLACE),sr.buffers.stencil.setFunc(nr.ALWAYS,ar,4294967295),sr.buffers.stencil.setClear(or),sr.buffers.stencil.setLocked(!0),er.setRenderTarget(rr),this.clear&&er.clear(),er.render(this.scene,this.camera),er.setRenderTarget(tr),this.clear&&er.clear(),er.render(this.scene,this.camera),sr.buffers.color.setLocked(!1),sr.buffers.depth.setLocked(!1),sr.buffers.color.setMask(!0),sr.buffers.depth.setMask(!0),sr.buffers.stencil.setLocked(!1),sr.buffers.stencil.setFunc(nr.EQUAL,1,4294967295),sr.buffers.stencil.setOp(nr.KEEP,nr.KEEP,nr.KEEP),sr.buffers.stencil.setLocked(!0)}}class ClearMaskPass extends Pass{constructor(){super(),this.needsSwap=!1}render(er){er.state.buffers.stencil.setLocked(!1),er.state.buffers.stencil.setTest(!1)}}class EffectComposer{constructor(er,tr){if(this.renderer=er,this._pixelRatio=er.getPixelRatio(),tr===void 0){const rr=er.getSize(new Vector2);this._width=rr.width,this._height=rr.height,tr=new WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:HalfFloatType}),tr.texture.name="EffectComposer.rt1"}else this._width=tr.width,this._height=tr.height;this.renderTarget1=tr,this.renderTarget2=tr.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ShaderPass(CopyShader),this.copyPass.material.blending=NoBlending,this.clock=new Clock}swapBuffers(){const er=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=er}addPass(er){this.passes.push(er),er.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(er,tr){this.passes.splice(tr,0,er),er.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(er){const tr=this.passes.indexOf(er);tr!==-1&&this.passes.splice(tr,1)}isLastEnabledPass(er){for(let tr=er+1;tr<this.passes.length;tr++)if(this.passes[tr].enabled)return!1;return!0}render(er){er===void 0&&(er=this.clock.getDelta());const tr=this.renderer.getRenderTarget();let rr=!1;for(let nr=0,sr=this.passes.length;nr<sr;nr++){const ar=this.passes[nr];if(ar.enabled!==!1){if(ar.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(nr),ar.render(this.renderer,this.writeBuffer,this.readBuffer,er,rr),ar.needsSwap){if(rr){const or=this.renderer.getContext(),lr=this.renderer.state.buffers.stencil;lr.setFunc(or.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,er),lr.setFunc(or.EQUAL,1,4294967295)}this.swapBuffers()}MaskPass!==void 0&&(ar instanceof MaskPass?rr=!0:ar instanceof ClearMaskPass&&(rr=!1))}}this.renderer.setRenderTarget(tr)}reset(er){if(er===void 0){const tr=this.renderer.getSize(new Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=tr.width,this._height=tr.height,er=this.renderTarget1.clone(),er.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=er,this.renderTarget2=er.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(er,tr){this._width=er,this._height=tr;const rr=this._width*this._pixelRatio,nr=this._height*this._pixelRatio;this.renderTarget1.setSize(rr,nr),this.renderTarget2.setSize(rr,nr);for(let sr=0;sr<this.passes.length;sr++)this.passes[sr].setSize(rr,nr)}setPixelRatio(er){this._pixelRatio=er,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}const FilmShader={name:"FilmShader",uniforms:{tDiffuse:{value:null},time:{value:0},intensity:{value:.5},grayscale:{value:!1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		uniform float intensity;
		uniform bool grayscale;
		uniform float time;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 base = texture2D( tDiffuse, vUv );

			float noise = rand( fract( vUv + time ) );

			vec3 color = base.rgb + base.rgb * clamp( 0.1 + noise, 0.0, 1.0 );

			color = mix( base.rgb, color, intensity );

			if ( grayscale ) {

				color = vec3( luminance( color ) ); // assuming linear-srgb

			}

			gl_FragColor = vec4( color, base.a );

		}`};class FilmPass extends Pass{constructor(er=.5,tr=!1){super();const rr=FilmShader;this.uniforms=UniformsUtils.clone(rr.uniforms),this.material=new ShaderMaterial({name:rr.name,uniforms:this.uniforms,vertexShader:rr.vertexShader,fragmentShader:rr.fragmentShader}),this.uniforms.intensity.value=er,this.uniforms.grayscale.value=tr,this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,rr,nr){this.uniforms.tDiffuse.value=rr.texture,this.uniforms.time.value+=nr,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:`

		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		uniform int byp; //should we apply the glitch ?

		uniform sampler2D tDiffuse;
		uniform sampler2D tDisp;

		uniform float amount;
		uniform float angle;
		uniform float seed;
		uniform float seed_x;
		uniform float seed_y;
		uniform float distortion_x;
		uniform float distortion_y;
		uniform float col_s;

		varying vec2 vUv;


		float rand(vec2 co){
			return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
		}

		void main() {
			if(byp<1) {
				vec2 p = vUv;
				float xs = floor(gl_FragCoord.x / 0.5);
				float ys = floor(gl_FragCoord.y / 0.5);
				//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch
				float disp = texture2D(tDisp, p*seed*seed).r;
				if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {
					if(seed_x>0.){
						p.y = 1. - (p.y + distortion_y);
					}
					else {
						p.y = distortion_y;
					}
				}
				if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {
					if(seed_y>0.){
						p.x=distortion_x;
					}
					else {
						p.x = 1. - (p.x + distortion_x);
					}
				}
				p.x+=disp*seed_x*(seed/5.);
				p.y+=disp*seed_y*(seed/5.);
				//base from RGB shift shader
				vec2 offset = amount * vec2( cos(angle), sin(angle));
				vec4 cr = texture2D(tDiffuse, p + offset);
				vec4 cga = texture2D(tDiffuse, p);
				vec4 cb = texture2D(tDiffuse, p - offset);
				gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);
				//add noise
				vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);
				gl_FragColor = gl_FragColor+ snow;
			}
			else {
				gl_FragColor=texture2D (tDiffuse, vUv);
			}
		}`};class GlitchPass extends Pass{constructor(er=64){super();const tr=DigitalGlitch;this.uniforms=UniformsUtils.clone(tr.uniforms),this.heightMap=this.generateHeightmap(er),this.uniforms.tDisp.value=this.heightMap,this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:tr.vertexShader,fragmentShader:tr.fragmentShader}),this.fsQuad=new FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(er,tr,rr){this.uniforms.tDiffuse.value=rr.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||this.goWild==!0?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=MathUtils.randFloat(-1,1),this.uniforms.seed_y.value=MathUtils.randFloat(-1,1),this.uniforms.distortion_x.value=MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=MathUtils.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=MathUtils.randFloat(0,1),this.uniforms.seed_x.value=MathUtils.randFloat(-.3,.3),this.uniforms.seed_y.value=MathUtils.randFloat(-.3,.3)):this.goWild==!1&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}generateTrigger(){this.randX=MathUtils.randInt(120,240)}generateHeightmap(er){const tr=new Float32Array(er*er),rr=er*er;for(let sr=0;sr<rr;sr++){const ar=MathUtils.randFloat(0,1);tr[sr]=ar}const nr=new DataTexture(tr,er,er,RedFormat,FloatType);return nr.needsUpdate=!0,nr}dispose(){this.material.dispose(),this.heightMap.dispose(),this.fsQuad.dispose()}}const GTAOShader={name:"GTAOShader",defines:{PERSPECTIVE_CAMERA:1,SAMPLES:16,NORMAL_VECTOR_TYPE:1,DEPTH_SWIZZLING:"x",SCREEN_SPACE_RADIUS:0,SCREEN_SPACE_RADIUS_SCALE:100,SCENE_CLIP_BOX:0},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},resolution:{value:new Vector2},cameraNear:{value:null},cameraFar:{value:null},cameraProjectionMatrix:{value:new Matrix4},cameraProjectionMatrixInverse:{value:new Matrix4},cameraWorldMatrix:{value:new Matrix4},radius:{value:.25},distanceExponent:{value:1},thickness:{value:1},distanceFallOff:{value:1},scale:{value:1},sceneBoxMin:{value:new Vector3$1(-1,-1,-1)},sceneBoxMax:{value:new Vector3$1(1,1,1)}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		varying vec2 vUv;
		uniform highp sampler2D tNormal;
		uniform highp sampler2D tDepth;
		uniform sampler2D tNoise;
		uniform vec2 resolution;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraProjectionMatrixInverse;		
		uniform mat4 cameraWorldMatrix;
		uniform float radius;
		uniform float distanceExponent;
		uniform float thickness;
		uniform float distanceFallOff;
		uniform float scale;
		#if SCENE_CLIP_BOX == 1
			uniform vec3 sceneBoxMin;
			uniform vec3 sceneBoxMax;
		#endif
		
		#include <common>
		#include <packing>

		#ifndef FRAGMENT_OUTPUT
		#define FRAGMENT_OUTPUT vec4(vec3(ao), 1.)
		#endif

		vec3 getViewPosition(const in vec2 screenPosition, const in float depth) {
			vec4 clipSpacePosition = vec4(vec3(screenPosition, depth) * 2.0 - 1.0, 1.0);
			vec4 viewSpacePosition = cameraProjectionMatrixInverse * clipSpacePosition;
			return viewSpacePosition.xyz / viewSpacePosition.w;
		}

		float getDepth(const vec2 uv) {  
			return textureLod(tDepth, uv.xy, 0.0).DEPTH_SWIZZLING;
		}

		float fetchDepth(const ivec2 uv) {   
			return texelFetch(tDepth, uv.xy, 0).DEPTH_SWIZZLING;
		}

		float getViewZ(const in float depth) {
			#if PERSPECTIVE_CAMERA == 1
				return perspectiveDepthToViewZ(depth, cameraNear, cameraFar);
			#else
				return orthographicDepthToViewZ(depth, cameraNear, cameraFar);
			#endif
		}

		vec3 computeNormalFromDepth(const vec2 uv) {
			vec2 size = vec2(textureSize(tDepth, 0));
			ivec2 p = ivec2(uv * size);
			float c0 = fetchDepth(p);
			float l2 = fetchDepth(p - ivec2(2, 0));
			float l1 = fetchDepth(p - ivec2(1, 0));
			float r1 = fetchDepth(p + ivec2(1, 0));
			float r2 = fetchDepth(p + ivec2(2, 0));
			float b2 = fetchDepth(p - ivec2(0, 2));
			float b1 = fetchDepth(p - ivec2(0, 1));
			float t1 = fetchDepth(p + ivec2(0, 1));
			float t2 = fetchDepth(p + ivec2(0, 2));
			float dl = abs((2.0 * l1 - l2) - c0);
			float dr = abs((2.0 * r1 - r2) - c0);
			float db = abs((2.0 * b1 - b2) - c0);
			float dt = abs((2.0 * t1 - t2) - c0);
			vec3 ce = getViewPosition(uv, c0).xyz;
			vec3 dpdx = (dl < dr) ? ce - getViewPosition((uv - vec2(1.0 / size.x, 0.0)), l1).xyz : -ce + getViewPosition((uv + vec2(1.0 / size.x, 0.0)), r1).xyz;
			vec3 dpdy = (db < dt) ? ce - getViewPosition((uv - vec2(0.0, 1.0 / size.y)), b1).xyz : -ce + getViewPosition((uv + vec2(0.0, 1.0 / size.y)), t1).xyz;
			return normalize(cross(dpdx, dpdy));
		}

		vec3 getViewNormal(const vec2 uv) {
			#if NORMAL_VECTOR_TYPE == 2
				return normalize(textureLod(tNormal, uv, 0.).rgb);
			#elif NORMAL_VECTOR_TYPE == 1
				return unpackRGBToNormal(textureLod(tNormal, uv, 0.).rgb);
			#else
				return computeNormalFromDepth(uv);
			#endif
		}

		vec3 getSceneUvAndDepth(vec3 sampleViewPos) {
			vec4 sampleClipPos = cameraProjectionMatrix * vec4(sampleViewPos, 1.);
			vec2 sampleUv = sampleClipPos.xy / sampleClipPos.w * 0.5 + 0.5;
			float sampleSceneDepth = getDepth(sampleUv);
			return vec3(sampleUv, sampleSceneDepth);
		}
		
		void main() {
			float depth = getDepth(vUv.xy);
			if (depth >= 1.0) {
				discard;
				return;
			}
			vec3 viewPos = getViewPosition(vUv, depth);
			vec3 viewNormal = getViewNormal(vUv);

			float radiusToUse = radius;
			float distanceFalloffToUse = thickness;
			#if SCREEN_SPACE_RADIUS == 1
				float radiusScale = getViewPosition(vec2(0.5 + float(SCREEN_SPACE_RADIUS_SCALE) / resolution.x, 0.0), depth).x;
				radiusToUse *= radiusScale;
				distanceFalloffToUse *= radiusScale;
			#endif

			#if SCENE_CLIP_BOX == 1
				vec3 worldPos = (cameraWorldMatrix * vec4(viewPos, 1.0)).xyz;
				float boxDistance = length(max(vec3(0.0), max(sceneBoxMin - worldPos, worldPos - sceneBoxMax)));
				if (boxDistance > radiusToUse) {
					discard;
					return;
				}
			#endif
			
			vec2 noiseResolution = vec2(textureSize(tNoise, 0));
			vec2 noiseUv = vUv * resolution / noiseResolution;
			vec4 noiseTexel = textureLod(tNoise, noiseUv, 0.0);
			vec3 randomVec = noiseTexel.xyz * 2.0 - 1.0;
			vec3 tangent = normalize(vec3(randomVec.xy, 0.));
			vec3 bitangent = vec3(-tangent.y, tangent.x, 0.);
			mat3 kernelMatrix = mat3(tangent, bitangent, vec3(0., 0., 1.));

			const int DIRECTIONS = SAMPLES < 30 ? 3 : 5;
			const int STEPS = (SAMPLES + DIRECTIONS - 1) / DIRECTIONS;
			float ao = 0.0;
			for (int i = 0; i < DIRECTIONS; ++i) {
				
				float angle = float(i) / float(DIRECTIONS) * PI;
				vec4 sampleDir = vec4(cos(angle), sin(angle), 0., 0.5 + 0.5 * noiseTexel.w); 
				sampleDir.xyz = normalize(kernelMatrix * sampleDir.xyz);

				vec3 viewDir = normalize(-viewPos.xyz);
				vec3 sliceBitangent = normalize(cross(sampleDir.xyz, viewDir));
				vec3 sliceTangent = cross(sliceBitangent, viewDir);
				vec3 normalInSlice = normalize(viewNormal - sliceBitangent * dot(viewNormal, sliceBitangent));
				
				vec3 tangentToNormalInSlice = cross(normalInSlice, sliceBitangent);
				vec2 cosHorizons = vec2(dot(viewDir, tangentToNormalInSlice), dot(viewDir, -tangentToNormalInSlice));
				
				for (int j = 0; j < STEPS; ++j) {
					vec3 sampleViewOffset = sampleDir.xyz * radiusToUse * sampleDir.w * pow(float(j + 1) / float(STEPS), distanceExponent);	

					vec3 sampleSceneUvDepth = getSceneUvAndDepth(viewPos + sampleViewOffset);
					vec3 sampleSceneViewPos = getViewPosition(sampleSceneUvDepth.xy, sampleSceneUvDepth.z);
					vec3 viewDelta = sampleSceneViewPos - viewPos;
					if (abs(viewDelta.z) < thickness) {
						float sampleCosHorizon = dot(viewDir, normalize(viewDelta));
						cosHorizons.x += max(0., (sampleCosHorizon - cosHorizons.x) * mix(1., 2. / float(j + 2), distanceFallOff));
					}		

					sampleSceneUvDepth = getSceneUvAndDepth(viewPos - sampleViewOffset);
					sampleSceneViewPos = getViewPosition(sampleSceneUvDepth.xy, sampleSceneUvDepth.z);
					viewDelta = sampleSceneViewPos - viewPos;
					if (abs(viewDelta.z) < thickness) {
						float sampleCosHorizon = dot(viewDir, normalize(viewDelta));
						cosHorizons.y += max(0., (sampleCosHorizon - cosHorizons.y) * mix(1., 2. / float(j + 2), distanceFallOff));
					}
				}

				vec2 sinHorizons = sqrt(1. - cosHorizons * cosHorizons);
				float nx = dot(normalInSlice, sliceTangent);
				float ny = dot(normalInSlice, viewDir);
				float nxb = 1. / 2. * (acos(cosHorizons.y) - acos(cosHorizons.x) + sinHorizons.x * cosHorizons.x - sinHorizons.y * cosHorizons.y);
				float nyb = 1. / 2. * (2. - cosHorizons.x * cosHorizons.x - cosHorizons.y * cosHorizons.y);
				float occlusion = nx * nxb + ny * nyb;
				ao += occlusion;
			}

			ao = clamp(ao / float(DIRECTIONS), 0., 1.);		
		#if SCENE_CLIP_BOX == 1
			ao = mix(ao, 1., smoothstep(0., radiusToUse, boxDistance));
		#endif
			ao = pow(ao, scale);

			gl_FragColor = FRAGMENT_OUTPUT;
		}`},GTAODepthShader={name:"GTAODepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`
		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform sampler2D tDepth;
		uniform float cameraNear;
		uniform float cameraFar;
		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 screenPosition ) {
			#if PERSPECTIVE_CAMERA == 1
				float fragCoordZ = texture2D( tDepth, screenPosition ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );
			#else
				return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		void main() {
			float depth = getLinearDepth( vUv );
			gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );

		}`},GTAOBlendShader={name:"GTAOBlendShader",uniforms:{tDiffuse:{value:null},intensity:{value:1}},vertexShader:`
		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform float intensity;
		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		void main() {
			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = vec4(mix(vec3(1.), texel.rgb, intensity), texel.a);
		}`};function generateMagicSquareNoise(ir=5){const er=Math.floor(ir)%2===0?Math.floor(ir)+1:Math.floor(ir),tr=generateMagicSquare(er),rr=tr.length,nr=new Uint8Array(rr*4);for(let ar=0;ar<rr;++ar){const or=tr[ar],lr=2*Math.PI*or/rr,cr=new Vector3$1(Math.cos(lr),Math.sin(lr),0).normalize();nr[ar*4]=(cr.x*.5+.5)*255,nr[ar*4+1]=(cr.y*.5+.5)*255,nr[ar*4+2]=127,nr[ar*4+3]=255}const sr=new DataTexture(nr,er,er);return sr.wrapS=RepeatWrapping,sr.wrapT=RepeatWrapping,sr.needsUpdate=!0,sr}function generateMagicSquare(ir){const er=Math.floor(ir)%2===0?Math.floor(ir)+1:Math.floor(ir),tr=er*er,rr=Array(tr).fill(0);let nr=Math.floor(er/2),sr=er-1;for(let ar=1;ar<=tr;){if(nr===-1&&sr===er?(sr=er-2,nr=0):(sr===er&&(sr=0),nr<0&&(nr=er-1)),rr[nr*er+sr]!==0){sr-=2,nr++;continue}else rr[nr*er+sr]=ar++;sr++,nr--}return rr}const PoissonDenoiseShader={name:"PoissonDenoiseShader",defines:{SAMPLES:16,SAMPLE_VECTORS:generatePdSamplePointInitializer(16,2,1),NORMAL_VECTOR_TYPE:1,DEPTH_VALUE_SOURCE:0},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},resolution:{value:new Vector2},cameraProjectionMatrixInverse:{value:new Matrix4},lumaPhi:{value:5},depthPhi:{value:5},normalPhi:{value:5},radius:{value:4},index:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		varying vec2 vUv;

		uniform sampler2D tDiffuse;
		uniform sampler2D tNormal;
		uniform sampler2D tDepth;
		uniform sampler2D tNoise;
		uniform vec2 resolution;
		uniform mat4 cameraProjectionMatrixInverse;
		uniform float lumaPhi;
		uniform float depthPhi;
		uniform float normalPhi;
		uniform float radius;
		uniform int index;
		
		#include <common>
		#include <packing>

		#ifndef SAMPLE_LUMINANCE
		#define SAMPLE_LUMINANCE dot(vec3(0.2125, 0.7154, 0.0721), a)
		#endif

		#ifndef FRAGMENT_OUTPUT
		#define FRAGMENT_OUTPUT vec4(denoised, 1.)
		#endif

		float getLuminance(const in vec3 a) {
			return SAMPLE_LUMINANCE;
		}

		const vec3 poissonDisk[SAMPLES] = SAMPLE_VECTORS;

		vec3 getViewPosition(const in vec2 screenPosition, const in float depth) {
			vec4 clipSpacePosition = vec4(vec3(screenPosition, depth) * 2.0 - 1.0, 1.0);
			vec4 viewSpacePosition = cameraProjectionMatrixInverse * clipSpacePosition;
			return viewSpacePosition.xyz / viewSpacePosition.w;
		}
		
		float getDepth(const vec2 uv) {
		#if DEPTH_VALUE_SOURCE == 1    
			return textureLod(tDepth, uv.xy, 0.0).a;
		#else
			return textureLod(tDepth, uv.xy, 0.0).r;
		#endif
		}

		float fetchDepth(const ivec2 uv) {
			#if DEPTH_VALUE_SOURCE == 1    
				return texelFetch(tDepth, uv.xy, 0).a;
			#else
				return texelFetch(tDepth, uv.xy, 0).r;
			#endif
		}

		vec3 computeNormalFromDepth(const vec2 uv) {
			vec2 size = vec2(textureSize(tDepth, 0));
			ivec2 p = ivec2(uv * size);
			float c0 = fetchDepth(p);
			float l2 = fetchDepth(p - ivec2(2, 0));
			float l1 = fetchDepth(p - ivec2(1, 0));
			float r1 = fetchDepth(p + ivec2(1, 0));
			float r2 = fetchDepth(p + ivec2(2, 0));
			float b2 = fetchDepth(p - ivec2(0, 2));
			float b1 = fetchDepth(p - ivec2(0, 1));
			float t1 = fetchDepth(p + ivec2(0, 1));
			float t2 = fetchDepth(p + ivec2(0, 2));
			float dl = abs((2.0 * l1 - l2) - c0);
			float dr = abs((2.0 * r1 - r2) - c0);
			float db = abs((2.0 * b1 - b2) - c0);
			float dt = abs((2.0 * t1 - t2) - c0);
			vec3 ce = getViewPosition(uv, c0).xyz;
			vec3 dpdx = (dl < dr) ?  ce - getViewPosition((uv - vec2(1.0 / size.x, 0.0)), l1).xyz
									: -ce + getViewPosition((uv + vec2(1.0 / size.x, 0.0)), r1).xyz;
			vec3 dpdy = (db < dt) ?  ce - getViewPosition((uv - vec2(0.0, 1.0 / size.y)), b1).xyz
									: -ce + getViewPosition((uv + vec2(0.0, 1.0 / size.y)), t1).xyz;
			return normalize(cross(dpdx, dpdy));
		}

		vec3 getViewNormal(const vec2 uv) {
		#if NORMAL_VECTOR_TYPE == 2
			return normalize(textureLod(tNormal, uv, 0.).rgb);
		#elif NORMAL_VECTOR_TYPE == 1
			return unpackRGBToNormal(textureLod(tNormal, uv, 0.).rgb);
		#else
			return computeNormalFromDepth(uv);
		#endif
		}

		void denoiseSample(in vec3 center, in vec3 viewNormal, in vec3 viewPos, in vec2 sampleUv, inout vec3 denoised, inout float totalWeight) {
			vec4 sampleTexel = textureLod(tDiffuse, sampleUv, 0.0);
			float sampleDepth = getDepth(sampleUv);
			vec3 sampleNormal = getViewNormal(sampleUv);
			vec3 neighborColor = sampleTexel.rgb;
			vec3 viewPosSample = getViewPosition(sampleUv, sampleDepth);
			
			float normalDiff = dot(viewNormal, sampleNormal);
			float normalSimilarity = pow(max(normalDiff, 0.), normalPhi);
			float lumaDiff = abs(getLuminance(neighborColor) - getLuminance(center));
			float lumaSimilarity = max(1.0 - lumaDiff / lumaPhi, 0.0);
			float depthDiff = abs(dot(viewPos - viewPosSample, viewNormal));
			float depthSimilarity = max(1. - depthDiff / depthPhi, 0.);
			float w = lumaSimilarity * depthSimilarity * normalSimilarity;
		
			denoised += w * neighborColor;
			totalWeight += w;
		}
		
		void main() {
			float depth = getDepth(vUv.xy);	
			vec3 viewNormal = getViewNormal(vUv);	
			if (depth == 1. || dot(viewNormal, viewNormal) == 0.) {
				discard;
				return;
			}
			vec4 texel = textureLod(tDiffuse, vUv, 0.0);
			vec3 center = texel.rgb;
			vec3 viewPos = getViewPosition(vUv, depth);

			vec2 noiseResolution = vec2(textureSize(tNoise, 0));
			vec2 noiseUv = vUv * resolution / noiseResolution;
			vec4 noiseTexel = textureLod(tNoise, noiseUv, 0.0);
      		vec2 noiseVec = vec2(sin(noiseTexel[index % 4] * 2. * PI), cos(noiseTexel[index % 4] * 2. * PI));
    		mat2 rotationMatrix = mat2(noiseVec.x, -noiseVec.y, noiseVec.x, noiseVec.y);
		
			float totalWeight = 1.0;
			vec3 denoised = texel.rgb;
			for (int i = 0; i < SAMPLES; i++) {
				vec3 sampleDir = poissonDisk[i];
				vec2 offset = rotationMatrix * (sampleDir.xy * (1. + sampleDir.z * (radius - 1.)) / resolution);
				vec2 sampleUv = vUv + offset;
				denoiseSample(center, viewNormal, viewPos, sampleUv, denoised, totalWeight);
			}
		
			if (totalWeight > 0.) { 
				denoised /= totalWeight;
			}
			gl_FragColor = FRAGMENT_OUTPUT;
		}`};function generatePdSamplePointInitializer(ir,er,tr){const rr=generateDenoiseSamples(ir,er,tr);let nr="vec3[SAMPLES](";for(let sr=0;sr<ir;sr++){const ar=rr[sr];nr+=`vec3(${ar.x}, ${ar.y}, ${ar.z})${sr<ir-1?",":")"}`}return nr}function generateDenoiseSamples(ir,er,tr){const rr=[];for(let nr=0;nr<ir;nr++){const sr=2*Math.PI*er*nr/ir,ar=Math.pow(nr/(ir-1),tr);rr.push(new Vector3$1(Math.cos(sr),Math.sin(sr),ar))}return rr}class GTAOPass extends Pass{constructor(er,tr,rr,nr,sr,ar,or){super(),this.width=rr!==void 0?rr:512,this.height=nr!==void 0?nr:512,this.clear=!0,this.camera=tr,this.scene=er,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=generateMagicSquareNoise(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new WebGLRenderTarget(this.width,this.height,{type:HalfFloatType}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new ShaderMaterial({defines:Object.assign({},GTAOShader.defines),uniforms:UniformsUtils.clone(GTAOShader.uniforms),vertexShader:GTAOShader.vertexShader,fragmentShader:GTAOShader.fragmentShader,blending:NoBlending,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.pdMaterial=new ShaderMaterial({defines:Object.assign({},PoissonDenoiseShader.defines),uniforms:UniformsUtils.clone(PoissonDenoiseShader.uniforms),vertexShader:PoissonDenoiseShader.vertexShader,fragmentShader:PoissonDenoiseShader.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new ShaderMaterial({defines:Object.assign({},GTAODepthShader.defines),uniforms:UniformsUtils.clone(GTAODepthShader.uniforms),vertexShader:GTAODepthShader.vertexShader,fragmentShader:GTAODepthShader.fragmentShader,blending:NoBlending}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:DstColorFactor,blendDst:ZeroFactor,blendEquation:AddEquation,blendSrcAlpha:DstAlphaFactor,blendDstAlpha:ZeroFactor,blendEquationAlpha:AddEquation}),this.blendMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(GTAOBlendShader.uniforms),vertexShader:GTAOBlendShader.vertexShader,fragmentShader:GTAOBlendShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:CustomBlending,blendSrc:DstColorFactor,blendDst:ZeroFactor,blendEquation:AddEquation,blendSrcAlpha:DstAlphaFactor,blendDstAlpha:ZeroFactor,blendEquationAlpha:AddEquation}),this.fsQuad=new FullScreenQuad(null),this.originalClearColor=new Color,this.setGBuffer(sr?sr.depthTexture:void 0,sr?sr.normalTexture:void 0),ar!==void 0&&this.updateGtaoMaterial(ar),or!==void 0&&this.updatePdMaterial(or)}dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(er,tr){er!==void 0?(this.depthTexture=er,this.normalTexture=tr,this._renderGBuffer=!1):(this.depthTexture=new DepthTexture,this.depthTexture.format=DepthStencilFormat,this.depthTexture.type=UnsignedInt248Type,this.normalRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);const rr=this.normalTexture?1:0,nr=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=rr,this.gtaoMaterial.defines.DEPTH_SWIZZLING=nr,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=rr,this.pdMaterial.defines.DEPTH_SWIZZLING=nr,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(er){er?(this.gtaoMaterial.needsUpdate=this.gtaoMaterial.defines.SCENE_CLIP_BOX!==1,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(er.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(er.max)):(this.gtaoMaterial.needsUpdate=this.gtaoMaterial.defines.SCENE_CLIP_BOX===0,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(er){er.radius!==void 0&&(this.gtaoMaterial.uniforms.radius.value=er.radius),er.distanceExponent!==void 0&&(this.gtaoMaterial.uniforms.distanceExponent.value=er.distanceExponent),er.thickness!==void 0&&(this.gtaoMaterial.uniforms.thickness.value=er.thickness),er.distanceFallOff!==void 0&&(this.gtaoMaterial.uniforms.distanceFallOff.value=er.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),er.scale!==void 0&&(this.gtaoMaterial.uniforms.scale.value=er.scale),er.samples!==void 0&&er.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=er.samples,this.gtaoMaterial.needsUpdate=!0),er.screenSpaceRadius!==void 0&&(er.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=er.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(er){let tr=!1;er.lumaPhi!==void 0&&(this.pdMaterial.uniforms.lumaPhi.value=er.lumaPhi),er.depthPhi!==void 0&&(this.pdMaterial.uniforms.depthPhi.value=er.depthPhi),er.normalPhi!==void 0&&(this.pdMaterial.uniforms.normalPhi.value=er.normalPhi),er.radius!==void 0&&er.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=er.radius),er.radiusExponent!==void 0&&er.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=er.radiusExponent,tr=!0),er.rings!==void 0&&er.rings!==this.pdRings&&(this.pdRings=er.rings,tr=!0),er.samples!==void 0&&er.samples!==this.pdSamples&&(this.pdSamples=er.samples,tr=!0),tr&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=generatePdSamplePointInitializer(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(er,tr,rr){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(er,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(er,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(er,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case GTAOPass.OUTPUT.Off:break;case GTAOPass.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=rr.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(er,this.depthRenderMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=rr.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(er,this.blendMaterial,this.renderToScreen?null:tr);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(er,tr,rr,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(rr),er.autoClear=!1,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.fsQuad.material=tr,this.fsQuad.render(er),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderOverride(er,tr,rr,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(rr),er.autoClear=!1,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.overrideMaterial=tr,er.render(this.scene,this.camera),this.scene.overrideMaterial=null,er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}setSize(er,tr){this.width=er,this.height=tr,this.gtaoRenderTarget.setSize(er,tr),this.normalRenderTarget.setSize(er,tr),this.pdRenderTarget.setSize(er,tr),this.gtaoMaterial.uniforms.resolution.value.set(er,tr),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(er,tr),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){const er=this.scene,tr=this._visibilityCache;er.traverse(function(rr){tr.set(rr,rr.visible),(rr.isPoints||rr.isLine)&&(rr.visible=!1)})}restoreVisibility(){const er=this.scene,tr=this._visibilityCache;er.traverse(function(rr){const nr=tr.get(rr);rr.visible=nr}),tr.clear()}generateNoise(er=64){const tr=new SimplexNoise,rr=er*er*4,nr=new Uint8Array(rr);for(let ar=0;ar<er;ar++)for(let or=0;or<er;or++){const lr=ar,cr=or;nr[(ar*er+or)*4]=(tr.noise(lr,cr)*.5+.5)*255,nr[(ar*er+or)*4+1]=(tr.noise(lr+er,cr)*.5+.5)*255,nr[(ar*er+or)*4+2]=(tr.noise(lr,cr+er)*.5+.5)*255,nr[(ar*er+or)*4+3]=(tr.noise(lr+er,cr+er)*.5+.5)*255}const sr=new DataTexture(nr,er,er,RGBAFormat,UnsignedByteType);return sr.wrapS=RepeatWrapping,sr.wrapT=RepeatWrapping,sr.needsUpdate=!0,sr}}GTAOPass.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5};const HalftoneShader={name:"HalftoneShader",uniforms:{tDiffuse:{value:null},shape:{value:1},radius:{value:4},rotateR:{value:Math.PI/12*1},rotateG:{value:Math.PI/12*2},rotateB:{value:Math.PI/12*3},scatter:{value:0},width:{value:1},height:{value:1},blending:{value:1},blendingMode:{value:1},greyscale:{value:!1},disable:{value:!1}},vertexShader:`

		varying vec2 vUV;

		void main() {

			vUV = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);

		}`,fragmentShader:`

		#define SQRT2_MINUS_ONE 0.41421356
		#define SQRT2_HALF_MINUS_ONE 0.20710678
		#define PI2 6.28318531
		#define SHAPE_DOT 1
		#define SHAPE_ELLIPSE 2
		#define SHAPE_LINE 3
		#define SHAPE_SQUARE 4
		#define BLENDING_LINEAR 1
		#define BLENDING_MULTIPLY 2
		#define BLENDING_ADD 3
		#define BLENDING_LIGHTER 4
		#define BLENDING_DARKER 5
		uniform sampler2D tDiffuse;
		uniform float radius;
		uniform float rotateR;
		uniform float rotateG;
		uniform float rotateB;
		uniform float scatter;
		uniform float width;
		uniform float height;
		uniform int shape;
		uniform bool disable;
		uniform float blending;
		uniform int blendingMode;
		varying vec2 vUV;
		uniform bool greyscale;
		const int samples = 8;

		float blend( float a, float b, float t ) {

		// linear blend
			return a * ( 1.0 - t ) + b * t;

		}

		float hypot( float x, float y ) {

		// vector magnitude
			return sqrt( x * x + y * y );

		}

		float rand( vec2 seed ){

		// get pseudo-random number
			return fract( sin( dot( seed.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );

		}

		float distanceToDotRadius( float channel, vec2 coord, vec2 normal, vec2 p, float angle, float rad_max ) {

		// apply shape-specific transforms
			float dist = hypot( coord.x - p.x, coord.y - p.y );
			float rad = channel;

			if ( shape == SHAPE_DOT ) {

				rad = pow( abs( rad ), 1.125 ) * rad_max;

			} else if ( shape == SHAPE_ELLIPSE ) {

				rad = pow( abs( rad ), 1.125 ) * rad_max;

				if ( dist != 0.0 ) {
					float dot_p = abs( ( p.x - coord.x ) / dist * normal.x + ( p.y - coord.y ) / dist * normal.y );
					dist = ( dist * ( 1.0 - SQRT2_HALF_MINUS_ONE ) ) + dot_p * dist * SQRT2_MINUS_ONE;
				}

			} else if ( shape == SHAPE_LINE ) {

				rad = pow( abs( rad ), 1.5) * rad_max;
				float dot_p = ( p.x - coord.x ) * normal.x + ( p.y - coord.y ) * normal.y;
				dist = hypot( normal.x * dot_p, normal.y * dot_p );

			} else if ( shape == SHAPE_SQUARE ) {

				float theta = atan( p.y - coord.y, p.x - coord.x ) - angle;
				float sin_t = abs( sin( theta ) );
				float cos_t = abs( cos( theta ) );
				rad = pow( abs( rad ), 1.4 );
				rad = rad_max * ( rad + ( ( sin_t > cos_t ) ? rad - sin_t * rad : rad - cos_t * rad ) );

			}

			return rad - dist;

		}

		struct Cell {

		// grid sample positions
			vec2 normal;
			vec2 p1;
			vec2 p2;
			vec2 p3;
			vec2 p4;
			float samp2;
			float samp1;
			float samp3;
			float samp4;

		};

		vec4 getSample( vec2 point ) {

		// multi-sampled point
			vec4 tex = texture2D( tDiffuse, vec2( point.x / width, point.y / height ) );
			float base = rand( vec2( floor( point.x ), floor( point.y ) ) ) * PI2;
			float step = PI2 / float( samples );
			float dist = radius * 0.66;

			for ( int i = 0; i < samples; ++i ) {

				float r = base + step * float( i );
				vec2 coord = point + vec2( cos( r ) * dist, sin( r ) * dist );
				tex += texture2D( tDiffuse, vec2( coord.x / width, coord.y / height ) );

			}

			tex /= float( samples ) + 1.0;
			return tex;

		}

		float getDotColour( Cell c, vec2 p, int channel, float angle, float aa ) {

		// get colour for given point
			float dist_c_1, dist_c_2, dist_c_3, dist_c_4, res;

			if ( channel == 0 ) {

				c.samp1 = getSample( c.p1 ).r;
				c.samp2 = getSample( c.p2 ).r;
				c.samp3 = getSample( c.p3 ).r;
				c.samp4 = getSample( c.p4 ).r;

			} else if (channel == 1) {

				c.samp1 = getSample( c.p1 ).g;
				c.samp2 = getSample( c.p2 ).g;
				c.samp3 = getSample( c.p3 ).g;
				c.samp4 = getSample( c.p4 ).g;

			} else {

				c.samp1 = getSample( c.p1 ).b;
				c.samp3 = getSample( c.p3 ).b;
				c.samp2 = getSample( c.p2 ).b;
				c.samp4 = getSample( c.p4 ).b;

			}

			dist_c_1 = distanceToDotRadius( c.samp1, c.p1, c.normal, p, angle, radius );
			dist_c_2 = distanceToDotRadius( c.samp2, c.p2, c.normal, p, angle, radius );
			dist_c_3 = distanceToDotRadius( c.samp3, c.p3, c.normal, p, angle, radius );
			dist_c_4 = distanceToDotRadius( c.samp4, c.p4, c.normal, p, angle, radius );
			res = ( dist_c_1 > 0.0 ) ? clamp( dist_c_1 / aa, 0.0, 1.0 ) : 0.0;
			res += ( dist_c_2 > 0.0 ) ? clamp( dist_c_2 / aa, 0.0, 1.0 ) : 0.0;
			res += ( dist_c_3 > 0.0 ) ? clamp( dist_c_3 / aa, 0.0, 1.0 ) : 0.0;
			res += ( dist_c_4 > 0.0 ) ? clamp( dist_c_4 / aa, 0.0, 1.0 ) : 0.0;
			res = clamp( res, 0.0, 1.0 );

			return res;

		}

		Cell getReferenceCell( vec2 p, vec2 origin, float grid_angle, float step ) {

		// get containing cell
			Cell c;

		// calc grid
			vec2 n = vec2( cos( grid_angle ), sin( grid_angle ) );
			float threshold = step * 0.5;
			float dot_normal = n.x * ( p.x - origin.x ) + n.y * ( p.y - origin.y );
			float dot_line = -n.y * ( p.x - origin.x ) + n.x * ( p.y - origin.y );
			vec2 offset = vec2( n.x * dot_normal, n.y * dot_normal );
			float offset_normal = mod( hypot( offset.x, offset.y ), step );
			float normal_dir = ( dot_normal < 0.0 ) ? 1.0 : -1.0;
			float normal_scale = ( ( offset_normal < threshold ) ? -offset_normal : step - offset_normal ) * normal_dir;
			float offset_line = mod( hypot( ( p.x - offset.x ) - origin.x, ( p.y - offset.y ) - origin.y ), step );
			float line_dir = ( dot_line < 0.0 ) ? 1.0 : -1.0;
			float line_scale = ( ( offset_line < threshold ) ? -offset_line : step - offset_line ) * line_dir;

		// get closest corner
			c.normal = n;
			c.p1.x = p.x - n.x * normal_scale + n.y * line_scale;
			c.p1.y = p.y - n.y * normal_scale - n.x * line_scale;

		// scatter
			if ( scatter != 0.0 ) {

				float off_mag = scatter * threshold * 0.5;
				float off_angle = rand( vec2( floor( c.p1.x ), floor( c.p1.y ) ) ) * PI2;
				c.p1.x += cos( off_angle ) * off_mag;
				c.p1.y += sin( off_angle ) * off_mag;

			}

		// find corners
			float normal_step = normal_dir * ( ( offset_normal < threshold ) ? step : -step );
			float line_step = line_dir * ( ( offset_line < threshold ) ? step : -step );
			c.p2.x = c.p1.x - n.x * normal_step;
			c.p2.y = c.p1.y - n.y * normal_step;
			c.p3.x = c.p1.x + n.y * line_step;
			c.p3.y = c.p1.y - n.x * line_step;
			c.p4.x = c.p1.x - n.x * normal_step + n.y * line_step;
			c.p4.y = c.p1.y - n.y * normal_step - n.x * line_step;

			return c;

		}

		float blendColour( float a, float b, float t ) {

		// blend colours
			if ( blendingMode == BLENDING_LINEAR ) {
				return blend( a, b, 1.0 - t );
			} else if ( blendingMode == BLENDING_ADD ) {
				return blend( a, min( 1.0, a + b ), t );
			} else if ( blendingMode == BLENDING_MULTIPLY ) {
				return blend( a, max( 0.0, a * b ), t );
			} else if ( blendingMode == BLENDING_LIGHTER ) {
				return blend( a, max( a, b ), t );
			} else if ( blendingMode == BLENDING_DARKER ) {
				return blend( a, min( a, b ), t );
			} else {
				return blend( a, b, 1.0 - t );
			}

		}

		void main() {

			if ( ! disable ) {

		// setup
				vec2 p = vec2( vUV.x * width, vUV.y * height );
				vec2 origin = vec2( 0, 0 );
				float aa = ( radius < 2.5 ) ? radius * 0.5 : 1.25;

		// get channel samples
				Cell cell_r = getReferenceCell( p, origin, rotateR, radius );
				Cell cell_g = getReferenceCell( p, origin, rotateG, radius );
				Cell cell_b = getReferenceCell( p, origin, rotateB, radius );
				float r = getDotColour( cell_r, p, 0, rotateR, aa );
				float g = getDotColour( cell_g, p, 1, rotateG, aa );
				float b = getDotColour( cell_b, p, 2, rotateB, aa );

		// blend with original
				vec4 colour = texture2D( tDiffuse, vUV );
				r = blendColour( r, colour.r, blending );
				g = blendColour( g, colour.g, blending );
				b = blendColour( b, colour.b, blending );

				if ( greyscale ) {
					r = g = b = (r + b + g) / 3.0;
				}

				gl_FragColor = vec4( r, g, b, 1.0 );

			} else {

				gl_FragColor = texture2D( tDiffuse, vUV );

			}

		}`};class HalftonePass extends Pass{constructor(er,tr,rr){super(),this.uniforms=UniformsUtils.clone(HalftoneShader.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,fragmentShader:HalftoneShader.fragmentShader,vertexShader:HalftoneShader.vertexShader}),this.uniforms.width.value=er,this.uniforms.height.value=tr;for(const nr in rr)rr.hasOwnProperty(nr)&&this.uniforms.hasOwnProperty(nr)&&(this.uniforms[nr].value=rr[nr]);this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,rr){this.material.uniforms.tDiffuse.value=rr.texture,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}setSize(er,tr){this.uniforms.width.value=er,this.uniforms.height.value=tr}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const LUTShader={name:"LUTShader",uniforms:{lut:{value:null},lutSize:{value:0},tDiffuse:{value:null},intensity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform float lutSize;
		uniform sampler3D lut;

		varying vec2 vUv;
		uniform float intensity;
		uniform sampler2D tDiffuse;
		void main() {

			vec4 val = texture2D( tDiffuse, vUv );
			vec4 lutVal;

			// pull the sample in by half a pixel so the sample begins
			// at the center of the edge pixels.
			float pixelWidth = 1.0 / lutSize;
			float halfPixelWidth = 0.5 / lutSize;
			vec3 uvw = vec3( halfPixelWidth ) + val.rgb * ( 1.0 - pixelWidth );


			lutVal = vec4( texture( lut, uvw ).rgb, val.a );

			gl_FragColor = vec4( mix( val, lutVal, intensity ) );

		}

	`};class LUTPass extends ShaderPass{set lut(er){const tr=this.material;er!==this.lut&&(tr.uniforms.lut.value=null,er&&(tr.uniforms.lutSize.value=er.image.width,tr.uniforms.lut.value=er))}get lut(){return this.material.uniforms.lut.value}set intensity(er){this.material.uniforms.intensity.value=er}get intensity(){return this.material.uniforms.intensity.value}constructor(er={}){super(LUTShader),this.lut=er.lut||null,this.intensity="intensity"in er?er.intensity:1}}class OutlinePass extends Pass{constructor(er,tr,rr,nr){super(),this.renderScene=tr,this.renderCamera=rr,this.selectedObjects=nr!==void 0?nr:[],this.visibleEdgeColor=new Color(1,1,1),this.hiddenEdgeColor=new Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this._selectionCache=new Set,this.resolution=er!==void 0?new Vector2(er.x,er.y):new Vector2(256,256);const sr=Math.round(this.resolution.x/this.downSampleRatio),ar=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new MeshDepthMaterial,this.depthMaterial.side=DoubleSide,this.depthMaterial.depthPacking=RGBADepthPacking,this.depthMaterial.blending=NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=DoubleSide,this.prepareMaskMaterial.fragmentShader=hr(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{type:HalfFloatType}),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new WebGLRenderTarget(sr,ar,{type:HalfFloatType}),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new WebGLRenderTarget(sr,ar,{type:HalfFloatType}),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new WebGLRenderTarget(Math.round(sr/2),Math.round(ar/2),{type:HalfFloatType}),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new WebGLRenderTarget(sr,ar,{type:HalfFloatType}),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new WebGLRenderTarget(Math.round(sr/2),Math.round(ar/2),{type:HalfFloatType}),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const or=4,lr=4;this.separableBlurMaterial1=this.getSeparableBlurMaterial(or),this.separableBlurMaterial1.uniforms.texSize.value.set(sr,ar),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeparableBlurMaterial(lr),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(sr/2),Math.round(ar/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=lr,this.overlayMaterial=this.getOverlayMaterial();const cr=CopyShader;this.copyUniforms=UniformsUtils.clone(cr.uniforms),this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:cr.vertexShader,fragmentShader:cr.fragmentShader,blending:NoBlending,depthTest:!1,depthWrite:!1}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Color,this.oldClearAlpha=1,this.fsQuad=new FullScreenQuad(null),this.tempPulseColor1=new Color,this.tempPulseColor2=new Color,this.textureMatrix=new Matrix4;function hr(fr,ur){const pr=ur.isPerspectiveCamera?"perspective":"orthographic";return fr.replace(/DEPTH_TO_VIEW_Z/g,pr+"DepthToViewZ")}}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(er,tr){this.renderTargetMaskBuffer.setSize(er,tr),this.renderTargetDepthBuffer.setSize(er,tr);let rr=Math.round(er/this.downSampleRatio),nr=Math.round(tr/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(rr,nr),this.renderTargetBlurBuffer1.setSize(rr,nr),this.renderTargetEdgeBuffer1.setSize(rr,nr),this.separableBlurMaterial1.uniforms.texSize.value.set(rr,nr),rr=Math.round(rr/2),nr=Math.round(nr/2),this.renderTargetBlurBuffer2.setSize(rr,nr),this.renderTargetEdgeBuffer2.setSize(rr,nr),this.separableBlurMaterial2.uniforms.texSize.value.set(rr,nr)}updateSelectionCache(){const er=this._selectionCache;function tr(rr){rr.isMesh&&er.add(rr)}er.clear();for(let rr=0;rr<this.selectedObjects.length;rr++)this.selectedObjects[rr].traverse(tr)}changeVisibilityOfSelectedObjects(er){const tr=this._visibilityCache;for(const rr of this._selectionCache)er===!0?rr.visible=tr.get(rr):(tr.set(rr,rr.visible),rr.visible=er)}changeVisibilityOfNonSelectedObjects(er){const tr=this._visibilityCache,rr=this._selectionCache;function nr(sr){if(sr.isMesh||sr.isSprite){if(!rr.has(sr)){const ar=sr.visible;(er===!1||tr.get(sr)===!0)&&(sr.visible=er),tr.set(sr,ar)}}else(sr.isPoints||sr.isLine)&&(er===!0?sr.visible=tr.get(sr):(tr.set(sr,sr.visible),sr.visible=er))}this.renderScene.traverse(nr)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(er,tr,rr,nr,sr){if(this.selectedObjects.length>0){er.getClearColor(this._oldClearColor),this.oldClearAlpha=er.getClearAlpha();const ar=er.autoClear;er.autoClear=!1,sr&&er.state.buffers.stencil.setTest(!1),er.setClearColor(16777215,1),this.updateSelectionCache(),this.changeVisibilityOfSelectedObjects(!1);const or=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,er.setRenderTarget(this.renderTargetDepthBuffer),er.clear(),er.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,er.setRenderTarget(this.renderTargetMaskBuffer),er.clear(),er.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this._selectionCache.clear(),this.renderScene.background=or,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,er.setRenderTarget(this.renderTargetMaskDownSampleBuffer),er.clear(),this.fsQuad.render(er),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const lr=.625+Math.cos(performance.now()*.01/this.pulsePeriod)*.75/2;this.tempPulseColor1.multiplyScalar(lr),this.tempPulseColor2.multiplyScalar(lr)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,er.setRenderTarget(this.renderTargetEdgeBuffer1),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,er.setRenderTarget(this.renderTargetBlurBuffer1),er.clear(),this.fsQuad.render(er),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionY,er.setRenderTarget(this.renderTargetEdgeBuffer1),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionX,er.setRenderTarget(this.renderTargetBlurBuffer2),er.clear(),this.fsQuad.render(er),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionY,er.setRenderTarget(this.renderTargetEdgeBuffer2),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,sr&&er.state.buffers.stencil.setTest(!0),er.setRenderTarget(rr),this.fsQuad.render(er),er.setClearColor(this._oldClearColor,this.oldClearAlpha),er.autoClear=ar}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=rr.texture,er.setRenderTarget(null),this.fsQuad.render(er))}getPrepareMaskMaterial(){return new ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif

					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new Vector2(.5,.5)},visibleEdgeColor:{value:new Vector3$1(1,1,1)},hiddenEdgeColor:{value:new Vector3$1(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeparableBlurMaterial(er){return new ShaderMaterial({defines:{MAX_RADIUS:er},uniforms:{colorTexture:{value:null},texSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}OutlinePass.BlurDirectionX=new Vector2(1,0);OutlinePass.BlurDirectionY=new Vector2(0,1);const OutputShader={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#elif defined( CUSTOM_TONE_MAPPING )

				gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class OutputPass extends Pass{constructor(){super();const er=OutputShader;this.uniforms=UniformsUtils.clone(er.uniforms),this.material=new RawShaderMaterial({name:er.name,uniforms:this.uniforms,vertexShader:er.vertexShader,fragmentShader:er.fragmentShader}),this.fsQuad=new FullScreenQuad(this.material),this._outputColorSpace=null,this._toneMapping=null}render(er,tr,rr){this.uniforms.tDiffuse.value=rr.texture,this.uniforms.toneMappingExposure.value=er.toneMappingExposure,(this._outputColorSpace!==er.outputColorSpace||this._toneMapping!==er.toneMapping)&&(this._outputColorSpace=er.outputColorSpace,this._toneMapping=er.toneMapping,this.material.defines={},ColorManagement.getTransfer(this._outputColorSpace)===SRGBTransfer&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===LinearToneMapping?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===ReinhardToneMapping?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===CineonToneMapping?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===ACESFilmicToneMapping?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===AgXToneMapping?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===NeutralToneMapping?this.material.defines.NEUTRAL_TONE_MAPPING="":this._toneMapping===CustomToneMapping&&(this.material.defines.CUSTOM_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(er.autoClearColor,er.autoClearDepth,er.autoClearStencil),this.fsQuad.render(er))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class RenderPass extends Pass{constructor(er,tr,rr=null,nr=null,sr=null){super(),this.scene=er,this.camera=tr,this.overrideMaterial=rr,this.clearColor=nr,this.clearAlpha=sr,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Color}render(er,tr,rr){const nr=er.autoClear;er.autoClear=!1;let sr,ar;this.overrideMaterial!==null&&(ar=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(er.getClearColor(this._oldClearColor),er.setClearColor(this.clearColor,er.getClearAlpha())),this.clearAlpha!==null&&(sr=er.getClearAlpha(),er.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&er.clearDepth(),er.setRenderTarget(this.renderToScreen?null:rr),this.clear===!0&&er.clear(er.autoClearColor,er.autoClearDepth,er.autoClearStencil),er.render(this.scene,this.camera),this.clearColor!==null&&er.setClearColor(this._oldClearColor),this.clearAlpha!==null&&er.setClearAlpha(sr),this.overrideMaterial!==null&&(this.scene.overrideMaterial=ar),er.autoClear=nr}}class RenderPixelatedPass extends Pass{constructor(er,tr,rr,nr={}){super(),this.pixelSize=er,this.resolution=new Vector2,this.renderResolution=new Vector2,this.pixelatedMaterial=this.createPixelatedMaterial(),this.normalMaterial=new MeshNormalMaterial,this.fsQuad=new FullScreenQuad(this.pixelatedMaterial),this.scene=tr,this.camera=rr,this.normalEdgeStrength=nr.normalEdgeStrength||.3,this.depthEdgeStrength=nr.depthEdgeStrength||.4,this.beautyRenderTarget=new WebGLRenderTarget,this.beautyRenderTarget.texture.minFilter=NearestFilter,this.beautyRenderTarget.texture.magFilter=NearestFilter,this.beautyRenderTarget.texture.type=HalfFloatType,this.beautyRenderTarget.depthTexture=new DepthTexture,this.normalRenderTarget=new WebGLRenderTarget,this.normalRenderTarget.texture.minFilter=NearestFilter,this.normalRenderTarget.texture.magFilter=NearestFilter,this.normalRenderTarget.texture.type=HalfFloatType}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.pixelatedMaterial.dispose(),this.normalMaterial.dispose(),this.fsQuad.dispose()}setSize(er,tr){this.resolution.set(er,tr),this.renderResolution.set(er/this.pixelSize|0,tr/this.pixelSize|0);const{x:rr,y:nr}=this.renderResolution;this.beautyRenderTarget.setSize(rr,nr),this.normalRenderTarget.setSize(rr,nr),this.fsQuad.material.uniforms.resolution.value.set(rr,nr,1/rr,1/nr)}setPixelSize(er){this.pixelSize=er,this.setSize(this.resolution.x,this.resolution.y)}render(er,tr){const rr=this.fsQuad.material.uniforms;rr.normalEdgeStrength.value=this.normalEdgeStrength,rr.depthEdgeStrength.value=this.depthEdgeStrength,er.setRenderTarget(this.beautyRenderTarget),er.render(this.scene,this.camera);const nr=this.scene.overrideMaterial;er.setRenderTarget(this.normalRenderTarget),this.scene.overrideMaterial=this.normalMaterial,er.render(this.scene,this.camera),this.scene.overrideMaterial=nr,rr.tDiffuse.value=this.beautyRenderTarget.texture,rr.tDepth.value=this.beautyRenderTarget.depthTexture,rr.tNormal.value=this.normalRenderTarget.texture,this.renderToScreen?er.setRenderTarget(null):(er.setRenderTarget(tr),this.clear&&er.clear()),this.fsQuad.render(er)}createPixelatedMaterial(){return new ShaderMaterial({uniforms:{tDiffuse:{value:null},tDepth:{value:null},tNormal:{value:null},resolution:{value:new Vector4(this.renderResolution.x,this.renderResolution.y,1/this.renderResolution.x,1/this.renderResolution.y)},normalEdgeStrength:{value:0},depthEdgeStrength:{value:0}},vertexShader:`
				varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}
			`,fragmentShader:`
				uniform sampler2D tDiffuse;
				uniform sampler2D tDepth;
				uniform sampler2D tNormal;
				uniform vec4 resolution;
				uniform float normalEdgeStrength;
				uniform float depthEdgeStrength;
				varying vec2 vUv;

				float getDepth(int x, int y) {

					return texture2D( tDepth, vUv + vec2(x, y) * resolution.zw ).r;

				}

				vec3 getNormal(int x, int y) {

					return texture2D( tNormal, vUv + vec2(x, y) * resolution.zw ).rgb * 2.0 - 1.0;

				}

				float depthEdgeIndicator(float depth, vec3 normal) {

					float diff = 0.0;
					diff += clamp(getDepth(1, 0) - depth, 0.0, 1.0);
					diff += clamp(getDepth(-1, 0) - depth, 0.0, 1.0);
					diff += clamp(getDepth(0, 1) - depth, 0.0, 1.0);
					diff += clamp(getDepth(0, -1) - depth, 0.0, 1.0);
					return floor(smoothstep(0.01, 0.02, diff) * 2.) / 2.;

				}

				float neighborNormalEdgeIndicator(int x, int y, float depth, vec3 normal) {

					float depthDiff = getDepth(x, y) - depth;
					vec3 neighborNormal = getNormal(x, y);

					// Edge pixels should yield to faces who's normals are closer to the bias normal.
					vec3 normalEdgeBias = vec3(1., 1., 1.); // This should probably be a parameter.
					float normalDiff = dot(normal - neighborNormal, normalEdgeBias);
					float normalIndicator = clamp(smoothstep(-.01, .01, normalDiff), 0.0, 1.0);

					// Only the shallower pixel should detect the normal edge.
					float depthIndicator = clamp(sign(depthDiff * .25 + .0025), 0.0, 1.0);

					return (1.0 - dot(normal, neighborNormal)) * depthIndicator * normalIndicator;

				}

				float normalEdgeIndicator(float depth, vec3 normal) {

					float indicator = 0.0;

					indicator += neighborNormalEdgeIndicator(0, -1, depth, normal);
					indicator += neighborNormalEdgeIndicator(0, 1, depth, normal);
					indicator += neighborNormalEdgeIndicator(-1, 0, depth, normal);
					indicator += neighborNormalEdgeIndicator(1, 0, depth, normal);

					return step(0.1, indicator);

				}

				void main() {

					vec4 texel = texture2D( tDiffuse, vUv );

					float depth = 0.0;
					vec3 normal = vec3(0.0);

					if (depthEdgeStrength > 0.0 || normalEdgeStrength > 0.0) {

						depth = getDepth(0, 0);
						normal = getNormal(0, 0);

					}

					float dei = 0.0;
					if (depthEdgeStrength > 0.0)
						dei = depthEdgeIndicator(depth, normal);

					float nei = 0.0;
					if (normalEdgeStrength > 0.0)
						nei = normalEdgeIndicator(depth, normal);

					float Strength = dei > 0.0 ? (1.0 - depthEdgeStrength * dei) : (1.0 + normalEdgeStrength * nei);

					gl_FragColor = texel * Strength;

				}
			`})}}const SAOShader={name:"SAOShader",defines:{NUM_SAMPLES:7,NUM_RINGS:4,DIFFUSE_TEXTURE:0,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		#include <common>

		varying vec2 vUv;

		#if DIFFUSE_TEXTURE == 1
		uniform sampler2D tDiffuse;
		#endif

		uniform highp sampler2D tDepth;
		uniform highp sampler2D tNormal;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;

		uniform float scale;
		uniform float intensity;
		uniform float bias;
		uniform float kernelRadius;
		uniform float minResolution;
		uniform vec2 size;
		uniform float randomSeed;

		// RGBA depth

		#include <packing>

		vec4 getDefaultColor( const in vec2 screenPosition ) {
			#if DIFFUSE_TEXTURE == 1
			return texture2D( tDiffuse, vUv );
			#else
			return vec4( 1.0 );
			#endif
		}

		float getDepth( const in vec2 screenPosition ) {
			return texture2D( tDepth, screenPosition ).x;
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {
			float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];
			vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );
			clipPosition *= clipW; // unprojection.

			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;
		}

		vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {
			return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );
		}

		float scaleDividedByCameraFar;
		float minResolutionMultipliedByCameraFar;

		float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {
			vec3 viewDelta = sampleViewPosition - centerViewPosition;
			float viewDistance = length( viewDelta );
			float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;

			return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );
		}

		// moving costly divides into consts
		const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );
		const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );

		float getAmbientOcclusion( const in vec3 centerViewPosition ) {
			// precompute some variables require in getOcclusion.
			scaleDividedByCameraFar = scale / cameraFar;
			minResolutionMultipliedByCameraFar = minResolution * cameraFar;
			vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );

			// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/
			float angle = rand( vUv + randomSeed ) * PI2;
			vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;
			vec2 radiusStep = radius;

			float occlusionSum = 0.0;
			float weightSum = 0.0;

			for( int i = 0; i < NUM_SAMPLES; i ++ ) {
				vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;
				radius += radiusStep;
				angle += ANGLE_STEP;

				float sampleDepth = getDepth( sampleUv );
				if( sampleDepth >= ( 1.0 - EPSILON ) ) {
					continue;
				}

				float sampleViewZ = getViewZ( sampleDepth );
				vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );
				occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );
				weightSum += 1.0;
			}

			if( weightSum == 0.0 ) discard;

			return occlusionSum * ( intensity / weightSum );
		}

		void main() {
			float centerDepth = getDepth( vUv );
			if( centerDepth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = getViewZ( centerDepth );
			vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );

			float ambientOcclusion = getAmbientOcclusion( viewPosition );

			gl_FragColor = getDefaultColor( vUv );
			gl_FragColor.xyz *=  1.0 - ambientOcclusion;
		}`},DepthLimitedBlurShader={name:"DepthLimitedBlurShader",defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new Vector2(512,512)},sampleUvOffsets:{value:[new Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:`

		#include <common>

		uniform vec2 size;

		varying vec2 vUv;
		varying vec2 vInvSize;

		void main() {
			vUv = uv;
			vInvSize = 1.0 / size;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		#include <common>
		#include <packing>

		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform float depthCutoff;

		uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];
		uniform float sampleWeights[ KERNEL_RADIUS + 1 ];

		varying vec2 vUv;
		varying vec2 vInvSize;

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		void main() {
			float depth = getDepth( vUv );
			if( depth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = -getViewZ( depth );
			bool rBreak = false, lBreak = false;

			float weightSum = sampleWeights[0];
			vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;

			for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {

				float sampleWeight = sampleWeights[i];
				vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;

				vec2 sampleUv = vUv + sampleUvOffset;
				float viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;

				if( ! rBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

				sampleUv = vUv - sampleUvOffset;
				viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;

				if( ! lBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

			}

			gl_FragColor = diffuseSum / weightSum;
		}`},BlurShaderUtils={createSampleWeights:function(ir,er){const tr=[];for(let rr=0;rr<=ir;rr++)tr.push(gaussian(rr,er));return tr},createSampleOffsets:function(ir,er){const tr=[];for(let rr=0;rr<=ir;rr++)tr.push(er.clone().multiplyScalar(rr));return tr},configure:function(ir,er,tr,rr){ir.defines.KERNEL_RADIUS=er,ir.uniforms.sampleUvOffsets.value=BlurShaderUtils.createSampleOffsets(er,rr),ir.uniforms.sampleWeights.value=BlurShaderUtils.createSampleWeights(er,tr),ir.needsUpdate=!0}};function gaussian(ir,er){return Math.exp(-(ir*ir)/(2*(er*er)))/(Math.sqrt(2*Math.PI)*er)}class SAOPass extends Pass{constructor(er,tr,rr=new Vector2(256,256)){super(),this.scene=er,this.camera=tr,this.clear=!0,this.needsSwap=!1,this.originalClearColor=new Color,this._oldClearColor=new Color,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new Vector2(rr.x,rr.y),this.saoRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{type:HalfFloatType}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone();const nr=new DepthTexture;nr.format=DepthStencilFormat,nr.type=UnsignedInt248Type,this.normalRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,depthTexture:nr}),this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.saoMaterial=new ShaderMaterial({defines:Object.assign({},SAOShader.defines),fragmentShader:SAOShader.fragmentShader,vertexShader:SAOShader.vertexShader,uniforms:UniformsUtils.clone(SAOShader.uniforms)}),this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=nr,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=NoBlending,this.vBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:Object.assign({},DepthLimitedBlurShader.defines),vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=0,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=nr,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=NoBlending,this.hBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:Object.assign({},DepthLimitedBlurShader.defines),vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=0,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=nr,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=NoBlending,this.materialCopy=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,blending:NoBlending}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=CustomBlending,this.materialCopy.blendSrc=DstColorFactor,this.materialCopy.blendDst=ZeroFactor,this.materialCopy.blendEquation=AddEquation,this.materialCopy.blendSrcAlpha=DstAlphaFactor,this.materialCopy.blendDstAlpha=ZeroFactor,this.materialCopy.blendEquationAlpha=AddEquation,this.fsQuad=new FullScreenQuad(null)}render(er,tr,rr){this.renderToScreen&&(this.materialCopy.blending=NoBlending,this.materialCopy.uniforms.tDiffuse.value=rr.texture,this.materialCopy.needsUpdate=!0,this.renderPass(er,this.materialCopy,null)),er.getClearColor(this._oldClearColor),this.oldClearAlpha=er.getClearAlpha();const nr=er.autoClear;er.autoClear=!1,this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const sr=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=sr,this.hBlurMaterial.uniforms.depthCutoff.value=sr,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius)&&(BlurShaderUtils.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2(0,1)),BlurShaderUtils.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),this.renderOverride(er,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(er,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(er,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(er,this.hBlurMaterial,this.saoRenderTarget,16777215,1));const ar=this.materialCopy;this.params.output===SAOPass.OUTPUT.Normal?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===SAOPass.OUTPUT.Default?ar.blending=CustomBlending:ar.blending=NoBlending,this.renderPass(er,ar,this.renderToScreen?null:rr),er.setClearColor(this._oldClearColor,this.oldClearAlpha),er.autoClear=nr}renderPass(er,tr,rr,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(rr),er.autoClear=!1,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.fsQuad.material=tr,this.fsQuad.render(er),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderOverride(er,tr,rr,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(rr),er.autoClear=!1,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.overrideMaterial=tr,er.render(this.scene,this.camera),this.scene.overrideMaterial=null,er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}setSize(er,tr){this.saoRenderTarget.setSize(er,tr),this.blurIntermediateRenderTarget.setSize(er,tr),this.normalRenderTarget.setSize(er,tr),this.saoMaterial.uniforms.size.value.set(er,tr),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(er,tr),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(er,tr),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}}SAOPass.OUTPUT={Default:0,SAO:1,Normal:2};const SMAAEdgesShader={name:"SMAAEdgesShader",defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];

		void SMAAEdgeDetectionVS( vec2 texcoord ) {
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component
		}

		void main() {

			vUv = uv;

			SMAAEdgeDetectionVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];

		vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
			vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );

			// Calculate color deltas:
			vec4 delta;
			vec3 C = texture2D( colorTex, texcoord ).rgb;

			vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
			vec3 t = abs( C - Cleft );
			delta.x = max( max( t.r, t.g ), t.b );

			vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
			t = abs( C - Ctop );
			delta.y = max( max( t.r, t.g ), t.b );

			// We do the usual threshold:
			vec2 edges = step( threshold, delta.xy );

			// Then discard if there is no edge:
			if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
				discard;

			// Calculate right and bottom deltas:
			vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
			t = abs( C - Cright );
			delta.z = max( max( t.r, t.g ), t.b );

			vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
			t = abs( C - Cbottom );
			delta.w = max( max( t.r, t.g ), t.b );

			// Calculate the maximum delta in the direct neighborhood:
			float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

			// Calculate left-left and top-top deltas:
			vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
			t = abs( C - Cleftleft );
			delta.z = max( max( t.r, t.g ), t.b );

			vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
			t = abs( C - Ctoptop );
			delta.w = max( max( t.r, t.g ), t.b );

			// Calculate the final maximum delta:
			maxDelta = max( max( maxDelta, delta.z ), delta.w );

			// Local contrast adaptation in action:
			edges.xy *= step( 0.5 * maxDelta, delta.xy );

			return vec4( edges, 0.0, 0.0 );
		}

		void main() {

			gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );

		}`},SMAAWeightsShader={name:"SMAAWeightsShader",defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];
		varying vec2 vPixcoord;

		void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
			vPixcoord = texcoord / resolution;

			// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 ); // WebGL port note: Changed sign in Y and W components
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 ); // WebGL port note: Changed sign in Y and W components

			// And these for the searches, they indicate the ends of the loops:
			vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );

		}

		void main() {

			vUv = uv;

			SMAABlendingWeightCalculationVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )

		uniform sampler2D tDiffuse;
		uniform sampler2D tArea;
		uniform sampler2D tSearch;
		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[3];
		varying vec2 vPixcoord;

		#if __VERSION__ == 100
		vec2 round( vec2 x ) {
			return sign( x ) * floor( abs( x ) + 0.5 );
		}
		#endif

		float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
			// Not required if searchTex accesses are set to point:
			// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
			// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
			//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
			e.r = bias + e.r * scale;
			return 255.0 * texture2D( searchTex, e, 0.0 ).r;
		}

		float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			/**
				* @PSEUDO_GATHER4
				* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to
				* sample between edge, thus fetching four edges in a row.
				* Sampling with different offsets in each direction allows to disambiguate
				* which edges are active from the four fetched ones.
				*/
			vec2 e = vec2( 0.0, 1.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord -= vec2( 2.0, 0.0 ) * resolution;
				if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
			}

			// We correct the previous (-0.25, -0.125) offset we applied:
			texcoord.x += 0.25 * resolution.x;

			// The searches are bias by 1, so adjust the coords accordingly:
			texcoord.x += resolution.x;

			// Disambiguate the length added by the last step:
			texcoord.x += 2.0 * resolution.x; // Undo last step
			texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

			return texcoord.x;
		}

		float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 0.0, 1.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord += vec2( 2.0, 0.0 ) * resolution;
				if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
			}

			texcoord.x -= 0.25 * resolution.x;
			texcoord.x -= resolution.x;
			texcoord.x -= 2.0 * resolution.x;
			texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

			return texcoord.x;
		}

		float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 1.0, 0.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord += vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign
				if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
			}

			texcoord.y -= 0.25 * resolution.y; // WebGL port note: Changed sign
			texcoord.y -= resolution.y; // WebGL port note: Changed sign
			texcoord.y -= 2.0 * resolution.y; // WebGL port note: Changed sign
			texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 ); // WebGL port note: Changed sign

			return texcoord.y;
		}

		float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 1.0, 0.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord -= vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign
				if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
			}

			texcoord.y += 0.25 * resolution.y; // WebGL port note: Changed sign
			texcoord.y += resolution.y; // WebGL port note: Changed sign
			texcoord.y += 2.0 * resolution.y; // WebGL port note: Changed sign
			texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 ); // WebGL port note: Changed sign

			return texcoord.y;
		}

		vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
			// Rounding prevents precision errors of bilinear filtering:
			vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;

			// We do a scale and bias for mapping to texel space:
			texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );

			// Move to proper place, according to the subpixel offset:
			texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

			return texture2D( areaTex, texcoord, 0.0 ).rg;
		}

		vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
			vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );

			vec2 e = texture2D( edgesTex, texcoord ).rg;

			if ( e.g > 0.0 ) { // Edge at north
				vec2 d;

				// Find the distance to the left:
				vec2 coords;
				coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
				coords.y = offset[ 1 ].y; // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)
				d.x = coords.x;

				// Now fetch the left crossing edges, two at a time using bilinear
				// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
				// discern what value each edge has:
				float e1 = texture2D( edgesTex, coords, 0.0 ).r;

				// Find the distance to the right:
				coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
				d.y = coords.x;

				// We want the distances to be in pixel units (doing this here allow to
				// better interleave arithmetic and memory accesses):
				d = d / resolution.x - pixcoord.x;

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				vec2 sqrt_d = sqrt( abs( d ) );

				// Fetch the right crossing edges:
				coords.y -= 1.0 * resolution.y; // WebGL port note: Added
				float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;

				// Ok, we know how this pattern looks like, now it is time for getting
				// the actual area:
				weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
			}

			if ( e.r > 0.0 ) { // Edge at west
				vec2 d;

				// Find the distance to the top:
				vec2 coords;

				coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
				coords.x = offset[ 0 ].x; // offset[1].x = texcoord.x - 0.25 * resolution.x;
				d.x = coords.y;

				// Fetch the top crossing edges:
				float e1 = texture2D( edgesTex, coords, 0.0 ).g;

				// Find the distance to the bottom:
				coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
				d.y = coords.y;

				// We want the distances to be in pixel units:
				d = d / resolution.y - pixcoord.y;

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				vec2 sqrt_d = sqrt( abs( d ) );

				// Fetch the bottom crossing edges:
				coords.y -= 1.0 * resolution.y; // WebGL port note: Added
				float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;

				// Get the area for this direction:
				weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );
			}

			return weights;
		}

		void main() {

			gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );

		}`},SMAABlendShader={name:"SMAABlendShader",uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 2 ];

		void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component
		}

		void main() {

			vUv = uv;

			SMAANeighborhoodBlendingVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform sampler2D tColor;
		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 2 ];

		vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
			// Fetch the blending weights for current pixel:
			vec4 a;
			a.xz = texture2D( blendTex, texcoord ).xz;
			a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
			a.w = texture2D( blendTex, offset[ 1 ].xy ).a;

			// Is there any blending weight with a value greater than 0.0?
			if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
				return texture2D( colorTex, texcoord, 0.0 );
			} else {
				// Up to 4 lines can be crossing a pixel (one through each edge). We
				// favor blending by choosing the line with the maximum weight for each
				// direction:
				vec2 offset;
				offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
				offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

				// Then we go in the direction that has the maximum weight:
				if ( abs( offset.x ) > abs( offset.y )) { // horizontal vs. vertical
					offset.y = 0.0;
				} else {
					offset.x = 0.0;
				}

				// Fetch the opposite color and lerp by hand:
				vec4 C = texture2D( colorTex, texcoord, 0.0 );
				texcoord += sign( offset ) * resolution;
				vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
				float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );

				// WebGL port note: Added gamma correction
				C.xyz = pow(C.xyz, vec3(2.2));
				Cop.xyz = pow(Cop.xyz, vec3(2.2));
				vec4 mixed = mix(C, Cop, s);
				mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

				return mixed;
			}
		}

		void main() {

			gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );

		}`};class SMAAPass extends Pass{constructor(er,tr){super(),this.edgesRT=new WebGLRenderTarget(er,tr,{depthBuffer:!1,type:HalfFloatType}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new WebGLRenderTarget(er,tr,{depthBuffer:!1,type:HalfFloatType}),this.weightsRT.texture.name="SMAAPass.weights";const rr=this,nr=new Image;nr.src=this.getAreaTexture(),nr.onload=function(){rr.areaTexture.needsUpdate=!0},this.areaTexture=new Texture,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=nr,this.areaTexture.minFilter=LinearFilter,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;const sr=new Image;sr.src=this.getSearchTexture(),sr.onload=function(){rr.searchTexture.needsUpdate=!0},this.searchTexture=new Texture,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=sr,this.searchTexture.magFilter=NearestFilter,this.searchTexture.minFilter=NearestFilter,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,this.uniformsEdges=UniformsUtils.clone(SMAAEdgesShader.uniforms),this.uniformsEdges.resolution.value.set(1/er,1/tr),this.materialEdges=new ShaderMaterial({defines:Object.assign({},SMAAEdgesShader.defines),uniforms:this.uniformsEdges,vertexShader:SMAAEdgesShader.vertexShader,fragmentShader:SMAAEdgesShader.fragmentShader}),this.uniformsWeights=UniformsUtils.clone(SMAAWeightsShader.uniforms),this.uniformsWeights.resolution.value.set(1/er,1/tr),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new ShaderMaterial({defines:Object.assign({},SMAAWeightsShader.defines),uniforms:this.uniformsWeights,vertexShader:SMAAWeightsShader.vertexShader,fragmentShader:SMAAWeightsShader.fragmentShader}),this.uniformsBlend=UniformsUtils.clone(SMAABlendShader.uniforms),this.uniformsBlend.resolution.value.set(1/er,1/tr),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new ShaderMaterial({uniforms:this.uniformsBlend,vertexShader:SMAABlendShader.vertexShader,fragmentShader:SMAABlendShader.fragmentShader}),this.fsQuad=new FullScreenQuad(null)}render(er,tr,rr){this.uniformsEdges.tDiffuse.value=rr.texture,this.fsQuad.material=this.materialEdges,er.setRenderTarget(this.edgesRT),this.clear&&er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.materialWeights,er.setRenderTarget(this.weightsRT),this.clear&&er.clear(),this.fsQuad.render(er),this.uniformsBlend.tColor.value=rr.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}setSize(er,tr){this.edgesRT.setSize(er,tr),this.weightsRT.setSize(er,tr),this.materialEdges.uniforms.resolution.value.set(1/er,1/tr),this.materialWeights.uniforms.resolution.value.set(1/er,1/tr),this.materialBlend.uniforms.resolution.value.set(1/er,1/tr)}getAreaTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}dispose(){this.edgesRT.dispose(),this.weightsRT.dispose(),this.areaTexture.dispose(),this.searchTexture.dispose(),this.materialEdges.dispose(),this.materialWeights.dispose(),this.materialBlend.dispose(),this.fsQuad.dispose()}}class SSAARenderPass extends Pass{constructor(er,tr,rr,nr){super(),this.scene=er,this.camera=tr,this.sampleLevel=4,this.unbiased=!0,this.stencilBuffer=!1,this.clearColor=rr!==void 0?rr:0,this.clearAlpha=nr!==void 0?nr:0,this._oldClearColor=new Color;const sr=CopyShader;this.copyUniforms=UniformsUtils.clone(sr.uniforms),this.copyMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:sr.vertexShader,fragmentShader:sr.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0,blending:AdditiveBlending}),this.fsQuad=new FullScreenQuad(this.copyMaterial)}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null),this.copyMaterial.dispose(),this.fsQuad.dispose()}setSize(er,tr){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(er,tr)}render(er,tr,rr){this.sampleRenderTarget||(this.sampleRenderTarget=new WebGLRenderTarget(rr.width,rr.height,{type:HalfFloatType,stencilBuffer:this.stencilBuffer}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");const nr=_JitterVectors$1[Math.max(0,Math.min(this.sampleLevel,5))],sr=er.autoClear;er.autoClear=!1,er.getClearColor(this._oldClearColor);const ar=er.getClearAlpha(),or=1/nr.length,lr=1/32;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;const cr={fullWidth:rr.width,fullHeight:rr.height,offsetX:0,offsetY:0,width:rr.width,height:rr.height},hr=Object.assign({},this.camera.view);hr.enabled&&Object.assign(cr,hr);for(let fr=0;fr<nr.length;fr++){const ur=nr[fr];this.camera.setViewOffset&&this.camera.setViewOffset(cr.fullWidth,cr.fullHeight,cr.offsetX+ur[0]*.0625,cr.offsetY+ur[1]*.0625,cr.width,cr.height);let pr=or;if(this.unbiased){const gr=-.5+(fr+.5)/nr.length;pr+=lr*gr}this.copyUniforms.opacity.value=pr,er.setClearColor(this.clearColor,this.clearAlpha),er.setRenderTarget(this.sampleRenderTarget),er.clear(),er.render(this.scene,this.camera),er.setRenderTarget(this.renderToScreen?null:tr),fr===0&&(er.setClearColor(0,0),er.clear()),this.fsQuad.render(er)}this.camera.setViewOffset&&hr.enabled?this.camera.setViewOffset(hr.fullWidth,hr.fullHeight,hr.offsetX,hr.offsetY,hr.width,hr.height):this.camera.clearViewOffset&&this.camera.clearViewOffset(),er.autoClear=sr,er.setClearColor(this._oldClearColor,ar)}}const _JitterVectors$1=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],SSAOShader={name:"SSAOShader",defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Vector2},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		uniform highp sampler2D tNormal;
		uniform highp sampler2D tDepth;
		uniform sampler2D tNoise;

		uniform vec3 kernel[ KERNEL_SIZE ];

		uniform vec2 resolution;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;

		uniform float kernelRadius;
		uniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference
		uniform float maxDistance; // avoid the influence of fragments which are too far away

		varying vec2 vUv;

		#include <packing>

		float getDepth( const in vec2 screenPosition ) {

			return texture2D( tDepth, screenPosition ).x;

		}

		float getLinearDepth( const in vec2 screenPosition ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, screenPosition ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, screenPosition ).x;

			#endif

		}

		float getViewZ( const in float depth ) {

			#if PERSPECTIVE_CAMERA == 1

				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );

			#else

				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );

			#endif

		}

		vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {

			float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];

			vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );

			clipPosition *= clipW; // unprojection.

			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;

		}

		vec3 getViewNormal( const in vec2 screenPosition ) {

			return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );

		}

		void main() {

			float depth = getDepth( vUv );

			if ( depth == 1.0 ) {

				gl_FragColor = vec4( 1.0 ); // don't influence background
				
			} else {

				float viewZ = getViewZ( depth );

				vec3 viewPosition = getViewPosition( vUv, depth, viewZ );
				vec3 viewNormal = getViewNormal( vUv );

				vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );
				vec3 random = vec3( texture2D( tNoise, vUv * noiseScale ).r );

				// compute matrix used to reorient a kernel vector

				vec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );
				vec3 bitangent = cross( viewNormal, tangent );
				mat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );

				float occlusion = 0.0;

				for ( int i = 0; i < KERNEL_SIZE; i ++ ) {

					vec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space
					vec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point

					vec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC
					samplePointNDC /= samplePointNDC.w;

					vec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates

					float realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture
					float sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value
					float delta = sampleDepth - realDepth;

					if ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion

						occlusion += 1.0;

					}

				}

				occlusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );

				gl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );

			}

		}`},SSAODepthShader={name:"SSAODepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;

		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 screenPosition ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, screenPosition ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, screenPosition ).x;

			#endif

		}

		void main() {

			float depth = getLinearDepth( vUv );
			gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );

		}`},SSAOBlurShader={name:"SSAOBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2}},vertexShader:`varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		void main() {

			vec2 texelSize = ( 1.0 / resolution );
			float result = 0.0;

			for ( int i = - 2; i <= 2; i ++ ) {

				for ( int j = - 2; j <= 2; j ++ ) {

					vec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;
					result += texture2D( tDiffuse, vUv + offset ).r;

				}

			}

			gl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );

		}`};class SSAOPass extends Pass{constructor(er,tr,rr,nr,sr=32){super(),this.width=rr!==void 0?rr:512,this.height=nr!==void 0?nr:512,this.clear=!0,this.needsSwap=!1,this.camera=tr,this.scene=er,this.kernelRadius=8,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(sr),this.generateRandomKernelRotations();const ar=new DepthTexture;ar.format=DepthStencilFormat,ar.type=UnsignedInt248Type,this.normalRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,depthTexture:ar}),this.ssaoRenderTarget=new WebGLRenderTarget(this.width,this.height,{type:HalfFloatType}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),this.ssaoMaterial=new ShaderMaterial({defines:Object.assign({},SSAOShader.defines),uniforms:UniformsUtils.clone(SSAOShader.uniforms),vertexShader:SSAOShader.vertexShader,fragmentShader:SSAOShader.fragmentShader,blending:NoBlending}),this.ssaoMaterial.defines.KERNEL_SIZE=sr,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.blurMaterial=new ShaderMaterial({defines:Object.assign({},SSAOBlurShader.defines),uniforms:UniformsUtils.clone(SSAOBlurShader.uniforms),vertexShader:SSAOBlurShader.vertexShader,fragmentShader:SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ShaderMaterial({defines:Object.assign({},SSAODepthShader.defines),uniforms:UniformsUtils.clone(SSAODepthShader.uniforms),vertexShader:SSAODepthShader.vertexShader,fragmentShader:SSAODepthShader.fragmentShader,blending:NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:DstColorFactor,blendDst:ZeroFactor,blendEquation:AddEquation,blendSrcAlpha:DstAlphaFactor,blendDstAlpha:ZeroFactor,blendEquationAlpha:AddEquation}),this.fsQuad=new FullScreenQuad(null),this.originalClearColor=new Color}dispose(){this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(er,tr,rr){switch(this.overrideVisibility(),this.renderOverride(er,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(er,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(er,this.blurMaterial,this.blurRenderTarget),this.output){case SSAOPass.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:rr);break;case SSAOPass.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:rr);break;case SSAOPass.OUTPUT.Depth:this.renderPass(er,this.depthRenderMaterial,this.renderToScreen?null:rr);break;case SSAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:rr);break;case SSAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=CustomBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:rr);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(er,tr,rr,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(rr),er.autoClear=!1,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.fsQuad.material=tr,this.fsQuad.render(er),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderOverride(er,tr,rr,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(rr),er.autoClear=!1,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.overrideMaterial=tr,er.render(this.scene,this.camera),this.scene.overrideMaterial=null,er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}setSize(er,tr){this.width=er,this.height=tr,this.ssaoRenderTarget.setSize(er,tr),this.normalRenderTarget.setSize(er,tr),this.blurRenderTarget.setSize(er,tr),this.ssaoMaterial.uniforms.resolution.value.set(er,tr),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(er,tr)}generateSampleKernel(er){const tr=this.kernel;for(let rr=0;rr<er;rr++){const nr=new Vector3$1;nr.x=Math.random()*2-1,nr.y=Math.random()*2-1,nr.z=Math.random(),nr.normalize();let sr=rr/er;sr=MathUtils.lerp(.1,1,sr*sr),nr.multiplyScalar(sr),tr.push(nr)}}generateRandomKernelRotations(){const rr=new SimplexNoise,nr=4*4,sr=new Float32Array(nr);for(let ar=0;ar<nr;ar++){const or=Math.random()*2-1,lr=Math.random()*2-1,cr=0;sr[ar]=rr.noise3d(or,lr,cr)}this.noiseTexture=new DataTexture(sr,4,4,RedFormat,FloatType),this.noiseTexture.wrapS=RepeatWrapping,this.noiseTexture.wrapT=RepeatWrapping,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const er=this.scene,tr=this._visibilityCache;er.traverse(function(rr){tr.set(rr,rr.visible),(rr.isPoints||rr.isLine)&&(rr.visible=!1)})}restoreVisibility(){const er=this.scene,tr=this._visibilityCache;er.traverse(function(rr){const nr=tr.get(rr);rr.visible=nr}),tr.clear()}}SSAOPass.OUTPUT={Default:0,SSAO:1,Blur:2,Depth:3,Normal:4};const SSRShader={name:"SSRShader",defines:{MAX_STEP:0,PERSPECTIVE_CAMERA:!0,DISTANCE_ATTENUATION:!0,FRESNEL:!0,INFINITE_THICK:!1,SELECTIVE:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Vector2},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},thickness:{value:.018}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float thickness;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef PERSPECTIVE_CAMERA
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef SELECTIVE
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef PERSPECTIVE_CAMERA
				vec3 viewIncidentDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#else
				vec3 viewIncidentDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidentDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef PERSPECTIVE_CAMERA
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<float(MAX_STEP);i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef PERSPECTIVE_CAMERA
					// https://comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
				#endif

				// if(viewReflectRayZ>vZ) continue; // will cause "npm run make-screenshot webgl_postprocessing_ssr" high probability hang.
				// https://github.com/mrdoob/three.js/pull/21539#issuecomment-821061164
				if(viewReflectRayZ<=vZ){

					bool hit;
					#ifdef INFINITE_THICK
						hit=true;
					#else
						float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

						float minThickness;
						vec2 xyNeighbor=xy;
						xyNeighbor.x+=1.;
						vec2 uvNeighbor=xyNeighbor/resolution;
						vec3 vPNeighbor=getViewPosition(uvNeighbor,d,cW);
						minThickness=vPNeighbor.x-vP.x;
						minThickness*=3.;
						float tk=max(minThickness,thickness);

						hit=away<=tk;
					#endif

					if(hit){
						vec3 vN=getViewNormal( uv );
						if(dot(viewReflectDir,vN)>=0.) continue;
						float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
						if(distance>maxDistance) break;
						float op=opacity;
						#ifdef DISTANCE_ATTENUATION
							float ratio=1.-(distance/maxDistance);
							float attenuation=ratio*ratio;
							op=opacity*attenuation;
						#endif
						#ifdef FRESNEL
							float fresnelCoe=(dot(viewIncidentDir,viewReflectDir)+1.)/2.;
							op*=fresnelCoe;
						#endif
						vec4 reflectColor=texture2D(tDiffuse,uv);
						gl_FragColor.xyz=reflectColor.xyz;
						gl_FragColor.a=op;
						break;
					}
				}
			}
		}
	`},SSRDepthShader={name:"SSRDepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;

		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

		void main() {

			float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
			gl_FragColor = vec4( vec3( d ), 1.0 );

		}

	`},SSRBlurShader={name:"SSRBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2},opacity:{value:.5}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;
		void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

			vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`};class SSRPass extends Pass{constructor({renderer:er,scene:tr,camera:rr,width:nr,height:sr,selects:ar,bouncing:or=!1,groundReflector:lr}){super(),this.width=nr!==void 0?nr:512,this.height=sr!==void 0?sr:512,this.clear=!0,this.renderer=er,this.scene=tr,this.camera=rr,this.groundReflector=lr,this.opacity=SSRShader.uniforms.opacity.value,this.output=0,this.maxDistance=SSRShader.uniforms.maxDistance.value,this.thickness=SSRShader.uniforms.thickness.value,this.tempColor=new Color,this._selects=ar,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(hr){this._selects!==hr&&(this._selects=hr,Array.isArray(hr)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0,this.ssrMaterial.needsUpdate=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1,this.ssrMaterial.needsUpdate=!0))}}),this._bouncing=or,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(hr){this._bouncing!==hr&&(this._bouncing=hr,hr?this.ssrMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture:this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=SSRShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(hr){this._distanceAttenuation!==hr&&(this._distanceAttenuation=hr,this.ssrMaterial.defines.DISTANCE_ATTENUATION=hr,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=SSRShader.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(hr){this._fresnel!==hr&&(this._fresnel=hr,this.ssrMaterial.defines.FRESNEL=hr,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=SSRShader.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(hr){this._infiniteThick!==hr&&(this._infiniteThick=hr,this.ssrMaterial.defines.INFINITE_THICK=hr,this.ssrMaterial.needsUpdate=!0)}});const cr=new DepthTexture;cr.type=UnsignedShortType,cr.minFilter=NearestFilter,cr.magFilter=NearestFilter,this.beautyRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,depthTexture:cr,depthBuffer:!0}),this.prevRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter}),this.normalRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType}),this.metalnessRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType}),this.ssrRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new ShaderMaterial({defines:Object.assign({},SSRShader.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:UniformsUtils.clone(SSRShader.uniforms),vertexShader:SSRShader.vertexShader,fragmentShader:SSRShader.fragmentShader,blending:NoBlending}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.metalnessOnMaterial=new MeshBasicMaterial({color:"white"}),this.metalnessOffMaterial=new MeshBasicMaterial({color:"black"}),this.blurMaterial=new ShaderMaterial({defines:Object.assign({},SSRBlurShader.defines),uniforms:UniformsUtils.clone(SSRBlurShader.uniforms),vertexShader:SSRBlurShader.vertexShader,fragmentShader:SSRBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new ShaderMaterial({defines:Object.assign({},SSRBlurShader.defines),uniforms:UniformsUtils.clone(SSRBlurShader.uniforms),vertexShader:SSRBlurShader.vertexShader,fragmentShader:SSRBlurShader.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ShaderMaterial({defines:Object.assign({},SSRDepthShader.defines),uniforms:UniformsUtils.clone(SSRDepthShader.uniforms),vertexShader:SSRDepthShader.vertexShader,fragmentShader:SSRDepthShader.fragmentShader,blending:NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:SrcAlphaFactor,blendDst:OneMinusSrcAlphaFactor,blendEquation:AddEquation,blendSrcAlpha:SrcAlphaFactor,blendDstAlpha:OneMinusSrcAlphaFactor,blendEquationAlpha:AddEquation}),this.fsQuad=new FullScreenQuad(null),this.originalClearColor=new Color}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(er,tr){switch(er.setRenderTarget(this.beautyRenderTarget),er.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),er.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(er,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(er,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(er,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(er,this.blurMaterial,this.blurRenderTarget),this.renderPass(er,this.blurMaterial2,this.blurRenderTarget2)),this.output){case SSRPass.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=NormalBlending,this.renderPass(er,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=NormalBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr));break;case SSRPass.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=NormalBlending,this.renderPass(er,this.copyMaterial,this.prevRenderTarget));break;case SSRPass.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case SSRPass.OUTPUT.Depth:this.renderPass(er,this.depthRenderMaterial,this.renderToScreen?null:tr);break;case SSRPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case SSRPass.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;default:console.warn("THREE.SSRPass: Unknown output type.")}}renderPass(er,tr,rr,nr,sr){this.originalClearColor.copy(er.getClearColor(this.tempColor));const ar=er.getClearAlpha(this.tempColor),or=er.autoClear;er.setRenderTarget(rr),er.autoClear=!1,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.fsQuad.material=tr,this.fsQuad.render(er),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderOverride(er,tr,rr,nr,sr){this.originalClearColor.copy(er.getClearColor(this.tempColor));const ar=er.getClearAlpha(this.tempColor),or=er.autoClear;er.setRenderTarget(rr),er.autoClear=!1,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.overrideMaterial=tr,er.render(this.scene,this.camera),this.scene.overrideMaterial=null,er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderMetalness(er,tr,rr,nr,sr){this.originalClearColor.copy(er.getClearColor(this.tempColor));const ar=er.getClearAlpha(this.tempColor),or=er.autoClear,lr=this.scene.background,cr=this.scene.fog;er.setRenderTarget(rr),er.autoClear=!1,this.scene.background=null,this.scene.fog=null,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.traverseVisible(hr=>{hr._SSRPassBackupMaterial=hr.material,this._selects.includes(hr)?hr.material=this.metalnessOnMaterial:hr.material=this.metalnessOffMaterial}),er.render(this.scene,this.camera),this.scene.traverseVisible(hr=>{hr.material=hr._SSRPassBackupMaterial}),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar),this.scene.background=lr,this.scene.fog=cr}setSize(er,tr){this.width=er,this.height=tr,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(er*er+tr*tr),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(er,tr),this.prevRenderTarget.setSize(er,tr),this.ssrRenderTarget.setSize(er,tr),this.normalRenderTarget.setSize(er,tr),this.metalnessRenderTarget.setSize(er,tr),this.blurRenderTarget.setSize(er,tr),this.blurRenderTarget2.setSize(er,tr),this.ssrMaterial.uniforms.resolution.value.set(er,tr),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(er,tr),this.blurMaterial2.uniforms.resolution.value.set(er,tr)}}SSRPass.OUTPUT={Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7};class SavePass extends Pass{constructor(er){super();const tr=CopyShader;this.textureID="tDiffuse",this.uniforms=UniformsUtils.clone(tr.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:tr.vertexShader,fragmentShader:tr.fragmentShader,blending:NoBlending}),this.renderTarget=er,this.renderTarget===void 0&&(this.renderTarget=new WebGLRenderTarget(1,1,{type:HalfFloatType}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,rr){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=rr.texture),er.setRenderTarget(this.renderTarget),this.clear&&er.clear(),this.fsQuad.render(er)}setSize(er,tr){this.renderTarget.setSize(er,tr)}dispose(){this.renderTarget.dispose(),this.material.dispose(),this.fsQuad.dispose()}}class TAARenderPass extends SSAARenderPass{constructor(er,tr,rr,nr){super(er,tr,rr,nr),this.sampleLevel=0,this.accumulate=!1,this.accumulateIndex=-1}render(er,tr,rr,nr){if(this.accumulate===!1){super.render(er,tr,rr,nr),this.accumulateIndex=-1;return}const sr=_JitterVectors[5];this.sampleRenderTarget===void 0&&(this.sampleRenderTarget=new WebGLRenderTarget(rr.width,rr.height,{type:HalfFloatType}),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget===void 0&&(this.holdRenderTarget=new WebGLRenderTarget(rr.width,rr.height,{type:HalfFloatType}),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulateIndex===-1&&(super.render(er,this.holdRenderTarget,rr,nr),this.accumulateIndex=0);const ar=er.autoClear;er.autoClear=!1,er.getClearColor(this._oldClearColor);const or=er.getClearAlpha(),lr=1/sr.length;if(this.accumulateIndex>=0&&this.accumulateIndex<sr.length){this.copyUniforms.opacity.value=lr,this.copyUniforms.tDiffuse.value=tr.texture;const hr=Math.pow(2,this.sampleLevel);for(let fr=0;fr<hr;fr++){const ur=this.accumulateIndex,pr=sr[ur];if(this.camera.setViewOffset&&this.camera.setViewOffset(rr.width,rr.height,pr[0]*.0625,pr[1]*.0625,rr.width,rr.height),er.setRenderTarget(tr),er.setClearColor(this.clearColor,this.clearAlpha),er.clear(),er.render(this.scene,this.camera),er.setRenderTarget(this.sampleRenderTarget),this.accumulateIndex===0&&(er.setClearColor(0,0),er.clear()),this.fsQuad.render(er),this.accumulateIndex++,this.accumulateIndex>=sr.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}er.setClearColor(this.clearColor,this.clearAlpha);const cr=this.accumulateIndex*lr;cr>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,er.setRenderTarget(tr),er.clear(),this.fsQuad.render(er)),cr<1&&(this.copyUniforms.opacity.value=1-cr,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,er.setRenderTarget(tr),this.fsQuad.render(er)),er.autoClear=ar,er.setClearColor(this._oldClearColor,or)}dispose(){super.dispose(),this.holdRenderTarget&&this.holdRenderTarget.dispose()}}const _JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];class TexturePass extends Pass{constructor(er,tr){super();const rr=CopyShader;this.map=er,this.opacity=tr!==void 0?tr:1,this.uniforms=UniformsUtils.clone(rr.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:rr.vertexShader,fragmentShader:rr.fragmentShader,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0}),this.needsSwap=!1,this.fsQuad=new FullScreenQuad(null)}render(er,tr,rr){const nr=er.autoClear;er.autoClear=!1,this.fsQuad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,er.setRenderTarget(this.renderToScreen?null:rr),this.clear&&er.clear(),this.fsQuad.render(er),er.autoClear=nr}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const LuminosityHighPassShader={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Color(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float v = luminance( texel.xyz );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class UnrealBloomPass extends Pass{constructor(er,tr,rr,nr){super(),this.strength=tr!==void 0?tr:1,this.radius=rr,this.threshold=nr,this.resolution=er!==void 0?new Vector2(er.x,er.y):new Vector2(256,256),this.clearColor=new Color(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let sr=Math.round(this.resolution.x/2),ar=Math.round(this.resolution.y/2);this.renderTargetBright=new WebGLRenderTarget(sr,ar,{type:HalfFloatType}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let fr=0;fr<this.nMips;fr++){const ur=new WebGLRenderTarget(sr,ar,{type:HalfFloatType});ur.texture.name="UnrealBloomPass.h"+fr,ur.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(ur);const pr=new WebGLRenderTarget(sr,ar,{type:HalfFloatType});pr.texture.name="UnrealBloomPass.v"+fr,pr.texture.generateMipmaps=!1,this.renderTargetsVertical.push(pr),sr=Math.round(sr/2),ar=Math.round(ar/2)}const or=LuminosityHighPassShader;this.highPassUniforms=UniformsUtils.clone(or.uniforms),this.highPassUniforms.luminosityThreshold.value=nr,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:or.vertexShader,fragmentShader:or.fragmentShader}),this.separableBlurMaterials=[];const lr=[3,5,7,9,11];sr=Math.round(this.resolution.x/2),ar=Math.round(this.resolution.y/2);for(let fr=0;fr<this.nMips;fr++)this.separableBlurMaterials.push(this.getSeparableBlurMaterial(lr[fr])),this.separableBlurMaterials[fr].uniforms.invSize.value=new Vector2(1/sr,1/ar),sr=Math.round(sr/2),ar=Math.round(ar/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=tr,this.compositeMaterial.uniforms.bloomRadius.value=.1;const cr=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=cr,this.bloomTintColors=[new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const hr=CopyShader;this.copyUniforms=UniformsUtils.clone(hr.uniforms),this.blendMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:hr.vertexShader,fragmentShader:hr.fragmentShader,blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Color,this.oldClearAlpha=1,this.basic=new MeshBasicMaterial,this.fsQuad=new FullScreenQuad(null)}dispose(){for(let er=0;er<this.renderTargetsHorizontal.length;er++)this.renderTargetsHorizontal[er].dispose();for(let er=0;er<this.renderTargetsVertical.length;er++)this.renderTargetsVertical[er].dispose();this.renderTargetBright.dispose();for(let er=0;er<this.separableBlurMaterials.length;er++)this.separableBlurMaterials[er].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(er,tr){let rr=Math.round(er/2),nr=Math.round(tr/2);this.renderTargetBright.setSize(rr,nr);for(let sr=0;sr<this.nMips;sr++)this.renderTargetsHorizontal[sr].setSize(rr,nr),this.renderTargetsVertical[sr].setSize(rr,nr),this.separableBlurMaterials[sr].uniforms.invSize.value=new Vector2(1/rr,1/nr),rr=Math.round(rr/2),nr=Math.round(nr/2)}render(er,tr,rr,nr,sr){er.getClearColor(this._oldClearColor),this.oldClearAlpha=er.getClearAlpha();const ar=er.autoClear;er.autoClear=!1,er.setClearColor(this.clearColor,0),sr&&er.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=rr.texture,er.setRenderTarget(null),er.clear(),this.fsQuad.render(er)),this.highPassUniforms.tDiffuse.value=rr.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,er.setRenderTarget(this.renderTargetBright),er.clear(),this.fsQuad.render(er);let or=this.renderTargetBright;for(let lr=0;lr<this.nMips;lr++)this.fsQuad.material=this.separableBlurMaterials[lr],this.separableBlurMaterials[lr].uniforms.colorTexture.value=or.texture,this.separableBlurMaterials[lr].uniforms.direction.value=UnrealBloomPass.BlurDirectionX,er.setRenderTarget(this.renderTargetsHorizontal[lr]),er.clear(),this.fsQuad.render(er),this.separableBlurMaterials[lr].uniforms.colorTexture.value=this.renderTargetsHorizontal[lr].texture,this.separableBlurMaterials[lr].uniforms.direction.value=UnrealBloomPass.BlurDirectionY,er.setRenderTarget(this.renderTargetsVertical[lr]),er.clear(),this.fsQuad.render(er),or=this.renderTargetsVertical[lr];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,er.setRenderTarget(this.renderTargetsHorizontal[0]),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,sr&&er.state.buffers.stencil.setTest(!0),this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(rr),this.fsQuad.render(er)),er.setClearColor(this._oldClearColor,this.oldClearAlpha),er.autoClear=ar}getSeparableBlurMaterial(er){const tr=[];for(let rr=0;rr<er;rr++)tr.push(.39894*Math.exp(-.5*rr*rr/(er*er))/er);return new ShaderMaterial({defines:{KERNEL_RADIUS:er},uniforms:{colorTexture:{value:null},invSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)},gaussianCoefficients:{value:tr}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(er){return new ShaderMaterial({defines:{NUM_MIPS:er},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}UnrealBloomPass.BlurDirectionX=new Vector2(1,0);UnrealBloomPass.BlurDirectionY=new Vector2(0,1);class CSS2DObject extends Object3D{constructor(er=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=er,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Vector2(.5,.5),this.addEventListener("removed",function(){this.traverse(function(tr){tr.element instanceof tr.element.ownerDocument.defaultView.Element&&tr.element.parentNode!==null&&tr.element.remove()})})}copy(er,tr){return super.copy(er,tr),this.element=er.element.cloneNode(!0),this.center=er.center,this}}const _vector$1=new Vector3$1,_viewMatrix=new Matrix4,_viewProjectionMatrix=new Matrix4,_a=new Vector3$1,_b=new Vector3$1;class CSS2DRenderer{constructor(er={}){const tr=this;let rr,nr,sr,ar;const or={objects:new WeakMap},lr=er.element!==void 0?er.element:document.createElement("div");lr.style.overflow="hidden",this.domElement=lr,this.getSize=function(){return{width:rr,height:nr}},this.render=function(gr,_r){gr.matrixWorldAutoUpdate===!0&&gr.updateMatrixWorld(),_r.parent===null&&_r.matrixWorldAutoUpdate===!0&&_r.updateMatrixWorld(),_viewMatrix.copy(_r.matrixWorldInverse),_viewProjectionMatrix.multiplyMatrices(_r.projectionMatrix,_viewMatrix),hr(gr,gr,_r),pr(gr)},this.setSize=function(gr,_r){rr=gr,nr=_r,sr=rr/2,ar=nr/2,lr.style.width=gr+"px",lr.style.height=_r+"px"};function cr(gr){gr.isCSS2DObject&&(gr.element.style.display="none");for(let _r=0,mr=gr.children.length;_r<mr;_r++)cr(gr.children[_r])}function hr(gr,_r,mr){if(gr.visible===!1){cr(gr);return}if(gr.isCSS2DObject){_vector$1.setFromMatrixPosition(gr.matrixWorld),_vector$1.applyMatrix4(_viewProjectionMatrix);const dr=_vector$1.z>=-1&&_vector$1.z<=1&&gr.layers.test(mr.layers)===!0,vr=gr.element;vr.style.display=dr===!0?"":"none",dr===!0&&(gr.onBeforeRender(tr,_r,mr),vr.style.transform="translate("+-100*gr.center.x+"%,"+-100*gr.center.y+"%)translate("+(_vector$1.x*sr+sr)+"px,"+(-_vector$1.y*ar+ar)+"px)",vr.parentNode!==lr&&lr.appendChild(vr),gr.onAfterRender(tr,_r,mr));const Ar={distanceToCameraSquared:fr(mr,gr)};or.objects.set(gr,Ar)}for(let dr=0,vr=gr.children.length;dr<vr;dr++)hr(gr.children[dr],_r,mr)}function fr(gr,_r){return _a.setFromMatrixPosition(gr.matrixWorld),_b.setFromMatrixPosition(_r.matrixWorld),_a.distanceToSquared(_b)}function ur(gr){const _r=[];return gr.traverseVisible(function(mr){mr.isCSS2DObject&&_r.push(mr)}),_r}function pr(gr){const _r=ur(gr).sort(function(dr,vr){if(dr.renderOrder!==vr.renderOrder)return vr.renderOrder-dr.renderOrder;const Ar=or.objects.get(dr).distanceToCameraSquared,yr=or.objects.get(vr).distanceToCameraSquared;return Ar-yr}),mr=_r.length;for(let dr=0,vr=_r.length;dr<vr;dr++)_r[dr].element.style.zIndex=mr-dr}}}const _position=new Vector3$1,_quaternion=new Quaternion$1,_scale=new Vector3$1;class CSS3DObject extends Object3D{constructor(er=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=er,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(tr){tr.element instanceof tr.element.ownerDocument.defaultView.Element&&tr.element.parentNode!==null&&tr.element.remove()})})}copy(er,tr){return super.copy(er,tr),this.element=er.element.cloneNode(!0),this}}class CSS3DSprite extends CSS3DObject{constructor(er){super(er),this.isCSS3DSprite=!0,this.rotation2D=0}copy(er,tr){return super.copy(er,tr),this.rotation2D=er.rotation2D,this}}const _matrix$2=new Matrix4,_matrix2=new Matrix4;class CSS3DRenderer{constructor(er={}){const tr=this;let rr,nr,sr,ar;const or={camera:{style:""},objects:new WeakMap},lr=er.element!==void 0?er.element:document.createElement("div");lr.style.overflow="hidden",this.domElement=lr;const cr=document.createElement("div");cr.style.transformOrigin="0 0",cr.style.pointerEvents="none",lr.appendChild(cr);const hr=document.createElement("div");hr.style.transformStyle="preserve-3d",cr.appendChild(hr),this.getSize=function(){return{width:rr,height:nr}},this.render=function(mr,dr){const vr=dr.projectionMatrix.elements[5]*ar;dr.view&&dr.view.enabled?(cr.style.transform=`translate( ${-dr.view.offsetX*(rr/dr.view.width)}px, ${-dr.view.offsetY*(nr/dr.view.height)}px )`,cr.style.transform+=`scale( ${dr.view.fullWidth/dr.view.width}, ${dr.view.fullHeight/dr.view.height} )`):cr.style.transform="",mr.matrixWorldAutoUpdate===!0&&mr.updateMatrixWorld(),dr.parent===null&&dr.matrixWorldAutoUpdate===!0&&dr.updateMatrixWorld();let Ar,yr;dr.isOrthographicCamera&&(Ar=-(dr.right+dr.left)/2,yr=(dr.top+dr.bottom)/2);const wr=dr.view&&dr.view.enabled?dr.view.height/dr.view.fullHeight:1,br=dr.isOrthographicCamera?`scale( ${wr} )scale(`+vr+")translate("+fr(Ar)+"px,"+fr(yr)+"px)"+ur(dr.matrixWorldInverse):`scale( ${wr} )translateZ(`+vr+"px)"+ur(dr.matrixWorldInverse),xr=(dr.isPerspectiveCamera?"perspective("+vr+"px) ":"")+br+"translate("+sr+"px,"+ar+"px)";or.camera.style!==xr&&(hr.style.transform=xr,or.camera.style=xr),_r(mr,mr,dr,br)},this.setSize=function(mr,dr){rr=mr,nr=dr,sr=rr/2,ar=nr/2,lr.style.width=mr+"px",lr.style.height=dr+"px",cr.style.width=mr+"px",cr.style.height=dr+"px",hr.style.width=mr+"px",hr.style.height=dr+"px"};function fr(mr){return Math.abs(mr)<1e-10?0:mr}function ur(mr){const dr=mr.elements;return"matrix3d("+fr(dr[0])+","+fr(-dr[1])+","+fr(dr[2])+","+fr(dr[3])+","+fr(dr[4])+","+fr(-dr[5])+","+fr(dr[6])+","+fr(dr[7])+","+fr(dr[8])+","+fr(-dr[9])+","+fr(dr[10])+","+fr(dr[11])+","+fr(dr[12])+","+fr(-dr[13])+","+fr(dr[14])+","+fr(dr[15])+")"}function pr(mr){const dr=mr.elements;return"translate(-50%,-50%)"+("matrix3d("+fr(dr[0])+","+fr(dr[1])+","+fr(dr[2])+","+fr(dr[3])+","+fr(-dr[4])+","+fr(-dr[5])+","+fr(-dr[6])+","+fr(-dr[7])+","+fr(dr[8])+","+fr(dr[9])+","+fr(dr[10])+","+fr(dr[11])+","+fr(dr[12])+","+fr(dr[13])+","+fr(dr[14])+","+fr(dr[15])+")")}function gr(mr){mr.isCSS3DObject&&(mr.element.style.display="none");for(let dr=0,vr=mr.children.length;dr<vr;dr++)gr(mr.children[dr])}function _r(mr,dr,vr,Ar){if(mr.visible===!1){gr(mr);return}if(mr.isCSS3DObject){const yr=mr.layers.test(vr.layers)===!0,wr=mr.element;if(wr.style.display=yr===!0?"":"none",yr===!0){mr.onBeforeRender(tr,dr,vr);let br;mr.isCSS3DSprite?(_matrix$2.copy(vr.matrixWorldInverse),_matrix$2.transpose(),mr.rotation2D!==0&&_matrix$2.multiply(_matrix2.makeRotationZ(mr.rotation2D)),mr.matrixWorld.decompose(_position,_quaternion,_scale),_matrix$2.setPosition(_position),_matrix$2.scale(_scale),_matrix$2.elements[3]=0,_matrix$2.elements[7]=0,_matrix$2.elements[11]=0,_matrix$2.elements[15]=1,br=pr(_matrix$2)):br=pr(mr.matrixWorld);const Sr=or.objects.get(mr);if(Sr===void 0||Sr.style!==br){wr.style.transform=br;const xr={style:br};or.objects.set(mr,xr)}wr.parentNode!==hr&&hr.appendChild(wr),mr.onAfterRender(tr,dr,vr)}}for(let yr=0,wr=mr.children.length;yr<wr;yr++)_r(mr.children[yr],dr,vr,Ar)}}}class RenderableObject{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class RenderableFace{constructor(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.v3=new RenderableVertex,this.normalModel=new Vector3$1,this.vertexNormalsModel=[new Vector3$1,new Vector3$1,new Vector3$1],this.vertexNormalsLength=0,this.color=new Color,this.material=null,this.uvs=[new Vector2,new Vector2,new Vector2],this.z=0,this.renderOrder=0}}class RenderableVertex{constructor(){this.position=new Vector3$1,this.positionWorld=new Vector3$1,this.positionScreen=new Vector4,this.visible=!0}copy(er){this.positionWorld.copy(er.positionWorld),this.positionScreen.copy(er.positionScreen)}}class RenderableLine{constructor(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.vertexColors=[new Color,new Color],this.material=null,this.z=0,this.renderOrder=0}}class RenderableSprite{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new Vector2,this.material=null,this.renderOrder=0}}class Projector{constructor(){let er,tr,rr=0,nr,sr,ar=0,or,lr,cr=0,hr,fr,ur=0,pr,gr,_r=0,mr;const dr={objects:[],lights:[],elements:[]},vr=new Vector3$1,Ar=new Vector4,yr=new Box3(new Vector3$1(-1,-1,-1),new Vector3$1(1,1,1)),wr=new Box3,br=new Array(3),Sr=new Matrix4,xr=new Matrix4,Cr=new Matrix4,Ir=new Frustum,Rr=[],Pr=[],Fr=[],Nr=[],Ur=[];function Br(){const qr=[],ji=[],Zr=[];let Zi=null;const Yi=new Matrix3;function qi(Ri){Zi=Ri,Yi.getNormalMatrix(Zi.matrixWorld),qr.length=0,ji.length=0,Zr.length=0}function Xr(Ri){const Jr=Ri.position,Xi=Ri.positionWorld,ss=Ri.positionScreen;Xi.copy(Jr).applyMatrix4(mr),ss.copy(Xi).applyMatrix4(xr);const ls=1/ss.w;ss.x*=ls,ss.y*=ls,ss.z*=ls,Ri.visible=ss.x>=-1&&ss.x<=1&&ss.y>=-1&&ss.y<=1&&ss.z>=-1&&ss.z<=1}function ns(Ri,Jr,Xi){nr=Qi(),nr.position.set(Ri,Jr,Xi),Xr(nr)}function os(Ri,Jr,Xi){qr.push(Ri,Jr,Xi)}function us(Ri,Jr,Xi){ji.push(Ri,Jr,Xi)}function is(Ri,Jr){Zr.push(Ri,Jr)}function Ji(Ri,Jr,Xi){return Ri.visible===!0||Jr.visible===!0||Xi.visible===!0?!0:(br[0]=Ri.positionScreen,br[1]=Jr.positionScreen,br[2]=Xi.positionScreen,yr.intersectsBox(wr.setFromPoints(br)))}function ms(Ri,Jr,Xi){return(Xi.positionScreen.x-Ri.positionScreen.x)*(Jr.positionScreen.y-Ri.positionScreen.y)-(Xi.positionScreen.y-Ri.positionScreen.y)*(Jr.positionScreen.x-Ri.positionScreen.x)<0}function Ki(Ri,Jr){const Xi=Pr[Ri],ss=Pr[Jr];Xi.positionScreen.copy(Xi.position).applyMatrix4(Cr),ss.positionScreen.copy(ss.position).applyMatrix4(Cr),Gr(Xi.positionScreen,ss.positionScreen)===!0&&(Xi.positionScreen.multiplyScalar(1/Xi.positionScreen.w),ss.positionScreen.multiplyScalar(1/ss.positionScreen.w),hr=Kr(),hr.id=Zi.id,hr.v1.copy(Xi),hr.v2.copy(ss),hr.z=Math.max(Xi.positionScreen.z,ss.positionScreen.z),hr.renderOrder=Zi.renderOrder,hr.material=Zi.material,Zi.material.vertexColors&&(hr.vertexColors[0].fromArray(ji,Ri*3),hr.vertexColors[1].fromArray(ji,Jr*3)),dr.elements.push(hr))}function Ni(Ri,Jr,Xi,ss){const ls=Pr[Ri],gs=Pr[Jr],_s=Pr[Xi];if(Ji(ls,gs,_s)!==!1&&(ss.side===DoubleSide||ms(ls,gs,_s)===!0)){or=rs(),or.id=Zi.id,or.v1.copy(ls),or.v2.copy(gs),or.v3.copy(_s),or.z=(ls.positionScreen.z+gs.positionScreen.z+_s.positionScreen.z)/3,or.renderOrder=Zi.renderOrder,vr.subVectors(_s.position,gs.position),Ar.subVectors(ls.position,gs.position),vr.cross(Ar),or.normalModel.copy(vr),or.normalModel.applyMatrix3(Yi).normalize();for(let vs=0;vs<3;vs++){const As=or.vertexNormalsModel[vs];As.fromArray(qr,arguments[vs]*3),As.applyMatrix3(Yi).normalize(),or.uvs[vs].fromArray(Zr,arguments[vs]*2)}or.vertexNormalsLength=3,or.material=ss,ss.vertexColors&&or.color.fromArray(ji,Ri*3),dr.elements.push(or)}}return{setObject:qi,projectVertex:Xr,checkTriangleVisibility:Ji,checkBackfaceCulling:ms,pushVertex:ns,pushNormal:os,pushColor:us,pushUv:is,pushLine:Ki,pushTriangle:Ni}}const Or=new Br;function Dr(qr){if(qr.visible===!1)return;if(qr.isLight)dr.lights.push(qr);else if(qr.isMesh||qr.isLine||qr.isPoints){if(qr.material.visible===!1||qr.frustumCulled===!0&&Ir.intersectsObject(qr)===!1)return;Wr(qr)}else if(qr.isSprite){if(qr.material.visible===!1||qr.frustumCulled===!0&&Ir.intersectsSprite(qr)===!1)return;Wr(qr)}const ji=qr.children;for(let Zr=0,Zi=ji.length;Zr<Zi;Zr++)Dr(ji[Zr])}function Wr(qr){er=Yr(),er.id=qr.id,er.object=qr,vr.setFromMatrixPosition(qr.matrixWorld),vr.applyMatrix4(xr),er.z=vr.z,er.renderOrder=qr.renderOrder,dr.objects.push(er)}this.projectScene=function(qr,ji,Zr,Zi){lr=0,fr=0,gr=0,dr.elements.length=0,qr.matrixWorldAutoUpdate===!0&&qr.updateMatrixWorld(),ji.parent===null&&ji.matrixWorldAutoUpdate===!0&&ji.updateMatrixWorld(),Sr.copy(ji.matrixWorldInverse),xr.multiplyMatrices(ji.projectionMatrix,Sr),Ir.setFromProjectionMatrix(xr),tr=0,dr.objects.length=0,dr.lights.length=0,Dr(qr),Zr===!0&&dr.objects.sort(Vr);const Yi=dr.objects;for(let qi=0,Xr=Yi.length;qi<Xr;qi++){const ns=Yi[qi].object,os=ns.geometry;if(Or.setObject(ns),mr=ns.matrixWorld,sr=0,ns.isMesh){let us=ns.material;const is=Array.isArray(us),Ji=os.attributes,ms=os.groups;if(Ji.position===void 0)continue;const Ki=Ji.position.array;for(let Ni=0,Ri=Ki.length;Ni<Ri;Ni+=3){let Jr=Ki[Ni],Xi=Ki[Ni+1],ss=Ki[Ni+2];const ls=os.morphAttributes.position;if(ls!==void 0){const gs=os.morphTargetsRelative,_s=ns.morphTargetInfluences;for(let vs=0,As=ls.length;vs<As;vs++){const Ss=_s[vs];if(Ss===0)continue;const Is=ls[vs];gs?(Jr+=Is.getX(Ni/3)*Ss,Xi+=Is.getY(Ni/3)*Ss,ss+=Is.getZ(Ni/3)*Ss):(Jr+=(Is.getX(Ni/3)-Ki[Ni])*Ss,Xi+=(Is.getY(Ni/3)-Ki[Ni+1])*Ss,ss+=(Is.getZ(Ni/3)-Ki[Ni+2])*Ss)}}Or.pushVertex(Jr,Xi,ss)}if(Ji.normal!==void 0){const Ni=Ji.normal.array;for(let Ri=0,Jr=Ni.length;Ri<Jr;Ri+=3)Or.pushNormal(Ni[Ri],Ni[Ri+1],Ni[Ri+2])}if(Ji.color!==void 0){const Ni=Ji.color.array;for(let Ri=0,Jr=Ni.length;Ri<Jr;Ri+=3)Or.pushColor(Ni[Ri],Ni[Ri+1],Ni[Ri+2])}if(Ji.uv!==void 0){const Ni=Ji.uv.array;for(let Ri=0,Jr=Ni.length;Ri<Jr;Ri+=2)Or.pushUv(Ni[Ri],Ni[Ri+1])}if(os.index!==null){const Ni=os.index.array;if(ms.length>0)for(let Ri=0;Ri<ms.length;Ri++){const Jr=ms[Ri];if(us=is===!0?ns.material[Jr.materialIndex]:ns.material,us!==void 0)for(let Xi=Jr.start,ss=Jr.start+Jr.count;Xi<ss;Xi+=3)Or.pushTriangle(Ni[Xi],Ni[Xi+1],Ni[Xi+2],us)}else for(let Ri=0,Jr=Ni.length;Ri<Jr;Ri+=3)Or.pushTriangle(Ni[Ri],Ni[Ri+1],Ni[Ri+2],us)}else if(ms.length>0)for(let Ni=0;Ni<ms.length;Ni++){const Ri=ms[Ni];if(us=is===!0?ns.material[Ri.materialIndex]:ns.material,us!==void 0)for(let Jr=Ri.start,Xi=Ri.start+Ri.count;Jr<Xi;Jr+=3)Or.pushTriangle(Jr,Jr+1,Jr+2,us)}else for(let Ni=0,Ri=Ki.length/3;Ni<Ri;Ni+=3)Or.pushTriangle(Ni,Ni+1,Ni+2,us)}else if(ns.isLine){Cr.multiplyMatrices(xr,mr);const us=os.attributes;if(us.position!==void 0){const is=us.position.array;for(let Ji=0,ms=is.length;Ji<ms;Ji+=3)Or.pushVertex(is[Ji],is[Ji+1],is[Ji+2]);if(us.color!==void 0){const Ji=us.color.array;for(let ms=0,Ki=Ji.length;ms<Ki;ms+=3)Or.pushColor(Ji[ms],Ji[ms+1],Ji[ms+2])}if(os.index!==null){const Ji=os.index.array;for(let ms=0,Ki=Ji.length;ms<Ki;ms+=2)Or.pushLine(Ji[ms],Ji[ms+1])}else{const Ji=ns.isLineSegments?2:1;for(let ms=0,Ki=is.length/3-1;ms<Ki;ms+=Ji)Or.pushLine(ms,ms+1)}}}else if(ns.isPoints){Cr.multiplyMatrices(xr,mr);const us=os.attributes;if(us.position!==void 0){const is=us.position.array;for(let Ji=0,ms=is.length;Ji<ms;Ji+=3)Ar.set(is[Ji],is[Ji+1],is[Ji+2],1),Ar.applyMatrix4(Cr),$r(Ar,ns,ji)}}else ns.isSprite&&(ns.modelViewMatrix.multiplyMatrices(ji.matrixWorldInverse,ns.matrixWorld),Ar.set(mr.elements[12],mr.elements[13],mr.elements[14],1),Ar.applyMatrix4(xr),$r(Ar,ns,ji))}return Zi===!0&&dr.elements.sort(Vr),dr};function $r(qr,ji,Zr){const Zi=1/qr.w;qr.z*=Zi,qr.z>=-1&&qr.z<=1&&(pr=Qr(),pr.id=ji.id,pr.x=qr.x*Zi,pr.y=qr.y*Zi,pr.z=qr.z,pr.renderOrder=ji.renderOrder,pr.object=ji,pr.rotation=ji.rotation,pr.scale.x=ji.scale.x*Math.abs(pr.x-(qr.x+Zr.projectionMatrix.elements[0])/(qr.w+Zr.projectionMatrix.elements[12])),pr.scale.y=ji.scale.y*Math.abs(pr.y-(qr.y+Zr.projectionMatrix.elements[5])/(qr.w+Zr.projectionMatrix.elements[13])),pr.material=ji.material,dr.elements.push(pr))}function Yr(){if(tr===rr){const qr=new RenderableObject;return Rr.push(qr),rr++,tr++,qr}return Rr[tr++]}function Qi(){if(sr===ar){const qr=new RenderableVertex;return Pr.push(qr),ar++,sr++,qr}return Pr[sr++]}function rs(){if(lr===cr){const qr=new RenderableFace;return Fr.push(qr),cr++,lr++,qr}return Fr[lr++]}function Kr(){if(fr===ur){const qr=new RenderableLine;return Nr.push(qr),ur++,fr++,qr}return Nr[fr++]}function Qr(){if(gr===_r){const qr=new RenderableSprite;return Ur.push(qr),_r++,gr++,qr}return Ur[gr++]}function Vr(qr,ji){return qr.renderOrder!==ji.renderOrder?qr.renderOrder-ji.renderOrder:qr.z!==ji.z?ji.z-qr.z:qr.id!==ji.id?qr.id-ji.id:0}function Gr(qr,ji){let Zr=0,Zi=1;const Yi=qr.z+qr.w,qi=ji.z+ji.w,Xr=-qr.z+qr.w,ns=-ji.z+ji.w;return Yi>=0&&qi>=0&&Xr>=0&&ns>=0?!0:Yi<0&&qi<0||Xr<0&&ns<0?!1:(Yi<0?Zr=Math.max(Zr,Yi/(Yi-qi)):qi<0&&(Zi=Math.min(Zi,Yi/(Yi-qi))),Xr<0?Zr=Math.max(Zr,Xr/(Xr-ns)):ns<0&&(Zi=Math.min(Zi,Xr/(Xr-ns))),Zi<Zr?!1:(qr.lerp(ji,Zr),ji.lerp(qr,1-Zi),!0))}}}class SVGObject extends Object3D{constructor(er){super(),this.isSVGObject=!0,this.node=er}}class SVGRenderer{constructor(){let er,tr,rr,nr,sr,ar,or,lr,cr,hr,fr,ur=0,pr=null,gr=1,_r,mr;const dr=this,vr=new Box2,Ar=new Box2,yr=new Color,wr=new Color,br=new Color,Sr=new Color,xr=new Color,Cr=new Color,Ir=new Vector3$1,Rr=new Vector3$1,Pr=new Vector3$1,Fr=new Matrix3,Nr=new Matrix4,Ur=new Matrix4,Br=[],Or=new Projector,Dr=document.createElementNS("http://www.w3.org/2000/svg","svg");this.domElement=Dr,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.outputColorSpace=SRGBColorSpace,this.info={render:{vertices:0,faces:0}},this.setQuality=function(Zr){switch(Zr){case"high":gr=1;break;case"low":gr=0;break}},this.setClearColor=function(Zr){Cr.set(Zr)},this.setPixelRatio=function(){},this.setSize=function(Zr,Zi){nr=Zr,sr=Zi,ar=nr/2,or=sr/2,Dr.setAttribute("viewBox",-ar+" "+-or+" "+nr+" "+sr),Dr.setAttribute("width",nr),Dr.setAttribute("height",sr),vr.min.set(-ar,-or),vr.max.set(ar,or)},this.getSize=function(){return{width:nr,height:sr}},this.setPrecision=function(Zr){pr=Zr};function Wr(){for(ur=0;Dr.childNodes.length>0;)Dr.removeChild(Dr.childNodes[0])}function $r(Zr){return pr!==null?Zr.toFixed(pr):Zr}this.clear=function(){Wr(),Dr.style.backgroundColor=Cr.getStyle(dr.outputColorSpace)},this.render=function(Zr,Zi){if(!(Zi instanceof Camera)){console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");return}const Yi=Zr.background;Yi&&Yi.isColor?(Wr(),Dr.style.backgroundColor=Yi.getStyle(dr.outputColorSpace)):this.autoClear===!0&&this.clear(),dr.info.render.vertices=0,dr.info.render.faces=0,Nr.copy(Zi.matrixWorldInverse),Ur.multiplyMatrices(Zi.projectionMatrix,Nr),er=Or.projectScene(Zr,Zi,this.sortObjects,this.sortElements),tr=er.elements,rr=er.lights,Fr.getNormalMatrix(Zi.matrixWorldInverse),Yr(rr),_r="",mr="";for(let qi=0,Xr=tr.length;qi<Xr;qi++){const ns=tr[qi],os=ns.material;if(!(os===void 0||os.opacity===0)){if(Ar.makeEmpty(),ns instanceof RenderableSprite)lr=ns,lr.x*=ar,lr.y*=-or,rs(lr,ns,os);else if(ns instanceof RenderableLine)lr=ns.v1,cr=ns.v2,lr.positionScreen.x*=ar,lr.positionScreen.y*=-or,cr.positionScreen.x*=ar,cr.positionScreen.y*=-or,Ar.setFromPoints([lr.positionScreen,cr.positionScreen]),vr.intersectsBox(Ar)===!0&&Kr(lr,cr,os);else if(ns instanceof RenderableFace){if(lr=ns.v1,cr=ns.v2,hr=ns.v3,lr.positionScreen.z<-1||lr.positionScreen.z>1||cr.positionScreen.z<-1||cr.positionScreen.z>1||hr.positionScreen.z<-1||hr.positionScreen.z>1)continue;lr.positionScreen.x*=ar,lr.positionScreen.y*=-or,cr.positionScreen.x*=ar,cr.positionScreen.y*=-or,hr.positionScreen.x*=ar,hr.positionScreen.y*=-or,this.overdraw>0&&(Vr(lr.positionScreen,cr.positionScreen,this.overdraw),Vr(cr.positionScreen,hr.positionScreen,this.overdraw),Vr(hr.positionScreen,lr.positionScreen,this.overdraw)),Ar.setFromPoints([lr.positionScreen,cr.positionScreen,hr.positionScreen]),vr.intersectsBox(Ar)===!0&&Qr(lr,cr,hr,ns,os)}}}qr(),Zr.traverseVisible(function(qi){if(qi.isSVGObject){if(Ir.setFromMatrixPosition(qi.matrixWorld),Ir.applyMatrix4(Ur),Ir.z<-1||Ir.z>1)return;const Xr=Ir.x*ar,ns=-Ir.y*or,os=qi.node;os.setAttribute("transform","translate("+Xr+","+ns+")"),Dr.appendChild(os)}})};function Yr(Zr){br.setRGB(0,0,0),Sr.setRGB(0,0,0),xr.setRGB(0,0,0);for(let Zi=0,Yi=Zr.length;Zi<Yi;Zi++){const qi=Zr[Zi],Xr=qi.color;qi.isAmbientLight?(br.r+=Xr.r,br.g+=Xr.g,br.b+=Xr.b):qi.isDirectionalLight?(Sr.r+=Xr.r,Sr.g+=Xr.g,Sr.b+=Xr.b):qi.isPointLight&&(xr.r+=Xr.r,xr.g+=Xr.g,xr.b+=Xr.b)}}function Qi(Zr,Zi,Yi,qi){for(let Xr=0,ns=Zr.length;Xr<ns;Xr++){const os=Zr[Xr],us=os.color;if(os.isDirectionalLight){const is=Ir.setFromMatrixPosition(os.matrixWorld).normalize();let Ji=Yi.dot(is);if(Ji<=0)continue;Ji*=os.intensity,qi.r+=us.r*Ji,qi.g+=us.g*Ji,qi.b+=us.b*Ji}else if(os.isPointLight){const is=Ir.setFromMatrixPosition(os.matrixWorld);let Ji=Yi.dot(Ir.subVectors(is,Zi).normalize());if(Ji<=0||(Ji*=os.distance==0?1:1-Math.min(Zi.distanceTo(is)/os.distance,1),Ji==0))continue;Ji*=os.intensity,qi.r+=us.r*Ji,qi.g+=us.g*Ji,qi.b+=us.b*Ji}}}function rs(Zr,Zi,Yi){let qi=Zi.scale.x*ar,Xr=Zi.scale.y*or;Yi.isPointsMaterial&&(qi*=Yi.size,Xr*=Yi.size);const ns="M"+$r(Zr.x-qi*.5)+","+$r(Zr.y-Xr*.5)+"h"+$r(qi)+"v"+$r(Xr)+"h"+$r(-qi)+"z";let os="";(Yi.isSpriteMaterial||Yi.isPointsMaterial)&&(os="fill:"+Yi.color.getStyle(dr.outputColorSpace)+";fill-opacity:"+Yi.opacity),Gr(os,ns)}function Kr(Zr,Zi,Yi){const qi="M"+$r(Zr.positionScreen.x)+","+$r(Zr.positionScreen.y)+"L"+$r(Zi.positionScreen.x)+","+$r(Zi.positionScreen.y);if(Yi.isLineBasicMaterial){let Xr="fill:none;stroke:"+Yi.color.getStyle(dr.outputColorSpace)+";stroke-opacity:"+Yi.opacity+";stroke-width:"+Yi.linewidth+";stroke-linecap:"+Yi.linecap;Yi.isLineDashedMaterial&&(Xr=Xr+";stroke-dasharray:"+Yi.dashSize+","+Yi.gapSize),Gr(Xr,qi)}}function Qr(Zr,Zi,Yi,qi,Xr){dr.info.render.vertices+=3,dr.info.render.faces++;const ns="M"+$r(Zr.positionScreen.x)+","+$r(Zr.positionScreen.y)+"L"+$r(Zi.positionScreen.x)+","+$r(Zi.positionScreen.y)+"L"+$r(Yi.positionScreen.x)+","+$r(Yi.positionScreen.y)+"z";let os="";Xr.isMeshBasicMaterial?(yr.copy(Xr.color),Xr.vertexColors&&yr.multiply(qi.color)):Xr.isMeshLambertMaterial||Xr.isMeshPhongMaterial||Xr.isMeshStandardMaterial?(wr.copy(Xr.color),Xr.vertexColors&&wr.multiply(qi.color),yr.copy(br),Rr.copy(Zr.positionWorld).add(Zi.positionWorld).add(Yi.positionWorld).divideScalar(3),Qi(rr,Rr,qi.normalModel,yr),yr.multiply(wr).add(Xr.emissive)):Xr.isMeshNormalMaterial&&(Pr.copy(qi.normalModel).applyMatrix3(Fr).normalize(),yr.setRGB(Pr.x,Pr.y,Pr.z).multiplyScalar(.5).addScalar(.5)),Xr.wireframe?os="fill:none;stroke:"+yr.getStyle(dr.outputColorSpace)+";stroke-opacity:"+Xr.opacity+";stroke-width:"+Xr.wireframeLinewidth+";stroke-linecap:"+Xr.wireframeLinecap+";stroke-linejoin:"+Xr.wireframeLinejoin:os="fill:"+yr.getStyle(dr.outputColorSpace)+";fill-opacity:"+Xr.opacity,Gr(os,ns)}function Vr(Zr,Zi,Yi){let qi=Zi.x-Zr.x,Xr=Zi.y-Zr.y;const ns=qi*qi+Xr*Xr;if(ns===0)return;const os=Yi/Math.sqrt(ns);qi*=os,Xr*=os,Zi.x+=qi,Zi.y+=Xr,Zr.x-=qi,Zr.y-=Xr}function Gr(Zr,Zi){mr===Zr?_r+=Zi:(qr(),mr=Zr,_r=Zi)}function qr(){_r&&(fr=ji(ur++),fr.setAttribute("d",_r),fr.setAttribute("style",mr),Dr.appendChild(fr)),_r="",mr=""}function ji(Zr){return Br[Zr]==null&&(Br[Zr]=document.createElementNS("http://www.w3.org/2000/svg","path"),gr==0&&Br[Zr].setAttribute("shape-rendering","crispEdges")),Br[Zr]}}}const ACESFilmicToneMappingShader={name:"ACESFilmicToneMappingShader",uniforms:{tDiffuse:{value:null},exposure:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#define saturate(a) clamp( a, 0.0, 1.0 )

		uniform sampler2D tDiffuse;

		uniform float exposure;

		varying vec2 vUv;

		vec3 RRTAndODTFit( vec3 v ) {

			vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
			vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
			return a / b;

		}

		vec3 ACESFilmicToneMapping( vec3 color ) {

		// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT
			const mat3 ACESInputMat = mat3(
				vec3( 0.59719, 0.07600, 0.02840 ), // transposed from source
				vec3( 0.35458, 0.90834, 0.13383 ),
				vec3( 0.04823, 0.01566, 0.83777 )
			);

		// ODT_SAT => XYZ => D60_2_D65 => sRGB
			const mat3 ACESOutputMat = mat3(
				vec3(  1.60475, -0.10208, -0.00327 ), // transposed from source
				vec3( -0.53108,  1.10813, -0.07276 ),
				vec3( -0.07367, -0.00605,  1.07602 )
			);

			color = ACESInputMat * color;

		// Apply RRT and ODT
			color = RRTAndODTFit( color );

			color = ACESOutputMat * color;

		// Clamp to [0, 1]
			return saturate( color );

		}

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			tex.rgb *= exposure / 0.6; // pre-exposed, outside of the tone mapping function

			gl_FragColor = vec4( ACESFilmicToneMapping( tex.rgb ), tex.a );

		}`},BasicShader={name:"BasicShader",uniforms:{},vertexShader:`

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		void main() {

			gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );

		}`},BleachBypassShader={name:"BleachBypassShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 base = texture2D( tDiffuse, vUv );

			float lum = luminance( base.rgb );
			vec3 blend = vec3( lum );

			float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );

			vec3 result1 = 2.0 * base.rgb * blend;
			vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );

			vec3 newColor = mix( result1, result2, L );

			float A2 = opacity * base.a;
			vec3 mixRGB = A2 * newColor.rgb;
			mixRGB += ( ( 1.0 - A2 ) * base.rgb );

			gl_FragColor = vec4( mixRGB, base.a );

		}`},BlendShader={name:"BlendShader",uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;
		uniform float mixRatio;

		uniform sampler2D tDiffuse1;
		uniform sampler2D tDiffuse2;

		varying vec2 vUv;

		void main() {

			vec4 texel1 = texture2D( tDiffuse1, vUv );
			vec4 texel2 = texture2D( tDiffuse2, vUv );
			gl_FragColor = opacity * mix( texel1, texel2, mixRatio );

		}`},BokehShader={name:"BokehShader",uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new Vector2}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		varying vec2 vUv;

		uniform sampler2D tColor;
		uniform sampler2D tDepth;
		uniform float textureWidth;
		uniform float textureHeight;

		uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below
		uniform float focalLength; //focal length in mm
		uniform float fstop; //f-stop value
		uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)

		/*
		make sure that these two values are the same for your camera, otherwise distances will be wrong.
		*/

		uniform float znear; // camera clipping start
		uniform float zfar; // camera clipping end

		//------------------------------------------
		//user variables

		const int samples = SAMPLES; //samples on the first ring
		const int rings = RINGS; //ring count

		const int maxringsamples = rings * samples;

		uniform bool manualdof; // manual dof calculation
		float ndofstart = 1.0; // near dof blur start
		float ndofdist = 2.0; // near dof blur falloff distance
		float fdofstart = 1.0; // far dof blur start
		float fdofdist = 3.0; // far dof blur falloff distance

		float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)

		uniform bool vignetting; // use optical lens vignetting

		float vignout = 1.3; // vignetting outer border
		float vignin = 0.0; // vignetting inner border
		float vignfade = 22.0; // f-stops till vignette fades

		uniform bool shaderFocus;
		// disable if you use external focalDepth value

		uniform vec2 focusCoords;
		// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)
		// if center of screen use vec2(0.5, 0.5);

		uniform float maxblur;
		//clamp value of max blur (0.0 = no blur, 1.0 default)

		uniform float threshold; // highlight threshold;
		uniform float gain; // highlight gain;

		uniform float bias; // bokeh edge bias
		uniform float fringe; // bokeh chromatic aberration / fringing

		uniform bool noise; //use noise instead of pattern for sample dithering

		uniform float dithering;

		uniform bool depthblur; // blur the depth buffer
		float dbsize = 1.25; // depth blur size

		/*
		next part is experimental
		not looking good with small sample and ring count
		looks okay starting from samples = 4, rings = 4
		*/

		uniform bool pentagon; //use pentagon as bokeh shape?
		float feather = 0.4; //pentagon shape feather

		//------------------------------------------

		float penta(vec2 coords) {
			//pentagonal shape
			float scale = float(rings) - 1.3;
			vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);
			vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);
			vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);
			vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);
			vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);
			vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);

			vec4  one = vec4( 1.0 );

			vec4 P = vec4((coords),vec2(scale, scale));

			vec4 dist = vec4(0.0);
			float inorout = -4.0;

			dist.x = dot( P, HS0 );
			dist.y = dot( P, HS1 );
			dist.z = dot( P, HS2 );
			dist.w = dot( P, HS3 );

			dist = smoothstep( -feather, feather, dist );

			inorout += dot( dist, one );

			dist.x = dot( P, HS4 );
			dist.y = HS5.w - abs( P.z );

			dist = smoothstep( -feather, feather, dist );
			inorout += dist.x;

			return clamp( inorout, 0.0, 1.0 );
		}

		float bdepth(vec2 coords) {
			// Depth buffer blur
			float d = 0.0;
			float kernel[9];
			vec2 offset[9];

			vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;

			offset[0] = vec2(-wh.x,-wh.y);
			offset[1] = vec2( 0.0, -wh.y);
			offset[2] = vec2( wh.x -wh.y);

			offset[3] = vec2(-wh.x,  0.0);
			offset[4] = vec2( 0.0,   0.0);
			offset[5] = vec2( wh.x,  0.0);

			offset[6] = vec2(-wh.x, wh.y);
			offset[7] = vec2( 0.0,  wh.y);
			offset[8] = vec2( wh.x, wh.y);

			kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;
			kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;
			kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;


			for( int i=0; i<9; i++ ) {
				float tmp = texture2D(tDepth, coords + offset[i]).r;
				d += tmp * kernel[i];
			}

			return d;
		}


		vec3 color(vec2 coords,float blur) {
			//processing the sample

			vec3 col = vec3(0.0);
			vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);

			col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;
			col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;
			col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;

			vec3 lumcoeff = vec3(0.299,0.587,0.114);
			float lum = dot(col.rgb, lumcoeff);
			float thresh = max((lum-threshold)*gain, 0.0);
			return col+mix(vec3(0.0),col,thresh*blur);
		}

		vec3 debugFocus(vec3 col, float blur, float depth) {
			float edge = 0.002*depth; //distance based edge smoothing
			float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);
			float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);

			col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);
			col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);

			return col;
		}

		float linearize(float depth) {
			return -zfar * znear / (depth * (zfar - znear) - zfar);
		}

		float vignette() {
			float dist = distance(vUv.xy, vec2(0.5,0.5));
			dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);
			return clamp(dist,0.0,1.0);
		}

		float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {
			float rings2 = float(rings);
			float step = PI*2.0 / float(ringsamples);
			float pw = cos(j*step)*i;
			float ph = sin(j*step)*i;
			float p = 1.0;
			if (pentagon) {
				p = penta(vec2(pw,ph));
			}
			col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;
			return 1.0 * mix(1.0, i /rings2, bias) * p;
		}

		void main() {
			//scene depth calculation

			float depth = linearize(texture2D(tDepth,vUv.xy).x);

			// Blur depth?
			if ( depthblur ) {
				depth = linearize(bdepth(vUv.xy));
			}

			//focal plane calculation

			float fDepth = focalDepth;

			if (shaderFocus) {

				fDepth = linearize(texture2D(tDepth,focusCoords).x);

			}

			// dof blur factor calculation

			float blur = 0.0;

			if (manualdof) {
				float a = depth-fDepth; // Focal plane
				float b = (a-fdofstart)/fdofdist; // Far DoF
				float c = (-a-ndofstart)/ndofdist; // Near Dof
				blur = (a>0.0) ? b : c;
			} else {
				float f = focalLength; // focal length in mm
				float d = fDepth*1000.0; // focal plane in mm
				float o = depth*1000.0; // depth in mm

				float a = (o*f)/(o-f);
				float b = (d*f)/(d-f);
				float c = (d-f)/(d*fstop*CoC);

				blur = abs(a-b)*c;
			}

			blur = clamp(blur,0.0,1.0);

			// calculation of pattern for dithering

			vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;

			// getting blur x and y step factor

			float w = (1.0/textureWidth)*blur*maxblur+noise.x;
			float h = (1.0/textureHeight)*blur*maxblur+noise.y;

			// calculation of final color

			vec3 col = vec3(0.0);

			if(blur < 0.05) {
				//some optimization thingy
				col = texture2D(tColor, vUv.xy).rgb;
			} else {
				col = texture2D(tColor, vUv.xy).rgb;
				float s = 1.0;
				int ringsamples;

				for (int i = 1; i <= rings; i++) {
					/*unboxstart*/
					ringsamples = i * samples;

					for (int j = 0 ; j < maxringsamples ; j++) {
						if (j >= ringsamples) break;
						s += gather(float(i), float(j), ringsamples, col, w, h, blur);
					}
					/*unboxend*/
				}

				col /= s; //divide by sample count
			}

			if (showFocus) {
				col = debugFocus(col, blur, depth);
			}

			if (vignetting) {
				col *= vignette();
			}

			gl_FragColor.rgb = col;
			gl_FragColor.a = 1.0;

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
		}`},BokehDepthShader={name:"BokehDepthShader",uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:`

		varying float vViewZDepth;

		void main() {

			#include <begin_vertex>
			#include <project_vertex>

			vViewZDepth = - mvPosition.z;

		}`,fragmentShader:`

		uniform float mNear;
		uniform float mFar;

		varying float vViewZDepth;

		void main() {

			float color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );
			gl_FragColor = vec4( vec3( color ), 1.0 );

		}`},BrightnessContrastShader={name:"BrightnessContrastShader",uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float brightness;
		uniform float contrast;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			gl_FragColor.rgb += brightness;

			if (contrast > 0.0) {
				gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;
			} else {
				gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;
			}

		}`},ColorCorrectionShader={name:"ColorCorrectionShader",uniforms:{tDiffuse:{value:null},powRGB:{value:new Vector3$1(2,2,2)},mulRGB:{value:new Vector3$1(1,1,1)},addRGB:{value:new Vector3$1(0,0,0)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 powRGB;
		uniform vec3 mulRGB;
		uniform vec3 addRGB;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );

		}`},ColorifyShader={name:"ColorifyShader",uniforms:{tDiffuse:{value:null},color:{value:new Color(16777215)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float v = luminance( texel.xyz );

			gl_FragColor = vec4( v * color, texel.w );

		}`},DOFMipMapShader={name:"DOFMipMapShader",uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},maxblur:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float focus;
		uniform float maxblur;

		uniform sampler2D tColor;
		uniform sampler2D tDepth;

		varying vec2 vUv;

		void main() {

			vec4 depth = texture2D( tDepth, vUv );

			float factor = depth.x - focus;

			vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );

			gl_FragColor = col;
			gl_FragColor.a = 1.0;

		}`},ExposureShader={name:"ExposureShader",uniforms:{tDiffuse:{value:null},exposure:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float exposure;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.rgb *= exposure;

		}`},FXAAShader={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		// FXAA algorithm from NVIDIA, C# implementation by Jasper Flick, GLSL port by Dave Hoskins
		// http://developer.download.nvidia.com/assets/gamedev/files/sdk/11/FXAA_WhitePaper.pdf
		// https://catlikecoding.com/unity/tutorials/advanced-rendering/fxaa/

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;

		#define EDGE_STEP_COUNT 6
		#define EDGE_GUESS 8.0
		#define EDGE_STEPS 1.0, 1.5, 2.0, 2.0, 2.0, 4.0
		const float edgeSteps[EDGE_STEP_COUNT] = float[EDGE_STEP_COUNT]( EDGE_STEPS );

		float _ContrastThreshold = 0.0312;
		float _RelativeThreshold = 0.063;
		float _SubpixelBlending = 1.0;

		vec4 Sample( sampler2D  tex2D, vec2 uv ) {

			return texture( tex2D, uv );

		}

		float SampleLuminance( sampler2D tex2D, vec2 uv ) {

			return dot( Sample( tex2D, uv ).rgb, vec3( 0.3, 0.59, 0.11 ) );

		}

		float SampleLuminance( sampler2D tex2D, vec2 texSize, vec2 uv, float uOffset, float vOffset ) {

			uv += texSize * vec2(uOffset, vOffset);
			return SampleLuminance(tex2D, uv);

		}

		struct LuminanceData {

			float m, n, e, s, w;
			float ne, nw, se, sw;
			float highest, lowest, contrast;

		};

		LuminanceData SampleLuminanceNeighborhood( sampler2D tex2D, vec2 texSize, vec2 uv ) {

			LuminanceData l;
			l.m = SampleLuminance( tex2D, uv );
			l.n = SampleLuminance( tex2D, texSize, uv,  0.0,  1.0 );
			l.e = SampleLuminance( tex2D, texSize, uv,  1.0,  0.0 );
			l.s = SampleLuminance( tex2D, texSize, uv,  0.0, -1.0 );
			l.w = SampleLuminance( tex2D, texSize, uv, -1.0,  0.0 );

			l.ne = SampleLuminance( tex2D, texSize, uv,  1.0,  1.0 );
			l.nw = SampleLuminance( tex2D, texSize, uv, -1.0,  1.0 );
			l.se = SampleLuminance( tex2D, texSize, uv,  1.0, -1.0 );
			l.sw = SampleLuminance( tex2D, texSize, uv, -1.0, -1.0 );

			l.highest = max( max( max( max( l.n, l.e ), l.s ), l.w ), l.m );
			l.lowest = min( min( min( min( l.n, l.e ), l.s ), l.w ), l.m );
			l.contrast = l.highest - l.lowest;
			return l;

		}

		bool ShouldSkipPixel( LuminanceData l ) {

			float threshold = max( _ContrastThreshold, _RelativeThreshold * l.highest );
			return l.contrast < threshold;

		}

		float DeterminePixelBlendFactor( LuminanceData l ) {

			float f = 2.0 * ( l.n + l.e + l.s + l.w );
			f += l.ne + l.nw + l.se + l.sw;
			f *= 1.0 / 12.0;
			f = abs( f - l.m );
			f = clamp( f / l.contrast, 0.0, 1.0 );

			float blendFactor = smoothstep( 0.0, 1.0, f );
			return blendFactor * blendFactor * _SubpixelBlending;

		}

		struct EdgeData {

			bool isHorizontal;
			float pixelStep;
			float oppositeLuminance, gradient;

		};

		EdgeData DetermineEdge( vec2 texSize, LuminanceData l ) {

			EdgeData e;
			float horizontal =
				abs( l.n + l.s - 2.0 * l.m ) * 2.0 +
				abs( l.ne + l.se - 2.0 * l.e ) +
				abs( l.nw + l.sw - 2.0 * l.w );
			float vertical =
				abs( l.e + l.w - 2.0 * l.m ) * 2.0 +
				abs( l.ne + l.nw - 2.0 * l.n ) +
				abs( l.se + l.sw - 2.0 * l.s );
			e.isHorizontal = horizontal >= vertical;

			float pLuminance = e.isHorizontal ? l.n : l.e;
			float nLuminance = e.isHorizontal ? l.s : l.w;
			float pGradient = abs( pLuminance - l.m );
			float nGradient = abs( nLuminance - l.m );

			e.pixelStep = e.isHorizontal ? texSize.y : texSize.x;
			
			if (pGradient < nGradient) {

				e.pixelStep = -e.pixelStep;
				e.oppositeLuminance = nLuminance;
				e.gradient = nGradient;

			} else {

				e.oppositeLuminance = pLuminance;
				e.gradient = pGradient;

			}

			return e;

		}

		float DetermineEdgeBlendFactor( sampler2D  tex2D, vec2 texSize, LuminanceData l, EdgeData e, vec2 uv ) {

			vec2 uvEdge = uv;
			vec2 edgeStep;
			if (e.isHorizontal) {

				uvEdge.y += e.pixelStep * 0.5;
				edgeStep = vec2( texSize.x, 0.0 );

			} else {

				uvEdge.x += e.pixelStep * 0.5;
				edgeStep = vec2( 0.0, texSize.y );

			}

			float edgeLuminance = ( l.m + e.oppositeLuminance ) * 0.5;
			float gradientThreshold = e.gradient * 0.25;

			vec2 puv = uvEdge + edgeStep * edgeSteps[0];
			float pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;
			bool pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;

			for ( int i = 1; i < EDGE_STEP_COUNT && !pAtEnd; i++ ) {

				puv += edgeStep * edgeSteps[i];
				pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;
				pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;

			}

			if ( !pAtEnd ) {

				puv += edgeStep * EDGE_GUESS;

			}

			vec2 nuv = uvEdge - edgeStep * edgeSteps[0];
			float nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;
			bool nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;

			for ( int i = 1; i < EDGE_STEP_COUNT && !nAtEnd; i++ ) {

				nuv -= edgeStep * edgeSteps[i];
				nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;
				nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;

			}

			if ( !nAtEnd ) {

				nuv -= edgeStep * EDGE_GUESS;

			}

			float pDistance, nDistance;
			if ( e.isHorizontal ) {

				pDistance = puv.x - uv.x;
				nDistance = uv.x - nuv.x;

			} else {
				
				pDistance = puv.y - uv.y;
				nDistance = uv.y - nuv.y;

			}

			float shortestDistance;
			bool deltaSign;
			if ( pDistance <= nDistance ) {

				shortestDistance = pDistance;
				deltaSign = pLuminanceDelta >= 0.0;

			} else {

				shortestDistance = nDistance;
				deltaSign = nLuminanceDelta >= 0.0;

			}

			if ( deltaSign == ( l.m - edgeLuminance >= 0.0 ) ) {

				return 0.0;

			}

			return 0.5 - shortestDistance / ( pDistance + nDistance );

		}

		vec4 ApplyFXAA( sampler2D  tex2D, vec2 texSize, vec2 uv ) {

			LuminanceData luminance = SampleLuminanceNeighborhood( tex2D, texSize, uv );
			if ( ShouldSkipPixel( luminance ) ) {

				return Sample( tex2D, uv );

			}

			float pixelBlend = DeterminePixelBlendFactor( luminance );
			EdgeData edge = DetermineEdge( texSize, luminance );
			float edgeBlend = DetermineEdgeBlendFactor( tex2D, texSize, luminance, edge, uv );
			float finalBlend = max( pixelBlend, edgeBlend );

			if (edge.isHorizontal) {

				uv.y += edge.pixelStep * finalBlend;

			} else {

				uv.x += edge.pixelStep * finalBlend;

			}

			return Sample( tex2D, uv );

		}

		void main() {

			gl_FragColor = ApplyFXAA( tDiffuse, resolution.xy, vUv );
			
		}`},FocusShader={name:"FocusShader",uniforms:{tDiffuse:{value:null},screenWidth:{value:1024},screenHeight:{value:1024},sampleDistance:{value:.94},waveFactor:{value:.00125}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float screenWidth;
		uniform float screenHeight;
		uniform float sampleDistance;
		uniform float waveFactor;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 color, org, tmp, add;
			float sample_dist, f;
			vec2 vin;
			vec2 uv = vUv;

			add = color = org = texture2D( tDiffuse, uv );

			vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );
			sample_dist = dot( vin, vin ) * 2.0;

			f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;

			vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );

			add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );
			color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );

			gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );

		}`},FreiChenShader={name:"FreiChenShader",uniforms:{tDiffuse:{value:null},aspect:{value:new Vector2(512,512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		uniform vec2 aspect;

		vec2 texel = vec2( 1.0 / aspect.x, 1.0 / aspect.y );


		mat3 G[9];

		// hard coded matrix values!!!! as suggested in https://github.com/neilmendoza/ofxPostProcessing/blob/master/src/EdgePass.cpp#L45

		const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );
		const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );
		const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );
		const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );
		const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );
		const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );
		const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );
		const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );
		const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );

		void main(void)
		{

			G[0] = g0,
			G[1] = g1,
			G[2] = g2,
			G[3] = g3,
			G[4] = g4,
			G[5] = g5,
			G[6] = g6,
			G[7] = g7,
			G[8] = g8;

			mat3 I;
			float cnv[9];
			vec3 sample;

		/* fetch the 3x3 neighbourhood and use the RGB vector's length as intensity value */
			for (float i=0.0; i<3.0; i++) {
				for (float j=0.0; j<3.0; j++) {
					sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;
					I[int(i)][int(j)] = length(sample);
				}
			}

		/* calculate the convolution values for all the masks */
			for (int i=0; i<9; i++) {
				float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);
				cnv[i] = dp3 * dp3;
			}

			float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);
			float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);

			gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);
		}`},GammaCorrectionShader={name:"GammaCorrectionShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = sRGBTransferOETF( tex );

		}`},GodRaysDepthMaskShader={name:"GodRaysDepthMaskShader",uniforms:{tInput:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

		 vUv = uv;
		 gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

	 }`,fragmentShader:`

		varying vec2 vUv;

		uniform sampler2D tInput;

		void main() {

			gl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );

		}`},GodRaysGenerateShader={name:"GodRaysGenerateShader",uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new Vector3$1}},vertexShader:`

		varying vec2 vUv;

		void main() {

		 vUv = uv;
		 gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

	 }`,fragmentShader:`

		#define TAPS_PER_PASS 6.0

		varying vec2 vUv;

		uniform sampler2D tInput;

		uniform vec3 vSunPositionScreenSpace;
		uniform float fStepSize; // filter step size

		void main() {

		// delta from current pixel to "sun" position

			vec2 delta = vSunPositionScreenSpace.xy - vUv;
			float dist = length( delta );

		// Step vector (uv space)

			vec2 stepv = fStepSize * delta / dist;

		// Number of iterations between pixel and sun

			float iters = dist/fStepSize;

			vec2 uv = vUv.xy;
			float col = 0.0;

		// This breaks ANGLE in Chrome 22
		//	- see http://code.google.com/p/chromium/issues/detail?id=153105

		/*
		// Unrolling didn't do much on my hardware (ATI Mobility Radeon 3450),
		// so i've just left the loop

		"for ( float i = 0.0; i < TAPS_PER_PASS; i += 1.0 ) {",

		// Accumulate samples, making sure we don't walk past the light source.

		// The check for uv.y < 1 would not be necessary with "border" UV wrap
		// mode, with a black border color. I don't think this is currently
		// exposed by three.js. As a result there might be artifacts when the
		// sun is to the left, right or bottom of screen as these cases are
		// not specifically handled.

		"	col += ( i <= iters && uv.y < 1.0 ? texture2D( tInput, uv ).r : 0.0 );",
		"	uv += stepv;",

		"}",
		*/

		// Unrolling loop manually makes it work in ANGLE

			float f = min( 1.0, max( vSunPositionScreenSpace.z / 1000.0, 0.0 ) ); // used to fade out godrays

			if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

		// Should technically be dividing by 'iters but 'TAPS_PER_PASS' smooths out
		// objectionable artifacts, in particular near the sun position. The side
		// effect is that the result is darker than it should be around the sun, as
		// TAPS_PER_PASS is greater than the number of samples actually accumulated.
		// When the result is inverted (in the shader 'godrays_combine this produces
		// a slight bright spot at the position of the sun, even when it is occluded.

			gl_FragColor = vec4( col/TAPS_PER_PASS );
			gl_FragColor.a = 1.0;

		}`},GodRaysCombineShader={name:"GodRaysCombineShader",uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		varying vec2 vUv;

		uniform sampler2D tColors;
		uniform sampler2D tGodRays;

		uniform float fGodRayIntensity;

		void main() {

		// Since THREE.MeshDepthMaterial renders foreground objects white and background
		// objects black, the god-rays will be white streaks. Therefore value is inverted
		// before being combined with tColors

			gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );
			gl_FragColor.a = 1.0;

		}`},GodRaysFakeSunShader={name:"GodRaysFakeSunShader",uniforms:{vSunPositionScreenSpace:{value:new Vector3$1},fAspect:{value:1},sunColor:{value:new Color(16772608)},bgColor:{value:new Color(0)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		varying vec2 vUv;

		uniform vec3 vSunPositionScreenSpace;
		uniform float fAspect;

		uniform vec3 sunColor;
		uniform vec3 bgColor;

		void main() {

			vec2 diff = vUv - vSunPositionScreenSpace.xy;

		// Correct for aspect ratio

			diff.x *= fAspect;

			float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );
			prop = 0.35 * pow( 1.0 - prop, 3.0 );

			gl_FragColor.xyz = ( vSunPositionScreenSpace.z > 0.0 ) ? mix( sunColor, bgColor, 1.0 - prop ) : bgColor;
			gl_FragColor.w = 1.0;

		}`},HorizontalBlurShader={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},HorizontalTiltShiftShader={name:"HorizontalTiltShiftShader",uniforms:{tDiffuse:{value:null},h:{value:1/512},r:{value:.35}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;
		uniform float r;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			float hh = h * abs( r - vUv.y );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},HueSaturationShader={name:"HueSaturationShader",uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float hue;
		uniform float saturation;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// hue
			float angle = hue * 3.14159265;
			float s = sin(angle), c = cos(angle);
			vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;
			float len = length(gl_FragColor.rgb);
			gl_FragColor.rgb = vec3(
				dot(gl_FragColor.rgb, weights.xyz),
				dot(gl_FragColor.rgb, weights.zxy),
				dot(gl_FragColor.rgb, weights.yzx)
			);

			// saturation
			float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;
			if (saturation > 0.0) {
				gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));
			} else {
				gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);
			}

		}`},KaleidoShader={name:"KaleidoShader",uniforms:{tDiffuse:{value:null},sides:{value:6},angle:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float sides;
		uniform float angle;

		varying vec2 vUv;

		void main() {

			vec2 p = vUv - 0.5;
			float r = length(p);
			float a = atan(p.y, p.x) + angle;
			float tau = 2. * 3.1416 ;
			a = mod(a, tau/sides);
			a = abs(a - tau/sides/2.) ;
			p = r * vec2(cos(a), sin(a));
			vec4 color = texture2D(tDiffuse, p + 0.5);
			gl_FragColor = color;

		}`},LuminosityShader={name:"LuminosityShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float l = luminance( texel.rgb );

			gl_FragColor = vec4( l, l, l, texel.w );

		}`},MirrorShader={name:"MirrorShader",uniforms:{tDiffuse:{value:null},side:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform int side;

		varying vec2 vUv;

		void main() {

			vec2 p = vUv;
			if (side == 0){
				if (p.x > 0.5) p.x = 1.0 - p.x;
			}else if (side == 1){
				if (p.x < 0.5) p.x = 1.0 - p.x;
			}else if (side == 2){
				if (p.y < 0.5) p.y = 1.0 - p.y;
			}else if (side == 3){
				if (p.y > 0.5) p.y = 1.0 - p.y;
			}
			vec4 color = texture2D(tDiffuse, p);
			gl_FragColor = color;

		}`},NormalMapShader={name:"NormalMapShader",uniforms:{heightMap:{value:null},resolution:{value:new Vector2(512,512)},scale:{value:new Vector2(1,1)},height:{value:.05}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float height;
		uniform vec2 resolution;
		uniform sampler2D heightMap;

		varying vec2 vUv;

		void main() {

			float val = texture2D( heightMap, vUv ).x;

			float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;
			float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;

			gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );

		}`},RGBShiftShader={name:"RGBShiftShader",uniforms:{tDiffuse:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float amount;
		uniform float angle;

		varying vec2 vUv;

		void main() {

			vec2 offset = amount * vec2( cos(angle), sin(angle));
			vec4 cr = texture2D(tDiffuse, vUv + offset);
			vec4 cga = texture2D(tDiffuse, vUv);
			vec4 cb = texture2D(tDiffuse, vUv - offset);
			gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);

		}`},SepiaShader={name:"SepiaShader",uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float amount;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 color = texture2D( tDiffuse, vUv );
			vec3 c = color.rgb;

			color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );
			color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );
			color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );

			gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );

		}`},SobelOperatorShader={name:"SobelOperatorShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;

		void main() {

			vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );

		// kernel definition (in glsl matrices are filled in column-major order)

			const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 ); // x direction kernel
			const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 ); // y direction kernel

		// fetch the 3x3 neighbourhood of a fragment

		// first column

			float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;
			float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;
			float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;

		// second column

			float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;
			float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;
			float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;

		// third column

			float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;
			float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;
			float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;

		// gradient value in x direction

			float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 +
				Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 +
				Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2;

		// gradient value in y direction

			float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 +
				Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 +
				Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2;

		// magnitude of the total gradient

			float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );

			gl_FragColor = vec4( vec3( G ), 1 );

		}`};function replaceAll(ir,er,tr){return ir.split(er).join(tr)}const meshphong_frag_head=ShaderChunk.meshphong_frag.slice(0,ShaderChunk.meshphong_frag.indexOf("void main() {")),meshphong_frag_body=ShaderChunk.meshphong_frag.slice(ShaderChunk.meshphong_frag.indexOf("void main() {")),SubsurfaceScatteringShader={name:"SubsurfaceScatteringShader",uniforms:UniformsUtils.merge([ShaderLib.phong.uniforms,{thicknessMap:{value:null},thicknessColor:{value:new Color(16777215)},thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}}]),vertexShader:["#define USE_UV",ShaderChunk.meshphong_vert].join(`
`),fragmentShader:["#define USE_UV","#define SUBSURFACE",meshphong_frag_head,"uniform sampler2D thicknessMap;","uniform float thicknessPower;","uniform float thicknessScale;","uniform float thicknessDistortion;","uniform float thicknessAmbient;","uniform float thicknessAttenuation;","uniform vec3 thicknessColor;","void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, inout ReflectedLight reflectedLight) {","	vec3 thickness = thicknessColor * texture2D(thicknessMap, uv).r;","	vec3 scatteringHalf = normalize(directLight.direction + (geometryNormal * thicknessDistortion));","	float scatteringDot = pow(saturate(dot(geometryViewDir, -scatteringHalf)), thicknessPower) * thicknessScale;","	vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * thickness;","	reflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;","}",meshphong_frag_body.replace("#include <lights_fragment_begin>",replaceAll(ShaderChunk.lights_fragment_begin,"RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );",["RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );","#if defined( SUBSURFACE ) && defined( USE_UV )"," RE_Direct_Scattering(directLight, vUv, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, reflectedLight);","#endif"].join(`
`)))].join(`
`)},TechnicolorShader={name:"TechnicolorShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );
			vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);

			gl_FragColor = newTex;

		}`},ToonShader1={uniforms:{uDirLightPos:{value:new Vector3$1},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)}},vertexShader:`

		varying vec3 vNormal;
		varying vec3 vRefract;

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
			vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );

			vNormal = normalize( normalMatrix * normal );

			vec3 I = worldPosition.xyz - cameraPosition;
			vRefract = refract( normalize( I ), worldNormal, 1.02 );

			gl_Position = projectionMatrix * mvPosition;

		}`,fragmentShader:`

		uniform vec3 uBaseColor;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		varying vec3 vRefract;

		void main() {

			float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );
			intensity += length(lightWeighting) * 0.2;

			float cameraWeighting = dot( normalize( vNormal ), vRefract );
			intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );
			intensity = intensity * 0.2 + 0.3;

			if ( intensity < 0.50 ) {

				gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );

			} else {

				gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );

			}

			#include <colorspace_fragment>

		}`},ToonShader2={uniforms:{uDirLightPos:{value:new Vector3$1},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(15658734)},uLineColor1:{value:new Color(8421504)},uLineColor2:{value:new Color(0)},uLineColor3:{value:new Color(0)},uLineColor4:{value:new Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);
			float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {

				gl_FragColor *= vec4( uLineColor1, 1.0 );

			}

			if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {

				gl_FragColor *= vec4( uLineColor2, 1.0 );

			}

			#include <colorspace_fragment>

		}`},ToonShaderHatching={uniforms:{uDirLightPos:{value:new Vector3$1},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)},uLineColor1:{value:new Color(0)},uLineColor2:{value:new Color(0)},uLineColor3:{value:new Color(0)},uLineColor4:{value:new Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(lightWeighting) < 1.00 ) {

				if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.75 ) {

				if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {

					gl_FragColor = vec4( uLineColor2, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.50 ) {

				if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {

					gl_FragColor = vec4( uLineColor3, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.3465 ) {

				if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {

					gl_FragColor = vec4( uLineColor4, 1.0 );

			}

			}

			#include <colorspace_fragment>

		}`},ToonShaderDotted={uniforms:{uDirLightPos:{value:new Vector3$1},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)},uLineColor1:{value:new Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(lightWeighting) < 1.00 ) {

				if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.50 ) {

				if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			#include <colorspace_fragment>

		}`},TriangleBlurShader={name:"TriangleBlurShader",uniforms:{texture:{value:null},delta:{value:new Vector2(1,1)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		#define ITERATIONS 10.0

		uniform sampler2D texture;
		uniform vec2 delta;

		varying vec2 vUv;

		void main() {

			vec4 color = vec4( 0.0 );

			float total = 0.0;

		// randomize the lookup values to hide the fixed number of samples

			float offset = rand( vUv );

			for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {

				float percent = ( t + offset - 0.5 ) / ITERATIONS;
				float weight = 1.0 - abs( percent );

				color += texture2D( texture, vUv + delta * percent ) * weight;
				total += weight;

			}

			gl_FragColor = color / total;

		}`},UnpackDepthRGBAShader={name:"UnpackDepthRGBAShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		#include <packing>

		void main() {

			float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );
			gl_FragColor = vec4( vec3( depth ), opacity );

		}`},VelocityShader={name:"VelocityShader",uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.displacementmap,{modelMatrixPrev:{value:new Matrix4},currentProjectionViewMatrix:{value:new Matrix4},previousProjectionViewMatrix:{value:new Matrix4}}]),vertexShader:`
#define NORMAL

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )

	varying vec3 vViewPosition;

#endif

#include <common>
#include <packing>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

uniform mat4 previousProjectionViewMatrix;
uniform mat4 currentProjectionViewMatrix;

uniform mat4 modelMatrixPrev;

varying vec4 clipPositionCurrent;
varying vec4 clipPositionPrevious;

void main() {


	#include <uv_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <displacementmap_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>

#ifdef USE_SKINNING

	vec4 mvPosition = modelViewMatrix * skinned;
	clipPositionCurrent  = currentProjectionViewMatrix * modelMatrix * skinned;
	clipPositionPrevious = previousProjectionViewMatrix * modelMatrixPrev * skinned;

#else

	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
	clipPositionCurrent  = currentProjectionViewMatrix * modelMatrix * vec4( transformed, 1.0 );
	clipPositionPrevious = previousProjectionViewMatrix * modelMatrixPrev * vec4( transformed, 1.0 );

#endif

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}
`,fragmentShader:`
#define NORMAL

uniform float opacity;

#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

varying vec4 clipPositionCurrent;
varying vec4 clipPositionPrevious;

void main() {

	vec4 diffuseColor = vec4( 1.0 );
	diffuseColor.a = opacity;

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	vec2 ndcPositionCurrent  = clipPositionCurrent.xy/clipPositionCurrent.w;
	vec2 ndcPositionPrevious = clipPositionPrevious.xy/clipPositionPrevious.w;
	vec2 vel = ( ndcPositionCurrent - ndcPositionPrevious ) * 0.5;
	vel = vel * 0.5 + 0.5;
	vec2 v1 = packDepthToRG(vel.x);
	vec2 v2 = packDepthToRG(vel.y);
	gl_FragColor = vec4(v1.x, v1.y, v2.x, v2.y);

	#include <logdepthbuf_fragment>

}

`},VerticalBlurShader={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`},VerticalTiltShiftShader={name:"VerticalTiltShiftShader",uniforms:{tDiffuse:{value:null},v:{value:1/512},r:{value:.35}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;
		uniform float r;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			float vv = v * abs( r - vUv.y );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;

			gl_FragColor = sum;

		}`},VignetteShader={name:"VignetteShader",uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float offset;
		uniform float darkness;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			// Eskil's vignette

			vec4 texel = texture2D( tDiffuse, vUv );
			vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );
			gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );

		}`},VolumeRenderShader1={uniforms:{u_size:{value:new Vector3$1(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:`

		varying vec4 v_nearpos;
		varying vec4 v_farpos;
		varying vec3 v_position;

		void main() {
				// Prepare transforms to map to "camera view". See also:
				// https://threejs.org/docs/#api/renderers/webgl/WebGLProgram
				mat4 viewtransformf = modelViewMatrix;
				mat4 viewtransformi = inverse(modelViewMatrix);

				// Project local vertex coordinate to camera position. Then do a step
				// backward (in cam coords) to the near clipping plane, and project back. Do
				// the same for the far clipping plane. This gives us all the information we
				// need to calculate the ray and truncate it to the viewing cone.
				vec4 position4 = vec4(position, 1.0);
				vec4 pos_in_cam = viewtransformf * position4;

				// Intersection of ray and near clipping plane (z = -1 in clip coords)
				pos_in_cam.z = -pos_in_cam.w;
				v_nearpos = viewtransformi * pos_in_cam;

				// Intersection of ray and far clipping plane (z = +1 in clip coords)
				pos_in_cam.z = pos_in_cam.w;
				v_farpos = viewtransformi * pos_in_cam;

				// Set varyings and output pos
				v_position = position;
				gl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;
		}`,fragmentShader:`

				precision highp float;
				precision mediump sampler3D;

				uniform vec3 u_size;
				uniform int u_renderstyle;
				uniform float u_renderthreshold;
				uniform vec2 u_clim;

				uniform sampler3D u_data;
				uniform sampler2D u_cmdata;

				varying vec3 v_position;
				varying vec4 v_nearpos;
				varying vec4 v_farpos;

				// The maximum distance through our rendering volume is sqrt(3).
				const int MAX_STEPS = 887;	// 887 for 512^3, 1774 for 1024^3
				const int REFINEMENT_STEPS = 4;
				const float relative_step_size = 1.0;
				const vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);
				const vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);
				const vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);
				const float shininess = 40.0;

				void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);
				void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);

				float sample1(vec3 texcoords);
				vec4 apply_colormap(float val);
				vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);


				void main() {
						// Normalize clipping plane info
						vec3 farpos = v_farpos.xyz / v_farpos.w;
						vec3 nearpos = v_nearpos.xyz / v_nearpos.w;

						// Calculate unit vector pointing in the view direction through this fragment.
						vec3 view_ray = normalize(nearpos.xyz - farpos.xyz);

						// Compute the (negative) distance to the front surface or near clipping plane.
						// v_position is the back face of the cuboid, so the initial distance calculated in the dot
						// product below is the distance from near clip plane to the back of the cuboid
						float distance = dot(nearpos - v_position, view_ray);
						distance = max(distance, min((-0.5 - v_position.x) / view_ray.x,
																				(u_size.x - 0.5 - v_position.x) / view_ray.x));
						distance = max(distance, min((-0.5 - v_position.y) / view_ray.y,
																				(u_size.y - 0.5 - v_position.y) / view_ray.y));
						distance = max(distance, min((-0.5 - v_position.z) / view_ray.z,
																				(u_size.z - 0.5 - v_position.z) / view_ray.z));

						// Now we have the starting position on the front surface
						vec3 front = v_position + view_ray * distance;

						// Decide how many steps to take
						int nsteps = int(-distance / relative_step_size + 0.5);
						if ( nsteps < 1 )
								discard;

						// Get starting location and step vector in texture coordinates
						vec3 step = ((v_position - front) / u_size) / float(nsteps);
						vec3 start_loc = front / u_size;

						// For testing: show the number of steps. This helps to establish
						// whether the rays are correctly oriented
						//'gl_FragColor = vec4(0.0, float(nsteps) / 1.0 / u_size.x, 1.0, 1.0);
						//'return;

						if (u_renderstyle == 0)
								cast_mip(start_loc, step, nsteps, view_ray);
						else if (u_renderstyle == 1)
								cast_iso(start_loc, step, nsteps, view_ray);

						if (gl_FragColor.a < 0.05)
								discard;
				}


				float sample1(vec3 texcoords) {
						/* Sample float value from a 3D texture. Assumes intensity data. */
						return texture(u_data, texcoords.xyz).r;
				}


				vec4 apply_colormap(float val) {
						val = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);
						return texture2D(u_cmdata, vec2(val, 0.5));
				}


				void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {

						float max_val = -1e6;
						int max_i = 100;
						vec3 loc = start_loc;

						// Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with
						// non-constant expression. So we use a hard-coded max, and an additional condition
						// inside the loop.
						for (int iter=0; iter<MAX_STEPS; iter++) {
								if (iter >= nsteps)
										break;
								// Sample from the 3D texture
								float val = sample1(loc);
								// Apply MIP operation
								if (val > max_val) {
										max_val = val;
										max_i = iter;
								}
								// Advance location deeper into the volume
								loc += step;
						}

						// Refine location, gives crispier images
						vec3 iloc = start_loc + step * (float(max_i) - 0.5);
						vec3 istep = step / float(REFINEMENT_STEPS);
						for (int i=0; i<REFINEMENT_STEPS; i++) {
								max_val = max(max_val, sample1(iloc));
								iloc += istep;
						}

						// Resolve final color
						gl_FragColor = apply_colormap(max_val);
				}


				void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {

						gl_FragColor = vec4(0.0);	// init transparent
						vec4 color3 = vec4(0.0);	// final color
						vec3 dstep = 1.5 / u_size;	// step to sample derivative
						vec3 loc = start_loc;

						float low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);

						// Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with
						// non-constant expression. So we use a hard-coded max, and an additional condition
						// inside the loop.
						for (int iter=0; iter<MAX_STEPS; iter++) {
								if (iter >= nsteps)
										break;

								// Sample from the 3D texture
								float val = sample1(loc);

								if (val > low_threshold) {
										// Take the last interval in smaller steps
										vec3 iloc = loc - 0.5 * step;
										vec3 istep = step / float(REFINEMENT_STEPS);
										for (int i=0; i<REFINEMENT_STEPS; i++) {
												val = sample1(iloc);
												if (val > u_renderthreshold) {
														gl_FragColor = add_lighting(val, iloc, dstep, view_ray);
														return;
												}
												iloc += istep;
										}
								}

								// Advance location deeper into the volume
								loc += step;
						}
				}


				vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)
				{
					// Calculate color by incorporating lighting

						// View direction
						vec3 V = normalize(view_ray);

						// calculate normal vector from gradient
						vec3 N;
						float val1, val2;
						val1 = sample1(loc + vec3(-step[0], 0.0, 0.0));
						val2 = sample1(loc + vec3(+step[0], 0.0, 0.0));
						N[0] = val1 - val2;
						val = max(max(val1, val2), val);
						val1 = sample1(loc + vec3(0.0, -step[1], 0.0));
						val2 = sample1(loc + vec3(0.0, +step[1], 0.0));
						N[1] = val1 - val2;
						val = max(max(val1, val2), val);
						val1 = sample1(loc + vec3(0.0, 0.0, -step[2]));
						val2 = sample1(loc + vec3(0.0, 0.0, +step[2]));
						N[2] = val1 - val2;
						val = max(max(val1, val2), val);

						float gm = length(N); // gradient magnitude
						N = normalize(N);

						// Flip normal so it points towards viewer
						float Nselect = float(dot(N, V) > 0.0);
						N = (2.0 * Nselect - 1.0) * N;	// ==	Nselect * N - (1.0-Nselect)*N;

						// Init colors
						vec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);
						vec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);
						vec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);

						// note: could allow multiple lights
						for (int i=0; i<1; i++)
						{
								 // Get light direction (make sure to prevent zero devision)
								vec3 L = normalize(view_ray);	//lightDirs[i];
								float lightEnabled = float( length(L) > 0.0 );
								L = normalize(L + (1.0 - lightEnabled));

								// Calculate lighting properties
								float lambertTerm = clamp(dot(N, L), 0.0, 1.0);
								vec3 H = normalize(L+V); // Halfway vector
								float specularTerm = pow(max(dot(H, N), 0.0), shininess);

								// Calculate mask
								float mask1 = lightEnabled;

								// Calculate colors
								ambient_color +=	mask1 * ambient_color;	// * gl_LightSource[i].ambient;
								diffuse_color +=	mask1 * lambertTerm;
								specular_color += mask1 * specularTerm * specular_color;
						}

						// Calculate final color by componing different components
						vec4 final_color;
						vec4 color = apply_colormap(val);
						final_color = color * (ambient_color + diffuse_color) + specular_color;
						final_color.a = color.a;
						return final_color;
				}`},WaterRefractionShader={name:"WaterRefractionShader",uniforms:{color:{value:null},time:{value:0},tDiffuse:{value:null},tDudv:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec2 vUv;
		varying vec4 vUvRefraction;

		void main() {

			vUv = uv;

			vUvRefraction = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform float time;
		uniform sampler2D tDiffuse;
		uniform sampler2D tDudv;

		varying vec2 vUv;
		varying vec4 vUvRefraction;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );

		}

		void main() {

		 float waveStrength = 0.5;
		 float waveSpeed = 0.03;

			// simple distortion (ripple) via dudv map (see https://www.youtube.com/watch?v=6B7IF6GOu7s)

			vec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;
			distortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );
			vec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;

			// new uv coords

			vec4 uv = vec4( vUvRefraction );
			uv.xy += distortion;

			vec4 base = texture2DProj( tDiffuse, uv );

			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class FlakesTexture{constructor(er=512,tr=512){const rr=document.createElement("canvas");rr.width=er,rr.height=tr;const nr=rr.getContext("2d");nr.fillStyle="rgb(127,127,255)",nr.fillRect(0,0,er,tr);for(let sr=0;sr<4e3;sr++){const ar=Math.random()*er,or=Math.random()*tr,lr=Math.random()*3+3;let cr=Math.random()*2-1,hr=Math.random()*2-1,fr=1.5;const ur=Math.sqrt(cr*cr+hr*hr+fr*fr);cr/=ur,hr/=ur,fr/=ur,nr.fillStyle="rgb("+(cr*127+127)+","+(hr*127+127)+","+fr*255+")",nr.beginPath(),nr.arc(ar,or,lr,0,Math.PI*2),nr.fill()}return rr}}const _va=new Vector3$1,_vb=new Vector3$1,_vc=new Vector3$1,_vr=new Vector3$1,_vu=new Vector3$1,_vn=new Vector3$1,_vec=new Vector3$1,_quat=new Quaternion$1;function frameCorners(ir,er,tr,rr,nr=!1){const sr=er,ar=tr,or=rr,lr=ir.position,cr=ir.near,hr=ir.far;_vr.copy(ar).sub(sr).normalize(),_vu.copy(or).sub(sr).normalize(),_vn.crossVectors(_vr,_vu).normalize(),_va.copy(sr).sub(lr),_vb.copy(ar).sub(lr),_vc.copy(or).sub(lr);const fr=-_va.dot(_vn),ur=_vr.dot(_va)*cr/fr,pr=_vr.dot(_vb)*cr/fr,gr=_vu.dot(_va)*cr/fr,_r=_vu.dot(_vc)*cr/fr;_quat.setFromUnitVectors(_vec.set(0,1,0),_vu),ir.quaternion.setFromUnitVectors(_vec.set(0,0,1).applyQuaternion(_quat),_vn).multiply(_quat),ir.projectionMatrix.set(2*cr/(pr-ur),0,(pr+ur)/(pr-ur),0,0,2*cr/(_r-gr),(_r+gr)/(_r-gr),0,0,0,(hr+cr)/(cr-hr),2*hr*cr/(cr-hr),0,0,-1,0),ir.projectionMatrixInverse.copy(ir.projectionMatrix).invert(),nr&&(ir.fov=MathUtils.RAD2DEG/Math.min(1,ir.aspect)*Math.atan((_vec.copy(ar).sub(sr).length()+_vec.copy(or).sub(sr).length())/_va.length()))}const CameraUtils$1=Object.freeze(Object.defineProperty({__proto__:null,frameCorners},Symbol.toStringTag,{value:"Module"}));function compressNormals(ir,er){const tr=ir.attributes.normal;if(tr||console.error("Geometry must contain normal attribute. "),tr.isPacked)return;tr.itemSize!=3&&console.error("normal.itemSize is not 3, which cannot be encoded. ");const rr=tr.array,nr=tr.count;let sr;if(er=="DEFAULT"){sr=new Uint8Array(nr*3);for(let ar=0;ar<rr.length;ar+=3){const or=defaultEncode(rr[ar],rr[ar+1],rr[ar+2],1);sr[ar+0]=or[0],sr[ar+1]=or[1],sr[ar+2]=or[2]}ir.setAttribute("normal",new BufferAttribute(sr,3,!0)),ir.attributes.normal.bytes=sr.length*1}else if(er=="OCT1Byte"){sr=new Int8Array(nr*2);for(let ar=0;ar<rr.length;ar+=3){const or=octEncodeBest(rr[ar],rr[ar+1],rr[ar+2],1);sr[ar/3*2+0]=or[0],sr[ar/3*2+1]=or[1]}ir.setAttribute("normal",new BufferAttribute(sr,2,!0)),ir.attributes.normal.bytes=sr.length*1}else if(er=="OCT2Byte"){sr=new Int16Array(nr*2);for(let ar=0;ar<rr.length;ar+=3){const or=octEncodeBest(rr[ar],rr[ar+1],rr[ar+2],2);sr[ar/3*2+0]=or[0],sr[ar/3*2+1]=or[1]}ir.setAttribute("normal",new BufferAttribute(sr,2,!0)),ir.attributes.normal.bytes=sr.length*2}else if(er=="ANGLES"){sr=new Uint16Array(nr*2);for(let ar=0;ar<rr.length;ar+=3){const or=anglesEncode(rr[ar],rr[ar+1],rr[ar+2]);sr[ar/3*2+0]=or[0],sr[ar/3*2+1]=or[1]}ir.setAttribute("normal",new BufferAttribute(sr,2,!0)),ir.attributes.normal.bytes=sr.length*2}else console.error("Unrecognized encoding method, should be `DEFAULT` or `ANGLES` or `OCT`. ");ir.attributes.normal.needsUpdate=!0,ir.attributes.normal.isPacked=!0,ir.attributes.normal.packingMethod=er}function compressPositions(ir){const er=ir.attributes.position;if(er||console.error("Geometry must contain position attribute. "),er.isPacked)return;er.itemSize!=3&&console.error("position.itemSize is not 3, which cannot be packed. ");const tr=er.array,rr=2,sr=quantizedEncode(tr,rr).quantized;ir.boundingBox==null&&ir.computeBoundingBox(),ir.boundingSphere==null&&ir.computeBoundingSphere(),ir.setAttribute("position",new BufferAttribute(sr,3)),ir.attributes.position.isPacked=!0,ir.attributes.position.needsUpdate=!0,ir.attributes.position.bytes=sr.length*rr}function compressUvs(ir){const er=ir.attributes.uv;if(er||console.error("Geometry must contain uv attribute. "),er.isPacked)return;const tr={min:1/0,max:-1/0},rr=er.array;for(let sr=0;sr<rr.length;sr++)tr.min=Math.min(tr.min,rr[sr]),tr.max=Math.max(tr.max,rr[sr]);let nr;if(tr.min>=-1&&tr.max<=1){nr=new Uint16Array(rr.length);for(let sr=0;sr<rr.length;sr+=2){const ar=defaultEncode(rr[sr],rr[sr+1],0,2);nr[sr]=ar[0],nr[sr+1]=ar[1]}ir.setAttribute("uv",new BufferAttribute(nr,2,!0)),ir.attributes.uv.isPacked=!0,ir.attributes.uv.needsUpdate=!0,ir.attributes.uv.bytes=nr.length*2}else nr=quantizedEncodeUV(rr,2),ir.setAttribute("uv",new BufferAttribute(nr.quantized,2)),ir.attributes.uv.isPacked=!0,ir.attributes.uv.needsUpdate=!0,ir.attributes.uv.bytes=nr.quantized.length*2}function defaultEncode(ir,er,tr,rr){if(rr==1){const nr=Math.round((ir+1)*.5*255),sr=Math.round((er+1)*.5*255),ar=Math.round((tr+1)*.5*255);return new Uint8Array([nr,sr,ar])}else if(rr==2){const nr=Math.round((ir+1)*.5*65535),sr=Math.round((er+1)*.5*65535),ar=Math.round((tr+1)*.5*65535);return new Uint16Array([nr,sr,ar])}else console.error("number of bytes must be 1 or 2")}function anglesEncode(ir,er,tr){const rr=parseInt(.5*(1+Math.atan2(er,ir)/Math.PI)*65535),nr=parseInt(.5*(1+tr)*65535);return new Uint16Array([rr,nr])}function octEncodeBest(ir,er,tr,rr){let nr,sr,ar,or,lr;return ar=nr=cr(ir,er,tr,"floor","floor"),sr=hr(nr),lr=fr(ir,er,tr,sr),nr=cr(ir,er,tr,"ceil","floor"),sr=hr(nr),or=fr(ir,er,tr,sr),or>lr&&(ar=nr,lr=or),nr=cr(ir,er,tr,"floor","ceil"),sr=hr(nr),or=fr(ir,er,tr,sr),or>lr&&(ar=nr,lr=or),nr=cr(ir,er,tr,"ceil","ceil"),sr=hr(nr),or=fr(ir,er,tr,sr),or>lr&&(ar=nr),ar;function cr(ur,pr,gr,_r,mr){let dr=ur/(Math.abs(ur)+Math.abs(pr)+Math.abs(gr)),vr=pr/(Math.abs(ur)+Math.abs(pr)+Math.abs(gr));if(tr<0){const Ar=(1-Math.abs(vr))*(dr>=0?1:-1),yr=(1-Math.abs(dr))*(vr>=0?1:-1);dr=Ar,vr=yr;let wr=1-Math.abs(dr)-Math.abs(vr);wr>0&&(wr+=.001,dr+=dr>0?wr/2:-wr/2,vr+=vr>0?wr/2:-wr/2)}if(rr==1)return new Int8Array([Math[_r](dr*127.5+(dr<0?1:0)),Math[mr](vr*127.5+(vr<0?1:0))]);if(rr==2)return new Int16Array([Math[_r](dr*32767.5+(dr<0?1:0)),Math[mr](vr*32767.5+(vr<0?1:0))])}function hr(ur){let pr=ur[0],gr=ur[1];rr==1?(pr/=pr<0?127:128,gr/=gr<0?127:128):rr==2&&(pr/=pr<0?32767:32768,gr/=gr<0?32767:32768);const _r=1-Math.abs(pr)-Math.abs(gr);if(_r<0){const dr=pr;pr=(1-Math.abs(gr))*(pr>=0?1:-1),gr=(1-Math.abs(dr))*(gr>=0?1:-1)}const mr=Math.sqrt(pr*pr+gr*gr+_r*_r);return[pr/mr,gr/mr,_r/mr]}function fr(ur,pr,gr,_r){return ur*_r[0]+pr*_r[1]+gr*_r[2]}}function quantizedEncode(ir,er){let tr,rr;er==1?(tr=new Uint8Array(ir.length),rr=255):er==2?(tr=new Uint16Array(ir.length),rr=65535):console.error("number of bytes error! ");const nr=new Matrix4,sr=new Float32Array(3),ar=new Float32Array(3);sr[0]=sr[1]=sr[2]=Number.MAX_VALUE,ar[0]=ar[1]=ar[2]=-Number.MAX_VALUE;for(let lr=0;lr<ir.length;lr+=3)sr[0]=Math.min(sr[0],ir[lr+0]),sr[1]=Math.min(sr[1],ir[lr+1]),sr[2]=Math.min(sr[2],ir[lr+2]),ar[0]=Math.max(ar[0],ir[lr+0]),ar[1]=Math.max(ar[1],ir[lr+1]),ar[2]=Math.max(ar[2],ir[lr+2]);nr.scale(new Vector3$1((ar[0]-sr[0])/rr,(ar[1]-sr[1])/rr,(ar[2]-sr[2])/rr)),nr.elements[12]=sr[0],nr.elements[13]=sr[1],nr.elements[14]=sr[2],nr.transpose();const or=new Float32Array([ar[0]!==sr[0]?rr/(ar[0]-sr[0]):0,ar[1]!==sr[1]?rr/(ar[1]-sr[1]):0,ar[2]!==sr[2]?rr/(ar[2]-sr[2]):0]);for(let lr=0;lr<ir.length;lr+=3)tr[lr+0]=Math.floor((ir[lr+0]-sr[0])*or[0]),tr[lr+1]=Math.floor((ir[lr+1]-sr[1])*or[1]),tr[lr+2]=Math.floor((ir[lr+2]-sr[2])*or[2]);return{quantized:tr,decodeMat:nr}}function quantizedEncodeUV(ir,er){let tr,rr;er==1?(tr=new Uint8Array(ir.length),rr=255):er==2?(tr=new Uint16Array(ir.length),rr=65535):console.error("number of bytes error! ");const nr=new Matrix3,sr=new Float32Array(2),ar=new Float32Array(2);sr[0]=sr[1]=Number.MAX_VALUE,ar[0]=ar[1]=-Number.MAX_VALUE;for(let lr=0;lr<ir.length;lr+=2)sr[0]=Math.min(sr[0],ir[lr+0]),sr[1]=Math.min(sr[1],ir[lr+1]),ar[0]=Math.max(ar[0],ir[lr+0]),ar[1]=Math.max(ar[1],ir[lr+1]);nr.scale((ar[0]-sr[0])/rr,(ar[1]-sr[1])/rr),nr.elements[6]=sr[0],nr.elements[7]=sr[1],nr.transpose();const or=new Float32Array([ar[0]!==sr[0]?rr/(ar[0]-sr[0]):0,ar[1]!==sr[1]?rr/(ar[1]-sr[1]):0]);for(let lr=0;lr<ir.length;lr+=2)tr[lr+0]=Math.floor((ir[lr+0]-sr[0])*or[0]),tr[lr+1]=Math.floor((ir[lr+1]-sr[1])*or[1]);return{quantized:tr,decodeMat:nr}}const GeometryCompressionUtils$1=Object.freeze(Object.defineProperty({__proto__:null,compressNormals,compressPositions,compressUvs},Symbol.toStringTag,{value:"Module"}));function hilbert2D(ir=new Vector3$1(0,0,0),er=10,tr=1,rr=0,nr=1,sr=2,ar=3){const or=er/2,lr=[new Vector3$1(ir.x-or,ir.y,ir.z-or),new Vector3$1(ir.x-or,ir.y,ir.z+or),new Vector3$1(ir.x+or,ir.y,ir.z+or),new Vector3$1(ir.x+or,ir.y,ir.z-or)],cr=[lr[rr],lr[nr],lr[sr],lr[ar]];return 0<=--tr?[...hilbert2D(cr[0],or,tr,rr,ar,sr,nr),...hilbert2D(cr[1],or,tr,rr,nr,sr,ar),...hilbert2D(cr[2],or,tr,rr,nr,sr,ar),...hilbert2D(cr[3],or,tr,sr,nr,rr,ar)]:cr}function hilbert3D(ir=new Vector3$1(0,0,0),er=10,tr=1,rr=0,nr=1,sr=2,ar=3,or=4,lr=5,cr=6,hr=7){const fr=er/2,ur=[new Vector3$1(ir.x-fr,ir.y+fr,ir.z-fr),new Vector3$1(ir.x-fr,ir.y+fr,ir.z+fr),new Vector3$1(ir.x-fr,ir.y-fr,ir.z+fr),new Vector3$1(ir.x-fr,ir.y-fr,ir.z-fr),new Vector3$1(ir.x+fr,ir.y-fr,ir.z-fr),new Vector3$1(ir.x+fr,ir.y-fr,ir.z+fr),new Vector3$1(ir.x+fr,ir.y+fr,ir.z+fr),new Vector3$1(ir.x+fr,ir.y+fr,ir.z-fr)],pr=[ur[rr],ur[nr],ur[sr],ur[ar],ur[or],ur[lr],ur[cr],ur[hr]];return--tr>=0?[...hilbert3D(pr[0],fr,tr,rr,ar,or,hr,cr,lr,sr,nr),...hilbert3D(pr[1],fr,tr,rr,hr,cr,nr,sr,lr,or,ar),...hilbert3D(pr[2],fr,tr,rr,hr,cr,nr,sr,lr,or,ar),...hilbert3D(pr[3],fr,tr,sr,ar,rr,nr,cr,hr,or,lr),...hilbert3D(pr[4],fr,tr,sr,ar,rr,nr,cr,hr,or,lr),...hilbert3D(pr[5],fr,tr,or,ar,sr,lr,cr,nr,rr,hr),...hilbert3D(pr[6],fr,tr,or,ar,sr,lr,cr,nr,rr,hr),...hilbert3D(pr[7],fr,tr,cr,lr,sr,nr,rr,ar,or,hr)]:pr}function gosper(ir=1){function er(sr){let ar,or=sr.axiom;for(let lr=0,cr=sr.steps;0<=cr?lr<cr:lr>cr;0<=cr?lr++:lr--){ar="";for(let hr=0,fr=or.length;hr<fr;hr++){const ur=or[hr];ur in sr.rules?ar+=sr.rules[ur]:ar+=ur}or=ar}return ar}function tr(sr){let ar=0,or=0,lr=0;const cr=[0,0,0],hr=sr.fractal;for(let fr=0,ur=hr.length;fr<ur;fr++){const pr=hr[fr];pr==="+"?lr+=sr.angle:pr==="-"?lr-=sr.angle:pr==="F"&&(ar+=sr.size*Math.cos(lr),or+=-sr.size*Math.sin(lr),cr.push(ar,or,0))}return cr}const rr=er({axiom:"A",steps:4,rules:{A:"A+BF++BF-FA--FAFA-BF+",B:"-FA+BFBF++BF+FA--FA-B"}});return tr({fractal:rr,size:ir,angle:Math.PI/3})}const GeometryUtils$1=Object.freeze(Object.defineProperty({__proto__:null,gosper,hilbert2D,hilbert3D},Symbol.toStringTag,{value:"Module"}));class LDrawUtils{static mergeObject(er){function tr(pr,gr,_r,mr){const dr=new BufferGeometry,vr=pr.getAttribute("position").array,Ar=_r===3?pr.getAttribute("normal").array:null,yr=Math.min(gr.count,Math.floor(vr.length/3)-gr.start),wr=gr.start*3,br=(gr.start+yr)*3,Sr=vr.subarray(wr,br),xr=Ar!==null?Ar.subarray(wr,br):null;if(dr.setAttribute("position",new BufferAttribute(Sr,3)),xr!==null&&dr.setAttribute("normal",new BufferAttribute(xr,3)),mr){const Cr=pr.getAttribute("control0").array.subarray(wr,br),Ir=pr.getAttribute("control1").array.subarray(wr,br),Rr=pr.getAttribute("direction").array.subarray(wr,br);dr.setAttribute("control0",new BufferAttribute(Cr,3,!1)),dr.setAttribute("control1",new BufferAttribute(Ir,3,!1)),dr.setAttribute("direction",new BufferAttribute(Rr,3,!1))}return dr}function rr(pr,gr,_r){const mr=_r[pr.uuid];mr?mr.arr.push(gr):_r[pr.uuid]={mat:pr,arr:[gr]}}function nr(pr,gr){if(!pr)return;const _r=pr.array,mr=Math.floor(_r.length/3);let dr=0;for(let vr=0;vr<mr;vr++){const Ar=_r[dr],yr=_r[dr+1],wr=_r[dr+2];_r[dr]=_r[dr+3],_r[dr+1]=_r[dr+4],_r[dr+2]=_r[dr+5],_r[dr+3]=Ar,_r[dr+4]=yr,_r[dr+5]=wr,dr+=gr*3}}const sr={},ar={},or={};er.updateMatrixWorld(!0);const lr=new Matrix3;er.traverse(pr=>{if(pr.isMesh|pr.isLineSegments){const gr=pr.isMesh?3:2,_r=pr.geometry.clone();pr.matrixWorld.determinant()<0&&(nr(_r.attributes.position,gr),nr(_r.attributes.normal,gr)),_r.applyMatrix4(pr.matrixWorld),pr.isConditionalLine&&(_r.attributes.control0.applyMatrix4(pr.matrixWorld),_r.attributes.control1.applyMatrix4(pr.matrixWorld),lr.getNormalMatrix(pr.matrixWorld),_r.attributes.direction.applyNormalMatrix(lr));const dr=pr.isMesh?sr:pr.isConditionalLine?or:ar;if(Array.isArray(pr.material))for(const vr in _r.groups){const Ar=_r.groups[vr],yr=pr.material[Ar.materialIndex],wr=tr(_r,Ar,gr,pr.isConditionalLine);rr(yr,wr,dr)}else rr(pr.material,_r,dr)}});const cr=new Group,hr=Object.keys(sr);for(const pr of hr){const gr=sr[pr],_r=mergeGeometries(gr.arr);cr.add(new Mesh(_r,gr.mat))}const fr=Object.keys(ar);for(const pr of fr){const gr=ar[pr],_r=mergeGeometries(gr.arr);cr.add(new LineSegments(_r,gr.mat))}const ur=Object.keys(or);for(const pr of ur){const gr=or[pr],_r=mergeGeometries(gr.arr),mr=new LineSegments(_r,gr.mat);mr.isConditionalLine=!0,cr.add(mr)}return cr.userData.constructionStep=0,cr.userData.numConstructionSteps=1,cr}}const _color=new Color,_matrix$1=new Matrix4;function createMeshesFromInstancedMesh(ir){const er=new Group,tr=ir.count,rr=ir.geometry,nr=ir.material;for(let sr=0;sr<tr;sr++){const ar=new Mesh(rr,nr);ir.getMatrixAt(sr,ar.matrix),ar.matrix.decompose(ar.position,ar.quaternion,ar.scale),er.add(ar)}return er.copy(ir),er.updateMatrixWorld(),er}function createMeshesFromMultiMaterialMesh(ir){if(Array.isArray(ir.material)===!1)return console.warn("THREE.SceneUtils.createMeshesFromMultiMaterialMesh(): The given mesh has no multiple materials."),ir;const er=new Group;er.copy(ir);const tr=mergeGroups(ir.geometry),rr=tr.index,nr=tr.groups,sr=Object.keys(tr.attributes);for(let ar=0;ar<nr.length;ar++){const or=nr[ar],lr=or.start,cr=lr+or.count,hr=new BufferGeometry,fr=ir.material[or.materialIndex];for(let pr=0;pr<sr.length;pr++){const gr=sr[pr],_r=tr.attributes[gr],mr=_r.itemSize,dr=or.count*mr,vr=_r.array.constructor,Ar=new vr(dr),yr=new BufferAttribute(Ar,mr);for(let wr=lr,br=0;wr<cr;wr++,br++){const Sr=rr.getX(wr);mr>=1&&yr.setX(br,_r.getX(Sr)),mr>=2&&yr.setY(br,_r.getY(Sr)),mr>=3&&yr.setZ(br,_r.getZ(Sr)),mr>=4&&yr.setW(br,_r.getW(Sr))}hr.setAttribute(gr,yr)}const ur=new Mesh(hr,fr);er.add(ur)}return er}function createMultiMaterialObject(ir,er){const tr=new Group;for(let rr=0,nr=er.length;rr<nr;rr++)tr.add(new Mesh(ir,er[rr]));return tr}function reduceVertices(ir,er,tr){let rr=tr;const nr=new Vector3$1;return ir.updateWorldMatrix(!0,!0),ir.traverseVisible(sr=>{const{geometry:ar}=sr;if(ar!==void 0){const{position:or}=ar.attributes;if(or!==void 0)for(let lr=0,cr=or.count;lr<cr;lr++)sr.isMesh?sr.getVertexPosition(lr,nr):nr.fromBufferAttribute(or,lr),sr.isSkinnedMesh||nr.applyMatrix4(sr.matrixWorld),rr=er(rr,nr)}}),rr}function sortInstancedMesh(ir,er){const tr=deepCloneAttribute(ir.instanceMatrix),rr=ir.instanceColor?deepCloneAttribute(ir.instanceColor):null,nr=new Map;for(const ar in ir.geometry.attributes){const or=ir.geometry.attributes[ar];or.isInstancedBufferAttribute&&nr.set(or,deepCloneAttribute(or))}const sr=[];for(let ar=0;ar<ir.count;ar++)sr.push(ar);sr.sort(er);for(let ar=0;ar<sr.length;ar++){const or=sr[ar];_matrix$1.fromArray(tr.array,or*ir.instanceMatrix.itemSize),_matrix$1.toArray(ir.instanceMatrix.array,ar*ir.instanceMatrix.itemSize),ir.instanceColor&&(_color.fromArray(rr.array,or*ir.instanceColor.itemSize),_color.toArray(ir.instanceColor.array,ar*ir.instanceColor.itemSize));for(const lr in ir.geometry.attributes){const cr=ir.geometry.attributes[lr];if(cr.isInstancedBufferAttribute){const hr=nr.get(cr);cr.setX(ar,hr.getX(or)),cr.itemSize>1&&cr.setY(ar,hr.getY(or)),cr.itemSize>2&&cr.setZ(ar,hr.getZ(or)),cr.itemSize>3&&cr.setW(ar,hr.getW(or))}}}}function*traverseGenerator(ir){yield ir;const er=ir.children;for(let tr=0,rr=er.length;tr<rr;tr++)yield*traverseGenerator(er[tr])}function*traverseVisibleGenerator(ir){if(ir.visible===!1)return;yield ir;const er=ir.children;for(let tr=0,rr=er.length;tr<rr;tr++)yield*traverseVisibleGenerator(er[tr])}function*traverseAncestorsGenerator(ir){const er=ir.parent;er!==null&&(yield er,yield*traverseAncestorsGenerator(er))}const SceneUtils$1=Object.freeze(Object.defineProperty({__proto__:null,createMeshesFromInstancedMesh,createMeshesFromMultiMaterialMesh,createMultiMaterialObject,reduceVertices,sortInstancedMesh,traverseAncestorsGenerator,traverseGenerator,traverseVisibleGenerator},Symbol.toStringTag,{value:"Module"}));class ShadowMapViewer{constructor(er){const tr=this,rr=er.name!==void 0&&er.name!=="";let nr;const sr={x:10,y:10,width:256,height:256},ar=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);ar.position.set(0,0,2);const or=new Scene,lr=UnpackDepthRGBAShader,cr=UniformsUtils.clone(lr.uniforms),hr=new ShaderMaterial({uniforms:cr,vertexShader:lr.vertexShader,fragmentShader:lr.fragmentShader}),fr=new PlaneGeometry(sr.width,sr.height),ur=new Mesh(fr,hr);or.add(ur);let pr,gr;if(rr){pr=document.createElement("canvas");const mr=pr.getContext("2d");mr.font="Bold 20px Arial";const dr=mr.measureText(er.name).width;pr.width=dr,pr.height=25,mr.font="Bold 20px Arial",mr.fillStyle="rgba( 255, 0, 0, 1 )",mr.fillText(er.name,0,20);const vr=new CanvasTexture(pr),Ar=new MeshBasicMaterial({map:vr,side:DoubleSide,transparent:!0}),yr=new PlaneGeometry(pr.width,pr.height);gr=new Mesh(yr,Ar),or.add(gr)}function _r(){tr.position.set(tr.position.x,tr.position.y)}this.enabled=!0,this.size={width:sr.width,height:sr.height,set:function(mr,dr){this.width=mr,this.height=dr,ur.scale.set(this.width/sr.width,this.height/sr.height,1),_r()}},this.position={x:sr.x,y:sr.y,set:function(mr,dr){this.x=mr,this.y=dr;const vr=tr.size.width,Ar=tr.size.height;ur.position.set(-window.innerWidth/2+vr/2+this.x,window.innerHeight/2-Ar/2-this.y,0),rr&&gr.position.set(ur.position.x,ur.position.y-tr.size.height/2+pr.height/2,0)}},this.render=function(mr){this.enabled&&(cr.tDiffuse.value=er.shadow.map.texture,nr=mr.autoClear,mr.autoClear=!1,mr.clearDepth(),mr.render(or,ar),mr.autoClear=nr)},this.updateForWindowResize=function(){this.enabled&&(ar.left=window.innerWidth/-2,ar.right=window.innerWidth/2,ar.top=window.innerHeight/2,ar.bottom=window.innerHeight/-2,ar.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()}}function getBoneName(ir,er){return er.getBoneName!==void 0?er.getBoneName(ir):er.names[ir.name]}function retarget(ir,er,tr={}){const rr=new Quaternion$1,nr=new Vector3$1,sr=new Matrix4,ar=new Matrix4;tr.preserveBoneMatrix=tr.preserveBoneMatrix!==void 0?tr.preserveBoneMatrix:!0,tr.preserveBonePositions=tr.preserveBonePositions!==void 0?tr.preserveBonePositions:!0,tr.useTargetMatrix=tr.useTargetMatrix!==void 0?tr.useTargetMatrix:!1,tr.hip=tr.hip!==void 0?tr.hip:"hip",tr.hipInfluence=tr.hipInfluence!==void 0?tr.hipInfluence:new Vector3$1(1,1,1),tr.scale=tr.scale!==void 0?tr.scale:1,tr.names=tr.names||{};const or=er.isObject3D?er.skeleton.bones:getBones(er),lr=ir.isObject3D?ir.skeleton.bones:getBones(ir);let cr,hr,fr,ur;if(ir.isObject3D?ir.skeleton.pose():(tr.useTargetMatrix=!0,tr.preserveBoneMatrix=!1),tr.preserveBonePositions){ur=[];for(let pr=0;pr<lr.length;pr++)ur.push(lr[pr].position.clone())}if(tr.preserveBoneMatrix){ir.updateMatrixWorld(),ir.matrixWorld.identity();for(let pr=0;pr<ir.children.length;++pr)ir.children[pr].updateMatrixWorld(!0)}for(let pr=0;pr<lr.length;++pr)cr=lr[pr],hr=getBoneName(cr,tr),fr=getBoneByName(hr,or),ar.copy(cr.matrixWorld),fr&&(fr.updateMatrixWorld(),tr.useTargetMatrix?sr.copy(fr.matrixWorld):(sr.copy(ir.matrixWorld).invert(),sr.multiply(fr.matrixWorld)),nr.setFromMatrixScale(sr),sr.scale(nr.set(1/nr.x,1/nr.y,1/nr.z)),ar.makeRotationFromQuaternion(rr.setFromRotationMatrix(sr)),ir.isObject3D&&tr.localOffsets&&tr.localOffsets[cr.name]&&ar.multiply(tr.localOffsets[cr.name]),ar.copyPosition(sr)),hr===tr.hip&&(ar.elements[12]*=tr.scale*tr.hipInfluence.x,ar.elements[13]*=tr.scale*tr.hipInfluence.y,ar.elements[14]*=tr.scale*tr.hipInfluence.z,tr.hipPosition!==void 0&&(ar.elements[12]+=tr.hipPosition.x*tr.scale,ar.elements[13]+=tr.hipPosition.y*tr.scale,ar.elements[14]+=tr.hipPosition.z*tr.scale)),cr.parent?(cr.matrix.copy(cr.parent.matrixWorld).invert(),cr.matrix.multiply(ar)):cr.matrix.copy(ar),cr.matrix.decompose(cr.position,cr.quaternion,cr.scale),cr.updateMatrixWorld();if(tr.preserveBonePositions)for(let pr=0;pr<lr.length;++pr)cr=lr[pr],hr=getBoneName(cr,tr)||cr.name,hr!==tr.hip&&cr.position.copy(ur[pr]);tr.preserveBoneMatrix&&ir.updateMatrixWorld(!0)}function retargetClip(ir,er,tr,rr={}){rr.useFirstFramePosition=rr.useFirstFramePosition!==void 0?rr.useFirstFramePosition:!1,rr.fps=rr.fps!==void 0?rr.fps:Math.max(...tr.tracks.map(dr=>dr.times.length))/tr.duration,rr.names=rr.names||[],er.isObject3D||(er=getHelperFromSkeleton(er));const nr=Math.round(tr.duration*(rr.fps/1e3)*1e3),sr=tr.duration/(nr-1),ar=[],or=new AnimationMixer(er),lr=getBones(ir.skeleton),cr=[];let hr,fr,ur,pr,gr;or.clipAction(tr).play();let _r=0,mr=nr;rr.trim!==void 0?(_r=Math.round(rr.trim[0]*rr.fps),mr=Math.min(Math.round(rr.trim[1]*rr.fps),nr)-_r,or.update(rr.trim[0])):or.update(0),er.updateMatrixWorld();for(let dr=0;dr<mr;++dr){const vr=dr*sr;retarget(ir,er,rr);for(let Ar=0;Ar<lr.length;++Ar)fr=lr[Ar],gr=getBoneName(fr,rr)||fr.name,ur=getBoneByName(gr,er.skeleton),ur&&(pr=cr[Ar]=cr[Ar]||{bone:fr},rr.hip===gr&&(pr.pos||(pr.pos={times:new Float32Array(mr),values:new Float32Array(mr*3)}),rr.useFirstFramePosition&&(dr===0&&(hr=fr.position.clone()),fr.position.sub(hr)),pr.pos.times[dr]=vr,fr.position.toArray(pr.pos.values,dr*3)),pr.quat||(pr.quat={times:new Float32Array(mr),values:new Float32Array(mr*4)}),pr.quat.times[dr]=vr,fr.quaternion.toArray(pr.quat.values,dr*4));dr===mr-2?or.update(sr-1e-7):or.update(sr),er.updateMatrixWorld()}for(let dr=0;dr<cr.length;++dr)pr=cr[dr],pr&&(pr.pos&&ar.push(new VectorKeyframeTrack(".bones["+pr.bone.name+"].position",pr.pos.times,pr.pos.values)),ar.push(new QuaternionKeyframeTrack(".bones["+pr.bone.name+"].quaternion",pr.quat.times,pr.quat.values)));return or.uncacheAction(tr),new AnimationClip(tr.name,-1,ar)}function clone(ir){const er=new Map,tr=new Map,rr=ir.clone();return parallelTraverse(ir,rr,function(nr,sr){er.set(sr,nr),tr.set(nr,sr)}),rr.traverse(function(nr){if(!nr.isSkinnedMesh)return;const sr=nr,ar=er.get(nr),or=ar.skeleton.bones;sr.skeleton=ar.skeleton.clone(),sr.bindMatrix.copy(ar.bindMatrix),sr.skeleton.bones=or.map(function(lr){return tr.get(lr)}),sr.bind(sr.skeleton,sr.bindMatrix)}),rr}function getBoneByName(ir,er){for(let tr=0,rr=getBones(er);tr<rr.length;tr++)if(ir===rr[tr].name)return rr[tr]}function getBones(ir){return Array.isArray(ir)?ir:ir.bones}function getHelperFromSkeleton(ir){const er=new SkeletonHelper(ir.bones[0]);return er.skeleton=ir,er}function parallelTraverse(ir,er,tr){tr(ir,er);for(let rr=0;rr<ir.children.length;rr++)parallelTraverse(ir.children[rr],er.children[rr],tr)}const SkeletonUtils$1=Object.freeze(Object.defineProperty({__proto__:null,clone,retarget,retargetClip},Symbol.toStringTag,{value:"Module"})),POWER=3,BIT_MAX=32,BIN_BITS=1<<POWER,BIN_SIZE=1<<BIN_BITS,BIN_MAX=BIN_SIZE-1,ITERATIONS=BIT_MAX/BIN_BITS,bins=new Array(ITERATIONS),bins_buffer=new ArrayBuffer((ITERATIONS+1)*BIN_SIZE*4);let c=0;for(let ir=0;ir<ITERATIONS+1;ir++)bins[ir]=new Uint32Array(bins_buffer,c,BIN_SIZE),c+=BIN_SIZE*4;const defaultGet=ir=>ir,radixSort=(ir,er)=>{const tr=ir.length,rr=er||{},nr=rr.aux||new ir.constructor(tr),sr=rr.get||defaultGet,ar=[ir,nr];let or,lr,cr;rr.reversed?(or=(ur,pr)=>ur<pr,lr=ur=>{for(let pr=BIN_SIZE-2;pr>=0;pr--)ur[pr]+=ur[pr+1]},cr=(ur,pr,gr)=>{let _r=0;for(let mr=BIN_MAX;mr>=0;mr--){const dr=ur[mr],vr=dr-_r;vr!=0&&(vr>32?fr(pr+1,gr+_r,vr):hr(pr+1,gr+_r,vr),_r=dr)}}):(or=(ur,pr)=>ur>pr,lr=ur=>{for(let pr=1;pr<BIN_SIZE;pr++)ur[pr]+=ur[pr-1]},cr=(ur,pr,gr)=>{let _r=0;for(let mr=0;mr<BIN_SIZE;mr++){const dr=ur[mr],vr=dr-_r;vr!=0&&(vr>32?fr(pr+1,gr+_r,vr):hr(pr+1,gr+_r,vr),_r=dr)}});const hr=(ur,pr,gr)=>{const _r=ar[ur&1],mr=ar[ur+1&1];for(let dr=pr+1;dr<pr+gr;dr++){const vr=_r[dr],Ar=sr(vr)>>>0;let yr=dr;for(;yr>pr&&or(sr(_r[yr-1])>>>0,Ar);)_r[yr]=_r[--yr];_r[yr]=vr}if((ur&1)==1)for(let dr=pr;dr<pr+gr;dr++)mr[dr]=_r[dr]},fr=(ur,pr,gr)=>{const _r=ar[ur&1],mr=ar[ur+1&1],dr=3-ur<<POWER,vr=pr+gr,Ar=bins[ur],yr=bins[ur+1];yr.fill(0);for(let wr=pr;wr<vr;wr++)yr[sr(_r[wr])>>>dr&BIN_MAX]++;lr(yr),Ar.set(yr);for(let wr=vr-1;wr>=pr;wr--)mr[pr+--yr[sr(_r[wr])>>>dr&BIN_MAX]]=_r[wr];ur!=ITERATIONS-1&&cr(Ar,ur,pr)};fr(0,0,tr)},SortUtils$1=Object.freeze(Object.defineProperty({__proto__:null,radixSort},Symbol.toStringTag,{value:"Module"}));let _renderer,fullscreenQuadGeometry,fullscreenQuadMaterial,fullscreenQuad;function decompress(ir,er=1/0,tr=null){fullscreenQuadGeometry||(fullscreenQuadGeometry=new PlaneGeometry(2,2,1,1)),fullscreenQuadMaterial||(fullscreenQuadMaterial=new ShaderMaterial({uniforms:{blitTexture:new Uniform(ir)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),fullscreenQuadMaterial.uniforms.blitTexture.value=ir,fullscreenQuadMaterial.defines.IS_SRGB=ir.colorSpace==SRGBColorSpace,fullscreenQuadMaterial.needsUpdate=!0,fullscreenQuad||(fullscreenQuad=new Mesh(fullscreenQuadGeometry,fullscreenQuadMaterial),fullscreenQuad.frustumCulled=!1);const rr=new PerspectiveCamera,nr=new Scene;nr.add(fullscreenQuad),tr===null&&(tr=_renderer=new WebGLRenderer({antialias:!1}));const sr=Math.min(ir.image.width,er),ar=Math.min(ir.image.height,er);tr.setSize(sr,ar),tr.clear(),tr.render(nr,rr);const or=document.createElement("canvas"),lr=or.getContext("2d");or.width=sr,or.height=ar,lr.drawImage(tr.domElement,0,0,sr,ar);const cr=new CanvasTexture(or);return cr.minFilter=ir.minFilter,cr.magFilter=ir.magFilter,cr.wrapS=ir.wrapS,cr.wrapT=ir.wrapT,cr.colorSpace=ir.colorSpace,cr.name=ir.name,_renderer&&(_renderer.forceContextLoss(),_renderer.dispose(),_renderer=null),cr}function UVsDebug(ir,er=1024){const tr="abc",rr=new Vector2,nr=new Vector2,sr=[new Vector2,new Vector2,new Vector2],ar=[],or=document.createElement("canvas"),lr=er,cr=er;or.width=lr,or.height=cr;const hr=or.getContext("2d");hr.lineWidth=1,hr.strokeStyle="rgb( 63, 63, 63 )",hr.textAlign="center",hr.fillStyle="rgb( 255, 255, 255 )",hr.fillRect(0,0,lr,cr);const fr=ir.index,ur=ir.attributes.uv;if(fr)for(let gr=0,_r=fr.count;gr<_r;gr+=3)ar[0]=fr.getX(gr),ar[1]=fr.getX(gr+1),ar[2]=fr.getX(gr+2),sr[0].fromBufferAttribute(ur,ar[0]),sr[1].fromBufferAttribute(ur,ar[1]),sr[2].fromBufferAttribute(ur,ar[2]),pr(ar,sr,gr/3);else for(let gr=0,_r=ur.count;gr<_r;gr+=3)ar[0]=gr,ar[1]=gr+1,ar[2]=gr+2,sr[0].fromBufferAttribute(ur,ar[0]),sr[1].fromBufferAttribute(ur,ar[1]),sr[2].fromBufferAttribute(ur,ar[2]),pr(ar,sr,gr/3);return or;function pr(gr,_r,mr){hr.beginPath(),rr.set(0,0);for(let dr=0,vr=_r.length;dr<vr;dr++){const Ar=_r[dr];rr.x+=Ar.x,rr.y+=Ar.y,dr===0?hr.moveTo(Ar.x*(lr-2)+.5,(1-Ar.y)*(cr-2)+.5):hr.lineTo(Ar.x*(lr-2)+.5,(1-Ar.y)*(cr-2)+.5)}hr.closePath(),hr.stroke(),rr.divideScalar(_r.length),hr.font="18px Arial",hr.fillStyle="rgb( 63, 63, 63 )",hr.fillText(mr,rr.x*lr,(1-rr.y)*cr),rr.x>.95&&hr.fillText(mr,rr.x%1*lr,(1-rr.y)*cr),hr.font="12px Arial",hr.fillStyle="rgb( 191, 191, 191 )";for(let dr=0,vr=_r.length;dr<vr;dr++){const Ar=_r[dr];nr.addVectors(rr,Ar).divideScalar(2);const yr=gr[dr];hr.fillText(tr[dr]+yr,nr.x*lr,(1-nr.y)*cr),nr.x>.95&&hr.fillText(tr[dr]+yr,nr.x%1*lr,(1-nr.y)*cr)}}}class ARButton{static createButton(er,tr={}){const rr=document.createElement("button");function nr(){if(tr.domOverlay===void 0){const ur=document.createElement("div");ur.style.display="none",document.body.appendChild(ur);const pr=document.createElementNS("http://www.w3.org/2000/svg","svg");pr.setAttribute("width",38),pr.setAttribute("height",38),pr.style.position="absolute",pr.style.right="20px",pr.style.top="20px",pr.addEventListener("click",function(){cr.end()}),ur.appendChild(pr);const gr=document.createElementNS("http://www.w3.org/2000/svg","path");gr.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),gr.setAttribute("stroke","#fff"),gr.setAttribute("stroke-width",2),pr.appendChild(gr),tr.optionalFeatures===void 0&&(tr.optionalFeatures=[]),tr.optionalFeatures.push("dom-overlay"),tr.domOverlay={root:ur}}let cr=null;async function hr(ur){ur.addEventListener("end",fr),er.xr.setReferenceSpaceType("local"),await er.xr.setSession(ur),rr.textContent="STOP AR",tr.domOverlay.root.style.display="",cr=ur}function fr(){cr.removeEventListener("end",fr),rr.textContent="START AR",tr.domOverlay.root.style.display="none",cr=null}rr.style.display="",rr.style.cursor="pointer",rr.style.left="calc(50% - 50px)",rr.style.width="100px",rr.textContent="START AR",rr.onmouseenter=function(){rr.style.opacity="1.0"},rr.onmouseleave=function(){rr.style.opacity="0.5"},rr.onclick=function(){cr===null?navigator.xr.requestSession("immersive-ar",tr).then(hr):(cr.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-ar",tr).then(hr).catch(ur=>{console.warn(ur)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-ar",tr).then(hr).catch(ur=>{console.warn(ur)})}function sr(){rr.style.display="",rr.style.cursor="auto",rr.style.left="calc(50% - 75px)",rr.style.width="150px",rr.onmouseenter=null,rr.onmouseleave=null,rr.onclick=null}function ar(){sr(),rr.textContent="AR NOT SUPPORTED"}function or(cr){sr(),console.warn("Exception when trying to call xr.isSessionSupported",cr),rr.textContent="AR NOT ALLOWED"}function lr(cr){cr.style.position="absolute",cr.style.bottom="20px",cr.style.padding="12px 6px",cr.style.border="1px solid #fff",cr.style.borderRadius="4px",cr.style.background="rgba(0,0,0,0.1)",cr.style.color="#fff",cr.style.font="normal 13px sans-serif",cr.style.textAlign="center",cr.style.opacity="0.5",cr.style.outline="none",cr.style.zIndex="999"}if("xr"in navigator)return rr.id="ARButton",rr.style.display="none",lr(rr),navigator.xr.isSessionSupported("immersive-ar").then(function(cr){cr?nr():ar()}).catch(or),rr;{const cr=document.createElement("a");return window.isSecureContext===!1?(cr.href=document.location.href.replace(/^http:/,"https:"),cr.innerHTML="WEBXR NEEDS HTTPS"):(cr.href="https://immersiveweb.dev/",cr.innerHTML="WEBXR NOT AVAILABLE"),cr.style.left="calc(50% - 90px)",cr.style.width="180px",cr.style.textDecoration="none",lr(cr),cr}}}const DEFAULT_HAND_PROFILE_PATH="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class XRHandMeshModel{constructor(er,tr,rr,nr,sr=null,ar=null){this.controller=tr,this.handModel=er,this.bones=[],sr===null&&(sr=new GLTFLoader,sr.setPath(rr||DEFAULT_HAND_PROFILE_PATH)),sr.load(`${nr}.glb`,or=>{const lr=or.scene.children[0];this.handModel.add(lr);const cr=lr.getObjectByProperty("type","SkinnedMesh");cr.frustumCulled=!1,cr.castShadow=!0,cr.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(fr=>{const ur=lr.getObjectByName(fr);ur!==void 0?ur.jointName=fr:console.warn(`Couldn't find ${fr} in ${nr} hand mesh`),this.bones.push(ur)}),ar&&ar(lr)})}updateMesh(){const er=this.controller.joints;for(let tr=0;tr<this.bones.length;tr++){const rr=this.bones[tr];if(rr){const nr=er[rr.jointName];if(nr.visible){const sr=nr.position;rr.position.copy(sr),rr.quaternion.copy(nr.quaternion)}}}}}const TOUCH_RADIUS=.01,POINTING_JOINT="index-finger-tip";class OculusHandModel extends Object3D{constructor(er,tr=null,rr=null){super(),this.controller=er,this.motionController=null,this.envMap=null,this.loader=tr,this.onLoad=rr,this.mesh=null,er.addEventListener("connected",nr=>{const sr=nr.data;sr.hand&&!this.motionController&&(this.xrInputSource=sr,this.motionController=new XRHandMeshModel(this,er,this.path,sr.handedness,this.loader,this.onLoad))}),er.addEventListener("disconnected",()=>{this.clear(),this.motionController=null})}updateMatrixWorld(er){super.updateMatrixWorld(er),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){const er=this.controller.joints[POINTING_JOINT];return er?er.position:null}intersectBoxObject(er){const tr=this.getPointerPosition();if(tr){const rr=new Sphere(tr,TOUCH_RADIUS),nr=new Box3().setFromObject(er);return rr.intersectsBox(nr)}else return!1}checkButton(er){this.intersectBoxObject(er)?er.onPress():er.onClear(),er.isPressed()&&er.whilePressed()}}const PINCH_MAX=.05,PINCH_THRESHOLD=.02,PINCH_MIN=.01,POINTER_ADVANCE_MAX=.02,POINTER_OPACITY_MAX=1,POINTER_OPACITY_MIN=.4,POINTER_FRONT_RADIUS=.002,POINTER_REAR_RADIUS=.01,POINTER_REAR_RADIUS_MIN=.003,POINTER_LENGTH=.035,POINTER_SEGMENTS=16,POINTER_RINGS=12,POINTER_HEMISPHERE_ANGLE=110,YAXIS=new Vector3$1(0,1,0),ZAXIS=new Vector3$1(0,0,1),CURSOR_RADIUS=.02,CURSOR_MAX_DISTANCE=1.5;class OculusHandPointerModel extends Object3D{constructor(er,tr){super(),this.hand=er,this.controller=tr,this.motionController=null,this.envMap=null,this.mesh=null,this.pointerGeometry=null,this.pointerMesh=null,this.pointerObject=null,this.pinched=!1,this.attached=!1,this.cursorObject=null,this.raycaster=null,this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.hand.addEventListener("connected",this._onConnected),this.hand.addEventListener("disconnected",this._onDisconnected)}_onConnected(er){const tr=er.data;tr.hand&&(this.visible=!0,this.xrInputSource=tr,this.createPointer())}_onDisconnected(){this.visible=!1,this.xrInputSource=null,this.pointerGeometry&&this.pointerGeometry.dispose(),this.pointerMesh&&this.pointerMesh.material&&this.pointerMesh.material.dispose(),this.clear()}_drawVerticesRing(er,tr,rr){const nr=tr.clone();for(let sr=0;sr<POINTER_SEGMENTS;sr++){nr.applyAxisAngle(ZAXIS,Math.PI*2/POINTER_SEGMENTS);const ar=rr*POINTER_SEGMENTS+sr;er[3*ar]=nr.x,er[3*ar+1]=nr.y,er[3*ar+2]=nr.z}}_updatePointerVertices(er){const tr=this.pointerGeometry.attributes.position.array,rr=new Vector3$1(POINTER_FRONT_RADIUS,0,-1*(POINTER_LENGTH-er));this._drawVerticesRing(tr,rr,0);const nr=new Vector3$1(Math.sin(Math.PI*POINTER_HEMISPHERE_ANGLE/180)*er,Math.cos(Math.PI*POINTER_HEMISPHERE_ANGLE/180)*er,0);for(let cr=0;cr<POINTER_RINGS;cr++)this._drawVerticesRing(tr,nr,cr+1),nr.applyAxisAngle(YAXIS,Math.PI*POINTER_HEMISPHERE_ANGLE/180/(POINTER_RINGS*-2));const sr=POINTER_SEGMENTS*(1+POINTER_RINGS),ar=POINTER_SEGMENTS*(1+POINTER_RINGS)+1,or=new Vector3$1(0,0,-1*(POINTER_LENGTH-er));tr[sr*3]=or.x,tr[sr*3+1]=or.y,tr[sr*3+2]=or.z;const lr=new Vector3$1(0,0,er);tr[ar*3]=lr.x,tr[ar*3+1]=lr.y,tr[ar*3+2]=lr.z,this.pointerGeometry.setAttribute("position",new Float32BufferAttribute(tr,3))}createPointer(){let er,tr;const rr=new Array(((POINTER_RINGS+1)*POINTER_SEGMENTS+2)*3).fill(0),nr=[];for(this.pointerGeometry=new BufferGeometry,this.pointerGeometry.setAttribute("position",new Float32BufferAttribute(rr,3)),this._updatePointerVertices(POINTER_REAR_RADIUS),er=0;er<POINTER_RINGS;er++){for(tr=0;tr<POINTER_SEGMENTS-1;tr++)nr.push(er*POINTER_SEGMENTS+tr,er*POINTER_SEGMENTS+tr+1,(er+1)*POINTER_SEGMENTS+tr),nr.push(er*POINTER_SEGMENTS+tr+1,(er+1)*POINTER_SEGMENTS+tr+1,(er+1)*POINTER_SEGMENTS+tr);nr.push((er+1)*POINTER_SEGMENTS-1,er*POINTER_SEGMENTS,(er+2)*POINTER_SEGMENTS-1),nr.push(er*POINTER_SEGMENTS,(er+1)*POINTER_SEGMENTS,(er+2)*POINTER_SEGMENTS-1)}const sr=POINTER_SEGMENTS*(1+POINTER_RINGS),ar=POINTER_SEGMENTS*(1+POINTER_RINGS)+1;for(er=0;er<POINTER_SEGMENTS-1;er++)nr.push(sr,er+1,er),nr.push(ar,er+POINTER_SEGMENTS*POINTER_RINGS,er+POINTER_SEGMENTS*POINTER_RINGS+1);nr.push(sr,0,POINTER_SEGMENTS-1),nr.push(ar,POINTER_SEGMENTS*(POINTER_RINGS+1)-1,POINTER_SEGMENTS*POINTER_RINGS);const or=new MeshBasicMaterial;or.transparent=!0,or.opacity=POINTER_OPACITY_MIN,this.pointerGeometry.setIndex(nr),this.pointerMesh=new Mesh(this.pointerGeometry,or),this.pointerMesh.position.set(0,0,-1*POINTER_REAR_RADIUS),this.pointerObject=new Object3D,this.pointerObject.add(this.pointerMesh),this.raycaster=new Raycaster;const lr=new SphereGeometry(CURSOR_RADIUS,10,10),cr=new MeshBasicMaterial;cr.transparent=!0,cr.opacity=POINTER_OPACITY_MIN,this.cursorObject=new Mesh(lr,cr),this.pointerObject.add(this.cursorObject),this.add(this.pointerObject)}_updateRaycaster(){if(this.raycaster){const er=this.pointerObject.matrixWorld,tr=new Matrix4;tr.identity().extractRotation(er),this.raycaster.ray.origin.setFromMatrixPosition(er),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(tr)}}_updatePointer(){this.pointerObject.visible=this.controller.visible;const er=this.hand.joints["index-finger-tip"],tr=this.hand.joints["thumb-tip"],rr=er.position.distanceTo(tr.position),nr=er.position.clone().add(tr.position).multiplyScalar(.5);this.pointerObject.position.copy(nr),this.pointerObject.quaternion.copy(this.controller.quaternion),this.pinched=rr<=PINCH_THRESHOLD;const sr=(rr-PINCH_MIN)/(PINCH_MAX-PINCH_MIN),ar=(rr-PINCH_MIN)/(PINCH_THRESHOLD-PINCH_MIN);if(sr>1)this._updatePointerVertices(POINTER_REAR_RADIUS),this.pointerMesh.position.set(0,0,-1*POINTER_REAR_RADIUS),this.pointerMesh.material.opacity=POINTER_OPACITY_MIN;else if(sr>0){const or=(POINTER_REAR_RADIUS-POINTER_REAR_RADIUS_MIN)*sr+POINTER_REAR_RADIUS_MIN;this._updatePointerVertices(or),ar<1?(this.pointerMesh.position.set(0,0,-1*or-(1-ar)*POINTER_ADVANCE_MAX),this.pointerMesh.material.opacity=POINTER_OPACITY_MIN+(1-ar)*(POINTER_OPACITY_MAX-POINTER_OPACITY_MIN)):(this.pointerMesh.position.set(0,0,-1*or),this.pointerMesh.material.opacity=POINTER_OPACITY_MIN)}else this._updatePointerVertices(POINTER_REAR_RADIUS_MIN),this.pointerMesh.position.set(0,0,-1*POINTER_REAR_RADIUS_MIN-POINTER_ADVANCE_MAX),this.pointerMesh.material.opacity=POINTER_OPACITY_MAX;this.cursorObject.material.opacity=this.pointerMesh.material.opacity}updateMatrixWorld(er){super.updateMatrixWorld(er),this.pointerGeometry&&(this._updatePointer(),this._updateRaycaster())}isPinched(){return this.pinched}setAttached(er){this.attached=er}isAttached(){return this.attached}intersectObject(er,tr=!0){if(this.raycaster)return this.raycaster.intersectObject(er,tr)}intersectObjects(er,tr=!0){if(this.raycaster)return this.raycaster.intersectObjects(er,tr)}checkIntersections(er,tr=!1){if(this.raycaster&&!this.attached){const rr=this.raycaster.intersectObjects(er,tr),nr=new Vector3$1(0,0,-1);if(rr.length>0){const ar=rr[0].distance;this.cursorObject.position.copy(nr.multiplyScalar(ar))}else this.cursorObject.position.copy(nr.multiplyScalar(CURSOR_MAX_DISTANCE))}}setCursor(er){const tr=new Vector3$1(0,0,-1);this.raycaster&&!this.attached&&this.cursorObject.position.copy(tr.multiplyScalar(er))}dispose(){this._onDisconnected(),this.hand.removeEventListener("connected",this._onConnected),this.hand.removeEventListener("disconnected",this._onDisconnected)}}function createText(ir,er){const tr=document.createElement("canvas"),rr=tr.getContext("2d");let nr=null;const sr=100;rr.font="normal "+sr+"px Arial",nr=rr.measureText(ir);const ar=nr.width;tr.width=ar,tr.height=sr,rr.font="normal "+sr+"px Arial",rr.textAlign="center",rr.textBaseline="middle",rr.fillStyle="#ffffff",rr.fillText(ir,ar/2,sr/2);const or=new Texture(tr);or.needsUpdate=!0;const lr=new MeshBasicMaterial({color:16777215,side:DoubleSide,map:or,transparent:!0}),cr=new PlaneGeometry(er*ar/sr,er);return new Mesh(cr,lr)}class VRButton{static createButton(er,tr={}){const rr=document.createElement("button");function nr(){let cr=null;async function hr(pr){pr.addEventListener("end",fr),await er.xr.setSession(pr),rr.textContent="EXIT VR",cr=pr}function fr(){cr.removeEventListener("end",fr),rr.textContent="ENTER VR",cr=null}rr.style.display="",rr.style.cursor="pointer",rr.style.left="calc(50% - 50px)",rr.style.width="100px",rr.textContent="ENTER VR";const ur={...tr,optionalFeatures:["local-floor","bounded-floor","layers",...tr.optionalFeatures||[]]};rr.onmouseenter=function(){rr.style.opacity="1.0"},rr.onmouseleave=function(){rr.style.opacity="0.5"},rr.onclick=function(){cr===null?navigator.xr.requestSession("immersive-vr",ur).then(hr):(cr.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",ur).then(hr).catch(pr=>{console.warn(pr)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",ur).then(hr).catch(pr=>{console.warn(pr)})}function sr(){rr.style.display="",rr.style.cursor="auto",rr.style.left="calc(50% - 75px)",rr.style.width="150px",rr.onmouseenter=null,rr.onmouseleave=null,rr.onclick=null}function ar(){sr(),rr.textContent="VR NOT SUPPORTED"}function or(cr){sr(),console.warn("Exception when trying to call xr.isSessionSupported",cr),rr.textContent="VR NOT ALLOWED"}function lr(cr){cr.style.position="absolute",cr.style.bottom="20px",cr.style.padding="12px 6px",cr.style.border="1px solid #fff",cr.style.borderRadius="4px",cr.style.background="rgba(0,0,0,0.1)",cr.style.color="#fff",cr.style.font="normal 13px sans-serif",cr.style.textAlign="center",cr.style.opacity="0.5",cr.style.outline="none",cr.style.zIndex="999"}if("xr"in navigator)return rr.id="VRButton",rr.style.display="none",lr(rr),navigator.xr.isSessionSupported("immersive-vr").then(function(cr){cr?nr():ar(),cr&&VRButton.xrSessionIsGranted&&rr.click()}).catch(or),rr;{const cr=document.createElement("a");return window.isSecureContext===!1?(cr.href=document.location.href.replace(/^http:/,"https:"),cr.innerHTML="WEBXR NEEDS HTTPS"):(cr.href="https://immersiveweb.dev/",cr.innerHTML="WEBXR NOT AVAILABLE"),cr.style.left="calc(50% - 90px)",cr.style.width="180px",cr.style.textDecoration="none",lr(cr),cr}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{VRButton.xrSessionIsGranted=!0})}}}VRButton.xrSessionIsGranted=!1;VRButton.registerSessionGrantedListener();class XRButton{static createButton(er,tr={}){const rr=document.createElement("button");function nr(cr){let hr=null;async function fr(gr){gr.addEventListener("end",ur),await er.xr.setSession(gr),rr.textContent="STOP XR",hr=gr}function ur(){hr.removeEventListener("end",ur),rr.textContent="START XR",hr=null}rr.style.display="",rr.style.cursor="pointer",rr.style.left="calc(50% - 50px)",rr.style.width="100px",rr.textContent="START XR";const pr={...tr,optionalFeatures:["local-floor","bounded-floor","layers",...tr.optionalFeatures||[]]};rr.onmouseenter=function(){rr.style.opacity="1.0"},rr.onmouseleave=function(){rr.style.opacity="0.5"},rr.onclick=function(){hr===null?navigator.xr.requestSession(cr,pr).then(fr):(hr.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(cr,pr).then(fr).catch(gr=>{console.warn(gr)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(cr,pr).then(fr).catch(gr=>{console.warn(gr)})}function sr(){rr.style.display="",rr.style.cursor="auto",rr.style.left="calc(50% - 75px)",rr.style.width="150px",rr.onmouseenter=null,rr.onmouseleave=null,rr.onclick=null}function ar(){sr(),rr.textContent="XR NOT SUPPORTED"}function or(cr){sr(),console.warn("Exception when trying to call xr.isSessionSupported",cr),rr.textContent="XR NOT ALLOWED"}function lr(cr){cr.style.position="absolute",cr.style.bottom="20px",cr.style.padding="12px 6px",cr.style.border="1px solid #fff",cr.style.borderRadius="4px",cr.style.background="rgba(0,0,0,0.1)",cr.style.color="#fff",cr.style.font="normal 13px sans-serif",cr.style.textAlign="center",cr.style.opacity="0.5",cr.style.outline="none",cr.style.zIndex="999"}if("xr"in navigator)return rr.id="XRButton",rr.style.display="none",lr(rr),navigator.xr.isSessionSupported("immersive-ar").then(function(cr){cr?nr("immersive-ar"):navigator.xr.isSessionSupported("immersive-vr").then(function(hr){hr?nr("immersive-vr"):ar()}).catch(or)}).catch(or),rr;{const cr=document.createElement("a");return window.isSecureContext===!1?(cr.href=document.location.href.replace(/^http:/,"https:"),cr.innerHTML="WEBXR NEEDS HTTPS"):(cr.href="https://immersiveweb.dev/",cr.innerHTML="WEBXR NOT AVAILABLE"),cr.style.left="calc(50% - 90px)",cr.style.width="180px",cr.style.textDecoration="none",lr(cr),cr}}}const Constants={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function fetchJsonFile(ir){const er=await fetch(ir);if(er.ok)return er.json();throw new Error(er.statusText)}async function fetchProfilesList(ir){if(!ir)throw new Error("No basePath supplied");return await fetchJsonFile(`${ir}/profilesList.json`)}async function fetchProfile(ir,er,tr=null,rr=!0){if(!ir)throw new Error("No xrInputSource supplied");if(!er)throw new Error("No basePath supplied");const nr=await fetchProfilesList(er);let sr;if(ir.profiles.some(lr=>{const cr=nr[lr];return cr&&(sr={profileId:lr,profilePath:`${er}/${cr.path}`,deprecated:!!cr.deprecated}),!!sr}),!sr){if(!tr)throw new Error("No matching profile name found");const lr=nr[tr];if(!lr)throw new Error(`No matching profile name found and default profile "${tr}" missing.`);sr={profileId:tr,profilePath:`${er}/${lr.path}`,deprecated:!!lr.deprecated}}const ar=await fetchJsonFile(sr.profilePath);let or;if(rr){let lr;if(ir.handedness==="any"?lr=ar.layouts[Object.keys(ar.layouts)[0]]:lr=ar.layouts[ir.handedness],!lr)throw new Error(`No matching handedness, ${ir.handedness}, in profile ${sr.profileId}`);lr.assetPath&&(or=sr.profilePath.replace("profile.json",lr.assetPath))}return{profile:ar,assetPath:or}}const defaultComponentValues={xAxis:0,yAxis:0,button:0,state:Constants.ComponentState.DEFAULT};function normalizeAxes(ir=0,er=0){let tr=ir,rr=er;if(Math.sqrt(ir*ir+er*er)>1){const ar=Math.atan2(er,ir);tr=Math.cos(ar),rr=Math.sin(ar)}return{normalizedXAxis:tr*.5+.5,normalizedYAxis:rr*.5+.5}}class VisualResponse{constructor(er){this.componentProperty=er.componentProperty,this.states=er.states,this.valueNodeName=er.valueNodeName,this.valueNodeProperty=er.valueNodeProperty,this.valueNodeProperty===Constants.VisualResponseProperty.TRANSFORM&&(this.minNodeName=er.minNodeName,this.maxNodeName=er.maxNodeName),this.value=0,this.updateFromComponent(defaultComponentValues)}updateFromComponent({xAxis:er,yAxis:tr,button:rr,state:nr}){const{normalizedXAxis:sr,normalizedYAxis:ar}=normalizeAxes(er,tr);switch(this.componentProperty){case Constants.ComponentProperty.X_AXIS:this.value=this.states.includes(nr)?sr:.5;break;case Constants.ComponentProperty.Y_AXIS:this.value=this.states.includes(nr)?ar:.5;break;case Constants.ComponentProperty.BUTTON:this.value=this.states.includes(nr)?rr:0;break;case Constants.ComponentProperty.STATE:this.valueNodeProperty===Constants.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(nr):this.value=this.states.includes(nr)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Component{constructor(er,tr){if(!er||!tr||!tr.visualResponses||!tr.gamepadIndices||Object.keys(tr.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=er,this.type=tr.type,this.rootNodeName=tr.rootNodeName,this.touchPointNodeName=tr.touchPointNodeName,this.visualResponses={},Object.keys(tr.visualResponses).forEach(rr=>{const nr=new VisualResponse(tr.visualResponses[rr]);this.visualResponses[rr]=nr}),this.gamepadIndices=Object.assign({},tr.gamepadIndices),this.values={state:Constants.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(er){if(this.values.state=Constants.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&er.buttons.length>this.gamepadIndices.button){const tr=er.buttons[this.gamepadIndices.button];this.values.button=tr.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,tr.pressed||this.values.button===1?this.values.state=Constants.ComponentState.PRESSED:(tr.touched||this.values.button>Constants.ButtonTouchThreshold)&&(this.values.state=Constants.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&er.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=er.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Constants.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Constants.AxisTouchThreshold&&(this.values.state=Constants.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&er.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=er.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Constants.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Constants.AxisTouchThreshold&&(this.values.state=Constants.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(tr=>{tr.updateFromComponent(this.values)})}}class MotionController{constructor(er,tr,rr){if(!er)throw new Error("No xrInputSource supplied");if(!tr)throw new Error("No profile supplied");this.xrInputSource=er,this.assetUrl=rr,this.id=tr.profileId,this.layoutDescription=tr.layouts[er.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(nr=>{const sr=this.layoutDescription.components[nr];this.components[nr]=new Component(nr,sr)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const er=[];return Object.values(this.components).forEach(tr=>{er.push(tr.data)}),er}updateFromGamepad(){Object.values(this.components).forEach(er=>{er.updateFromGamepad(this.xrInputSource.gamepad)})}}const DEFAULT_PROFILES_PATH="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",DEFAULT_PROFILE="generic-trigger";class XRControllerModel extends Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(er){return this.envMap==er?this:(this.envMap=er,this.traverse(tr=>{tr.isMesh&&(tr.material.envMap=this.envMap,tr.material.needsUpdate=!0)}),this)}updateMatrixWorld(er){super.updateMatrixWorld(er),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(tr=>{Object.values(tr.visualResponses).forEach(rr=>{const{valueNode:nr,minNode:sr,maxNode:ar,value:or,valueNodeProperty:lr}=rr;nr&&(lr===Constants.VisualResponseProperty.VISIBILITY?nr.visible=or:lr===Constants.VisualResponseProperty.TRANSFORM&&(nr.quaternion.slerpQuaternions(sr.quaternion,ar.quaternion,or),nr.position.lerpVectors(sr.position,ar.position,or)))})}))}}function findNodes(ir,er){Object.values(ir.components).forEach(tr=>{const{type:rr,touchPointNodeName:nr,visualResponses:sr}=tr;if(rr===Constants.ComponentType.TOUCHPAD)if(tr.touchPointNode=er.getObjectByName(nr),tr.touchPointNode){const ar=new SphereGeometry(.001),or=new MeshBasicMaterial({color:255}),lr=new Mesh(ar,or);tr.touchPointNode.add(lr)}else console.warn(`Could not find touch dot, ${tr.touchPointNodeName}, in touchpad component ${tr.id}`);Object.values(sr).forEach(ar=>{const{valueNodeName:or,minNodeName:lr,maxNodeName:cr,valueNodeProperty:hr}=ar;if(hr===Constants.VisualResponseProperty.TRANSFORM){if(ar.minNode=er.getObjectByName(lr),ar.maxNode=er.getObjectByName(cr),!ar.minNode){console.warn(`Could not find ${lr} in the model`);return}if(!ar.maxNode){console.warn(`Could not find ${cr} in the model`);return}}ar.valueNode=er.getObjectByName(or),ar.valueNode||console.warn(`Could not find ${or} in the model`)})})}function addAssetSceneToControllerModel(ir,er){findNodes(ir.motionController,er),ir.envMap&&er.traverse(tr=>{tr.isMesh&&(tr.material.envMap=ir.envMap,tr.material.needsUpdate=!0)}),ir.add(er)}class XRControllerModelFactory{constructor(er=null,tr=null){this.gltfLoader=er,this.path=DEFAULT_PROFILES_PATH,this._assetCache={},this.onLoad=tr,this.gltfLoader||(this.gltfLoader=new GLTFLoader)}setPath(er){return this.path=er,this}createControllerModel(er){const tr=new XRControllerModel;let rr=null;return er.addEventListener("connected",nr=>{const sr=nr.data;sr.targetRayMode!=="tracked-pointer"||!sr.gamepad||sr.hand||fetchProfile(sr,this.path,DEFAULT_PROFILE).then(({profile:ar,assetPath:or})=>{tr.motionController=new MotionController(sr,ar,or);const lr=this._assetCache[tr.motionController.assetUrl];if(lr)rr=lr.scene.clone(),addAssetSceneToControllerModel(tr,rr),this.onLoad&&this.onLoad(rr);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(tr.motionController.assetUrl,cr=>{this._assetCache[tr.motionController.assetUrl]=cr,rr=cr.scene.clone(),addAssetSceneToControllerModel(tr,rr),this.onLoad&&this.onLoad(rr)},null,()=>{throw new Error(`Asset ${tr.motionController.assetUrl} missing or malformed.`)})}}).catch(ar=>{console.warn(ar)})}),er.addEventListener("disconnected",()=>{tr.motionController=null,tr.remove(rr),rr=null}),tr}}class SessionLightProbe{constructor(er,tr,rr,nr,sr){this.xrLight=er,this.renderer=tr,this.lightProbe=rr,this.xrWebGLBinding=null,this.estimationStartCallback=sr,this.frameCallback=this.onXRFrame.bind(this);const ar=tr.xr.getSession();if(nr&&"XRWebGLBinding"in window){const or=new WebGLCubeRenderTarget(16);er.environment=or.texture;const lr=tr.getContext();switch(ar.preferredReflectionFormat){case"srgba8":lr.getExtension("EXT_sRGB");break;case"rgba16f":lr.getExtension("OES_texture_half_float");break}this.xrWebGLBinding=new XRWebGLBinding(ar,lr),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}ar.requestAnimationFrame(this.frameCallback)}updateReflection(){const er=this.renderer.properties.get(this.xrLight.environment);if(er){const tr=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);tr&&(er.__webglTexture=tr,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(er,tr){if(!this.xrLight)return;tr.session.requestAnimationFrame(this.frameCallback);const nr=tr.getLightEstimate(this.lightProbe);if(nr){this.xrLight.lightProbe.sh.fromArray(nr.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const sr=Math.max(1,Math.max(nr.primaryLightIntensity.x,Math.max(nr.primaryLightIntensity.y,nr.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(nr.primaryLightIntensity.x/sr,nr.primaryLightIntensity.y/sr,nr.primaryLightIntensity.z/sr),this.xrLight.directionalLight.intensity=sr,this.xrLight.directionalLight.position.copy(nr.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class XREstimatedLight extends Group{constructor(er,tr=!0){super(),this.lightProbe=new LightProbe,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new DirectionalLight,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let rr=null,nr=!1;er.xr.addEventListener("sessionstart",()=>{const sr=er.xr.getSession();"requestLightProbe"in sr&&sr.requestLightProbe({reflectionFormat:sr.preferredReflectionFormat}).then(ar=>{rr=new SessionLightProbe(this,er,ar,tr,()=>{nr=!0,this.dispatchEvent({type:"estimationstart"})})})}),er.xr.addEventListener("sessionend",()=>{rr&&(rr.dispose(),rr=null),nr&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{rr&&(rr.dispose(),rr=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}const _matrix=new Matrix4,_vector=new Vector3$1;class XRHandPrimitiveModel{constructor(er,tr,rr,nr,sr){this.controller=tr,this.handModel=er,this.envMap=null;let ar;!sr||!sr.primitive||sr.primitive==="sphere"?ar=new SphereGeometry(1,10,10):sr.primitive==="box"&&(ar=new BoxGeometry(1,1,1));const or=new MeshStandardMaterial;this.handMesh=new InstancedMesh(ar,or,30),this.handMesh.frustumCulled=!1,this.handMesh.instanceMatrix.setUsage(DynamicDrawUsage),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){const tr=this.controller.joints;let rr=0;for(let nr=0;nr<this.joints.length;nr++){const sr=tr[this.joints[nr]];sr.visible&&(_vector.setScalar(sr.jointRadius||.008),_matrix.compose(sr.position,sr.quaternion,_vector),this.handMesh.setMatrixAt(nr,_matrix),rr++)}this.handMesh.count=rr,this.handMesh.instanceMatrix.needsUpdate=!0}}class XRHandModel extends Object3D{constructor(er){super(),this.controller=er,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(er){super.updateMatrixWorld(er),this.motionController&&this.motionController.updateMesh()}}class XRHandModelFactory{constructor(er=null,tr=null){this.gltfLoader=er,this.path=null,this.onLoad=tr}setPath(er){return this.path=er,this}createHandModel(er,tr){const rr=new XRHandModel(er);return er.addEventListener("connected",nr=>{const sr=nr.data;sr.hand&&!rr.motionController&&(rr.xrInputSource=sr,tr===void 0||tr==="spheres"?rr.motionController=new XRHandPrimitiveModel(rr,er,this.path,sr.handedness,{primitive:"sphere"}):tr==="boxes"?rr.motionController=new XRHandPrimitiveModel(rr,er,this.path,sr.handedness,{primitive:"box"}):tr==="mesh"&&(rr.motionController=new XRHandMeshModel(rr,er,this.path,sr.handedness,this.gltfLoader,this.onLoad))),er.visible=!0}),er.addEventListener("disconnected",()=>{er.visible=!1}),rr}}class XRPlanes extends Object3D{constructor(er){super();const tr=new Matrix4,rr=new Map,nr=er.xr;nr.addEventListener("planesdetected",sr=>{const ar=sr.data,or=ar.detectedPlanes,lr=nr.getReferenceSpace();let cr=!1;for(const[hr,fr]of rr)or.has(hr)===!1&&(fr.geometry.dispose(),fr.material.dispose(),this.remove(fr),rr.delete(hr),cr=!0);for(const hr of or)if(rr.has(hr)===!1){const fr=ar.getPose(hr.planeSpace,lr);tr.fromArray(fr.transform.matrix);const ur=hr.polygon;let pr=Number.MAX_SAFE_INTEGER,gr=Number.MIN_SAFE_INTEGER,_r=Number.MAX_SAFE_INTEGER,mr=Number.MIN_SAFE_INTEGER;for(const br of ur)pr=Math.min(pr,br.x),gr=Math.max(gr,br.x),_r=Math.min(_r,br.z),mr=Math.max(mr,br.z);const dr=gr-pr,vr=mr-_r,Ar=new BoxGeometry(dr,.01,vr),yr=new MeshBasicMaterial({color:16777215*Math.random()}),wr=new Mesh(Ar,yr);wr.position.setFromMatrixPosition(tr),wr.quaternion.setFromRotationMatrix(tr),this.add(wr),rr.set(hr,wr),cr=!0}cr&&this.dispatchEvent({type:"planeschanged"})})}}const SEGMENTS=50,MASS=1,VERTEX_DISTANCE=1/SEGMENTS,canvas=document.getElementById("canvas"),gravity={x:0,y:0,z:30},world=new RAPIER$1.World(gravity),scene=new Scene,renderer=new WebGLRenderer({canvas,antialias:!0}),camera=new PerspectiveCamera(45,canvas.clientWidth/canvas.clientHeight),plane=await createPlane(),bodies=createBodies();createJoints();const background=await loadEnvironment("/cloth-button/rosendal_plains_1_2k.exr");background.mapping=EquirectangularReflectionMapping;scene.background=new Color("grey");scene.environment=background;scene.add(plane);camera.position.z=5;update();function update(){requestAnimationFrame(update),updatePhysics(),updateGeometry(),render()}function updatePhysics(){world.step()}function updateGeometry(){const ir=plane.geometry.attributes.position;for(let er=0;er<ir.count;er++){const tr=bodies[er].translation();ir.setXYZ(er,tr.x,tr.y,tr.z)}ir.needsUpdate=!0,plane.geometry.computeVertexNormals()}function render(){renderer.render(scene,camera)}async function createPlane(){const ir=await loadTexture("/cloth-button/text.png"),er=new MeshStandardMaterial({wireframe:!1,metalness:.1,roughness:.1,map:ir}),tr=new PlaneGeometry(1,1,SEGMENTS,SEGMENTS);return new Mesh(tr,er)}function createBodies(){const ir=[],er=new Vector3$1,tr=(rr,nr)=>rr%SEGMENTS===0||nr%SEGMENTS===0;for(let rr=0;rr<SEGMENTS+1;rr++)for(let nr=0;nr<SEGMENTS+1;nr++){const sr=rr*(SEGMENTS+1)+nr;er.fromBufferAttribute(plane.geometry.attributes.position,sr),er.applyMatrix4(plane.matrixWorld);const ar=tr(rr,nr)?"fixed":"dynamic",or=RAPIER$1.RigidBodyDesc[ar]().setAdditionalMass(MASS).setTranslation(...er.toArray()),lr=world.createRigidBody(or);ir.push(lr)}return ir}function createJoints(){const ir=[],er=(tr,rr)=>{const nr={x:0,y:0,z:0},sr=RAPIER$1.JointData.rope(VERTEX_DISTANCE,nr,nr),ar=world.createImpulseJoint(sr,tr,rr,!0);ir.push(ar)};for(let tr=0;tr<SEGMENTS+1;tr++)for(let rr=0;rr<SEGMENTS+1;rr++){const nr=tr*(SEGMENTS+1)+rr;rr<SEGMENTS&&er(bodies[nr],bodies[nr+1]),tr<SEGMENTS&&er(bodies[nr],bodies[nr+SEGMENTS+1])}return ir}async function loadEnvironment(ir){const er=new EXRLoader;return new Promise((tr,rr)=>{er.load(ir,nr=>tr(nr),void 0,rr)})}async function loadTexture(ir){const er=new TextureLoader;return new Promise((tr,rr)=>{er.load(ir,nr=>tr(nr),void 0,rr)})}
